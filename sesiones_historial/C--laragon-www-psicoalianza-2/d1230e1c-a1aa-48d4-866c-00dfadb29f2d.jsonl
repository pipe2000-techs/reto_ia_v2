{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-20T21:28:14.282Z","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d"}
{"type":"file-history-snapshot","messageId":"207be5fc-09dd-4dec-9d17-b278a96fe62e","snapshot":{"messageId":"207be5fc-09dd-4dec-9d17-b278a96fe62e","trackedFileBackups":{},"timestamp":"2026-01-20T21:28:14.362Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 853 to 853 from c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php:\npublic function verificarEtapaCompletada(int $id): bool {\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"analiza esta funcion public function verificarEtapaCompletada(int $id): bool {"}]},"uuid":"207be5fc-09dd-4dec-9d17-b278a96fe62e","timestamp":"2026-01-20T21:28:14.360Z"}
{"parentUuid":"207be5fc-09dd-4dec-9d17-b278a96fe62e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TTwdjkkd7Yjkhvrc1ePaWC","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a leer la función completa para analizarla."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":25112,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":25112,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXKLfFsQTNuKT9oft5CbW","type":"assistant","uuid":"2769486a-35ad-4609-8f05-df94f4b2328d","timestamp":"2026-01-20T21:28:16.421Z"}
{"parentUuid":"2769486a-35ad-4609-8f05-df94f4b2328d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TTwdjkkd7Yjkhvrc1ePaWC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UxU7HjHiaST8pHBa6xEvA9","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","offset":850,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":25112,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":25112,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXKLfFsQTNuKT9oft5CbW","type":"assistant","uuid":"25047076-75a7-40ba-9158-703612c75714","timestamp":"2026-01-20T21:28:17.600Z"}
{"parentUuid":"25047076-75a7-40ba-9158-703612c75714","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UxU7HjHiaST8pHBa6xEvA9","type":"tool_result","content":"   850→     * @author Daniel Beltrán\n   851→     * @author Andres Gonzalez\n   852→     */\n   853→    public function verificarEtapaCompletada(int $id): bool {\n   854→        $etapa_usuario    = $this->repositorio->getUno($id);\n   855→        $etapa_completada = false;\n   856→\n   857→        // Verificar si la etapa de revisión de hoja de vida ya fue completada\n   858→        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::REVISION_HV_NOMBRE, EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE]) && !is_null($etapa_usuario->puntaje) || !is_null($etapa_usuario->puntaje_ia)) {\n   859→            $etapa_completada = true;\n   860→        }\n   861→\n   862→        if ($etapa_usuario->etapa->nombre === EtapaVacante::ENTREVISTA_NOMBRE) {\n   863→            if ($this->configuracion_modelo_servicio->obtenerValorLlaveConfiguracion(app(VacanteService::class)->obtenerConfiguracionesEtapaAplicante($etapa_usuario->etapa_vacante_id), 'solicitar_formato_entrevista')) {\n   864→                $formato_entrevista = $this->formato_entrevista_repositorio->getUnoAvanzado(new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id]));\n   865→\n   866→                if (!is_null($formato_entrevista) && !is_null($formato_entrevista->descripcion_vacante) && !empty($formato_entrevista->descripcion_vacante)) {\n   867→                    $etapa_completada = true;\n   868→                }\n   869→            } else {\n   870→                $etapa_completada = true;\n   871→            }\n   872→        }\n   873→\n   874→        // Verificar si las etapas de preguntas prefiltro o videoentrevista ya han sido completadas\n   875→        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE])) {\n   876→            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n   877→                'etapa_vacante_id'                      => $etapa_usuario->etapa_vacante_id,\n   878→                'usuario_id'                            => $etapa_usuario->usuario_id,\n   879→                'incluir_cantidad_respuestas_aplicante' => true\n   880→            ]));\n   881→\n   882→            $preguntas_contestadas = 0;\n   883→\n   884→            foreach ($preguntas as $pregunta) {\n   885→                if ($pregunta['respuestas_count'] > 0) {\n   886→                    $preguntas_contestadas++;\n   887→                }\n   888→            }\n   889→\n   890→            // Validar que todas las preguntas hayan sido contestadas\n   891→            if (count($preguntas) === $preguntas_contestadas) {\n   892→                $etapa_completada = true;\n   893→            }\n   894→        }\n   895→\n   896→        if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n   897→            if ((!is_null($etapa_usuario->pruebaTecnica?->enlace) && !empty($etapa_usuario->pruebaTecnica?->enlace) || $etapa_usuario->pruebaTecnica?->archivos->count() > 0) && $etapa_usuario->pruebaTecnica?->borrador == false) {\n   898→                $etapa_completada = true;\n   899→            }\n   900→        }\n   901→\n   902→        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n   903→            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n   904→                $etapa_usuario->etapa_vacante_id,\n   905→                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n   906→            );\n   907→\n   908→            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n   909→            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n   910→            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n   911→\n   912→            $todos_cargados = true;\n   913→            foreach ($documentos_solicitados as $documento) {\n   914→                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n   915→\n   916→                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n   917→                    $todos_cargados = false;\n   918→                    break;\n   919→                }\n   920→            }\n   921→\n   922→            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n   923→                $etapa_completada = true;\n   924→            }\n   925→        }\n   926→\n   927→        return $etapa_completada;\n   928→    }\n   929→\n   930→    /**\n   931→     * Notificar documentos solicitados.\n   932→     *\n   933→     * @param int $id ID de la etapa del usuario en la vacante.\n   934→     * @return void\n   935→     * @author Andres Gonzalez\n   936→     * @author Jair Carvajal\n   937→     * @author Daniel Beltrán\n   938→     */\n   939→    public function notificarDocumentosSolicitados(int $id): void {\n   940→        $etapa_vacante_usuario = $this->repositorio->getUno($id);\n   941→\n   942→        if ($etapa_vacante_usuario) {\n   943→            $this->enviarCorreoFinalizacionEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->vacante);\n   944→        }\n   945→    }\n   946→\n   947→    /**\n   948→     * Descartar uno o varios aplicantes manualmente y moverlos a la etapa de descartados.\n   949→     *\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"80cae02b-8a17-4135-8baa-5defc8ca85cf","timestamp":"2026-01-20T21:28:19.823Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","content":"     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function verificarEtapaCompletada(int $id): bool {\n        $etapa_usuario    = $this->repositorio->getUno($id);\n        $etapa_completada = false;\n\n        // Verificar si la etapa de revisión de hoja de vida ya fue completada\n        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::REVISION_HV_NOMBRE, EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE]) && !is_null($etapa_usuario->puntaje) || !is_null($etapa_usuario->puntaje_ia)) {\n            $etapa_completada = true;\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::ENTREVISTA_NOMBRE) {\n            if ($this->configuracion_modelo_servicio->obtenerValorLlaveConfiguracion(app(VacanteService::class)->obtenerConfiguracionesEtapaAplicante($etapa_usuario->etapa_vacante_id), 'solicitar_formato_entrevista')) {\n                $formato_entrevista = $this->formato_entrevista_repositorio->getUnoAvanzado(new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id]));\n\n                if (!is_null($formato_entrevista) && !is_null($formato_entrevista->descripcion_vacante) && !empty($formato_entrevista->descripcion_vacante)) {\n                    $etapa_completada = true;\n                }\n            } else {\n                $etapa_completada = true;\n            }\n        }\n\n        // Verificar si las etapas de preguntas prefiltro o videoentrevista ya han sido completadas\n        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE])) {\n            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n                'etapa_vacante_id'                      => $etapa_usuario->etapa_vacante_id,\n                'usuario_id'                            => $etapa_usuario->usuario_id,\n                'incluir_cantidad_respuestas_aplicante' => true\n            ]));\n\n            $preguntas_contestadas = 0;\n\n            foreach ($preguntas as $pregunta) {\n                if ($pregunta['respuestas_count'] > 0) {\n                    $preguntas_contestadas++;\n                }\n            }\n\n            // Validar que todas las preguntas hayan sido contestadas\n            if (count($preguntas) === $preguntas_contestadas) {\n                $etapa_completada = true;\n            }\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n            if ((!is_null($etapa_usuario->pruebaTecnica?->enlace) && !empty($etapa_usuario->pruebaTecnica?->enlace) || $etapa_usuario->pruebaTecnica?->archivos->count() > 0) && $etapa_usuario->pruebaTecnica?->borrador == false) {\n                $etapa_completada = true;\n            }\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n                $etapa_usuario->etapa_vacante_id,\n                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n            );\n\n            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n\n            $todos_cargados = true;\n            foreach ($documentos_solicitados as $documento) {\n                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n\n                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n                    $todos_cargados = false;\n                    break;\n                }\n            }\n\n            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }\n        }\n\n        return $etapa_completada;\n    }\n\n    /**\n     * Notificar documentos solicitados.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Jair Carvajal\n     * @author Daniel Beltrán\n     */\n    public function notificarDocumentosSolicitados(int $id): void {\n        $etapa_vacante_usuario = $this->repositorio->getUno($id);\n\n        if ($etapa_vacante_usuario) {\n            $this->enviarCorreoFinalizacionEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->vacante);\n        }\n    }\n\n    /**\n     * Descartar uno o varios aplicantes manualmente y moverlos a la etapa de descartados.\n     *","numLines":100,"startLine":850,"totalLines":1346}},"sourceToolAssistantUUID":"25047076-75a7-40ba-9158-703612c75714"}
{"parentUuid":"80cae02b-8a17-4135-8baa-5defc8ca85cf","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_015714psjyGVZDmyCUGeWbcC","type":"message","role":"assistant","content":[{"type":"text","text":"## Análisis de `verificarEtapaCompletada`\n\nEsta función verifica si una etapa del proceso de selección ha sido completada por un usuario/aplicante. Retorna `true` si la etapa está completa, `false` en caso contrario.\n\n### Estructura de la función\n\nLa función evalúa diferentes tipos de etapas:\n\n| Etapa | Criterio de completitud |\n|-------|------------------------|\n| **Revisión HV / Pruebas Psicométricas / Video Entrevista** | Tiene `puntaje` o `puntaje_ia` asignado |\n| **Entrevista** | Si requiere formato: debe tener `descripcion_vacante`. Si no lo requiere: siempre completada |\n| **Preguntas Prefiltro / Video Entrevista** | Todas las preguntas deben estar contestadas |\n| **Prueba Técnica** | Tiene enlace o archivos adjuntos y no está en borrador |\n| **Documentos Contratación** | Todos los documentos solicitados han sido cargados |\n\n### ⚠️ Problema detectado en línea 858\n\n```php\nif (in_array($etapa_usuario->etapa->nombre, [...]) && !is_null($etapa_usuario->puntaje) || !is_null($etapa_usuario->puntaje_ia)) {\n```\n\n**Error de precedencia de operadores**: El `&&` tiene mayor precedencia que `||`, por lo que la condición se evalúa como:\n\n```php\n(in_array(...) && !is_null($etapa_usuario->puntaje)) || !is_null($etapa_usuario->puntaje_ia)\n```\n\nEsto significa que si `puntaje_ia` no es nulo, **cualquier etapa** se marcará como completada, no solo las tres especificadas.\n\n**Corrección sugerida**:\n```php\nif (in_array($etapa_usuario->etapa->nombre, [...]) && (!is_null($etapa_usuario->puntaje) || !is_null($etapa_usuario->puntaje_ia))) {\n```\n\n### Otro detalle\n\nLa etapa `VIDEO_ENTREVISTA_NOMBRE` aparece en dos bloques diferentes (líneas 858 y 875), lo cual puede ser intencional si debe cumplir ambas condiciones, pero podría generar comportamiento inesperado ya que el primer bloque podría marcar `$etapa_completada = true` antes de verificar las preguntas.\n\n¿Deseas que corrija el error de precedencia de operadores?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2004,"cache_read_input_tokens":25112,"cache_creation":{"ephemeral_5m_input_tokens":2004,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXKLffj7CBikd9TDixwbU","type":"assistant","uuid":"216b28d9-2096-4746-9a8e-e22e456227e6","timestamp":"2026-01-20T21:28:34.927Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-20T21:34:08.035Z","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d"}
{"type":"file-history-snapshot","messageId":"1c10f40d-8a8e-4e2e-930c-a54a352a6844","snapshot":{"messageId":"1c10f40d-8a8e-4e2e-930c-a54a352a6844","trackedFileBackups":{},"timestamp":"2026-01-20T21:34:08.100Z"},"isSnapshotUpdate":false}
{"parentUuid":"25047076-75a7-40ba-9158-703612c75714","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01UxU7HjHiaST8pHBa6xEvA9","parentToolUseID":"toolu_01UxU7HjHiaST8pHBa6xEvA9","uuid":"9d4fdc71-b13f-40a4-9a8e-1d77addaaad2","timestamp":"2026-01-20T21:28:18.704Z"}
{"parentUuid":"216b28d9-2096-4746-9a8e-e22e456227e6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"listo cunado sea la etapa de documentos contratacion que valide los documnetos y valide que el campo que bien del get uno qye es fecha_ejecucion sea diferente a null"}]},"uuid":"1c10f40d-8a8e-4e2e-930c-a54a352a6844","timestamp":"2026-01-20T21:34:08.098Z"}
{"parentUuid":"1c10f40d-8a8e-4e2e-930c-a54a352a6844","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01QqWqmpwWqFGRLcwKv2ZLt1","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a modificar la función para agregar la validación de `fecha_ejecucion` en la etapa de documentos de contratación."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":27806,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":27806,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXKM7Me9eR8S4bVUveBf2","type":"assistant","uuid":"12d04530-3012-4c1c-899b-866f4556ddc7","timestamp":"2026-01-20T21:34:10.585Z"}
{"parentUuid":"12d04530-3012-4c1c-899b-866f4556ddc7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01QqWqmpwWqFGRLcwKv2ZLt1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018NEPRL8aEcrTiVWfntcjaq","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","old_string":"        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n                $etapa_usuario->etapa_vacante_id,\n                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n            );\n\n            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n\n            $todos_cargados = true;\n            foreach ($documentos_solicitados as $documento) {\n                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n\n                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n                    $todos_cargados = false;\n                    break;\n                }\n            }\n\n            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }\n        }","new_string":"        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n                $etapa_usuario->etapa_vacante_id,\n                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n            );\n\n            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n\n            $todos_cargados = true;\n            foreach ($documentos_solicitados as $documento) {\n                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n\n                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n                    $todos_cargados = false;\n                    break;\n                }\n            }\n\n            if ($todos_cargados && $documentos_solicitados->count() > 0 && !is_null($etapa_usuario->fecha_ejecucion)) {\n                $etapa_completada = true;\n            }\n        }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":27806,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":27806,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXKM7Me9eR8S4bVUveBf2","type":"assistant","uuid":"a1b4a32c-8040-4cc1-acbc-3a9939e2ec4b","timestamp":"2026-01-20T21:34:21.335Z"}
{"parentUuid":"a1b4a32c-8040-4cc1-acbc-3a9939e2ec4b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has not been read yet. Read it first before writing to it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_018NEPRL8aEcrTiVWfntcjaq"}]},"uuid":"5ec60102-56b9-4232-88d0-c6fcc199f143","timestamp":"2026-01-20T21:34:22.314Z","toolUseResult":"Error: File has not been read yet. Read it first before writing to it.","sourceToolAssistantUUID":"a1b4a32c-8040-4cc1-acbc-3a9939e2ec4b"}
{"parentUuid":"5ec60102-56b9-4232-88d0-c6fcc199f143","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GTNnD3SofrP3eWjuxkdign","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01A7FBAGCUhRM9Mqieg29Ndy","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","offset":900,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":891,"cache_read_input_tokens":27806,"cache_creation":{"ephemeral_5m_input_tokens":891,"ephemeral_1h_input_tokens":0},"output_tokens":20,"service_tier":"standard"}},"requestId":"req_011CXKM8PiwGCarTJ8aJYts6","type":"assistant","uuid":"21817c27-b01b-4e01-8a1b-b8c6c8ed29c7","timestamp":"2026-01-20T21:34:25.722Z"}
{"parentUuid":"21817c27-b01b-4e01-8a1b-b8c6c8ed29c7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01A7FBAGCUhRM9Mqieg29Ndy","type":"tool_result","content":"   900→        }\n   901→\n   902→        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n   903→            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n   904→                $etapa_usuario->etapa_vacante_id,\n   905→                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n   906→            );\n   907→\n   908→            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n   909→            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n   910→            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n   911→\n   912→            $todos_cargados = true;\n   913→            foreach ($documentos_solicitados as $documento) {\n   914→                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n   915→\n   916→                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n   917→                    $todos_cargados = false;\n   918→                    break;\n   919→                }\n   920→            }\n   921→\n   922→            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n   923→                $etapa_completada = true;\n   924→            }\n   925→        }\n   926→\n   927→        return $etapa_completada;\n   928→    }\n   929→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"6edfafcb-bad3-4ba4-95fe-288cd38f0c1e","timestamp":"2026-01-20T21:34:26.922Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","content":"        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n                $etapa_usuario->etapa_vacante_id,\n                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n            );\n\n            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n\n            $todos_cargados = true;\n            foreach ($documentos_solicitados as $documento) {\n                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n\n                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n                    $todos_cargados = false;\n                    break;\n                }\n            }\n\n            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }\n        }\n\n        return $etapa_completada;\n    }\n","numLines":30,"startLine":900,"totalLines":1346}},"sourceToolAssistantUUID":"21817c27-b01b-4e01-8a1b-b8c6c8ed29c7"}
{"parentUuid":"6edfafcb-bad3-4ba4-95fe-288cd38f0c1e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Mp5rJ3uzaVqmRpp5EFchDg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017H7b1DtMMoMyjCsnzQVLmz","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","old_string":"            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }","new_string":"            if ($todos_cargados && $documentos_solicitados->count() > 0 && !is_null($etapa_usuario->fecha_ejecucion)) {\n                $etapa_completada = true;\n            }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":651,"cache_read_input_tokens":28697,"cache_creation":{"ephemeral_5m_input_tokens":651,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CXKM8jECbnZ3uEHonrBF7","type":"assistant","uuid":"f639bb60-1741-476d-a659-4f184fd881bf","timestamp":"2026-01-20T21:34:30.992Z"}
{"type":"file-history-snapshot","messageId":"f639bb60-1741-476d-a659-4f184fd881bf","snapshot":{"messageId":"1c10f40d-8a8e-4e2e-930c-a54a352a6844","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v1","version":1,"backupTime":"2026-01-20T21:36:08.998Z"}},"timestamp":"2026-01-20T21:34:08.100Z"},"isSnapshotUpdate":true}
{"parentUuid":"f639bb60-1741-476d-a659-4f184fd881bf","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017H7b1DtMMoMyjCsnzQVLmz","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   918→                    break;\n   919→                }\n   920→            }\n   921→\n   922→            if ($todos_cargados && $documentos_solicitados->count() > 0 && !is_null($etapa_usuario->fecha_ejecucion)) {\n   923→                $etapa_completada = true;\n   924→            }\n   925→        }\n   926→\n   927→        return $etapa_completada;\n   928→    }"}]},"uuid":"92e87960-fc12-4825-aff4-dda97afdc293","timestamp":"2026-01-20T21:36:09.029Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","oldString":"            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }","newString":"            if ($todos_cargados && $documentos_solicitados->count() > 0 && !is_null($etapa_usuario->fecha_ejecucion)) {\n                $etapa_completada = true;\n            }","originalFile":"<?php\n\nnamespace App\\Http\\Services\\Vacantes;\n\nuse App\\Traits\\IATrait;\nuse App\\Traits\\StringTrait;\nuse Illuminate\\Support\\Arr;\nuse App\\Traits\\ArchivoTrait;\nuse Illuminate\\Http\\Request;\nuse App\\Models\\Vacantes\\Vacante;\nuse App\\Http\\Services\\BaseService;\nuse App\\Models\\Agendas\\EstadoAgenda;\nuse Illuminate\\Support\\Facades\\Auth;\nuse Illuminate\\Support\\Facades\\Mail;\nuse App\\Models\\Vacantes\\EtapaVacante;\nuse App\\Models\\Vacantes\\EstadoVacante;\nuse App\\Models\\Vacantes\\MovimientoVacante;\nuse App\\Mail\\NotificarFinalizacionEtapaMail;\nuse App\\Mail\\NotificarPostulanteVacanteMail;\nuse App\\Models\\Vacantes\\EtapaVacanteUsuario;\nuse Illuminate\\Http\\Client\\RequestException;\nuse App\\Http\\Services\\Vacantes\\VacanteService;\nuse App\\Models\\Configuraciones\\PlantillaCorreo;\nuse Illuminate\\Http\\Client\\ConnectionException;\nuse App\\Http\\Repositories\\Usuarios\\UserRepository;\nuse App\\Http\\Services\\Usuarios\\TokenAccesoService;\nuse App\\Http\\Repositories\\Agendas\\AgendaRepository;\nuse App\\Http\\Services\\Vacantes\\EtapaVacanteService;\nuse App\\Jobs\\Vacantes\\ProcesarVideoentrevistaIAJob;\nuse App\\Http\\Repositories\\Procesos\\ProcesoRepository;\nuse App\\Http\\Repositories\\Vacantes\\VacanteRepository;\nuse App\\Http\\Services\\Agendas\\ResultadoAgendaService;\nuse App\\Http\\Services\\Configuraciones\\ArchivoService;\nuse App\\Notifications\\NotificarAvanceProcesoNotification;\nuse App\\Http\\Repositories\\Vacantes\\EtapaVacanteRepository;\nuse App\\Http\\Repositories\\Vacantes\\TranscripcionRepository;\nuse App\\Http\\Repositories\\Configuraciones\\ArchivoRepository;\nuse App\\Http\\Repositories\\Empresas\\EmpresaUsuarioRepository;\nuse App\\Http\\Repositories\\Vacantes\\AspectoPuntajeRepository;\nuse App\\Http\\Services\\Configuraciones\\PlantillaCorreoService;\nuse App\\Http\\Repositories\\Vacantes\\FormatoEntrevistaRepository;\nuse App\\Http\\Repositories\\Vacantes\\EtapaVacanteUsuarioRepository;\nuse App\\Http\\Services\\Configuraciones\\ConfiguracionModeloService;\nuse App\\Http\\Repositories\\Vacantes\\EtapaMovimientoVacanteRepository;\nuse App\\Http\\Repositories\\OfertasLaborales\\PreguntaOfertaLaboralRepository;\nuse App\\Http\\Repositories\\Usuarios\\PerfilesLaborales\\PerfilLaboralRepository;\nuse App\\Http\\Repositories\\OfertasLaborales\\PuntajePreguntaOfertaLaboralRepository;\n\n/**\n * @property EtapaVacanteUsuarioRepository $repositorio\n */\nclass EtapaVacanteUsuarioService extends BaseService\n{\n    use ArchivoTrait, IATrait, StringTrait;\n\n    /**\n     * @var float|int $puntaje_total Puntaje total, utilizado para la adecuación de HV.\n     */\n    private $puntaje_total = 0;\n\n    /**\n     * @var float $puntaje Puntaje de aspecto, utilizado para la adecuación de HV.\n     */\n    private $puntaje = 0;\n\n    /**\n     * @var bool $cumple Indica si cumple con el aspecto, utilizada para la adecuación de HV.\n     */\n    private $cumple = false;\n\n    /**\n     * Constructor.\n     *\n     * @param EtapaVacanteUsuarioRepository $repositorio Repositorio de etapas de vacantes de usuarios.\n     * @param PerfilLaboralRepository $perfil_laboral_repositorio Repositorio de perfiles laborales.\n     * @param EtapaVacanteRepository $etapa_vacante_repositorio Repositorio de etapas de vacantes.\n     * @param AspectoPuntajeRepository $aspecto_puntaje_repositorio Repositorio de puntajes de aspectos.\n     * @param ArchivoService $archivo_servicio Servicio de archivos.\n     * @param ArchivoRepository $archivo_repositorio Repositorio de archivos.\n     * @param EmpresaUsuarioRepository $empresa_usuario_repositorio Repositorio de usuarios de empresas.\n     * @param PreguntaOfertaLaboralRepository $pregunta_oferta_laboral_repositorio Repositorio de preguntas de ofertas laborales.\n     * @param PuntajePreguntaOfertaLaboralRepository $puntaje_pregunta_oferta_laboral_repositorio Repositorio de puntajes de preguntas de ofertas laborales.\n     * @param EtapaMovimientoVacanteRepository $etapa_movimiento_vacante_repositorio Repositorio de movimientos de etapas de vacantes.\n     * @param ProcesoRepository $proceso_repositorio Repositorio de procesos.\n     * @param TranscripcionRepository $transcripcion_repositorio Repositorio de transcripciones.\n     * @param PlantillaCorreoService $plantilla_correo_servicio Servicio de plantillas de correo.\n     * @param TokenAccesoService $token_acceso_servicio Servicio de tokens de acceso.\n     * @param UserRepository $usuario_repositorio Servicio de usuarios.\n     * @param VacanteRepository $vacante_repositorio Repositorio de vacantes.\n     * @param AgendaRepository $agenda_repositorio Repositorio de agendas.\n     * @param ResultadoAgendaService $resultado_agenda_servicio Servicio de resultados de agendas.\n     * @param ConfiguracionModeloService $configuracion_modelo_servicio Servicio de configuraciones de modelos.\n     * @param FormatoEntrevistaRepository $formato_entrevista_repositorio Repositorio de formatos de entrevista.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function __construct(\n        EtapaVacanteUsuarioRepository $repositorio,\n        protected PerfilLaboralRepository $perfil_laboral_repositorio,\n        protected EtapaVacanteRepository $etapa_vacante_repositorio,\n        protected AspectoPuntajeRepository $aspecto_puntaje_repositorio,\n        protected ArchivoService $archivo_servicio,\n        protected ArchivoRepository $archivo_repositorio,\n        protected EmpresaUsuarioRepository $empresa_usuario_repositorio,\n        protected PreguntaOfertaLaboralRepository $pregunta_oferta_laboral_repositorio,\n        protected PuntajePreguntaOfertaLaboralRepository $puntaje_pregunta_oferta_laboral_repositorio,\n        protected EtapaMovimientoVacanteRepository $etapa_movimiento_vacante_repositorio,\n        protected ProcesoRepository $proceso_repositorio,\n        protected TranscripcionRepository $transcripcion_repositorio,\n        protected PlantillaCorreoService $plantilla_correo_servicio,\n        protected TokenAccesoService $token_acceso_servicio,\n        protected UserRepository $usuario_repositorio,\n        protected VacanteRepository $vacante_repositorio,\n        protected AgendaRepository $agenda_repositorio,\n        protected ResultadoAgendaService $resultado_agenda_servicio,\n        protected ConfiguracionModeloService $configuracion_modelo_servicio,\n        protected FormatoEntrevistaRepository $formato_entrevista_repositorio\n    ) {\n        parent::__construct($repositorio);\n    }\n\n    /**\n     * Guardar documento solicitado de una etapa de vacante de usuario.\n     *\n     * @param Request $request Contenido de la petición.\n     * @return void\n     * @author Andres Gonzalez\n     */\n    public function guardarDocumentoSolicitado(Request $request): void { \n        $empresa = $this->empresa_usuario_repositorio->obtenerEmpresaActualUsuario();\n\n        if ($request->hasFile('archivo')) {\n            $this->archivo_servicio->guardarVarios(EtapaVacanteUsuario::class, $request->etapa_vacante_usuario_id, [$request->nombre_documento => $request->file('archivo')], 'empresas/' . $empresa->id . '/documentos-solicitados', true);\n\n            // Actualizar fecha de ejecución de la etapa\n            $this->repositorio->actualizar($request->etapa_vacante_usuario_id, ['fecha_ejecucion' => now()]);\n        }\n    }\n\n    /**\n     * Establecer valores para puntaje y cumplimiento de un aspecto.\n     *\n     * @param float $puntaje Puntaje obtenido.\n     * @param bool $cumple Indica si cumple.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    private function establecerPuntajeCumplimiento(float $puntaje = 0, bool $cumple = false): void {\n        $this->puntaje = $puntaje;\n        $this->cumple  = $cumple;\n    }\n\n    /**\n     * Guardar puntaje de un aspecto evaluado.\n     *\n     * @param int $etapa_vacante_usuario_id ID de la etapa del usuario en la vacante.\n     * @param string $categoria Categoría del aspecto.\n     * @param string $aspecto Aspecto evaluado.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    private function guardarAspectoPuntaje(int $etapa_vacante_usuario_id, string $categoria, string $aspecto): void {\n        $this->aspecto_puntaje_repositorio->crearOActualizar([\n            'etapa_vacante_usuario_id' => $etapa_vacante_usuario_id,\n            'categoria'                => $categoria,\n            'aspecto'                  => $aspecto\n        ], [\n            'puntaje'                  => $this->puntaje,\n            'cumple'                   => $this->cumple\n        ]);\n\n        $this->puntaje_total += $this->puntaje;\n        $this->establecerPuntajeCumplimiento();\n    }\n\n    /**\n     * Generar adecuación de hoja de vida.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function generarAdecuacionHV(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::REVISION_HV_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje)) {\n            $perfil_laboral = $this->perfil_laboral_repositorio->getUnoAvanzado(new Request([\n                'usuario_id'                     => $etapa_usuario->usuario_id,\n                'incluir_experiencias_laborales' => true,\n                'incluir_estudios'               => true,\n                'incluir_idiomas'                => true,\n                'incluir_usuario'                => true\n            ]));\n\n            // Generar y guardar la adecuación del perfil de candidato (habilidades y herramientas tecnológicas)\n            $categoria            = 'perfil';\n            $puntaje_aspecto      = 100 / 2;\n            $datos_vacante        = $etapa_usuario->vacante->datos;\n            $habilidades_vacante  = $datos_vacante->where('llave', 'habilidades')->first();\n            $herramientas_vacante = $datos_vacante->where('llave', 'herramientas_tecnologicas')->first();\n\n            // Validar coincidencia para las habilidades\n            if (!is_null($habilidades_vacante->valor) && !empty($habilidades_vacante->valor)) {\n                $habilidades_vacante        = array_map(fn($item) => trim($item), explode(',', $habilidades_vacante->valor));\n                $habilidades_perfil_laboral = array_map(fn($item) => trim($item), explode(',', $perfil_laboral->habilidades));\n                $coincidencias              = count(array_uintersect($habilidades_vacante, $habilidades_perfil_laboral, 'strcasecmp'));\n\n                if ($coincidencias >= count($habilidades_vacante)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'habilidades');\n\n            // Validar coincidencia para las herramientas tecnológicas\n            if (!is_null($herramientas_vacante->valor) && !empty($herramientas_vacante->valor)) {\n                $herramientas_vacante        = array_map(fn($item) => trim($item), explode(',', $herramientas_vacante->valor));\n                $herramientas_perfil_laboral = array_map(fn($item) => trim($item), explode(',', $perfil_laboral->herramientas_tecnologicas));\n                $coincidencias               = count(array_uintersect($herramientas_vacante, $herramientas_perfil_laboral, 'strcasecmp'));\n\n                if ($coincidencias >= count($herramientas_vacante)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'herramientas');\n\n            // Generar y guardar la adecuación de requisitos del candidato (género, edad, nivel educativo, modalidad de trabajo, salario, experiencia, idiomas, licencia de conducir)\n            $categoria       = 'requisito';\n            $puntaje_aspecto = 100 / 8;\n\n            // Validar coincidencia de género\n            $genero_vacante = $datos_vacante->where('llave', 'genero')->first();\n\n            if (!is_null($genero_vacante) && !empty($genero_vacante)) {\n                if ($genero_vacante->valor === mb_convert_case($perfil_laboral->usuario->genero->nombre, MB_CASE_LOWER)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                } elseif ($genero_vacante->valor === 'indiferente') {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'genero');\n\n            // Validar coincidencia de edad\n            $edad_minima_vacante = $datos_vacante->where('llave', 'edad_minima')->first();\n            $edad_maxima_vacante = $datos_vacante->where('llave', 'edad_maxima')->first();\n\n            if (empty($edad_minima_vacante->valor) || empty($edad_maxima_vacante->valor)) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif ($perfil_laboral->usuario->edad >= $edad_minima_vacante->valor && $perfil_laboral->usuario->edad <= $edad_maxima_vacante->valor) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'edad');\n\n            // Validar coincidencia de nivel educativo\n            $nivel_educativo_vacante = $datos_vacante->where('llave', 'nivel_educativo')->first();\n            $escala_estudios         = [\n                'Preescolar'                      => 1,\n                'Primaria'                        => 2,\n                'Secundaria básica'               => 3,\n                'Secundaria superior'             => 4,\n                'Educación continua y permanente' => 5,\n                'Técnico'                         => 6,\n                'Tecnólogo'                       => 7,\n                'Profesional'                     => 8,\n                'Especialización (postgrado)'     => 9,\n                'Maestría (postgrado)'            => 10,\n                'Doctorado (postgrado)'           => 11\n            ];\n\n            if (empty($nivel_educativo_vacante->valor) || $nivel_educativo_vacante->valor === 'indiferente') {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif (count($perfil_laboral->estudios) > 0) {\n                $cumple_nivel_educativo = false;\n\n                foreach ($perfil_laboral->estudios as $estudio) {\n                    if ($escala_estudios[$nivel_educativo_vacante->valor] <= $escala_estudios[$estudio->nivelEducativo->nombre]) {\n                        $cumple_nivel_educativo = true;\n                        break;\n                    }\n                }\n\n                if ($cumple_nivel_educativo) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'estudios');\n\n            // Validar coincidencia de modalidad de trabajo\n            if (!is_null($etapa_usuario->vacante->modalidad_trabajo_id)) {\n                if ($etapa_usuario->vacante->modalidad_trabajo_id === $perfil_laboral->modalidad_trabajo_id) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'modalidad_trabajo');\n\n            // Validar coincidencia de salario\n            if (is_null($etapa_usuario->vacante->salario)) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif (!is_null($etapa_usuario->vacante->salario) && is_null($etapa_usuario->vacante->salario_maximo)) {\n                // Salario fijo\n                if (!is_null($perfil_laboral->salario_maximo)) {\n                    // Validar cuando el salario de la vacante es fijo pero el del usuario es rango\n                    if (($etapa_usuario->vacante->salario >= $perfil_laboral->salario && $etapa_usuario->vacante->salario <= $perfil_laboral->salario_maximo) || ($perfil_laboral->salario <= $etapa_usuario->vacante->salario && $perfil_laboral->salario_maximo <= $etapa_usuario->vacante->salario)) {\n                        $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                    }\n                } elseif ($perfil_laboral->salario <= $etapa_usuario->vacante->salario) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } elseif (!is_null($etapa_usuario->vacante->salario) && !is_null($etapa_usuario->vacante->salario_maximo)) {\n                // Rango de salario\n                if (!is_null($perfil_laboral->salario_maximo)) {\n                    // Validar cuando el salario del usuario y de la vacante son rangos\n                    if (($perfil_laboral->salario >= $etapa_usuario->vacante->salario && $perfil_laboral->salario <= $etapa_usuario->vacante->salario_maximo) || ($perfil_laboral->salario_maximo >= $etapa_usuario->vacante->salario && $perfil_laboral->salario_maximo <= $etapa_usuario->vacante->salario_maximo)) {\n                        $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                    }\n                } else {\n                    if ($perfil_laboral->salario >= $etapa_usuario->vacante->salario && $perfil_laboral->salario <= $etapa_usuario->vacante->salario_maximo) {\n                        $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                    }\n                }\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'salario');\n\n            // Validar coincidencia de experiencia\n            $experiencia_vacante   = $datos_vacante->where('llave', 'experiencia_laboral')->first();\n            $experiencia_aplicante = $perfil_laboral->experienciasLaborales->sum('tiempo');\n            $experiencias          = [\n                '1 año'        => 1,\n                '2 años'       => 2,\n                '3 años'       => 3,\n                '4 años'       => 4,\n                '5 años o más' => 5\n            ];\n\n            if (empty($experiencia_vacante->valor) || $experiencia_vacante->valor === 'Sin experiencia') {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif ($experiencia_vacante->valor === 'Menos de 1 año') {\n                if ($experiencia_aplicante > 0 && $experiencia_aplicante < 365) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } elseif (($experiencias[$experiencia_vacante->valor] * 365) <= $experiencia_aplicante) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'experiencia');\n\n            // Validar coincidencia de idiomas\n            $idiomas_vacante = $etapa_usuario->vacante->idiomas;\n            $escala_idiomas  = [\n                'A1' => 1,\n                'A2' => 2,\n                'B1' => 3,\n                'B2' => 4,\n                'C1' => 5,\n                'C2' => 6\n            ];\n\n            if ($idiomas_vacante->count() > 0) {\n                $coincidencias_idiomas = 0;\n\n                if ($perfil_laboral->idiomas->count() > 0) {\n                    foreach ($idiomas_vacante as $idioma) {\n                        foreach ($perfil_laboral->idiomas as $idioma_perfil) {\n                            if ($idioma->idioma_id === $idioma_perfil->idioma_id && $escala_idiomas[$idioma->nivel] <= $escala_idiomas[$idioma_perfil->nivel]) {\n                                $coincidencias_idiomas++;\n                            }\n                        }\n                    }\n                }\n\n                if ($coincidencias_idiomas >= $idiomas_vacante->count()) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'idiomas');\n\n            // Validar coincidencia de licencia de conducir\n            $licencia_conducir_vacante = $datos_vacante->where('llave', 'licencia_conducir')->first();\n            $escala_licencias          = [\n                'A1' => 1,\n                'A2' => 2,\n                'B1' => 3,\n                'B2' => 4,\n                'B3' => 5,\n                'C1' => 6,\n                'C2' => 7,\n                'C3' => 8\n            ];\n\n            if (empty($licencia_conducir_vacante->valor)) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif (is_null($perfil_laboral->licencia_conducir)) {\n                if (empty($licencia_conducir_vacante->valor)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } elseif ($escala_licencias[$licencia_conducir_vacante->valor] <= $escala_licencias[$perfil_laboral->licencia_conducir]) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'licencia_conducir');\n\n            $puntaje_total = round($this->puntaje_total / 2); // Se divide entre las dos categorías existentes\n            $this->gestionarContinuidadAplicante($etapa_usuario, MovimientoVacante::REVISION_HV_ID, $puntaje_total, 'descartar_candidatos_adecuaciones_bajas_hv', 'descartar_candidatos_adecuaciones_medias_hv');\n        }\n    }\n\n    /**\n     * Generar adecuación para preguntas prefiltro.\n     *\n     * Califica las respuestas del aplicante en cada una de las preguntas y calcula la adecuación en base a sus resultados.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function generarAdecuacionPrefiltro(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje)) {\n            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n                'etapa_vacante_id'   => $etapa_usuario->etapa_vacante_id,\n                'usuario_id'         => $etapa_usuario->usuario_id,\n                'incluir_respuestas' => true\n            ]));\n\n            $porcentaje_pregunta  = 100 / $preguntas->count();\n            $respuestas_correctas = 0;\n\n            foreach ($preguntas as $pregunta) {\n                $puntaje    = null;\n                $puntaje_ia = null;\n\n                if ($pregunta->es_abierta) {\n                    $respuesta = $opcion_seleccionada = $pregunta->respuestas->first();\n\n                    if (!is_null($respuesta)) {\n                        try {\n                            $peticion_ia = $this->realizarPeticionIA(\n                                ruta: 'calificar-pregunta-abierta',\n                                parametros: [\n                                    'pregunta'  => $pregunta->enunciado,\n                                    'respuesta' => $respuesta->respuesta,\n                                ],\n                                contexto_tracking: [\n                                    'vacante_id' => $etapa_usuario->etapa->vacante_id ?? null,\n                                    'agenda_id' => null,\n                                ]\n                            );\n\n                            if (!is_null($peticion_ia) && $peticion_ia['status_code'] === 200) {\n                                $puntaje_ia = $peticion_ia['calificacion'];\n                            }\n                        } catch (RequestException|ConnectionException $error) {}\n                    }\n                } else {\n                    $opciones_correctas = $pregunta->opciones->where('es_correcta', true);\n\n                    // Selección única\n                    if ($opciones_correctas->count() === 1) {\n                        $opcion_correcta     = $opciones_correctas->first();\n                        $opcion_seleccionada = $pregunta->respuestas->first();\n                        $puntaje             = (int) (!is_null($opcion_seleccionada) && $opcion_correcta->id === $opcion_seleccionada->opcion_pregunta_id);\n                    } else { // Selección múltiple\n                        $opciones_correctas     = $opciones_correctas->pluck('id')->toArray();\n                        $opciones_seleccionadas = $pregunta->respuestas->pluck('opcion_pregunta_id')->toArray();\n                        $aciertos               = count(array_intersect($opciones_seleccionadas, $opciones_correctas));\n                        $fallos                 = count(array_diff($opciones_seleccionadas, $opciones_correctas));\n                        $puntaje                = (int) ($aciertos - $fallos === count($opciones_correctas));\n                    }\n                }\n\n                // Guardar el puntaje obtenido en cada pregunta\n                $this->puntaje_pregunta_oferta_laboral_repositorio->crearSiNoExiste([\n                    'pregunta_id' => $pregunta->id,\n                    'usuario_id'  => $etapa_usuario->usuario_id\n                ], [\n                    'puntaje'     => $puntaje,\n                    'puntaje_ia'  => $puntaje_ia\n                ]);\n\n                // Sumar el puntaje total\n                if (is_null($puntaje) && !is_null($puntaje_ia)) {\n                    $respuestas_correctas += $puntaje_ia;\n                } else {\n                    $respuestas_correctas += $puntaje;\n                }\n            }\n\n            $puntaje_etapa = $respuestas_correctas * $porcentaje_pregunta;\n\n            if ($etapa_usuario->vacante->automatizar_etapas) {\n                // Obtener el movimiento de la etapa con sus configuraciones\n                $etapa_movimiento = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n                    'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n                    'movimiento_vacante_id'   => MovimientoVacante::PREGUNTAS_PREFILTRO_ID,\n                    'incluir_configuraciones' => true\n                ]));\n\n                $configuracion_preguntas_correctas = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', 'descartar_candidatos_respondieron_menos_preguntas_prefiltro')->first();\n\n                // Avanzar al aplicante de etapa o descartarlo según la configuración de la etapa\n                if (!is_null($configuracion_preguntas_correctas) && $configuracion_preguntas_correctas->valor <= $respuestas_correctas) {\n                    $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje_etapa);\n                } else {\n                    $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje_etapa, descartar: true);\n                }\n            } else {\n                $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje_etapa]);\n            }\n        }\n    }\n\n    /**\n     * Guardar el puntaje de adecuación dado por el reclutador.\n     *\n     * Guarda la adecuación para las etapas de prueba técnica, videoentrevista y entrevista.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @param int $puntaje Puntaje dado por el reclutador.\n     * @param bool $forzar_actualizacion Si es true, omite la validación de puntaje nulo.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function guardarPuntajeAdecuacionReclutador(int $id, int $puntaje, bool $forzar_actualizacion = false): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        if ($etapa_usuario->activo && ($forzar_actualizacion || is_null($etapa_usuario->puntaje))) {\n            if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n                $this->gestionarContinuidadAplicante($etapa_usuario, MovimientoVacante::PRUEBA_TECNICA_ID, $puntaje, 'descartar_candidatos_adecuaciones_bajas_prueba_tecnica', 'descartar_candidatos_adecuaciones_medias_prueba_tecnica');\n            }\n\n            if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::VIDEO_ENTREVISTA_NOMBRE, EtapaVacante::ENTREVISTA_NOMBRE])) {\n                if ($etapa_usuario->etapa->nombre === EtapaVacante::VIDEO_ENTREVISTA_NOMBRE) {\n                    $movimiento_vacante_id                   = MovimientoVacante::SOLICITUD_VIDEOENTREVISTA_ID;\n                    $llave_configuracion_formato             = 'solicitar_formato_videoentrevista';\n                    $llave_configuracion_adecuaciones_bajas  = 'descartar_candidatos_adecuaciones_bajas_videoentrevista';\n                    $llave_configuracion_adecuaciones_medias = 'descartar_candidatos_adecuaciones_medias_videoentrevista';\n                } else {\n                    $movimiento_vacante_id                   = MovimientoVacante::SOLICITUD_ENTREVISTA_ID;\n                    $llave_configuracion_formato             = 'solicitar_formato_entrevista';\n                    $llave_configuracion_adecuaciones_bajas  = 'descartar_candidatos_adecuaciones_bajas_entrevista';\n                    $llave_configuracion_adecuaciones_medias = 'descartar_candidatos_adecuaciones_medias_entrevista';\n                }\n\n                if ($this->verificarFormatoEntrevista($etapa_usuario, $movimiento_vacante_id, $llave_configuracion_formato)) {\n                    $this->gestionarContinuidadAplicante($etapa_usuario, $movimiento_vacante_id, $puntaje, $llave_configuracion_adecuaciones_bajas, $llave_configuracion_adecuaciones_medias);\n                } else {\n                    $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje]);\n                }\n\n                // TODO: Invocar esta función al momento de completar el formato de entrevista\n            }\n        }\n    }\n\n    /**\n     * Generar adecuación para pruebas psicométricas.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function generarAdecuacionPruebasPsicometricas(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje)) {\n            $indice_talento = $this->proceso_repositorio->obtenerIndiceTalento($etapa_usuario->vacante->proceso->id, $etapa_usuario->usuario_id)->indice_talento;\n\n            if ($indice_talento >= 0) {\n                $this->gestionarContinuidadAplicante($etapa_usuario, MovimientoVacante::PRUEBAS_PSICOMETRICAS_ID, $indice_talento, 'descartar_candidatos_puntuaciones_bajas', 'descartar_candidatos_puntuaciones_medias', true);\n            }\n        }\n    }\n\n    /**\n     * Generar adecuación para videoentrevista.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function generarAdecuacionVideoentrevista(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::VIDEO_ENTREVISTA_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje_ia)) {\n            ProcesarVideoentrevistaIAJob::dispatch($etapa_usuario);\n        }\n    }\n\n    /**\n     * Verificar si la etapa tiene activado el formato de entrevista y si ya está diligenciado por parte del aplicante.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa del usuario en la vacante.\n     * @param int $movimiento_vacante_id ID del movimiento de la vacante.\n     * @param string $llave_configuracion Llave de configuración para formato de entrevista.\n     * @return bool Devuelve true cuando no existe la configuración, está deshabilitada o ya haya sido completada por el aplicante, false en caso de estar habilitada pero no completada por el aplicante.\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function verificarFormatoEntrevista(EtapaVacanteUsuario $etapa_usuario, int $movimiento_vacante_id, string $llave_configuracion): bool {\n        $formato_diligenciado = false;\n        $etapa_movimiento     = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n            'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n            'movimiento_vacante_id'   => $movimiento_vacante_id,\n            'incluir_configuraciones' => true\n        ]));\n\n        $configuracion_formato_entrevista = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_configuracion)->first();\n\n        if (!is_null($configuracion_formato_entrevista) && (bool) $configuracion_formato_entrevista->valor) {\n            if ($movimiento_vacante_id == MovimientoVacante::SOLICITUD_VIDEOENTREVISTA_ID) {\n                $formato_entrevista = $this->formato_entrevista_repositorio->getUnoAvanzado(new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id]));\n\n                if (!is_null($formato_entrevista) && !is_null($formato_entrevista->descripcion_vacante) && !empty($formato_entrevista->descripcion_vacante)) {\n                    $formato_diligenciado = true;\n                }\n            } else {\n                $formato_diligenciado = $this->verificarEtapaCompletada($etapa_usuario->id);\n            }\n        } else {\n            $formato_diligenciado = true;\n        }\n\n        return $formato_diligenciado;\n    }\n\n    /**\n     * Recalcular adecuación para preguntas prefiltro sin utilizar IA.\n     *\n     * @param int $etapa_vacante_id ID de la etapa de la vacante.\n     * @param int $usuario_id ID del usuario (aplicante).\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function recalcularAdecuacionPrefiltro(int $etapa_vacante_id, int $usuario_id): void {\n        $etapa_usuario = $this->repositorio->getUnoAvanzado(new Request([\n            'etapa_vacante_id' => $etapa_vacante_id,\n            'usuario_id'       => $usuario_id\n        ]));\n\n        if ($etapa_usuario->activo) {\n            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n                'etapa_vacante_id' => $etapa_usuario->etapa_vacante_id,\n                'usuario_id'       => $etapa_usuario->usuario_id,\n                'incluir_puntajes' => true\n            ]));\n\n            $puntaje            = 0;\n            $puntaje_individual = 100 / $preguntas->count();\n\n            foreach ($preguntas as $pregunta) {\n                if (is_null($pregunta->puntajes[0]->puntaje) && !is_null($pregunta->puntajes[0]->puntaje_ia)) {\n                    $puntaje += $pregunta->puntajes[0]->puntaje_ia;\n                } elseif (!is_null($pregunta->puntajes[0]->puntaje)) {\n                    $puntaje += $pregunta->puntajes[0]->puntaje;\n                }\n            }\n\n            $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje_individual * $puntaje]);\n        }\n    }\n\n    /**\n     * Guardar el puntaje de la etapa actual y gestionar la continuidad del aplicante en la vacante.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param int $movimiento_vacante_id ID del movimiento de la vacante.\n     * @param int $puntaje Puntaje obtenido en la etapa actual.\n     * @param string $llave_puntajes_bajos Llave de configuración para puntajes bajos.\n     * @param string $llave_puntajes_medios Llave de configuración para puntajes medios.\n     * @param bool $escala_pruebas_psicometricas Indica si debe utilizar la escala de puntajes de pruebas psicométricas.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function gestionarContinuidadAplicante(EtapaVacanteUsuario $etapa_usuario, int $movimiento_vacante_id, int $puntaje, string $llave_puntajes_bajos, string $llave_puntajes_medios, bool $escala_pruebas_psicometricas = false) {\n        if ($etapa_usuario->vacante->automatizar_etapas) {\n            $calificacion_baja  = 40;\n            $calificacion_media = 70;\n\n            if ($escala_pruebas_psicometricas) {\n                $calificacion_baja  = 59;\n                $calificacion_media = 75;\n            }\n\n            // Obtener el movimiento de la etapa con sus configuraciones\n            $etapa_movimiento = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n                'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n                'movimiento_vacante_id'   => $movimiento_vacante_id,\n                'incluir_configuraciones' => true\n            ]));\n\n            $configuracion_adecuaciones_bajas  = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_bajos)->first();\n            $configuracion_adecuaciones_medias = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_medios)->first();\n\n            if (!is_null($configuracion_adecuaciones_medias) && filter_var($configuracion_adecuaciones_medias->valor, FILTER_VALIDATE_BOOLEAN) && $puntaje <= $calificacion_media) {\n                $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje, descartar: true);\n                return;\n            } elseif (!is_null($configuracion_adecuaciones_bajas) && filter_var($configuracion_adecuaciones_bajas->valor, FILTER_VALIDATE_BOOLEAN) && $puntaje <= $calificacion_baja) {\n                $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje, descartar: true);\n                return;\n            }\n\n            $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje);\n        } else {\n            $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje]);\n        }\n    }\n\n    /**\n     * Guardar puntaje de la etapa actual y mover al aplicante a la siguiente etapa.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param ?int $puntaje Puntaje obtenido en la etapa actual.\n     * @param ?int $puntaje_ia Puntaje obtenido por la IA en la etapa actual.\n     * @param ?string $notas_ia Notas dadas por la IA para la etapa actual.\n     * @param bool $descartar Indica si la etapa a la que se debe cambiar es 'descartados'.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     * @author Esperanza Olivo\n     */\n    public function guardarPuntajeYCambiarDeEtapa(EtapaVacanteUsuario $etapa_usuario, ?int $puntaje = null, ?int $puntaje_ia = null, ?string $notas_ia = null, bool $descartar = false): void {\n        if ($descartar) {\n            $etapa_siguiente = $this->etapa_vacante_repositorio->getUnoAvanzado(new Request(['vacante_id' => $etapa_usuario->vacante->id, 'nombre' => EtapaVacante::DESCARTADOS_NOMBRE]));\n        } else {\n            $etapa_siguiente = $this->etapa_vacante_repositorio->obtenerEtapaSiguiente($etapa_usuario->vacante->id, $etapa_usuario->etapa->orden);\n        }\n\n        $etapa_actual_activa = true;\n\n        if ($etapa_siguiente->nombre !== EtapaVacante::CONTRATADOS_NOMBRE) {\n            $etapa_actual_activa = false;\n            $this->guardarEtapa($etapa_usuario, $etapa_siguiente);\n        } elseif (!$etapa_usuario->vacante->automatizar_etapas) {\n            $etapa_actual_activa = false;\n            $this->guardarEtapa($etapa_usuario, $etapa_siguiente);\n        }\n\n        $this->repositorio->actualizar($etapa_usuario->id, [\n            'puntaje'    => $puntaje,\n            'puntaje_ia' => $puntaje_ia,\n            'notas_ia'   => $notas_ia,\n            'activo'     => $etapa_actual_activa\n        ]);\n\n        // Cuando la etapa es contratado, se valida si ya se han completado las vacantes requeridas para cerrar la vacante\n        if ($etapa_siguiente->nombre === EtapaVacante::CONTRATADOS_NOMBRE) {\n            if ($etapa_usuario->vacante->cantidad_vacantes === $this->repositorio->contarContratados($etapa_usuario->etapa->vacante_id)) {\n                $this->vacante_repositorio->actualizar($etapa_usuario->etapa->vacante_id, ['estado_id' => EstadoVacante::COMPLETADA_ID]);\n\n                $aplicantes_activos_restantes_ids = $this->repositorio->getTodo(new Request([\n                    'vacante_id'             => $etapa_usuario->etapa->vacante_id,\n                    'activo'                 => true,\n                    'excluir_etapas'         => [EtapaVacante::DESCARTADOS_NOMBRE, EtapaVacante::CONTRATADOS_NOMBRE]\n                ]))->pluck('id')->toArray();\n\n                // Descartar a los aplicantes que quedan activos en la vacante\n                $this->descartarAplicantesManual($aplicantes_activos_restantes_ids);\n\n                $aplicantes_activos_sin_notificar = $this->repositorio->getTodo(new Request([\n                    'vacante_id'             => $etapa_usuario->etapa->vacante_id,\n                    'activo'                 => true,\n                    'sin_fecha_notificacion' => true\n                ]));\n\n                foreach ($aplicantes_activos_sin_notificar as $aplicante) {\n                    $this->notificarCambioEtapa($aplicante, false);\n                }\n            }\n        }\n    }\n    \n    /**\n     * Crear y activar la siguiente etapa del aplicante.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param EtapaVacante $etapa_siguiente Etapa siguiente a crear.\n     * @return ?EtapaVacanteUsuario\n     * @author Esperanza Olivo\n     */\n    public function guardarEtapa(EtapaVacanteUsuario $etapa_usuario, EtapaVacante $etapa_siguiente): ?EtapaVacanteUsuario {\n        $nueva_etapa_usuario = $this->repositorio->crear([\n            'usuario_id'       => $etapa_usuario->usuario_id,\n            'etapa_vacante_id' => $etapa_siguiente->id,\n            'activo'           => true\n        ]);\n\n        app(VacanteService::class)->crearAgendasPruebasPsicometricas($etapa_usuario, $etapa_siguiente->id);\n\n        if ($nueva_etapa_usuario) {\n            $this->notificarCambioEtapa($nueva_etapa_usuario);\n        }\n\n        return $nueva_etapa_usuario;\n    }\n\n    /**\n     * Obtener la adecuación actual del usuario en la vacante.\n     *\n     * @param int $usuario_id ID del usuario.\n     * @param int $vacante_id ID de la vacante.\n     * @return ?int\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function obtenerAdecuacionUsuario(int $usuario_id, int $vacante_id): ?int {\n        $etapas     = $this->repositorio->obtenerEtapasCompletadasUsuario($usuario_id, $vacante_id);\n        $adecuacion = 0;\n\n        foreach ($etapas as $etapa) {\n            if (!is_null($etapa->puntaje)) {\n                $adecuacion += $etapa->puntaje;\n            } elseif (is_null($etapa->puntaje) && !is_null($etapa->puntaje_ia)) {\n                $adecuacion += $etapa->puntaje_ia;\n            }\n        }\n\n        return ($etapas->count() > 0) ? $adecuacion / $etapas->count() : null;\n    }\n\n    /**\n     * Verificar si una etapa ya ha sido completada por el aplicante.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante (etapa_vacante_usuario_id).\n     * @return bool\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function verificarEtapaCompletada(int $id): bool {\n        $etapa_usuario    = $this->repositorio->getUno($id);\n        $etapa_completada = false;\n\n        // Verificar si la etapa de revisión de hoja de vida ya fue completada\n        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::REVISION_HV_NOMBRE, EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE]) && !is_null($etapa_usuario->puntaje) || !is_null($etapa_usuario->puntaje_ia)) {\n            $etapa_completada = true;\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::ENTREVISTA_NOMBRE) {\n            if ($this->configuracion_modelo_servicio->obtenerValorLlaveConfiguracion(app(VacanteService::class)->obtenerConfiguracionesEtapaAplicante($etapa_usuario->etapa_vacante_id), 'solicitar_formato_entrevista')) {\n                $formato_entrevista = $this->formato_entrevista_repositorio->getUnoAvanzado(new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id]));\n\n                if (!is_null($formato_entrevista) && !is_null($formato_entrevista->descripcion_vacante) && !empty($formato_entrevista->descripcion_vacante)) {\n                    $etapa_completada = true;\n                }\n            } else {\n                $etapa_completada = true;\n            }\n        }\n\n        // Verificar si las etapas de preguntas prefiltro o videoentrevista ya han sido completadas\n        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE])) {\n            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n                'etapa_vacante_id'                      => $etapa_usuario->etapa_vacante_id,\n                'usuario_id'                            => $etapa_usuario->usuario_id,\n                'incluir_cantidad_respuestas_aplicante' => true\n            ]));\n\n            $preguntas_contestadas = 0;\n\n            foreach ($preguntas as $pregunta) {\n                if ($pregunta['respuestas_count'] > 0) {\n                    $preguntas_contestadas++;\n                }\n            }\n\n            // Validar que todas las preguntas hayan sido contestadas\n            if (count($preguntas) === $preguntas_contestadas) {\n                $etapa_completada = true;\n            }\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n            if ((!is_null($etapa_usuario->pruebaTecnica?->enlace) && !empty($etapa_usuario->pruebaTecnica?->enlace) || $etapa_usuario->pruebaTecnica?->archivos->count() > 0) && $etapa_usuario->pruebaTecnica?->borrador == false) {\n                $etapa_completada = true;\n            }\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n                $etapa_usuario->etapa_vacante_id,\n                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n            );\n\n            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n\n            $todos_cargados = true;\n            foreach ($documentos_solicitados as $documento) {\n                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n\n                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n                    $todos_cargados = false;\n                    break;\n                }\n            }\n\n            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }\n        }\n\n        return $etapa_completada;\n    }\n\n    /**\n     * Notificar documentos solicitados.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Jair Carvajal\n     * @author Daniel Beltrán\n     */\n    public function notificarDocumentosSolicitados(int $id): void {\n        $etapa_vacante_usuario = $this->repositorio->getUno($id);\n\n        if ($etapa_vacante_usuario) {\n            $this->enviarCorreoFinalizacionEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->vacante);\n        }\n    }\n\n    /**\n     * Descartar uno o varios aplicantes manualmente y moverlos a la etapa de descartados.\n     *\n     * @param array $ids IDs de las etapas de usuarios en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Daniel Beltrán\n     */\n    public function descartarAplicantesManual(array $ids): void {\n        foreach ($ids as $id) {\n            $etapa_vacante_usuario = $this->repositorio->getUno($id);\n\n            if ($etapa_vacante_usuario) {\n                $this->guardarPuntajeYCambiarDeEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->puntaje ?? 0, descartar: true);\n            }\n        }\n    }\n\n    /**\n     * Revertir descarte de aplicantes.\n     *\n     * @param array $ids IDs de las etapas de los usuarios descartados en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     */\n    public function revertirDescarteAplicantes(array $ids): void {\n        foreach ($ids as $id) {\n            $etapa_descartado = $this->repositorio->getUno($id);\n\n            if ($etapa_descartado && $etapa_descartado->etapa->nombre === EtapaVacante::DESCARTADOS_NOMBRE && $etapa_descartado->activo) {\n                $etapas_no_descartados = $this->etapa_vacante_repositorio->getTodo(new Request(['vacante_id' => $etapa_descartado->vacante->id]))->where('nombre', '!=', EtapaVacante::DESCARTADOS_NOMBRE);\n                $etapas_ids            = $etapas_no_descartados->pluck('id')->toArray();\n                $etapa_previa          = $this->repositorio->obtenerEtapaPrevia($etapa_descartado->usuario_id, $etapas_ids);\n\n                if ($etapa_previa) {\n                    $this->repositorio->eliminar($etapa_descartado->id);\n                    $this->repositorio->actualizar($etapa_previa->id, ['activo' => true]);\n                }\n            }\n        }\n    }\n\n    /**\n     * Mover manualmente al aplicante a la siguiente etapa.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Daniel Beltrán\n     */\n    public function moverAplicanteEtapaManual(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n        $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $etapa_usuario->puntaje ?? 0);\n    }\n\n    /**\n     * Marcar la vacante como abandonada por el aplicante.\n     *\n     * @param Request $request Contenido de la petición.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Daniel Beltrán\n     */\n    public function abandonarVacante(Request $request): void {\n        $etapas_no_descartados = $this->etapa_vacante_repositorio->getTodo(new Request(['vacante_id' => $request->vacante_id]))->where('nombre', '!=', EtapaVacante::DESCARTADOS_NOMBRE);\n        $etapas_ids            = $etapas_no_descartados->pluck('id')->toArray();\n        $etapa_vacante_usuario = $this->repositorio->obtenerEtapaPrevia($request->usuario_id, $etapas_ids);\n\n        if ($etapa_vacante_usuario) {\n            $this->repositorio->actualizar($etapa_vacante_usuario->id, ['motivo_abandono' => $request->motivo_abandono]);\n            $this->guardarPuntajeYCambiarDeEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->puntaje ?? 0, descartar: true);\n        }\n    }\n\n    /**\n     * Notificar al aplicante sobre el cambio de etapa.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param bool $aplicar_validacion_fin_proceso Indica si se debe aplicar la validación de fin de proceso.\n     * @return void\n     * @author Andres Gonzalez\n     */\n    public function notificarCambioEtapa(EtapaVacanteUsuario $etapa_usuario, bool $aplicar_validacion_fin_proceso = true): void {\n        $etapa_usuario->load(['etapa', 'vacante', 'usuario']);\n        $etapa = $etapa_usuario->etapa;\n\n        if ($etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n            $configuraciones_prueba_tecnica = app(EtapaVacanteService::class)->obtenerConfiguracionesPruebaTecnica($etapa->id);\n\n            if (!($configuraciones_prueba_tecnica['prueba_cargada'] ?? false)) {\n                return;\n            }\n        }\n\n        $plantilla_correo_id = [\n            EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE     => PlantillaCorreo::PREGUNTAS_PRE_FILTRO_ID,\n            EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE   => PlantillaCorreo::PRUEBAS_PSICOMETRICAS_ID,\n            EtapaVacante::PRUEBA_TECNICA_NOMBRE          => PlantillaCorreo::ENVIO_PRUEBA_TECNICA_ID,\n            EtapaVacante::VIDEO_ENTREVISTA_NOMBRE        => PlantillaCorreo::SOLICITUD_VIDEOENTREVISTAS_ID,\n            EtapaVacante::ENTREVISTA_NOMBRE              => PlantillaCorreo::NOTIFICACION_ENTREVISTA_ID,\n            EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE => PlantillaCorreo::SOLICITUD_DOCUMENTOS_ID,\n            EtapaVacante::CONTRATADOS_NOMBRE             => PlantillaCorreo::NOTIFICACION_CONTRATADOS_ID,\n            EtapaVacante::DESCARTADOS_NOMBRE             => PlantillaCorreo::NOTIFICACION_DESCARTADOS_ID\n        ][$etapa->nombre] ?? null;\n\n        if (isset($plantilla_correo_id)) {\n            $plantilla_correo_etapa = $this->plantilla_correo_servicio->obtenerUno(new Request([\n                'plantilla_correo_id' => $plantilla_correo_id,\n                'empresa_id'          => $etapa_usuario->vacante->empresa_id\n            ]));\n\n            if (!is_null($plantilla_correo_etapa)) {\n                $es_etapa_fin_proceso = in_array($etapa->nombre, [\n                    EtapaVacante::CONTRATADOS_NOMBRE,\n                    EtapaVacante::DESCARTADOS_NOMBRE\n                ]);\n\n                // Si es etapa de fin de proceso y notificar_fin_proceso es true, no enviar notificación\n                if ($aplicar_validacion_fin_proceso && $es_etapa_fin_proceso && $plantilla_correo_etapa->notificar_fin_proceso) {\n                    return;\n                }\n\n                $usuario            = $etapa_usuario->usuario;\n                $vacante            = $etapa_usuario->vacante;\n                $token_acceso       = $this->token_acceso_servicio->generar($usuario->id);\n                $enlace             = request()->getSchemeAndHttpHost() . \"/control-acceso/{$token_acceso->token}?vacante_id={$vacante->id}\";\n                $usuario_informador = null;\n\n                if ($etapa->nombre !== EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE) {\n                    Mail::to($usuario->email)->queue(new NotificarPostulanteVacanteMail(\n                        $usuario,\n                        $enlace,\n                        $vacante,\n                        $plantilla_correo_etapa->titulo,\n                        $plantilla_correo_etapa->contenido,\n                        $plantilla_correo_etapa->con_logo_empresa,\n                        $etapa->nombre,\n                        $usuario_informador\n                    ));\n                }\n\n                // Enviar notificación de avance en el proceso\n                $usuario->notify(new NotificarAvanceProcesoNotification(\n                    $vacante->id,\n                    $vacante->nombre_vacante,\n                    $etapa->nombre,\n                    $vacante->empresa->nombre ?? 'la empresa'\n                ));\n\n                $this->repositorio->actualizar($etapa_usuario->id, ['fecha_notificacion' => now()]);\n            }\n        }\n    }\n\n    /**\n     * Enviar correo de notificación al finalizar una etapa.\n     *\n     * @param EtapaVacanteUsuario $etapa_vacante_usuario Etapa del usuario en la vacante.\n     * @param Vacante $vacante Vacante.\n     * @return void\n     * @author Jair Carvajal\n     */\n    private function enviarCorreoFinalizacionEtapa(EtapaVacanteUsuario $etapa_vacante_usuario, Vacante $vacante): void {\n        $usuario     = Auth::user();\n        $maneja_logo = file_exists(public_path('empresas-logo/' . $vacante->empresa->id)) ? '1' : null;\n\n        Mail::send(new NotificarFinalizacionEtapaMail(\n            $usuario,\n            $vacante,\n            $etapa_vacante_usuario->etapa,\n            $maneja_logo\n        ));\n    }\n\n    /**\n     * Obtener candidatos recomendados con IA.\n     *\n     * Obtiene los 3 mejores candidatos para la vacante, entre varios candidatos seleccionados por el reclutador.\n     *\n     * @param Request $request Contenido de la petición.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function obtenerCandidatosRecomendadosIA(Request $request): array {\n        $vacante       = $this->vacante_repositorio->getUno($request->vacante_id);\n        $candidatos    = $this->usuario_repositorio->obtenerCandidatosSeleccionadosVacante($request->usuarios_ids, $request->vacante_id);\n        $candidatos_ia = [];\n        $vacante_ia    = [\n            ...Arr::only($vacante->toArray(), ['nombre_vacante', 'salario', 'salario_maximo']),\n            'habilidades'               => $vacante->datos->first(fn($item) => $item->llave === 'habilidades')->valor,\n            'herramientas_tecnologicas' => $vacante->datos->first(fn($item) => $item->llave === 'herramientas_tecnologicas')->valor,\n            'experiencia_laboral'       => $vacante->datos->first(fn($item) => $item->llave === 'experiencia_laboral')->valor,\n            'nivel_educativo'           => $vacante->datos->first(fn($item) => $item->llave === 'nivel_educativo')->valor\n        ];\n\n        if (!is_null($vacante->ciudad_id)) {\n            $direccion_trabajo = $vacante->datos->first(fn($item) => $item->llave === 'direccion_trabajo')->valor;\n            $ubicacion_empresa = \"{$vacante->ciudad->departamento->pais->nombre}, {$vacante->ciudad->departamento->nombre} - {$vacante->ciudad->nombre}, {$direccion_trabajo}\";\n        } elseif (!is_null($vacante->empresa->ciudad_id)) {\n            $ubicacion_empresa = \"{$vacante->empresa->ciudad->departamento->pais->nombre}, {$vacante->empresa->ciudad->departamento->nombre} - {$vacante->empresa->ciudad->nombre}, {$vacante->empresa->direccion}\";\n        }\n\n        if (isset($ubicacion_empresa)) {\n            $vacante_ia['ubicacion'] = $ubicacion_empresa;\n        }\n\n        foreach ($candidatos as $candidato) {\n            if (!is_null($candidato->ciudad_id) && !is_null($candidato->direccion)) {\n                $ubicacion = \"{$candidato->ciudad->departamento->pais->nombre}, {$candidato->ciudad->departamento->nombre} - {$candidato->ciudad->nombre}, {$candidato->direccion}\";\n            }\n\n            $usuario = [\n                ...Arr::only($candidato->toArray(), ['id', 'nombre_completo', 'email', 'telefono', 'edad']),\n                'adecuacion' => $this->obtenerAdecuacionUsuario($candidato->id, $request->vacante_id)\n            ];\n\n            if (isset($ubicacion)) {\n                $usuario['ubicacion'] = $ubicacion;\n            }\n\n            if (!is_null($candidato->perfilLaboral)) {\n                $usuario['salario']                   = $candidato->perfilLaboral->salario;\n                $usuario['salario_maximo']            = $candidato->perfilLaboral->salario_maximo;\n                $usuario['habilidades']               = $candidato->perfilLaboral->habilidades;\n                $usuario['herramientas_tecnologicas'] = $candidato->perfilLaboral->herramientas_tecnologicas;\n                $usuario['estudios']                  = [];\n                $usuario['experiencias_laborales']    = [];\n                $usuario['idiomas']                   = [];\n                $usuario['etapas']                    = [];\n\n                foreach ($candidato->perfilLaboral->estudios as $item) {\n                    array_push($usuario['estudios'], [\n                        ...Arr::only($item->toArray(), ['titulo', 'fecha_inicio', 'fecha_fin']),\n                        'nivel_educativo' => $item->nivelEducativo->nombre,\n                    ]);\n                }\n\n                foreach ($candidato->perfilLaboral->experienciasLaborales as $item) {\n                    array_push($usuario['experiencias_laborales'], [...Arr::only($item->toArray(), ['empresa', 'cargo', 'fecha_inicio', 'fecha_fin', 'tiempo'])]);\n                }\n\n                foreach ($candidato->perfilLaboral->idiomas as $item) {\n                    array_push($usuario['idiomas'], [\n                        'idioma' => $item->idioma->nombre,\n                        'nivel'  => $item->nivel\n                    ]);\n                }\n\n                foreach ($candidato->etapasUsuarios as $item) {\n                    $datos_etapas = [\n                        'nombre'      => $item->etapa->nombre,\n                        'puntaje'     => $item->puntaje,\n                        'puntaje_ia'  => $item->puntaje_ia,\n                        'comentarios' => $item->comentarios->pluck('comentario')->values()->toArray()\n                    ];\n\n                    if ($item->etapa->nombre === EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE) {\n                        $agendas = $this->agenda_repositorio->getTodo(new Request([\n                            'proceso_id'         => $vacante->proceso->id,\n                            'evaluado_id'        => $item->usuario_id,\n                            'estado_id'          => EstadoAgenda::FINALIZADA_ID,\n                            'incluir_resultados' => true\n                        ]));\n\n                        $datos_etapas['pruebas_psicometricas'] = [];\n\n                        foreach ($agendas as $agenda) {\n                            array_push($datos_etapas['pruebas_psicometricas'], [\n                                'prueba'     => $agenda->prueba->nombre,\n                                'ajuste'     => $agenda->ajuste,\n                                'resultados' => $agenda->resultados->map(function ($resultado) {\n                                    return [\n                                        'dimension' => $resultado->dimension->nombre,\n                                        'puntaje'   => $resultado->puntaje_transformado\n                                    ];\n                                })->values()->toArray()\n                            ]);\n                        }\n\n                        if (count($datos_etapas['pruebas_psicometricas']) === 0) {\n                            unset($datos_etapas['pruebas_psicometricas']);\n                        }\n                    }\n\n                    array_push($usuario['etapas'], $datos_etapas);\n                }\n            }\n\n            array_push($candidatos_ia, $usuario);\n        }\n\n        return $this->realizarPeticionIA('obtener-candidatos-recomendados', [\n            'vacante_id' => $request->vacante_id,\n            'vacante'    => json_encode($vacante_ia, JSON_UNESCAPED_UNICODE),\n            'candidatos' => json_encode($candidatos_ia, JSON_UNESCAPED_UNICODE)\n        ]);\n    }\n\n    /**\n     * Obtener competencias por mejorar para usuario que será contratado.\n     * SOLO Buscar agendas de TenDisc Plus (12) y Potencial Comercial (7)\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return array\n     * @author Sergio Vargas\n     */\n    public function obtenerCompetenciasPorMejorar(int $id): array {\n        $etapa_vacante_usuario = $this->repositorio->getUno($id);\n        $usuario_id = $etapa_vacante_usuario->usuario_id;\n        $proceso = $etapa_vacante_usuario->vacante->proceso;\n\n        if (is_null($proceso)) {\n            return [\n                'usuario_id' => $usuario_id,\n                'pruebas' => []\n            ];\n        }\n\n        $agendas = $this->agenda_repositorio->getTodo(new Request([\n            'proceso_id' => $proceso->id,\n            'evaluado_id' => $usuario_id,\n            'pruebas_ids' => [12, 7],\n            'estado_id' => 3,\n            'con_evaluado' => true\n        ]));\n\n        $resultado = [\n            'usuario_id' => $usuario_id,\n            'pruebas' => []\n        ];\n\n        foreach ($agendas as $agenda) {\n            $competencias_bajas = $this->extraerCompetenciasBajas($agenda);\n\n            if (!empty($competencias_bajas)) {\n                $resultado['pruebas'][] = [\n                    'prueba_id' => $agenda->prueba_id,\n                    'nombre_prueba' => $agenda->prueba->nombre,\n                    'competencias' => $competencias_bajas\n                ];\n            }\n        }\n\n        return $resultado;\n    }\n\n    /**\n     * Extraer las 2 competencias más bajas de una agenda según su prueba.\n     *\n     * @param \\App\\Models\\Agendas\\Agenda $agenda Agenda finalizada.\n     * @return array\n     * @author Sergio Vargas\n     */\n    private function extraerCompetenciasBajas($agenda): array {\n        $resultados = $this->resultado_agenda_servicio->gestionarResultados($agenda);\n\n        if (empty($resultados)) {\n            return [];\n        }\n\n        $competencias_todas = [];\n\n        // TenDisc Plus (prueba_id = 12)\n        if ($agenda->prueba_id === 12) {\n            $factor_especificas = collect($resultados)->firstWhere('nombre', 'Competencias Específicas');\n            $factor_transversales = collect($resultados)->firstWhere('nombre', 'Competencias Transversales');\n\n            if ($factor_especificas) {\n                $competencias_todas = array_merge($competencias_todas, $factor_especificas['dimensiones']);\n            }\n            if ($factor_transversales) {\n                $competencias_todas = array_merge($competencias_todas, $factor_transversales['dimensiones']);\n            }\n        }\n\n        // Potencial Comercial (prueba_id = 7)\n        if ($agenda->prueba_id === 7) {\n            $factor_caracter = collect($resultados)->firstWhere('nombre', 'Carácter');\n            $factor_habilidades = collect($resultados)->firstWhere('nombre', 'Habilidades');\n\n            if ($factor_caracter) {\n                $competencias_todas = array_merge($competencias_todas, $factor_caracter['dimensiones']);\n            }\n            if ($factor_habilidades) {\n                $competencias_todas = array_merge($competencias_todas, $factor_habilidades['dimensiones']);\n            }\n        }\n\n        // Ordenar por puntaje ascendente y tomar las 2 más bajas\n        return collect($competencias_todas)\n            ->sortBy('puntaje_transformado')\n            ->take(2)\n            ->map(fn($c) => [\n                'nombre' => $c['nombre'],\n                'puntaje' => round($c['puntaje_transformado'], 0)\n            ])\n            ->values()\n            ->toArray();\n    }\n}\n","structuredPatch":[{"oldStart":919,"oldLines":7,"newStart":919,"newLines":7,"lines":["                 }","             }"," ","-            if ($todos_cargados && $documentos_solicitados->count() > 0) {","+            if ($todos_cargados && $documentos_solicitados->count() > 0 && !is_null($etapa_usuario->fecha_ejecucion)) {","                 $etapa_completada = true;","             }","         }"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"f639bb60-1741-476d-a659-4f184fd881bf"}
{"parentUuid":"92e87960-fc12-4825-aff4-dda97afdc293","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01572eJP31cZZPFno1F3MAas","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora la etapa de **Documentos de Contratación** se marca como completada solo cuando:\n\n1. ✅ Todos los documentos solicitados han sido cargados\n2. ✅ Hay al menos un documento solicitado\n3. ✅ El campo `fecha_ejecucion` no es nulo"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":433,"cache_read_input_tokens":29348,"cache_creation":{"ephemeral_5m_input_tokens":433,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKMGTNSMu21o1mwn3eHA","type":"assistant","uuid":"de33010f-5008-4d07-88ad-a3b53277ca04","timestamp":"2026-01-20T21:36:15.108Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-20T22:16:06.375Z","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d"}
{"type":"file-history-snapshot","messageId":"487a62b7-ad70-4660-b6ec-be274f97256b","snapshot":{"messageId":"487a62b7-ad70-4660-b6ec-be274f97256b","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"}},"timestamp":"2026-01-20T22:16:06.488Z"},"isSnapshotUpdate":false}
{"parentUuid":"21817c27-b01b-4e01-8a1b-b8c6c8ed29c7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01A7FBAGCUhRM9Mqieg29Ndy","parentToolUseID":"toolu_01A7FBAGCUhRM9Mqieg29Ndy","uuid":"69c4195c-6d60-41a2-88bc-73c93b67434d","timestamp":"2026-01-20T21:34:25.860Z"}
{"parentUuid":"f639bb60-1741-476d-a659-4f184fd881bf","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_017H7b1DtMMoMyjCsnzQVLmz","parentToolUseID":"toolu_017H7b1DtMMoMyjCsnzQVLmz","uuid":"f0909ed1-4801-4e07-bfb9-55f25d9d4306","timestamp":"2026-01-20T21:34:31.127Z"}
{"parentUuid":"f0909ed1-4801-4e07-bfb9-55f25d9d4306","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_017H7b1DtMMoMyjCsnzQVLmz","parentToolUseID":"toolu_017H7b1DtMMoMyjCsnzQVLmz","uuid":"be66f05d-a8ac-4a26-aef0-6b13f94282bb","timestamp":"2026-01-20T21:34:31.127Z"}
{"parentUuid":"92e87960-fc12-4825-aff4-dda97afdc293","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_017H7b1DtMMoMyjCsnzQVLmz","toolUseID":"toolu_017H7b1DtMMoMyjCsnzQVLmz","timestamp":"2026-01-20T21:36:09.029Z","uuid":"0e6c465a-5bfb-4004-b5d4-86f055625fbb"}
{"parentUuid":"de33010f-5008-4d07-88ad-a3b53277ca04","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 2401 to 2401 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"analiza esta funcion function mostrarResultadoDocumentosContratacion(etapa) {"}]},"uuid":"487a62b7-ad70-4660-b6ec-be274f97256b","timestamp":"2026-01-20T22:16:06.486Z"}
{"parentUuid":"487a62b7-ad70-4660-b6ec-be274f97256b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UapyJstMivNGiXfCj2iMRe","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a leer la función completa para analizarla."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":29982,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":29982,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXKQJzuQLrdXffaFuftpd","type":"assistant","uuid":"f71d3db4-a87e-45ea-b7cf-dbc8f199fda3","timestamp":"2026-01-20T22:16:09.243Z"}
{"parentUuid":"f71d3db4-a87e-45ea-b7cf-dbc8f199fda3","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UapyJstMivNGiXfCj2iMRe","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AQ269F3pJcDyFkZbKaB2h7","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2398,"limit":120}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":29982,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":29982,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXKQJzuQLrdXffaFuftpd","type":"assistant","uuid":"d1d6a1ea-6a21-430e-aef3-40ae6a212412","timestamp":"2026-01-20T22:16:10.368Z"}
{"parentUuid":"d1d6a1ea-6a21-430e-aef3-40ae6a212412","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AQ269F3pJcDyFkZbKaB2h7","type":"tool_result","content":"  2398→ * @author José Manuel Jiménez\n  2399→ * @author Andres Gonzalez\n  2400→ */\n  2401→function mostrarResultadoDocumentosContratacion(etapa) {\n  2402→    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n  2403→    $('#contenedor-archivos-contratacion').empty();\n  2404→    let documentos_contartacion = [];\n  2405→    let imagenes_cargadas = [];\n  2406→    archivos_contratacion.forEach((archivo) => {\n  2407→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2408→        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n  2409→        if (es_imagen) {\n  2410→            imagenes_cargadas.push(archivo);\n  2411→        } else {\n  2412→            documentos_contartacion.push(archivo);\n  2413→        }\n  2414→    });\n  2415→    let archivos_html = '';\n  2416→    documentos_contartacion.forEach((archivo) => {\n  2417→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2418→        let icono = obtenerIconoPorExtension(extension);\n  2419→        let url_archivo = `/archivos-abrir/${archivo.id}`;\n  2420→        archivos_html += `\n  2421→            <div class=\"col-auto archivo-item\">\n  2422→                <div class=\"col-auto px-3 border rounded-2\">\n  2423→                    <div class=\"row align-items-center\">\n  2424→                        <div class=\"col-auto py-3\">\n  2425→                            <i class=\"${icono} text-blue-40\"></i>\n  2426→                        </div>\n  2427→                        <div class=\"col px-0 py-3\">\n  2428→                            <a href=\"${url_archivo}\"\n  2429→                               target=\"_blank\"\n  2430→                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n  2431→                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n  2432→                                ${archivo.nombre_original_archivo}\n  2433→                            </a>\n  2434→                        </div>\n  2435→                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n  2436→                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n  2437→                        </a>\n  2438→                    </div>\n  2439→                </div>\n  2440→            </div>\n  2441→        `;\n  2442→    });\n  2443→    imagenes_cargadas.forEach((archivo) => {\n  2444→        let url_imagen = `/archivos-abrir/${archivo.id}`;\n  2445→        archivos_html += `\n  2446→            <div class=\"col-auto archivo-item\">\n  2447→                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n  2448→                    <div class=\"row align-items-center\">\n  2449→                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n  2450→                    </div>\n  2451→                    <div class=\"row align-items-center\">\n  2452→                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n  2453→                            ${archivo.nombre_original_archivo}\n  2454→                        </div>\n  2455→                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n  2456→                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n  2457→                        </a>\n  2458→                    </div>\n  2459→                </div>\n  2460→            </div>\n  2461→        `;\n  2462→    });\n  2463→    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {\n  2464→        $('#contenedor-cantidad-adjuntos').empty();\n  2465→        return `\n  2466→            <div class=\"col-12\">\n  2467→                <div class=\"row justify-content-center my-14\">\n  2468→                    <div class=\"col-auto\">\n  2469→                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n  2470→                    </div>\n  2471→                    <div class=\"col-12 text-center text-headline-5\">\n  2472→                        Este candidato aún no ha adjuntado los documentos para contratación\n  2473→                    </div>\n  2474→                    ${etapa.id != null ? `\n  2475→                        <div class=\"col-auto mt-10\">\n  2476→                            ${crearBoton({\n  2477→                                clases: 'btn-outline-primary',\n  2478→                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2479→                                onclick: \"$('#documentos_contratacion').click();\"\n  2480→                            })}\n  2481→                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n  2482→                        </div>\n  2483→                    ` : ''}\n  2484→                </div>\n  2485→            </div>\n  2486→        `;\n  2487→    } else {\n  2488→        setTimeout(() => {\n  2489→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2490→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2491→            );\n  2492→            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2493→        }, 100);\n  2494→        return `\n  2495→            <div class=\"col-12\">\n  2496→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n  2497→                    <div class=\"col-12\">\n  2498→                        <div class=\"row justify-content-between align-items-center mb-4\">\n  2499→                            <div class=\"col-auto text-body-2 text-gray-10\">\n  2500→                                Archivos adjuntos\n  2501→                            </div>\n  2502→                            <div class=\"col-auto\">\n  2503→                                ${crearBoton({\n  2504→                                    clases: 'btn-outline-primary',\n  2505→                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2506→                                    onclick: `$('#documentos_contratacion').click();`\n  2507→                                })}\n  2508→                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n  2509→                            </div>\n  2510→                        </div>\n  2511→                    </div>\n  2512→                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n  2513→                </div>\n  2514→            </div>\n  2515→        `;\n  2516→    }\n  2517→}\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"00c38602-0f9c-4b57-a91a-6876b8ea56bc","timestamp":"2026-01-20T22:16:12.759Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":" * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}","numLines":120,"startLine":2398,"totalLines":2691}},"sourceToolAssistantUUID":"d1d6a1ea-6a21-430e-aef3-40ae6a212412"}
{"parentUuid":"00c38602-0f9c-4b57-a91a-6876b8ea56bc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Uo4CiMARLcg2bbHTAC3wYV","type":"message","role":"assistant","content":[{"type":"text","text":"## Análisis de `mostrarResultadoDocumentosContratacion`\n\nEsta función genera el HTML para mostrar los documentos de contratación cargados por un candidato en una etapa del proceso de selección.\n\n### Flujo de la función\n\n```\n1. Obtener archivos → 2. Separar por tipo → 3. Generar HTML → 4. Retornar vista\n```\n\n### Estructura detallada\n\n| Paso | Descripción |\n|------|-------------|\n| **Línea 2402** | Obtiene los archivos guardados del objeto `etapa` |\n| **Líneas 2406-2414** | Separa archivos en dos arrays: `imagenes_cargadas` y `documentos_contartacion` (nota: typo en el nombre) |\n| **Líneas 2416-2442** | Genera HTML para documentos (PDF, DOC, XLS, etc.) con icono y enlace de descarga |\n| **Líneas 2443-2462** | Genera HTML para imágenes con previsualización y descarga |\n| **Líneas 2463-2486** | Si no hay archivos ni puntaje: muestra estado vacío con botón para adjuntar |\n| **Líneas 2487-2516** | Si hay archivos: muestra la lista con contador de adjuntos |\n\n### Observaciones\n\n1. **Typo en variable**: `documentos_contartacion` debería ser `documentos_contratacion` (línea 2404)\n\n2. **Extensiones de imagen soportadas**: `jpg`, `jpeg`, `png`, `gif`, `webp`\n\n3. **Extensiones de documento aceptadas en input**: `pdf`, `doc`, `docx`, `xls`, `xlsx`\n\n4. **Componentes UI utilizados**:\n   - `crearTooltip()` - Para mostrar nombre completo del archivo\n   - `crearBoton()` - Botón de adjuntar archivos\n   - `crearTag()` - Tag con contador de adjuntos\n\n5. **Condición para estado vacío** (línea 2463):\n   ```javascript\n   etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0\n   ```\n\n6. **Función relacionada**: `mostrarPrevisualizacionImagen()` para ver imágenes en grande\n\n¿Necesitas que modifique algo en esta función?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2507,"cache_read_input_tokens":29982,"cache_creation":{"ephemeral_5m_input_tokens":2507,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXKQKSFtwoit9FPrQnZoN","type":"assistant","uuid":"5f6ff984-cf60-4231-8459-9b1ed76c50fd","timestamp":"2026-01-20T22:16:27.119Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-20T22:40:14.525Z","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d"}
{"type":"file-history-snapshot","messageId":"83beb323-4ea8-4b51-b704-596849a0d439","snapshot":{"messageId":"83beb323-4ea8-4b51-b704-596849a0d439","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"}},"timestamp":"2026-01-20T22:40:14.641Z"},"isSnapshotUpdate":false}
{"parentUuid":"d1d6a1ea-6a21-430e-aef3-40ae6a212412","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01AQ269F3pJcDyFkZbKaB2h7","parentToolUseID":"toolu_01AQ269F3pJcDyFkZbKaB2h7","uuid":"2a53006a-e97f-46bc-b307-7628dce1392a","timestamp":"2026-01-20T22:16:11.681Z"}
{"parentUuid":"5f6ff984-cf60-4231-8459-9b1ed76c50fd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 2472 to 2474 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\n<div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"lito y en estapa me lelga esto {\n    \"nombre_etapa\": \"Documentos para contratación\",\n    \"id\": 189,\n    \"usuario_id\": 27,\n    \"etapa_vacante_id\": 223,\n    \"puntaje\": null,\n    \"puntaje_ia\": null,\n    \"notas_ia\": null,\n    \"fecha_notificacion\": \"2026-01-20 15:53:15\",\n    \"fecha_ejecucion\": null,\n    \"motivo_abandono\": null,\n    \"activo\": 1,\n    \"archivos_solicitados\": {\n        \"documentos\": [\n            {\n                \"id\": 1,\n                \"empresa_id\": null,\n                \"nombre\": \"Cédula de ciudadanía\"\n            },\n            {\n                \"id\": 2,\n                \"empresa_id\": null,\n                \"nombre\": \"Certificados laborales\"\n            },\n            {\n                \"id\": 3,\n                \"empresa_id\": null,\n                \"nombre\": \"Diplomas de grado\"\n            },\n            {\n                \"id\": 4,\n                \"empresa_id\": null,\n                \"nombre\": \"Certificado EPS\"\n            },\n            {\n                \"id\": 5,\n                \"empresa_id\": null,\n                \"nombre\": \"Antecedentes\"\n            }\n        ],\n        \"archivos_guardados\": []\n    }\n} y quero que cuando la fecha _ejecuciuon sea null que em puetre este <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>esa sexcion pero cunato ya tenga una fecha si que lo muestre bien"}]},"uuid":"83beb323-4ea8-4b51-b704-596849a0d439","timestamp":"2026-01-20T22:40:14.639Z"}
{"parentUuid":"83beb323-4ea8-4b51-b704-596849a0d439","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_0119K5gnNFSV4SuE5ssL4JUn","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo. Necesitas que cuando `fecha_ejecucion` sea `null` muestre el mensaje de \"aún no ha adjuntado\", y cuando tenga fecha muestre los archivos correctamente."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":33657,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":33657,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXKS9kbfJ3Lm2u6K2bLXY","type":"assistant","uuid":"49fc3db1-00fd-4c80-b4f4-0d11a48334b9","timestamp":"2026-01-20T22:40:18.480Z"}
{"parentUuid":"49fc3db1-00fd-4c80-b4f4-0d11a48334b9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_0119K5gnNFSV4SuE5ssL4JUn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01L6rJtYZ88kzPJfBAjdet8R","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2460,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":33657,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":33657,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXKS9kbfJ3Lm2u6K2bLXY","type":"assistant","uuid":"84577590-a499-4ae4-a110-39f1ac8e4a60","timestamp":"2026-01-20T22:40:19.592Z"}
{"parentUuid":"84577590-a499-4ae4-a110-39f1ac8e4a60","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01L6rJtYZ88kzPJfBAjdet8R","type":"tool_result","content":"  2460→                </div>\n  2461→            </div>\n  2462→        `;\n  2463→    });\n  2464→    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {\n  2465→        $('#contenedor-cantidad-adjuntos').empty();\n  2466→        return `\n  2467→            <div class=\"col-12\">\n  2468→                <div class=\"row justify-content-center my-14\">\n  2469→                    <div class=\"col-auto\">\n  2470→                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n  2471→                    </div>\n  2472→                    <div class=\"col-12 text-center text-headline-5\">\n  2473→                        Este candidato aún no ha adjuntado los documentos para contratación\n  2474→                    </div>\n  2475→                    ${etapa.id != null ? `\n  2476→                        <div class=\"col-auto mt-10\">\n  2477→                            ${crearBoton({\n  2478→                                clases: 'btn-outline-primary',\n  2479→                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2480→                                onclick: \"$('#documentos_contratacion').click();\"\n  2481→                            })}\n  2482→                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n  2483→                        </div>\n  2484→                    ` : ''}\n  2485→                </div>\n  2486→            </div>\n  2487→        `;\n  2488→    } else {\n  2489→        setTimeout(() => {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"2dda205e-960f-45e7-99de-f7e76109e8d3","timestamp":"2026-01-20T22:40:21.906Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"                </div>\n            </div>\n        `;\n    });\n    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {","numLines":30,"startLine":2460,"totalLines":2692}},"sourceToolAssistantUUID":"84577590-a499-4ae4-a110-39f1ac8e4a60"}
{"parentUuid":"2dda205e-960f-45e7-99de-f7e76109e8d3","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MdrY2TspeJm8EKa7E6U9Mg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01K8STvZVHg9ces5wmLkZsNb","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {","new_string":"    if (etapa.fecha_ejecucion == null) {"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":772,"cache_read_input_tokens":33657,"cache_creation":{"ephemeral_5m_input_tokens":772,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CXKSAGSH1Ajf5HC2zKzcm","type":"assistant","uuid":"476732f7-082b-4280-a16c-8cfb305ddc43","timestamp":"2026-01-20T22:40:28.540Z"}
{"type":"file-history-snapshot","messageId":"476732f7-082b-4280-a16c-8cfb305ddc43","snapshot":{"messageId":"83beb323-4ea8-4b51-b704-596849a0d439","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v1","version":1,"backupTime":"2026-01-20T22:45:43.344Z"}},"timestamp":"2026-01-20T22:40:14.641Z"},"isSnapshotUpdate":true}
{"parentUuid":"476732f7-082b-4280-a16c-8cfb305ddc43","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01K8STvZVHg9ces5wmLkZsNb","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2460→                </div>\n  2461→            </div>\n  2462→        `;\n  2463→    });\n  2464→    if (etapa.fecha_ejecucion == null) {\n  2465→        $('#contenedor-cantidad-adjuntos').empty();\n  2466→        return `\n  2467→            <div class=\"col-12\">\n  2468→                <div class=\"row justify-content-center my-14\">"}]},"uuid":"99176cd0-f54f-4e78-b4f8-a6e28aafe21a","timestamp":"2026-01-20T22:45:43.411Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {","newString":"    if (etapa.fecha_ejecucion == null) {","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    console.log(etapa);\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2461,"oldLines":7,"newStart":2461,"newLines":7,"lines":["             </div>","         `;","     });","-    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {","+    if (etapa.fecha_ejecucion == null) {","         $('#contenedor-cantidad-adjuntos').empty();","         return `","             <div class=\"col-12\">"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"476732f7-082b-4280-a16c-8cfb305ddc43"}
{"parentUuid":"99176cd0-f54f-4e78-b4f8-a6e28aafe21a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Tb4WuECMTwFMgCez2iWXwi","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora la lógica es:\n\n| `fecha_ejecucion` | Comportamiento |\n|-------------------|----------------|\n| `null` | Muestra mensaje \"Este candidato aún no ha adjuntado los documentos para contratación\" con botón para adjuntar |\n| Con fecha | Muestra la lista de archivos adjuntos correctamente |\n\nEsto es consistente con el cambio que hicimos en el backend en `verificarEtapaCompletada`, donde también se valida que `fecha_ejecucion` no sea nulo para considerar la etapa como completada."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":34804,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":34804,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKSaC9UrhveBiwU49p1x","type":"assistant","uuid":"76bdba69-ecb1-4806-88c8-8d272a514090","timestamp":"2026-01-20T22:45:51.925Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-20T22:50:45.679Z","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d"}
{"type":"file-history-snapshot","messageId":"4d77f00b-b5e8-46cc-9a38-eb102f7ab716","snapshot":{"messageId":"4d77f00b-b5e8-46cc-9a38-eb102f7ab716","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v2","version":2,"backupTime":"2026-01-20T22:50:45.781Z"}},"timestamp":"2026-01-20T22:50:45.765Z"},"isSnapshotUpdate":false}
{"parentUuid":"84577590-a499-4ae4-a110-39f1ac8e4a60","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01L6rJtYZ88kzPJfBAjdet8R","parentToolUseID":"toolu_01L6rJtYZ88kzPJfBAjdet8R","uuid":"1d369c1c-1600-4722-b4b6-02ffa6101841","timestamp":"2026-01-20T22:40:20.794Z"}
{"parentUuid":"476732f7-082b-4280-a16c-8cfb305ddc43","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01K8STvZVHg9ces5wmLkZsNb","parentToolUseID":"toolu_01K8STvZVHg9ces5wmLkZsNb","uuid":"7a5daec4-7f43-4925-b400-3eb2fc1d7926","timestamp":"2026-01-20T22:40:28.718Z"}
{"parentUuid":"7a5daec4-7f43-4925-b400-3eb2fc1d7926","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01K8STvZVHg9ces5wmLkZsNb","parentToolUseID":"toolu_01K8STvZVHg9ces5wmLkZsNb","uuid":"2825cbaf-efbf-4ff0-ad01-ceaa7d409978","timestamp":"2026-01-20T22:40:28.719Z"}
{"parentUuid":"99176cd0-f54f-4e78-b4f8-a6e28aafe21a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01K8STvZVHg9ces5wmLkZsNb","toolUseID":"toolu_01K8STvZVHg9ces5wmLkZsNb","timestamp":"2026-01-20T22:45:43.413Z","uuid":"551a2c02-d123-4188-8c47-cb2e26b3ae55"}
{"parentUuid":"76bdba69-ecb1-4806-88c8-8d272a514090","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 2445 to 2445 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\nurl_imagen\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"listo hayt que hacer otra vlaidacion asi se ve con archivos cargados {\n    \"nombre_etapa\": \"Documentos para contratación\",\n    \"id\": 189,\n    \"usuario_id\": 27,\n    \"etapa_vacante_id\": 223,\n    \"puntaje\": null,\n    \"puntaje_ia\": null,\n    \"notas_ia\": null,\n    \"fecha_notificacion\": \"2026-01-20 15:53:15\",\n    \"fecha_ejecucion\": null,\n    \"motivo_abandono\": null,\n    \"activo\": 1,\n    \"archivos_solicitados\": {\n        \"documentos\": [\n            {\n                \"id\": 1,\n                \"empresa_id\": null,\n                \"nombre\": \"Cédula de ciudadanía\"\n            },\n            {\n                \"id\": 2,\n                \"empresa_id\": null,\n                \"nombre\": \"Certificados laborales\"\n            },\n            {\n                \"id\": 3,\n                \"empresa_id\": null,\n                \"nombre\": \"Diplomas de grado\"\n            },\n            {\n                \"id\": 4,\n                \"empresa_id\": null,\n                \"nombre\": \"Certificado EPS\"\n            },\n            {\n                \"id\": 5,\n                \"empresa_id\": null,\n                \"nombre\": \"Antecedentes\"\n            }\n        ],\n        \"archivos_guardados\": [\n            {\n                \"id\": 260,\n                \"modelo\": \"App\\\\Models\\\\Vacantes\\\\EtapaVacanteUsuario\",\n                \"modelo_id\": 189,\n                \"nombre\": \"cliente_empresa_69693791e75d2.pdf\",\n                \"nombre_original_archivo\": \"69693791e75d2.pdf\",\n                \"ruta\": \"private/archivos/empresas/2/documentos-solicitados/189/697005a733747.pdf\"\n            }\n        ]\n    }\n} entonces si tiene archivos cargados se ban ha mostrar pero solo los que ha cargado la empresa y se diferencian d elos que cargo e plicante por que en el campo de nombre de archivos comienzan con cliente_empresa_ esos si se pueden mostrar pero cunado ya este la fecha de ejecucin se muestren todos"}]},"uuid":"4d77f00b-b5e8-46cc-9a38-eb102f7ab716","timestamp":"2026-01-20T22:50:45.764Z"}
{"parentUuid":"4d77f00b-b5e8-46cc-9a38-eb102f7ab716","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RpD4AafAhP9QzncLhQZVZS","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo. Necesitas mostrar solo los archivos cargados por la empresa (los que comienzan con `cliente_empresa_`) cuando `fecha_ejecucion` es `null`, y mostrar todos los archivos cuando ya tenga fecha."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":801,"cache_read_input_tokens":34804,"cache_creation":{"ephemeral_5m_input_tokens":801,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKSxJ4J38P7R2mWNF3yr","type":"assistant","uuid":"0ac65268-9a9e-44f8-bc77-947724656571","timestamp":"2026-01-20T22:50:50.390Z"}
{"parentUuid":"0ac65268-9a9e-44f8-bc77-947724656571","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RpD4AafAhP9QzncLhQZVZS","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01B8qmUKZnmcfc1zJ1CBTGcU","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2398,"limit":70}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":801,"cache_read_input_tokens":34804,"cache_creation":{"ephemeral_5m_input_tokens":801,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKSxJ4J38P7R2mWNF3yr","type":"assistant","uuid":"ba2312ff-cfa4-4750-8d54-16cf40379b1e","timestamp":"2026-01-20T22:50:51.695Z"}
{"parentUuid":"ba2312ff-cfa4-4750-8d54-16cf40379b1e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01B8qmUKZnmcfc1zJ1CBTGcU","type":"tool_result","content":"  2398→ * @author José Manuel Jiménez\n  2399→ * @author Andres Gonzalez\n  2400→ */\n  2401→function mostrarResultadoDocumentosContratacion(etapa) {\n  2402→    console.log(etapa);\n  2403→    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n  2404→    $('#contenedor-archivos-contratacion').empty();\n  2405→    let documentos_contartacion = [];\n  2406→    let imagenes_cargadas = [];\n  2407→    archivos_contratacion.forEach((archivo) => {\n  2408→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2409→        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n  2410→        if (es_imagen) {\n  2411→            imagenes_cargadas.push(archivo);\n  2412→        } else {\n  2413→            documentos_contartacion.push(archivo);\n  2414→        }\n  2415→    });\n  2416→    let archivos_html = '';\n  2417→    documentos_contartacion.forEach((archivo) => {\n  2418→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2419→        let icono = obtenerIconoPorExtension(extension);\n  2420→        let url_archivo = `/archivos-abrir/${archivo.id}`;\n  2421→        archivos_html += `\n  2422→            <div class=\"col-auto archivo-item\">\n  2423→                <div class=\"col-auto px-3 border rounded-2\">\n  2424→                    <div class=\"row align-items-center\">\n  2425→                        <div class=\"col-auto py-3\">\n  2426→                            <i class=\"${icono} text-blue-40\"></i>\n  2427→                        </div>\n  2428→                        <div class=\"col px-0 py-3\">\n  2429→                            <a href=\"${url_archivo}\"\n  2430→                               target=\"_blank\"\n  2431→                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n  2432→                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n  2433→                                ${archivo.nombre_original_archivo}\n  2434→                            </a>\n  2435→                        </div>\n  2436→                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n  2437→                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n  2438→                        </a>\n  2439→                    </div>\n  2440→                </div>\n  2441→            </div>\n  2442→        `;\n  2443→    });\n  2444→    imagenes_cargadas.forEach((archivo) => {\n  2445→        let url_imagen = `/archivos-abrir/${archivo.id}`;\n  2446→        archivos_html += `\n  2447→            <div class=\"col-auto archivo-item\">\n  2448→                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n  2449→                    <div class=\"row align-items-center\">\n  2450→                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n  2451→                    </div>\n  2452→                    <div class=\"row align-items-center\">\n  2453→                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n  2454→                            ${archivo.nombre_original_archivo}\n  2455→                        </div>\n  2456→                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n  2457→                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n  2458→                        </a>\n  2459→                    </div>\n  2460→                </div>\n  2461→            </div>\n  2462→        `;\n  2463→    });\n  2464→    if (etapa.fecha_ejecucion == null) {\n  2465→        $('#contenedor-cantidad-adjuntos').empty();\n  2466→        return `\n  2467→            <div class=\"col-12\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"aba637e7-fd2b-4fc0-be39-dcb3ebc06f07","timestamp":"2026-01-20T22:50:53.876Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":" * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    console.log(etapa);\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">","numLines":70,"startLine":2398,"totalLines":2692}},"sourceToolAssistantUUID":"ba2312ff-cfa4-4750-8d54-16cf40379b1e"}
{"parentUuid":"aba637e7-fd2b-4fc0-be39-dcb3ebc06f07","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_016XM2qk2YsG8eRPwJ2GvP89","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a modificar la función para filtrar los archivos según `fecha_ejecucion`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1503,"cache_read_input_tokens":35605,"cache_creation":{"ephemeral_5m_input_tokens":1503,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXKSxrwDg41QAyTgQstTF","type":"assistant","uuid":"f9ba9b79-6456-4049-a84b-39511f501f8a","timestamp":"2026-01-20T22:50:57.649Z"}
{"parentUuid":"f9ba9b79-6456-4049-a84b-39511f501f8a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_016XM2qk2YsG8eRPwJ2GvP89","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XZk6fhTHofzcwsVEUzZAhZ","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"function mostrarResultadoDocumentosContratacion(etapa) {\n    console.log(etapa);\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });","new_string":"function mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1503,"cache_read_input_tokens":35605,"cache_creation":{"ephemeral_5m_input_tokens":1503,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXKSxrwDg41QAyTgQstTF","type":"assistant","uuid":"9870f21b-44ab-43be-bcef-e0bd375fca58","timestamp":"2026-01-20T22:51:06.600Z"}
{"parentUuid":"9870f21b-44ab-43be-bcef-e0bd375fca58","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XZk6fhTHofzcwsVEUzZAhZ","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2397→ * @returns {string} Código HTML del resultado de la etapa.\n  2398→ * @author José Manuel Jiménez\n  2399→ * @author Andres Gonzalez\n  2400→ */\n  2401→function mostrarResultadoDocumentosContratacion(etapa) {\n  2402→    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n  2403→\n  2404→    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n  2405→    if (etapa.fecha_ejecucion == null) {\n  2406→        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n  2407→    }\n  2408→\n  2409→    $('#contenedor-archivos-contratacion').empty();\n  2410→    let documentos_contratacion = [];\n  2411→    let imagenes_cargadas = [];\n  2412→    archivos_contratacion.forEach((archivo) => {\n  2413→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2414→        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n  2415→        if (es_imagen) {\n  2416→            imagenes_cargadas.push(archivo);\n  2417→        } else {\n  2418→            documentos_contratacion.push(archivo);\n  2419→        }\n  2420→    });\n  2421→    let archivos_html = '';\n  2422→    documentos_contartacion.forEach((archivo) => {\n  2423→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2424→        let icono = obtenerIconoPorExtension(extension);"}]},"uuid":"367231ae-7cfb-4b0f-9c6a-fe717874e648","timestamp":"2026-01-20T22:52:36.349Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"function mostrarResultadoDocumentosContratacion(etapa) {\n    console.log(etapa);\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });","newString":"function mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    console.log(etapa);\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2399,"oldLines":10,"newStart":2399,"newLines":15,"lines":["  * @author Andres Gonzalez","  */"," function mostrarResultadoDocumentosContratacion(etapa) {","-    console.log(etapa);","     let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];","+","+    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)","+    if (etapa.fecha_ejecucion == null) {","+        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));","+    }","+","     $('#contenedor-archivos-contratacion').empty();","-    let documentos_contartacion = [];","+    let documentos_contratacion = [];","     let imagenes_cargadas = [];","     archivos_contratacion.forEach((archivo) => {","         let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();"]},{"oldStart":2410,"oldLines":7,"newStart":2415,"newLines":7,"lines":["         if (es_imagen) {","             imagenes_cargadas.push(archivo);","         } else {","-            documentos_contartacion.push(archivo);","+            documentos_contratacion.push(archivo);","         }","     });","     let archivos_html = '';"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"9870f21b-44ab-43be-bcef-e0bd375fca58"}
{"parentUuid":"367231ae-7cfb-4b0f-9c6a-fe717874e648","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_015HStR4irKuQ9nm6bM2AQx5","type":"message","role":"assistant","content":[{"type":"text","text":"Hay un error de typo en la variable. Voy a corregirlo."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1365,"cache_read_input_tokens":37108,"cache_creation":{"ephemeral_5m_input_tokens":1365,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKT6XqjqPQBvga7QuBks","type":"assistant","uuid":"10b3a0f0-4d7f-4c56-8c91-783a51028c38","timestamp":"2026-01-20T22:52:41.397Z"}
{"parentUuid":"10b3a0f0-4d7f-4c56-8c91-783a51028c38","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_015HStR4irKuQ9nm6bM2AQx5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HeNzCHauQyzQ4FxDsNnkge","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {","new_string":"    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1365,"cache_read_input_tokens":37108,"cache_creation":{"ephemeral_5m_input_tokens":1365,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKT6XqjqPQBvga7QuBks","type":"assistant","uuid":"f1ca80fe-b9df-4a55-b3bb-bbf111c942b0","timestamp":"2026-01-20T22:52:42.589Z"}
{"parentUuid":"f1ca80fe-b9df-4a55-b3bb-bbf111c942b0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HeNzCHauQyzQ4FxDsNnkge","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2417→        } else {\n  2418→            documentos_contratacion.push(archivo);\n  2419→        }\n  2420→    });\n  2421→    let archivos_html = '';\n  2422→    documentos_contratacion.forEach((archivo) => {\n  2423→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2424→        let icono = obtenerIconoPorExtension(extension);\n  2425→        let url_archivo = `/archivos-abrir/${archivo.id}`;\n  2426→        archivos_html += `"}]},"uuid":"169429b9-56e6-4343-8179-f2034a9c0c8d","timestamp":"2026-01-20T22:53:03.814Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {","newString":"    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2419,"oldLines":7,"newStart":2419,"newLines":7,"lines":["         }","     });","     let archivos_html = '';","-    documentos_contartacion.forEach((archivo) => {","+    documentos_contratacion.forEach((archivo) => {","         let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();","         let icono = obtenerIconoPorExtension(extension);","         let url_archivo = `/archivos-abrir/${archivo.id}`;"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"f1ca80fe-b9df-4a55-b3bb-bbf111c942b0"}
{"parentUuid":"169429b9-56e6-4343-8179-f2034a9c0c8d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TkQeSoPBH1uayRiPBUpR45","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora la lógica funciona así:\n\n| `fecha_ejecucion` | Archivos mostrados |\n|-------------------|-------------------|\n| `null` | Solo archivos de la empresa (prefijo `cliente_empresa_`) |\n| Con fecha | Todos los archivos (empresa + aplicante) |\n\nTambién corregí el typo `documentos_contartacion` → `documentos_contratacion`."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":533,"cache_read_input_tokens":38473,"cache_creation":{"ephemeral_5m_input_tokens":533,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKT8Z7gpwvAYujMpXZPB","type":"assistant","uuid":"739229b7-dfe6-43b9-a6df-db5a7ec1070c","timestamp":"2026-01-20T22:53:09.783Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-20T22:55:16.385Z","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d"}
{"type":"file-history-snapshot","messageId":"c2890cb5-1b29-42a5-a3aa-4f8d1721d180","snapshot":{"messageId":"c2890cb5-1b29-42a5-a3aa-4f8d1721d180","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v3","version":3,"backupTime":"2026-01-20T22:55:16.485Z"}},"timestamp":"2026-01-20T22:55:16.470Z"},"isSnapshotUpdate":false}
{"parentUuid":"ba2312ff-cfa4-4750-8d54-16cf40379b1e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01B8qmUKZnmcfc1zJ1CBTGcU","parentToolUseID":"toolu_01B8qmUKZnmcfc1zJ1CBTGcU","uuid":"e51e692a-6360-4f26-abcf-ed7fa16c903f","timestamp":"2026-01-20T22:50:52.815Z"}
{"parentUuid":"9870f21b-44ab-43be-bcef-e0bd375fca58","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01XZk6fhTHofzcwsVEUzZAhZ","parentToolUseID":"toolu_01XZk6fhTHofzcwsVEUzZAhZ","uuid":"31c52916-9f06-4a98-bc51-6531b6bca26d","timestamp":"2026-01-20T22:51:06.787Z"}
{"parentUuid":"31c52916-9f06-4a98-bc51-6531b6bca26d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01XZk6fhTHofzcwsVEUzZAhZ","parentToolUseID":"toolu_01XZk6fhTHofzcwsVEUzZAhZ","uuid":"734ebdfd-9f93-43cb-a283-bec2e496c9b8","timestamp":"2026-01-20T22:51:06.788Z"}
{"parentUuid":"367231ae-7cfb-4b0f-9c6a-fe717874e648","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01XZk6fhTHofzcwsVEUzZAhZ","toolUseID":"toolu_01XZk6fhTHofzcwsVEUzZAhZ","timestamp":"2026-01-20T22:52:36.351Z","uuid":"ee2a60f5-bcd3-4a4c-b500-bf05b21cb0e4"}
{"parentUuid":"f1ca80fe-b9df-4a55-b3bb-bbf111c942b0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01HeNzCHauQyzQ4FxDsNnkge","parentToolUseID":"toolu_01HeNzCHauQyzQ4FxDsNnkge","uuid":"ba916501-78f6-4d41-b70c-0f8f9f3bcccc","timestamp":"2026-01-20T22:52:42.738Z"}
{"parentUuid":"ba916501-78f6-4d41-b70c-0f8f9f3bcccc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01HeNzCHauQyzQ4FxDsNnkge","parentToolUseID":"toolu_01HeNzCHauQyzQ4FxDsNnkge","uuid":"65e15b5b-6bad-4f97-aa4f-32d8d7d12b06","timestamp":"2026-01-20T22:52:42.739Z"}
{"parentUuid":"169429b9-56e6-4343-8179-f2034a9c0c8d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01HeNzCHauQyzQ4FxDsNnkge","toolUseID":"toolu_01HeNzCHauQyzQ4FxDsNnkge","timestamp":"2026-01-20T22:53:03.816Z","uuid":"8d9205f4-c251-4d96-a029-a30134a833f6"}
{"parentUuid":"739229b7-dfe6-43b9-a6df-db5a7ec1070c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"no funciona por que si la fecha es null pero la empresa ya tiene documnetos cargados deverian verse esoso documentos que coloc la empresa"}]},"uuid":"c2890cb5-1b29-42a5-a3aa-4f8d1721d180","timestamp":"2026-01-20T22:55:16.468Z"}
{"parentUuid":"c2890cb5-1b29-42a5-a3aa-4f8d1721d180","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UorZnBfUHMooUPtA8cyjMA","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo, el problema es que cuando `fecha_ejecucion` es `null` pero la empresa ya cargó documentos (con prefijo `cliente_empresa_`), la condición actual retorna el mensaje de \"no ha adjuntado\" sin mostrar esos archivos. Necesitamos ajustar la condición del `if`."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1453,"cache_read_input_tokens":37754,"cache_creation":{"ephemeral_5m_input_tokens":1453,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKTJDiQkN7GnQk6Luj23","type":"assistant","uuid":"b9b0676e-1bc0-4582-8a71-ab12d9cb87eb","timestamp":"2026-01-20T22:55:20.944Z"}
{"parentUuid":"b9b0676e-1bc0-4582-8a71-ab12d9cb87eb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UorZnBfUHMooUPtA8cyjMA","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01K3BpPNe6kQYFy5ik5C528T","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2464,"limit":40}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1453,"cache_read_input_tokens":37754,"cache_creation":{"ephemeral_5m_input_tokens":1453,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKTJDiQkN7GnQk6Luj23","type":"assistant","uuid":"daaa8ead-b3db-4766-ad72-2441f7e43117","timestamp":"2026-01-20T22:55:22.206Z"}
{"parentUuid":"daaa8ead-b3db-4766-ad72-2441f7e43117","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01K3BpPNe6kQYFy5ik5C528T","type":"tool_result","content":"  2464→                    </div>\n  2465→                </div>\n  2466→            </div>\n  2467→        `;\n  2468→    });\n  2469→    if (etapa.fecha_ejecucion == null) {\n  2470→        $('#contenedor-cantidad-adjuntos').empty();\n  2471→        return `\n  2472→            <div class=\"col-12\">\n  2473→                <div class=\"row justify-content-center my-14\">\n  2474→                    <div class=\"col-auto\">\n  2475→                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n  2476→                    </div>\n  2477→                    <div class=\"col-12 text-center text-headline-5\">\n  2478→                        Este candidato aún no ha adjuntado los documentos para contratación\n  2479→                    </div>\n  2480→                    ${etapa.id != null ? `\n  2481→                        <div class=\"col-auto mt-10\">\n  2482→                            ${crearBoton({\n  2483→                                clases: 'btn-outline-primary',\n  2484→                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2485→                                onclick: \"$('#documentos_contratacion').click();\"\n  2486→                            })}\n  2487→                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n  2488→                        </div>\n  2489→                    ` : ''}\n  2490→                </div>\n  2491→            </div>\n  2492→        `;\n  2493→    } else {\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );\n  2498→            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2499→        }, 100);\n  2500→        return `\n  2501→            <div class=\"col-12\">\n  2502→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n  2503→                    <div class=\"col-12\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7883ac9f-7b08-42e5-a0d1-68d87884294e","timestamp":"2026-01-20T22:55:24.693Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">","numLines":40,"startLine":2464,"totalLines":2697}},"sourceToolAssistantUUID":"daaa8ead-b3db-4766-ad72-2441f7e43117"}
{"parentUuid":"7883ac9f-7b08-42e5-a0d1-68d87884294e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_019d3wNCqyLnJd96mLbHTAPT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XPT9uKYDDCvoxFS9VTbqoU","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {","new_string":"    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":981,"cache_read_input_tokens":39207,"cache_creation":{"ephemeral_5m_input_tokens":981,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CXKTJpae8Cbf5iJNmons2","type":"assistant","uuid":"afb13f26-301b-4149-b7cd-18d9b3742861","timestamp":"2026-01-20T22:55:36.023Z"}
{"parentUuid":"afb13f26-301b-4149-b7cd-18d9b3742861","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XPT9uKYDDCvoxFS9VTbqoU","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2465→                </div>\n  2466→            </div>\n  2467→        `;\n  2468→    });\n  2469→    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n  2470→        $('#contenedor-cantidad-adjuntos').empty();\n  2471→        return `\n  2472→            <div class=\"col-12\">\n  2473→                <div class=\"row justify-content-center my-14\">\n  2474→                    <div class=\"col-auto\">\n  2475→                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n  2476→                    </div>\n  2477→                    <div class=\"col-12 text-center text-headline-5\">\n  2478→                        Este candidato aún no ha adjuntado los documentos para contratación\n  2479→                    </div>\n  2480→                    ${etapa.id != null ? `\n  2481→                        <div class=\"col-auto mt-10\">\n  2482→                            ${crearBoton({\n  2483→                                clases: 'btn-outline-primary',\n  2484→                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2485→                                onclick: \"$('#documentos_contratacion').click();\"\n  2486→                            })}\n  2487→                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n  2488→                        </div>\n  2489→                    ` : ''}\n  2490→                </div>\n  2491→            </div>\n  2492→        `;\n  2493→    } else {\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );"}]},"uuid":"6b056c85-4f72-443c-b297-6cce4bf710d9","timestamp":"2026-01-20T22:55:47.561Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {","newString":"    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2466,"oldLines":7,"newStart":2466,"newLines":7,"lines":["             </div>","         `;","     });","-    if (etapa.fecha_ejecucion == null) {","+    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {","         $('#contenedor-cantidad-adjuntos').empty();","         return `","             <div class=\"col-12\">"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"afb13f26-301b-4149-b7cd-18d9b3742861"}
{"parentUuid":"6b056c85-4f72-443c-b297-6cce4bf710d9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RLUq4bDe6y8H1yy3y9nAxm","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora la lógica es:\n\n| `fecha_ejecucion` | Archivos empresa (`cliente_empresa_`) | Comportamiento |\n|-------------------|---------------------------------------|----------------|\n| `null` | 0 | Muestra mensaje \"aún no ha adjuntado\" |\n| `null` | > 0 | Muestra solo archivos de la empresa |\n| Con fecha | - | Muestra todos los archivos |\n\nEl flujo:\n1. Primero filtra los archivos (solo `cliente_empresa_` si `fecha_ejecucion` es null)\n2. Si `fecha_ejecucion` es null **Y** no hay archivos de empresa → mensaje vacío\n3. Si hay archivos (de empresa o todos) → muestra la lista"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1473,"cache_read_input_tokens":40188,"cache_creation":{"ephemeral_5m_input_tokens":1473,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKTLdm59L8gW5GDy61M7","type":"assistant","uuid":"cb0c9469-c3c0-4066-abf9-853449075d15","timestamp":"2026-01-20T22:55:55.728Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-20T22:57:16.106Z","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d"}
{"type":"file-history-snapshot","messageId":"6468ac3c-9c7d-46e7-8b2b-cc1e94e929f8","snapshot":{"messageId":"6468ac3c-9c7d-46e7-8b2b-cc1e94e929f8","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v4","version":4,"backupTime":"2026-01-20T22:57:16.193Z"}},"timestamp":"2026-01-20T22:57:16.177Z"},"isSnapshotUpdate":false}
{"parentUuid":"daaa8ead-b3db-4766-ad72-2441f7e43117","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01K3BpPNe6kQYFy5ik5C528T","parentToolUseID":"toolu_01K3BpPNe6kQYFy5ik5C528T","uuid":"7a41bc84-4379-4b4d-a052-b17c4e56a1af","timestamp":"2026-01-20T22:55:23.641Z"}
{"parentUuid":"afb13f26-301b-4149-b7cd-18d9b3742861","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01XPT9uKYDDCvoxFS9VTbqoU","parentToolUseID":"toolu_01XPT9uKYDDCvoxFS9VTbqoU","uuid":"cba59e77-8761-4e03-9d4d-f1030a9aca34","timestamp":"2026-01-20T22:55:36.233Z"}
{"parentUuid":"cba59e77-8761-4e03-9d4d-f1030a9aca34","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01XPT9uKYDDCvoxFS9VTbqoU","parentToolUseID":"toolu_01XPT9uKYDDCvoxFS9VTbqoU","uuid":"3ebdc0fc-ad25-46ea-aadb-f06e7c915610","timestamp":"2026-01-20T22:55:36.233Z"}
{"parentUuid":"6b056c85-4f72-443c-b297-6cce4bf710d9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01XPT9uKYDDCvoxFS9VTbqoU","toolUseID":"toolu_01XPT9uKYDDCvoxFS9VTbqoU","timestamp":"2026-01-20T22:55:47.562Z","uuid":"c87da7b6-f660-4cbb-91a5-fcdef7a5922d"}
{"parentUuid":"cb0c9469-c3c0-4066-abf9-853449075d15","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 2498 to 2498 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\n$('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"listo y aqui $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`); solo deven contar los que esta argando el aplicante"}]},"uuid":"6468ac3c-9c7d-46e7-8b2b-cc1e94e929f8","timestamp":"2026-01-20T22:57:16.176Z"}
{"parentUuid":"6468ac3c-9c7d-46e7-8b2b-cc1e94e929f8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01B2ymEiNycW3smfCaCZaf49","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo, el contador de adjuntos solo debe contar los archivos del aplicante (los que NO tienen el prefijo `cliente_empresa_`)."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":386,"cache_read_input_tokens":41661,"cache_creation":{"ephemeral_5m_input_tokens":386,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKTT2sYM2a8KQYPN91WU","type":"assistant","uuid":"2789c787-6d5c-48f3-9c2e-50f048bc70ca","timestamp":"2026-01-20T22:57:19.682Z"}
{"parentUuid":"2789c787-6d5c-48f3-9c2e-50f048bc70ca","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01B2ymEiNycW3smfCaCZaf49","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013sg8j4B2KiigRAq4X23Ej8","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","new_string":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":386,"cache_read_input_tokens":41661,"cache_creation":{"ephemeral_5m_input_tokens":386,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKTT2sYM2a8KQYPN91WU","type":"assistant","uuid":"184c6f41-4163-4b49-9b82-450b04347dda","timestamp":"2026-01-20T22:57:22.935Z"}
{"parentUuid":"184c6f41-4163-4b49-9b82-450b04347dda","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has not been read yet. Read it first before writing to it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_013sg8j4B2KiigRAq4X23Ej8"}]},"uuid":"13eb44be-3e79-4879-b5ea-1a6c1b3dcdcf","timestamp":"2026-01-20T22:57:24.045Z","toolUseResult":"Error: File has not been read yet. Read it first before writing to it.","sourceToolAssistantUUID":"184c6f41-4163-4b49-9b82-450b04347dda"}
{"parentUuid":"13eb44be-3e79-4879-b5ea-1a6c1b3dcdcf","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RWBUQe6Y6CFKa9x6Z2vEZq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UJRenrjxuehN4tdDYu3qef","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2493,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":358,"cache_read_input_tokens":42047,"cache_creation":{"ephemeral_5m_input_tokens":358,"ephemeral_1h_input_tokens":0},"output_tokens":20,"service_tier":"standard"}},"requestId":"req_011CXKTTd9oseNvZFh23U7rt","type":"assistant","uuid":"f3bc3c75-d9db-4a45-b763-77905e19fd47","timestamp":"2026-01-20T22:57:27.690Z"}
{"parentUuid":"f3bc3c75-d9db-4a45-b763-77905e19fd47","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UJRenrjxuehN4tdDYu3qef","type":"tool_result","content":"  2493→    } else {\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );\n  2498→            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2499→        }, 100);\n  2500→        return `\n  2501→            <div class=\"col-12\">\n  2502→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n  2503→                    <div class=\"col-12\">\n  2504→                        <div class=\"row justify-content-between align-items-center mb-4\">\n  2505→                            <div class=\"col-auto text-body-2 text-gray-10\">\n  2506→                                Archivos adjuntos\n  2507→                            </div>\n  2508→                            <div class=\"col-auto\">\n  2509→                                ${crearBoton({\n  2510→                                    clases: 'btn-outline-primary',\n  2511→                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2512→                                    onclick: `$('#documentos_contratacion').click();`\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"69d94edd-1e88-4630-8e48-d77a44ac30c8","timestamp":"2026-01-20T22:57:29.514Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`","numLines":20,"startLine":2493,"totalLines":2697}},"sourceToolAssistantUUID":"f3bc3c75-d9db-4a45-b763-77905e19fd47"}
{"parentUuid":"69d94edd-1e88-4630-8e48-d77a44ac30c8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01EKCrCK5M1G9jwNd4fEvsa2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TRYhRr7yoU8NEEpBhzUw6M","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","new_string":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":594,"cache_read_input_tokens":42405,"cache_creation":{"ephemeral_5m_input_tokens":594,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CXKTU2zmCe9Bod4AzDFnv","type":"assistant","uuid":"4acb75e9-323c-485c-adc9-d8551dbb6c96","timestamp":"2026-01-20T22:57:35.330Z"}
{"parentUuid":"4acb75e9-323c-485c-adc9-d8551dbb6c96","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TRYhRr7yoU8NEEpBhzUw6M","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );\n  2498→            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n  2499→            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2500→        }, 100);\n  2501→        return `\n  2502→            <div class=\"col-12\">\n  2503→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">"}]},"uuid":"dfea0a63-4dd2-4847-8e68-a77f9b9d29e4","timestamp":"2026-01-20T22:57:43.796Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","newString":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2495,"oldLines":7,"newStart":2495,"newLines":8,"lines":["             $('#contenedor-cantidad-adjuntos').empty().append(","                 crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})","             );","-            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","+            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));","+            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","         }, 100);","         return `","             <div class=\"col-12\">"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"4acb75e9-323c-485c-adc9-d8551dbb6c96"}
{"parentUuid":"dfea0a63-4dd2-4847-8e68-a77f9b9d29e4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MZazg73MNuKK8jPBnTLRfi","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora el contador solo cuenta los archivos del aplicante (los que **NO** comienzan con `cliente_empresa_`).\n\nPor ejemplo, si hay:\n- 5 documentos solicitados\n- 3 archivos guardados: 1 de empresa (`cliente_empresa_xxx`) + 2 del aplicante\n\nEl tag mostrará: **\"2 de 5 Adjuntos\"**"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":562,"cache_read_input_tokens":42999,"cache_creation":{"ephemeral_5m_input_tokens":562,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKTVCazhqG7LoKAn2o7E","type":"assistant","uuid":"49d7e5c4-2ea6-4698-81db-2f8435eada8c","timestamp":"2026-01-20T22:57:50.729Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-20T23:06:03.818Z","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d"}
{"type":"file-history-snapshot","messageId":"619d6e07-345e-4b1f-8621-2f91f8468c60","snapshot":{"messageId":"619d6e07-345e-4b1f-8621-2f91f8468c60","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v5","version":5,"backupTime":"2026-01-20T23:06:03.941Z"}},"timestamp":"2026-01-20T23:06:03.926Z"},"isSnapshotUpdate":false}
{"parentUuid":"f3bc3c75-d9db-4a45-b763-77905e19fd47","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01UJRenrjxuehN4tdDYu3qef","parentToolUseID":"toolu_01UJRenrjxuehN4tdDYu3qef","uuid":"3ea3bdba-fafa-480d-aa52-f806956ef8f9","timestamp":"2026-01-20T22:57:27.845Z"}
{"parentUuid":"4acb75e9-323c-485c-adc9-d8551dbb6c96","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01TRYhRr7yoU8NEEpBhzUw6M","parentToolUseID":"toolu_01TRYhRr7yoU8NEEpBhzUw6M","uuid":"5a08b7b7-27a7-4248-8feb-44c3d0028377","timestamp":"2026-01-20T22:57:35.494Z"}
{"parentUuid":"5a08b7b7-27a7-4248-8feb-44c3d0028377","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01TRYhRr7yoU8NEEpBhzUw6M","parentToolUseID":"toolu_01TRYhRr7yoU8NEEpBhzUw6M","uuid":"104c76fe-c967-42de-b9e0-e778e2849477","timestamp":"2026-01-20T22:57:35.495Z"}
{"parentUuid":"dfea0a63-4dd2-4847-8e68-a77f9b9d29e4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01TRYhRr7yoU8NEEpBhzUw6M","toolUseID":"toolu_01TRYhRr7yoU8NEEpBhzUw6M","timestamp":"2026-01-20T22:57:43.797Z","uuid":"4389ce1a-ca27-4283-a85d-7ad56403a61a"}
{"parentUuid":"49d7e5c4-2ea6-4698-81db-2f8435eada8c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 493 to 493 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js:\n<span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"mira aqui <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span> quiero que lo cambies por la fecha del created_at"}]},"uuid":"619d6e07-345e-4b1f-8621-2f91f8468c60","timestamp":"2026-01-20T23:06:03.924Z"}
{"parentUuid":"619d6e07-345e-4b1f-8621-2f91f8468c60","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WVQkoaH1j6MY6FHT2u3yQA","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TGd1a5ngijj1RYkKZ3U3t8","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","offset":480,"limit":40}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":43906,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":43906,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXKU7xuGGGNL3yyx8asAV","type":"assistant","uuid":"6941133a-dc04-4afa-9de1-631b932b8946","timestamp":"2026-01-20T23:06:08.693Z"}
{"parentUuid":"6941133a-dc04-4afa-9de1-631b932b8946","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TGd1a5ngijj1RYkKZ3U3t8","type":"tool_result","content":"   480→                        ${ubicacion ? `\n   481→                            <div class=\"d-flex align-items-center gap-2 mt-3\">\n   482→                                <span class=\"text-label-2 text-gray-30\">${ubicacion}</span>\n   483→                            </div>\n   484→                        ` : ''}\n   485→                    </div>\n   486→                    <div class=\"flex-grow-1\">\n   487→                        <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>\n   488→                        <div class=\"candidato-info d-flex flex-column gap-1\">\n   489→                            ${etapa_descarte_html}\n   490→                            ${(origen === 'modal' && fecha_notificacion) ? `\n   491→                                <div class=\"d-flex align-items-center gap-2\">\n   492→                                    <i class=\"bi bi-calendar-event\"></i>\n   493→                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n   494→                                </div>\n   495→                            ` : ''}\n   496→                            ${documento ? `\n   497→                                <div class=\"d-flex align-items-center gap-2\">\n   498→                                    <img width=\"12\" heigth=\"16\" src=\"/iconos/file-person.png\">\n   499→                                    <span class=\"text-label-2\">No. documento: ${documento}</span>\n   500→                                </div>\n   501→                            ` : ''}\n   502→                            ${experiencia ? `\n   503→                                <div class=\"d-flex align-items-center gap-2\">\n   504→                                    <i class=\"bi bi-briefcase\"></i>\n   505→                                    <span class=\"text-label-2\">Experiencia: ${experiencia}</span>\n   506→                                </div>\n   507→                            ` : ''}\n   508→                            ${salario_solicitado ? `\n   509→                                <div class=\"d-flex align-items-center gap-2\">\n   510→                                    <i class=\"bi bi-currency-dollar\"></i>\n   511→                                    <span class=\"text-label-2\">${salario_solicitado}</span>\n   512→                                </div>\n   513→                            ` : ''}\n   514→                        </div>\n   515→                    </div>\n   516→\n   517→                    <div class=\"d-flex flex-column align-items-end gap-2\">\n   518→                        ${generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono)}\n   519→                    </div>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"0934daf9-17a4-411b-847f-98b1d4abc843","timestamp":"2026-01-20T23:06:10.973Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","content":"                        ${ubicacion ? `\n                            <div class=\"d-flex align-items-center gap-2 mt-3\">\n                                <span class=\"text-label-2 text-gray-30\">${ubicacion}</span>\n                            </div>\n                        ` : ''}\n                    </div>\n                    <div class=\"flex-grow-1\">\n                        <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>\n                        <div class=\"candidato-info d-flex flex-column gap-1\">\n                            ${etapa_descarte_html}\n                            ${(origen === 'modal' && fecha_notificacion) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n                                </div>\n                            ` : ''}\n                            ${documento ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <img width=\"12\" heigth=\"16\" src=\"/iconos/file-person.png\">\n                                    <span class=\"text-label-2\">No. documento: ${documento}</span>\n                                </div>\n                            ` : ''}\n                            ${experiencia ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-briefcase\"></i>\n                                    <span class=\"text-label-2\">Experiencia: ${experiencia}</span>\n                                </div>\n                            ` : ''}\n                            ${salario_solicitado ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-currency-dollar\"></i>\n                                    <span class=\"text-label-2\">${salario_solicitado}</span>\n                                </div>\n                            ` : ''}\n                        </div>\n                    </div>\n\n                    <div class=\"d-flex flex-column align-items-end gap-2\">\n                        ${generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono)}\n                    </div>","numLines":40,"startLine":480,"totalLines":1845}},"sourceToolAssistantUUID":"6941133a-dc04-4afa-9de1-631b932b8946"}
{"parentUuid":"0934daf9-17a4-411b-847f-98b1d4abc843","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_019f5HqDdoSjUZHKE3hUb5wY","type":"message","role":"assistant","content":[{"type":"text","text":"Necesito ver dónde se define `fecha_notificacion` y verificar si `created_at` está disponible en el contexto."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":954,"cache_read_input_tokens":43906,"cache_creation":{"ephemeral_5m_input_tokens":954,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKU8TYh6r2uu4cyR4Gc4","type":"assistant","uuid":"25321b92-609a-44bd-a6c3-52598a8665d3","timestamp":"2026-01-20T23:06:15.290Z"}
{"parentUuid":"25321b92-609a-44bd-a6c3-52598a8665d3","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_019f5HqDdoSjUZHKE3hUb5wY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QMMP4usH6e9mNtDTsbLfww","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","offset":420,"limit":60}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":954,"cache_read_input_tokens":43906,"cache_creation":{"ephemeral_5m_input_tokens":954,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKU8TYh6r2uu4cyR4Gc4","type":"assistant","uuid":"7029f6a3-615d-46f7-bd84-4f5ebd6514c6","timestamp":"2026-01-20T23:06:16.337Z"}
{"parentUuid":"7029f6a3-615d-46f7-bd84-4f5ebd6514c6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QMMP4usH6e9mNtDTsbLfww","type":"tool_result","content":"   420→    var etiqueta_estilo = '';\n   421→    if (adecuacion >= 10 && adecuacion <= 40) {\n   422→        borde_color = 'borde-indice-talento-rojo';\n   423→        etiqueta_estilo = 'badge-indice-talento-rojo';\n   424→    } else if (adecuacion >= 41 && adecuacion <= 70) {\n   425→        borde_color = 'borde-indice-talento-amarillo';\n   426→        etiqueta_estilo = 'badge-indice-talento-amarillo';\n   427→    } else if (adecuacion >= 71 && adecuacion <= 100) {\n   428→        borde_color = 'borde-indice-talento-verde';\n   429→        etiqueta_estilo = 'badge-indice-talento-verde';\n   430→    }\n   431→\n   432→    var tiene_motivo_abandono = origen === 'modal' && usuario_vacante.etapa_descarte?.motivo_abandono !== null;\n   433→\n   434→    var checkbox_html = !tiene_motivo_abandono ?\n   435→        crearCheckbox({\n   436→            id: `candidato-check-${usuario_vacante.id}`,\n   437→            name: `candidato_check`,\n   438→            value: usuario_vacante.id,\n   439→            class: 'candidato-checkbox',\n   440→            input_container_class: 'd-inline-block'\n   441→        }) : '';\n   442→\n   443→    var etapa_descarte_html = origen === 'modal' && usuario_vacante.etapa_descarte ?\n   444→        `${crearTag({\n   445→            texto: `Etapa de descarte: ${usuario_vacante.etapa_descarte.nombre}`,\n   446→            class: 'tag-tonal-orange w-fit-content',\n   447→        })}` : '';\n   448→\n   449→    var fecha_notificacion = '';\n   450→    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {\n   451→        var fecha = new Date(usuario_vacante.fecha_notificacion);\n   452→        var dia = fecha.getDate();\n   453→        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n   454→        var anio = fecha.getFullYear();\n   455→        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n   456→    }\n   457→\n   458→\n   459→    return `\n   460→        <div class=\"card candidato-card mb-3\" data-candidato-id=\"${usuario.id}\" data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\" data-tiene-pruebas-requeridas=\"${usuario_vacante.tiene_pruebas_requeridas || false}\">\n   461→            <div class=\"card-body p-3\">\n   462→                <div class=\"d-flex align-items-center gap-3\">\n   463→                    ${checkbox_html}\n   464→                    <div class=\"position-relative d-flex flex-column align-items-center justify-content-center text-center\">\n   465→                        <img class=\"candidato-avatar ${borde_color}\"\n   466→                            onclick=\"verDetalleCandidato(${usuario.id})\"\n   467→                            src=\"/usuarios-imagen/${usuario.id}\"\n   468→                            ${crearTooltip({\n   469→                                placement: `bottom`,\n   470→                                content: `Ver detalle del candidato`,\n   471→                                toggle: `popover`,\n   472→                            })}>\n   473→\n   474→                        ${(adecuacion !== null && adecuacion > 0) ? `\n   475→                            <span class=\"candidato-badge-detalle text-label-1 badge ${etiqueta_estilo} position-absolute\">\n   476→                                ${adecuacion ? `${adecuacion}%` : ''}\n   477→                            </span>\n   478→                        ` : ''}\n   479→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"3d83ca90-51f7-4a57-b198-3948f6dcc541","timestamp":"2026-01-20T23:06:17.658Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","content":"    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    var tiene_motivo_abandono = origen === 'modal' && usuario_vacante.etapa_descarte?.motivo_abandono !== null;\n\n    var checkbox_html = !tiene_motivo_abandono ?\n        crearCheckbox({\n            id: `candidato-check-${usuario_vacante.id}`,\n            name: `candidato_check`,\n            value: usuario_vacante.id,\n            class: 'candidato-checkbox',\n            input_container_class: 'd-inline-block'\n        }) : '';\n\n    var etapa_descarte_html = origen === 'modal' && usuario_vacante.etapa_descarte ?\n        `${crearTag({\n            texto: `Etapa de descarte: ${usuario_vacante.etapa_descarte.nombre}`,\n            class: 'tag-tonal-orange w-fit-content',\n        })}` : '';\n\n    var fecha_notificacion = '';\n    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {\n        var fecha = new Date(usuario_vacante.fecha_notificacion);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }\n\n\n    return `\n        <div class=\"card candidato-card mb-3\" data-candidato-id=\"${usuario.id}\" data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\" data-tiene-pruebas-requeridas=\"${usuario_vacante.tiene_pruebas_requeridas || false}\">\n            <div class=\"card-body p-3\">\n                <div class=\"d-flex align-items-center gap-3\">\n                    ${checkbox_html}\n                    <div class=\"position-relative d-flex flex-column align-items-center justify-content-center text-center\">\n                        <img class=\"candidato-avatar ${borde_color}\"\n                            onclick=\"verDetalleCandidato(${usuario.id})\"\n                            src=\"/usuarios-imagen/${usuario.id}\"\n                            ${crearTooltip({\n                                placement: `bottom`,\n                                content: `Ver detalle del candidato`,\n                                toggle: `popover`,\n                            })}>\n\n                        ${(adecuacion !== null && adecuacion > 0) ? `\n                            <span class=\"candidato-badge-detalle text-label-1 badge ${etiqueta_estilo} position-absolute\">\n                                ${adecuacion ? `${adecuacion}%` : ''}\n                            </span>\n                        ` : ''}\n","numLines":60,"startLine":420,"totalLines":1845}},"sourceToolAssistantUUID":"7029f6a3-615d-46f7-bd84-4f5ebd6514c6"}
{"parentUuid":"3d83ca90-51f7-4a57-b198-3948f6dcc541","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01USYVHDcyQzGcnzMspTQeHW","type":"message","role":"assistant","content":[{"type":"text","text":"Veo que usa `usuario_vacante.fecha_notificacion`. Necesito agregar lógica para usar `created_at` en su lugar. Voy a crear una nueva variable para la fecha de descarte usando `created_at`."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1337,"cache_read_input_tokens":44860,"cache_creation":{"ephemeral_5m_input_tokens":1337,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKU8xXDcmA61NrdjkfdQ","type":"assistant","uuid":"60b0ebb2-0632-4408-8a5c-d44708fb1eba","timestamp":"2026-01-20T23:06:21.565Z"}
{"parentUuid":"60b0ebb2-0632-4408-8a5c-d44708fb1eba","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01USYVHDcyQzGcnzMspTQeHW","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01L8HTtSG2JTRDtGiMGpzxbw","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","old_string":"    var fecha_notificacion = '';\n    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {\n        var fecha = new Date(usuario_vacante.fecha_notificacion);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }","new_string":"    var fecha_descarte = '';\n    if (origen === 'modal' && usuario_vacante.created_at) {\n        var fecha = new Date(usuario_vacante.created_at);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_descarte = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1337,"cache_read_input_tokens":44860,"cache_creation":{"ephemeral_5m_input_tokens":1337,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKU8xXDcmA61NrdjkfdQ","type":"assistant","uuid":"b0c16733-a603-4b64-a9ed-8e3a2b84d853","timestamp":"2026-01-20T23:06:29.901Z"}
{"type":"file-history-snapshot","messageId":"b0c16733-a603-4b64-a9ed-8e3a2b84d853","snapshot":{"messageId":"619d6e07-345e-4b1f-8621-2f91f8468c60","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v5","version":5,"backupTime":"2026-01-20T23:06:03.941Z"},"public\\js\\vacantes\\detalles\\detalle-etapas.js":{"backupFileName":"dccddb1063a31949@v1","version":1,"backupTime":"2026-01-20T23:07:29.598Z"}},"timestamp":"2026-01-20T23:06:03.926Z"},"isSnapshotUpdate":true}
{"parentUuid":"b0c16733-a603-4b64-a9ed-8e3a2b84d853","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01L8HTtSG2JTRDtGiMGpzxbw","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   445→            texto: `Etapa de descarte: ${usuario_vacante.etapa_descarte.nombre}`,\n   446→            class: 'tag-tonal-orange w-fit-content',\n   447→        })}` : '';\n   448→\n   449→    var fecha_descarte = '';\n   450→    if (origen === 'modal' && usuario_vacante.created_at) {\n   451→        var fecha = new Date(usuario_vacante.created_at);\n   452→        var dia = fecha.getDate();\n   453→        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n   454→        var anio = fecha.getFullYear();\n   455→        fecha_descarte = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n   456→    }\n   457→\n   458→\n   459→    return `\n   460→        <div class=\"card candidato-card mb-3\" data-candidato-id=\"${usuario.id}\" data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\" data-tiene-pruebas-requeridas=\"${usuario_vacante.tiene_pruebas_requeridas || false}\">"}]},"uuid":"a8864276-b70c-4de3-afd0-7fc3a5b53b79","timestamp":"2026-01-20T23:07:29.662Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","oldString":"    var fecha_notificacion = '';\n    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {\n        var fecha = new Date(usuario_vacante.fecha_notificacion);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }","newString":"    var fecha_descarte = '';\n    if (origen === 'modal' && usuario_vacante.created_at) {\n        var fecha = new Date(usuario_vacante.created_at);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_descarte = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }","originalFile":"/**\n * Archivo para el manejo de etapas en el detalle de vacantes\n * @author Andres Morales\n*/\n\nlet candidatos_descartados = [];\nlet candidatos_seleccionados = [];\nlet json_filtros_etapas = {};\nlet es_primera_carga = true;\nlet posicion_scroll_guardada = 0;\n\n$(document).ready(function() {\n    consultarPaisesListadoCompleto(true);\n    observarCambiosChips();\n    cargarEtapasConCandidatos();\n});\n\n/**\n * Cargar etapas de la vacante con sus candidatos desde el endpoint.\n *\n * @param {Object} filtros Objeto con filtros a aplicar (opcional).\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction cargarEtapasConCandidatos(filtros = {}) {\n    // Guardar posición del scroll antes de actualizar (solo si no es la primera carga)\n    if (!es_primera_carga) {\n        var $contenedor = $('#contenido-etapas-lista');\n        if ($contenedor.length) {\n            posicion_scroll_guardada = $contenedor.scrollLeft();\n        }\n    }\n\n    $.ajax({\n        url: `/etapas-vacantes-aplicantes/${VACANTE_ID}`,\n        type: 'GET',\n        dataType: 'json',\n        data: {\n            ciudad_id: filtros.ciudad_id || '',\n            departamento_id: filtros.departamento_id || '',\n            pais_id: filtros.pais_id || '',\n            etapa_id: filtros.etapa_id || '',\n            nivel_educativo_id: filtros.nivel_educativo_id || '',\n            fecha_desde: filtros.fecha_desde || '',\n            fecha_hasta: filtros.fecha_hasta || '',\n            edad: filtros.edad || '',\n            chips: filtros.chips,\n            nivel_adecuacion: filtros.nivel_adecuacion || ''\n        },\n        success: function(respuesta) {\n            let datos = respuesta.data;\n            renderizarEtapas(datos.etapas, calcularTotalCandidatos(datos.etapas) + datos.descartados.length);\n            actualizarConteoDescartados(datos.descartados.length);\n\n            candidatos_descartados = datos.descartados;\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Calcular el total de candidatos en todas las etapas.\n *\n * @param {Array} etapas Array de etapas con candidatos.\n * @returns {number} Total de candidatos.\n * @author Andres Morales\n */\nfunction calcularTotalCandidatos(etapas) {\n    let total = 0;\n    etapas.forEach(etapa => {\n        if (etapa.usuarios_vacantes) {\n            total += etapa.usuarios_vacantes.length;\n        }\n    });\n    return total;\n}\n\n/**\n * Observar cambios en el contenedor de chips para mostrar/ocultar el wrapper.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction observarCambiosChips() {\n    var $contenedor_chips = $('#contenedor-chips-etapa-filtro-candidatos');\n    var $envolvente = $('#contenedor-chips-wrapper-etapa-filtro-candidatos');\n\n    if ($contenedor_chips.length === 0 || $envolvente.length === 0) return;\n\n    var observador = new MutationObserver(function() {\n        var tiene_chips = $contenedor_chips.children().length > 0;\n\n        if (tiene_chips) {\n            $envolvente.removeClass('d-none');\n        } else {\n            $envolvente.addClass('d-none');\n        }\n    });\n\n    observador.observe($contenedor_chips[0], {\n        childList: true,\n        subtree: false\n    });\n}\n\n/**\n * Actualizar el conteo de aplicantes en el botón.\n *\n * @param {number} conteo Número de candidatos aplicantes.\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarConteoAplicantes(conteo) {\n    $('#etapa-total-candidatos').text(`${conteo}`);\n}\n\n/**\n * Actualizar el badge de conteo de descartados.\n *\n * @param {number} conteo Número de candidatos descartados.\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarConteoDescartados(conteo) {\n    $('#etapa-total-descartados').text(conteo);\n}\n\n/**\n * Cargar las etapas en el select2 del filtro.\n *\n * @param {Array} etapas Array de etapas de la vacante.\n * @returns {void}\n * @author Andres Morales\n */\nfunction cargarEtapasEnFiltro(etapas) {\n    var $select_etapa_filtro = $('#etapa_filtro');\n\n    if (!$select_etapa_filtro.length) return;\n\n    $select_etapa_filtro.empty();\n\n    var opcion_todas = new Option('Todas', '', false, false);\n    $select_etapa_filtro.append(opcion_todas);\n\n    etapas.sort((a, b) => a.orden - b.orden);\n\n    etapas.forEach(function(etapa) {\n        var opcion = new Option(etapa.nombre, etapa.id, false, false);\n        $select_etapa_filtro.append(opcion);\n    });\n\n    $select_etapa_filtro.trigger('change');\n}\n\n/**\n * Animar scroll horizontal del contenedor de etapas.\n * Desplaza desde el final hasta el inicio (solo en primera carga).\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction animarScrollEtapas() {\n    var $contenedor = $('#contenido-etapas-lista');\n\n    if (!$contenedor.length) return;\n\n    var ancho_scroll = $contenedor[0].scrollWidth - $contenedor[0].clientWidth;\n\n    if (ancho_scroll <= 0) return;\n\n    // Posicionar al final primero\n    $contenedor.scrollLeft(ancho_scroll);\n\n    // Animar de final a inicio\n    $contenedor.animate(\n        { scrollLeft: 0 },\n        {\n            duration: 1500,\n            easing: 'swing'\n        }\n    );\n}\n\n/**\n * Renderizar las etapas de la vacante en cards horizontales.\n *\n * @param {Array} etapas Array de etapas de la vacante.\n * @param {number} conteo_aplicantes Cantidad de aplicantes de la vacante.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author Jair Carvajal\n */\nfunction renderizarEtapas(etapas, conteo_aplicantes) {\n    var $contenido_lista = $('#contenido-etapas-lista');\n    var $contenido_vacio = $('#contenido-etapas-empty');\n    var $contenido_controles = $('#contenido-etapas-controles');\n\n    // Verificar si hay filtros activos\n    var hay_filtros_activos = Object.keys(json_filtros_etapas).length > 0;\n\n    // Solo mostrar empty state si NO hay aplicantes Y NO hay filtros activos\n    if ((!conteo_aplicantes || conteo_aplicantes === 0) && !hay_filtros_activos) {\n        $contenido_lista.addClass('d-none');\n        $contenido_controles.addClass('d-none');\n        $contenido_vacio.removeClass('d-none');\n        return;\n    }\n\n    $contenido_vacio.addClass('d-none');\n    $contenido_lista.removeClass('d-none');\n    $contenido_controles.removeClass('d-none');\n\n    if (!etapas || etapas.length === 0) {\n        $contenido_lista.html(`\n            <div class=\"w-100 text-center py-5\">\n                <p class=\"text-muted\">${hay_filtros_activos ? 'No se encontraron coincidencias con los filtros aplicados. vuelve a intentar con otros filtros' : 'No hay etapas configuradas para esta vacante'}</p>\n            </div>\n        `);\n        return;\n    }\n\n    let html = '';\n    etapas.sort((a, b) => a.orden - b.orden);\n\n    // Filtrar la etapa con el orden inmediatamente anterior al orden 8 (Contratados)\n    let etapa_anterior_orden_8 = etapas\n        .filter(etapa => etapa.orden < 8)\n        .sort((a, b) => b.orden - a.orden)[0];\n\n    etapas.forEach((etapa) => {\n        html += crearTarjetaEtapa(etapa, etapa_anterior_orden_8);\n    });\n\n    $contenido_lista.html(html);\n\n    cargarEtapasEnFiltro(etapas);\n\n    // Ejecutar animación solo en la primera carga, de lo contrario restaurar posición\n    if (es_primera_carga) {\n        animarScrollEtapas();\n        es_primera_carga = false;\n    } else {\n        // Restaurar la posición del scroll guardada\n        setTimeout(() => {\n            $contenido_lista.scrollLeft(posicion_scroll_guardada);\n        }, 50);\n    }\n\n    inicializarEventosCheckboxes();\n\n    // Inicializar tooltips después de renderizar\n    setTimeout(() => {\n        inicializarTooltips();\n    }, 100);\n}\n\n/**\n * Crear una tarjeta(card) de etapa.\n *\n * @param {Object} etapa Datos de la etapa.\n * @param {Object} etapa_anterior_orden_8 Etapa con el orden inmediatamente anterior al orden 8.\n * @returns {string} HTML de la card.\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author Jair Carvajal\n */\nfunction crearTarjetaEtapa(etapa, etapa_anterior_orden_8) {\n    let etapa_anterior_contracion = false;\n\n    if (etapa_anterior_orden_8 && etapa.orden === etapa_anterior_orden_8.orden && etapa.activa == 1) {\n        etapa_anterior_contracion = true;\n    }\n\n    // Detectar si es etapa de prueba técnica sin archivos\n    let es_prueba_tecnica = etapa.nombre === 'Prueba técnica';\n    let tiene_prueba_tecnica_cargada = etapa?.prueba_cargada ?? true;\n\n    let candidatos_html = '';\n    let candidatos_totales = 0;\n    let candidatos_completaron = 0;\n\n    // Mostrar mensaje si es prueba técnica sin archivos\n    if (es_prueba_tecnica && !tiene_prueba_tecnica_cargada) {\n        let html = crearMensajeSinArchivosInstrucciones(etapa.id);\n\n        // Si hay candidatos, agregarlos después del mensaje\n        if (etapa?.usuarios_vacantes?.length > 0) {\n            etapa.usuarios_vacantes.forEach((usuario_vacante) => {\n                html += crearCardCandidato(usuario_vacante, 'listado', etapa.nombre, etapa_anterior_contracion);\n            });\n            candidatos_totales = etapa.usuarios_vacantes.length;\n            candidatos_completaron = etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.puntaje !== null || usuario_vacante.puntaje_ia !== null).length;\n        }\n\n        candidatos_html = `<div class=\"candidatos-container\">${html}</div>`;\n    } else if (etapa?.usuarios_vacantes?.length > 0) {\n        let html = '';\n\n        etapa.usuarios_vacantes.forEach((usuario_vacante) => {\n            html += crearCardCandidato(usuario_vacante, 'listado', etapa.nombre, etapa_anterior_contracion);\n        });\n\n        candidatos_html = `<div class=\"candidatos-container\">${html}</div>`;\n        candidatos_totales = etapa.usuarios_vacantes.length;\n        candidatos_completaron = etapa.nombre === 'Documentos para contratación'\n            ? etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.etapa_completada === true).length\n            : etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.puntaje !== null || usuario_vacante.puntaje_ia !== null).length;\n    } else {\n        candidatos_html = `\n            <div class=\"d-flex justify-content-center align-items-center my-5\"><div class=\"etapa-icono-circulo\"><i class=\"bi bi-arrow-90deg-right\"></i></div></div>\n            <div class=\"mt-auto pb-10 px-5\"><p class=\"text-headline-5 text-gray-40 text-center mb-5 pb-10 px-6\">Mueve candidatos con el botón o arrástralos desde la etapa anterior. </p></div>\n        `;\n    }\n    return `\n        <div class=\"card etapa-card bg-gray-90\" data-etapa-id=\"${etapa.id}\">\n            <div class=\"card-body d-flex flex-column\">\n                <div class=\"d-flex align-items-center mb-3 gap-3\">\n                    ${crearCheckbox({\n                        id: 'etapa-check-' + etapa.id,\n                        name: 'etapa_check',\n                        value: etapa.id,\n                        checked: false,\n                        input_container_class: 'd-inline-block',\n                        disabled: (candidatos_totales > 0) ? false : true\n                    })}\n                    <h6 class=\"etapa-titulo text-headline-5 fw-bold mb-0\">${etapa.nombre}</h6>\n                    ${(candidatos_totales > 0 && etapa.nombre !== 'Contratados') ?\n                        `<div class=\"ms-auto\">\n                            ${crearTag({\n                                texto: candidatos_completaron + '/' + candidatos_totales + ' completaron la tarea',\n                                class: etapa.nombre === 'Documentos para contratación' ? 'tag-tonal-green' : 'tag-tonal-blue',\n                            })}\n                        </div>`\n                    : ''}\n                </div>\n                ${candidatos_html}\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Ver candidatos descartados en modal.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction verCandidatosDescartados() {\n    let $contenedor = $('#contenedor-candidatos-descartados');\n    let $controles = $('#controles-candidatos-descartados');\n\n    if (candidatos_descartados.length === 0) {\n        $controles.addClass('d-none');\n        $contenedor.html(`\n            <div class=\"row justify-content-center align-items-center py-5\">\n                <div class=\"col-auto text-center\">\n                    <div class=\"mb-4\">\n                        <i class=\"bi bi-person-x-fill empty-state-icon\"></i>\n                    </div>\n                    <div class=\"text-gray-30 fw-semibold text-headline-4 mb-3\">\n                        No hay candidatos descartados\n                    </div>\n                    <div class=\"text-gray-50 text-body-2\">\n                        Los candidatos que descartaste aparecerán aquí\n                    </div>\n                </div>\n            </div>\n        `);\n    } else {\n        $controles.removeClass('d-none');\n        let html = '';\n        candidatos_descartados.forEach(candidato => {\n            html += crearCardCandidato(candidato, 'modal');\n        });\n        $contenedor.html(html);\n\n        setTimeout(() => {\n            inicializarTooltips();\n            inicializarEventosModalDescartados();\n        }, 100);\n    }\n\n    $('#modal-candidatos-descartados').modal('show');\n}\n\n/**\n * Crear una card individual de candidato.\n *\n * @param {Object} usuario_vacante Datos del candidato aplicante.\n * @param {string} origen Origen del render: 'listado' o 'modal'. Default: 'listado'\n * @param {string} nombre_etapa Nombre de la etapa actual. Default: null\n * @returns {string} HTML de la card del candidato.\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidato(usuario_vacante, origen = 'listado', nombre_etapa = null, etapa_anterior_contracion = false) {\n    var usuario = usuario_vacante.usuario || {};\n    var nombre_completo = usuario.nombre_completo?.trim() || 'Sin nombre';\n    var salario = usuario?.perfiles_laborales[0]?.salario || 0;\n    var salario_maximo = usuario?.perfiles_laborales[0]?.salario_maximo || 0;\n\n    var salario_solicitado = (salario_maximo > 0) ? `Salario: ${formatearSalario(salario)} a ${formatearSalario(salario_maximo)}` : `Solicita ${formatearSalario(salario)}`;\n    var experiencia_meses = usuario?.perfiles_laborales[0]?.experiencia_laboral_meses || 0;\n    var experiencia = convertirMesesAAnios(experiencia_meses);\n\n    var ciudad = usuario.ciudad?.nombre || '';\n    var pais = usuario.ciudad?.departamento?.pais?.nombre || '';\n    var ubicacion = `${ciudad}${ciudad && pais ? ',' : ''}${pais}`;\n    \n    var documento = usuario.documento || '';\n\n    var adecuacion = usuario_vacante.adecuacion;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    var tiene_motivo_abandono = origen === 'modal' && usuario_vacante.etapa_descarte?.motivo_abandono !== null;\n\n    var checkbox_html = !tiene_motivo_abandono ?\n        crearCheckbox({\n            id: `candidato-check-${usuario_vacante.id}`,\n            name: `candidato_check`,\n            value: usuario_vacante.id,\n            class: 'candidato-checkbox',\n            input_container_class: 'd-inline-block'\n        }) : '';\n\n    var etapa_descarte_html = origen === 'modal' && usuario_vacante.etapa_descarte ?\n        `${crearTag({\n            texto: `Etapa de descarte: ${usuario_vacante.etapa_descarte.nombre}`,\n            class: 'tag-tonal-orange w-fit-content',\n        })}` : '';\n\n    var fecha_notificacion = '';\n    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {\n        var fecha = new Date(usuario_vacante.fecha_notificacion);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }\n\n\n    return `\n        <div class=\"card candidato-card mb-3\" data-candidato-id=\"${usuario.id}\" data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\" data-tiene-pruebas-requeridas=\"${usuario_vacante.tiene_pruebas_requeridas || false}\">\n            <div class=\"card-body p-3\">\n                <div class=\"d-flex align-items-center gap-3\">\n                    ${checkbox_html}\n                    <div class=\"position-relative d-flex flex-column align-items-center justify-content-center text-center\">\n                        <img class=\"candidato-avatar ${borde_color}\"\n                            onclick=\"verDetalleCandidato(${usuario.id})\"\n                            src=\"/usuarios-imagen/${usuario.id}\"\n                            ${crearTooltip({\n                                placement: `bottom`,\n                                content: `Ver detalle del candidato`,\n                                toggle: `popover`,\n                            })}>\n\n                        ${(adecuacion !== null && adecuacion > 0) ? `\n                            <span class=\"candidato-badge-detalle text-label-1 badge ${etiqueta_estilo} position-absolute\">\n                                ${adecuacion ? `${adecuacion}%` : ''}\n                            </span>\n                        ` : ''}\n\n                        ${ubicacion ? `\n                            <div class=\"d-flex align-items-center gap-2 mt-3\">\n                                <span class=\"text-label-2 text-gray-30\">${ubicacion}</span>\n                            </div>\n                        ` : ''}\n                    </div>\n                    <div class=\"flex-grow-1\">\n                        <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>\n                        <div class=\"candidato-info d-flex flex-column gap-1\">\n                            ${etapa_descarte_html}\n                            ${(origen === 'modal' && fecha_notificacion) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n                                </div>\n                            ` : ''}\n                            ${documento ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <img width=\"12\" heigth=\"16\" src=\"/iconos/file-person.png\">\n                                    <span class=\"text-label-2\">No. documento: ${documento}</span>\n                                </div>\n                            ` : ''}\n                            ${experiencia ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-briefcase\"></i>\n                                    <span class=\"text-label-2\">Experiencia: ${experiencia}</span>\n                                </div>\n                            ` : ''}\n                            ${salario_solicitado ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-currency-dollar\"></i>\n                                    <span class=\"text-label-2\">${salario_solicitado}</span>\n                                </div>\n                            ` : ''}\n                        </div>\n                    </div>\n\n                    <div class=\"d-flex flex-column align-items-end gap-2\">\n                        ${generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono)}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Ver y calificar candidato.\n *\n * @param {number} candidato_id ID del candidato.\n * @returns {void}\n * @author Andres Morales\n */\nfunction verCalificarCandidatos(candidato_id) {\n    mostrarToast('info','Calificar candidato:', candidato_id);\n}\n\n/**\n * Mover candidato a la siguiente etapa.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n * @author Sergio Vargas - Modificación para modal de competencias\n */\nfunction moverEtapaCandidato(etapa_vacante_usuario_id) {\n    verificarSiguienteEtapa(etapa_vacante_usuario_id, function(es_contratados) {\n        if (es_contratados) {\n            // Obtener el valor de tiene_pruebas_requeridas desde el atributo data de la card\n            var $contenedor_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n            var tiene_pruebas = $contenedor_candidato.attr('data-tiene-pruebas-requeridas') === 'true';\n\n            if (tiene_pruebas) {\n                mostrarModalCompetenciasMejorar(etapa_vacante_usuario_id);\n            } else {\n                Swal.fire({\n                    width: '533px',\n                    showCloseButton: true,\n                    closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n                    showConfirmButton: false,\n                    showDenyButton: false,\n                    showCancelButton: false,\n                    html: `\n                        <div class=\"row w-100 mx-0 mt-2\">\n                            <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Confirmar contratación</div>\n                            <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                                Estás a punto de pasar a Contratados al canditato seleccionado y finalizar esta vacante.\n                            </div>\n                            <div class=\"col-12 mt-5 text-start text-body-2 fw-semibold\">\n                                ¿Deseas continuar?\n                            </div>\n                            <div class=\"col-6 mt-5 mb-2\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary w-100 justify-content-center',\n                                    texto: 'Volver',\n                                    onclick: `Swal.clickDeny();`\n                                })}\n                            </div>\n                            <div class=\"col-6 mt-5 mb-2\">\n                                ${crearBoton({\n                                    clases: 'btn-primary w-100 justify-content-center',\n                                    texto: 'Continuar con la contratación',\n                                    onclick: `Swal.clickConfirm();`\n                                })}\n                            </div>\n                        </div>\n                    `,\n                }).then(async (resultado) => {\n                    if (resultado.isConfirmed) {\n                        ejecutarMovimientoEtapa(etapa_vacante_usuario_id);\n                    }\n                });\n            }\n        } else {\n            ejecutarMovimientoEtapa(etapa_vacante_usuario_id);\n        }\n    });\n}\n\n/**\n * Inicializar eventos de checkboxes.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction inicializarEventosCheckboxes() {\n    $(document).off('change', 'input[name=\"candidato_check\"]');\n    $(document).on('change', 'input[name=\"candidato_check\"]', function() {\n        let $etapa_tarjeta = $(this).closest('.etapa-card');\n        validarEstadoCheckboxEtapa($etapa_tarjeta);\n\n        actualizarContadorSeleccionados();\n        actualizarEstadoBotonDescartar();\n    });\n\n    $(document).off('change', 'input[name=\"etapa_check\"]');\n    $(document).on('change', 'input[name=\"etapa_check\"]', function() {\n        let comprobado = $(this).is(':checked');\n\n        let $etapa_tarjeta = $(this).closest('.etapa-card');\n        $etapa_tarjeta.find('input[name=\"candidato_check\"]').prop('checked', comprobado);\n\n        actualizarContadorSeleccionados();\n        actualizarEstadoBotonDescartar();\n    });\n}\n\n/**\n * Validar y actualizar el estado del checkbox de una etapa según sus candidatos.\n *\n * @param {jQuery} $etapa_tarjeta Card de la etapa a validar.\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarEstadoCheckboxEtapa($etapa_tarjeta) {\n    let $checkbox_etapa = $etapa_tarjeta.find('input[name=\"etapa_check\"]');\n    let $checkboxes_candidatos = $etapa_tarjeta.find('input[name=\"candidato_check\"]');\n\n    let total_candidatos = $checkboxes_candidatos.length;\n    let candidatos_seleccionados_etapa = $checkboxes_candidatos.filter(':checked').length;\n\n    if (candidatos_seleccionados_etapa === 0) {\n        $checkbox_etapa.prop('indeterminate', false);\n        $checkbox_etapa.prop('checked', false);\n    } else if (candidatos_seleccionados_etapa === total_candidatos) {\n        $checkbox_etapa.prop('indeterminate', false);\n        $checkbox_etapa.prop('checked', true);\n    } else {\n        $checkbox_etapa.prop('indeterminate', true);\n        $checkbox_etapa.prop('checked', false);\n    }\n}\n\n/**\n * Actualizar el contador de candidatos seleccionados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarContadorSeleccionados() {\n    let checkboxes_seleccionados = $('input[name=\"candidato_check\"]:checked');\n    let contador = checkboxes_seleccionados.length;\n\n    $('#etapa-total-seleccionados').text(contador);\n\n    candidatos_seleccionados = checkboxes_seleccionados.map(function() {\n        return parseInt($(this).val(), 10);\n    }).get();\n}\n\n/**\n * Actualizar estado del botón de descartar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarEstadoBotonDescartar() {\n    let hay_seleccionados = candidatos_seleccionados.length > 0;\n\n    if (hay_seleccionados) {\n        $('#etapa-boton-descartar').prop('disabled', false);\n        $('#etapa-boton-descartar').attr('onclick', 'descartarCandidatos()');\n    } else {\n        $('#etapa-boton-descartar').prop('disabled', true);\n        $('#etapa-boton-descartar').attr('onclick', '');\n    }\n}\n\n/**\n * Aplicar filtros y recargar etapas.\n *\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction aplicarFiltrosDropdown(filtros) {\n    json_filtros_etapas = filtros;\n\n    let filtros_endpoint = {};\n\n    if (filtros.ciudad_filtro) filtros_endpoint.ciudad_id = filtros.ciudad_filtro;\n    if (filtros.departamento_filtro) filtros_endpoint.departamento_id = filtros.departamento_filtro;\n    if (filtros.pais_filtro) filtros_endpoint.pais_id = filtros.pais_filtro;\n    if (filtros.etapa_filtro) filtros_endpoint.etapa_id = filtros.etapa_filtro;\n    if (filtros.nivel_academico_filtro) filtros_endpoint.nivel_educativo_id = filtros.nivel_academico_filtro;\n    if (filtros.edad_filtro) filtros_endpoint.edad = filtros.edad_filtro;\n    if (filtros.nivel_adecuacion_filtro) filtros_endpoint.nivel_adecuacion = filtros.nivel_adecuacion_filtro;\n\n    if (filtros.fecha_agregado_filtro) {\n        let partes_fecha = filtros.fecha_agregado_filtro.split(' a ');\n        if (partes_fecha[0]) filtros_endpoint.fecha_desde = partes_fecha[0];\n        if (partes_fecha[1]) filtros_endpoint.fecha_hasta = partes_fecha[1];\n    }\n\n    if (filtros.chips && filtros.chips.length > 0) {\n        filtros_endpoint.chips = filtros.chips;\n    }\n\n    cargarEtapasConCandidatos(filtros_endpoint);\n}\n\n/**\n * Preparar objeto de filtros actuales para recargar etapas.\n *\n * @returns {Object} Objeto con filtros actuales.\n * @author Andres Morales\n */\nfunction prepararFiltrosActuales() {\n    let filtros_endpoint = {};\n\n    if (json_filtros_etapas.ciudad_filtro) filtros_endpoint.ciudad_id = json_filtros_etapas.ciudad_filtro;\n    if (json_filtros_etapas.departamento_filtro) filtros_endpoint.departamento_id = json_filtros_etapas.departamento_filtro;\n    if (json_filtros_etapas.pais_filtro) filtros_endpoint.pais_id = json_filtros_etapas.pais_filtro;\n    if (json_filtros_etapas.etapa_filtro) filtros_endpoint.etapa_id = json_filtros_etapas.etapa_filtro;\n    if (json_filtros_etapas.nivel_academico_filtro) filtros_endpoint.nivel_educativo_id = json_filtros_etapas.nivel_academico_filtro;\n    if (json_filtros_etapas.edad_filtro) filtros_endpoint.edad = json_filtros_etapas.edad_filtro;\n\n    if (json_filtros_etapas.fecha_agregado_filtro) {\n        let partes_fecha = json_filtros_etapas.fecha_agregado_filtro.split(' a ');\n        if (partes_fecha[0]) filtros_endpoint.fecha_desde = partes_fecha[0];\n        if (partes_fecha[1]) filtros_endpoint.fecha_hasta = partes_fecha[1];\n    }\n\n    if (json_filtros_etapas.chips && json_filtros_etapas.chips.length > 0) {\n        filtros_endpoint.chips = json_filtros_etapas.chips;\n    }\n\n    return filtros_endpoint;\n}\n\n/**\n * Inicializar eventos del modal de candidatos descartados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction inicializarEventosModalDescartados() {\n    // Evento para checkboxes en modal de descartados\n    $('#contenedor-candidatos-descartados').off('change', 'input[name=\"candidato_check\"]');\n    $('#contenedor-candidatos-descartados').on('change', 'input[name=\"candidato_check\"]', function() {\n        actualizarEstadoBotonRevertirDescarte();\n    });\n\n    // Evento para búsqueda en candidatos descartados\n    $('#buscar-candidatos-descartados').off('input');\n    $('#buscar-candidatos-descartados').on('input', function() {\n        let termino_busqueda = $(this).val().toLowerCase().trim();\n        filtrarCandidatosDescartados(termino_busqueda);\n    });\n\n    // Limpiar búsqueda al cerrar el modal\n    $('#modal-candidatos-descartados').off('hidden.bs.modal');\n    $('#modal-candidatos-descartados').on('hidden.bs.modal', function() {\n        $('#buscar-candidatos-descartados').val('');\n        $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]').prop('checked', false);\n        $('#boton-revertir-descarte-masivo').prop('disabled', true);\n    });\n}\n\n/**\n * Actualizar estado del botón de revertir descarte masivo.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarEstadoBotonRevertirDescarte() {\n    let checkboxes_seleccionados = $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]:checked');\n    let hay_seleccionados = checkboxes_seleccionados.length > 0;\n\n    $('#boton-revertir-descarte-masivo').prop('disabled', !hay_seleccionados);\n}\n\n/**\n * Filtrar candidatos descartados por término de búsqueda.\n *\n * @param {string} termino Término de búsqueda.\n * @returns {void}\n * @author Andres Morales\n */\nfunction filtrarCandidatosDescartados(termino) {\n    $('#contenedor-candidatos-descartados .candidato-card').each(function() {\n        let $tarjeta = $(this);\n        let nombre = $tarjeta.find('.candidato-nombre').text().toLowerCase();\n        let ubicacion = $tarjeta.find('.bi-geo-alt').next('span').text().toLowerCase();\n        let etapa_descarte = $tarjeta.find('.tag-tonal-orange').text().toLowerCase();\n\n        let coincide = nombre.includes(termino) || ubicacion.includes(termino) || etapa_descarte.includes(termino);\n\n        if (coincide || termino === '') {\n            $tarjeta.removeClass('d-none');\n        } else {\n            $tarjeta.addClass('d-none');\n        }\n    });\n}\n\n/**\n * Revertir descarte de un candidato individual.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction devolverDescarteCandidato(etapa_vacante_usuario_id) {\n    revertirDescarte([etapa_vacante_usuario_id]);\n}\n\n/**\n * Revertir descarte de candidatos seleccionados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction revertirDescarteMasivo() {\n    let checkboxes_seleccionados = $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]:checked');\n\n    if (checkboxes_seleccionados.length === 0) {\n        mostrarToast('warning', 'Selecciona al menos un candidato para revertir el descarte');\n        return;\n    }\n\n    let revertir_ids = checkboxes_seleccionados.map(function() {\n        return parseInt($(this).val(), 10);\n    }).get();\n\n    revertirDescarte(revertir_ids);\n}\n\n/**\n * Revertir descarte de uno o varios candidatos con confirmación.\n *\n * @param {Array} ids Array de IDs de relaciones etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction revertirDescarte(ids) {\n    let cantidad = ids.length;\n\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Revertir descarte?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                   ¿Estás seguro que deseas revertir el descarte ${cantidad === 1 ? 'del candidato' : 'de los candidatos'}?\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Revertir',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed) {\n            ejecutarRevertirDescarte(ids);\n        }\n    });\n}\n\n/**\n * Ejecutar la reversión de descarte.\n *\n * @param {Array} ids Array de IDs de relaciones etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction ejecutarRevertirDescarte(ids) {\n    if (ids.length > 1) {\n        $('#boton-revertir-descarte-masivo').prop('disabled', true).html('<i class=\"bi bi-hourglass-split\"></i> Procesando...');\n    }\n\n    $.ajax({\n        url: '/vacantes-revertir-descarte-aplicantes',\n        type: 'POST',\n        dataType: 'json',\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        data: {\n            ids: ids\n        },\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message || 'Descarte revertido exitosamente');\n            $('#modal-candidatos-descartados').modal('hide');\n            cargarEtapasConCandidatos(prepararFiltrosActuales());\n        },\n        error: function(xhr) {\n            var mensaje = xhr.responseJSON?.message || 'Error al revertir el descarte';\n            mostrarToast('danger', mensaje);\n        },\n        complete: function() {\n            if (ids.length > 1) {\n                $('#boton-revertir-descarte-masivo').prop('disabled', false).html('Revertir descarte');\n            }\n        }\n    });\n}\n\n/**\n * Verificar si la siguiente etapa es \"Contratados\".\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @param {function} callback Función callback con resultado booleano.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction verificarSiguienteEtapa(etapa_vacante_usuario_id, callback) {\n    var $contenedor_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n    var $etapa_contenedor = $contenedor_candidato.closest('.etapa-card');\n    var $siguiente_etapa = $etapa_contenedor.next('.etapa-card');\n\n    if ($siguiente_etapa.length > 0) {\n        var nombre_siguiente_etapa = $siguiente_etapa.find('.etapa-titulo').text().trim();\n        callback(nombre_siguiente_etapa === 'Contratados');\n    } else {\n        callback(false);\n    }\n}\n\n/**\n * Ejecutar el movimiento de etapa (flujo normal).\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @returns {void}\n * @author Sergio Vargas\n * @author Andres Gonzalez\n * @author Jair Carvajal\n * @author Andres Morales\n * @author Esperanza Olivo\n */\nfunction ejecutarMovimientoEtapa(etapa_vacante_usuario_id) {\n    var botones_mover_etapa = $(`.btn-mover-etapa-accion[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n    botones_mover_etapa.prop('disabled', true);\n\n    var modal_detalle_abierto = $('#modal-detalle-resultados').hasClass('show');\n\n    if (modal_detalle_abierto) {\n        moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n        return;\n    }\n\n    var seccion_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n\n    if (seccion_candidato.length > 0) {\n        var etapa_actual = seccion_candidato.closest('.etapa-card');\n        var etapa_siguiente = etapa_actual.next('.etapa-card');\n\n        if (etapa_siguiente.length > 0) {\n            // Ejecutar animación\n            animarMovimientoEtapaCandidato(seccion_candidato, etapa_siguiente);\n\n            moverVacantesEtapaAplicante(etapa_vacante_usuario_id, etapa_siguiente);\n        } else {\n            moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n        }\n    } else {\n        moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n    }\n}\n\n/**\n * Animar el movimiento de la tarjeta hacia la siguiente etapa.\n *\n * @param {Object} tarjeta_candidato Tarjeta del candidato.\n * @param {Object} etapa_destino Etapa destino.\n * @returns {void}\n * @author Esperanza Olivo\n */\nfunction animarMovimientoEtapaCandidato(tarjeta_candidato, etapa_destino) {\n    $('#candidato-animacion-temp').remove();\n\n    var posicion_tarjeta = tarjeta_candidato.offset();\n    var ancho_tarjeta = tarjeta_candidato.outerWidth();\n    var alto_tarjeta = tarjeta_candidato.outerHeight();\n    var scroll_vertical = $(window).scrollTop();\n\n    var contenedor_destino = etapa_destino.find('.candidatos-container, .card-body').first();\n    var destino = contenedor_destino.offset();\n    var destino_ancho = contenedor_destino.outerWidth();\n\n    tarjeta_candidato.css('visibility', 'hidden');\n\n    var tarjeta_clon_candidato = tarjeta_candidato.clone().attr('id', 'candidato-animacion-temp').css({\n        position: 'fixed',\n        top: posicion_tarjeta.top - scroll_vertical,\n        left: posicion_tarjeta.left,\n        width: ancho_tarjeta,\n        height: alto_tarjeta,\n        margin: 0,\n        zIndex: 9999,\n        visibility: 'visible',\n        pointerEvents: 'none',\n        boxShadow: '0 8px 25px rgba(0,0,0,0.18)'\n    });\n\n    $('body').append(tarjeta_clon_candidato);\n\n    var tarjetas_destino = contenedor_destino.find('.candidato-card').length;\n    var desplazamiento_vertical = tarjetas_destino * 10;\n\n    tarjeta_clon_candidato.animate({\n        top: destino.top - scroll_vertical + 80 + desplazamiento_vertical + 8, \n        left: destino.left + (destino_ancho - ancho_tarjeta) / 2\n    }, 180, 'swing', function() {\n        tarjeta_clon_candidato.remove();\n        tarjeta_candidato.css('visibility', 'visible');\n        var contenedor_destino = etapa_destino.find('.candidatos-container, .card-body').first();\n        contenedor_destino.append(tarjeta_candidato); \n    });\n}\n\n/**\n * Ejecutar el movimiento de etapa (Envio de ajax).\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @param {jQuery} etapa_siguiente Etapa destino (opcional).\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Morales\n * @author Esperanza Olivo\n */\nfunction moverVacantesEtapaAplicante(etapa_vacante_usuario_id, etapa_siguiente = null) {\n    var tiempo_inicio = Date.now();\n    const DURACION_ANIMACION = 280;\n\n    $.ajax({\n        url: `/vacantes-mover-etapa-aplicante/${etapa_vacante_usuario_id}`,\n        type: 'POST',\n        dataType: 'json',\n        headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n        success: function(respuesta) {\n            var tiempo_transcurrido = Date.now() - tiempo_inicio;\n            var tiempo_espera = Math.max(0, DURACION_ANIMACION - tiempo_transcurrido);\n\n            setTimeout(function() {\n                $('#candidato-animacion-temp').remove();\n                $('#modal-detalle-resultados').modal('hide');\n                mostrarToast('success', respuesta.message);\n\n                var filtros_actuales = prepararFiltrosActuales();\n                cargarEtapasConCandidatos(filtros_actuales);\n\n                if (etapa_siguiente && etapa_siguiente.length > 0) {\n                    setTimeout(function() {\n                        scrollHaciaEtapa(etapa_siguiente);\n                    }, 300);\n                }\n            }, tiempo_espera);\n        },\n        error: function(xhr) {\n            $('#candidato-animacion-temp').remove();\n\n            var mensaje = xhr.responseJSON?.message || 'Error al mover el candidato de etapa';\n            mostrarToast('danger', mensaje);\n\n            var botones_mover_etapa = $(`.btn-mover-etapa-accion[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n            botones_mover_etapa.prop('disabled', false);\n\n            $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`).css('visibility', 'visible');\n        }\n    });\n}\n\n/**\n * Mostrar modal de competencias por mejorar.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction mostrarModalCompetenciasMejorar(etapa_vacante_usuario_id) {\n    window.etapa_vacante_usuario_pendiente = etapa_vacante_usuario_id;\n\n    $.ajax({\n        url: `/vacantes-competencias-mejorar/${etapa_vacante_usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        beforeSend: function() {\n            $('#contenedor-competencias-mejorar').html(`\n                <div class=\"text-center py-5\">\n                    <div class=\"spinner-border text-primary\" role=\"status\">\n                        <span class=\"visually-hidden\">Cargando...</span>\n                    </div>\n                    <p class=\"mt-3 text-muted\">Consultando competencias...</p>\n                </div>\n            `);\n            $('#modal-competencias-mejorar').modal('show');\n        },\n        success: function(respuesta) {\n            renderizarCompetenciasMejorar(respuesta.data);\n\n            if (respuesta.data.usuario_id) {\n                var url_sso = `/sso/wordpress?student_id=${respuesta.data.usuario_id}`;\n                $('#btn-plataforma-capacitacion')\n                    .attr('href', url_sso)\n                    .attr('data-usuario-id', respuesta.data.usuario_id);\n            }\n        },\n        error: function(xhr) {\n            var mensaje = xhr.responseJSON?.message || 'Error al obtener competencias';\n            $('#contenedor-competencias-mejorar').html(`\n                <div class=\"alert alert-warning\" role=\"alert\">\n                    <i class=\"bi bi-exclamation-triangle me-2\"></i>${mensaje}\n                </div>\n            `);\n        }\n    });\n}\n\n/**\n * Renderizar competencias en el modal.\n *\n * @param {Object} data Datos de competencias agrupadas por prueba.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction renderizarCompetenciasMejorar(data) {\n    var html = '';\n\n    if (!data.pruebas || data.pruebas.length === 0) {\n        html = `\n            <div class=\"alert alert-info\" role=\"alert\">\n                <i class=\"bi bi-info-circle me-2\"></i>\n                No se encontraron resultados de pruebas psicométricas para este candidato.\n            </div>\n        `;\n    } else {\n        data.pruebas.forEach(function(prueba) {\n            html += `\n                <div class=\"card mb-3\">\n                    <div class=\"card-header bg-primary text-white\">\n                        <h6 class=\"mb-0\">\n                            <i class=\"bi bi-clipboard-data me-2\"></i>${prueba.nombre_prueba}\n                        </h6>\n                    </div>\n                    <div class=\"card-body\">\n            `;\n\n            if (prueba.competencias && prueba.competencias.length > 0) {\n                html += '<ul class=\"list-group list-group-flush\">';\n                prueba.competencias.forEach(function(competencia, index) {\n                    var color_badge = competencia.puntaje < 40 ? 'bg-danger' :\n                                     competencia.puntaje < 70 ? 'bg-warning' : 'bg-success';\n                    html += `\n                        <li class=\"list-group-item d-flex justify-content-between align-items-center\">\n                            <div><strong>${index + 1}. ${competencia.nombre}</strong></div>\n                            <span class=\"badge ${color_badge} rounded-pill\">${competencia.puntaje} pts</span>\n                        </li>\n                    `;\n                });\n                html += '</ul>';\n            } else {\n                html += `<p class=\"text-muted mb-0\">\n                    <i class=\"bi bi-info-circle me-2\"></i>\n                    No se identificaron competencias específicas para esta prueba.\n                </p>`;\n            }\n            html += `</div></div>`;\n        });\n    }\n\n    $('#contenedor-competencias-mejorar').html(html);\n}\n\n/**\n * Cerrar modal y ejecutar movimiento de etapa.\n *\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction cerrarModalCompetenciasMejorar() {\n    $('#modal-competencias-mejorar').modal('hide');\n    if (window.etapa_vacante_usuario_pendiente) {\n        ejecutarMovimientoEtapa(window.etapa_vacante_usuario_pendiente);\n        window.etapa_vacante_usuario_pendiente = null;\n    }\n}\n\n/**\n * Crear mensaje cuando la etapa de prueba técnica no tiene archivos de instrucciones.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {string} HTML del mensaje.\n * @author Andres Morales\n */\nfunction crearMensajeSinArchivosInstrucciones(etapa_id) {\n    return `\n        <div class=\"card candidato-card mb-3\">\n            <div class=\"card-body p-4\">\n                <div class=\"d-flex flex-column justify-content-center align-items-center py-3\">\n                    <i class=\"bi bi-folder\" style=\"font-size: 80px; color: #9CA3AF;\"></i>\n                    <p class=\"text-headline-6 text-gray-30 text-center mb-0 mt-4 px-4\">\n                        Adjunta una prueba o elimina esta etapa para continuar.\n                    </p>\n                    <div class=\"d-flex gap-3 mt-4\">\n                        ${crearBoton({\n                            clases: 'btn-primary',\n                            texto: 'Adjuntar prueba técnica',\n                            onclick: `abrirModalAdjuntarInstrucciones(${etapa_id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-danger',\n                            texto: 'Eliminar etapa',\n                            onclick: `eliminarEtapaPruebaTecnica(${etapa_id})`\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Generar botones de acción para un candidato según el contexto.\n *\n * @param {Object} usuario_vacante Datos del candidato.\n * @param {string} origen 'listado' o 'modal'.\n * @param {string} nombre_etapa Nombre de la etapa.\n * @param {boolean} etapa_anterior_contracion Si es etapa anterior a Contratados.\n * @param {boolean} tiene_motivo_abandono Si el candidato abandonó.\n * @returns {string} HTML de los botones.\n * @author Andres Morales\n * @author José Manuel Jiménez\n */\nfunction generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono) {\n    let html = '';\n\n    // Lógica para etapa de Prueba técnica\n    if (origen === 'listado' && nombre_etapa === 'Prueba técnica') {\n        let prueba_tecnica = usuario_vacante.prueba_tecnica || {};\n        let tiene_prueba = prueba_tecnica.existe && (prueba_tecnica.tiene_archivos || prueba_tecnica.tiene_enlace);\n        let tiene_calificacion = usuario_vacante.puntaje !== null;\n\n        if (!tiene_prueba) {\n            // Ojo gris - candidato NO ha subido su prueba\n            html += crearBoton({\n                clases: 'btn-outline-secondary btn-circle',\n                texto: '<i class=\"bi bi-eye-slash\"></i>',\n                disabled: true,\n                tooltip: crearTooltip({\n                    content: 'Candidato no ha subido su prueba técnica',\n                    placement: 'bottom'\n                })\n            });\n        } else if (!tiene_calificacion) {\n            // Ojo azul - abre detalle del candidato para calificar\n            html += crearBoton({\n                clases: 'btn-outline-primary btn-circle',\n                texto: '<i class=\"bi bi-eye\"></i>',\n                onclick: `verDetalleCandidato(${usuario_vacante.usuario.id}, 'Prueba técnica')`,\n                tooltip: crearTooltip({\n                    content: 'Ver detalle del candidato',\n                    placement: 'bottom'\n                })\n            });\n        } else {\n            // Flecha - puede mover de etapa\n            html += crearBoton({\n                clases: 'btn-outline-primary btn-circle btn-mover-etapa-accion',\n                adicional: `data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\"`,\n                texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                onclick: `moverEtapaCandidato(${usuario_vacante.id})`,\n                tooltip: crearTooltip({\n                    content: 'Mover de etapa',\n                    placement: 'bottom'\n                })\n            });\n        }\n    } else if (origen === 'listado' && nombre_etapa !== 'Contratados') {\n        // Lógica para otras etapas (código existente)\n        let icono = '<i class=\"bi bi-arrow-90deg-right\"></i>';\n        let mensaje = 'Mover de etapa';\n        if (etapa_anterior_contracion) {\n            icono = '<i class=\"bi bi-file-earmark-person\"></i>';\n            mensaje = 'Seleccionar como contratado';\n        }\n\n        html += crearBoton({\n            clases: 'btn-outline-primary btn-circle btn-mover-etapa-accion',\n            adicional: `data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\"`,\n            texto: icono,\n            onclick: `moverEtapaCandidato(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: mensaje,\n                placement: 'bottom'\n            }),\n            disabled: nombre_etapa === 'Documentos para contratación'\n                ? !usuario_vacante.etapa_completada\n                : ((usuario_vacante.puntaje === null && usuario_vacante.puntaje_ia === null) || usuario_vacante.etapa_completada === false || (usuario_vacante?.formato_entrevista_completado !== undefined && usuario_vacante?.formato_entrevista_completado === false))\n        });\n    }\n\n    // Botón de descartar\n    if (origen === 'listado' && nombre_etapa !== 'Contratados') {\n        html += crearBoton({\n            clases: 'btn-outline-danger btn-circle',\n            texto: `<i class=\"bi bi-person-x\"></i>`,\n            onclick: `descartarCandidatos(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: 'Descartar candidato',\n                placement: 'bottom'\n            })\n        });\n    }\n\n    // Botón de revertir descarte (para modal)\n    if (origen === 'modal') {\n        html += crearBoton({\n            clases: 'btn-outline-success btn-circle',\n            texto: `<i class=\"bi bi-person-add\"></i>`,\n            onclick: `devolverDescarteCandidato(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: tiene_motivo_abandono ? 'No se puede revertir: candidato abandonó' : 'Revertir descarte',\n                placement: 'bottom'\n            }),\n            disabled: tiene_motivo_abandono\n        });\n    }\n\n    return html;\n}\n\nvar archivos_instrucciones_prueba = [];\n\n/**\n * Abrir modal para adjuntar instrucciones de prueba técnica.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {void}\n * @author Andres Morales\n */\nfunction abrirModalAdjuntarInstrucciones(etapa_id) {\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').remove();\n\n    archivos_instrucciones_prueba = [];\n\n    $.ajax({\n        url: `/etapas-vacantes/${etapa_id}/obtener-configuraciones-prueba-tecnica`,\n        type: 'GET',\n        success: function(respuesta) {\n            crearModalConDatos(etapa_id, respuesta.data ||{});\n        },\n        error: function() {\n            crearModalConDatos(etapa_id, {});\n        }\n    });\n}\n\n/**\n * Crear el modal con los datos existentes.\n *\n * @param {number} etapa_id ID de la etapa.\n * @param {Object} datos Datos de configuración existentes.\n * @returns {void}\n * @author Andres Morales\n */\nfunction crearModalConDatos(etapa_id, datos = {}) {\n    let descripcion_valor = datos.descripcion || '';\n    let enlace_valor = datos.enlace || '';\n\n    let modal_html = crearModal({\n        id: 'modal-adjuntar-instrucciones-prueba-tecnica',\n        titulo_header: 'Prueba técnica',\n        dialog_class: 'modal-dialog-centered modal-lg modal-dialog-scrollable',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\"',\n        modal_body: `\n            <form class=\"col-12 px-3\" id=\"form-adjuntar-instrucciones\" enctype=\"multipart/form-data\">\n                <input type=\"hidden\" name=\"etapa_vacante_id\" value=\"${etapa_id}\">\n                <div class=\"col-12 px-0 text-label-1 py-2\">\n                    Puedes habilitar esta etapa aunque no tengas aún la prueba lista. Sube el archivo más adelante.\n                </div>\n                <div class=\"col-12 px-0 text-body-2 text-gray-10 my-3\">\n                    Agrega una descripción a la prueba\n                </div>\n                <div class=\"col-12 my-2 pb-2\">\n                    ${crearTextarea({\n                        id: 'descripcion_prueba',\n                        name: 'descripcion',\n                        placeholder: '',\n                        required: true,\n                        value: descripcion_valor,\n                        label: 'Descripción',\n                        contador: 1500\n                    })}\n                </div>\n                <div class=\"col-12 px-4 rounded-3 border\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-body-2 text-gray-10 my-3\">\n                            Adjuntar prueba técnica\n                        </div>\n                        <div class=\"col-12\">\n                            ${crearInput({\n                                id: 'enlace_prueba',\n                                name: 'enlace',\n                                input_container_class: 'mb-4',\n                                label: 'Agregar enlace',\n                                required: false,\n                                value: enlace_valor,\n                                adicional: 'style=\"height: 60px;\"'\n                            })}\n                        </div>\n                        <div class=\"col-12\">\n                            ${crearInputFile({\n                                id: 'archivo_prueba',\n                                name: 'archivo_prueba',\n                                placeholder: '',\n                                disabled: false,\n                                required: false,\n                                multiple: true,\n                                accept: 'image/jpg,image/jpeg,image/png,application/pdf,.doc,.docx,.xls,.xlsx',\n                            })}\n                        </div>\n                        <div class=\"col-12 pb-4\">\n                            <div class=\"col-12 pt-4 px-4 mb-4 rounded-3 border text-body-3\">\n                                Los archivos tienen que:\n                                <ul class=\"text-body-2 text-gray-10\">\n                                    <li>Estar en formato JPG, PNG, PDF, DOCX o XLSX.</li>\n                                    <li>No superar los 2000 px de alto y pesar máximo 5GB.</li>\n                                </ul>\n                            </div>\n                            <div class=\"col-12\">\n                                <div class=\"row g-3\" id=\"contenedor-archivos-instrucciones\"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </form>\n        `,\n        boton_footer1: {\n            texto: 'Cancelar',\n            class: 'btn-outline-primary',\n            cerrar_modal: true\n        },\n        boton_footer2: {\n            texto: 'Guardar',\n            class: 'btn-primary',\n            id: 'btn-guardar-instrucciones',\n            onclick: 'adjuntarInstruccionesPruebaTecnica()',\n            disabled: true\n        }\n    });\n\n    $('body').append(modal_html);\n\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').on('shown.bs.modal', function() {\n        inicializarIputsFile();\n\n        $('#archivo_prueba').off('change').on('change', function (e) {\n            let archivos_seleccionados = e.target.files;\n            for (let i = 0; i < archivos_seleccionados.length; i++) {\n                let archivo = archivos_seleccionados[i];\n                let nombre_repetido = archivos_instrucciones_prueba.some(item => item.archivo.name === archivo.name);\n                if (!nombre_repetido) {\n                    archivos_instrucciones_prueba.push({\n                        archivo: archivo,\n                        seleccionado: true,\n                        id: Date.now() + '_' + i\n                    });\n                } else {\n                    mostrarToast('warning', `El archivo \"${archivo.name}\" ya fue seleccionado anteriormente.`);\n                }\n            }\n            renderizarArchivosInstrucciones();\n        });\n\n        validarCamposModalPruebaTecnicaDetalle();\n\n        inicializarTooltips();\n    });\n\n    // Limpiar cuando se cierra el modal\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').on('hidden.bs.modal', function() {\n        // Liberar todas las URLs temporales de las imágenes\n        $('#contenedor-archivos-instrucciones img').each(function() {\n            URL.revokeObjectURL($(this).attr('src'));\n        });\n\n        $('#contenedor-archivos-instrucciones').empty();\n        $('#archivo_prueba').val('');\n        archivos_instrucciones_prueba = [];\n        $(this).remove();\n    });\n\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').modal('show');\n}\n\n/**\n * Renderizar archivos seleccionados para instrucciones.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction renderizarArchivosInstrucciones() {\n    let contenedor = $('#contenedor-archivos-instrucciones');\n    contenedor.empty();\n\n    if (archivos_instrucciones_prueba.length === 0) {\n        return;\n    }\n\n    let documentos = [];\n    let imagenes = [];\n\n    archivos_instrucciones_prueba.forEach((item) => {\n        if (!item.seleccionado) return;\n\n        let archivo = item.archivo;\n        let extension = archivo.name.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'].includes(extension);\n\n        if (es_imagen) {\n            imagenes.push(item);\n        } else {\n            documentos.push(item);\n        }\n    });\n\n    documentos.forEach((item) => {\n        let archivo = item.archivo;\n        let extension = archivo.name.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtensionDetalle(extension);\n\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono}\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\"\n                             ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash-fill text-danger pointer\" onclick=\"quitarArchivoInstruccion('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        contenedor.append(html);\n    });\n\n    imagenes.forEach((item) => {\n        let archivo = item.archivo;\n        let url_imagen = URL.createObjectURL(archivo);\n\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 px-0 imagen-archivo-previsualizacion\"\n                             src=\"${url_imagen}\"\n                             alt=\"${archivo.name}\"\n                             style=\"height: 97px; object-fit: cover; border-radius: 6px 6px 0 0;\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 text-truncate\"\n                             ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash-fill text-danger pointer\" onclick=\"quitarArchivoInstruccion('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        contenedor.append(html);\n    });\n\n    inicializarTooltips();\n}\n\n/**\n * Quitar archivo de instrucciones seleccionado.\n *\n * @param {string} id ID del archivo.\n * @returns {void}\n * @author Andres Morales\n */\nfunction quitarArchivoInstruccion(id) {\n    // Buscar la imagen en el DOM y revocar la URL temporal si existe\n    let img = $(`img[src]`).filter(function() {\n        return $(this).closest('.archivo-item').find(`[onclick*=\"${id}\"]`).length > 0;\n    });\n\n    if (img.length > 0) {\n        URL.revokeObjectURL(img.attr('src'));\n    }\n\n    archivos_instrucciones_prueba = archivos_instrucciones_prueba.filter(item => item.id !== id);\n\n    renderizarArchivosInstrucciones();\n}\n\n/**\n * Obtener icono por extensión de archivo con colores específicos.\n *\n * @param {string} extension Extensión del archivo.\n * @returns {string} Clase del icono con color.\n * @author Andres Morales\n */\nfunction obtenerIconoPorExtensionDetalle(extension) {\n    let iconos = {\n        'pdf': 'bi bi-filetype-pdf text-danger fs-2',          // Rojo\n        'doc': 'bi bi-filetype-docx text-primary fs-2',        // Azul\n        'docx': 'bi bi-filetype-docx text-primary fs-2',       // Azul\n        'xls': 'bi bi-filetype-xlsx text-success fs-2',        // Verde\n        'xlsx': 'bi bi-filetype-xlsx text-success fs-2',       // Verde\n        'jpg': 'bi bi-file-image text-info fs-2',              // Cyan\n        'jpeg': 'bi bi-file-image text-info fs-2',             // Cyan\n        'png': 'bi bi-file-image text-info fs-2',              // Cyan\n        'gif': 'bi bi-file-image text-info fs-2',              // Cyan\n        'bmp': 'bi bi-file-image text-info fs-2',              // Cyan\n        'webp': 'bi bi-file-image text-info fs-2'              // Cyan\n    };\n    return iconos[extension] || 'bi bi-file-earmark text-secondary fs-2';\n}\n\n/**\n * Adjuntar instrucciones de prueba técnica.\n *\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction adjuntarInstruccionesPruebaTecnica() {\n    let formulario_datos = new FormData();\n\n    formulario_datos.append('etapa_vacante_id', $('#form-adjuntar-instrucciones input[name=\"etapa_vacante_id\"]').val());\n    formulario_datos.append('descripcion', $('#descripcion_prueba').val());\n    formulario_datos.append('enlace', $('#enlace_prueba').val());\n    formulario_datos.append('notificar_aplicantes', 1);\n\n    archivos_instrucciones_prueba.forEach((item) => {\n        if (item.seleccionado) {\n            formulario_datos.append('archivos[]', item.archivo);\n        }\n    });\n\n    $('#btn-guardar-instrucciones').prop('disabled', true).html('<i class=\"bi bi-hourglass-split me-2\"></i>Guardando...');\n\n    $.ajax({\n        url: '/etapas-vacantes-adjuntar-archivos',\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message || 'Prueba técnica guardada correctamente');\n            $('#modal-adjuntar-instrucciones-prueba-tecnica').modal('hide');\n            cargarEtapasConCandidatos(prepararFiltrosActuales());\n        },\n        error: function(xhr) {\n            let mensaje = xhr.responseJSON?.message || 'Error al guardar la prueba técnica';\n            mostrarToast('danger', mensaje);\n            $('#btn-guardar-instrucciones').prop('disabled', false).html('Guardar');\n        }\n    });\n}\n\n/**\n * Eliminar etapa de prueba técnica.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {void}\n * @author Andres Morales\n */\nfunction eliminarEtapaPruebaTecnica(etapa_id) {\n    Swal.fire({\n        width: '533px',\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">\n                    ¿Eliminar etapa?\n                </div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                    Esta seguro de querer eliminar la etapa Prueba técnica.\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-danger w-100 justify-content-center',\n                        texto: 'Eliminar etapa',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed) {\n            $.ajax({\n                url: `/etapas-vacantes/${etapa_id}/eliminar-etapa-prueba-tecnica`,\n                type: 'DELETE',\n                headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n                success: function(respuesta) {\n                    mostrarToast('success', respuesta.message || 'Etapa eliminada correctamente');\n                    cargarEtapasConCandidatos(prepararFiltrosActuales());\n                },\n                error: function(xhr) {\n                    let mensaje = xhr.responseJSON?.message || 'Error al eliminar la etapa';\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Validar campos del modal de prueba técnica en detalle y habilitar/deshabilitar botón guardar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarCamposModalPruebaTecnicaDetalle() {\n    let campos = [\n        '#descripcion_prueba'\n    ];\n\n    // Agregar evento input a todos los campos\n    campos.forEach(function(campo) {\n        $(campo).on('input', function() {\n            validarYActualizarBotonGuardarDetalle();\n        });\n    });\n\n    validarYActualizarBotonGuardarDetalle();\n}\n\n/**\n * Validar campos y actualizar estado del botón guardar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarYActualizarBotonGuardarDetalle() {\n    let descripcion = $('#descripcion_prueba').val().trim();\n\n    let es_valido = descripcion !== '';\n\n    $('#btn-guardar-instrucciones').prop('disabled', !es_valido);\n}\n\n/**\n * Hacer scroll suave hacia una etapa específica después del movimiento.\n *\n * @param {jQuery} etapa_destino Etapa a la que hacer scroll.\n * @returns {void}\n * @author Andres Morales\n */\nfunction scrollHaciaEtapa(etapa_destino) {\n    var $contenedor = $('#contenido-etapas-lista');\n\n    if (!$contenedor.length || !etapa_destino.length) {\n        return;\n    }\n\n    var etapa_id = etapa_destino.data('etapa-id');\n    var $etapa_actualizada = $(`.etapa-card[data-etapa-id=\"${etapa_id}\"]`);\n\n    if (!$etapa_actualizada.length) {\n        return;\n    }\n\n    var desplazamiento_izquierda_contenedor = $contenedor.scrollLeft();\n    var contenedor_ancho = $contenedor.outerWidth();\n    var ancho_desplazamiento_contenedor = $contenedor[0].scrollWidth;\n\n    var posicion_etapa = $etapa_actualizada.position().left;\n    var etapa_ancho = $etapa_actualizada.outerWidth();\n\n    var limite_izquierdo = desplazamiento_izquierda_contenedor;\n    var limite_derecho = desplazamiento_izquierda_contenedor + contenedor_ancho;\n\n    var etapa_visible = (posicion_etapa >= limite_izquierdo) &&\n                       ((posicion_etapa + etapa_ancho) <= limite_derecho);\n\n    if (etapa_visible) {\n        return;\n    }\n\n    var nueva_posicion_scroll = posicion_etapa - (contenedor_ancho / 2) + (etapa_ancho / 2);\n\n    nueva_posicion_scroll = Math.max(0, Math.min(nueva_posicion_scroll, ancho_desplazamiento_contenedor - contenedor_ancho));\n\n    $contenedor.animate(\n        { scrollLeft: nueva_posicion_scroll },\n        {\n            duration: 600,\n            easing: 'swing'\n        }\n    );\n}\n\n\n","structuredPatch":[{"oldStart":446,"oldLines":13,"newStart":446,"newLines":13,"lines":["             class: 'tag-tonal-orange w-fit-content',","         })}` : '';"," ","-    var fecha_notificacion = '';","-    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {","-        var fecha = new Date(usuario_vacante.fecha_notificacion);","+    var fecha_descarte = '';","+    if (origen === 'modal' && usuario_vacante.created_at) {","+        var fecha = new Date(usuario_vacante.created_at);","         var dia = fecha.getDate();","         var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');","         var anio = fecha.getFullYear();","-        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;","+        fecha_descarte = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;","     }"," "," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"b0c16733-a603-4b64-a9ed-8e3a2b84d853"}
{"parentUuid":"a8864276-b70c-4de3-afd0-7fc3a5b53b79","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KmCSPDPd22wrAMyA3z3C87","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora actualizo la referencia en el HTML:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":859,"cache_read_input_tokens":46197,"cache_creation":{"ephemeral_5m_input_tokens":859,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXKUERx7qZG5AkUdAyfd3","type":"assistant","uuid":"23a57f07-323f-4428-b3dc-2f232e44817a","timestamp":"2026-01-20T23:07:36.608Z"}
{"parentUuid":"23a57f07-323f-4428-b3dc-2f232e44817a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KmCSPDPd22wrAMyA3z3C87","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LawfaUGe62xVb4tr6SozxW","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","old_string":"${(origen === 'modal' && fecha_notificacion) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n                                </div>\n                            ` : ''}","new_string":"${(origen === 'modal' && fecha_descarte) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_descarte}</span>\n                                </div>\n                            ` : ''}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":859,"cache_read_input_tokens":46197,"cache_creation":{"ephemeral_5m_input_tokens":859,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXKUERx7qZG5AkUdAyfd3","type":"assistant","uuid":"d4b5f17a-45fa-4c75-85d6-734d42c252be","timestamp":"2026-01-20T23:07:40.759Z"}
{"parentUuid":"d4b5f17a-45fa-4c75-85d6-734d42c252be","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LawfaUGe62xVb4tr6SozxW","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   486→                    <div class=\"flex-grow-1\">\n   487→                        <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>\n   488→                        <div class=\"candidato-info d-flex flex-column gap-1\">\n   489→                            ${etapa_descarte_html}\n   490→                            ${(origen === 'modal' && fecha_descarte) ? `\n   491→                                <div class=\"d-flex align-items-center gap-2\">\n   492→                                    <i class=\"bi bi-calendar-event\"></i>\n   493→                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_descarte}</span>\n   494→                                </div>\n   495→                            ` : ''}\n   496→                            ${documento ? `\n   497→                                <div class=\"d-flex align-items-center gap-2\">\n   498→                                    <img width=\"12\" heigth=\"16\" src=\"/iconos/file-person.png\">\n   499→                                    <span class=\"text-label-2\">No. documento: ${documento}</span>"}]},"uuid":"18e94af7-628c-4724-ad70-474f2f21018f","timestamp":"2026-01-20T23:07:55.456Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","oldString":"${(origen === 'modal' && fecha_notificacion) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n                                </div>\n                            ` : ''}","newString":"${(origen === 'modal' && fecha_descarte) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_descarte}</span>\n                                </div>\n                            ` : ''}","originalFile":"/**\n * Archivo para el manejo de etapas en el detalle de vacantes\n * @author Andres Morales\n*/\n\nlet candidatos_descartados = [];\nlet candidatos_seleccionados = [];\nlet json_filtros_etapas = {};\nlet es_primera_carga = true;\nlet posicion_scroll_guardada = 0;\n\n$(document).ready(function() {\n    consultarPaisesListadoCompleto(true);\n    observarCambiosChips();\n    cargarEtapasConCandidatos();\n});\n\n/**\n * Cargar etapas de la vacante con sus candidatos desde el endpoint.\n *\n * @param {Object} filtros Objeto con filtros a aplicar (opcional).\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction cargarEtapasConCandidatos(filtros = {}) {\n    // Guardar posición del scroll antes de actualizar (solo si no es la primera carga)\n    if (!es_primera_carga) {\n        var $contenedor = $('#contenido-etapas-lista');\n        if ($contenedor.length) {\n            posicion_scroll_guardada = $contenedor.scrollLeft();\n        }\n    }\n\n    $.ajax({\n        url: `/etapas-vacantes-aplicantes/${VACANTE_ID}`,\n        type: 'GET',\n        dataType: 'json',\n        data: {\n            ciudad_id: filtros.ciudad_id || '',\n            departamento_id: filtros.departamento_id || '',\n            pais_id: filtros.pais_id || '',\n            etapa_id: filtros.etapa_id || '',\n            nivel_educativo_id: filtros.nivel_educativo_id || '',\n            fecha_desde: filtros.fecha_desde || '',\n            fecha_hasta: filtros.fecha_hasta || '',\n            edad: filtros.edad || '',\n            chips: filtros.chips,\n            nivel_adecuacion: filtros.nivel_adecuacion || ''\n        },\n        success: function(respuesta) {\n            let datos = respuesta.data;\n            renderizarEtapas(datos.etapas, calcularTotalCandidatos(datos.etapas) + datos.descartados.length);\n            actualizarConteoDescartados(datos.descartados.length);\n\n            candidatos_descartados = datos.descartados;\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Calcular el total de candidatos en todas las etapas.\n *\n * @param {Array} etapas Array de etapas con candidatos.\n * @returns {number} Total de candidatos.\n * @author Andres Morales\n */\nfunction calcularTotalCandidatos(etapas) {\n    let total = 0;\n    etapas.forEach(etapa => {\n        if (etapa.usuarios_vacantes) {\n            total += etapa.usuarios_vacantes.length;\n        }\n    });\n    return total;\n}\n\n/**\n * Observar cambios en el contenedor de chips para mostrar/ocultar el wrapper.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction observarCambiosChips() {\n    var $contenedor_chips = $('#contenedor-chips-etapa-filtro-candidatos');\n    var $envolvente = $('#contenedor-chips-wrapper-etapa-filtro-candidatos');\n\n    if ($contenedor_chips.length === 0 || $envolvente.length === 0) return;\n\n    var observador = new MutationObserver(function() {\n        var tiene_chips = $contenedor_chips.children().length > 0;\n\n        if (tiene_chips) {\n            $envolvente.removeClass('d-none');\n        } else {\n            $envolvente.addClass('d-none');\n        }\n    });\n\n    observador.observe($contenedor_chips[0], {\n        childList: true,\n        subtree: false\n    });\n}\n\n/**\n * Actualizar el conteo de aplicantes en el botón.\n *\n * @param {number} conteo Número de candidatos aplicantes.\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarConteoAplicantes(conteo) {\n    $('#etapa-total-candidatos').text(`${conteo}`);\n}\n\n/**\n * Actualizar el badge de conteo de descartados.\n *\n * @param {number} conteo Número de candidatos descartados.\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarConteoDescartados(conteo) {\n    $('#etapa-total-descartados').text(conteo);\n}\n\n/**\n * Cargar las etapas en el select2 del filtro.\n *\n * @param {Array} etapas Array de etapas de la vacante.\n * @returns {void}\n * @author Andres Morales\n */\nfunction cargarEtapasEnFiltro(etapas) {\n    var $select_etapa_filtro = $('#etapa_filtro');\n\n    if (!$select_etapa_filtro.length) return;\n\n    $select_etapa_filtro.empty();\n\n    var opcion_todas = new Option('Todas', '', false, false);\n    $select_etapa_filtro.append(opcion_todas);\n\n    etapas.sort((a, b) => a.orden - b.orden);\n\n    etapas.forEach(function(etapa) {\n        var opcion = new Option(etapa.nombre, etapa.id, false, false);\n        $select_etapa_filtro.append(opcion);\n    });\n\n    $select_etapa_filtro.trigger('change');\n}\n\n/**\n * Animar scroll horizontal del contenedor de etapas.\n * Desplaza desde el final hasta el inicio (solo en primera carga).\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction animarScrollEtapas() {\n    var $contenedor = $('#contenido-etapas-lista');\n\n    if (!$contenedor.length) return;\n\n    var ancho_scroll = $contenedor[0].scrollWidth - $contenedor[0].clientWidth;\n\n    if (ancho_scroll <= 0) return;\n\n    // Posicionar al final primero\n    $contenedor.scrollLeft(ancho_scroll);\n\n    // Animar de final a inicio\n    $contenedor.animate(\n        { scrollLeft: 0 },\n        {\n            duration: 1500,\n            easing: 'swing'\n        }\n    );\n}\n\n/**\n * Renderizar las etapas de la vacante en cards horizontales.\n *\n * @param {Array} etapas Array de etapas de la vacante.\n * @param {number} conteo_aplicantes Cantidad de aplicantes de la vacante.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author Jair Carvajal\n */\nfunction renderizarEtapas(etapas, conteo_aplicantes) {\n    var $contenido_lista = $('#contenido-etapas-lista');\n    var $contenido_vacio = $('#contenido-etapas-empty');\n    var $contenido_controles = $('#contenido-etapas-controles');\n\n    // Verificar si hay filtros activos\n    var hay_filtros_activos = Object.keys(json_filtros_etapas).length > 0;\n\n    // Solo mostrar empty state si NO hay aplicantes Y NO hay filtros activos\n    if ((!conteo_aplicantes || conteo_aplicantes === 0) && !hay_filtros_activos) {\n        $contenido_lista.addClass('d-none');\n        $contenido_controles.addClass('d-none');\n        $contenido_vacio.removeClass('d-none');\n        return;\n    }\n\n    $contenido_vacio.addClass('d-none');\n    $contenido_lista.removeClass('d-none');\n    $contenido_controles.removeClass('d-none');\n\n    if (!etapas || etapas.length === 0) {\n        $contenido_lista.html(`\n            <div class=\"w-100 text-center py-5\">\n                <p class=\"text-muted\">${hay_filtros_activos ? 'No se encontraron coincidencias con los filtros aplicados. vuelve a intentar con otros filtros' : 'No hay etapas configuradas para esta vacante'}</p>\n            </div>\n        `);\n        return;\n    }\n\n    let html = '';\n    etapas.sort((a, b) => a.orden - b.orden);\n\n    // Filtrar la etapa con el orden inmediatamente anterior al orden 8 (Contratados)\n    let etapa_anterior_orden_8 = etapas\n        .filter(etapa => etapa.orden < 8)\n        .sort((a, b) => b.orden - a.orden)[0];\n\n    etapas.forEach((etapa) => {\n        html += crearTarjetaEtapa(etapa, etapa_anterior_orden_8);\n    });\n\n    $contenido_lista.html(html);\n\n    cargarEtapasEnFiltro(etapas);\n\n    // Ejecutar animación solo en la primera carga, de lo contrario restaurar posición\n    if (es_primera_carga) {\n        animarScrollEtapas();\n        es_primera_carga = false;\n    } else {\n        // Restaurar la posición del scroll guardada\n        setTimeout(() => {\n            $contenido_lista.scrollLeft(posicion_scroll_guardada);\n        }, 50);\n    }\n\n    inicializarEventosCheckboxes();\n\n    // Inicializar tooltips después de renderizar\n    setTimeout(() => {\n        inicializarTooltips();\n    }, 100);\n}\n\n/**\n * Crear una tarjeta(card) de etapa.\n *\n * @param {Object} etapa Datos de la etapa.\n * @param {Object} etapa_anterior_orden_8 Etapa con el orden inmediatamente anterior al orden 8.\n * @returns {string} HTML de la card.\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author Jair Carvajal\n */\nfunction crearTarjetaEtapa(etapa, etapa_anterior_orden_8) {\n    let etapa_anterior_contracion = false;\n\n    if (etapa_anterior_orden_8 && etapa.orden === etapa_anterior_orden_8.orden && etapa.activa == 1) {\n        etapa_anterior_contracion = true;\n    }\n\n    // Detectar si es etapa de prueba técnica sin archivos\n    let es_prueba_tecnica = etapa.nombre === 'Prueba técnica';\n    let tiene_prueba_tecnica_cargada = etapa?.prueba_cargada ?? true;\n\n    let candidatos_html = '';\n    let candidatos_totales = 0;\n    let candidatos_completaron = 0;\n\n    // Mostrar mensaje si es prueba técnica sin archivos\n    if (es_prueba_tecnica && !tiene_prueba_tecnica_cargada) {\n        let html = crearMensajeSinArchivosInstrucciones(etapa.id);\n\n        // Si hay candidatos, agregarlos después del mensaje\n        if (etapa?.usuarios_vacantes?.length > 0) {\n            etapa.usuarios_vacantes.forEach((usuario_vacante) => {\n                html += crearCardCandidato(usuario_vacante, 'listado', etapa.nombre, etapa_anterior_contracion);\n            });\n            candidatos_totales = etapa.usuarios_vacantes.length;\n            candidatos_completaron = etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.puntaje !== null || usuario_vacante.puntaje_ia !== null).length;\n        }\n\n        candidatos_html = `<div class=\"candidatos-container\">${html}</div>`;\n    } else if (etapa?.usuarios_vacantes?.length > 0) {\n        let html = '';\n\n        etapa.usuarios_vacantes.forEach((usuario_vacante) => {\n            html += crearCardCandidato(usuario_vacante, 'listado', etapa.nombre, etapa_anterior_contracion);\n        });\n\n        candidatos_html = `<div class=\"candidatos-container\">${html}</div>`;\n        candidatos_totales = etapa.usuarios_vacantes.length;\n        candidatos_completaron = etapa.nombre === 'Documentos para contratación'\n            ? etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.etapa_completada === true).length\n            : etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.puntaje !== null || usuario_vacante.puntaje_ia !== null).length;\n    } else {\n        candidatos_html = `\n            <div class=\"d-flex justify-content-center align-items-center my-5\"><div class=\"etapa-icono-circulo\"><i class=\"bi bi-arrow-90deg-right\"></i></div></div>\n            <div class=\"mt-auto pb-10 px-5\"><p class=\"text-headline-5 text-gray-40 text-center mb-5 pb-10 px-6\">Mueve candidatos con el botón o arrástralos desde la etapa anterior. </p></div>\n        `;\n    }\n    return `\n        <div class=\"card etapa-card bg-gray-90\" data-etapa-id=\"${etapa.id}\">\n            <div class=\"card-body d-flex flex-column\">\n                <div class=\"d-flex align-items-center mb-3 gap-3\">\n                    ${crearCheckbox({\n                        id: 'etapa-check-' + etapa.id,\n                        name: 'etapa_check',\n                        value: etapa.id,\n                        checked: false,\n                        input_container_class: 'd-inline-block',\n                        disabled: (candidatos_totales > 0) ? false : true\n                    })}\n                    <h6 class=\"etapa-titulo text-headline-5 fw-bold mb-0\">${etapa.nombre}</h6>\n                    ${(candidatos_totales > 0 && etapa.nombre !== 'Contratados') ?\n                        `<div class=\"ms-auto\">\n                            ${crearTag({\n                                texto: candidatos_completaron + '/' + candidatos_totales + ' completaron la tarea',\n                                class: etapa.nombre === 'Documentos para contratación' ? 'tag-tonal-green' : 'tag-tonal-blue',\n                            })}\n                        </div>`\n                    : ''}\n                </div>\n                ${candidatos_html}\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Ver candidatos descartados en modal.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction verCandidatosDescartados() {\n    let $contenedor = $('#contenedor-candidatos-descartados');\n    let $controles = $('#controles-candidatos-descartados');\n\n    if (candidatos_descartados.length === 0) {\n        $controles.addClass('d-none');\n        $contenedor.html(`\n            <div class=\"row justify-content-center align-items-center py-5\">\n                <div class=\"col-auto text-center\">\n                    <div class=\"mb-4\">\n                        <i class=\"bi bi-person-x-fill empty-state-icon\"></i>\n                    </div>\n                    <div class=\"text-gray-30 fw-semibold text-headline-4 mb-3\">\n                        No hay candidatos descartados\n                    </div>\n                    <div class=\"text-gray-50 text-body-2\">\n                        Los candidatos que descartaste aparecerán aquí\n                    </div>\n                </div>\n            </div>\n        `);\n    } else {\n        $controles.removeClass('d-none');\n        let html = '';\n        candidatos_descartados.forEach(candidato => {\n            html += crearCardCandidato(candidato, 'modal');\n        });\n        $contenedor.html(html);\n\n        setTimeout(() => {\n            inicializarTooltips();\n            inicializarEventosModalDescartados();\n        }, 100);\n    }\n\n    $('#modal-candidatos-descartados').modal('show');\n}\n\n/**\n * Crear una card individual de candidato.\n *\n * @param {Object} usuario_vacante Datos del candidato aplicante.\n * @param {string} origen Origen del render: 'listado' o 'modal'. Default: 'listado'\n * @param {string} nombre_etapa Nombre de la etapa actual. Default: null\n * @returns {string} HTML de la card del candidato.\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidato(usuario_vacante, origen = 'listado', nombre_etapa = null, etapa_anterior_contracion = false) {\n    var usuario = usuario_vacante.usuario || {};\n    var nombre_completo = usuario.nombre_completo?.trim() || 'Sin nombre';\n    var salario = usuario?.perfiles_laborales[0]?.salario || 0;\n    var salario_maximo = usuario?.perfiles_laborales[0]?.salario_maximo || 0;\n\n    var salario_solicitado = (salario_maximo > 0) ? `Salario: ${formatearSalario(salario)} a ${formatearSalario(salario_maximo)}` : `Solicita ${formatearSalario(salario)}`;\n    var experiencia_meses = usuario?.perfiles_laborales[0]?.experiencia_laboral_meses || 0;\n    var experiencia = convertirMesesAAnios(experiencia_meses);\n\n    var ciudad = usuario.ciudad?.nombre || '';\n    var pais = usuario.ciudad?.departamento?.pais?.nombre || '';\n    var ubicacion = `${ciudad}${ciudad && pais ? ',' : ''}${pais}`;\n    \n    var documento = usuario.documento || '';\n\n    var adecuacion = usuario_vacante.adecuacion;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    var tiene_motivo_abandono = origen === 'modal' && usuario_vacante.etapa_descarte?.motivo_abandono !== null;\n\n    var checkbox_html = !tiene_motivo_abandono ?\n        crearCheckbox({\n            id: `candidato-check-${usuario_vacante.id}`,\n            name: `candidato_check`,\n            value: usuario_vacante.id,\n            class: 'candidato-checkbox',\n            input_container_class: 'd-inline-block'\n        }) : '';\n\n    var etapa_descarte_html = origen === 'modal' && usuario_vacante.etapa_descarte ?\n        `${crearTag({\n            texto: `Etapa de descarte: ${usuario_vacante.etapa_descarte.nombre}`,\n            class: 'tag-tonal-orange w-fit-content',\n        })}` : '';\n\n    var fecha_descarte = '';\n    if (origen === 'modal' && usuario_vacante.created_at) {\n        var fecha = new Date(usuario_vacante.created_at);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_descarte = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }\n\n\n    return `\n        <div class=\"card candidato-card mb-3\" data-candidato-id=\"${usuario.id}\" data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\" data-tiene-pruebas-requeridas=\"${usuario_vacante.tiene_pruebas_requeridas || false}\">\n            <div class=\"card-body p-3\">\n                <div class=\"d-flex align-items-center gap-3\">\n                    ${checkbox_html}\n                    <div class=\"position-relative d-flex flex-column align-items-center justify-content-center text-center\">\n                        <img class=\"candidato-avatar ${borde_color}\"\n                            onclick=\"verDetalleCandidato(${usuario.id})\"\n                            src=\"/usuarios-imagen/${usuario.id}\"\n                            ${crearTooltip({\n                                placement: `bottom`,\n                                content: `Ver detalle del candidato`,\n                                toggle: `popover`,\n                            })}>\n\n                        ${(adecuacion !== null && adecuacion > 0) ? `\n                            <span class=\"candidato-badge-detalle text-label-1 badge ${etiqueta_estilo} position-absolute\">\n                                ${adecuacion ? `${adecuacion}%` : ''}\n                            </span>\n                        ` : ''}\n\n                        ${ubicacion ? `\n                            <div class=\"d-flex align-items-center gap-2 mt-3\">\n                                <span class=\"text-label-2 text-gray-30\">${ubicacion}</span>\n                            </div>\n                        ` : ''}\n                    </div>\n                    <div class=\"flex-grow-1\">\n                        <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>\n                        <div class=\"candidato-info d-flex flex-column gap-1\">\n                            ${etapa_descarte_html}\n                            ${(origen === 'modal' && fecha_notificacion) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n                                </div>\n                            ` : ''}\n                            ${documento ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <img width=\"12\" heigth=\"16\" src=\"/iconos/file-person.png\">\n                                    <span class=\"text-label-2\">No. documento: ${documento}</span>\n                                </div>\n                            ` : ''}\n                            ${experiencia ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-briefcase\"></i>\n                                    <span class=\"text-label-2\">Experiencia: ${experiencia}</span>\n                                </div>\n                            ` : ''}\n                            ${salario_solicitado ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-currency-dollar\"></i>\n                                    <span class=\"text-label-2\">${salario_solicitado}</span>\n                                </div>\n                            ` : ''}\n                        </div>\n                    </div>\n\n                    <div class=\"d-flex flex-column align-items-end gap-2\">\n                        ${generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono)}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Ver y calificar candidato.\n *\n * @param {number} candidato_id ID del candidato.\n * @returns {void}\n * @author Andres Morales\n */\nfunction verCalificarCandidatos(candidato_id) {\n    mostrarToast('info','Calificar candidato:', candidato_id);\n}\n\n/**\n * Mover candidato a la siguiente etapa.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n * @author Sergio Vargas - Modificación para modal de competencias\n */\nfunction moverEtapaCandidato(etapa_vacante_usuario_id) {\n    verificarSiguienteEtapa(etapa_vacante_usuario_id, function(es_contratados) {\n        if (es_contratados) {\n            // Obtener el valor de tiene_pruebas_requeridas desde el atributo data de la card\n            var $contenedor_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n            var tiene_pruebas = $contenedor_candidato.attr('data-tiene-pruebas-requeridas') === 'true';\n\n            if (tiene_pruebas) {\n                mostrarModalCompetenciasMejorar(etapa_vacante_usuario_id);\n            } else {\n                Swal.fire({\n                    width: '533px',\n                    showCloseButton: true,\n                    closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n                    showConfirmButton: false,\n                    showDenyButton: false,\n                    showCancelButton: false,\n                    html: `\n                        <div class=\"row w-100 mx-0 mt-2\">\n                            <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Confirmar contratación</div>\n                            <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                                Estás a punto de pasar a Contratados al canditato seleccionado y finalizar esta vacante.\n                            </div>\n                            <div class=\"col-12 mt-5 text-start text-body-2 fw-semibold\">\n                                ¿Deseas continuar?\n                            </div>\n                            <div class=\"col-6 mt-5 mb-2\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary w-100 justify-content-center',\n                                    texto: 'Volver',\n                                    onclick: `Swal.clickDeny();`\n                                })}\n                            </div>\n                            <div class=\"col-6 mt-5 mb-2\">\n                                ${crearBoton({\n                                    clases: 'btn-primary w-100 justify-content-center',\n                                    texto: 'Continuar con la contratación',\n                                    onclick: `Swal.clickConfirm();`\n                                })}\n                            </div>\n                        </div>\n                    `,\n                }).then(async (resultado) => {\n                    if (resultado.isConfirmed) {\n                        ejecutarMovimientoEtapa(etapa_vacante_usuario_id);\n                    }\n                });\n            }\n        } else {\n            ejecutarMovimientoEtapa(etapa_vacante_usuario_id);\n        }\n    });\n}\n\n/**\n * Inicializar eventos de checkboxes.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction inicializarEventosCheckboxes() {\n    $(document).off('change', 'input[name=\"candidato_check\"]');\n    $(document).on('change', 'input[name=\"candidato_check\"]', function() {\n        let $etapa_tarjeta = $(this).closest('.etapa-card');\n        validarEstadoCheckboxEtapa($etapa_tarjeta);\n\n        actualizarContadorSeleccionados();\n        actualizarEstadoBotonDescartar();\n    });\n\n    $(document).off('change', 'input[name=\"etapa_check\"]');\n    $(document).on('change', 'input[name=\"etapa_check\"]', function() {\n        let comprobado = $(this).is(':checked');\n\n        let $etapa_tarjeta = $(this).closest('.etapa-card');\n        $etapa_tarjeta.find('input[name=\"candidato_check\"]').prop('checked', comprobado);\n\n        actualizarContadorSeleccionados();\n        actualizarEstadoBotonDescartar();\n    });\n}\n\n/**\n * Validar y actualizar el estado del checkbox de una etapa según sus candidatos.\n *\n * @param {jQuery} $etapa_tarjeta Card de la etapa a validar.\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarEstadoCheckboxEtapa($etapa_tarjeta) {\n    let $checkbox_etapa = $etapa_tarjeta.find('input[name=\"etapa_check\"]');\n    let $checkboxes_candidatos = $etapa_tarjeta.find('input[name=\"candidato_check\"]');\n\n    let total_candidatos = $checkboxes_candidatos.length;\n    let candidatos_seleccionados_etapa = $checkboxes_candidatos.filter(':checked').length;\n\n    if (candidatos_seleccionados_etapa === 0) {\n        $checkbox_etapa.prop('indeterminate', false);\n        $checkbox_etapa.prop('checked', false);\n    } else if (candidatos_seleccionados_etapa === total_candidatos) {\n        $checkbox_etapa.prop('indeterminate', false);\n        $checkbox_etapa.prop('checked', true);\n    } else {\n        $checkbox_etapa.prop('indeterminate', true);\n        $checkbox_etapa.prop('checked', false);\n    }\n}\n\n/**\n * Actualizar el contador de candidatos seleccionados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarContadorSeleccionados() {\n    let checkboxes_seleccionados = $('input[name=\"candidato_check\"]:checked');\n    let contador = checkboxes_seleccionados.length;\n\n    $('#etapa-total-seleccionados').text(contador);\n\n    candidatos_seleccionados = checkboxes_seleccionados.map(function() {\n        return parseInt($(this).val(), 10);\n    }).get();\n}\n\n/**\n * Actualizar estado del botón de descartar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarEstadoBotonDescartar() {\n    let hay_seleccionados = candidatos_seleccionados.length > 0;\n\n    if (hay_seleccionados) {\n        $('#etapa-boton-descartar').prop('disabled', false);\n        $('#etapa-boton-descartar').attr('onclick', 'descartarCandidatos()');\n    } else {\n        $('#etapa-boton-descartar').prop('disabled', true);\n        $('#etapa-boton-descartar').attr('onclick', '');\n    }\n}\n\n/**\n * Aplicar filtros y recargar etapas.\n *\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction aplicarFiltrosDropdown(filtros) {\n    json_filtros_etapas = filtros;\n\n    let filtros_endpoint = {};\n\n    if (filtros.ciudad_filtro) filtros_endpoint.ciudad_id = filtros.ciudad_filtro;\n    if (filtros.departamento_filtro) filtros_endpoint.departamento_id = filtros.departamento_filtro;\n    if (filtros.pais_filtro) filtros_endpoint.pais_id = filtros.pais_filtro;\n    if (filtros.etapa_filtro) filtros_endpoint.etapa_id = filtros.etapa_filtro;\n    if (filtros.nivel_academico_filtro) filtros_endpoint.nivel_educativo_id = filtros.nivel_academico_filtro;\n    if (filtros.edad_filtro) filtros_endpoint.edad = filtros.edad_filtro;\n    if (filtros.nivel_adecuacion_filtro) filtros_endpoint.nivel_adecuacion = filtros.nivel_adecuacion_filtro;\n\n    if (filtros.fecha_agregado_filtro) {\n        let partes_fecha = filtros.fecha_agregado_filtro.split(' a ');\n        if (partes_fecha[0]) filtros_endpoint.fecha_desde = partes_fecha[0];\n        if (partes_fecha[1]) filtros_endpoint.fecha_hasta = partes_fecha[1];\n    }\n\n    if (filtros.chips && filtros.chips.length > 0) {\n        filtros_endpoint.chips = filtros.chips;\n    }\n\n    cargarEtapasConCandidatos(filtros_endpoint);\n}\n\n/**\n * Preparar objeto de filtros actuales para recargar etapas.\n *\n * @returns {Object} Objeto con filtros actuales.\n * @author Andres Morales\n */\nfunction prepararFiltrosActuales() {\n    let filtros_endpoint = {};\n\n    if (json_filtros_etapas.ciudad_filtro) filtros_endpoint.ciudad_id = json_filtros_etapas.ciudad_filtro;\n    if (json_filtros_etapas.departamento_filtro) filtros_endpoint.departamento_id = json_filtros_etapas.departamento_filtro;\n    if (json_filtros_etapas.pais_filtro) filtros_endpoint.pais_id = json_filtros_etapas.pais_filtro;\n    if (json_filtros_etapas.etapa_filtro) filtros_endpoint.etapa_id = json_filtros_etapas.etapa_filtro;\n    if (json_filtros_etapas.nivel_academico_filtro) filtros_endpoint.nivel_educativo_id = json_filtros_etapas.nivel_academico_filtro;\n    if (json_filtros_etapas.edad_filtro) filtros_endpoint.edad = json_filtros_etapas.edad_filtro;\n\n    if (json_filtros_etapas.fecha_agregado_filtro) {\n        let partes_fecha = json_filtros_etapas.fecha_agregado_filtro.split(' a ');\n        if (partes_fecha[0]) filtros_endpoint.fecha_desde = partes_fecha[0];\n        if (partes_fecha[1]) filtros_endpoint.fecha_hasta = partes_fecha[1];\n    }\n\n    if (json_filtros_etapas.chips && json_filtros_etapas.chips.length > 0) {\n        filtros_endpoint.chips = json_filtros_etapas.chips;\n    }\n\n    return filtros_endpoint;\n}\n\n/**\n * Inicializar eventos del modal de candidatos descartados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction inicializarEventosModalDescartados() {\n    // Evento para checkboxes en modal de descartados\n    $('#contenedor-candidatos-descartados').off('change', 'input[name=\"candidato_check\"]');\n    $('#contenedor-candidatos-descartados').on('change', 'input[name=\"candidato_check\"]', function() {\n        actualizarEstadoBotonRevertirDescarte();\n    });\n\n    // Evento para búsqueda en candidatos descartados\n    $('#buscar-candidatos-descartados').off('input');\n    $('#buscar-candidatos-descartados').on('input', function() {\n        let termino_busqueda = $(this).val().toLowerCase().trim();\n        filtrarCandidatosDescartados(termino_busqueda);\n    });\n\n    // Limpiar búsqueda al cerrar el modal\n    $('#modal-candidatos-descartados').off('hidden.bs.modal');\n    $('#modal-candidatos-descartados').on('hidden.bs.modal', function() {\n        $('#buscar-candidatos-descartados').val('');\n        $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]').prop('checked', false);\n        $('#boton-revertir-descarte-masivo').prop('disabled', true);\n    });\n}\n\n/**\n * Actualizar estado del botón de revertir descarte masivo.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarEstadoBotonRevertirDescarte() {\n    let checkboxes_seleccionados = $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]:checked');\n    let hay_seleccionados = checkboxes_seleccionados.length > 0;\n\n    $('#boton-revertir-descarte-masivo').prop('disabled', !hay_seleccionados);\n}\n\n/**\n * Filtrar candidatos descartados por término de búsqueda.\n *\n * @param {string} termino Término de búsqueda.\n * @returns {void}\n * @author Andres Morales\n */\nfunction filtrarCandidatosDescartados(termino) {\n    $('#contenedor-candidatos-descartados .candidato-card').each(function() {\n        let $tarjeta = $(this);\n        let nombre = $tarjeta.find('.candidato-nombre').text().toLowerCase();\n        let ubicacion = $tarjeta.find('.bi-geo-alt').next('span').text().toLowerCase();\n        let etapa_descarte = $tarjeta.find('.tag-tonal-orange').text().toLowerCase();\n\n        let coincide = nombre.includes(termino) || ubicacion.includes(termino) || etapa_descarte.includes(termino);\n\n        if (coincide || termino === '') {\n            $tarjeta.removeClass('d-none');\n        } else {\n            $tarjeta.addClass('d-none');\n        }\n    });\n}\n\n/**\n * Revertir descarte de un candidato individual.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction devolverDescarteCandidato(etapa_vacante_usuario_id) {\n    revertirDescarte([etapa_vacante_usuario_id]);\n}\n\n/**\n * Revertir descarte de candidatos seleccionados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction revertirDescarteMasivo() {\n    let checkboxes_seleccionados = $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]:checked');\n\n    if (checkboxes_seleccionados.length === 0) {\n        mostrarToast('warning', 'Selecciona al menos un candidato para revertir el descarte');\n        return;\n    }\n\n    let revertir_ids = checkboxes_seleccionados.map(function() {\n        return parseInt($(this).val(), 10);\n    }).get();\n\n    revertirDescarte(revertir_ids);\n}\n\n/**\n * Revertir descarte de uno o varios candidatos con confirmación.\n *\n * @param {Array} ids Array de IDs de relaciones etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction revertirDescarte(ids) {\n    let cantidad = ids.length;\n\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Revertir descarte?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                   ¿Estás seguro que deseas revertir el descarte ${cantidad === 1 ? 'del candidato' : 'de los candidatos'}?\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Revertir',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed) {\n            ejecutarRevertirDescarte(ids);\n        }\n    });\n}\n\n/**\n * Ejecutar la reversión de descarte.\n *\n * @param {Array} ids Array de IDs de relaciones etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction ejecutarRevertirDescarte(ids) {\n    if (ids.length > 1) {\n        $('#boton-revertir-descarte-masivo').prop('disabled', true).html('<i class=\"bi bi-hourglass-split\"></i> Procesando...');\n    }\n\n    $.ajax({\n        url: '/vacantes-revertir-descarte-aplicantes',\n        type: 'POST',\n        dataType: 'json',\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        data: {\n            ids: ids\n        },\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message || 'Descarte revertido exitosamente');\n            $('#modal-candidatos-descartados').modal('hide');\n            cargarEtapasConCandidatos(prepararFiltrosActuales());\n        },\n        error: function(xhr) {\n            var mensaje = xhr.responseJSON?.message || 'Error al revertir el descarte';\n            mostrarToast('danger', mensaje);\n        },\n        complete: function() {\n            if (ids.length > 1) {\n                $('#boton-revertir-descarte-masivo').prop('disabled', false).html('Revertir descarte');\n            }\n        }\n    });\n}\n\n/**\n * Verificar si la siguiente etapa es \"Contratados\".\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @param {function} callback Función callback con resultado booleano.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction verificarSiguienteEtapa(etapa_vacante_usuario_id, callback) {\n    var $contenedor_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n    var $etapa_contenedor = $contenedor_candidato.closest('.etapa-card');\n    var $siguiente_etapa = $etapa_contenedor.next('.etapa-card');\n\n    if ($siguiente_etapa.length > 0) {\n        var nombre_siguiente_etapa = $siguiente_etapa.find('.etapa-titulo').text().trim();\n        callback(nombre_siguiente_etapa === 'Contratados');\n    } else {\n        callback(false);\n    }\n}\n\n/**\n * Ejecutar el movimiento de etapa (flujo normal).\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @returns {void}\n * @author Sergio Vargas\n * @author Andres Gonzalez\n * @author Jair Carvajal\n * @author Andres Morales\n * @author Esperanza Olivo\n */\nfunction ejecutarMovimientoEtapa(etapa_vacante_usuario_id) {\n    var botones_mover_etapa = $(`.btn-mover-etapa-accion[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n    botones_mover_etapa.prop('disabled', true);\n\n    var modal_detalle_abierto = $('#modal-detalle-resultados').hasClass('show');\n\n    if (modal_detalle_abierto) {\n        moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n        return;\n    }\n\n    var seccion_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n\n    if (seccion_candidato.length > 0) {\n        var etapa_actual = seccion_candidato.closest('.etapa-card');\n        var etapa_siguiente = etapa_actual.next('.etapa-card');\n\n        if (etapa_siguiente.length > 0) {\n            // Ejecutar animación\n            animarMovimientoEtapaCandidato(seccion_candidato, etapa_siguiente);\n\n            moverVacantesEtapaAplicante(etapa_vacante_usuario_id, etapa_siguiente);\n        } else {\n            moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n        }\n    } else {\n        moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n    }\n}\n\n/**\n * Animar el movimiento de la tarjeta hacia la siguiente etapa.\n *\n * @param {Object} tarjeta_candidato Tarjeta del candidato.\n * @param {Object} etapa_destino Etapa destino.\n * @returns {void}\n * @author Esperanza Olivo\n */\nfunction animarMovimientoEtapaCandidato(tarjeta_candidato, etapa_destino) {\n    $('#candidato-animacion-temp').remove();\n\n    var posicion_tarjeta = tarjeta_candidato.offset();\n    var ancho_tarjeta = tarjeta_candidato.outerWidth();\n    var alto_tarjeta = tarjeta_candidato.outerHeight();\n    var scroll_vertical = $(window).scrollTop();\n\n    var contenedor_destino = etapa_destino.find('.candidatos-container, .card-body').first();\n    var destino = contenedor_destino.offset();\n    var destino_ancho = contenedor_destino.outerWidth();\n\n    tarjeta_candidato.css('visibility', 'hidden');\n\n    var tarjeta_clon_candidato = tarjeta_candidato.clone().attr('id', 'candidato-animacion-temp').css({\n        position: 'fixed',\n        top: posicion_tarjeta.top - scroll_vertical,\n        left: posicion_tarjeta.left,\n        width: ancho_tarjeta,\n        height: alto_tarjeta,\n        margin: 0,\n        zIndex: 9999,\n        visibility: 'visible',\n        pointerEvents: 'none',\n        boxShadow: '0 8px 25px rgba(0,0,0,0.18)'\n    });\n\n    $('body').append(tarjeta_clon_candidato);\n\n    var tarjetas_destino = contenedor_destino.find('.candidato-card').length;\n    var desplazamiento_vertical = tarjetas_destino * 10;\n\n    tarjeta_clon_candidato.animate({\n        top: destino.top - scroll_vertical + 80 + desplazamiento_vertical + 8, \n        left: destino.left + (destino_ancho - ancho_tarjeta) / 2\n    }, 180, 'swing', function() {\n        tarjeta_clon_candidato.remove();\n        tarjeta_candidato.css('visibility', 'visible');\n        var contenedor_destino = etapa_destino.find('.candidatos-container, .card-body').first();\n        contenedor_destino.append(tarjeta_candidato); \n    });\n}\n\n/**\n * Ejecutar el movimiento de etapa (Envio de ajax).\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @param {jQuery} etapa_siguiente Etapa destino (opcional).\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Morales\n * @author Esperanza Olivo\n */\nfunction moverVacantesEtapaAplicante(etapa_vacante_usuario_id, etapa_siguiente = null) {\n    var tiempo_inicio = Date.now();\n    const DURACION_ANIMACION = 280;\n\n    $.ajax({\n        url: `/vacantes-mover-etapa-aplicante/${etapa_vacante_usuario_id}`,\n        type: 'POST',\n        dataType: 'json',\n        headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n        success: function(respuesta) {\n            var tiempo_transcurrido = Date.now() - tiempo_inicio;\n            var tiempo_espera = Math.max(0, DURACION_ANIMACION - tiempo_transcurrido);\n\n            setTimeout(function() {\n                $('#candidato-animacion-temp').remove();\n                $('#modal-detalle-resultados').modal('hide');\n                mostrarToast('success', respuesta.message);\n\n                var filtros_actuales = prepararFiltrosActuales();\n                cargarEtapasConCandidatos(filtros_actuales);\n\n                if (etapa_siguiente && etapa_siguiente.length > 0) {\n                    setTimeout(function() {\n                        scrollHaciaEtapa(etapa_siguiente);\n                    }, 300);\n                }\n            }, tiempo_espera);\n        },\n        error: function(xhr) {\n            $('#candidato-animacion-temp').remove();\n\n            var mensaje = xhr.responseJSON?.message || 'Error al mover el candidato de etapa';\n            mostrarToast('danger', mensaje);\n\n            var botones_mover_etapa = $(`.btn-mover-etapa-accion[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n            botones_mover_etapa.prop('disabled', false);\n\n            $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`).css('visibility', 'visible');\n        }\n    });\n}\n\n/**\n * Mostrar modal de competencias por mejorar.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction mostrarModalCompetenciasMejorar(etapa_vacante_usuario_id) {\n    window.etapa_vacante_usuario_pendiente = etapa_vacante_usuario_id;\n\n    $.ajax({\n        url: `/vacantes-competencias-mejorar/${etapa_vacante_usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        beforeSend: function() {\n            $('#contenedor-competencias-mejorar').html(`\n                <div class=\"text-center py-5\">\n                    <div class=\"spinner-border text-primary\" role=\"status\">\n                        <span class=\"visually-hidden\">Cargando...</span>\n                    </div>\n                    <p class=\"mt-3 text-muted\">Consultando competencias...</p>\n                </div>\n            `);\n            $('#modal-competencias-mejorar').modal('show');\n        },\n        success: function(respuesta) {\n            renderizarCompetenciasMejorar(respuesta.data);\n\n            if (respuesta.data.usuario_id) {\n                var url_sso = `/sso/wordpress?student_id=${respuesta.data.usuario_id}`;\n                $('#btn-plataforma-capacitacion')\n                    .attr('href', url_sso)\n                    .attr('data-usuario-id', respuesta.data.usuario_id);\n            }\n        },\n        error: function(xhr) {\n            var mensaje = xhr.responseJSON?.message || 'Error al obtener competencias';\n            $('#contenedor-competencias-mejorar').html(`\n                <div class=\"alert alert-warning\" role=\"alert\">\n                    <i class=\"bi bi-exclamation-triangle me-2\"></i>${mensaje}\n                </div>\n            `);\n        }\n    });\n}\n\n/**\n * Renderizar competencias en el modal.\n *\n * @param {Object} data Datos de competencias agrupadas por prueba.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction renderizarCompetenciasMejorar(data) {\n    var html = '';\n\n    if (!data.pruebas || data.pruebas.length === 0) {\n        html = `\n            <div class=\"alert alert-info\" role=\"alert\">\n                <i class=\"bi bi-info-circle me-2\"></i>\n                No se encontraron resultados de pruebas psicométricas para este candidato.\n            </div>\n        `;\n    } else {\n        data.pruebas.forEach(function(prueba) {\n            html += `\n                <div class=\"card mb-3\">\n                    <div class=\"card-header bg-primary text-white\">\n                        <h6 class=\"mb-0\">\n                            <i class=\"bi bi-clipboard-data me-2\"></i>${prueba.nombre_prueba}\n                        </h6>\n                    </div>\n                    <div class=\"card-body\">\n            `;\n\n            if (prueba.competencias && prueba.competencias.length > 0) {\n                html += '<ul class=\"list-group list-group-flush\">';\n                prueba.competencias.forEach(function(competencia, index) {\n                    var color_badge = competencia.puntaje < 40 ? 'bg-danger' :\n                                     competencia.puntaje < 70 ? 'bg-warning' : 'bg-success';\n                    html += `\n                        <li class=\"list-group-item d-flex justify-content-between align-items-center\">\n                            <div><strong>${index + 1}. ${competencia.nombre}</strong></div>\n                            <span class=\"badge ${color_badge} rounded-pill\">${competencia.puntaje} pts</span>\n                        </li>\n                    `;\n                });\n                html += '</ul>';\n            } else {\n                html += `<p class=\"text-muted mb-0\">\n                    <i class=\"bi bi-info-circle me-2\"></i>\n                    No se identificaron competencias específicas para esta prueba.\n                </p>`;\n            }\n            html += `</div></div>`;\n        });\n    }\n\n    $('#contenedor-competencias-mejorar').html(html);\n}\n\n/**\n * Cerrar modal y ejecutar movimiento de etapa.\n *\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction cerrarModalCompetenciasMejorar() {\n    $('#modal-competencias-mejorar').modal('hide');\n    if (window.etapa_vacante_usuario_pendiente) {\n        ejecutarMovimientoEtapa(window.etapa_vacante_usuario_pendiente);\n        window.etapa_vacante_usuario_pendiente = null;\n    }\n}\n\n/**\n * Crear mensaje cuando la etapa de prueba técnica no tiene archivos de instrucciones.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {string} HTML del mensaje.\n * @author Andres Morales\n */\nfunction crearMensajeSinArchivosInstrucciones(etapa_id) {\n    return `\n        <div class=\"card candidato-card mb-3\">\n            <div class=\"card-body p-4\">\n                <div class=\"d-flex flex-column justify-content-center align-items-center py-3\">\n                    <i class=\"bi bi-folder\" style=\"font-size: 80px; color: #9CA3AF;\"></i>\n                    <p class=\"text-headline-6 text-gray-30 text-center mb-0 mt-4 px-4\">\n                        Adjunta una prueba o elimina esta etapa para continuar.\n                    </p>\n                    <div class=\"d-flex gap-3 mt-4\">\n                        ${crearBoton({\n                            clases: 'btn-primary',\n                            texto: 'Adjuntar prueba técnica',\n                            onclick: `abrirModalAdjuntarInstrucciones(${etapa_id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-danger',\n                            texto: 'Eliminar etapa',\n                            onclick: `eliminarEtapaPruebaTecnica(${etapa_id})`\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Generar botones de acción para un candidato según el contexto.\n *\n * @param {Object} usuario_vacante Datos del candidato.\n * @param {string} origen 'listado' o 'modal'.\n * @param {string} nombre_etapa Nombre de la etapa.\n * @param {boolean} etapa_anterior_contracion Si es etapa anterior a Contratados.\n * @param {boolean} tiene_motivo_abandono Si el candidato abandonó.\n * @returns {string} HTML de los botones.\n * @author Andres Morales\n * @author José Manuel Jiménez\n */\nfunction generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono) {\n    let html = '';\n\n    // Lógica para etapa de Prueba técnica\n    if (origen === 'listado' && nombre_etapa === 'Prueba técnica') {\n        let prueba_tecnica = usuario_vacante.prueba_tecnica || {};\n        let tiene_prueba = prueba_tecnica.existe && (prueba_tecnica.tiene_archivos || prueba_tecnica.tiene_enlace);\n        let tiene_calificacion = usuario_vacante.puntaje !== null;\n\n        if (!tiene_prueba) {\n            // Ojo gris - candidato NO ha subido su prueba\n            html += crearBoton({\n                clases: 'btn-outline-secondary btn-circle',\n                texto: '<i class=\"bi bi-eye-slash\"></i>',\n                disabled: true,\n                tooltip: crearTooltip({\n                    content: 'Candidato no ha subido su prueba técnica',\n                    placement: 'bottom'\n                })\n            });\n        } else if (!tiene_calificacion) {\n            // Ojo azul - abre detalle del candidato para calificar\n            html += crearBoton({\n                clases: 'btn-outline-primary btn-circle',\n                texto: '<i class=\"bi bi-eye\"></i>',\n                onclick: `verDetalleCandidato(${usuario_vacante.usuario.id}, 'Prueba técnica')`,\n                tooltip: crearTooltip({\n                    content: 'Ver detalle del candidato',\n                    placement: 'bottom'\n                })\n            });\n        } else {\n            // Flecha - puede mover de etapa\n            html += crearBoton({\n                clases: 'btn-outline-primary btn-circle btn-mover-etapa-accion',\n                adicional: `data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\"`,\n                texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                onclick: `moverEtapaCandidato(${usuario_vacante.id})`,\n                tooltip: crearTooltip({\n                    content: 'Mover de etapa',\n                    placement: 'bottom'\n                })\n            });\n        }\n    } else if (origen === 'listado' && nombre_etapa !== 'Contratados') {\n        // Lógica para otras etapas (código existente)\n        let icono = '<i class=\"bi bi-arrow-90deg-right\"></i>';\n        let mensaje = 'Mover de etapa';\n        if (etapa_anterior_contracion) {\n            icono = '<i class=\"bi bi-file-earmark-person\"></i>';\n            mensaje = 'Seleccionar como contratado';\n        }\n\n        html += crearBoton({\n            clases: 'btn-outline-primary btn-circle btn-mover-etapa-accion',\n            adicional: `data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\"`,\n            texto: icono,\n            onclick: `moverEtapaCandidato(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: mensaje,\n                placement: 'bottom'\n            }),\n            disabled: nombre_etapa === 'Documentos para contratación'\n                ? !usuario_vacante.etapa_completada\n                : ((usuario_vacante.puntaje === null && usuario_vacante.puntaje_ia === null) || usuario_vacante.etapa_completada === false || (usuario_vacante?.formato_entrevista_completado !== undefined && usuario_vacante?.formato_entrevista_completado === false))\n        });\n    }\n\n    // Botón de descartar\n    if (origen === 'listado' && nombre_etapa !== 'Contratados') {\n        html += crearBoton({\n            clases: 'btn-outline-danger btn-circle',\n            texto: `<i class=\"bi bi-person-x\"></i>`,\n            onclick: `descartarCandidatos(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: 'Descartar candidato',\n                placement: 'bottom'\n            })\n        });\n    }\n\n    // Botón de revertir descarte (para modal)\n    if (origen === 'modal') {\n        html += crearBoton({\n            clases: 'btn-outline-success btn-circle',\n            texto: `<i class=\"bi bi-person-add\"></i>`,\n            onclick: `devolverDescarteCandidato(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: tiene_motivo_abandono ? 'No se puede revertir: candidato abandonó' : 'Revertir descarte',\n                placement: 'bottom'\n            }),\n            disabled: tiene_motivo_abandono\n        });\n    }\n\n    return html;\n}\n\nvar archivos_instrucciones_prueba = [];\n\n/**\n * Abrir modal para adjuntar instrucciones de prueba técnica.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {void}\n * @author Andres Morales\n */\nfunction abrirModalAdjuntarInstrucciones(etapa_id) {\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').remove();\n\n    archivos_instrucciones_prueba = [];\n\n    $.ajax({\n        url: `/etapas-vacantes/${etapa_id}/obtener-configuraciones-prueba-tecnica`,\n        type: 'GET',\n        success: function(respuesta) {\n            crearModalConDatos(etapa_id, respuesta.data ||{});\n        },\n        error: function() {\n            crearModalConDatos(etapa_id, {});\n        }\n    });\n}\n\n/**\n * Crear el modal con los datos existentes.\n *\n * @param {number} etapa_id ID de la etapa.\n * @param {Object} datos Datos de configuración existentes.\n * @returns {void}\n * @author Andres Morales\n */\nfunction crearModalConDatos(etapa_id, datos = {}) {\n    let descripcion_valor = datos.descripcion || '';\n    let enlace_valor = datos.enlace || '';\n\n    let modal_html = crearModal({\n        id: 'modal-adjuntar-instrucciones-prueba-tecnica',\n        titulo_header: 'Prueba técnica',\n        dialog_class: 'modal-dialog-centered modal-lg modal-dialog-scrollable',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\"',\n        modal_body: `\n            <form class=\"col-12 px-3\" id=\"form-adjuntar-instrucciones\" enctype=\"multipart/form-data\">\n                <input type=\"hidden\" name=\"etapa_vacante_id\" value=\"${etapa_id}\">\n                <div class=\"col-12 px-0 text-label-1 py-2\">\n                    Puedes habilitar esta etapa aunque no tengas aún la prueba lista. Sube el archivo más adelante.\n                </div>\n                <div class=\"col-12 px-0 text-body-2 text-gray-10 my-3\">\n                    Agrega una descripción a la prueba\n                </div>\n                <div class=\"col-12 my-2 pb-2\">\n                    ${crearTextarea({\n                        id: 'descripcion_prueba',\n                        name: 'descripcion',\n                        placeholder: '',\n                        required: true,\n                        value: descripcion_valor,\n                        label: 'Descripción',\n                        contador: 1500\n                    })}\n                </div>\n                <div class=\"col-12 px-4 rounded-3 border\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-body-2 text-gray-10 my-3\">\n                            Adjuntar prueba técnica\n                        </div>\n                        <div class=\"col-12\">\n                            ${crearInput({\n                                id: 'enlace_prueba',\n                                name: 'enlace',\n                                input_container_class: 'mb-4',\n                                label: 'Agregar enlace',\n                                required: false,\n                                value: enlace_valor,\n                                adicional: 'style=\"height: 60px;\"'\n                            })}\n                        </div>\n                        <div class=\"col-12\">\n                            ${crearInputFile({\n                                id: 'archivo_prueba',\n                                name: 'archivo_prueba',\n                                placeholder: '',\n                                disabled: false,\n                                required: false,\n                                multiple: true,\n                                accept: 'image/jpg,image/jpeg,image/png,application/pdf,.doc,.docx,.xls,.xlsx',\n                            })}\n                        </div>\n                        <div class=\"col-12 pb-4\">\n                            <div class=\"col-12 pt-4 px-4 mb-4 rounded-3 border text-body-3\">\n                                Los archivos tienen que:\n                                <ul class=\"text-body-2 text-gray-10\">\n                                    <li>Estar en formato JPG, PNG, PDF, DOCX o XLSX.</li>\n                                    <li>No superar los 2000 px de alto y pesar máximo 5GB.</li>\n                                </ul>\n                            </div>\n                            <div class=\"col-12\">\n                                <div class=\"row g-3\" id=\"contenedor-archivos-instrucciones\"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </form>\n        `,\n        boton_footer1: {\n            texto: 'Cancelar',\n            class: 'btn-outline-primary',\n            cerrar_modal: true\n        },\n        boton_footer2: {\n            texto: 'Guardar',\n            class: 'btn-primary',\n            id: 'btn-guardar-instrucciones',\n            onclick: 'adjuntarInstruccionesPruebaTecnica()',\n            disabled: true\n        }\n    });\n\n    $('body').append(modal_html);\n\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').on('shown.bs.modal', function() {\n        inicializarIputsFile();\n\n        $('#archivo_prueba').off('change').on('change', function (e) {\n            let archivos_seleccionados = e.target.files;\n            for (let i = 0; i < archivos_seleccionados.length; i++) {\n                let archivo = archivos_seleccionados[i];\n                let nombre_repetido = archivos_instrucciones_prueba.some(item => item.archivo.name === archivo.name);\n                if (!nombre_repetido) {\n                    archivos_instrucciones_prueba.push({\n                        archivo: archivo,\n                        seleccionado: true,\n                        id: Date.now() + '_' + i\n                    });\n                } else {\n                    mostrarToast('warning', `El archivo \"${archivo.name}\" ya fue seleccionado anteriormente.`);\n                }\n            }\n            renderizarArchivosInstrucciones();\n        });\n\n        validarCamposModalPruebaTecnicaDetalle();\n\n        inicializarTooltips();\n    });\n\n    // Limpiar cuando se cierra el modal\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').on('hidden.bs.modal', function() {\n        // Liberar todas las URLs temporales de las imágenes\n        $('#contenedor-archivos-instrucciones img').each(function() {\n            URL.revokeObjectURL($(this).attr('src'));\n        });\n\n        $('#contenedor-archivos-instrucciones').empty();\n        $('#archivo_prueba').val('');\n        archivos_instrucciones_prueba = [];\n        $(this).remove();\n    });\n\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').modal('show');\n}\n\n/**\n * Renderizar archivos seleccionados para instrucciones.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction renderizarArchivosInstrucciones() {\n    let contenedor = $('#contenedor-archivos-instrucciones');\n    contenedor.empty();\n\n    if (archivos_instrucciones_prueba.length === 0) {\n        return;\n    }\n\n    let documentos = [];\n    let imagenes = [];\n\n    archivos_instrucciones_prueba.forEach((item) => {\n        if (!item.seleccionado) return;\n\n        let archivo = item.archivo;\n        let extension = archivo.name.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'].includes(extension);\n\n        if (es_imagen) {\n            imagenes.push(item);\n        } else {\n            documentos.push(item);\n        }\n    });\n\n    documentos.forEach((item) => {\n        let archivo = item.archivo;\n        let extension = archivo.name.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtensionDetalle(extension);\n\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono}\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\"\n                             ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash-fill text-danger pointer\" onclick=\"quitarArchivoInstruccion('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        contenedor.append(html);\n    });\n\n    imagenes.forEach((item) => {\n        let archivo = item.archivo;\n        let url_imagen = URL.createObjectURL(archivo);\n\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 px-0 imagen-archivo-previsualizacion\"\n                             src=\"${url_imagen}\"\n                             alt=\"${archivo.name}\"\n                             style=\"height: 97px; object-fit: cover; border-radius: 6px 6px 0 0;\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 text-truncate\"\n                             ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash-fill text-danger pointer\" onclick=\"quitarArchivoInstruccion('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        contenedor.append(html);\n    });\n\n    inicializarTooltips();\n}\n\n/**\n * Quitar archivo de instrucciones seleccionado.\n *\n * @param {string} id ID del archivo.\n * @returns {void}\n * @author Andres Morales\n */\nfunction quitarArchivoInstruccion(id) {\n    // Buscar la imagen en el DOM y revocar la URL temporal si existe\n    let img = $(`img[src]`).filter(function() {\n        return $(this).closest('.archivo-item').find(`[onclick*=\"${id}\"]`).length > 0;\n    });\n\n    if (img.length > 0) {\n        URL.revokeObjectURL(img.attr('src'));\n    }\n\n    archivos_instrucciones_prueba = archivos_instrucciones_prueba.filter(item => item.id !== id);\n\n    renderizarArchivosInstrucciones();\n}\n\n/**\n * Obtener icono por extensión de archivo con colores específicos.\n *\n * @param {string} extension Extensión del archivo.\n * @returns {string} Clase del icono con color.\n * @author Andres Morales\n */\nfunction obtenerIconoPorExtensionDetalle(extension) {\n    let iconos = {\n        'pdf': 'bi bi-filetype-pdf text-danger fs-2',          // Rojo\n        'doc': 'bi bi-filetype-docx text-primary fs-2',        // Azul\n        'docx': 'bi bi-filetype-docx text-primary fs-2',       // Azul\n        'xls': 'bi bi-filetype-xlsx text-success fs-2',        // Verde\n        'xlsx': 'bi bi-filetype-xlsx text-success fs-2',       // Verde\n        'jpg': 'bi bi-file-image text-info fs-2',              // Cyan\n        'jpeg': 'bi bi-file-image text-info fs-2',             // Cyan\n        'png': 'bi bi-file-image text-info fs-2',              // Cyan\n        'gif': 'bi bi-file-image text-info fs-2',              // Cyan\n        'bmp': 'bi bi-file-image text-info fs-2',              // Cyan\n        'webp': 'bi bi-file-image text-info fs-2'              // Cyan\n    };\n    return iconos[extension] || 'bi bi-file-earmark text-secondary fs-2';\n}\n\n/**\n * Adjuntar instrucciones de prueba técnica.\n *\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction adjuntarInstruccionesPruebaTecnica() {\n    let formulario_datos = new FormData();\n\n    formulario_datos.append('etapa_vacante_id', $('#form-adjuntar-instrucciones input[name=\"etapa_vacante_id\"]').val());\n    formulario_datos.append('descripcion', $('#descripcion_prueba').val());\n    formulario_datos.append('enlace', $('#enlace_prueba').val());\n    formulario_datos.append('notificar_aplicantes', 1);\n\n    archivos_instrucciones_prueba.forEach((item) => {\n        if (item.seleccionado) {\n            formulario_datos.append('archivos[]', item.archivo);\n        }\n    });\n\n    $('#btn-guardar-instrucciones').prop('disabled', true).html('<i class=\"bi bi-hourglass-split me-2\"></i>Guardando...');\n\n    $.ajax({\n        url: '/etapas-vacantes-adjuntar-archivos',\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message || 'Prueba técnica guardada correctamente');\n            $('#modal-adjuntar-instrucciones-prueba-tecnica').modal('hide');\n            cargarEtapasConCandidatos(prepararFiltrosActuales());\n        },\n        error: function(xhr) {\n            let mensaje = xhr.responseJSON?.message || 'Error al guardar la prueba técnica';\n            mostrarToast('danger', mensaje);\n            $('#btn-guardar-instrucciones').prop('disabled', false).html('Guardar');\n        }\n    });\n}\n\n/**\n * Eliminar etapa de prueba técnica.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {void}\n * @author Andres Morales\n */\nfunction eliminarEtapaPruebaTecnica(etapa_id) {\n    Swal.fire({\n        width: '533px',\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">\n                    ¿Eliminar etapa?\n                </div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                    Esta seguro de querer eliminar la etapa Prueba técnica.\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-danger w-100 justify-content-center',\n                        texto: 'Eliminar etapa',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed) {\n            $.ajax({\n                url: `/etapas-vacantes/${etapa_id}/eliminar-etapa-prueba-tecnica`,\n                type: 'DELETE',\n                headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n                success: function(respuesta) {\n                    mostrarToast('success', respuesta.message || 'Etapa eliminada correctamente');\n                    cargarEtapasConCandidatos(prepararFiltrosActuales());\n                },\n                error: function(xhr) {\n                    let mensaje = xhr.responseJSON?.message || 'Error al eliminar la etapa';\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Validar campos del modal de prueba técnica en detalle y habilitar/deshabilitar botón guardar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarCamposModalPruebaTecnicaDetalle() {\n    let campos = [\n        '#descripcion_prueba'\n    ];\n\n    // Agregar evento input a todos los campos\n    campos.forEach(function(campo) {\n        $(campo).on('input', function() {\n            validarYActualizarBotonGuardarDetalle();\n        });\n    });\n\n    validarYActualizarBotonGuardarDetalle();\n}\n\n/**\n * Validar campos y actualizar estado del botón guardar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarYActualizarBotonGuardarDetalle() {\n    let descripcion = $('#descripcion_prueba').val().trim();\n\n    let es_valido = descripcion !== '';\n\n    $('#btn-guardar-instrucciones').prop('disabled', !es_valido);\n}\n\n/**\n * Hacer scroll suave hacia una etapa específica después del movimiento.\n *\n * @param {jQuery} etapa_destino Etapa a la que hacer scroll.\n * @returns {void}\n * @author Andres Morales\n */\nfunction scrollHaciaEtapa(etapa_destino) {\n    var $contenedor = $('#contenido-etapas-lista');\n\n    if (!$contenedor.length || !etapa_destino.length) {\n        return;\n    }\n\n    var etapa_id = etapa_destino.data('etapa-id');\n    var $etapa_actualizada = $(`.etapa-card[data-etapa-id=\"${etapa_id}\"]`);\n\n    if (!$etapa_actualizada.length) {\n        return;\n    }\n\n    var desplazamiento_izquierda_contenedor = $contenedor.scrollLeft();\n    var contenedor_ancho = $contenedor.outerWidth();\n    var ancho_desplazamiento_contenedor = $contenedor[0].scrollWidth;\n\n    var posicion_etapa = $etapa_actualizada.position().left;\n    var etapa_ancho = $etapa_actualizada.outerWidth();\n\n    var limite_izquierdo = desplazamiento_izquierda_contenedor;\n    var limite_derecho = desplazamiento_izquierda_contenedor + contenedor_ancho;\n\n    var etapa_visible = (posicion_etapa >= limite_izquierdo) &&\n                       ((posicion_etapa + etapa_ancho) <= limite_derecho);\n\n    if (etapa_visible) {\n        return;\n    }\n\n    var nueva_posicion_scroll = posicion_etapa - (contenedor_ancho / 2) + (etapa_ancho / 2);\n\n    nueva_posicion_scroll = Math.max(0, Math.min(nueva_posicion_scroll, ancho_desplazamiento_contenedor - contenedor_ancho));\n\n    $contenedor.animate(\n        { scrollLeft: nueva_posicion_scroll },\n        {\n            duration: 600,\n            easing: 'swing'\n        }\n    );\n}\n\n\n","structuredPatch":[{"oldStart":487,"oldLines":10,"newStart":487,"newLines":10,"lines":["                         <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>","                         <div class=\"candidato-info d-flex flex-column gap-1\">","                             ${etapa_descarte_html}","-                            ${(origen === 'modal' && fecha_notificacion) ? `","+                            ${(origen === 'modal' && fecha_descarte) ? `","                                 <div class=\"d-flex align-items-center gap-2\">","                                     <i class=\"bi bi-calendar-event\"></i>","-                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>","+                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_descarte}</span>","                                 </div>","                             ` : ''}","                             ${documento ? `"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"d4b5f17a-45fa-4c75-85d6-734d42c252be"}
{"parentUuid":"18e94af7-628c-4724-ad70-474f2f21018f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01H7Jcaja54vCrVHAgiuvav4","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora la fecha de descarte usa `created_at` en lugar de `fecha_notificacion`.\n\n| Antes | Ahora |\n|-------|-------|\n| `usuario_vacante.fecha_notificacion` | `usuario_vacante.created_at` |"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":730,"cache_read_input_tokens":47056,"cache_creation":{"ephemeral_5m_input_tokens":730,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKUGHMF5uE75Q9pXuFXw","type":"assistant","uuid":"19c979bc-ff45-46da-8f0f-6c840a7ba445","timestamp":"2026-01-20T23:08:00.373Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-20T23:18:26.247Z","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d"}
{"type":"file-history-snapshot","messageId":"f7af9fda-09c3-4121-b8b5-48f5d4a0dc99","snapshot":{"messageId":"f7af9fda-09c3-4121-b8b5-48f5d4a0dc99","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v6","version":6,"backupTime":"2026-01-20T23:18:26.468Z"},"public\\js\\vacantes\\detalles\\detalle-etapas.js":{"backupFileName":"dccddb1063a31949@v2","version":2,"backupTime":"2026-01-20T23:18:26.482Z"}},"timestamp":"2026-01-20T23:18:26.452Z"},"isSnapshotUpdate":false}
{"parentUuid":"6941133a-dc04-4afa-9de1-631b932b8946","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01TGd1a5ngijj1RYkKZ3U3t8","parentToolUseID":"toolu_01TGd1a5ngijj1RYkKZ3U3t8","uuid":"fd0d667c-01e8-46de-a7d8-9198863b57b8","timestamp":"2026-01-20T23:06:09.876Z"}
{"parentUuid":"7029f6a3-615d-46f7-bd84-4f5ebd6514c6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01QMMP4usH6e9mNtDTsbLfww","parentToolUseID":"toolu_01QMMP4usH6e9mNtDTsbLfww","uuid":"74c2610b-3d48-46ca-be57-00338a42f65c","timestamp":"2026-01-20T23:06:16.571Z"}
{"parentUuid":"b0c16733-a603-4b64-a9ed-8e3a2b84d853","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01L8HTtSG2JTRDtGiMGpzxbw","parentToolUseID":"toolu_01L8HTtSG2JTRDtGiMGpzxbw","uuid":"8a21d9e1-3f9a-4ad2-aeff-ee9809866694","timestamp":"2026-01-20T23:06:30.143Z"}
{"parentUuid":"8a21d9e1-3f9a-4ad2-aeff-ee9809866694","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01L8HTtSG2JTRDtGiMGpzxbw","parentToolUseID":"toolu_01L8HTtSG2JTRDtGiMGpzxbw","uuid":"d796e2bc-04f0-4a7c-895e-1ec40d5b7ef3","timestamp":"2026-01-20T23:06:30.144Z"}
{"parentUuid":"a8864276-b70c-4de3-afd0-7fc3a5b53b79","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01L8HTtSG2JTRDtGiMGpzxbw","toolUseID":"toolu_01L8HTtSG2JTRDtGiMGpzxbw","timestamp":"2026-01-20T23:07:29.663Z","uuid":"167572c9-3640-45cb-bec5-ba6080f78811"}
{"parentUuid":"d4b5f17a-45fa-4c75-85d6-734d42c252be","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01LawfaUGe62xVb4tr6SozxW","parentToolUseID":"toolu_01LawfaUGe62xVb4tr6SozxW","uuid":"21831d00-1be1-426f-8384-05e4219e87fc","timestamp":"2026-01-20T23:07:41.117Z"}
{"parentUuid":"21831d00-1be1-426f-8384-05e4219e87fc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01LawfaUGe62xVb4tr6SozxW","parentToolUseID":"toolu_01LawfaUGe62xVb4tr6SozxW","uuid":"1736dd12-69c7-4514-a6d3-9dc0003b3d9e","timestamp":"2026-01-20T23:07:41.120Z"}
{"parentUuid":"18e94af7-628c-4724-ad70-474f2f21018f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01LawfaUGe62xVb4tr6SozxW","toolUseID":"toolu_01LawfaUGe62xVb4tr6SozxW","timestamp":"2026-01-20T23:07:55.457Z","uuid":"c49fff65-a290-4cae-a4b2-00776faab6a4"}
{"parentUuid":"19c979bc-ff45-46da-8f0f-6c840a7ba445","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 2498 to 2500 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\nlet archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"listo analiza esto de este archivos function renderizarDocumentosRequeridos() { public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js y me toca hace algho parecido aqui let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`); ya que me tiene que contar dos documentos que ha caargado el aplicante pero puede que por un tipo de documento cargue varios documentos entonces no me tine que contar varis archivos si no que contaria como 1"}]},"uuid":"f7af9fda-09c3-4121-b8b5-48f5d4a0dc99","timestamp":"2026-01-20T23:18:26.451Z"}
{"parentUuid":"f7af9fda-09c3-4121-b8b5-48f5d4a0dc99","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_014DeEgAXaefDfmEDoAUaMJ6","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a analizar la función `renderizarDocumentosRequeridos` para entender cómo cuenta los documentos."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":48230,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":48230,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXKV4hPPpUA536awF3aKw","type":"assistant","uuid":"1ebc8b85-4216-4f4d-a316-b8fbcbdc1506","timestamp":"2026-01-20T23:18:30.052Z"}
{"parentUuid":"1ebc8b85-4216-4f4d-a316-b8fbcbdc1506","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_014DeEgAXaefDfmEDoAUaMJ6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NKnzZ5ffiTLnezyDiZe2d5","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","offset":1,"limit":150}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":48230,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":48230,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXKV4hPPpUA536awF3aKw","type":"assistant","uuid":"0646cac3-a4ba-4178-bb43-787a717b2ee5","timestamp":"2026-01-20T23:18:31.265Z"}
{"parentUuid":"0646cac3-a4ba-4178-bb43-787a717b2ee5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NKnzZ5ffiTLnezyDiZe2d5","type":"tool_result","content":"     1→/**\n     2→ * Sistema de acciones por etapa - Documentos Solicitados\n     3→ *\n     4→ * @author Andres Morales\n     5→ */\n     6→\n     7→const TAMANIO_MAXIMO_ARCHIVO = 2 * 1024 * 1024;\n     8→const EXTENSIONES_PERMITIDAS = ['pdf', 'docx', 'xlsx'];\n     9→\n    10→let datos_etapa_documentos = null;\n    11→let archivos_documentos_seleccionados = {};\n    12→let documentos_solicitables_catalogo = [];\n    13→let archivos_guardados_backend = [];\n    14→\n    15→/**\n    16→ * Inicializa los eventos del modal de documentos al cargar el documento.\n    17→ * Configura la limpieza al cerrar el modal.\n    18→ *\n    19→ * @returns {void}\n    20→ * @author Andres Morales\n    21→ */\n    22→$(document).ready(function() {\n    23→    $('#modal-aplicacion-documentos-solicitados').on('hidden.bs.modal', function() {\n    24→        $('#contenedor-documentos-solicitados').empty();\n    25→        archivos_documentos_seleccionados = {};\n    26→        datos_etapa_documentos = null;\n    27→        documentos_solicitables_catalogo = [];\n    28→        archivos_guardados_backend = [];\n    29→    });\n    30→});\n    31→\n    32→/**\n    33→ * Obtiene el tipo MIME correspondiente a un archivo basándose en su extensión.\n    34→ * Soporta formatos PDF, DOCX y XLSX.\n    35→ *\n    36→ * @param {string} nombre_archivo - Nombre completo del archivo con extensión\n    37→ * @returns {string} Tipo MIME del archivo o 'application/octet-stream' si no se reconoce\n    38→ * @author Andres Morales\n    39→ */\n    40→function obtenerMimeTypeDocumento(nombre_archivo) {\n    41→    if (!nombre_archivo) return 'application/octet-stream';\n    42→\n    43→    var extension = nombre_archivo.split('.').pop().toLowerCase();\n    44→    var tipos_mime = {\n    45→        'pdf': 'application/pdf',\n    46→        'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    47→        'xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n    48→    };\n    49→\n    50→    return tipos_mime[extension] || 'application/octet-stream';\n    51→}\n    52→\n    53→/**\n    54→ * Abre el modal de documentos solicitados cargando los datos de la etapa.\n    55→ * Carga el catálogo de documentos y renderiza los solicitados para esta vacante.\n    56→ *\n    57→ * @param {object} datos_etapa - Objeto con los datos de la etapa y documentos solicitados\n    58→ * @returns {void}\n    59→ * @author Andres Morales\n    60→ */\n    61→function abrirModalDocumentosSolicitados(datos_etapa) {\n    62→    datos_etapa_documentos = datos_etapa;\n    63→    archivos_documentos_seleccionados = {};\n    64→\n    65→    $('#etapa_vacante_usuario_id_documentos').val(datos_etapa.etapa_vacante_usuario_id);\n    66→\n    67→    $('#contenedor-documentos-solicitados').html('<div class=\"col-12 text-center py-5\"><p class=\"text-muted\">Cargando documentos solicitados...</p></div>');\n    68→\n    69→    cargarDocumentosSolicitados();\n    70→}\n    71→\n    72→/**\n    73→ * Carga los documentos configurados para esta etapa de vacante desde el API.\n    74→ * Utiliza la ruta específica que devuelve solo los documentos solicitados para esta etapa.\n    75→ *\n    76→ * @returns {void}\n    77→ * @author Andres Morales\n    78→ */\n    79→function cargarDocumentosSolicitados() {\n    80→    var etapa_id = datos_etapa_documentos.id;\n    81→    var etapa_vacante_usuario_id = datos_etapa_documentos.etapa_vacante_usuario_id;\n    82→\n    83→    $.ajax({\n    84→        url: '/vacantes-documentos-solicitados/' + etapa_id,\n    85→        type: 'GET',\n    86→        data: {\n    87→            etapa_vacante_usuario_id: etapa_vacante_usuario_id\n    88→        },\n    89→        success: function(respuesta) {\n    90→            var datos_respuesta = respuesta.data || respuesta || {};\n    91→            documentos_solicitables_catalogo = datos_respuesta.documentos || [];\n    92→            archivos_guardados_backend = datos_respuesta.archivos_guardados || [];\n    93→            renderizarDocumentosRequeridos();\n    94→            $('#modal-aplicacion-documentos-solicitados').modal('show');\n    95→        },\n    96→        error: function(error) {\n    97→            console.error('Error al cargar documentos solicitables:', error);\n    98→            mostrarToast('danger', 'Error al cargar la lista de documentos');\n    99→            $('#contenedor-documentos-solicitados').html('<div class=\"col-12 text-center py-5\"><p class=\"text-danger\">Error al cargar documentos</p></div>');\n   100→        }\n   101→    });\n   102→}\n   103→\n   104→/**\n   105→ * Renderiza los inputs para los documentos solicitados en la vacante.\n   106→ * Los documentos ya vienen filtrados desde el backend.\n   107→ *\n   108→ * @returns {void}\n   109→ * @author Andres Morales\n   110→ */\n   111→function renderizarDocumentosRequeridos() {\n   112→    var contenedor = $('#contenedor-documentos-solicitados');\n   113→    contenedor.empty();\n   114→\n   115→    if (!documentos_solicitables_catalogo || documentos_solicitables_catalogo.length === 0) {\n   116→        contenedor.html('<div class=\"col-12 text-center py-5\"><p class=\"text-muted\">No hay documentos configurados para esta etapa</p></div>');\n   117→        return;\n   118→    }\n   119→\n   120→    documentos_solicitables_catalogo.forEach(function(documento) {\n   121→        var nombre_archivo_normalizado = documento.nombre\n   122→            .toLowerCase()\n   123→            .normalize('NFD')\n   124→            .replace(/[\\u0300-\\u036f]/g, '')\n   125→            .replace(/\\s+/g, '_')\n   126→            .replace(/[^a-z0-9_]/g, '');\n   127→\n   128→        var nombre_normalizado_comparacion = documento.nombre\n   129→            .toLowerCase()\n   130→            .normalize('NFD')\n   131→            .replace(/[\\u0300-\\u036f]/g, '');\n   132→\n   133→        var permite_multiples = (nombre_normalizado_comparacion.includes('certificado') && nombre_normalizado_comparacion.includes('laboral')) ||\n   134→                               nombre_normalizado_comparacion.includes('diploma');\n   135→\n   136→        var html_documento = `\n   137→            <div class=\"col-12 mb-3\" id=\"contenedor-documento-${documento.id}\">\n   138→                <div class=\"row\">\n   139→                    <div class=\"col-12 mb-2\">\n   140→                        <h6 class=\"text-headline-6 fw-bold text-gray-10 mb-0\">\n   141→                            ${documento.nombre}\n   142→                        </h6>\n   143→                    </div>\n   144→                    <div class=\"col-12\" id=\"inputs-documento-${documento.id}\">\n   145→                    </div>\n   146→                </div>\n   147→            </div>\n   148→        `;\n   149→\n   150→        contenedor.append(html_documento);\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"86248c0d-ed79-4be4-950a-953ac8bb2934","timestamp":"2026-01-20T23:18:34.112Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","content":"/**\n * Sistema de acciones por etapa - Documentos Solicitados\n *\n * @author Andres Morales\n */\n\nconst TAMANIO_MAXIMO_ARCHIVO = 2 * 1024 * 1024;\nconst EXTENSIONES_PERMITIDAS = ['pdf', 'docx', 'xlsx'];\n\nlet datos_etapa_documentos = null;\nlet archivos_documentos_seleccionados = {};\nlet documentos_solicitables_catalogo = [];\nlet archivos_guardados_backend = [];\n\n/**\n * Inicializa los eventos del modal de documentos al cargar el documento.\n * Configura la limpieza al cerrar el modal.\n *\n * @returns {void}\n * @author Andres Morales\n */\n$(document).ready(function() {\n    $('#modal-aplicacion-documentos-solicitados').on('hidden.bs.modal', function() {\n        $('#contenedor-documentos-solicitados').empty();\n        archivos_documentos_seleccionados = {};\n        datos_etapa_documentos = null;\n        documentos_solicitables_catalogo = [];\n        archivos_guardados_backend = [];\n    });\n});\n\n/**\n * Obtiene el tipo MIME correspondiente a un archivo basándose en su extensión.\n * Soporta formatos PDF, DOCX y XLSX.\n *\n * @param {string} nombre_archivo - Nombre completo del archivo con extensión\n * @returns {string} Tipo MIME del archivo o 'application/octet-stream' si no se reconoce\n * @author Andres Morales\n */\nfunction obtenerMimeTypeDocumento(nombre_archivo) {\n    if (!nombre_archivo) return 'application/octet-stream';\n\n    var extension = nombre_archivo.split('.').pop().toLowerCase();\n    var tipos_mime = {\n        'pdf': 'application/pdf',\n        'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n        'xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n    };\n\n    return tipos_mime[extension] || 'application/octet-stream';\n}\n\n/**\n * Abre el modal de documentos solicitados cargando los datos de la etapa.\n * Carga el catálogo de documentos y renderiza los solicitados para esta vacante.\n *\n * @param {object} datos_etapa - Objeto con los datos de la etapa y documentos solicitados\n * @returns {void}\n * @author Andres Morales\n */\nfunction abrirModalDocumentosSolicitados(datos_etapa) {\n    datos_etapa_documentos = datos_etapa;\n    archivos_documentos_seleccionados = {};\n\n    $('#etapa_vacante_usuario_id_documentos').val(datos_etapa.etapa_vacante_usuario_id);\n\n    $('#contenedor-documentos-solicitados').html('<div class=\"col-12 text-center py-5\"><p class=\"text-muted\">Cargando documentos solicitados...</p></div>');\n\n    cargarDocumentosSolicitados();\n}\n\n/**\n * Carga los documentos configurados para esta etapa de vacante desde el API.\n * Utiliza la ruta específica que devuelve solo los documentos solicitados para esta etapa.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction cargarDocumentosSolicitados() {\n    var etapa_id = datos_etapa_documentos.id;\n    var etapa_vacante_usuario_id = datos_etapa_documentos.etapa_vacante_usuario_id;\n\n    $.ajax({\n        url: '/vacantes-documentos-solicitados/' + etapa_id,\n        type: 'GET',\n        data: {\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id\n        },\n        success: function(respuesta) {\n            var datos_respuesta = respuesta.data || respuesta || {};\n            documentos_solicitables_catalogo = datos_respuesta.documentos || [];\n            archivos_guardados_backend = datos_respuesta.archivos_guardados || [];\n            renderizarDocumentosRequeridos();\n            $('#modal-aplicacion-documentos-solicitados').modal('show');\n        },\n        error: function(error) {\n            console.error('Error al cargar documentos solicitables:', error);\n            mostrarToast('danger', 'Error al cargar la lista de documentos');\n            $('#contenedor-documentos-solicitados').html('<div class=\"col-12 text-center py-5\"><p class=\"text-danger\">Error al cargar documentos</p></div>');\n        }\n    });\n}\n\n/**\n * Renderiza los inputs para los documentos solicitados en la vacante.\n * Los documentos ya vienen filtrados desde el backend.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction renderizarDocumentosRequeridos() {\n    var contenedor = $('#contenedor-documentos-solicitados');\n    contenedor.empty();\n\n    if (!documentos_solicitables_catalogo || documentos_solicitables_catalogo.length === 0) {\n        contenedor.html('<div class=\"col-12 text-center py-5\"><p class=\"text-muted\">No hay documentos configurados para esta etapa</p></div>');\n        return;\n    }\n\n    documentos_solicitables_catalogo.forEach(function(documento) {\n        var nombre_archivo_normalizado = documento.nombre\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .replace(/\\s+/g, '_')\n            .replace(/[^a-z0-9_]/g, '');\n\n        var nombre_normalizado_comparacion = documento.nombre\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n\n        var permite_multiples = (nombre_normalizado_comparacion.includes('certificado') && nombre_normalizado_comparacion.includes('laboral')) ||\n                               nombre_normalizado_comparacion.includes('diploma');\n\n        var html_documento = `\n            <div class=\"col-12 mb-3\" id=\"contenedor-documento-${documento.id}\">\n                <div class=\"row\">\n                    <div class=\"col-12 mb-2\">\n                        <h6 class=\"text-headline-6 fw-bold text-gray-10 mb-0\">\n                            ${documento.nombre}\n                        </h6>\n                    </div>\n                    <div class=\"col-12\" id=\"inputs-documento-${documento.id}\">\n                    </div>\n                </div>\n            </div>\n        `;\n\n        contenedor.append(html_documento);","numLines":150,"startLine":1,"totalLines":592}},"sourceToolAssistantUUID":"0646cac3-a4ba-4178-bb43-787a717b2ee5"}
{"parentUuid":"86248c0d-ed79-4be4-950a-953ac8bb2934","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VtXGZAkkcFZDyubAZm1ZS9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01L8MKm29D9VaBFCntpYD5Mh","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","offset":150,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2583,"cache_read_input_tokens":48230,"cache_creation":{"ephemeral_5m_input_tokens":2583,"ephemeral_1h_input_tokens":0},"output_tokens":18,"service_tier":"standard"}},"requestId":"req_011CXKV5EZP48meA5FA2GxEE","type":"assistant","uuid":"094f9b4a-3a17-4ed7-b5d7-3f8a298b95cc","timestamp":"2026-01-20T23:18:38.227Z"}
{"parentUuid":"094f9b4a-3a17-4ed7-b5d7-3f8a298b95cc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01L8MKm29D9VaBFCntpYD5Mh","type":"tool_result","content":"   150→        contenedor.append(html_documento);\n   151→\n   152→        documento.permite_multiples = permite_multiples;\n   153→        documento.nombre_normalizado = nombre_archivo_normalizado;\n   154→\n   155→        crearInputArchivo(documento.id, nombre_archivo_normalizado, documento.nombre, permite_multiples, 0);\n   156→    });\n   157→\n   158→    cargarArchivosExistentes();\n   159→    verificarDocumentosCompletos();\n   160→}\n   161→\n   162→/**\n   163→ * Crea un input de archivo HTML normal con botón eliminar.\n   164→ *\n   165→ * @param {number} documento_id - ID del documento\n   166→ * @param {string} nombre_archivo_normalizado - Nombre normalizado del archivo\n   167→ * @param {string} documento_nombre - Nombre del documento\n   168→ * @param {boolean} permite_multiples - Si permite múltiples archivos\n   169→ * @param {number} index - Índice del input\n   170→ * @returns {void}\n   171→ * @author Andres Morales\n   172→ */\n   173→function crearInputArchivo(documento_id, nombre_archivo_normalizado, documento_nombre, permite_multiples, index) {\n   174→    var input_id = 'input_' + documento_id + '_' + index;\n   175→    var boton_id = 'btn_eliminar_' + documento_id + '_' + index;\n   176→    var label_id = 'label_' + documento_id + '_' + index;\n   177→    var texto_id = 'texto_' + documento_id + '_' + index;\n   178→\n   179→    var html_input = `\n   180→        <div class=\"mb-2 input-archivo-contenedor\" id=\"contenedor_${input_id}\" data-documento-id=\"${documento_id}\" data-index=\"${index}\">\n   181→            <div class=\"input-group\">\n   182→                <label for=\"${input_id}\" class=\"btn btn-outline-primary mb-0 label-upload-documento\" id=\"${label_id}\">\n   183→                    <i class=\"bi bi-upload icono-subir-archivo\"></i>\n   184→                </label>\n   185→                <input\n   186→                    type=\"file\"\n   187→                    class=\"d-none\"\n   188→                    id=\"${input_id}\"\n   189→                    accept=\"application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.pdf,.docx,.xlsx\"\n   190→                    data-documento-id=\"${documento_id}\"\n   191→                    data-nombre-normalizado=\"${nombre_archivo_normalizado}\"\n   192→                    data-documento-nombre=\"${documento_nombre}\"\n   193→                    data-permite-multiples=\"${permite_multiples}\"\n   194→                    data-index=\"${index}\">\n   195→                <div class=\"form-control d-flex align-items-center texto-archivo-documento\" id=\"${texto_id}\">\n   196→                    <span class=\"text-muted\">Ningún archivo seleccionado</span>\n   197→                </div>\n   198→                <button\n   199→                    type=\"button\"\n   200→                    class=\"btn btn-outline-danger btn-eliminar-archivo d-none\"\n   201→                    id=\"${boton_id}\"\n   202→                    data-archivo-id=\"\"\n   203→                    data-input-id=\"${input_id}\">\n   204→                    <i class=\"bi bi-trash\"></i>\n   205→                </button>\n   206→            </div>\n   207→        </div>\n   208→    `;\n   209→\n   210→    $('#inputs-documento-' + documento_id).append(html_input);\n   211→\n   212→    $('#' + input_id).on('change', function(evento) {\n   213→        var archivo = evento.target.files[0];\n   214→        if (archivo) {\n   215→            $('#' + texto_id).html('<span class=\"text-truncate\">' + archivo.name + '</span>');\n   216→        }\n   217→        manejarCambioArchivo(evento.target);\n   218→    });\n   219→\n   220→    $('#' + boton_id).on('click', function() {\n   221→        var archivo_id = $(this).attr('data-archivo-id');\n   222→        var input_id_elemento = $(this).attr('data-input-id');\n   223→        eliminarArchivoConConfirmacion(archivo_id, input_id_elemento, documento_id, permite_multiples, index);\n   224→    });\n   225→}\n   226→\n   227→/**\n   228→ * Maneja el cambio de archivo en un input.\n   229→ * Valida el archivo y lo guarda automáticamente.\n   230→ *\n   231→ * @param {HTMLInputElement} input_elemento - Elemento input del archivo\n   232→ * @returns {void}\n   233→ * @author Andres Morales\n   234→ */\n   235→function manejarCambioArchivo(input_elemento) {\n   236→    var archivo = input_elemento.files[0];\n   237→\n   238→    if (!archivo) {\n   239→        return;\n   240→    }\n   241→\n   242→    var extension = archivo.name.split('.').pop().toLowerCase();\n   243→\n   244→    if (EXTENSIONES_PERMITIDAS.indexOf(extension) === -1) {\n   245→        mostrarToast('danger', 'El formato no es válido. Carga un documento .pdf, .docx o .xlsx');\n   246→        $(input_elemento).val('');\n   247→        return;\n   248→    }\n   249→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"bd26d5d9-67d2-416b-bf3e-d5028a1305be","timestamp":"2026-01-20T23:18:41.115Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","content":"        contenedor.append(html_documento);\n\n        documento.permite_multiples = permite_multiples;\n        documento.nombre_normalizado = nombre_archivo_normalizado;\n\n        crearInputArchivo(documento.id, nombre_archivo_normalizado, documento.nombre, permite_multiples, 0);\n    });\n\n    cargarArchivosExistentes();\n    verificarDocumentosCompletos();\n}\n\n/**\n * Crea un input de archivo HTML normal con botón eliminar.\n *\n * @param {number} documento_id - ID del documento\n * @param {string} nombre_archivo_normalizado - Nombre normalizado del archivo\n * @param {string} documento_nombre - Nombre del documento\n * @param {boolean} permite_multiples - Si permite múltiples archivos\n * @param {number} index - Índice del input\n * @returns {void}\n * @author Andres Morales\n */\nfunction crearInputArchivo(documento_id, nombre_archivo_normalizado, documento_nombre, permite_multiples, index) {\n    var input_id = 'input_' + documento_id + '_' + index;\n    var boton_id = 'btn_eliminar_' + documento_id + '_' + index;\n    var label_id = 'label_' + documento_id + '_' + index;\n    var texto_id = 'texto_' + documento_id + '_' + index;\n\n    var html_input = `\n        <div class=\"mb-2 input-archivo-contenedor\" id=\"contenedor_${input_id}\" data-documento-id=\"${documento_id}\" data-index=\"${index}\">\n            <div class=\"input-group\">\n                <label for=\"${input_id}\" class=\"btn btn-outline-primary mb-0 label-upload-documento\" id=\"${label_id}\">\n                    <i class=\"bi bi-upload icono-subir-archivo\"></i>\n                </label>\n                <input\n                    type=\"file\"\n                    class=\"d-none\"\n                    id=\"${input_id}\"\n                    accept=\"application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.pdf,.docx,.xlsx\"\n                    data-documento-id=\"${documento_id}\"\n                    data-nombre-normalizado=\"${nombre_archivo_normalizado}\"\n                    data-documento-nombre=\"${documento_nombre}\"\n                    data-permite-multiples=\"${permite_multiples}\"\n                    data-index=\"${index}\">\n                <div class=\"form-control d-flex align-items-center texto-archivo-documento\" id=\"${texto_id}\">\n                    <span class=\"text-muted\">Ningún archivo seleccionado</span>\n                </div>\n                <button\n                    type=\"button\"\n                    class=\"btn btn-outline-danger btn-eliminar-archivo d-none\"\n                    id=\"${boton_id}\"\n                    data-archivo-id=\"\"\n                    data-input-id=\"${input_id}\">\n                    <i class=\"bi bi-trash\"></i>\n                </button>\n            </div>\n        </div>\n    `;\n\n    $('#inputs-documento-' + documento_id).append(html_input);\n\n    $('#' + input_id).on('change', function(evento) {\n        var archivo = evento.target.files[0];\n        if (archivo) {\n            $('#' + texto_id).html('<span class=\"text-truncate\">' + archivo.name + '</span>');\n        }\n        manejarCambioArchivo(evento.target);\n    });\n\n    $('#' + boton_id).on('click', function() {\n        var archivo_id = $(this).attr('data-archivo-id');\n        var input_id_elemento = $(this).attr('data-input-id');\n        eliminarArchivoConConfirmacion(archivo_id, input_id_elemento, documento_id, permite_multiples, index);\n    });\n}\n\n/**\n * Maneja el cambio de archivo en un input.\n * Valida el archivo y lo guarda automáticamente.\n *\n * @param {HTMLInputElement} input_elemento - Elemento input del archivo\n * @returns {void}\n * @author Andres Morales\n */\nfunction manejarCambioArchivo(input_elemento) {\n    var archivo = input_elemento.files[0];\n\n    if (!archivo) {\n        return;\n    }\n\n    var extension = archivo.name.split('.').pop().toLowerCase();\n\n    if (EXTENSIONES_PERMITIDAS.indexOf(extension) === -1) {\n        mostrarToast('danger', 'El formato no es válido. Carga un documento .pdf, .docx o .xlsx');\n        $(input_elemento).val('');\n        return;\n    }\n","numLines":100,"startLine":150,"totalLines":592}},"sourceToolAssistantUUID":"094f9b4a-3a17-4ed7-b5d7-3f8a298b95cc"}
{"parentUuid":"bd26d5d9-67d2-416b-bf3e-d5028a1305be","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LZzfz3C6d24mcB1TS3jW9r","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora entiendo la lógica. En ese archivo, un tipo de documento (ej: \"Certificados laborales\") puede tener múltiples archivos. Lo que necesitas es contar cuántos **tipos de documentos** tienen al menos un archivo cargado, no la cantidad total de archivos.\n\nVoy a modificar el contador en `detalle-resultados.js`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1727,"cache_read_input_tokens":50813,"cache_creation":{"ephemeral_5m_input_tokens":1727,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXKV5mUUud8SrU8UxTWxd","type":"assistant","uuid":"8b7529c1-49d3-4232-9dd2-9d73e9ada2b6","timestamp":"2026-01-20T23:18:46.984Z"}
{"parentUuid":"8b7529c1-49d3-4232-9dd2-9d73e9ada2b6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LZzfz3C6d24mcB1TS3jW9r","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01V8btnTTBe5omECpcfREZUG","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2493,"limit":15}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1727,"cache_read_input_tokens":50813,"cache_creation":{"ephemeral_5m_input_tokens":1727,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXKV5mUUud8SrU8UxTWxd","type":"assistant","uuid":"23dc6356-a570-4f55-9bba-d4a9dbaefbcb","timestamp":"2026-01-20T23:18:48.710Z"}
{"parentUuid":"23dc6356-a570-4f55-9bba-d4a9dbaefbcb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01V8btnTTBe5omECpcfREZUG","type":"tool_result","content":"  2493→    } else {\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );\n  2498→            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n  2499→            console.log(archivos_aplicante);\n  2500→            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2501→        }, 100);\n  2502→        return `\n  2503→            <div class=\"col-12\">\n  2504→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n  2505→                    <div class=\"col-12\">\n  2506→                        <div class=\"row justify-content-between align-items-center mb-4\">\n  2507→                            <div class=\"col-auto text-body-2 text-gray-10\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"5bc4a288-21cf-43f1-b25f-a18d1b72fecb","timestamp":"2026-01-20T23:18:51.822Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">","numLines":15,"startLine":2493,"totalLines":2699}},"sourceToolAssistantUUID":"23dc6356-a570-4f55-9bba-d4a9dbaefbcb"}
{"parentUuid":"5bc4a288-21cf-43f1-b25f-a18d1b72fecb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Rz5BGyvMsSerxXy2qVbCMv","type":"message","role":"assistant","content":[{"type":"text","text":"Necesito ver la estructura de los datos para entender cómo identificar el tipo de documento de cada archivo. Voy a revisar cómo se normaliza el nombre en el archivo de documentos solicitados:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":613,"cache_read_input_tokens":52540,"cache_creation":{"ephemeral_5m_input_tokens":613,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKV6anLBExM22dE1uqrR","type":"assistant","uuid":"89b68cb9-ca4e-4e6d-908c-1e3538c97d5a","timestamp":"2026-01-20T23:18:56.219Z"}
{"parentUuid":"89b68cb9-ca4e-4e6d-908c-1e3538c97d5a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Rz5BGyvMsSerxXy2qVbCMv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011yV2V7foGAnUTFqpnHCJjv","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","offset":280,"limit":80}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":613,"cache_read_input_tokens":52540,"cache_creation":{"ephemeral_5m_input_tokens":613,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKV6anLBExM22dE1uqrR","type":"assistant","uuid":"d2329fd4-7be3-4e7b-9c48-90ea9d6d6bbd","timestamp":"2026-01-20T23:18:57.598Z"}
{"parentUuid":"d2329fd4-7be3-4e7b-9c48-90ea9d6d6bbd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011yV2V7foGAnUTFqpnHCJjv","type":"tool_result","content":"   280→\n   281→    if (nombre_archivo === 'Ningún archivo seleccionado') {\n   282→        nombre_archivo = 'seleccionado';\n   283→    }\n   284→\n   285→    Swal.fire({\n   286→        showCloseButton: true,\n   287→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   288→        showConfirmButton: false,\n   289→        showDenyButton: false,\n   290→        showCancelButton: false,\n   291→        html: `\n   292→            <div class=\"row w-100 mx-0 mt-2\">\n   293→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Eliminar archivo?</div>\n   294→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Se eliminara el archivo \"${nombre_archivo}\" ¿Deseas continuar?</div>\n   295→                <div class=\"col-6 mt-5 mb-2\">\n   296→                    ${crearBoton({\n   297→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   298→                        texto: 'Salir',\n   299→                        onclick: `Swal.clickDeny();`\n   300→                    })}\n   301→                </div>\n   302→                <div class=\"col-6 mt-5 mb-2\">\n   303→                    ${crearBoton({\n   304→                        clases: 'btn-danger w-100 justify-content-center',\n   305→                        texto: 'Eliminar',\n   306→                        onclick: `Swal.clickConfirm();`\n   307→                    })}\n   308→                </div>\n   309→            </div>\n   310→        `,\n   311→    }).then((resultado) => {\n   312→        if (resultado.isConfirmed) {\n   313→            $.ajax({\n   314→                url: '/archivos/' + archivo_id,\n   315→                type: 'DELETE',\n   316→                headers: {\n   317→                    'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n   318→                },\n   319→                success: function() {\n   320→                    mostrarToast('success', 'Archivo eliminado exitosamente');\n   321→\n   322→                    if (permite_multiples) {\n   323→                        $('#contenedor_' + input_id).remove();\n   324→                    } else {\n   325→                        $('#' + input_id).val('');\n   326→                        $('#btn_eliminar_' + documento_id + '_' + indice).addClass('d-none');\n   327→                        $('#btn_eliminar_' + documento_id + '_' + indice).attr('data-archivo-id', '');\n   328→                    }\n   329→\n   330→                    actualizarDatatables('tabla-tareas-pendientes');\n   331→                    cargarDocumentosSolicitados();\n   332→                },\n   333→                error: function(respuesta_xhr) {\n   334→                    var mensaje_error = 'Error al eliminar el archivo';\n   335→                    if (respuesta_xhr.responseJSON && respuesta_xhr.responseJSON.message) {\n   336→                        mensaje_error = respuesta_xhr.responseJSON.message;\n   337→                    }\n   338→                    mostrarToast('danger', mensaje_error);\n   339→                }\n   340→            });\n   341→        }\n   342→    });\n   343→}\n   344→\n   345→/**\n   346→ * Carga los archivos guardados en los inputs correspondientes.\n   347→ * Usa los archivos guardados que vienen del backend.\n   348→ *\n   349→ * @returns {void}\n   350→ * @author Andres Morales\n   351→ */\n   352→function cargarArchivosExistentes() {\n   353→    if (!archivos_guardados_backend || archivos_guardados_backend.length === 0) {\n   354→        return;\n   355→    }\n   356→\n   357→    var archivos_por_documento = {};\n   358→\n   359→    archivos_guardados_backend.forEach(function(archivo) {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"e59822b6-e9f5-4ce5-817e-75d4e3d8ba87","timestamp":"2026-01-20T23:19:00.547Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","content":"\n    if (nombre_archivo === 'Ningún archivo seleccionado') {\n        nombre_archivo = 'seleccionado';\n    }\n\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Eliminar archivo?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Se eliminara el archivo \"${nombre_archivo}\" ¿Deseas continuar?</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Salir',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-danger w-100 justify-content-center',\n                        texto: 'Eliminar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed) {\n            $.ajax({\n                url: '/archivos/' + archivo_id,\n                type: 'DELETE',\n                headers: {\n                    'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function() {\n                    mostrarToast('success', 'Archivo eliminado exitosamente');\n\n                    if (permite_multiples) {\n                        $('#contenedor_' + input_id).remove();\n                    } else {\n                        $('#' + input_id).val('');\n                        $('#btn_eliminar_' + documento_id + '_' + indice).addClass('d-none');\n                        $('#btn_eliminar_' + documento_id + '_' + indice).attr('data-archivo-id', '');\n                    }\n\n                    actualizarDatatables('tabla-tareas-pendientes');\n                    cargarDocumentosSolicitados();\n                },\n                error: function(respuesta_xhr) {\n                    var mensaje_error = 'Error al eliminar el archivo';\n                    if (respuesta_xhr.responseJSON && respuesta_xhr.responseJSON.message) {\n                        mensaje_error = respuesta_xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje_error);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Carga los archivos guardados en los inputs correspondientes.\n * Usa los archivos guardados que vienen del backend.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction cargarArchivosExistentes() {\n    if (!archivos_guardados_backend || archivos_guardados_backend.length === 0) {\n        return;\n    }\n\n    var archivos_por_documento = {};\n\n    archivos_guardados_backend.forEach(function(archivo) {","numLines":80,"startLine":280,"totalLines":592}},"sourceToolAssistantUUID":"d2329fd4-7be3-4e7b-9c48-90ea9d6d6bbd"}
{"parentUuid":"e59822b6-e9f5-4ce5-817e-75d4e3d8ba87","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_014rEnc3bVN3UrcD1BTrrtKB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FcA9mjyEtW1y6iC3sRuNMP","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","offset":355,"limit":80}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1400,"cache_read_input_tokens":53153,"cache_creation":{"ephemeral_5m_input_tokens":1400,"ephemeral_1h_input_tokens":0},"output_tokens":18,"service_tier":"standard"}},"requestId":"req_011CXKV7CRCTDNEwfx1KA8RM","type":"assistant","uuid":"06c8dd95-9f49-4fff-ae27-70cc343e3539","timestamp":"2026-01-20T23:19:05.080Z"}
{"parentUuid":"06c8dd95-9f49-4fff-ae27-70cc343e3539","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FcA9mjyEtW1y6iC3sRuNMP","type":"tool_result","content":"   355→    }\n   356→\n   357→    var archivos_por_documento = {};\n   358→\n   359→    archivos_guardados_backend.forEach(function(archivo) {\n   360→        var nombre_documento = archivo.nombre;\n   361→        var documento_encontrado = documentos_solicitables_catalogo.find(function(doc) {\n   362→            return doc.nombre_normalizado === nombre_documento;\n   363→        });\n   364→\n   365→        if (documento_encontrado) {\n   366→            if (!archivos_por_documento[documento_encontrado.id]) {\n   367→                archivos_por_documento[documento_encontrado.id] = [];\n   368→            }\n   369→            archivos_por_documento[documento_encontrado.id].push(archivo);\n   370→        }\n   371→    });\n   372→\n   373→    Object.keys(archivos_por_documento).forEach(function(documento_id) {\n   374→        var archivos = archivos_por_documento[documento_id];\n   375→        var documento = documentos_solicitables_catalogo.find(function(doc) {\n   376→            return doc.id == documento_id;\n   377→        });\n   378→\n   379→        archivos.forEach(function(archivo, index) {\n   380→            var input_id = 'input_' + documento_id + '_' + index;\n   381→            var boton_id = 'btn_eliminar_' + documento_id + '_' + index;\n   382→            var label_id = 'label_' + documento_id + '_' + index;\n   383→            var texto_id = 'texto_' + documento_id + '_' + index;\n   384→\n   385→            var input_elemento = $('#' + input_id);\n   386→\n   387→            if (input_elemento.length === 0 && documento.permite_multiples) {\n   388→                crearInputArchivo(documento_id, documento.nombre_normalizado, documento.nombre, true, index);\n   389→                input_elemento = $('#' + input_id);\n   390→            }\n   391→\n   392→            if (input_elemento.length > 0) {\n   393→                $('#' + texto_id).html('<span class=\"text-truncate\">' + archivo.nombre_original_archivo + '</span>');\n   394→                $('#' + label_id).prop('disabled', true).css('pointer-events', 'none');\n   395→\n   396→                $('#' + boton_id).removeClass('d-none');\n   397→                $('#' + boton_id).attr('data-archivo-id', archivo.id);\n   398→\n   399→                input_elemento.prop('disabled', true);\n   400→            }\n   401→        });\n   402→\n   403→        if (documento && documento.permite_multiples) {\n   404→            var ultimo_index = archivos.length;\n   405→            crearInputArchivo(documento_id, documento.nombre_normalizado, documento.nombre, true, ultimo_index);\n   406→        }\n   407→\n   408→        var titulo_documento = $('#contenedor-documento-' + documento_id).find('h6');\n   409→        if (titulo_documento.length > 0 && !titulo_documento.find('.icono-documento-cargado').length) {\n   410→            titulo_documento.append(' <i class=\"bi bi-check-circle-fill icono-documento-cargado\"></i>');\n   411→        }\n   412→    });\n   413→\n   414→    verificarDocumentosCompletos();\n   415→}\n   416→\n   417→/**\n   418→ * Guarda un archivo inmediatamente después de ser seleccionado.\n   419→ * Muestra el estado de carga y recarga los documentos.\n   420→ *\n   421→ * @param {number} documento_id - ID del documento\n   422→ * @param {File} archivo - Archivo a guardar\n   423→ * @param {string} nombre_archivo_normalizado - Nombre normalizado del documento\n   424→ * @param {HTMLElement} input_elemento - Elemento input del archivo\n   425→ * @param {boolean} permite_multiples - Si permite múltiples archivos\n   426→ * @param {number} index - Índice del input\n   427→ * @returns {void}\n   428→ * @author Andres Morales\n   429→ */\n   430→function guardarArchivoInmediatamente(documento_id, archivo, nombre_archivo_normalizado, input_elemento, permite_multiples, index) {\n   431→    var etapa_vacante_usuario_id = $('#etapa_vacante_usuario_id_documentos').val();\n   432→    var formulario_datos = new FormData();\n   433→\n   434→    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"ef633dcc-f62a-4ccd-bc4b-5610304baa2f","timestamp":"2026-01-20T23:19:07.947Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","content":"    }\n\n    var archivos_por_documento = {};\n\n    archivos_guardados_backend.forEach(function(archivo) {\n        var nombre_documento = archivo.nombre;\n        var documento_encontrado = documentos_solicitables_catalogo.find(function(doc) {\n            return doc.nombre_normalizado === nombre_documento;\n        });\n\n        if (documento_encontrado) {\n            if (!archivos_por_documento[documento_encontrado.id]) {\n                archivos_por_documento[documento_encontrado.id] = [];\n            }\n            archivos_por_documento[documento_encontrado.id].push(archivo);\n        }\n    });\n\n    Object.keys(archivos_por_documento).forEach(function(documento_id) {\n        var archivos = archivos_por_documento[documento_id];\n        var documento = documentos_solicitables_catalogo.find(function(doc) {\n            return doc.id == documento_id;\n        });\n\n        archivos.forEach(function(archivo, index) {\n            var input_id = 'input_' + documento_id + '_' + index;\n            var boton_id = 'btn_eliminar_' + documento_id + '_' + index;\n            var label_id = 'label_' + documento_id + '_' + index;\n            var texto_id = 'texto_' + documento_id + '_' + index;\n\n            var input_elemento = $('#' + input_id);\n\n            if (input_elemento.length === 0 && documento.permite_multiples) {\n                crearInputArchivo(documento_id, documento.nombre_normalizado, documento.nombre, true, index);\n                input_elemento = $('#' + input_id);\n            }\n\n            if (input_elemento.length > 0) {\n                $('#' + texto_id).html('<span class=\"text-truncate\">' + archivo.nombre_original_archivo + '</span>');\n                $('#' + label_id).prop('disabled', true).css('pointer-events', 'none');\n\n                $('#' + boton_id).removeClass('d-none');\n                $('#' + boton_id).attr('data-archivo-id', archivo.id);\n\n                input_elemento.prop('disabled', true);\n            }\n        });\n\n        if (documento && documento.permite_multiples) {\n            var ultimo_index = archivos.length;\n            crearInputArchivo(documento_id, documento.nombre_normalizado, documento.nombre, true, ultimo_index);\n        }\n\n        var titulo_documento = $('#contenedor-documento-' + documento_id).find('h6');\n        if (titulo_documento.length > 0 && !titulo_documento.find('.icono-documento-cargado').length) {\n            titulo_documento.append(' <i class=\"bi bi-check-circle-fill icono-documento-cargado\"></i>');\n        }\n    });\n\n    verificarDocumentosCompletos();\n}\n\n/**\n * Guarda un archivo inmediatamente después de ser seleccionado.\n * Muestra el estado de carga y recarga los documentos.\n *\n * @param {number} documento_id - ID del documento\n * @param {File} archivo - Archivo a guardar\n * @param {string} nombre_archivo_normalizado - Nombre normalizado del documento\n * @param {HTMLElement} input_elemento - Elemento input del archivo\n * @param {boolean} permite_multiples - Si permite múltiples archivos\n * @param {number} index - Índice del input\n * @returns {void}\n * @author Andres Morales\n */\nfunction guardarArchivoInmediatamente(documento_id, archivo, nombre_archivo_normalizado, input_elemento, permite_multiples, index) {\n    var etapa_vacante_usuario_id = $('#etapa_vacante_usuario_id_documentos').val();\n    var formulario_datos = new FormData();\n\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);","numLines":80,"startLine":355,"totalLines":592}},"sourceToolAssistantUUID":"06c8dd95-9f49-4fff-ae27-70cc343e3539"}
{"parentUuid":"ef633dcc-f62a-4ccd-bc4b-5610304baa2f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GbKkJFphgHoumLnTsimeFr","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora entiendo. Cada archivo tiene un campo `nombre` que corresponde al nombre normalizado del tipo de documento. Lo que necesito hacer es contar cuántos **tipos de documentos únicos** tienen al menos un archivo cargado por el aplicante."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1459,"cache_read_input_tokens":54553,"cache_creation":{"ephemeral_5m_input_tokens":1459,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXKV7kbx9WvVkNt1yvaYt","type":"assistant","uuid":"268e21e0-07c7-4336-9195-d872d3224cae","timestamp":"2026-01-20T23:19:12.514Z"}
{"parentUuid":"268e21e0-07c7-4336-9195-d872d3224cae","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GbKkJFphgHoumLnTsimeFr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VNyRV45o1QwfmX39gF3TeM","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","new_string":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            // Contar tipos de documentos únicos que tienen al menos un archivo cargado\n            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];\n            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1459,"cache_read_input_tokens":54553,"cache_creation":{"ephemeral_5m_input_tokens":1459,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXKV7kbx9WvVkNt1yvaYt","type":"assistant","uuid":"add23838-fb8c-4aa5-93c4-7c2d40c32bb3","timestamp":"2026-01-20T23:19:18.668Z"}
{"parentUuid":"add23838-fb8c-4aa5-93c4-7c2d40c32bb3","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VNyRV45o1QwfmX39gF3TeM","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );\n  2498→            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n  2499→            // Contar tipos de documentos únicos que tienen al menos un archivo cargado\n  2500→            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];\n  2501→            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2502→        }, 100);\n  2503→        return `\n  2504→            <div class=\"col-12\">\n  2505→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">"}]},"uuid":"67b56858-3131-4a2d-879a-94dc0cfb9c24","timestamp":"2026-01-20T23:19:52.048Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","newString":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            // Contar tipos de documentos únicos que tienen al menos un archivo cargado\n            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];\n            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2496,"oldLines":8,"newStart":2496,"newLines":9,"lines":["                 crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})","             );","             let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));","-            console.log(archivos_aplicante);","-            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","+            // Contar tipos de documentos únicos que tienen al menos un archivo cargado","+            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];","+            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","         }, 100);","         return `","             <div class=\"col-12\">"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"add23838-fb8c-4aa5-93c4-7c2d40c32bb3"}
{"parentUuid":"67b56858-3131-4a2d-879a-94dc0cfb9c24","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_0126q7MwfCLNcnFkPMWQ3J93","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora el contador funciona así:\n\n**Ejemplo:**\n- 5 documentos solicitados: Cédula, Certificados laborales, Diplomas, EPS, Antecedentes\n- Archivos cargados por el aplicante:\n  - `cedula_de_ciudadania` (1 archivo)\n  - `certificados_laborales` (3 archivos) ← cuenta como 1\n  - `diplomas_de_grado` (2 archivos) ← cuenta como 1\n\n**Resultado:** \"3 de 5 Adjuntos\"\n\nEl `Set` elimina los nombres duplicados, así que solo cuenta los **tipos de documentos únicos** que tienen al menos un archivo."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":784,"cache_read_input_tokens":56012,"cache_creation":{"ephemeral_5m_input_tokens":784,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKVB7NhRWGEZqQPfDQTk","type":"assistant","uuid":"ea8fb544-e02d-46a3-a483-57ed59701606","timestamp":"2026-01-20T23:20:00.299Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-20T23:24:44.858Z","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d"}
{"type":"file-history-snapshot","messageId":"fa714277-f530-43df-9eb1-faf5ed9a7d95","snapshot":{"messageId":"fa714277-f530-43df-9eb1-faf5ed9a7d95","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v7","version":7,"backupTime":"2026-01-20T23:24:44.977Z"},"public\\js\\vacantes\\detalles\\detalle-etapas.js":{"backupFileName":"dccddb1063a31949@v2","version":2,"backupTime":"2026-01-20T23:18:26.482Z"}},"timestamp":"2026-01-20T23:24:44.948Z"},"isSnapshotUpdate":false}
{"parentUuid":"0646cac3-a4ba-4178-bb43-787a717b2ee5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01NKnzZ5ffiTLnezyDiZe2d5","parentToolUseID":"toolu_01NKnzZ5ffiTLnezyDiZe2d5","uuid":"18b20d48-4761-446e-9fda-cda8907c0b9e","timestamp":"2026-01-20T23:18:32.408Z"}
{"parentUuid":"094f9b4a-3a17-4ed7-b5d7-3f8a298b95cc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01L8MKm29D9VaBFCntpYD5Mh","parentToolUseID":"toolu_01L8MKm29D9VaBFCntpYD5Mh","uuid":"9b36e43f-be98-412b-b43d-7b616a8de22e","timestamp":"2026-01-20T23:18:38.518Z"}
{"parentUuid":"23dc6356-a570-4f55-9bba-d4a9dbaefbcb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01V8btnTTBe5omECpcfREZUG","parentToolUseID":"toolu_01V8btnTTBe5omECpcfREZUG","uuid":"cbc473ae-c3d8-4a8f-b117-6dd52db39a0a","timestamp":"2026-01-20T23:18:49.053Z"}
{"parentUuid":"d2329fd4-7be3-4e7b-9c48-90ea9d6d6bbd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_011yV2V7foGAnUTFqpnHCJjv","parentToolUseID":"toolu_011yV2V7foGAnUTFqpnHCJjv","uuid":"e8fb23ea-d02c-443f-964a-a34f5c834f53","timestamp":"2026-01-20T23:18:57.970Z"}
{"parentUuid":"06c8dd95-9f49-4fff-ae27-70cc343e3539","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01FcA9mjyEtW1y6iC3sRuNMP","parentToolUseID":"toolu_01FcA9mjyEtW1y6iC3sRuNMP","uuid":"5377fde1-19d9-49bd-ac0a-4ecc38ba2bb5","timestamp":"2026-01-20T23:19:05.432Z"}
{"parentUuid":"add23838-fb8c-4aa5-93c4-7c2d40c32bb3","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01VNyRV45o1QwfmX39gF3TeM","parentToolUseID":"toolu_01VNyRV45o1QwfmX39gF3TeM","uuid":"b21899ed-61ee-4fad-a56c-2abf98bad42e","timestamp":"2026-01-20T23:19:19.960Z"}
{"parentUuid":"b21899ed-61ee-4fad-a56c-2abf98bad42e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01VNyRV45o1QwfmX39gF3TeM","parentToolUseID":"toolu_01VNyRV45o1QwfmX39gF3TeM","uuid":"d28d1d40-5d89-4901-8418-0da40d0964da","timestamp":"2026-01-20T23:19:19.962Z"}
{"parentUuid":"67b56858-3131-4a2d-879a-94dc0cfb9c24","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01VNyRV45o1QwfmX39gF3TeM","toolUseID":"toolu_01VNyRV45o1QwfmX39gF3TeM","timestamp":"2026-01-20T23:19:52.053Z","uuid":"f3a6f554-228b-4faf-9d3c-027138846c34"}
{"parentUuid":"ea8fb544-e02d-46a3-a483-57ed59701606","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 535 to 540 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js:\nif (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"lsito aqui tambien en tien archivos if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        } solo contaran los que no tienen en el nobre cliente_empresa_"}]},"uuid":"fa714277-f530-43df-9eb1-faf5ed9a7d95","timestamp":"2026-01-20T23:24:44.946Z"}
{"parentUuid":"fa714277-f530-43df-9eb1-faf5ed9a7d95","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_018dUEAgGNZDQd3PBd5dq2Tm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UyuyJSPsGXENqP6w9ubAbN","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js","offset":530,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":553,"cache_read_input_tokens":56796,"cache_creation":{"ephemeral_5m_input_tokens":553,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXKVYbdtwuCS1TJfHbpLX","type":"assistant","uuid":"6b15e3d1-6d4d-4b87-bb9b-e7b104877ea9","timestamp":"2026-01-20T23:24:49.120Z"}
{"parentUuid":"6b15e3d1-6d4d-4b87-bb9b-e7b104877ea9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UyuyJSPsGXENqP6w9ubAbN","type":"tool_result","content":"   530→                clase_etiqueta = es_borrador ? 'tag-filled-blue' : 'tag-filled-yellow';\n   531→                texto_estado = es_borrador ? 'Iniciada' : 'Pendiente';\n   532→            }\n   533→        }\n   534→\n   535→        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n   536→            let archivos = etapa.usuarios_vacantes[0].archivos;\n   537→            let tiene_archivos = archivos && archivos.length > 0;\n   538→            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n   539→            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n   540→        }\n   541→\n   542→        if (nombre_normalizado === 'PREGUNTASPREFILTRO') {\n   543→            clase_etiqueta = 'tag-filled-yellow';\n   544→            texto_estado = 'Pendiente';\n   545→        }\n   546→\n   547→        if (nombre_normalizado === 'REVISIONHV') {\n   548→            clase_etiqueta = 'tag-filled-yellow';\n   549→            texto_estado = 'Pendiente';\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f51ed610-e3f4-48a5-aeda-f7c826ca4692","timestamp":"2026-01-20T23:24:51.377Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js","content":"                clase_etiqueta = es_borrador ? 'tag-filled-blue' : 'tag-filled-yellow';\n                texto_estado = es_borrador ? 'Iniciada' : 'Pendiente';\n            }\n        }\n\n        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'PREGUNTASPREFILTRO') {\n            clase_etiqueta = 'tag-filled-yellow';\n            texto_estado = 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'REVISIONHV') {\n            clase_etiqueta = 'tag-filled-yellow';\n            texto_estado = 'Pendiente';","numLines":20,"startLine":530,"totalLines":1219}},"sourceToolAssistantUUID":"6b15e3d1-6d4d-4b87-bb9b-e7b104877ea9"}
{"parentUuid":"f51ed610-e3f4-48a5-aeda-f7c826ca4692","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RKL9JxjyB3e5FTiLa9KdQg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01A8ygXZv9jEujydSK9P44kV","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js","old_string":"        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }","new_string":"        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos || [];\n            let archivos_aplicante = archivos.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            let tiene_archivos = archivos_aplicante.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":674,"cache_read_input_tokens":57349,"cache_creation":{"ephemeral_5m_input_tokens":674,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CXKVZ3bMauTadHsfEAp3c","type":"assistant","uuid":"5541e569-9823-4159-842b-1f3144fcb480","timestamp":"2026-01-20T23:24:58.229Z"}
{"type":"file-history-snapshot","messageId":"5541e569-9823-4159-842b-1f3144fcb480","snapshot":{"messageId":"fa714277-f530-43df-9eb1-faf5ed9a7d95","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v7","version":7,"backupTime":"2026-01-20T23:24:44.977Z"},"public\\js\\vacantes\\detalles\\detalle-etapas.js":{"backupFileName":"dccddb1063a31949@v2","version":2,"backupTime":"2026-01-20T23:18:26.482Z"},"public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js":{"backupFileName":"f91a5ce6abb13dfb@v1","version":1,"backupTime":"2026-01-20T23:25:04.689Z"}},"timestamp":"2026-01-20T23:24:44.948Z"},"isSnapshotUpdate":true}
{"parentUuid":"5541e569-9823-4159-842b-1f3144fcb480","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01A8ygXZv9jEujydSK9P44kV","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   531→                texto_estado = es_borrador ? 'Iniciada' : 'Pendiente';\n   532→            }\n   533→        }\n   534→\n   535→        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n   536→            let archivos = etapa.usuarios_vacantes[0].archivos || [];\n   537→            let archivos_aplicante = archivos.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n   538→            let tiene_archivos = archivos_aplicante.length > 0;\n   539→            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n   540→            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n   541→        }\n   542→\n   543→        if (nombre_normalizado === 'PREGUNTASPREFILTRO') {\n   544→            clase_etiqueta = 'tag-filled-yellow';\n   545→            texto_estado = 'Pendiente';"}]},"uuid":"d048477a-3abd-4886-9c74-e857e74653e0","timestamp":"2026-01-20T23:25:04.772Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js","oldString":"        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }","newString":"        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos || [];\n            let archivos_aplicante = archivos.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            let tiene_archivos = archivos_aplicante.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }","originalFile":"var datos_ids = [];\n\n$(`#tabla-tareas-pendientes`).DataTable({\n    ...configuracion_tablas,\n    ajax: {\n        url : `/vacantes-aplicante`,\n        data: function (datos) {\n            ($('#filtro_estado_tarea').val() != 0 ) ? datos.estado_id = $('#filtro_estado_tarea').val() : '';\n            ($('#filtro_tipo_prueba').val()) ? datos.tipo_prueba_id = $('#filtro_tipo_prueba').val() : '';\n            if (typeof $('#fecha_filtro').val() === 'string') {\n                let partes_fecha = $('#fecha_filtro').val().split(' a ');\n                (partes_fecha[0]) ? datos.fecha_inicio = partes_fecha[0] : '';\n                (partes_fecha[1]) ? datos.fecha_cierre = partes_fecha[1] : '';\n            }\n        },\n        dataSrc: function (json) {\n            return Object.values(json.data);\n        }\n    },\n    columns: [\n        {\n            data: null,\n            orderable : false,\n            class: 'p-1 rounded-3',\n            render: (dato) => {\n                let es_proceso = dato.vacante_id === null || dato.agendas !== undefined;\n\n                if (es_proceso) {\n                    return renderizarProceso(dato);\n                } else {\n                    return renderizarVacante(dato);\n                }\n            }\n        }\n    ],\n    drawCallback: function() {\n        datos_ids = $('#tabla-tareas-pendientes').DataTable().data().toArray();\n        inicializarTooltips();\n        validarDatos();\n        abrirAcordeonVacante();\n    },\n    initComplete: function() {\n        datos_ids = $('#tabla-tareas-pendientes').DataTable().data().toArray();\n        $('[aria-describedby=\"tabla-tareas-pendientes_info\"] .thead-componente').hide();\n        inicializarTooltips();\n        validarDatos();\n        abrirAcordeonVacante();\n    }\n}); \n\n$(document).ready(function() {\n    $(document).on('change', '#filtro_estado_tarea, #filtro_tipo_prueba, #filtro_fecha', function(){\n        actualizarDatatables('tabla-tareas-pendientes');\n    });\n});\n\n/**\n * Muestra u oculta tablas según la existencia de datos.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarDatos() {\n    var tiene_filtros_aplicados = verificarFiltrosAplicados();\n\n    if (datos_ids.length == 0) {\n        if (tiene_filtros_aplicados) {\n            // Si hay filtros aplicados, mostrar los controles pero con empty state en la tabla\n            $('#tabla-contenido').removeClass('d-none');\n            $('#tabla-sin-contenido').addClass('d-none');\n            mostrarEstadoVacioFiltros();\n        } else {\n            // Si no hay filtros, ocultar todo y mostrar el empty state general\n            $('#tabla-contenido').addClass('d-none');\n            $('#tabla-sin-contenido').removeClass('d-none');\n        }\n    } else {\n        $('#tabla-contenido').removeClass('d-none');\n        $('#tabla-sin-contenido').addClass('d-none');\n        ocultarEstadoVacioFiltros();\n    }\n}\n\n/**\n * Verifica si hay filtros aplicados en la tabla.\n *\n * @returns {boolean}\n * @author Andres Morales\n */\nfunction verificarFiltrosAplicados() {\n    var valor_filtro_estado = $('#filtro_estado_tarea').val();\n    var valor_filtro_fecha = $('#filtro_fecha').val();\n    var valor_buscador = $('.dt-search input').val();\n\n    return (valor_filtro_estado && valor_filtro_estado != '0') ||\n           (valor_filtro_fecha && valor_filtro_fecha.trim() !== '') ||\n           (valor_buscador && valor_buscador.trim() !== '');\n}\n\n/**\n * Muestra el empty state cuando hay filtros aplicados pero no hay resultados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction mostrarEstadoVacioFiltros() {\n    var contenedor_tabla = $('#tabla-tareas-pendientes_wrapper');\n\n    if (contenedor_tabla.find('.estado-vacio-filtros').length === 0) {\n        var html_estado_vacio = `\n            <div class=\"estado-vacio-filtros w-100 text-center p-10\">\n                <p class=\"\"><i class=\"bi bi-funnel text-gray-60 icono-estado-vacio\"></i></p>\n                <p class=\"pb-4 text-headline-5 fw-bold text-gray-30\">No se encontraron resultados con los filtros aplicados.</p>\n            </div>\n        `;\n        contenedor_tabla.find('table').hide();\n        contenedor_tabla.append(html_estado_vacio);\n    }\n}\n\n/**\n * Oculta el empty state de filtros cuando hay resultados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction ocultarEstadoVacioFiltros() {\n    var contenedor_tabla = $('#tabla-tareas-pendientes_wrapper');\n    contenedor_tabla.find('.estado-vacio-filtros').remove();\n    contenedor_tabla.find('table').show();\n}\n\n/**\n * Renderiza una tarjeta para un proceso con agendas.\n *\n * @param {Object} dato - Objeto de proceso con agendas.\n * @returns {string} HTML generado con la estructura de la tarjeta del proceso.\n * @author Andres Morales\n */\nfunction renderizarProceso(dato) {\n    let es_primera_columna = false;\n    let clase_boton = es_primera_columna ? 'accordion-button shadow-none text-body-1' : 'accordion-button shadow-none text-body-1 collapsed';\n    let area_expandida = es_primera_columna ? 'true' : 'false';\n    let clase_para_colapsado = es_primera_columna ? 'accordion-collapse collapse show' : 'accordion-collapse collapse';\n    let mostrar_empresa = (dato?.mostrar_logo_aplicante === true) || (Number(dato?.mostrar_logo_aplicante) === 1);\n    let empresa_html = mostrar_empresa ? `\n                    <div class=\"col-12 d-flex\">\n                        <i class=\"my-auto bi bi-buildings-fill text-body-3 text-gray-30\"></i>\n                        <h5 class=\"my-auto card-title text-body-3 text-gray-30 mx-2\">Empresa:</h5>\n                        <img class=\"my-auto border rounded\" width=\"24px\" height=\"24px\" src=\"/empresas-logo/${dato?.empresa_id}\" alt=\"${dato?.empresa?.nombre_comercial}\" onerror=\"this.onerror=null;\"/>\n                        <h5 class=\"my-auto card-title text-body-3 text-gray-30 mx-2\">${dato?.empresa?.nombre_comercial}</h5>\n                    </div>\n    ` : '';\n\n    let total_agendas = (dato?.agendas && dato.agendas.length > 0) ? dato.agendas.length : 1;\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"row mb-3\">\n                    <div class=\"col-12\">\n                        <h5 class=\"card-title text-body-1 fw-bolder text-gray-10\">${dato.nombre}</h5>\n                    </div>\n                    ${empresa_html}\n                </div>\n                <div class=\"accordion\" id=\"accordionProceso${dato?.id}\">\n                    <div class=\"accordion-item\">\n                        <h2 class=\"accordion-header\">\n                            <button class=\"${clase_boton} d-flex justify-content-between align-items-center\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#collapseProceso${dato.id}\" aria-expanded=\"${area_expandida}\" aria-controls=\"collapseProceso${dato.id}\">\n                                <span>Ver tareas pendientes</span>\n                                ${total_agendas > 0 ? `<span class=\"badge bg-danger rounded-pill text-label-2\">${total_agendas}</span>` : ''}\n                            </button>\n                        </h2>\n                        <div id=\"collapseProceso${dato.id}\" class=\"${clase_para_colapsado}\" data-bs-parent=\"#accordionProceso${dato?.id}\">\n                            <div class=\"accordion-body\">\n                                <h1 class=\"text-headline-5 fw-bloder text-gray-10\">Pruebas psicométricas</h1>\n                                <div class=\"row gap-4 m-0\">${procesarAgendas(dato?.agendas)}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderiza una tarjeta para una vacante con etapas.\n *\n * @param {Object} dato - Objeto de vacante con etapas.\n * @returns {string} HTML generado con la estructura de la tarjeta de la vacante.\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author José Manuel Jiménez\n */\nfunction renderizarVacante(dato) {\n    let es_primera_columna = false;\n    let clase_boton = es_primera_columna ? 'accordion-button shadow-none text-body-1' : 'accordion-button shadow-none text-body-1 collapsed';\n    let area_expandida = es_primera_columna ? 'true' : 'false';\n    let clase_para_colapsado = es_primera_columna ? 'accordion-collapse collapse show' : 'accordion-collapse collapse';\n    let mostrar_empresa = dato?.empresa !== null && dato?.empresa !== undefined;\n\n    let etapa_actual = dato.etapa_actual || 0;\n    let total_etapas = dato.total_etapas || 0;\n    let porcentaje_progreso = (etapa_actual / total_etapas) * 100;\n\n    let total_agendas = 0;\n    let total_etapas_activas = 0;\n\n    if (dato?.etapas && dato.etapas.length > 0) {\n        dato.etapas.forEach((etapa) => {\n            var nombre_normalizado = normalizarNombreEtapa(etapa.nombre);\n            if (nombre_normalizado === 'PRUEBASPSICOMETRICAS' && etapa.agendas && etapa.agendas.length > 0) {\n                total_agendas += etapa.agendas.length;\n            } else if (nombre_normalizado !== 'PRUEBASPSICOMETRICAS' && etapa.activa == 1) {\n                if (nombre_normalizado === 'VIDEOENTREVISTA') {\n                    if (etapa.usuarios_vacantes[0].etapa_video_entrevista_completa != true) {\n                        total_etapas_activas++;\n                    }\n                    let solicita_formato = obtenerConfiguracionPorLlave(etapa.configuraciones, 'solicitar_formato_videoentrevista');\n                    if (solicita_formato == '1') {\n                        let formato_entrevista = etapa.usuarios_vacantes[0].formato_entrevista;\n                        let completo_formato_entrevista = formato_entrevista && formato_entrevista.descripcion_vacante !== null;\n                        if (completo_formato_entrevista == null) {\n                            total_etapas_activas++;\n                        }\n                    }\n                } else {\n                    total_etapas_activas++;\n                }\n            } else {\n                total_etapas_activas++;\n            }\n        });\n    }\n\n    let total_tareas_alerta = total_agendas > 0 ? total_agendas : total_etapas_activas;\n\n    let titulo_tareas = total_agendas > 0\n        ? `Pruebas psicométricas (${total_agendas})`\n        : `Tareas de selección (${total_etapas_activas})`;\n\n    let empresa_html = mostrar_empresa ? `\n        <div class=\"col-12 d-flex\">\n            <i class=\"my-auto bi bi-buildings-fill text-body-3 text-gray-30\"></i>\n            <h5 class=\"my-auto card-title text-body-3 text-gray-30 mx-2\">Empresa:</h5>\n            <img class=\"my-auto border rounded\" width=\"24px\" height=\"24px\" src=\"/empresas-logo/${dato?.empresa_id}\" alt=\"${dato?.empresa?.nombre_comercial}\" onerror=\"this.onerror=null;\"/>\n            <h5 class=\"my-auto card-title text-body-3 text-gray-30 mx-2\">${dato?.empresa?.nombre_comercial}</h5>\n        </div>\n    ` : '';\n\n    let barra_progreso_html = `\n        <div class=\"col-12 mt-3\">\n            ${crearProgressBar({\n                label: '<span class=\"text-body-3 fw-bolder mb-3\"><i class=\"bi bi-bar-chart-steps me-2\"></i>Etapa actual: ' + etapa_actual + ' de ' + total_etapas + '</span>',\n                height: '8px',\n                class_label: 'mb-1',\n                porcentaje: {\n                    porcentaje: porcentaje_progreso,\n                    texto: false\n                },\n                class: 'barra-progreso-etapa',\n                rounded: 'rounded-3',\n                rounded2: 'rounded-3'\n            })}\n        </div>\n    `;\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"row mb-3\">\n                    <div class=\"col-12\">\n                        <h5 class=\"card-title text-body-1 fw-bolder text-gray-10\">${dato.nombre_vacante}</h5>\n                    </div>\n                    ${empresa_html}\n                    ${barra_progreso_html}\n                </div>\n                <div class=\"accordion\" id=\"accordionVacante${dato?.id}\">\n                    <div class=\"accordion-item\">\n                        <h2 class=\"accordion-header\">\n                            <button class=\"${clase_boton} d-flex justify-content-between align-items-center\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#collapseVacante${dato.id}\" aria-expanded=\"${area_expandida}\" aria-controls=\"collapseVacante${dato.id}\">\n                                <span>Ver tareas pendientes</span>\n                                ${total_tareas_alerta > 0 ? `<span class=\"badge bg-danger rounded-pill text-label-2\">${total_tareas_alerta}</span>` : ''}\n                            </button>\n                        </h2>\n                        <div id=\"collapseVacante${dato.id}\" class=\"${clase_para_colapsado}\" data-bs-parent=\"#accordionVacante${dato?.id}\">\n                            <div class=\"accordion-body\">\n                                ${total_tareas_alerta > 0 ? `<h1 class=\"text-headline-5 fw-bloder text-gray-10\">${titulo_tareas}</h1>` : ''}\n                                <div class=\"row gap-4 m-0\">${procesarEtapas(dato?.etapas, dato?.id)}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Genera el HTML para mostrar una lista de agendas en tarjetas (cards) con su información detallada.\n *\n * @param {Array<Object>} agendas - Arreglo de objetos de agenda a procesar.\n * @returns {string} HTML generado con la estructura de las tarjetas para cada agenda.\n * @author Andres Morales\n * @author Fahibram Cárcamo\n * @author Andres Gonzalez\n */\nfunction procesarAgendas(agendas) {\n    let estado_clases = {\n        '1': 'tag-filled-yellow',\n        '2': 'tag-filled-blue',\n        '3': 'tag-filled-green',\n        '4': 'tag-filled-red',\n        '5': 'tag-filled-gray',\n        '6': 'tag-filled-green'\n    };\n    let html = '';\n\n    if (!agendas || agendas.length === 0) {\n        return '<div class=\"col-12\"><p class=\"text-center text-gray-30\">No hay pruebas asignadas</p></div>';\n    }\n\n    let orden_estado = [2, 1, 3, 4];\n\n    agendas.sort((a, b) => {\n        let primer_estado = orden_estado.indexOf(Number(a.estado_id));\n        let segundo_estado = orden_estado.indexOf(Number(b.estado_id));\n        return (primer_estado === -1 ? orden_estado.length : primer_estado) - (segundo_estado === -1 ? orden_estado.length : segundo_estado);\n    });\n\n    agendas.forEach((agenda) => {\n        if (agenda.estado.nombre == 'Agendada') agenda.estado.nombre = 'Pendiente';\n        else if (agenda.estado.nombre == 'Sin pago') agenda.estado.nombre = 'Finalizada';\n\n        html += `\n            <div class=\"col p-0 columna-tarjeta-tarea\">\n                <div class=\"card h-100\">\n                    <div class=\"card-body d-flex flex-column cuerpo-tarjeta-tarea\">\n                        <div class=\"w-100 d-flex flex-column row-gap-3\">\n                            <div class=\"w-100 d-flex justify-content-between align-items-center\">\n                                <h5 class=\"card-title text-headline-5 text-gray-10 fw-medium fw-bold m-0\">${agenda?.prueba?.nombre ?? ''}</h5>\n                                <div class=\"d-flex flex-row\">\n                                    ${\n                                        (estado_clases[agenda.estado_id])\n                                            ? crearTag({\n                                                texto: agenda?.estado?.nombre ?? '',\n                                                class: estado_clases[agenda.estado_id]\n                                            })\n                                            : ''\n                                    }\n                                    ${\n                                        (agenda?.estado_id == \"4\")\n                                            ? `<i\n                                                class=\"bi bi-info-circle-fill text-info ms-3 text-headline-3 pointer\"\n                                                ${crearTooltip({\n                                                    placement: `top`,\n                                                    content: `Esta tarea ha expirado debido a que se ha superado el tiempo límite de entrega.`,\n                                                    toggle: `popover`\n                                                })}\n                                            ></i>`\n                                            : ''\n                                    }\n                                </div>\n                            </div>\n\n                            <div class=\"w-100 d-flex flex-column row-gap-2\">\n                                <div class=\"w-100 d-flex justify-content-start\">\n                                    <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-clock me-2\"></i>Tiempo estimo:&nbsp;${agenda?.prueba?.duracion ?? '0'}&nbsp;minutos</p>\n                                </div>\n                                <div class=\"w-100 d-flex justify-content-start\">\n                                    <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-green-cta me-2\"></i>Asignada:&nbsp;${formatearFecha(agenda?.fecha_inicio)}</p>\n                                </div>\n                                <div class=\"w-100 d-flex justify-content-start\">\n                                    <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-red-cta me-2\"></i>Expira:&nbsp;${formatearFecha(agenda?.fecha_cierre)}</p>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"w-100\">\n                            ${\n                                (agenda.estado_id == \"1\")\n                                    ? crearBoton({\n                                        clases: 'btn-primary w-100 d-flex justify-content-center',\n                                        texto: 'Responder',\n                                        onclick: `iniciarPruebaConDemograficas(${agenda.id}, ${agenda.prueba_id})`\n                                    })\n                                    : (agenda.estado_id == \"2\")\n                                        ? crearBoton({\n                                            clases: 'btn-primary w-100 d-flex justify-content-center',\n                                            texto: 'Continuar',\n                                            onclick: `iniciarPruebaConDemograficas(${agenda.id}, ${agenda.prueba_id})`\n                                        })\n                                        : ''\n                            }\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n\n    return html;\n}\n\n/**\n * Obtiene el texto del botón según el tipo de etapa\n * \n * @param {string} nombre_etapa - Nombre de la etapa\n * @returns {string} Texto del botón\n * @author Andres Morales\n */\nfunction obtenerTextoBotonEtapa(nombre_etapa) {\n    var nombre_normalizado = nombre_etapa\n        .toUpperCase()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '')\n        .replace(/[^A-Z0-9]/g, '');\n\n    switch(nombre_normalizado) {\n        case 'PREGUNTASPREFILTRO':\n            return 'Responder';\n        case 'PRUEBATECNICA':\n            return 'Responder';\n        case 'DOCUMENTOSPARACONTRATACION':\n            return `<i class=\"bi bi-eye me-2\"></i> Ver y adjuntar`;\n        case 'ENTREVISTA':\n            return 'Responder';\n        case 'REVISIONHV':\n            return 'Responder';\n        default:\n            return 'Responder';\n    }\n}\n\n/**\n * Obtiene el valor de una configuración por su llave\n * \n * @param {Array} configuraciones - Array de configuraciones\n * @param {string} llave_buscar - Llave a buscar en movimiento_configuracion (puede ser parcial)\n * @param {boolean} busqueda_parcial - Si es true, busca coincidencia parcial en la llave\n * @returns {string|null} Valor de la configuración o null si no existe\n * @author Andres Morales\n */\nfunction obtenerConfiguracionPorLlave(configuraciones, llave_buscar, busqueda_parcial = false) {\n    if (!configuraciones || configuraciones.length === 0) return null;\n\n    var configuracion = configuraciones.find(config => {\n        var llave = config?.movimiento_configuracion?.llave;\n        if (!llave) return false;\n\n        return busqueda_parcial ? llave.includes(llave_buscar) : llave === llave_buscar;\n    });\n\n    return configuracion?.valor ?? null;\n}\n\n/**\n * Normaliza el nombre de una etapa removiendo espacios, acentos y caracteres especiales.\n *\n * @param {string} nombre - Nombre de la etapa a normalizar\n * @returns {string} Nombre normalizado en mayúsculas sin espacios ni acentos\n * @author Andres Morales\n */\nfunction normalizarNombreEtapa(nombre) {\n    if (!nombre) return '';\n\n    return nombre\n        .toUpperCase()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '')\n        .replace(/[^A-Z0-9]/g, '');\n}\n\n/**\n * Genera el HTML para mostrar una lista de etapas en tarjetas (cards) con su información detallada.\n *\n * @param {Array<Object>} etapas - Arreglo de objetos de etapas a procesar.\n * @param {number} vacante_id - ID de la vacante a la que pertenecen las etapas.\n * @returns {string} HTML generado con la estructura de las tarjetas para cada etapa.\n * @author Andres Morales\n * @author Fahibram Cárcamo\n * @author Andres Gonzalez\n */\nfunction procesarEtapas(etapas, vacante_id) {\n    let html = '';\n\n    if (!etapas || etapas.length === 0) {\n        return '<div class=\"col-12\"><p class=\"text-center text-gray-30\">No hay tareas pendientes</p></div>';\n    }\n\n    let etapas_ordenadas = [...etapas].sort((a, b) => a.orden - b.orden);\n\n    etapas_ordenadas.forEach((etapa) => {\n        // Si la etapa es \"Pruebas psicométricas\" y tiene agendas, mostrarlas en lugar de la etapa\n        var nombre_normalizado = normalizarNombreEtapa(etapa.nombre);\n\n        if (nombre_normalizado === 'PRUEBASPSICOMETRICAS' && etapa.agendas && etapa.agendas.length > 0) {\n            html += procesarAgendas(etapa.agendas);\n            return;\n        }\n\n        // Si la etapa es \"Videoentrevista\" y tiene formato de entrevista configurado, mostrar ambas cards\n        if (nombre_normalizado === 'VIDEOENTREVISTA') {\n            let solicita_formato = obtenerConfiguracionPorLlave(etapa.configuraciones, 'solicitar_formato_videoentrevista');\n\n            if (solicita_formato === '1') {\n                html += generarContenedorFormatoEntrevista(etapa, vacante_id);\n                html += generarCardVideoentrevista(etapa, vacante_id);\n                return;\n            }\n        }\n\n        let esta_activa = etapa.activa == 1;\n        let tiene_tareas = etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0;\n\n        let clase_etiqueta = esta_activa ? 'tag-filled-blue' : 'tag-filled-yellow';\n        let texto_estado = esta_activa ? 'Iniciada' : 'Pendiente';\n        let $tiempo_prueba = Math.round((etapa.duracion ?? 300) / 60);\n        let nombre_etapa = etapa.nombre || '';\n\n        if (nombre_normalizado === 'PRUEBATECNICA' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let pruebas_tecnicas = etapa.usuarios_vacantes[0].pruebas_tecnicas;\n            if (pruebas_tecnicas && pruebas_tecnicas.length > 0) {\n                let es_borrador = pruebas_tecnicas[0].borrador == 1;\n                clase_etiqueta = es_borrador ? 'tag-filled-blue' : 'tag-filled-yellow';\n                texto_estado = es_borrador ? 'Iniciada' : 'Pendiente';\n            } else {\n                let es_borrador = false;\n                clase_etiqueta = es_borrador ? 'tag-filled-blue' : 'tag-filled-yellow';\n                texto_estado = es_borrador ? 'Iniciada' : 'Pendiente';\n            }\n        }\n\n        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'PREGUNTASPREFILTRO') {\n            clase_etiqueta = 'tag-filled-yellow';\n            texto_estado = 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'REVISIONHV') {\n            clase_etiqueta = 'tag-filled-yellow';\n            texto_estado = 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'VIDEOENTREVISTA') {\n            clase_etiqueta = 'tag-filled-yellow';\n            texto_estado = 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'ENTREVISTA') {\n            $tiempo_prueba = 15\n            let formato_entrevista       = etapa.usuarios_vacantes[0].formato_entrevista;\n            let tiene_formato_entrevista = formato_entrevista && formato_entrevista.descripcion_vacante !== null;\n            clase_etiqueta               = tiene_formato_entrevista ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado                 = tiene_formato_entrevista ? 'Iniciada' : 'Pendiente';\n            nombre_etapa                 = 'Formato de entrevista';\n        }\n\n        let fecha_notificacion = etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0\n            ? etapa.usuarios_vacantes[0].fecha_notificacion\n            : null;\n\n        let fecha_vencimiento = etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0\n            ? etapa.usuarios_vacantes[0].fecha_vencimiento\n            : null;\n\n        let es_documentos_solicitados = nombre_normalizado === 'DOCUMENTOSPARACONTRATACION';\n        let ocultar_tiempo_estimado = ['REVISIONHV', 'PRUEBATECNICA', 'DOCUMENTOSPARACONTRATACION'].includes(nombre_normalizado);\n\n        html += `\n            <div class=\"col p-0 columna-tarjeta-tarea\">\n                <div class=\"card h-100\">\n                    <div class=\"card-body d-flex flex-column cuerpo-tarjeta-tarea\">\n\n                        <div class=\"w-100 d-flex flex-column row-gap-3\">\n\n                            <div class=\"w-100 d-flex justify-content-between align-items-center\">\n                                <h5 class=\"card-title text-headline-5 text-gray-10 fw-medium fw-bold m-0\">${nombre_etapa ?? ''}</h5>\n                                <div class=\"d-flex flex-row\">\n                                    ${crearTag({\n                                        texto: texto_estado,\n                                        class: clase_etiqueta\n                                    })}\n                                </div>\n                            </div>\n\n                            <div class=\"w-100 d-flex flex-column row-gap-2\">\n                                ${\n                                    !ocultar_tiempo_estimado\n                                        ? `<div class=\"w-100 d-flex justify-content-start\">\n                                            <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-clock me-2\"></i>Tiempo estimado:&nbsp;${$tiempo_prueba}&nbsp;minutos</p>\n                                        </div>`\n                                        : ''\n                                }\n                                <div class=\"w-100 d-flex justify-content-start\">\n                                    <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-green-cta me-2\"></i>Asignada:&nbsp;${formatearFecha(fecha_notificacion ?? etapa.created_at)}</p>\n                                </div>\n                                <div class=\"w-100 d-flex justify-content-start\">\n                                    <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-red-cta me-2\"></i>Expira:&nbsp;${formatearFecha(fecha_vencimiento ?? etapa.created_at)}</p>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"w-100\">\n                            ${\n                                (esta_activa && tiene_tareas)\n                                    ? crearBoton({\n                                        clases: 'btn-primary w-100 d-flex justify-content-center',\n                                        texto: obtenerTextoBotonEtapa(etapa.nombre),\n                                        onclick: `ejecutarAccionEtapa(${etapa.id}, ${vacante_id})`\n                                    })\n                                    : ''\n                            }\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n\n    return html;\n}\n\n/**\n * Genera la card HTML para la etapa de Formato de entrevista dentro de Videoentrevista.\n *\n * @param {Object} etapa - Objeto de etapa de videoentrevista con formato de entrevista.\n * @param {number} vacante_id - ID de la vacante a la que pertenece la etapa.\n * @returns {string} HTML generado con la estructura de la card de formato de entrevista.\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction generarContenedorFormatoEntrevista(etapa, vacante_id) {\n    let formato_entrevista = etapa.usuarios_vacantes[0].formato_entrevista;\n    let tiene_formato_entrevista = formato_entrevista && formato_entrevista.descripcion_vacante !== null;\n\n    let descripcion_tiene_datos = formato_entrevista &&\n                                  formato_entrevista.descripcion_vacante !== null &&\n                                  formato_entrevista.descripcion_vacante !== undefined &&\n                                  formato_entrevista.descripcion_vacante.trim() !== '';\n\n    if (descripcion_tiene_datos) {\n        return '';\n    }\n\n    let clase_etiqueta = tiene_formato_entrevista ? 'tag-filled-blue' : 'tag-filled-yellow';\n    let texto_estado = tiene_formato_entrevista ? 'Iniciada' : 'Pendiente';\n    let tiempo_prueba = 15;\n\n    let fecha_notificacion = etapa.usuarios_vacantes[0].fecha_notificacion;\n    let fecha_vencimiento = etapa.usuarios_vacantes[0].fecha_vencimiento;\n\n    let esta_activa = etapa.activa == 1;\n    let tiene_tareas = etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0;\n\n    return `\n        <div class=\"col p-0 columna-tarjeta-tarea\">\n            <div class=\"card h-100\">\n                <div class=\"card-body d-flex flex-column cuerpo-tarjeta-tarea\">\n\n                    <div class=\"w-100 d-flex flex-column row-gap-3\">\n\n                        <div class=\"w-100 d-flex justify-content-between align-items-center\">\n                            <h5 class=\"card-title text-headline-5 text-gray-10 fw-medium fw-bold m-0\">Formato de entrevista</h5>\n                            <div class=\"d-flex flex-row\">\n                                ${crearTag({\n                                    texto: texto_estado,\n                                    class: clase_etiqueta\n                                })}\n                            </div>\n                        </div>\n\n                        <div class=\"w-100 d-flex flex-column row-gap-2\">\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-clock me-2\"></i>Tiempo estimado:&nbsp;${tiempo_prueba}&nbsp;minutos</p>\n                            </div>\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-green-cta me-2\"></i>Asignada:&nbsp;${formatearFecha(fecha_notificacion ?? etapa.created_at)}</p>\n                            </div>\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-red-cta me-2\"></i>Expira:&nbsp;${formatearFecha(fecha_vencimiento ?? etapa.created_at)}</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"w-100\">\n                        ${\n                            (esta_activa && tiene_tareas)\n                                ? crearBoton({\n                                    clases: 'btn-primary w-100 d-flex justify-content-center',\n                                    texto: 'Responder',\n                                    onclick: `ejecutarAccionFormatoEntrevista(${etapa.id}, ${vacante_id})`\n                                })\n                                : ''\n                        }\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Genera la card HTML para la etapa de Videoentrevista.\n *\n * @param {Object} etapa - Objeto de etapa de videoentrevista.\n * @param {number} vacante_id - ID de la vacante a la que pertenece la etapa.\n * @returns {string} HTML generado con la estructura de la card de videoentrevista.\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction generarCardVideoentrevista(etapa, vacante_id) {\n    // Si la videoentrevista está completa, no mostrar la card\n    if (etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n        let etapa_completa = etapa.usuarios_vacantes[0].etapa_video_entrevista_completa;\n        if (etapa_completa === true) {\n            return '';\n        }\n    }\n\n    let clase_etiqueta = 'tag-filled-yellow';\n    let texto_estado = 'Pendiente';\n    let tiempo_prueba = Math.round((etapa.duracion ?? 300) / 60);\n\n    let fecha_notificacion = etapa.usuarios_vacantes[0].fecha_notificacion;\n    let fecha_vencimiento = etapa.usuarios_vacantes[0].fecha_vencimiento;\n\n    let esta_activa = etapa.activa == 1;\n    let tiene_tareas = etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0;\n\n    return `\n        <div class=\"col p-0 columna-tarjeta-tarea\">\n            <div class=\"card h-100\">\n                <div class=\"card-body d-flex flex-column cuerpo-tarjeta-tarea\">\n\n                    <div class=\"w-100 d-flex flex-column row-gap-3\">\n\n                        <div class=\"w-100 d-flex justify-content-between align-items-center\">\n                            <h5 class=\"card-title text-headline-5 text-gray-10 fw-medium fw-bold m-0\">Video entrevista</h5>\n                            <div class=\"d-flex flex-row\">\n                                ${crearTag({\n                                    texto: texto_estado,\n                                    class: clase_etiqueta\n                                })}\n                            </div>\n                        </div>\n\n                        <div class=\"w-100 d-flex flex-column row-gap-2\">\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-clock me-2\"></i>Tiempo estimado:&nbsp;${tiempo_prueba}&nbsp;minutos</p>\n                            </div>\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-green-cta me-2\"></i>Asignada:&nbsp;${formatearFecha(fecha_notificacion ?? etapa.created_at)}</p>\n                            </div>\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-red-cta me-2\"></i>Expira:&nbsp;${formatearFecha(fecha_vencimiento ?? etapa.created_at)}</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"w-100\">\n                        ${\n                            (esta_activa && tiene_tareas)\n                                ? crearBoton({\n                                    clases: 'btn-primary w-100 d-flex justify-content-center',\n                                    texto: 'Responder',\n                                    onclick: `ejecutarAccionVideoentrevista(${etapa.id}, ${vacante_id})`\n                                })\n                                : ''\n                        }\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Valida si el usuario tiene la información básica completada.\n * Si no la tiene, muestra el modal de información incompleta.\n *\n * @returns {Promise<boolean>} true si la información está completa, false si no\n * @author Andres Morales\n */\nfunction validarInformacionBasicaUsuario() {\n    return new Promise((resolucion, rechazo) => {\n        $.ajax({\n            url: '/usuario-validar-informacion-basica',\n            type: 'GET',\n            success: function(respuesta) {\n                if (respuesta.data.informacion_completa) {\n                    resolucion(true);\n                } else {\n                    // Guardar el usuario_id para usarlo después\n                    window.usuario_id_actual = respuesta.data.usuario_id;\n                    $('#modal-informacion-incompleta').modal('show');\n                    resolucion(false);\n                }\n            },\n            error: function(respuesta_xhr) {\n                mostrarToast('danger', 'Error al validar la información. Intenta nuevamente.');\n                rechazo(false);\n            }\n        });\n    });\n}\n\n/**\n * Cierra el modal de información incompleta.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction cerrarModalInformacionIncompleta() {\n    $('#modal-informacion-incompleta').modal('hide');\n}\n\n/**\n * Redirige al usuario a la página de editar perfil.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction irEditarPerfil() {\n    var usuario_id = window.usuario_id_actual || '';\n    if (usuario_id) {\n        window.location.href = `/usuarios/${usuario_id}/edit`;\n    } else {\n        mostrarToast('danger', 'No se pudo obtener el ID del usuario.');\n    }\n}\n\n/**\n * Ejecuta la acción correspondiente según el tipo de etapa de la vacante.\n * Valida la existencia de la vacante y etapa, y delega a la función específica.\n *\n * @param {number} etapa_id - ID de la etapa a ejecutar\n * @param {number} vacante_id - ID de la vacante asociada\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction ejecutarAccionEtapa(etapa_id, vacante_id) {\n    // Primero validar la información básica del usuario\n    validarInformacionBasicaUsuario().then(function(informacion_completa) {\n        if (!informacion_completa) {\n            return;\n        }\n\n        // Si la información está completa, continuar con la lógica original\n        ejecutarAccionEtapaInterno(etapa_id, vacante_id);\n    });\n}\n\n/**\n * Función interna que ejecuta la acción de la etapa sin validación previa.\n *\n * @param {number} etapa_id - ID de la etapa a ejecutar\n * @param {number} vacante_id - ID de la vacante asociada\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction ejecutarAccionEtapaInterno(etapa_id, vacante_id) {\n    var vacante = datos_ids.find(elemento_vacante => elemento_vacante.id === vacante_id && elemento_vacante.hasOwnProperty('etapas'));\n\n    if (!vacante) {\n        mostrarToast('danger', 'No se encontró la vacante');\n        return;\n    }\n\n    var etapa = vacante.etapas.find(elemento_etapa => elemento_etapa.id === etapa_id);\n\n    if (!etapa) {\n        mostrarToast('danger', 'No se encontró la etapa');\n        return;\n    }\n\n    if (!etapa.usuarios_vacantes || etapa.usuarios_vacantes.length === 0) {\n        mostrarToast('danger', 'No tienes asignada esta etapa');\n        return;\n    }\n\n    var descripcion_prueba = obtenerConfiguracionPorLlave(etapa.configuraciones, 'descripcion_prueba_tecnica');\n    var fecha_vencimiento = etapa.usuarios_vacantes[0].fecha_vencimiento;\n\n    var documentos_solicitados_config = obtenerConfiguracionPorLlave(etapa.configuraciones, 'documentos_solicitados');\n    var documentos_solicitados = [];\n\n    if (documentos_solicitados_config) {\n        try {\n            documentos_solicitados = JSON.parse(documentos_solicitados_config);\n        } catch (e) {\n            console.error('Error al parsear documentos solicitados:', e);\n        }\n    }\n\n    var datos_etapa = {\n        id: etapa.id,\n        nombre: etapa.nombre,\n        etapa_vacante_usuario_id: etapa.usuarios_vacantes[0].id,\n        archivos: etapa.archivos || [],\n        vacante_nombre: vacante.nombre_vacante,\n        vacante_id: vacante.id,\n        descripcion: descripcion_prueba,\n        fecha_cierre: fecha_vencimiento,\n        documentos_solicitados: documentos_solicitados,\n        configuracion_ia_hv : obtenerConfiguracionPorLlave(etapa.configuraciones, 'revision_hv_ia'),\n        prueba_tecnica: etapa.usuarios_vacantes[0].pruebas_tecnicas && etapa.usuarios_vacantes[0].pruebas_tecnicas.length > 0\n            ? etapa.usuarios_vacantes[0].pruebas_tecnicas[0]\n            : null\n    };\n\n    var nombre_normalizado = normalizarNombreEtapa(etapa.nombre);\n\n    switch(nombre_normalizado) {\n        case 'VIDEOENTREVISTA':\n            window.location.href = `/bienvenida-preguntas-videoentrevista?etapa_vacante_id=${datos_etapa.id}`;\n            break;\n\n        case 'PREGUNTASPREFILTRO':\n            window.location.href = `/bienvenida-preguntas-prefiltro?etapa_vacante_id=${datos_etapa.id}`;\n            break;\n\n        case 'PRUEBATECNICA':\n            abrirModalPruebaTecnica(datos_etapa);\n            break;\n\n        case 'DOCUMENTOSPARACONTRATACION':\n            abrirModalDocumentosSolicitados(datos_etapa);\n            break;\n\n        case 'ENTREVISTA':\n            window.location.href = `/formatos-entrevistas/create?etapa_vacante_usuario_id=${datos_etapa.etapa_vacante_usuario_id}`;\n            break;\n\n        case 'REVISIONHV':\n            limpiarFormularioRevisionHV();\n            abrirModalRevisionHV(datos_etapa);\n            break;\n\n        default:\n            mostrarToast('info', 'No hay acciones disponibles para esta etapa');\n            break;\n    }\n}\n\n/**\n * Ejecuta la acción de videoentrevista directamente sin validación de información básica.\n *\n * @param {number} etapa_id - ID de la etapa a ejecutar\n * @param {number} vacante_id - ID de la vacante asociada\n * @returns {void}\n * @author Andres Morales\n */\nfunction ejecutarAccionVideoentrevista(etapa_id, vacante_id) {\n    validarInformacionBasicaUsuario().then(function(informacion_completa) {\n        if (!informacion_completa) {\n            return;\n        }\n        window.location.href = `/bienvenida-preguntas-videoentrevista?etapa_vacante_id=${etapa_id}`;\n    });\n}\n\n/**\n * Ejecuta la acción para abrir el formato de entrevista cuando es parte de videoentrevista.\n *\n * @param {number} etapa_id - ID de la etapa a ejecutar\n * @param {number} vacante_id - ID de la vacante asociada\n * @returns {void}\n * @author Andres Morales\n */\nfunction ejecutarAccionFormatoEntrevista(etapa_id, vacante_id) {\n    validarInformacionBasicaUsuario().then(function(informacion_completa) {\n        if (!informacion_completa) {\n            return;\n        }\n\n        var vacante = datos_ids.find(elemento_vacante => elemento_vacante.id === vacante_id && elemento_vacante.hasOwnProperty('etapas'));\n\n        if (!vacante) {\n            mostrarToast('danger', 'No se encontró la vacante');\n            return;\n        }\n\n        var etapa = vacante.etapas.find(elemento_etapa => elemento_etapa.id === etapa_id);\n\n        if (!etapa) {\n            mostrarToast('danger', 'No se encontró la etapa');\n            return;\n        }\n\n        if (!etapa.usuarios_vacantes || etapa.usuarios_vacantes.length === 0) {\n            mostrarToast('danger', 'No tienes asignada esta etapa');\n            return;\n        }\n\n        var etapa_vacante_usuario_id = etapa.usuarios_vacantes[0].id;\n        window.location.href = `/formatos-entrevistas/create?etapa_vacante_usuario_id=${etapa_vacante_usuario_id}`;\n    });\n}\n\n/**\n * Inicia la prueba verificando primero si hay demográficas pendientes.\n * Si hay demográficas, abre el modal; si no, redirige directamente a la prueba.\n *\n * @param {number} agenda_id - ID de la agenda\n * @param {number} prueba_id - ID de la prueba\n * @returns {void}\n * @author Andres Morales\n */\nfunction iniciarPruebaConDemograficas(agenda_id, prueba_id) {\n    $.ajax({\n        url: `/demograficas-ajax/${agenda_id}/${prueba_id}`,\n        type: 'GET',\n        success: function(respuesta) {\n            if (respuesta.data.redirigir_directo) {\n                // No hay demográficas o ya están completas\n                window.location.href = `/realizar-prueba/${agenda_id}`;\n            } else {\n                // Hay demográficas pendientes, abrir modal\n                abrirModalDemograficas(respuesta.data);\n            }\n        },\n        error: function(respuesta_xhr) {\n            mostrarToast('danger', 'Error al cargar las demográficas. Intenta nuevamente.');\n        }\n    });\n}\n\n/**\n * Abre el modal de demográficas y renderiza el formulario dinámicamente.\n *\n * @param {Object} datos - Objeto con datos de demográficas y agenda\n * @returns {void}\n * @author Andres Morales\n */\nfunction abrirModalDemograficas(datos) {\n    // Establecer datos en campos ocultos\n    $('#agenda_id_modal').val(datos.agenda_id);\n\n    // Actualizar título del modal con el nombre de la prueba\n    $('#titulo-modal-demograficas').text(`Datos demográficos - ${datos.agenda?.prueba?.nombre || 'Prueba'}`);\n\n    // Limpiar contenedor\n    $('#contenedor-demograficas-modal').empty();\n\n    // Renderizar cada demográfica\n    datos.demograficas.forEach(function(demografica) {\n        let html_demografica = '';\n        let elemento_id = \"\";\n        if (!demografica.otro) {\n            // Pregunta tipo select\n            elemento_id = `demografica_${demografica.id}`\n            html_demografica = `\n                <div class=\"col-12 mb-4\">\n                    ${crearSelect2({\n                        id: `${elemento_id}`,\n                        name: `${elemento_id}`,\n                        label: demografica.nombre,\n                        required: true,\n                        opciones: demografica.opciones.map(opcion => ({\n                            id: opcion.id,\n                            nombre: opcion.contenido\n                        })),\n                        buscador: true\n                    })}\n                </div>\n            `;\n        } else {\n            // Pregunta tipo texto\n            html_demografica = `\n                <div class=\"col-12\">\n                    ${crearInput({\n                        id: `demografica_opcion_${demografica.opciones[0].id}`,\n                        name: `demografica_opcion_${demografica.opciones[0].id}`,\n                        type: 'text',\n                        label: demografica.nombre,\n                        required: true,\n                        autocomplete: 'off',\n                        maxlength: 200\n                    })}\n                </div>\n            `;\n        }\n\n        $('#contenedor-demograficas-modal').append(html_demografica);\n        // Inicializar Select2 en los nuevos elementos\n    });\n    actualizarSelect2();\n\n\n    // Mostrar modal\n    $('#modal-demograficas').modal('show');\n}\n\n/**\n * Guarda las respuestas de las demográficas mediante AJAX.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction guardarDemograficasModal() {\n    var formulario = $('#formulario-demograficas-modal')[0];\n\n    if (!formulario.checkValidity()) {\n        formulario.reportValidity();\n        return;\n    }\n\n    var agenda_id = $('#agenda_id_modal').val();\n    let respuestas = [];\n\n    $('select[name^=\"demografica_\"]').each(function() {\n        var valor = $(this).val();\n        if (valor) {\n            respuestas.push({\n                demografica_opcion_id: valor\n            });\n        }\n    });\n\n    $('input[name^=\"demografica_opcion_\"]').each(function() {\n        var valor = $(this).val();\n        var opcion_id = $(this).attr('name').split('_')[2];\n        if (valor) {\n            respuestas.push({\n                demografica_opcion_id: opcion_id,\n                respuesta: valor\n            });\n        }\n    });\n\n    $('#btn-guardar-demograficas').prop('disabled', true).text('Guardando...');\n\n    $.ajax({\n        type: 'POST',\n        url: `/agendas-demograficas-opciones`,\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            agenda_id: agenda_id,\n            respuestas: JSON.stringify(respuestas)\n        },\n        success: function(respuesta) {\n            if (respuesta.data.redirigir) {\n                $('#modal-demograficas').modal({backdrop: 'static', keyboard: false});\n\n                $('button[onclick*=\"iniciarPruebaConDemograficas\"]').prop('disabled', true);\n                $('button[onclick*=\"ejecutarAccionEtapa\"]').prop('disabled', true);\n\n                $('#titulo-modal-demograficas').html('<i class=\"bi bi-hourglass-split me-2\"></i>Iniciando prueba');\n                $('#subtitulo-modal-demograficas').text('Espera un momento mientras preparamos tu evaluación');\n\n                $('#contenedor-demograficas-modal').html(`\n                    <div class=\"text-center py-5\">\n                        <div class=\"spinner-border text-primary mb-3\" role=\"status\" style=\"width: 3rem; height: 3rem;\">\n                            <span class=\"visually-hidden\">Cargando...</span>\n                        </div>\n                        <p class=\"text-body-1 text-gray-10 fw-medium mb-2\">Preparando tu evaluación...</p>\n                        <p class=\"text-body-3 text-gray-30\">Por favor no cierres esta ventana</p>\n                    </div>\n                `);\n\n                $('#modal-demograficas .modal-footer').hide();\n\n                mostrarToast('success', 'Datos guardados correctamente');\n\n                window.location.href = `/realizar-prueba/${agenda_id}`;\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar. Intenta nuevamente.');\n            $('#btn-guardar-demograficas').prop('disabled', false).text('Continuar');\n        }\n    });\n}\n\n/**\n * Cierra el modal de demográficas y limpia el formulario.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction cerrarModalDemograficas() {\n    $('button[onclick*=\"iniciarPruebaConDemograficas\"]').prop('disabled', false);\n    $('button[onclick*=\"ejecutarAccionEtapa\"]').prop('disabled', false);\n\n    $('#modal-demograficas').modal('hide');\n    $('#formulario-demograficas-modal')[0].reset();\n    $('#contenedor-demograficas-modal').empty();\n\n    $('#btn-guardar-demograficas').prop('disabled', false).text('Continuar');\n}\n\n/**\n * Abre automáticamente el acordeón de una vacante específica.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction abrirAcordeonVacante() {\n    let parametros_url = new URLSearchParams(window.location.search);\n    let vacante_id     = parametros_url.get('vacante_id');\n\n    if (vacante_id) {\n        let boton_vacante = $(`#accordionVacante${vacante_id} .accordion-button`);\n        if (boton_vacante.length > 0) {\n            boton_vacante.click();\n        }\n    }\n}\n","structuredPatch":[{"oldStart":533,"oldLines":8,"newStart":533,"newLines":9,"lines":["         }"," ","         if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {","-            let archivos = etapa.usuarios_vacantes[0].archivos;","-            let tiene_archivos = archivos && archivos.length > 0;","+            let archivos = etapa.usuarios_vacantes[0].archivos || [];","+            let archivos_aplicante = archivos.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));","+            let tiene_archivos = archivos_aplicante.length > 0;","             clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';","             texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';","         }"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"5541e569-9823-4159-842b-1f3144fcb480"}
{"parentUuid":"d048477a-3abd-4886-9c74-e857e74653e0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01XpdTQ9XpQE7cGczib7X8Pd","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora solo cuenta los archivos del aplicante (los que NO comienzan con `cliente_empresa_`) para determinar el estado de la etapa:\n\n| Archivos aplicante | Estado |\n|-------------------|--------|\n| 0 | Pendiente (amarillo) |\n| > 0 | Iniciada (azul) |"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":811,"cache_read_input_tokens":58023,"cache_creation":{"ephemeral_5m_input_tokens":811,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXKVaA35U4iGwqs2bEtFv","type":"assistant","uuid":"1270cff0-a720-4df7-bbd3-528cbf1778b7","timestamp":"2026-01-20T23:25:10.930Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-21T14:15:46.307Z","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d"}
{"type":"file-history-snapshot","messageId":"18ea9eee-1bac-4260-bc3d-4f3766d8d048","snapshot":{"messageId":"18ea9eee-1bac-4260-bc3d-4f3766d8d048","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v8","version":8,"backupTime":"2026-01-21T14:15:46.631Z"},"public\\js\\vacantes\\detalles\\detalle-etapas.js":{"backupFileName":"dccddb1063a31949@v3","version":3,"backupTime":"2026-01-21T14:15:46.745Z"},"public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js":{"backupFileName":"f91a5ce6abb13dfb@v2","version":2,"backupTime":"2026-01-21T14:15:46.759Z"}},"timestamp":"2026-01-21T14:15:46.467Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 853 to 853 from c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php:\npublic function verificarEtapaCompletada(int $id): bool {\n\nThis may or may not be related to the current task.</ide_selection>"}]},"uuid":"0c561d9f-86dc-4b2e-9003-edc79d13ab1f","timestamp":"2026-01-20T21:28:14.360Z"}
{"parentUuid":"0c561d9f-86dc-4b2e-9003-edc79d13ab1f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"analiza esta funcion public function verificarEtapaCompletada(int $id): bool {"}]},"uuid":"e3b7ac0f-6c23-43ee-b5fa-0d1ebb027213","timestamp":"2026-01-20T21:28:14.360Z"}
{"parentUuid":"e3b7ac0f-6c23-43ee-b5fa-0d1ebb027213","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T21:28:16.421Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TTwdjkkd7Yjkhvrc1ePaWC","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a leer la función completa para analizarla."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":25112,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":25112,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKLfFsQTNuKT9oft5CbW","uuid":"5f53c459-94c3-41b9-86d0-f5a428f20fd5"}
{"parentUuid":"5f53c459-94c3-41b9-86d0-f5a428f20fd5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T21:28:17.600Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TTwdjkkd7Yjkhvrc1ePaWC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UxU7HjHiaST8pHBa6xEvA9","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","offset":850,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":25112,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":25112,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKLfFsQTNuKT9oft5CbW","uuid":"80c7e4f5-044c-4e1a-a936-817586e8e55d"}
{"parentUuid":"80c7e4f5-044c-4e1a-a936-817586e8e55d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UxU7HjHiaST8pHBa6xEvA9","type":"tool_result","content":"   850→     * @author Daniel Beltrán\n   851→     * @author Andres Gonzalez\n   852→     */\n   853→    public function verificarEtapaCompletada(int $id): bool {\n   854→        $etapa_usuario    = $this->repositorio->getUno($id);\n   855→        $etapa_completada = false;\n   856→\n   857→        // Verificar si la etapa de revisión de hoja de vida ya fue completada\n   858→        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::REVISION_HV_NOMBRE, EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE]) && !is_null($etapa_usuario->puntaje) || !is_null($etapa_usuario->puntaje_ia)) {\n   859→            $etapa_completada = true;\n   860→        }\n   861→\n   862→        if ($etapa_usuario->etapa->nombre === EtapaVacante::ENTREVISTA_NOMBRE) {\n   863→            if ($this->configuracion_modelo_servicio->obtenerValorLlaveConfiguracion(app(VacanteService::class)->obtenerConfiguracionesEtapaAplicante($etapa_usuario->etapa_vacante_id), 'solicitar_formato_entrevista')) {\n   864→                $formato_entrevista = $this->formato_entrevista_repositorio->getUnoAvanzado(new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id]));\n   865→\n   866→                if (!is_null($formato_entrevista) && !is_null($formato_entrevista->descripcion_vacante) && !empty($formato_entrevista->descripcion_vacante)) {\n   867→                    $etapa_completada = true;\n   868→                }\n   869→            } else {\n   870→                $etapa_completada = true;\n   871→            }\n   872→        }\n   873→\n   874→        // Verificar si las etapas de preguntas prefiltro o videoentrevista ya han sido completadas\n   875→        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE])) {\n   876→            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n   877→                'etapa_vacante_id'                      => $etapa_usuario->etapa_vacante_id,\n   878→                'usuario_id'                            => $etapa_usuario->usuario_id,\n   879→                'incluir_cantidad_respuestas_aplicante' => true\n   880→            ]));\n   881→\n   882→            $preguntas_contestadas = 0;\n   883→\n   884→            foreach ($preguntas as $pregunta) {\n   885→                if ($pregunta['respuestas_count'] > 0) {\n   886→                    $preguntas_contestadas++;\n   887→                }\n   888→            }\n   889→\n   890→            // Validar que todas las preguntas hayan sido contestadas\n   891→            if (count($preguntas) === $preguntas_contestadas) {\n   892→                $etapa_completada = true;\n   893→            }\n   894→        }\n   895→\n   896→        if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n   897→            if ((!is_null($etapa_usuario->pruebaTecnica?->enlace) && !empty($etapa_usuario->pruebaTecnica?->enlace) || $etapa_usuario->pruebaTecnica?->archivos->count() > 0) && $etapa_usuario->pruebaTecnica?->borrador == false) {\n   898→                $etapa_completada = true;\n   899→            }\n   900→        }\n   901→\n   902→        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n   903→            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n   904→                $etapa_usuario->etapa_vacante_id,\n   905→                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n   906→            );\n   907→\n   908→            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n   909→            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n   910→            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n   911→\n   912→            $todos_cargados = true;\n   913→            foreach ($documentos_solicitados as $documento) {\n   914→                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n   915→\n   916→                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n   917→                    $todos_cargados = false;\n   918→                    break;\n   919→                }\n   920→            }\n   921→\n   922→            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n   923→                $etapa_completada = true;\n   924→            }\n   925→        }\n   926→\n   927→        return $etapa_completada;\n   928→    }\n   929→\n   930→    /**\n   931→     * Notificar documentos solicitados.\n   932→     *\n   933→     * @param int $id ID de la etapa del usuario en la vacante.\n   934→     * @return void\n   935→     * @author Andres Gonzalez\n   936→     * @author Jair Carvajal\n   937→     * @author Daniel Beltrán\n   938→     */\n   939→    public function notificarDocumentosSolicitados(int $id): void {\n   940→        $etapa_vacante_usuario = $this->repositorio->getUno($id);\n   941→\n   942→        if ($etapa_vacante_usuario) {\n   943→            $this->enviarCorreoFinalizacionEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->vacante);\n   944→        }\n   945→    }\n   946→\n   947→    /**\n   948→     * Descartar uno o varios aplicantes manualmente y moverlos a la etapa de descartados.\n   949→     *\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"5ff9c522-67e2-4719-8fe7-f8ea57996cc2","timestamp":"2026-01-20T21:28:19.823Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","content":"     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function verificarEtapaCompletada(int $id): bool {\n        $etapa_usuario    = $this->repositorio->getUno($id);\n        $etapa_completada = false;\n\n        // Verificar si la etapa de revisión de hoja de vida ya fue completada\n        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::REVISION_HV_NOMBRE, EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE]) && !is_null($etapa_usuario->puntaje) || !is_null($etapa_usuario->puntaje_ia)) {\n            $etapa_completada = true;\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::ENTREVISTA_NOMBRE) {\n            if ($this->configuracion_modelo_servicio->obtenerValorLlaveConfiguracion(app(VacanteService::class)->obtenerConfiguracionesEtapaAplicante($etapa_usuario->etapa_vacante_id), 'solicitar_formato_entrevista')) {\n                $formato_entrevista = $this->formato_entrevista_repositorio->getUnoAvanzado(new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id]));\n\n                if (!is_null($formato_entrevista) && !is_null($formato_entrevista->descripcion_vacante) && !empty($formato_entrevista->descripcion_vacante)) {\n                    $etapa_completada = true;\n                }\n            } else {\n                $etapa_completada = true;\n            }\n        }\n\n        // Verificar si las etapas de preguntas prefiltro o videoentrevista ya han sido completadas\n        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE])) {\n            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n                'etapa_vacante_id'                      => $etapa_usuario->etapa_vacante_id,\n                'usuario_id'                            => $etapa_usuario->usuario_id,\n                'incluir_cantidad_respuestas_aplicante' => true\n            ]));\n\n            $preguntas_contestadas = 0;\n\n            foreach ($preguntas as $pregunta) {\n                if ($pregunta['respuestas_count'] > 0) {\n                    $preguntas_contestadas++;\n                }\n            }\n\n            // Validar que todas las preguntas hayan sido contestadas\n            if (count($preguntas) === $preguntas_contestadas) {\n                $etapa_completada = true;\n            }\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n            if ((!is_null($etapa_usuario->pruebaTecnica?->enlace) && !empty($etapa_usuario->pruebaTecnica?->enlace) || $etapa_usuario->pruebaTecnica?->archivos->count() > 0) && $etapa_usuario->pruebaTecnica?->borrador == false) {\n                $etapa_completada = true;\n            }\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n                $etapa_usuario->etapa_vacante_id,\n                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n            );\n\n            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n\n            $todos_cargados = true;\n            foreach ($documentos_solicitados as $documento) {\n                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n\n                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n                    $todos_cargados = false;\n                    break;\n                }\n            }\n\n            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }\n        }\n\n        return $etapa_completada;\n    }\n\n    /**\n     * Notificar documentos solicitados.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Jair Carvajal\n     * @author Daniel Beltrán\n     */\n    public function notificarDocumentosSolicitados(int $id): void {\n        $etapa_vacante_usuario = $this->repositorio->getUno($id);\n\n        if ($etapa_vacante_usuario) {\n            $this->enviarCorreoFinalizacionEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->vacante);\n        }\n    }\n\n    /**\n     * Descartar uno o varios aplicantes manualmente y moverlos a la etapa de descartados.\n     *","numLines":100,"startLine":850,"totalLines":1346}}}
{"parentUuid":"5ff9c522-67e2-4719-8fe7-f8ea57996cc2","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T21:28:34.927Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_015714psjyGVZDmyCUGeWbcC","type":"message","role":"assistant","content":[{"type":"text","text":"## Análisis de `verificarEtapaCompletada`\n\nEsta función verifica si una etapa del proceso de selección ha sido completada por un usuario/aplicante. Retorna `true` si la etapa está completa, `false` en caso contrario.\n\n### Estructura de la función\n\nLa función evalúa diferentes tipos de etapas:\n\n| Etapa | Criterio de completitud |\n|-------|------------------------|\n| **Revisión HV / Pruebas Psicométricas / Video Entrevista** | Tiene `puntaje` o `puntaje_ia` asignado |\n| **Entrevista** | Si requiere formato: debe tener `descripcion_vacante`. Si no lo requiere: siempre completada |\n| **Preguntas Prefiltro / Video Entrevista** | Todas las preguntas deben estar contestadas |\n| **Prueba Técnica** | Tiene enlace o archivos adjuntos y no está en borrador |\n| **Documentos Contratación** | Todos los documentos solicitados han sido cargados |\n\n### ⚠️ Problema detectado en línea 858\n\n```php\nif (in_array($etapa_usuario->etapa->nombre, [...]) && !is_null($etapa_usuario->puntaje) || !is_null($etapa_usuario->puntaje_ia)) {\n```\n\n**Error de precedencia de operadores**: El `&&` tiene mayor precedencia que `||`, por lo que la condición se evalúa como:\n\n```php\n(in_array(...) && !is_null($etapa_usuario->puntaje)) || !is_null($etapa_usuario->puntaje_ia)\n```\n\nEsto significa que si `puntaje_ia` no es nulo, **cualquier etapa** se marcará como completada, no solo las tres especificadas.\n\n**Corrección sugerida**:\n```php\nif (in_array($etapa_usuario->etapa->nombre, [...]) && (!is_null($etapa_usuario->puntaje) || !is_null($etapa_usuario->puntaje_ia))) {\n```\n\n### Otro detalle\n\nLa etapa `VIDEO_ENTREVISTA_NOMBRE` aparece en dos bloques diferentes (líneas 858 y 875), lo cual puede ser intencional si debe cumplir ambas condiciones, pero podría generar comportamiento inesperado ya que el primer bloque podría marcar `$etapa_completada = true` antes de verificar las preguntas.\n\n¿Deseas que corrija el error de precedencia de operadores?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2004,"cache_read_input_tokens":25112,"cache_creation":{"ephemeral_5m_input_tokens":2004,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKLffj7CBikd9TDixwbU","uuid":"192d4bfd-6848-4a0d-83e9-f1653c85aae4"}
{"parentUuid":"192d4bfd-6848-4a0d-83e9-f1653c85aae4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"listo cunado sea la etapa de documentos contratacion que valide los documnetos y valide que el campo que bien del get uno qye es fecha_ejecucion sea diferente a null"}]},"uuid":"a832829d-52c3-410c-b1ad-005aa79e7fa4","timestamp":"2026-01-20T21:34:08.098Z"}
{"parentUuid":"a832829d-52c3-410c-b1ad-005aa79e7fa4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T21:34:10.585Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01QqWqmpwWqFGRLcwKv2ZLt1","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a modificar la función para agregar la validación de `fecha_ejecucion` en la etapa de documentos de contratación."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":27806,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":27806,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKM7Me9eR8S4bVUveBf2","uuid":"ab5c63d7-0c69-43f3-9874-56be4d17ddbe"}
{"parentUuid":"ab5c63d7-0c69-43f3-9874-56be4d17ddbe","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T21:34:21.335Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01QqWqmpwWqFGRLcwKv2ZLt1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018NEPRL8aEcrTiVWfntcjaq","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","old_string":"        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n                $etapa_usuario->etapa_vacante_id,\n                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n            );\n\n            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n\n            $todos_cargados = true;\n            foreach ($documentos_solicitados as $documento) {\n                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n\n                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n                    $todos_cargados = false;\n                    break;\n                }\n            }\n\n            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }\n        }","new_string":"        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n                $etapa_usuario->etapa_vacante_id,\n                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n            );\n\n            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n\n            $todos_cargados = true;\n            foreach ($documentos_solicitados as $documento) {\n                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n\n                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n                    $todos_cargados = false;\n                    break;\n                }\n            }\n\n            if ($todos_cargados && $documentos_solicitados->count() > 0 && !is_null($etapa_usuario->fecha_ejecucion)) {\n                $etapa_completada = true;\n            }\n        }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":27806,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":27806,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKM7Me9eR8S4bVUveBf2","uuid":"5482f593-74a6-438b-80c9-8b838d5f4d96"}
{"parentUuid":"5482f593-74a6-438b-80c9-8b838d5f4d96","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has not been read yet. Read it first before writing to it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_018NEPRL8aEcrTiVWfntcjaq"}]},"uuid":"e0a81e84-aa76-46b5-ba14-a8714e5063c8","timestamp":"2026-01-20T21:34:22.314Z","toolUseResult":"Error: File has not been read yet. Read it first before writing to it."}
{"parentUuid":"e0a81e84-aa76-46b5-ba14-a8714e5063c8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T21:34:25.722Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GTNnD3SofrP3eWjuxkdign","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01A7FBAGCUhRM9Mqieg29Ndy","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","offset":900,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":891,"cache_read_input_tokens":27806,"cache_creation":{"ephemeral_5m_input_tokens":891,"ephemeral_1h_input_tokens":0},"output_tokens":20,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKM8PiwGCarTJ8aJYts6","uuid":"5dacc0fd-df5e-479f-bee0-e1219d0a1a77"}
{"parentUuid":"5dacc0fd-df5e-479f-bee0-e1219d0a1a77","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01A7FBAGCUhRM9Mqieg29Ndy","type":"tool_result","content":"   900→        }\n   901→\n   902→        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n   903→            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n   904→                $etapa_usuario->etapa_vacante_id,\n   905→                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n   906→            );\n   907→\n   908→            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n   909→            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n   910→            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n   911→\n   912→            $todos_cargados = true;\n   913→            foreach ($documentos_solicitados as $documento) {\n   914→                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n   915→\n   916→                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n   917→                    $todos_cargados = false;\n   918→                    break;\n   919→                }\n   920→            }\n   921→\n   922→            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n   923→                $etapa_completada = true;\n   924→            }\n   925→        }\n   926→\n   927→        return $etapa_completada;\n   928→    }\n   929→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"288945cb-aeba-4704-bebb-7a0a38b6c42e","timestamp":"2026-01-20T21:34:26.922Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","content":"        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n                $etapa_usuario->etapa_vacante_id,\n                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n            );\n\n            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n\n            $todos_cargados = true;\n            foreach ($documentos_solicitados as $documento) {\n                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n\n                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n                    $todos_cargados = false;\n                    break;\n                }\n            }\n\n            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }\n        }\n\n        return $etapa_completada;\n    }\n","numLines":30,"startLine":900,"totalLines":1346}}}
{"parentUuid":"288945cb-aeba-4704-bebb-7a0a38b6c42e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T21:34:30.992Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Mp5rJ3uzaVqmRpp5EFchDg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017H7b1DtMMoMyjCsnzQVLmz","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","old_string":"            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }","new_string":"            if ($todos_cargados && $documentos_solicitados->count() > 0 && !is_null($etapa_usuario->fecha_ejecucion)) {\n                $etapa_completada = true;\n            }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":651,"cache_read_input_tokens":28697,"cache_creation":{"ephemeral_5m_input_tokens":651,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKM8jECbnZ3uEHonrBF7","uuid":"a0ecaafa-3e38-460e-8f2e-4e4fff14cf28"}
{"parentUuid":"a0ecaafa-3e38-460e-8f2e-4e4fff14cf28","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017H7b1DtMMoMyjCsnzQVLmz","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   918→                    break;\n   919→                }\n   920→            }\n   921→\n   922→            if ($todos_cargados && $documentos_solicitados->count() > 0 && !is_null($etapa_usuario->fecha_ejecucion)) {\n   923→                $etapa_completada = true;\n   924→            }\n   925→        }\n   926→\n   927→        return $etapa_completada;\n   928→    }"}]},"uuid":"5dbddcc6-9241-41e1-93e9-2401e1221ac6","timestamp":"2026-01-20T21:36:09.029Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","oldString":"            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }","newString":"            if ($todos_cargados && $documentos_solicitados->count() > 0 && !is_null($etapa_usuario->fecha_ejecucion)) {\n                $etapa_completada = true;\n            }","originalFile":"<?php\n\nnamespace App\\Http\\Services\\Vacantes;\n\nuse App\\Traits\\IATrait;\nuse App\\Traits\\StringTrait;\nuse Illuminate\\Support\\Arr;\nuse App\\Traits\\ArchivoTrait;\nuse Illuminate\\Http\\Request;\nuse App\\Models\\Vacantes\\Vacante;\nuse App\\Http\\Services\\BaseService;\nuse App\\Models\\Agendas\\EstadoAgenda;\nuse Illuminate\\Support\\Facades\\Auth;\nuse Illuminate\\Support\\Facades\\Mail;\nuse App\\Models\\Vacantes\\EtapaVacante;\nuse App\\Models\\Vacantes\\EstadoVacante;\nuse App\\Models\\Vacantes\\MovimientoVacante;\nuse App\\Mail\\NotificarFinalizacionEtapaMail;\nuse App\\Mail\\NotificarPostulanteVacanteMail;\nuse App\\Models\\Vacantes\\EtapaVacanteUsuario;\nuse Illuminate\\Http\\Client\\RequestException;\nuse App\\Http\\Services\\Vacantes\\VacanteService;\nuse App\\Models\\Configuraciones\\PlantillaCorreo;\nuse Illuminate\\Http\\Client\\ConnectionException;\nuse App\\Http\\Repositories\\Usuarios\\UserRepository;\nuse App\\Http\\Services\\Usuarios\\TokenAccesoService;\nuse App\\Http\\Repositories\\Agendas\\AgendaRepository;\nuse App\\Http\\Services\\Vacantes\\EtapaVacanteService;\nuse App\\Jobs\\Vacantes\\ProcesarVideoentrevistaIAJob;\nuse App\\Http\\Repositories\\Procesos\\ProcesoRepository;\nuse App\\Http\\Repositories\\Vacantes\\VacanteRepository;\nuse App\\Http\\Services\\Agendas\\ResultadoAgendaService;\nuse App\\Http\\Services\\Configuraciones\\ArchivoService;\nuse App\\Notifications\\NotificarAvanceProcesoNotification;\nuse App\\Http\\Repositories\\Vacantes\\EtapaVacanteRepository;\nuse App\\Http\\Repositories\\Vacantes\\TranscripcionRepository;\nuse App\\Http\\Repositories\\Configuraciones\\ArchivoRepository;\nuse App\\Http\\Repositories\\Empresas\\EmpresaUsuarioRepository;\nuse App\\Http\\Repositories\\Vacantes\\AspectoPuntajeRepository;\nuse App\\Http\\Services\\Configuraciones\\PlantillaCorreoService;\nuse App\\Http\\Repositories\\Vacantes\\FormatoEntrevistaRepository;\nuse App\\Http\\Repositories\\Vacantes\\EtapaVacanteUsuarioRepository;\nuse App\\Http\\Services\\Configuraciones\\ConfiguracionModeloService;\nuse App\\Http\\Repositories\\Vacantes\\EtapaMovimientoVacanteRepository;\nuse App\\Http\\Repositories\\OfertasLaborales\\PreguntaOfertaLaboralRepository;\nuse App\\Http\\Repositories\\Usuarios\\PerfilesLaborales\\PerfilLaboralRepository;\nuse App\\Http\\Repositories\\OfertasLaborales\\PuntajePreguntaOfertaLaboralRepository;\n\n/**\n * @property EtapaVacanteUsuarioRepository $repositorio\n */\nclass EtapaVacanteUsuarioService extends BaseService\n{\n    use ArchivoTrait, IATrait, StringTrait;\n\n    /**\n     * @var float|int $puntaje_total Puntaje total, utilizado para la adecuación de HV.\n     */\n    private $puntaje_total = 0;\n\n    /**\n     * @var float $puntaje Puntaje de aspecto, utilizado para la adecuación de HV.\n     */\n    private $puntaje = 0;\n\n    /**\n     * @var bool $cumple Indica si cumple con el aspecto, utilizada para la adecuación de HV.\n     */\n    private $cumple = false;\n\n    /**\n     * Constructor.\n     *\n     * @param EtapaVacanteUsuarioRepository $repositorio Repositorio de etapas de vacantes de usuarios.\n     * @param PerfilLaboralRepository $perfil_laboral_repositorio Repositorio de perfiles laborales.\n     * @param EtapaVacanteRepository $etapa_vacante_repositorio Repositorio de etapas de vacantes.\n     * @param AspectoPuntajeRepository $aspecto_puntaje_repositorio Repositorio de puntajes de aspectos.\n     * @param ArchivoService $archivo_servicio Servicio de archivos.\n     * @param ArchivoRepository $archivo_repositorio Repositorio de archivos.\n     * @param EmpresaUsuarioRepository $empresa_usuario_repositorio Repositorio de usuarios de empresas.\n     * @param PreguntaOfertaLaboralRepository $pregunta_oferta_laboral_repositorio Repositorio de preguntas de ofertas laborales.\n     * @param PuntajePreguntaOfertaLaboralRepository $puntaje_pregunta_oferta_laboral_repositorio Repositorio de puntajes de preguntas de ofertas laborales.\n     * @param EtapaMovimientoVacanteRepository $etapa_movimiento_vacante_repositorio Repositorio de movimientos de etapas de vacantes.\n     * @param ProcesoRepository $proceso_repositorio Repositorio de procesos.\n     * @param TranscripcionRepository $transcripcion_repositorio Repositorio de transcripciones.\n     * @param PlantillaCorreoService $plantilla_correo_servicio Servicio de plantillas de correo.\n     * @param TokenAccesoService $token_acceso_servicio Servicio de tokens de acceso.\n     * @param UserRepository $usuario_repositorio Servicio de usuarios.\n     * @param VacanteRepository $vacante_repositorio Repositorio de vacantes.\n     * @param AgendaRepository $agenda_repositorio Repositorio de agendas.\n     * @param ResultadoAgendaService $resultado_agenda_servicio Servicio de resultados de agendas.\n     * @param ConfiguracionModeloService $configuracion_modelo_servicio Servicio de configuraciones de modelos.\n     * @param FormatoEntrevistaRepository $formato_entrevista_repositorio Repositorio de formatos de entrevista.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function __construct(\n        EtapaVacanteUsuarioRepository $repositorio,\n        protected PerfilLaboralRepository $perfil_laboral_repositorio,\n        protected EtapaVacanteRepository $etapa_vacante_repositorio,\n        protected AspectoPuntajeRepository $aspecto_puntaje_repositorio,\n        protected ArchivoService $archivo_servicio,\n        protected ArchivoRepository $archivo_repositorio,\n        protected EmpresaUsuarioRepository $empresa_usuario_repositorio,\n        protected PreguntaOfertaLaboralRepository $pregunta_oferta_laboral_repositorio,\n        protected PuntajePreguntaOfertaLaboralRepository $puntaje_pregunta_oferta_laboral_repositorio,\n        protected EtapaMovimientoVacanteRepository $etapa_movimiento_vacante_repositorio,\n        protected ProcesoRepository $proceso_repositorio,\n        protected TranscripcionRepository $transcripcion_repositorio,\n        protected PlantillaCorreoService $plantilla_correo_servicio,\n        protected TokenAccesoService $token_acceso_servicio,\n        protected UserRepository $usuario_repositorio,\n        protected VacanteRepository $vacante_repositorio,\n        protected AgendaRepository $agenda_repositorio,\n        protected ResultadoAgendaService $resultado_agenda_servicio,\n        protected ConfiguracionModeloService $configuracion_modelo_servicio,\n        protected FormatoEntrevistaRepository $formato_entrevista_repositorio\n    ) {\n        parent::__construct($repositorio);\n    }\n\n    /**\n     * Guardar documento solicitado de una etapa de vacante de usuario.\n     *\n     * @param Request $request Contenido de la petición.\n     * @return void\n     * @author Andres Gonzalez\n     */\n    public function guardarDocumentoSolicitado(Request $request): void { \n        $empresa = $this->empresa_usuario_repositorio->obtenerEmpresaActualUsuario();\n\n        if ($request->hasFile('archivo')) {\n            $this->archivo_servicio->guardarVarios(EtapaVacanteUsuario::class, $request->etapa_vacante_usuario_id, [$request->nombre_documento => $request->file('archivo')], 'empresas/' . $empresa->id . '/documentos-solicitados', true);\n\n            // Actualizar fecha de ejecución de la etapa\n            $this->repositorio->actualizar($request->etapa_vacante_usuario_id, ['fecha_ejecucion' => now()]);\n        }\n    }\n\n    /**\n     * Establecer valores para puntaje y cumplimiento de un aspecto.\n     *\n     * @param float $puntaje Puntaje obtenido.\n     * @param bool $cumple Indica si cumple.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    private function establecerPuntajeCumplimiento(float $puntaje = 0, bool $cumple = false): void {\n        $this->puntaje = $puntaje;\n        $this->cumple  = $cumple;\n    }\n\n    /**\n     * Guardar puntaje de un aspecto evaluado.\n     *\n     * @param int $etapa_vacante_usuario_id ID de la etapa del usuario en la vacante.\n     * @param string $categoria Categoría del aspecto.\n     * @param string $aspecto Aspecto evaluado.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    private function guardarAspectoPuntaje(int $etapa_vacante_usuario_id, string $categoria, string $aspecto): void {\n        $this->aspecto_puntaje_repositorio->crearOActualizar([\n            'etapa_vacante_usuario_id' => $etapa_vacante_usuario_id,\n            'categoria'                => $categoria,\n            'aspecto'                  => $aspecto\n        ], [\n            'puntaje'                  => $this->puntaje,\n            'cumple'                   => $this->cumple\n        ]);\n\n        $this->puntaje_total += $this->puntaje;\n        $this->establecerPuntajeCumplimiento();\n    }\n\n    /**\n     * Generar adecuación de hoja de vida.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function generarAdecuacionHV(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::REVISION_HV_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje)) {\n            $perfil_laboral = $this->perfil_laboral_repositorio->getUnoAvanzado(new Request([\n                'usuario_id'                     => $etapa_usuario->usuario_id,\n                'incluir_experiencias_laborales' => true,\n                'incluir_estudios'               => true,\n                'incluir_idiomas'                => true,\n                'incluir_usuario'                => true\n            ]));\n\n            // Generar y guardar la adecuación del perfil de candidato (habilidades y herramientas tecnológicas)\n            $categoria            = 'perfil';\n            $puntaje_aspecto      = 100 / 2;\n            $datos_vacante        = $etapa_usuario->vacante->datos;\n            $habilidades_vacante  = $datos_vacante->where('llave', 'habilidades')->first();\n            $herramientas_vacante = $datos_vacante->where('llave', 'herramientas_tecnologicas')->first();\n\n            // Validar coincidencia para las habilidades\n            if (!is_null($habilidades_vacante->valor) && !empty($habilidades_vacante->valor)) {\n                $habilidades_vacante        = array_map(fn($item) => trim($item), explode(',', $habilidades_vacante->valor));\n                $habilidades_perfil_laboral = array_map(fn($item) => trim($item), explode(',', $perfil_laboral->habilidades));\n                $coincidencias              = count(array_uintersect($habilidades_vacante, $habilidades_perfil_laboral, 'strcasecmp'));\n\n                if ($coincidencias >= count($habilidades_vacante)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'habilidades');\n\n            // Validar coincidencia para las herramientas tecnológicas\n            if (!is_null($herramientas_vacante->valor) && !empty($herramientas_vacante->valor)) {\n                $herramientas_vacante        = array_map(fn($item) => trim($item), explode(',', $herramientas_vacante->valor));\n                $herramientas_perfil_laboral = array_map(fn($item) => trim($item), explode(',', $perfil_laboral->herramientas_tecnologicas));\n                $coincidencias               = count(array_uintersect($herramientas_vacante, $herramientas_perfil_laboral, 'strcasecmp'));\n\n                if ($coincidencias >= count($herramientas_vacante)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'herramientas');\n\n            // Generar y guardar la adecuación de requisitos del candidato (género, edad, nivel educativo, modalidad de trabajo, salario, experiencia, idiomas, licencia de conducir)\n            $categoria       = 'requisito';\n            $puntaje_aspecto = 100 / 8;\n\n            // Validar coincidencia de género\n            $genero_vacante = $datos_vacante->where('llave', 'genero')->first();\n\n            if (!is_null($genero_vacante) && !empty($genero_vacante)) {\n                if ($genero_vacante->valor === mb_convert_case($perfil_laboral->usuario->genero->nombre, MB_CASE_LOWER)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                } elseif ($genero_vacante->valor === 'indiferente') {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'genero');\n\n            // Validar coincidencia de edad\n            $edad_minima_vacante = $datos_vacante->where('llave', 'edad_minima')->first();\n            $edad_maxima_vacante = $datos_vacante->where('llave', 'edad_maxima')->first();\n\n            if (empty($edad_minima_vacante->valor) || empty($edad_maxima_vacante->valor)) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif ($perfil_laboral->usuario->edad >= $edad_minima_vacante->valor && $perfil_laboral->usuario->edad <= $edad_maxima_vacante->valor) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'edad');\n\n            // Validar coincidencia de nivel educativo\n            $nivel_educativo_vacante = $datos_vacante->where('llave', 'nivel_educativo')->first();\n            $escala_estudios         = [\n                'Preescolar'                      => 1,\n                'Primaria'                        => 2,\n                'Secundaria básica'               => 3,\n                'Secundaria superior'             => 4,\n                'Educación continua y permanente' => 5,\n                'Técnico'                         => 6,\n                'Tecnólogo'                       => 7,\n                'Profesional'                     => 8,\n                'Especialización (postgrado)'     => 9,\n                'Maestría (postgrado)'            => 10,\n                'Doctorado (postgrado)'           => 11\n            ];\n\n            if (empty($nivel_educativo_vacante->valor) || $nivel_educativo_vacante->valor === 'indiferente') {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif (count($perfil_laboral->estudios) > 0) {\n                $cumple_nivel_educativo = false;\n\n                foreach ($perfil_laboral->estudios as $estudio) {\n                    if ($escala_estudios[$nivel_educativo_vacante->valor] <= $escala_estudios[$estudio->nivelEducativo->nombre]) {\n                        $cumple_nivel_educativo = true;\n                        break;\n                    }\n                }\n\n                if ($cumple_nivel_educativo) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'estudios');\n\n            // Validar coincidencia de modalidad de trabajo\n            if (!is_null($etapa_usuario->vacante->modalidad_trabajo_id)) {\n                if ($etapa_usuario->vacante->modalidad_trabajo_id === $perfil_laboral->modalidad_trabajo_id) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'modalidad_trabajo');\n\n            // Validar coincidencia de salario\n            if (is_null($etapa_usuario->vacante->salario)) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif (!is_null($etapa_usuario->vacante->salario) && is_null($etapa_usuario->vacante->salario_maximo)) {\n                // Salario fijo\n                if (!is_null($perfil_laboral->salario_maximo)) {\n                    // Validar cuando el salario de la vacante es fijo pero el del usuario es rango\n                    if (($etapa_usuario->vacante->salario >= $perfil_laboral->salario && $etapa_usuario->vacante->salario <= $perfil_laboral->salario_maximo) || ($perfil_laboral->salario <= $etapa_usuario->vacante->salario && $perfil_laboral->salario_maximo <= $etapa_usuario->vacante->salario)) {\n                        $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                    }\n                } elseif ($perfil_laboral->salario <= $etapa_usuario->vacante->salario) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } elseif (!is_null($etapa_usuario->vacante->salario) && !is_null($etapa_usuario->vacante->salario_maximo)) {\n                // Rango de salario\n                if (!is_null($perfil_laboral->salario_maximo)) {\n                    // Validar cuando el salario del usuario y de la vacante son rangos\n                    if (($perfil_laboral->salario >= $etapa_usuario->vacante->salario && $perfil_laboral->salario <= $etapa_usuario->vacante->salario_maximo) || ($perfil_laboral->salario_maximo >= $etapa_usuario->vacante->salario && $perfil_laboral->salario_maximo <= $etapa_usuario->vacante->salario_maximo)) {\n                        $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                    }\n                } else {\n                    if ($perfil_laboral->salario >= $etapa_usuario->vacante->salario && $perfil_laboral->salario <= $etapa_usuario->vacante->salario_maximo) {\n                        $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                    }\n                }\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'salario');\n\n            // Validar coincidencia de experiencia\n            $experiencia_vacante   = $datos_vacante->where('llave', 'experiencia_laboral')->first();\n            $experiencia_aplicante = $perfil_laboral->experienciasLaborales->sum('tiempo');\n            $experiencias          = [\n                '1 año'        => 1,\n                '2 años'       => 2,\n                '3 años'       => 3,\n                '4 años'       => 4,\n                '5 años o más' => 5\n            ];\n\n            if (empty($experiencia_vacante->valor) || $experiencia_vacante->valor === 'Sin experiencia') {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif ($experiencia_vacante->valor === 'Menos de 1 año') {\n                if ($experiencia_aplicante > 0 && $experiencia_aplicante < 365) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } elseif (($experiencias[$experiencia_vacante->valor] * 365) <= $experiencia_aplicante) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'experiencia');\n\n            // Validar coincidencia de idiomas\n            $idiomas_vacante = $etapa_usuario->vacante->idiomas;\n            $escala_idiomas  = [\n                'A1' => 1,\n                'A2' => 2,\n                'B1' => 3,\n                'B2' => 4,\n                'C1' => 5,\n                'C2' => 6\n            ];\n\n            if ($idiomas_vacante->count() > 0) {\n                $coincidencias_idiomas = 0;\n\n                if ($perfil_laboral->idiomas->count() > 0) {\n                    foreach ($idiomas_vacante as $idioma) {\n                        foreach ($perfil_laboral->idiomas as $idioma_perfil) {\n                            if ($idioma->idioma_id === $idioma_perfil->idioma_id && $escala_idiomas[$idioma->nivel] <= $escala_idiomas[$idioma_perfil->nivel]) {\n                                $coincidencias_idiomas++;\n                            }\n                        }\n                    }\n                }\n\n                if ($coincidencias_idiomas >= $idiomas_vacante->count()) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'idiomas');\n\n            // Validar coincidencia de licencia de conducir\n            $licencia_conducir_vacante = $datos_vacante->where('llave', 'licencia_conducir')->first();\n            $escala_licencias          = [\n                'A1' => 1,\n                'A2' => 2,\n                'B1' => 3,\n                'B2' => 4,\n                'B3' => 5,\n                'C1' => 6,\n                'C2' => 7,\n                'C3' => 8\n            ];\n\n            if (empty($licencia_conducir_vacante->valor)) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif (is_null($perfil_laboral->licencia_conducir)) {\n                if (empty($licencia_conducir_vacante->valor)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } elseif ($escala_licencias[$licencia_conducir_vacante->valor] <= $escala_licencias[$perfil_laboral->licencia_conducir]) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'licencia_conducir');\n\n            $puntaje_total = round($this->puntaje_total / 2); // Se divide entre las dos categorías existentes\n            $this->gestionarContinuidadAplicante($etapa_usuario, MovimientoVacante::REVISION_HV_ID, $puntaje_total, 'descartar_candidatos_adecuaciones_bajas_hv', 'descartar_candidatos_adecuaciones_medias_hv');\n        }\n    }\n\n    /**\n     * Generar adecuación para preguntas prefiltro.\n     *\n     * Califica las respuestas del aplicante en cada una de las preguntas y calcula la adecuación en base a sus resultados.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function generarAdecuacionPrefiltro(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje)) {\n            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n                'etapa_vacante_id'   => $etapa_usuario->etapa_vacante_id,\n                'usuario_id'         => $etapa_usuario->usuario_id,\n                'incluir_respuestas' => true\n            ]));\n\n            $porcentaje_pregunta  = 100 / $preguntas->count();\n            $respuestas_correctas = 0;\n\n            foreach ($preguntas as $pregunta) {\n                $puntaje    = null;\n                $puntaje_ia = null;\n\n                if ($pregunta->es_abierta) {\n                    $respuesta = $opcion_seleccionada = $pregunta->respuestas->first();\n\n                    if (!is_null($respuesta)) {\n                        try {\n                            $peticion_ia = $this->realizarPeticionIA(\n                                ruta: 'calificar-pregunta-abierta',\n                                parametros: [\n                                    'pregunta'  => $pregunta->enunciado,\n                                    'respuesta' => $respuesta->respuesta,\n                                ],\n                                contexto_tracking: [\n                                    'vacante_id' => $etapa_usuario->etapa->vacante_id ?? null,\n                                    'agenda_id' => null,\n                                ]\n                            );\n\n                            if (!is_null($peticion_ia) && $peticion_ia['status_code'] === 200) {\n                                $puntaje_ia = $peticion_ia['calificacion'];\n                            }\n                        } catch (RequestException|ConnectionException $error) {}\n                    }\n                } else {\n                    $opciones_correctas = $pregunta->opciones->where('es_correcta', true);\n\n                    // Selección única\n                    if ($opciones_correctas->count() === 1) {\n                        $opcion_correcta     = $opciones_correctas->first();\n                        $opcion_seleccionada = $pregunta->respuestas->first();\n                        $puntaje             = (int) (!is_null($opcion_seleccionada) && $opcion_correcta->id === $opcion_seleccionada->opcion_pregunta_id);\n                    } else { // Selección múltiple\n                        $opciones_correctas     = $opciones_correctas->pluck('id')->toArray();\n                        $opciones_seleccionadas = $pregunta->respuestas->pluck('opcion_pregunta_id')->toArray();\n                        $aciertos               = count(array_intersect($opciones_seleccionadas, $opciones_correctas));\n                        $fallos                 = count(array_diff($opciones_seleccionadas, $opciones_correctas));\n                        $puntaje                = (int) ($aciertos - $fallos === count($opciones_correctas));\n                    }\n                }\n\n                // Guardar el puntaje obtenido en cada pregunta\n                $this->puntaje_pregunta_oferta_laboral_repositorio->crearSiNoExiste([\n                    'pregunta_id' => $pregunta->id,\n                    'usuario_id'  => $etapa_usuario->usuario_id\n                ], [\n                    'puntaje'     => $puntaje,\n                    'puntaje_ia'  => $puntaje_ia\n                ]);\n\n                // Sumar el puntaje total\n                if (is_null($puntaje) && !is_null($puntaje_ia)) {\n                    $respuestas_correctas += $puntaje_ia;\n                } else {\n                    $respuestas_correctas += $puntaje;\n                }\n            }\n\n            $puntaje_etapa = $respuestas_correctas * $porcentaje_pregunta;\n\n            if ($etapa_usuario->vacante->automatizar_etapas) {\n                // Obtener el movimiento de la etapa con sus configuraciones\n                $etapa_movimiento = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n                    'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n                    'movimiento_vacante_id'   => MovimientoVacante::PREGUNTAS_PREFILTRO_ID,\n                    'incluir_configuraciones' => true\n                ]));\n\n                $configuracion_preguntas_correctas = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', 'descartar_candidatos_respondieron_menos_preguntas_prefiltro')->first();\n\n                // Avanzar al aplicante de etapa o descartarlo según la configuración de la etapa\n                if (!is_null($configuracion_preguntas_correctas) && $configuracion_preguntas_correctas->valor <= $respuestas_correctas) {\n                    $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje_etapa);\n                } else {\n                    $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje_etapa, descartar: true);\n                }\n            } else {\n                $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje_etapa]);\n            }\n        }\n    }\n\n    /**\n     * Guardar el puntaje de adecuación dado por el reclutador.\n     *\n     * Guarda la adecuación para las etapas de prueba técnica, videoentrevista y entrevista.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @param int $puntaje Puntaje dado por el reclutador.\n     * @param bool $forzar_actualizacion Si es true, omite la validación de puntaje nulo.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function guardarPuntajeAdecuacionReclutador(int $id, int $puntaje, bool $forzar_actualizacion = false): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        if ($etapa_usuario->activo && ($forzar_actualizacion || is_null($etapa_usuario->puntaje))) {\n            if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n                $this->gestionarContinuidadAplicante($etapa_usuario, MovimientoVacante::PRUEBA_TECNICA_ID, $puntaje, 'descartar_candidatos_adecuaciones_bajas_prueba_tecnica', 'descartar_candidatos_adecuaciones_medias_prueba_tecnica');\n            }\n\n            if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::VIDEO_ENTREVISTA_NOMBRE, EtapaVacante::ENTREVISTA_NOMBRE])) {\n                if ($etapa_usuario->etapa->nombre === EtapaVacante::VIDEO_ENTREVISTA_NOMBRE) {\n                    $movimiento_vacante_id                   = MovimientoVacante::SOLICITUD_VIDEOENTREVISTA_ID;\n                    $llave_configuracion_formato             = 'solicitar_formato_videoentrevista';\n                    $llave_configuracion_adecuaciones_bajas  = 'descartar_candidatos_adecuaciones_bajas_videoentrevista';\n                    $llave_configuracion_adecuaciones_medias = 'descartar_candidatos_adecuaciones_medias_videoentrevista';\n                } else {\n                    $movimiento_vacante_id                   = MovimientoVacante::SOLICITUD_ENTREVISTA_ID;\n                    $llave_configuracion_formato             = 'solicitar_formato_entrevista';\n                    $llave_configuracion_adecuaciones_bajas  = 'descartar_candidatos_adecuaciones_bajas_entrevista';\n                    $llave_configuracion_adecuaciones_medias = 'descartar_candidatos_adecuaciones_medias_entrevista';\n                }\n\n                if ($this->verificarFormatoEntrevista($etapa_usuario, $movimiento_vacante_id, $llave_configuracion_formato)) {\n                    $this->gestionarContinuidadAplicante($etapa_usuario, $movimiento_vacante_id, $puntaje, $llave_configuracion_adecuaciones_bajas, $llave_configuracion_adecuaciones_medias);\n                } else {\n                    $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje]);\n                }\n\n                // TODO: Invocar esta función al momento de completar el formato de entrevista\n            }\n        }\n    }\n\n    /**\n     * Generar adecuación para pruebas psicométricas.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function generarAdecuacionPruebasPsicometricas(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje)) {\n            $indice_talento = $this->proceso_repositorio->obtenerIndiceTalento($etapa_usuario->vacante->proceso->id, $etapa_usuario->usuario_id)->indice_talento;\n\n            if ($indice_talento >= 0) {\n                $this->gestionarContinuidadAplicante($etapa_usuario, MovimientoVacante::PRUEBAS_PSICOMETRICAS_ID, $indice_talento, 'descartar_candidatos_puntuaciones_bajas', 'descartar_candidatos_puntuaciones_medias', true);\n            }\n        }\n    }\n\n    /**\n     * Generar adecuación para videoentrevista.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function generarAdecuacionVideoentrevista(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::VIDEO_ENTREVISTA_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje_ia)) {\n            ProcesarVideoentrevistaIAJob::dispatch($etapa_usuario);\n        }\n    }\n\n    /**\n     * Verificar si la etapa tiene activado el formato de entrevista y si ya está diligenciado por parte del aplicante.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa del usuario en la vacante.\n     * @param int $movimiento_vacante_id ID del movimiento de la vacante.\n     * @param string $llave_configuracion Llave de configuración para formato de entrevista.\n     * @return bool Devuelve true cuando no existe la configuración, está deshabilitada o ya haya sido completada por el aplicante, false en caso de estar habilitada pero no completada por el aplicante.\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function verificarFormatoEntrevista(EtapaVacanteUsuario $etapa_usuario, int $movimiento_vacante_id, string $llave_configuracion): bool {\n        $formato_diligenciado = false;\n        $etapa_movimiento     = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n            'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n            'movimiento_vacante_id'   => $movimiento_vacante_id,\n            'incluir_configuraciones' => true\n        ]));\n\n        $configuracion_formato_entrevista = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_configuracion)->first();\n\n        if (!is_null($configuracion_formato_entrevista) && (bool) $configuracion_formato_entrevista->valor) {\n            if ($movimiento_vacante_id == MovimientoVacante::SOLICITUD_VIDEOENTREVISTA_ID) {\n                $formato_entrevista = $this->formato_entrevista_repositorio->getUnoAvanzado(new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id]));\n\n                if (!is_null($formato_entrevista) && !is_null($formato_entrevista->descripcion_vacante) && !empty($formato_entrevista->descripcion_vacante)) {\n                    $formato_diligenciado = true;\n                }\n            } else {\n                $formato_diligenciado = $this->verificarEtapaCompletada($etapa_usuario->id);\n            }\n        } else {\n            $formato_diligenciado = true;\n        }\n\n        return $formato_diligenciado;\n    }\n\n    /**\n     * Recalcular adecuación para preguntas prefiltro sin utilizar IA.\n     *\n     * @param int $etapa_vacante_id ID de la etapa de la vacante.\n     * @param int $usuario_id ID del usuario (aplicante).\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function recalcularAdecuacionPrefiltro(int $etapa_vacante_id, int $usuario_id): void {\n        $etapa_usuario = $this->repositorio->getUnoAvanzado(new Request([\n            'etapa_vacante_id' => $etapa_vacante_id,\n            'usuario_id'       => $usuario_id\n        ]));\n\n        if ($etapa_usuario->activo) {\n            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n                'etapa_vacante_id' => $etapa_usuario->etapa_vacante_id,\n                'usuario_id'       => $etapa_usuario->usuario_id,\n                'incluir_puntajes' => true\n            ]));\n\n            $puntaje            = 0;\n            $puntaje_individual = 100 / $preguntas->count();\n\n            foreach ($preguntas as $pregunta) {\n                if (is_null($pregunta->puntajes[0]->puntaje) && !is_null($pregunta->puntajes[0]->puntaje_ia)) {\n                    $puntaje += $pregunta->puntajes[0]->puntaje_ia;\n                } elseif (!is_null($pregunta->puntajes[0]->puntaje)) {\n                    $puntaje += $pregunta->puntajes[0]->puntaje;\n                }\n            }\n\n            $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje_individual * $puntaje]);\n        }\n    }\n\n    /**\n     * Guardar el puntaje de la etapa actual y gestionar la continuidad del aplicante en la vacante.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param int $movimiento_vacante_id ID del movimiento de la vacante.\n     * @param int $puntaje Puntaje obtenido en la etapa actual.\n     * @param string $llave_puntajes_bajos Llave de configuración para puntajes bajos.\n     * @param string $llave_puntajes_medios Llave de configuración para puntajes medios.\n     * @param bool $escala_pruebas_psicometricas Indica si debe utilizar la escala de puntajes de pruebas psicométricas.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function gestionarContinuidadAplicante(EtapaVacanteUsuario $etapa_usuario, int $movimiento_vacante_id, int $puntaje, string $llave_puntajes_bajos, string $llave_puntajes_medios, bool $escala_pruebas_psicometricas = false) {\n        if ($etapa_usuario->vacante->automatizar_etapas) {\n            $calificacion_baja  = 40;\n            $calificacion_media = 70;\n\n            if ($escala_pruebas_psicometricas) {\n                $calificacion_baja  = 59;\n                $calificacion_media = 75;\n            }\n\n            // Obtener el movimiento de la etapa con sus configuraciones\n            $etapa_movimiento = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n                'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n                'movimiento_vacante_id'   => $movimiento_vacante_id,\n                'incluir_configuraciones' => true\n            ]));\n\n            $configuracion_adecuaciones_bajas  = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_bajos)->first();\n            $configuracion_adecuaciones_medias = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_medios)->first();\n\n            if (!is_null($configuracion_adecuaciones_medias) && filter_var($configuracion_adecuaciones_medias->valor, FILTER_VALIDATE_BOOLEAN) && $puntaje <= $calificacion_media) {\n                $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje, descartar: true);\n                return;\n            } elseif (!is_null($configuracion_adecuaciones_bajas) && filter_var($configuracion_adecuaciones_bajas->valor, FILTER_VALIDATE_BOOLEAN) && $puntaje <= $calificacion_baja) {\n                $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje, descartar: true);\n                return;\n            }\n\n            $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje);\n        } else {\n            $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje]);\n        }\n    }\n\n    /**\n     * Guardar puntaje de la etapa actual y mover al aplicante a la siguiente etapa.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param ?int $puntaje Puntaje obtenido en la etapa actual.\n     * @param ?int $puntaje_ia Puntaje obtenido por la IA en la etapa actual.\n     * @param ?string $notas_ia Notas dadas por la IA para la etapa actual.\n     * @param bool $descartar Indica si la etapa a la que se debe cambiar es 'descartados'.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     * @author Esperanza Olivo\n     */\n    public function guardarPuntajeYCambiarDeEtapa(EtapaVacanteUsuario $etapa_usuario, ?int $puntaje = null, ?int $puntaje_ia = null, ?string $notas_ia = null, bool $descartar = false): void {\n        if ($descartar) {\n            $etapa_siguiente = $this->etapa_vacante_repositorio->getUnoAvanzado(new Request(['vacante_id' => $etapa_usuario->vacante->id, 'nombre' => EtapaVacante::DESCARTADOS_NOMBRE]));\n        } else {\n            $etapa_siguiente = $this->etapa_vacante_repositorio->obtenerEtapaSiguiente($etapa_usuario->vacante->id, $etapa_usuario->etapa->orden);\n        }\n\n        $etapa_actual_activa = true;\n\n        if ($etapa_siguiente->nombre !== EtapaVacante::CONTRATADOS_NOMBRE) {\n            $etapa_actual_activa = false;\n            $this->guardarEtapa($etapa_usuario, $etapa_siguiente);\n        } elseif (!$etapa_usuario->vacante->automatizar_etapas) {\n            $etapa_actual_activa = false;\n            $this->guardarEtapa($etapa_usuario, $etapa_siguiente);\n        }\n\n        $this->repositorio->actualizar($etapa_usuario->id, [\n            'puntaje'    => $puntaje,\n            'puntaje_ia' => $puntaje_ia,\n            'notas_ia'   => $notas_ia,\n            'activo'     => $etapa_actual_activa\n        ]);\n\n        // Cuando la etapa es contratado, se valida si ya se han completado las vacantes requeridas para cerrar la vacante\n        if ($etapa_siguiente->nombre === EtapaVacante::CONTRATADOS_NOMBRE) {\n            if ($etapa_usuario->vacante->cantidad_vacantes === $this->repositorio->contarContratados($etapa_usuario->etapa->vacante_id)) {\n                $this->vacante_repositorio->actualizar($etapa_usuario->etapa->vacante_id, ['estado_id' => EstadoVacante::COMPLETADA_ID]);\n\n                $aplicantes_activos_restantes_ids = $this->repositorio->getTodo(new Request([\n                    'vacante_id'             => $etapa_usuario->etapa->vacante_id,\n                    'activo'                 => true,\n                    'excluir_etapas'         => [EtapaVacante::DESCARTADOS_NOMBRE, EtapaVacante::CONTRATADOS_NOMBRE]\n                ]))->pluck('id')->toArray();\n\n                // Descartar a los aplicantes que quedan activos en la vacante\n                $this->descartarAplicantesManual($aplicantes_activos_restantes_ids);\n\n                $aplicantes_activos_sin_notificar = $this->repositorio->getTodo(new Request([\n                    'vacante_id'             => $etapa_usuario->etapa->vacante_id,\n                    'activo'                 => true,\n                    'sin_fecha_notificacion' => true\n                ]));\n\n                foreach ($aplicantes_activos_sin_notificar as $aplicante) {\n                    $this->notificarCambioEtapa($aplicante, false);\n                }\n            }\n        }\n    }\n    \n    /**\n     * Crear y activar la siguiente etapa del aplicante.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param EtapaVacante $etapa_siguiente Etapa siguiente a crear.\n     * @return ?EtapaVacanteUsuario\n     * @author Esperanza Olivo\n     */\n    public function guardarEtapa(EtapaVacanteUsuario $etapa_usuario, EtapaVacante $etapa_siguiente): ?EtapaVacanteUsuario {\n        $nueva_etapa_usuario = $this->repositorio->crear([\n            'usuario_id'       => $etapa_usuario->usuario_id,\n            'etapa_vacante_id' => $etapa_siguiente->id,\n            'activo'           => true\n        ]);\n\n        app(VacanteService::class)->crearAgendasPruebasPsicometricas($etapa_usuario, $etapa_siguiente->id);\n\n        if ($nueva_etapa_usuario) {\n            $this->notificarCambioEtapa($nueva_etapa_usuario);\n        }\n\n        return $nueva_etapa_usuario;\n    }\n\n    /**\n     * Obtener la adecuación actual del usuario en la vacante.\n     *\n     * @param int $usuario_id ID del usuario.\n     * @param int $vacante_id ID de la vacante.\n     * @return ?int\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function obtenerAdecuacionUsuario(int $usuario_id, int $vacante_id): ?int {\n        $etapas     = $this->repositorio->obtenerEtapasCompletadasUsuario($usuario_id, $vacante_id);\n        $adecuacion = 0;\n\n        foreach ($etapas as $etapa) {\n            if (!is_null($etapa->puntaje)) {\n                $adecuacion += $etapa->puntaje;\n            } elseif (is_null($etapa->puntaje) && !is_null($etapa->puntaje_ia)) {\n                $adecuacion += $etapa->puntaje_ia;\n            }\n        }\n\n        return ($etapas->count() > 0) ? $adecuacion / $etapas->count() : null;\n    }\n\n    /**\n     * Verificar si una etapa ya ha sido completada por el aplicante.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante (etapa_vacante_usuario_id).\n     * @return bool\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function verificarEtapaCompletada(int $id): bool {\n        $etapa_usuario    = $this->repositorio->getUno($id);\n        $etapa_completada = false;\n\n        // Verificar si la etapa de revisión de hoja de vida ya fue completada\n        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::REVISION_HV_NOMBRE, EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE]) && !is_null($etapa_usuario->puntaje) || !is_null($etapa_usuario->puntaje_ia)) {\n            $etapa_completada = true;\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::ENTREVISTA_NOMBRE) {\n            if ($this->configuracion_modelo_servicio->obtenerValorLlaveConfiguracion(app(VacanteService::class)->obtenerConfiguracionesEtapaAplicante($etapa_usuario->etapa_vacante_id), 'solicitar_formato_entrevista')) {\n                $formato_entrevista = $this->formato_entrevista_repositorio->getUnoAvanzado(new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id]));\n\n                if (!is_null($formato_entrevista) && !is_null($formato_entrevista->descripcion_vacante) && !empty($formato_entrevista->descripcion_vacante)) {\n                    $etapa_completada = true;\n                }\n            } else {\n                $etapa_completada = true;\n            }\n        }\n\n        // Verificar si las etapas de preguntas prefiltro o videoentrevista ya han sido completadas\n        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE])) {\n            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n                'etapa_vacante_id'                      => $etapa_usuario->etapa_vacante_id,\n                'usuario_id'                            => $etapa_usuario->usuario_id,\n                'incluir_cantidad_respuestas_aplicante' => true\n            ]));\n\n            $preguntas_contestadas = 0;\n\n            foreach ($preguntas as $pregunta) {\n                if ($pregunta['respuestas_count'] > 0) {\n                    $preguntas_contestadas++;\n                }\n            }\n\n            // Validar que todas las preguntas hayan sido contestadas\n            if (count($preguntas) === $preguntas_contestadas) {\n                $etapa_completada = true;\n            }\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n            if ((!is_null($etapa_usuario->pruebaTecnica?->enlace) && !empty($etapa_usuario->pruebaTecnica?->enlace) || $etapa_usuario->pruebaTecnica?->archivos->count() > 0) && $etapa_usuario->pruebaTecnica?->borrador == false) {\n                $etapa_completada = true;\n            }\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n                $etapa_usuario->etapa_vacante_id,\n                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n            );\n\n            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n\n            $todos_cargados = true;\n            foreach ($documentos_solicitados as $documento) {\n                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n\n                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n                    $todos_cargados = false;\n                    break;\n                }\n            }\n\n            if ($todos_cargados && $documentos_solicitados->count() > 0) {\n                $etapa_completada = true;\n            }\n        }\n\n        return $etapa_completada;\n    }\n\n    /**\n     * Notificar documentos solicitados.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Jair Carvajal\n     * @author Daniel Beltrán\n     */\n    public function notificarDocumentosSolicitados(int $id): void {\n        $etapa_vacante_usuario = $this->repositorio->getUno($id);\n\n        if ($etapa_vacante_usuario) {\n            $this->enviarCorreoFinalizacionEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->vacante);\n        }\n    }\n\n    /**\n     * Descartar uno o varios aplicantes manualmente y moverlos a la etapa de descartados.\n     *\n     * @param array $ids IDs de las etapas de usuarios en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Daniel Beltrán\n     */\n    public function descartarAplicantesManual(array $ids): void {\n        foreach ($ids as $id) {\n            $etapa_vacante_usuario = $this->repositorio->getUno($id);\n\n            if ($etapa_vacante_usuario) {\n                $this->guardarPuntajeYCambiarDeEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->puntaje ?? 0, descartar: true);\n            }\n        }\n    }\n\n    /**\n     * Revertir descarte de aplicantes.\n     *\n     * @param array $ids IDs de las etapas de los usuarios descartados en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     */\n    public function revertirDescarteAplicantes(array $ids): void {\n        foreach ($ids as $id) {\n            $etapa_descartado = $this->repositorio->getUno($id);\n\n            if ($etapa_descartado && $etapa_descartado->etapa->nombre === EtapaVacante::DESCARTADOS_NOMBRE && $etapa_descartado->activo) {\n                $etapas_no_descartados = $this->etapa_vacante_repositorio->getTodo(new Request(['vacante_id' => $etapa_descartado->vacante->id]))->where('nombre', '!=', EtapaVacante::DESCARTADOS_NOMBRE);\n                $etapas_ids            = $etapas_no_descartados->pluck('id')->toArray();\n                $etapa_previa          = $this->repositorio->obtenerEtapaPrevia($etapa_descartado->usuario_id, $etapas_ids);\n\n                if ($etapa_previa) {\n                    $this->repositorio->eliminar($etapa_descartado->id);\n                    $this->repositorio->actualizar($etapa_previa->id, ['activo' => true]);\n                }\n            }\n        }\n    }\n\n    /**\n     * Mover manualmente al aplicante a la siguiente etapa.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Daniel Beltrán\n     */\n    public function moverAplicanteEtapaManual(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n        $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $etapa_usuario->puntaje ?? 0);\n    }\n\n    /**\n     * Marcar la vacante como abandonada por el aplicante.\n     *\n     * @param Request $request Contenido de la petición.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Daniel Beltrán\n     */\n    public function abandonarVacante(Request $request): void {\n        $etapas_no_descartados = $this->etapa_vacante_repositorio->getTodo(new Request(['vacante_id' => $request->vacante_id]))->where('nombre', '!=', EtapaVacante::DESCARTADOS_NOMBRE);\n        $etapas_ids            = $etapas_no_descartados->pluck('id')->toArray();\n        $etapa_vacante_usuario = $this->repositorio->obtenerEtapaPrevia($request->usuario_id, $etapas_ids);\n\n        if ($etapa_vacante_usuario) {\n            $this->repositorio->actualizar($etapa_vacante_usuario->id, ['motivo_abandono' => $request->motivo_abandono]);\n            $this->guardarPuntajeYCambiarDeEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->puntaje ?? 0, descartar: true);\n        }\n    }\n\n    /**\n     * Notificar al aplicante sobre el cambio de etapa.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param bool $aplicar_validacion_fin_proceso Indica si se debe aplicar la validación de fin de proceso.\n     * @return void\n     * @author Andres Gonzalez\n     */\n    public function notificarCambioEtapa(EtapaVacanteUsuario $etapa_usuario, bool $aplicar_validacion_fin_proceso = true): void {\n        $etapa_usuario->load(['etapa', 'vacante', 'usuario']);\n        $etapa = $etapa_usuario->etapa;\n\n        if ($etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n            $configuraciones_prueba_tecnica = app(EtapaVacanteService::class)->obtenerConfiguracionesPruebaTecnica($etapa->id);\n\n            if (!($configuraciones_prueba_tecnica['prueba_cargada'] ?? false)) {\n                return;\n            }\n        }\n\n        $plantilla_correo_id = [\n            EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE     => PlantillaCorreo::PREGUNTAS_PRE_FILTRO_ID,\n            EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE   => PlantillaCorreo::PRUEBAS_PSICOMETRICAS_ID,\n            EtapaVacante::PRUEBA_TECNICA_NOMBRE          => PlantillaCorreo::ENVIO_PRUEBA_TECNICA_ID,\n            EtapaVacante::VIDEO_ENTREVISTA_NOMBRE        => PlantillaCorreo::SOLICITUD_VIDEOENTREVISTAS_ID,\n            EtapaVacante::ENTREVISTA_NOMBRE              => PlantillaCorreo::NOTIFICACION_ENTREVISTA_ID,\n            EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE => PlantillaCorreo::SOLICITUD_DOCUMENTOS_ID,\n            EtapaVacante::CONTRATADOS_NOMBRE             => PlantillaCorreo::NOTIFICACION_CONTRATADOS_ID,\n            EtapaVacante::DESCARTADOS_NOMBRE             => PlantillaCorreo::NOTIFICACION_DESCARTADOS_ID\n        ][$etapa->nombre] ?? null;\n\n        if (isset($plantilla_correo_id)) {\n            $plantilla_correo_etapa = $this->plantilla_correo_servicio->obtenerUno(new Request([\n                'plantilla_correo_id' => $plantilla_correo_id,\n                'empresa_id'          => $etapa_usuario->vacante->empresa_id\n            ]));\n\n            if (!is_null($plantilla_correo_etapa)) {\n                $es_etapa_fin_proceso = in_array($etapa->nombre, [\n                    EtapaVacante::CONTRATADOS_NOMBRE,\n                    EtapaVacante::DESCARTADOS_NOMBRE\n                ]);\n\n                // Si es etapa de fin de proceso y notificar_fin_proceso es true, no enviar notificación\n                if ($aplicar_validacion_fin_proceso && $es_etapa_fin_proceso && $plantilla_correo_etapa->notificar_fin_proceso) {\n                    return;\n                }\n\n                $usuario            = $etapa_usuario->usuario;\n                $vacante            = $etapa_usuario->vacante;\n                $token_acceso       = $this->token_acceso_servicio->generar($usuario->id);\n                $enlace             = request()->getSchemeAndHttpHost() . \"/control-acceso/{$token_acceso->token}?vacante_id={$vacante->id}\";\n                $usuario_informador = null;\n\n                if ($etapa->nombre !== EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE) {\n                    Mail::to($usuario->email)->queue(new NotificarPostulanteVacanteMail(\n                        $usuario,\n                        $enlace,\n                        $vacante,\n                        $plantilla_correo_etapa->titulo,\n                        $plantilla_correo_etapa->contenido,\n                        $plantilla_correo_etapa->con_logo_empresa,\n                        $etapa->nombre,\n                        $usuario_informador\n                    ));\n                }\n\n                // Enviar notificación de avance en el proceso\n                $usuario->notify(new NotificarAvanceProcesoNotification(\n                    $vacante->id,\n                    $vacante->nombre_vacante,\n                    $etapa->nombre,\n                    $vacante->empresa->nombre ?? 'la empresa'\n                ));\n\n                $this->repositorio->actualizar($etapa_usuario->id, ['fecha_notificacion' => now()]);\n            }\n        }\n    }\n\n    /**\n     * Enviar correo de notificación al finalizar una etapa.\n     *\n     * @param EtapaVacanteUsuario $etapa_vacante_usuario Etapa del usuario en la vacante.\n     * @param Vacante $vacante Vacante.\n     * @return void\n     * @author Jair Carvajal\n     */\n    private function enviarCorreoFinalizacionEtapa(EtapaVacanteUsuario $etapa_vacante_usuario, Vacante $vacante): void {\n        $usuario     = Auth::user();\n        $maneja_logo = file_exists(public_path('empresas-logo/' . $vacante->empresa->id)) ? '1' : null;\n\n        Mail::send(new NotificarFinalizacionEtapaMail(\n            $usuario,\n            $vacante,\n            $etapa_vacante_usuario->etapa,\n            $maneja_logo\n        ));\n    }\n\n    /**\n     * Obtener candidatos recomendados con IA.\n     *\n     * Obtiene los 3 mejores candidatos para la vacante, entre varios candidatos seleccionados por el reclutador.\n     *\n     * @param Request $request Contenido de la petición.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function obtenerCandidatosRecomendadosIA(Request $request): array {\n        $vacante       = $this->vacante_repositorio->getUno($request->vacante_id);\n        $candidatos    = $this->usuario_repositorio->obtenerCandidatosSeleccionadosVacante($request->usuarios_ids, $request->vacante_id);\n        $candidatos_ia = [];\n        $vacante_ia    = [\n            ...Arr::only($vacante->toArray(), ['nombre_vacante', 'salario', 'salario_maximo']),\n            'habilidades'               => $vacante->datos->first(fn($item) => $item->llave === 'habilidades')->valor,\n            'herramientas_tecnologicas' => $vacante->datos->first(fn($item) => $item->llave === 'herramientas_tecnologicas')->valor,\n            'experiencia_laboral'       => $vacante->datos->first(fn($item) => $item->llave === 'experiencia_laboral')->valor,\n            'nivel_educativo'           => $vacante->datos->first(fn($item) => $item->llave === 'nivel_educativo')->valor\n        ];\n\n        if (!is_null($vacante->ciudad_id)) {\n            $direccion_trabajo = $vacante->datos->first(fn($item) => $item->llave === 'direccion_trabajo')->valor;\n            $ubicacion_empresa = \"{$vacante->ciudad->departamento->pais->nombre}, {$vacante->ciudad->departamento->nombre} - {$vacante->ciudad->nombre}, {$direccion_trabajo}\";\n        } elseif (!is_null($vacante->empresa->ciudad_id)) {\n            $ubicacion_empresa = \"{$vacante->empresa->ciudad->departamento->pais->nombre}, {$vacante->empresa->ciudad->departamento->nombre} - {$vacante->empresa->ciudad->nombre}, {$vacante->empresa->direccion}\";\n        }\n\n        if (isset($ubicacion_empresa)) {\n            $vacante_ia['ubicacion'] = $ubicacion_empresa;\n        }\n\n        foreach ($candidatos as $candidato) {\n            if (!is_null($candidato->ciudad_id) && !is_null($candidato->direccion)) {\n                $ubicacion = \"{$candidato->ciudad->departamento->pais->nombre}, {$candidato->ciudad->departamento->nombre} - {$candidato->ciudad->nombre}, {$candidato->direccion}\";\n            }\n\n            $usuario = [\n                ...Arr::only($candidato->toArray(), ['id', 'nombre_completo', 'email', 'telefono', 'edad']),\n                'adecuacion' => $this->obtenerAdecuacionUsuario($candidato->id, $request->vacante_id)\n            ];\n\n            if (isset($ubicacion)) {\n                $usuario['ubicacion'] = $ubicacion;\n            }\n\n            if (!is_null($candidato->perfilLaboral)) {\n                $usuario['salario']                   = $candidato->perfilLaboral->salario;\n                $usuario['salario_maximo']            = $candidato->perfilLaboral->salario_maximo;\n                $usuario['habilidades']               = $candidato->perfilLaboral->habilidades;\n                $usuario['herramientas_tecnologicas'] = $candidato->perfilLaboral->herramientas_tecnologicas;\n                $usuario['estudios']                  = [];\n                $usuario['experiencias_laborales']    = [];\n                $usuario['idiomas']                   = [];\n                $usuario['etapas']                    = [];\n\n                foreach ($candidato->perfilLaboral->estudios as $item) {\n                    array_push($usuario['estudios'], [\n                        ...Arr::only($item->toArray(), ['titulo', 'fecha_inicio', 'fecha_fin']),\n                        'nivel_educativo' => $item->nivelEducativo->nombre,\n                    ]);\n                }\n\n                foreach ($candidato->perfilLaboral->experienciasLaborales as $item) {\n                    array_push($usuario['experiencias_laborales'], [...Arr::only($item->toArray(), ['empresa', 'cargo', 'fecha_inicio', 'fecha_fin', 'tiempo'])]);\n                }\n\n                foreach ($candidato->perfilLaboral->idiomas as $item) {\n                    array_push($usuario['idiomas'], [\n                        'idioma' => $item->idioma->nombre,\n                        'nivel'  => $item->nivel\n                    ]);\n                }\n\n                foreach ($candidato->etapasUsuarios as $item) {\n                    $datos_etapas = [\n                        'nombre'      => $item->etapa->nombre,\n                        'puntaje'     => $item->puntaje,\n                        'puntaje_ia'  => $item->puntaje_ia,\n                        'comentarios' => $item->comentarios->pluck('comentario')->values()->toArray()\n                    ];\n\n                    if ($item->etapa->nombre === EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE) {\n                        $agendas = $this->agenda_repositorio->getTodo(new Request([\n                            'proceso_id'         => $vacante->proceso->id,\n                            'evaluado_id'        => $item->usuario_id,\n                            'estado_id'          => EstadoAgenda::FINALIZADA_ID,\n                            'incluir_resultados' => true\n                        ]));\n\n                        $datos_etapas['pruebas_psicometricas'] = [];\n\n                        foreach ($agendas as $agenda) {\n                            array_push($datos_etapas['pruebas_psicometricas'], [\n                                'prueba'     => $agenda->prueba->nombre,\n                                'ajuste'     => $agenda->ajuste,\n                                'resultados' => $agenda->resultados->map(function ($resultado) {\n                                    return [\n                                        'dimension' => $resultado->dimension->nombre,\n                                        'puntaje'   => $resultado->puntaje_transformado\n                                    ];\n                                })->values()->toArray()\n                            ]);\n                        }\n\n                        if (count($datos_etapas['pruebas_psicometricas']) === 0) {\n                            unset($datos_etapas['pruebas_psicometricas']);\n                        }\n                    }\n\n                    array_push($usuario['etapas'], $datos_etapas);\n                }\n            }\n\n            array_push($candidatos_ia, $usuario);\n        }\n\n        return $this->realizarPeticionIA('obtener-candidatos-recomendados', [\n            'vacante_id' => $request->vacante_id,\n            'vacante'    => json_encode($vacante_ia, JSON_UNESCAPED_UNICODE),\n            'candidatos' => json_encode($candidatos_ia, JSON_UNESCAPED_UNICODE)\n        ]);\n    }\n\n    /**\n     * Obtener competencias por mejorar para usuario que será contratado.\n     * SOLO Buscar agendas de TenDisc Plus (12) y Potencial Comercial (7)\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return array\n     * @author Sergio Vargas\n     */\n    public function obtenerCompetenciasPorMejorar(int $id): array {\n        $etapa_vacante_usuario = $this->repositorio->getUno($id);\n        $usuario_id = $etapa_vacante_usuario->usuario_id;\n        $proceso = $etapa_vacante_usuario->vacante->proceso;\n\n        if (is_null($proceso)) {\n            return [\n                'usuario_id' => $usuario_id,\n                'pruebas' => []\n            ];\n        }\n\n        $agendas = $this->agenda_repositorio->getTodo(new Request([\n            'proceso_id' => $proceso->id,\n            'evaluado_id' => $usuario_id,\n            'pruebas_ids' => [12, 7],\n            'estado_id' => 3,\n            'con_evaluado' => true\n        ]));\n\n        $resultado = [\n            'usuario_id' => $usuario_id,\n            'pruebas' => []\n        ];\n\n        foreach ($agendas as $agenda) {\n            $competencias_bajas = $this->extraerCompetenciasBajas($agenda);\n\n            if (!empty($competencias_bajas)) {\n                $resultado['pruebas'][] = [\n                    'prueba_id' => $agenda->prueba_id,\n                    'nombre_prueba' => $agenda->prueba->nombre,\n                    'competencias' => $competencias_bajas\n                ];\n            }\n        }\n\n        return $resultado;\n    }\n\n    /**\n     * Extraer las 2 competencias más bajas de una agenda según su prueba.\n     *\n     * @param \\App\\Models\\Agendas\\Agenda $agenda Agenda finalizada.\n     * @return array\n     * @author Sergio Vargas\n     */\n    private function extraerCompetenciasBajas($agenda): array {\n        $resultados = $this->resultado_agenda_servicio->gestionarResultados($agenda);\n\n        if (empty($resultados)) {\n            return [];\n        }\n\n        $competencias_todas = [];\n\n        // TenDisc Plus (prueba_id = 12)\n        if ($agenda->prueba_id === 12) {\n            $factor_especificas = collect($resultados)->firstWhere('nombre', 'Competencias Específicas');\n            $factor_transversales = collect($resultados)->firstWhere('nombre', 'Competencias Transversales');\n\n            if ($factor_especificas) {\n                $competencias_todas = array_merge($competencias_todas, $factor_especificas['dimensiones']);\n            }\n            if ($factor_transversales) {\n                $competencias_todas = array_merge($competencias_todas, $factor_transversales['dimensiones']);\n            }\n        }\n\n        // Potencial Comercial (prueba_id = 7)\n        if ($agenda->prueba_id === 7) {\n            $factor_caracter = collect($resultados)->firstWhere('nombre', 'Carácter');\n            $factor_habilidades = collect($resultados)->firstWhere('nombre', 'Habilidades');\n\n            if ($factor_caracter) {\n                $competencias_todas = array_merge($competencias_todas, $factor_caracter['dimensiones']);\n            }\n            if ($factor_habilidades) {\n                $competencias_todas = array_merge($competencias_todas, $factor_habilidades['dimensiones']);\n            }\n        }\n\n        // Ordenar por puntaje ascendente y tomar las 2 más bajas\n        return collect($competencias_todas)\n            ->sortBy('puntaje_transformado')\n            ->take(2)\n            ->map(fn($c) => [\n                'nombre' => $c['nombre'],\n                'puntaje' => round($c['puntaje_transformado'], 0)\n            ])\n            ->values()\n            ->toArray();\n    }\n}\n","structuredPatch":[{"oldStart":919,"oldLines":7,"newStart":919,"newLines":7,"lines":["                 }","             }"," ","-            if ($todos_cargados && $documentos_solicitados->count() > 0) {","+            if ($todos_cargados && $documentos_solicitados->count() > 0 && !is_null($etapa_usuario->fecha_ejecucion)) {","                 $etapa_completada = true;","             }","         }"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"5dbddcc6-9241-41e1-93e9-2401e1221ac6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T21:36:15.108Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01572eJP31cZZPFno1F3MAas","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora la etapa de **Documentos de Contratación** se marca como completada solo cuando:\n\n1. ✅ Todos los documentos solicitados han sido cargados\n2. ✅ Hay al menos un documento solicitado\n3. ✅ El campo `fecha_ejecucion` no es nulo"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":433,"cache_read_input_tokens":29348,"cache_creation":{"ephemeral_5m_input_tokens":433,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKMGTNSMu21o1mwn3eHA","uuid":"69afc817-bbc9-4d33-a56c-10bb6e6a4cbc"}
{"parentUuid":"69afc817-bbc9-4d33-a56c-10bb6e6a4cbc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 2401 to 2401 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n\nThis may or may not be related to the current task.</ide_selection>"}]},"uuid":"11ad5bea-a037-4627-8490-a5dd8adbb357","timestamp":"2026-01-20T22:16:06.486Z"}
{"parentUuid":"11ad5bea-a037-4627-8490-a5dd8adbb357","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"analiza esta funcion function mostrarResultadoDocumentosContratacion(etapa) {"}]},"uuid":"74d16efa-53f6-4208-a992-6e5b73b1f2e6","timestamp":"2026-01-20T22:16:06.486Z"}
{"parentUuid":"74d16efa-53f6-4208-a992-6e5b73b1f2e6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:16:09.243Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UapyJstMivNGiXfCj2iMRe","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a leer la función completa para analizarla."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":29982,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":29982,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKQJzuQLrdXffaFuftpd","uuid":"9a506e50-2eef-4d6a-8fb2-a7fee8028582"}
{"parentUuid":"9a506e50-2eef-4d6a-8fb2-a7fee8028582","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:16:10.368Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UapyJstMivNGiXfCj2iMRe","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AQ269F3pJcDyFkZbKaB2h7","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2398,"limit":120}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":29982,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":29982,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKQJzuQLrdXffaFuftpd","uuid":"9f8b4f1e-6e08-4fed-839d-904d08765030"}
{"parentUuid":"9f8b4f1e-6e08-4fed-839d-904d08765030","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AQ269F3pJcDyFkZbKaB2h7","type":"tool_result","content":"  2398→ * @author José Manuel Jiménez\n  2399→ * @author Andres Gonzalez\n  2400→ */\n  2401→function mostrarResultadoDocumentosContratacion(etapa) {\n  2402→    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n  2403→    $('#contenedor-archivos-contratacion').empty();\n  2404→    let documentos_contartacion = [];\n  2405→    let imagenes_cargadas = [];\n  2406→    archivos_contratacion.forEach((archivo) => {\n  2407→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2408→        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n  2409→        if (es_imagen) {\n  2410→            imagenes_cargadas.push(archivo);\n  2411→        } else {\n  2412→            documentos_contartacion.push(archivo);\n  2413→        }\n  2414→    });\n  2415→    let archivos_html = '';\n  2416→    documentos_contartacion.forEach((archivo) => {\n  2417→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2418→        let icono = obtenerIconoPorExtension(extension);\n  2419→        let url_archivo = `/archivos-abrir/${archivo.id}`;\n  2420→        archivos_html += `\n  2421→            <div class=\"col-auto archivo-item\">\n  2422→                <div class=\"col-auto px-3 border rounded-2\">\n  2423→                    <div class=\"row align-items-center\">\n  2424→                        <div class=\"col-auto py-3\">\n  2425→                            <i class=\"${icono} text-blue-40\"></i>\n  2426→                        </div>\n  2427→                        <div class=\"col px-0 py-3\">\n  2428→                            <a href=\"${url_archivo}\"\n  2429→                               target=\"_blank\"\n  2430→                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n  2431→                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n  2432→                                ${archivo.nombre_original_archivo}\n  2433→                            </a>\n  2434→                        </div>\n  2435→                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n  2436→                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n  2437→                        </a>\n  2438→                    </div>\n  2439→                </div>\n  2440→            </div>\n  2441→        `;\n  2442→    });\n  2443→    imagenes_cargadas.forEach((archivo) => {\n  2444→        let url_imagen = `/archivos-abrir/${archivo.id}`;\n  2445→        archivos_html += `\n  2446→            <div class=\"col-auto archivo-item\">\n  2447→                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n  2448→                    <div class=\"row align-items-center\">\n  2449→                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n  2450→                    </div>\n  2451→                    <div class=\"row align-items-center\">\n  2452→                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n  2453→                            ${archivo.nombre_original_archivo}\n  2454→                        </div>\n  2455→                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n  2456→                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n  2457→                        </a>\n  2458→                    </div>\n  2459→                </div>\n  2460→            </div>\n  2461→        `;\n  2462→    });\n  2463→    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {\n  2464→        $('#contenedor-cantidad-adjuntos').empty();\n  2465→        return `\n  2466→            <div class=\"col-12\">\n  2467→                <div class=\"row justify-content-center my-14\">\n  2468→                    <div class=\"col-auto\">\n  2469→                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n  2470→                    </div>\n  2471→                    <div class=\"col-12 text-center text-headline-5\">\n  2472→                        Este candidato aún no ha adjuntado los documentos para contratación\n  2473→                    </div>\n  2474→                    ${etapa.id != null ? `\n  2475→                        <div class=\"col-auto mt-10\">\n  2476→                            ${crearBoton({\n  2477→                                clases: 'btn-outline-primary',\n  2478→                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2479→                                onclick: \"$('#documentos_contratacion').click();\"\n  2480→                            })}\n  2481→                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n  2482→                        </div>\n  2483→                    ` : ''}\n  2484→                </div>\n  2485→            </div>\n  2486→        `;\n  2487→    } else {\n  2488→        setTimeout(() => {\n  2489→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2490→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2491→            );\n  2492→            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2493→        }, 100);\n  2494→        return `\n  2495→            <div class=\"col-12\">\n  2496→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n  2497→                    <div class=\"col-12\">\n  2498→                        <div class=\"row justify-content-between align-items-center mb-4\">\n  2499→                            <div class=\"col-auto text-body-2 text-gray-10\">\n  2500→                                Archivos adjuntos\n  2501→                            </div>\n  2502→                            <div class=\"col-auto\">\n  2503→                                ${crearBoton({\n  2504→                                    clases: 'btn-outline-primary',\n  2505→                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2506→                                    onclick: `$('#documentos_contratacion').click();`\n  2507→                                })}\n  2508→                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n  2509→                            </div>\n  2510→                        </div>\n  2511→                    </div>\n  2512→                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n  2513→                </div>\n  2514→            </div>\n  2515→        `;\n  2516→    }\n  2517→}\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"79d52281-cfcf-4f33-9713-0aeab39662fc","timestamp":"2026-01-20T22:16:12.759Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":" * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}","numLines":120,"startLine":2398,"totalLines":2691}}}
{"parentUuid":"79d52281-cfcf-4f33-9713-0aeab39662fc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:16:27.119Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Uo4CiMARLcg2bbHTAC3wYV","type":"message","role":"assistant","content":[{"type":"text","text":"## Análisis de `mostrarResultadoDocumentosContratacion`\n\nEsta función genera el HTML para mostrar los documentos de contratación cargados por un candidato en una etapa del proceso de selección.\n\n### Flujo de la función\n\n```\n1. Obtener archivos → 2. Separar por tipo → 3. Generar HTML → 4. Retornar vista\n```\n\n### Estructura detallada\n\n| Paso | Descripción |\n|------|-------------|\n| **Línea 2402** | Obtiene los archivos guardados del objeto `etapa` |\n| **Líneas 2406-2414** | Separa archivos en dos arrays: `imagenes_cargadas` y `documentos_contartacion` (nota: typo en el nombre) |\n| **Líneas 2416-2442** | Genera HTML para documentos (PDF, DOC, XLS, etc.) con icono y enlace de descarga |\n| **Líneas 2443-2462** | Genera HTML para imágenes con previsualización y descarga |\n| **Líneas 2463-2486** | Si no hay archivos ni puntaje: muestra estado vacío con botón para adjuntar |\n| **Líneas 2487-2516** | Si hay archivos: muestra la lista con contador de adjuntos |\n\n### Observaciones\n\n1. **Typo en variable**: `documentos_contartacion` debería ser `documentos_contratacion` (línea 2404)\n\n2. **Extensiones de imagen soportadas**: `jpg`, `jpeg`, `png`, `gif`, `webp`\n\n3. **Extensiones de documento aceptadas en input**: `pdf`, `doc`, `docx`, `xls`, `xlsx`\n\n4. **Componentes UI utilizados**:\n   - `crearTooltip()` - Para mostrar nombre completo del archivo\n   - `crearBoton()` - Botón de adjuntar archivos\n   - `crearTag()` - Tag con contador de adjuntos\n\n5. **Condición para estado vacío** (línea 2463):\n   ```javascript\n   etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0\n   ```\n\n6. **Función relacionada**: `mostrarPrevisualizacionImagen()` para ver imágenes en grande\n\n¿Necesitas que modifique algo en esta función?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2507,"cache_read_input_tokens":29982,"cache_creation":{"ephemeral_5m_input_tokens":2507,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKQKSFtwoit9FPrQnZoN","uuid":"06a560f2-c456-4b59-9885-b9be08283e70"}
{"parentUuid":"06a560f2-c456-4b59-9885-b9be08283e70","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 2472 to 2474 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\n<div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n\nThis may or may not be related to the current task.</ide_selection>"}]},"uuid":"2bccf586-393c-48a5-915e-cb890af02cb6","timestamp":"2026-01-20T22:40:14.639Z"}
{"parentUuid":"2bccf586-393c-48a5-915e-cb890af02cb6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"lito y en estapa me lelga esto {\n    \"nombre_etapa\": \"Documentos para contratación\",\n    \"id\": 189,\n    \"usuario_id\": 27,\n    \"etapa_vacante_id\": 223,\n    \"puntaje\": null,\n    \"puntaje_ia\": null,\n    \"notas_ia\": null,\n    \"fecha_notificacion\": \"2026-01-20 15:53:15\",\n    \"fecha_ejecucion\": null,\n    \"motivo_abandono\": null,\n    \"activo\": 1,\n    \"archivos_solicitados\": {\n        \"documentos\": [\n            {\n                \"id\": 1,\n                \"empresa_id\": null,\n                \"nombre\": \"Cédula de ciudadanía\"\n            },\n            {\n                \"id\": 2,\n                \"empresa_id\": null,\n                \"nombre\": \"Certificados laborales\"\n            },\n            {\n                \"id\": 3,\n                \"empresa_id\": null,\n                \"nombre\": \"Diplomas de grado\"\n            },\n            {\n                \"id\": 4,\n                \"empresa_id\": null,\n                \"nombre\": \"Certificado EPS\"\n            },\n            {\n                \"id\": 5,\n                \"empresa_id\": null,\n                \"nombre\": \"Antecedentes\"\n            }\n        ],\n        \"archivos_guardados\": []\n    }\n} y quero que cuando la fecha _ejecuciuon sea null que em puetre este <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>esa sexcion pero cunato ya tenga una fecha si que lo muestre bien"}]},"uuid":"1f8eb8f3-0826-4011-986a-7de03417e482","timestamp":"2026-01-20T22:40:14.639Z"}
{"parentUuid":"1f8eb8f3-0826-4011-986a-7de03417e482","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:40:18.480Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_0119K5gnNFSV4SuE5ssL4JUn","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo. Necesitas que cuando `fecha_ejecucion` sea `null` muestre el mensaje de \"aún no ha adjuntado\", y cuando tenga fecha muestre los archivos correctamente."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":33657,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":33657,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKS9kbfJ3Lm2u6K2bLXY","uuid":"0b6b3240-8562-4f9d-af1f-9b1af40ca842"}
{"parentUuid":"0b6b3240-8562-4f9d-af1f-9b1af40ca842","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:40:19.592Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_0119K5gnNFSV4SuE5ssL4JUn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01L6rJtYZ88kzPJfBAjdet8R","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2460,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":33657,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":33657,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKS9kbfJ3Lm2u6K2bLXY","uuid":"ff5da776-642e-4450-bcb6-c67e652c91fb"}
{"parentUuid":"ff5da776-642e-4450-bcb6-c67e652c91fb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01L6rJtYZ88kzPJfBAjdet8R","type":"tool_result","content":"  2460→                </div>\n  2461→            </div>\n  2462→        `;\n  2463→    });\n  2464→    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {\n  2465→        $('#contenedor-cantidad-adjuntos').empty();\n  2466→        return `\n  2467→            <div class=\"col-12\">\n  2468→                <div class=\"row justify-content-center my-14\">\n  2469→                    <div class=\"col-auto\">\n  2470→                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n  2471→                    </div>\n  2472→                    <div class=\"col-12 text-center text-headline-5\">\n  2473→                        Este candidato aún no ha adjuntado los documentos para contratación\n  2474→                    </div>\n  2475→                    ${etapa.id != null ? `\n  2476→                        <div class=\"col-auto mt-10\">\n  2477→                            ${crearBoton({\n  2478→                                clases: 'btn-outline-primary',\n  2479→                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2480→                                onclick: \"$('#documentos_contratacion').click();\"\n  2481→                            })}\n  2482→                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n  2483→                        </div>\n  2484→                    ` : ''}\n  2485→                </div>\n  2486→            </div>\n  2487→        `;\n  2488→    } else {\n  2489→        setTimeout(() => {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"624cff3d-d428-46a3-9fdd-f8b3a7321181","timestamp":"2026-01-20T22:40:21.906Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"                </div>\n            </div>\n        `;\n    });\n    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {","numLines":30,"startLine":2460,"totalLines":2692}}}
{"parentUuid":"624cff3d-d428-46a3-9fdd-f8b3a7321181","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:40:28.540Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MdrY2TspeJm8EKa7E6U9Mg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01K8STvZVHg9ces5wmLkZsNb","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {","new_string":"    if (etapa.fecha_ejecucion == null) {"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":772,"cache_read_input_tokens":33657,"cache_creation":{"ephemeral_5m_input_tokens":772,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKSAGSH1Ajf5HC2zKzcm","uuid":"466bc2b7-2e4f-4c6a-8020-6584fb1611e9"}
{"parentUuid":"466bc2b7-2e4f-4c6a-8020-6584fb1611e9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01K8STvZVHg9ces5wmLkZsNb","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2460→                </div>\n  2461→            </div>\n  2462→        `;\n  2463→    });\n  2464→    if (etapa.fecha_ejecucion == null) {\n  2465→        $('#contenedor-cantidad-adjuntos').empty();\n  2466→        return `\n  2467→            <div class=\"col-12\">\n  2468→                <div class=\"row justify-content-center my-14\">"}]},"uuid":"aee5dc4b-9f71-43a9-86ac-6de81a34863d","timestamp":"2026-01-20T22:45:43.411Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {","newString":"    if (etapa.fecha_ejecucion == null) {","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    console.log(etapa);\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2461,"oldLines":7,"newStart":2461,"newLines":7,"lines":["             </div>","         `;","     });","-    if (etapa.puntaje == null && etapa.puntaje_ia == null && archivos_contratacion.length == 0) {","+    if (etapa.fecha_ejecucion == null) {","         $('#contenedor-cantidad-adjuntos').empty();","         return `","             <div class=\"col-12\">"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"aee5dc4b-9f71-43a9-86ac-6de81a34863d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:45:51.925Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Tb4WuECMTwFMgCez2iWXwi","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora la lógica es:\n\n| `fecha_ejecucion` | Comportamiento |\n|-------------------|----------------|\n| `null` | Muestra mensaje \"Este candidato aún no ha adjuntado los documentos para contratación\" con botón para adjuntar |\n| Con fecha | Muestra la lista de archivos adjuntos correctamente |\n\nEsto es consistente con el cambio que hicimos en el backend en `verificarEtapaCompletada`, donde también se valida que `fecha_ejecucion` no sea nulo para considerar la etapa como completada."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":34804,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":34804,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKSaC9UrhveBiwU49p1x","uuid":"f7d01c59-706c-46ed-8041-dd0cc4788c9a"}
{"parentUuid":"f7d01c59-706c-46ed-8041-dd0cc4788c9a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 2445 to 2445 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\nurl_imagen\n\nThis may or may not be related to the current task.</ide_selection>"}]},"uuid":"7ca83adf-6ecd-453b-83d5-4cdb08cc5631","timestamp":"2026-01-20T22:50:45.764Z"}
{"parentUuid":"7ca83adf-6ecd-453b-83d5-4cdb08cc5631","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"listo hayt que hacer otra vlaidacion asi se ve con archivos cargados {\n    \"nombre_etapa\": \"Documentos para contratación\",\n    \"id\": 189,\n    \"usuario_id\": 27,\n    \"etapa_vacante_id\": 223,\n    \"puntaje\": null,\n    \"puntaje_ia\": null,\n    \"notas_ia\": null,\n    \"fecha_notificacion\": \"2026-01-20 15:53:15\",\n    \"fecha_ejecucion\": null,\n    \"motivo_abandono\": null,\n    \"activo\": 1,\n    \"archivos_solicitados\": {\n        \"documentos\": [\n            {\n                \"id\": 1,\n                \"empresa_id\": null,\n                \"nombre\": \"Cédula de ciudadanía\"\n            },\n            {\n                \"id\": 2,\n                \"empresa_id\": null,\n                \"nombre\": \"Certificados laborales\"\n            },\n            {\n                \"id\": 3,\n                \"empresa_id\": null,\n                \"nombre\": \"Diplomas de grado\"\n            },\n            {\n                \"id\": 4,\n                \"empresa_id\": null,\n                \"nombre\": \"Certificado EPS\"\n            },\n            {\n                \"id\": 5,\n                \"empresa_id\": null,\n                \"nombre\": \"Antecedentes\"\n            }\n        ],\n        \"archivos_guardados\": [\n            {\n                \"id\": 260,\n                \"modelo\": \"App\\\\Models\\\\Vacantes\\\\EtapaVacanteUsuario\",\n                \"modelo_id\": 189,\n                \"nombre\": \"cliente_empresa_69693791e75d2.pdf\",\n                \"nombre_original_archivo\": \"69693791e75d2.pdf\",\n                \"ruta\": \"private/archivos/empresas/2/documentos-solicitados/189/697005a733747.pdf\"\n            }\n        ]\n    }\n} entonces si tiene archivos cargados se ban ha mostrar pero solo los que ha cargado la empresa y se diferencian d elos que cargo e plicante por que en el campo de nombre de archivos comienzan con cliente_empresa_ esos si se pueden mostrar pero cunado ya este la fecha de ejecucin se muestren todos"}]},"uuid":"f46c558a-f8ab-419e-a38c-78c54cf714d4","timestamp":"2026-01-20T22:50:45.764Z"}
{"parentUuid":"f46c558a-f8ab-419e-a38c-78c54cf714d4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:50:50.390Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RpD4AafAhP9QzncLhQZVZS","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo. Necesitas mostrar solo los archivos cargados por la empresa (los que comienzan con `cliente_empresa_`) cuando `fecha_ejecucion` es `null`, y mostrar todos los archivos cuando ya tenga fecha."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":801,"cache_read_input_tokens":34804,"cache_creation":{"ephemeral_5m_input_tokens":801,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKSxJ4J38P7R2mWNF3yr","uuid":"a28b4f1d-4e83-4587-ba01-a2136daca082"}
{"parentUuid":"a28b4f1d-4e83-4587-ba01-a2136daca082","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:50:51.695Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RpD4AafAhP9QzncLhQZVZS","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01B8qmUKZnmcfc1zJ1CBTGcU","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2398,"limit":70}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":801,"cache_read_input_tokens":34804,"cache_creation":{"ephemeral_5m_input_tokens":801,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKSxJ4J38P7R2mWNF3yr","uuid":"f5be221d-a841-4070-ae2f-546f7869696e"}
{"parentUuid":"f5be221d-a841-4070-ae2f-546f7869696e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01B8qmUKZnmcfc1zJ1CBTGcU","type":"tool_result","content":"  2398→ * @author José Manuel Jiménez\n  2399→ * @author Andres Gonzalez\n  2400→ */\n  2401→function mostrarResultadoDocumentosContratacion(etapa) {\n  2402→    console.log(etapa);\n  2403→    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n  2404→    $('#contenedor-archivos-contratacion').empty();\n  2405→    let documentos_contartacion = [];\n  2406→    let imagenes_cargadas = [];\n  2407→    archivos_contratacion.forEach((archivo) => {\n  2408→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2409→        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n  2410→        if (es_imagen) {\n  2411→            imagenes_cargadas.push(archivo);\n  2412→        } else {\n  2413→            documentos_contartacion.push(archivo);\n  2414→        }\n  2415→    });\n  2416→    let archivos_html = '';\n  2417→    documentos_contartacion.forEach((archivo) => {\n  2418→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2419→        let icono = obtenerIconoPorExtension(extension);\n  2420→        let url_archivo = `/archivos-abrir/${archivo.id}`;\n  2421→        archivos_html += `\n  2422→            <div class=\"col-auto archivo-item\">\n  2423→                <div class=\"col-auto px-3 border rounded-2\">\n  2424→                    <div class=\"row align-items-center\">\n  2425→                        <div class=\"col-auto py-3\">\n  2426→                            <i class=\"${icono} text-blue-40\"></i>\n  2427→                        </div>\n  2428→                        <div class=\"col px-0 py-3\">\n  2429→                            <a href=\"${url_archivo}\"\n  2430→                               target=\"_blank\"\n  2431→                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n  2432→                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n  2433→                                ${archivo.nombre_original_archivo}\n  2434→                            </a>\n  2435→                        </div>\n  2436→                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n  2437→                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n  2438→                        </a>\n  2439→                    </div>\n  2440→                </div>\n  2441→            </div>\n  2442→        `;\n  2443→    });\n  2444→    imagenes_cargadas.forEach((archivo) => {\n  2445→        let url_imagen = `/archivos-abrir/${archivo.id}`;\n  2446→        archivos_html += `\n  2447→            <div class=\"col-auto archivo-item\">\n  2448→                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n  2449→                    <div class=\"row align-items-center\">\n  2450→                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n  2451→                    </div>\n  2452→                    <div class=\"row align-items-center\">\n  2453→                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n  2454→                            ${archivo.nombre_original_archivo}\n  2455→                        </div>\n  2456→                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n  2457→                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n  2458→                        </a>\n  2459→                    </div>\n  2460→                </div>\n  2461→            </div>\n  2462→        `;\n  2463→    });\n  2464→    if (etapa.fecha_ejecucion == null) {\n  2465→        $('#contenedor-cantidad-adjuntos').empty();\n  2466→        return `\n  2467→            <div class=\"col-12\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"0c17097c-9f42-4751-9fdf-eab047dda3c5","timestamp":"2026-01-20T22:50:53.876Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":" * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    console.log(etapa);\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">","numLines":70,"startLine":2398,"totalLines":2692}}}
{"parentUuid":"0c17097c-9f42-4751-9fdf-eab047dda3c5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:50:57.649Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_016XM2qk2YsG8eRPwJ2GvP89","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a modificar la función para filtrar los archivos según `fecha_ejecucion`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1503,"cache_read_input_tokens":35605,"cache_creation":{"ephemeral_5m_input_tokens":1503,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKSxrwDg41QAyTgQstTF","uuid":"c98b342e-6aaf-4859-980f-c83a44c9185b"}
{"parentUuid":"c98b342e-6aaf-4859-980f-c83a44c9185b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:51:06.600Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_016XM2qk2YsG8eRPwJ2GvP89","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XZk6fhTHofzcwsVEUzZAhZ","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"function mostrarResultadoDocumentosContratacion(etapa) {\n    console.log(etapa);\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });","new_string":"function mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1503,"cache_read_input_tokens":35605,"cache_creation":{"ephemeral_5m_input_tokens":1503,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKSxrwDg41QAyTgQstTF","uuid":"9b99b170-5e55-4952-8cad-a76fec13ef3f"}
{"parentUuid":"9b99b170-5e55-4952-8cad-a76fec13ef3f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XZk6fhTHofzcwsVEUzZAhZ","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2397→ * @returns {string} Código HTML del resultado de la etapa.\n  2398→ * @author José Manuel Jiménez\n  2399→ * @author Andres Gonzalez\n  2400→ */\n  2401→function mostrarResultadoDocumentosContratacion(etapa) {\n  2402→    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n  2403→\n  2404→    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n  2405→    if (etapa.fecha_ejecucion == null) {\n  2406→        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n  2407→    }\n  2408→\n  2409→    $('#contenedor-archivos-contratacion').empty();\n  2410→    let documentos_contratacion = [];\n  2411→    let imagenes_cargadas = [];\n  2412→    archivos_contratacion.forEach((archivo) => {\n  2413→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2414→        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n  2415→        if (es_imagen) {\n  2416→            imagenes_cargadas.push(archivo);\n  2417→        } else {\n  2418→            documentos_contratacion.push(archivo);\n  2419→        }\n  2420→    });\n  2421→    let archivos_html = '';\n  2422→    documentos_contartacion.forEach((archivo) => {\n  2423→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2424→        let icono = obtenerIconoPorExtension(extension);"}]},"uuid":"daa3682e-b861-4cca-bbed-dd5a598f3d66","timestamp":"2026-01-20T22:52:36.349Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"function mostrarResultadoDocumentosContratacion(etapa) {\n    console.log(etapa);\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });","newString":"function mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    console.log(etapa);\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contartacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contartacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2399,"oldLines":10,"newStart":2399,"newLines":15,"lines":["  * @author Andres Gonzalez","  */"," function mostrarResultadoDocumentosContratacion(etapa) {","-    console.log(etapa);","     let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];","+","+    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)","+    if (etapa.fecha_ejecucion == null) {","+        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));","+    }","+","     $('#contenedor-archivos-contratacion').empty();","-    let documentos_contartacion = [];","+    let documentos_contratacion = [];","     let imagenes_cargadas = [];","     archivos_contratacion.forEach((archivo) => {","         let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();"]},{"oldStart":2410,"oldLines":7,"newStart":2415,"newLines":7,"lines":["         if (es_imagen) {","             imagenes_cargadas.push(archivo);","         } else {","-            documentos_contartacion.push(archivo);","+            documentos_contratacion.push(archivo);","         }","     });","     let archivos_html = '';"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"daa3682e-b861-4cca-bbed-dd5a598f3d66","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:52:41.397Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_015HStR4irKuQ9nm6bM2AQx5","type":"message","role":"assistant","content":[{"type":"text","text":"Hay un error de typo en la variable. Voy a corregirlo."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1365,"cache_read_input_tokens":37108,"cache_creation":{"ephemeral_5m_input_tokens":1365,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKT6XqjqPQBvga7QuBks","uuid":"ad9914a6-7798-4e99-928e-7663bbf33a56"}
{"parentUuid":"ad9914a6-7798-4e99-928e-7663bbf33a56","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:52:42.589Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_015HStR4irKuQ9nm6bM2AQx5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HeNzCHauQyzQ4FxDsNnkge","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {","new_string":"    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1365,"cache_read_input_tokens":37108,"cache_creation":{"ephemeral_5m_input_tokens":1365,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKT6XqjqPQBvga7QuBks","uuid":"a3598134-172b-4815-b65d-c17eed3a980e"}
{"parentUuid":"a3598134-172b-4815-b65d-c17eed3a980e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HeNzCHauQyzQ4FxDsNnkge","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2417→        } else {\n  2418→            documentos_contratacion.push(archivo);\n  2419→        }\n  2420→    });\n  2421→    let archivos_html = '';\n  2422→    documentos_contratacion.forEach((archivo) => {\n  2423→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n  2424→        let icono = obtenerIconoPorExtension(extension);\n  2425→        let url_archivo = `/archivos-abrir/${archivo.id}`;\n  2426→        archivos_html += `"}]},"uuid":"08658568-73a2-4ed8-a52d-91e8fb3e0d83","timestamp":"2026-01-20T22:53:03.814Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {","newString":"    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contartacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2419,"oldLines":7,"newStart":2419,"newLines":7,"lines":["         }","     });","     let archivos_html = '';","-    documentos_contartacion.forEach((archivo) => {","+    documentos_contratacion.forEach((archivo) => {","         let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();","         let icono = obtenerIconoPorExtension(extension);","         let url_archivo = `/archivos-abrir/${archivo.id}`;"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"08658568-73a2-4ed8-a52d-91e8fb3e0d83","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:53:09.783Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TkQeSoPBH1uayRiPBUpR45","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora la lógica funciona así:\n\n| `fecha_ejecucion` | Archivos mostrados |\n|-------------------|-------------------|\n| `null` | Solo archivos de la empresa (prefijo `cliente_empresa_`) |\n| Con fecha | Todos los archivos (empresa + aplicante) |\n\nTambién corregí el typo `documentos_contartacion` → `documentos_contratacion`."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":533,"cache_read_input_tokens":38473,"cache_creation":{"ephemeral_5m_input_tokens":533,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKT8Z7gpwvAYujMpXZPB","uuid":"4ea1c947-0fdc-44e9-b60d-0ff3bb37fa29"}
{"parentUuid":"4ea1c947-0fdc-44e9-b60d-0ff3bb37fa29","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js in the IDE. This may or may not be related to the current task.</ide_opened_file>"}]},"uuid":"7204bdf0-a7b7-4b67-b993-ac7424046ee6","timestamp":"2026-01-20T22:55:16.468Z"}
{"parentUuid":"7204bdf0-a7b7-4b67-b993-ac7424046ee6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"no funciona por que si la fecha es null pero la empresa ya tiene documnetos cargados deverian verse esoso documentos que coloc la empresa"}]},"uuid":"a2a4e3c5-e992-4aac-9629-54ff83fcb811","timestamp":"2026-01-20T22:55:16.468Z"}
{"parentUuid":"a2a4e3c5-e992-4aac-9629-54ff83fcb811","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:55:20.944Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UorZnBfUHMooUPtA8cyjMA","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo, el problema es que cuando `fecha_ejecucion` es `null` pero la empresa ya cargó documentos (con prefijo `cliente_empresa_`), la condición actual retorna el mensaje de \"no ha adjuntado\" sin mostrar esos archivos. Necesitamos ajustar la condición del `if`."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1453,"cache_read_input_tokens":37754,"cache_creation":{"ephemeral_5m_input_tokens":1453,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKTJDiQkN7GnQk6Luj23","uuid":"c4f12c5b-ab18-4643-9e24-32e3763afdec"}
{"parentUuid":"c4f12c5b-ab18-4643-9e24-32e3763afdec","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:55:22.206Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UorZnBfUHMooUPtA8cyjMA","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01K3BpPNe6kQYFy5ik5C528T","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2464,"limit":40}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1453,"cache_read_input_tokens":37754,"cache_creation":{"ephemeral_5m_input_tokens":1453,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKTJDiQkN7GnQk6Luj23","uuid":"2c87d95d-0b6d-49f9-acc7-ddf6dc52fef7"}
{"parentUuid":"2c87d95d-0b6d-49f9-acc7-ddf6dc52fef7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01K3BpPNe6kQYFy5ik5C528T","type":"tool_result","content":"  2464→                    </div>\n  2465→                </div>\n  2466→            </div>\n  2467→        `;\n  2468→    });\n  2469→    if (etapa.fecha_ejecucion == null) {\n  2470→        $('#contenedor-cantidad-adjuntos').empty();\n  2471→        return `\n  2472→            <div class=\"col-12\">\n  2473→                <div class=\"row justify-content-center my-14\">\n  2474→                    <div class=\"col-auto\">\n  2475→                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n  2476→                    </div>\n  2477→                    <div class=\"col-12 text-center text-headline-5\">\n  2478→                        Este candidato aún no ha adjuntado los documentos para contratación\n  2479→                    </div>\n  2480→                    ${etapa.id != null ? `\n  2481→                        <div class=\"col-auto mt-10\">\n  2482→                            ${crearBoton({\n  2483→                                clases: 'btn-outline-primary',\n  2484→                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2485→                                onclick: \"$('#documentos_contratacion').click();\"\n  2486→                            })}\n  2487→                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n  2488→                        </div>\n  2489→                    ` : ''}\n  2490→                </div>\n  2491→            </div>\n  2492→        `;\n  2493→    } else {\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );\n  2498→            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2499→        }, 100);\n  2500→        return `\n  2501→            <div class=\"col-12\">\n  2502→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n  2503→                    <div class=\"col-12\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b4293d1d-ef6d-421c-8a81-83cd49e504ae","timestamp":"2026-01-20T22:55:24.693Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">","numLines":40,"startLine":2464,"totalLines":2697}}}
{"parentUuid":"b4293d1d-ef6d-421c-8a81-83cd49e504ae","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:55:36.023Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_019d3wNCqyLnJd96mLbHTAPT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XPT9uKYDDCvoxFS9VTbqoU","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {","new_string":"    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":981,"cache_read_input_tokens":39207,"cache_creation":{"ephemeral_5m_input_tokens":981,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKTJpae8Cbf5iJNmons2","uuid":"e3be4e82-66a6-41e9-a3aa-063a9a723b67"}
{"parentUuid":"e3be4e82-66a6-41e9-a3aa-063a9a723b67","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XPT9uKYDDCvoxFS9VTbqoU","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2465→                </div>\n  2466→            </div>\n  2467→        `;\n  2468→    });\n  2469→    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n  2470→        $('#contenedor-cantidad-adjuntos').empty();\n  2471→        return `\n  2472→            <div class=\"col-12\">\n  2473→                <div class=\"row justify-content-center my-14\">\n  2474→                    <div class=\"col-auto\">\n  2475→                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n  2476→                    </div>\n  2477→                    <div class=\"col-12 text-center text-headline-5\">\n  2478→                        Este candidato aún no ha adjuntado los documentos para contratación\n  2479→                    </div>\n  2480→                    ${etapa.id != null ? `\n  2481→                        <div class=\"col-auto mt-10\">\n  2482→                            ${crearBoton({\n  2483→                                clases: 'btn-outline-primary',\n  2484→                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2485→                                onclick: \"$('#documentos_contratacion').click();\"\n  2486→                            })}\n  2487→                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n  2488→                        </div>\n  2489→                    ` : ''}\n  2490→                </div>\n  2491→            </div>\n  2492→        `;\n  2493→    } else {\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );"}]},"uuid":"bf9a7ac8-2d8f-4674-8998-b86ef267b37a","timestamp":"2026-01-20T22:55:47.561Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {","newString":"    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2466,"oldLines":7,"newStart":2466,"newLines":7,"lines":["             </div>","         `;","     });","-    if (etapa.fecha_ejecucion == null) {","+    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {","         $('#contenedor-cantidad-adjuntos').empty();","         return `","             <div class=\"col-12\">"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"bf9a7ac8-2d8f-4674-8998-b86ef267b37a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:55:55.728Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RLUq4bDe6y8H1yy3y9nAxm","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora la lógica es:\n\n| `fecha_ejecucion` | Archivos empresa (`cliente_empresa_`) | Comportamiento |\n|-------------------|---------------------------------------|----------------|\n| `null` | 0 | Muestra mensaje \"aún no ha adjuntado\" |\n| `null` | > 0 | Muestra solo archivos de la empresa |\n| Con fecha | - | Muestra todos los archivos |\n\nEl flujo:\n1. Primero filtra los archivos (solo `cliente_empresa_` si `fecha_ejecucion` es null)\n2. Si `fecha_ejecucion` es null **Y** no hay archivos de empresa → mensaje vacío\n3. Si hay archivos (de empresa o todos) → muestra la lista"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1473,"cache_read_input_tokens":40188,"cache_creation":{"ephemeral_5m_input_tokens":1473,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKTLdm59L8gW5GDy61M7","uuid":"64d5e72b-3f48-4f66-947e-a73877142632"}
{"parentUuid":"64d5e72b-3f48-4f66-947e-a73877142632","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 2498 to 2498 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\n$('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n\nThis may or may not be related to the current task.</ide_selection>"}]},"uuid":"d616742c-9577-4e78-b3b0-4358776c61b5","timestamp":"2026-01-20T22:57:16.176Z"}
{"parentUuid":"d616742c-9577-4e78-b3b0-4358776c61b5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"listo y aqui $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`); solo deven contar los que esta argando el aplicante"}]},"uuid":"14c6d4cf-c663-4898-9eb5-745e5b105424","timestamp":"2026-01-20T22:57:16.176Z"}
{"parentUuid":"14c6d4cf-c663-4898-9eb5-745e5b105424","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:57:19.682Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01B2ymEiNycW3smfCaCZaf49","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo, el contador de adjuntos solo debe contar los archivos del aplicante (los que NO tienen el prefijo `cliente_empresa_`)."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":386,"cache_read_input_tokens":41661,"cache_creation":{"ephemeral_5m_input_tokens":386,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKTT2sYM2a8KQYPN91WU","uuid":"38862f51-2052-447e-a6bc-e679c1d78da0"}
{"parentUuid":"38862f51-2052-447e-a6bc-e679c1d78da0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:57:22.935Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01B2ymEiNycW3smfCaCZaf49","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013sg8j4B2KiigRAq4X23Ej8","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","new_string":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":386,"cache_read_input_tokens":41661,"cache_creation":{"ephemeral_5m_input_tokens":386,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKTT2sYM2a8KQYPN91WU","uuid":"0b4700a0-edf0-41ba-81d2-dcd582a4e640"}
{"parentUuid":"0b4700a0-edf0-41ba-81d2-dcd582a4e640","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has not been read yet. Read it first before writing to it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_013sg8j4B2KiigRAq4X23Ej8"}]},"uuid":"d9022ce0-e308-4233-a887-4fb5e6b499d6","timestamp":"2026-01-20T22:57:24.045Z","toolUseResult":"Error: File has not been read yet. Read it first before writing to it."}
{"parentUuid":"d9022ce0-e308-4233-a887-4fb5e6b499d6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:57:27.690Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RWBUQe6Y6CFKa9x6Z2vEZq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UJRenrjxuehN4tdDYu3qef","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2493,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":358,"cache_read_input_tokens":42047,"cache_creation":{"ephemeral_5m_input_tokens":358,"ephemeral_1h_input_tokens":0},"output_tokens":20,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKTTd9oseNvZFh23U7rt","uuid":"d2915013-607e-4a43-a59d-a2ec88181273"}
{"parentUuid":"d2915013-607e-4a43-a59d-a2ec88181273","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UJRenrjxuehN4tdDYu3qef","type":"tool_result","content":"  2493→    } else {\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );\n  2498→            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2499→        }, 100);\n  2500→        return `\n  2501→            <div class=\"col-12\">\n  2502→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n  2503→                    <div class=\"col-12\">\n  2504→                        <div class=\"row justify-content-between align-items-center mb-4\">\n  2505→                            <div class=\"col-auto text-body-2 text-gray-10\">\n  2506→                                Archivos adjuntos\n  2507→                            </div>\n  2508→                            <div class=\"col-auto\">\n  2509→                                ${crearBoton({\n  2510→                                    clases: 'btn-outline-primary',\n  2511→                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n  2512→                                    onclick: `$('#documentos_contratacion').click();`\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c0329e3b-e42f-41f1-83c7-b1bbc6930368","timestamp":"2026-01-20T22:57:29.514Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`","numLines":20,"startLine":2493,"totalLines":2697}}}
{"parentUuid":"c0329e3b-e42f-41f1-83c7-b1bbc6930368","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:57:35.330Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01EKCrCK5M1G9jwNd4fEvsa2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TRYhRr7yoU8NEEpBhzUw6M","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","new_string":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":594,"cache_read_input_tokens":42405,"cache_creation":{"ephemeral_5m_input_tokens":594,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKTU2zmCe9Bod4AzDFnv","uuid":"2de6de95-4c48-4608-9492-302310f903d7"}
{"parentUuid":"2de6de95-4c48-4608-9492-302310f903d7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TRYhRr7yoU8NEEpBhzUw6M","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );\n  2498→            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n  2499→            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2500→        }, 100);\n  2501→        return `\n  2502→            <div class=\"col-12\">\n  2503→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">"}]},"uuid":"179969cf-17a6-4026-bc1e-b5d384346d80","timestamp":"2026-01-20T22:57:43.796Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","newString":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2495,"oldLines":7,"newStart":2495,"newLines":8,"lines":["             $('#contenedor-cantidad-adjuntos').empty().append(","                 crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})","             );","-            $('.cantidad-adjuntos').text(`${etapa.archivos_solicitados.archivos_guardados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","+            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));","+            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","         }, 100);","         return `","             <div class=\"col-12\">"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"179969cf-17a6-4026-bc1e-b5d384346d80","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T22:57:50.729Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MZazg73MNuKK8jPBnTLRfi","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora el contador solo cuenta los archivos del aplicante (los que **NO** comienzan con `cliente_empresa_`).\n\nPor ejemplo, si hay:\n- 5 documentos solicitados\n- 3 archivos guardados: 1 de empresa (`cliente_empresa_xxx`) + 2 del aplicante\n\nEl tag mostrará: **\"2 de 5 Adjuntos\"**"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":562,"cache_read_input_tokens":42999,"cache_creation":{"ephemeral_5m_input_tokens":562,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKTVCazhqG7LoKAn2o7E","uuid":"98ffbe73-1623-4c9f-ac4d-70aecb31a3a7"}
{"parentUuid":"98ffbe73-1623-4c9f-ac4d-70aecb31a3a7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 493 to 493 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js:\n<span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n\nThis may or may not be related to the current task.</ide_selection>"}]},"uuid":"0b4606d3-2f1e-4ee1-8ca9-1af62ff5abdb","timestamp":"2026-01-20T23:06:03.924Z"}
{"parentUuid":"0b4606d3-2f1e-4ee1-8ca9-1af62ff5abdb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"mira aqui <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span> quiero que lo cambies por la fecha del created_at"}]},"uuid":"6e997712-f061-4b77-871c-9b839d5030b4","timestamp":"2026-01-20T23:06:03.924Z"}
{"parentUuid":"6e997712-f061-4b77-871c-9b839d5030b4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:06:08.693Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WVQkoaH1j6MY6FHT2u3yQA","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TGd1a5ngijj1RYkKZ3U3t8","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","offset":480,"limit":40}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":43906,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":43906,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKU7xuGGGNL3yyx8asAV","uuid":"fb4f06bd-c54c-4d90-9445-cac1e8d5fcd4"}
{"parentUuid":"fb4f06bd-c54c-4d90-9445-cac1e8d5fcd4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TGd1a5ngijj1RYkKZ3U3t8","type":"tool_result","content":"   480→                        ${ubicacion ? `\n   481→                            <div class=\"d-flex align-items-center gap-2 mt-3\">\n   482→                                <span class=\"text-label-2 text-gray-30\">${ubicacion}</span>\n   483→                            </div>\n   484→                        ` : ''}\n   485→                    </div>\n   486→                    <div class=\"flex-grow-1\">\n   487→                        <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>\n   488→                        <div class=\"candidato-info d-flex flex-column gap-1\">\n   489→                            ${etapa_descarte_html}\n   490→                            ${(origen === 'modal' && fecha_notificacion) ? `\n   491→                                <div class=\"d-flex align-items-center gap-2\">\n   492→                                    <i class=\"bi bi-calendar-event\"></i>\n   493→                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n   494→                                </div>\n   495→                            ` : ''}\n   496→                            ${documento ? `\n   497→                                <div class=\"d-flex align-items-center gap-2\">\n   498→                                    <img width=\"12\" heigth=\"16\" src=\"/iconos/file-person.png\">\n   499→                                    <span class=\"text-label-2\">No. documento: ${documento}</span>\n   500→                                </div>\n   501→                            ` : ''}\n   502→                            ${experiencia ? `\n   503→                                <div class=\"d-flex align-items-center gap-2\">\n   504→                                    <i class=\"bi bi-briefcase\"></i>\n   505→                                    <span class=\"text-label-2\">Experiencia: ${experiencia}</span>\n   506→                                </div>\n   507→                            ` : ''}\n   508→                            ${salario_solicitado ? `\n   509→                                <div class=\"d-flex align-items-center gap-2\">\n   510→                                    <i class=\"bi bi-currency-dollar\"></i>\n   511→                                    <span class=\"text-label-2\">${salario_solicitado}</span>\n   512→                                </div>\n   513→                            ` : ''}\n   514→                        </div>\n   515→                    </div>\n   516→\n   517→                    <div class=\"d-flex flex-column align-items-end gap-2\">\n   518→                        ${generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono)}\n   519→                    </div>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"24a16871-da20-4043-a2fb-162c959b53cd","timestamp":"2026-01-20T23:06:10.973Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","content":"                        ${ubicacion ? `\n                            <div class=\"d-flex align-items-center gap-2 mt-3\">\n                                <span class=\"text-label-2 text-gray-30\">${ubicacion}</span>\n                            </div>\n                        ` : ''}\n                    </div>\n                    <div class=\"flex-grow-1\">\n                        <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>\n                        <div class=\"candidato-info d-flex flex-column gap-1\">\n                            ${etapa_descarte_html}\n                            ${(origen === 'modal' && fecha_notificacion) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n                                </div>\n                            ` : ''}\n                            ${documento ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <img width=\"12\" heigth=\"16\" src=\"/iconos/file-person.png\">\n                                    <span class=\"text-label-2\">No. documento: ${documento}</span>\n                                </div>\n                            ` : ''}\n                            ${experiencia ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-briefcase\"></i>\n                                    <span class=\"text-label-2\">Experiencia: ${experiencia}</span>\n                                </div>\n                            ` : ''}\n                            ${salario_solicitado ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-currency-dollar\"></i>\n                                    <span class=\"text-label-2\">${salario_solicitado}</span>\n                                </div>\n                            ` : ''}\n                        </div>\n                    </div>\n\n                    <div class=\"d-flex flex-column align-items-end gap-2\">\n                        ${generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono)}\n                    </div>","numLines":40,"startLine":480,"totalLines":1845}}}
{"parentUuid":"24a16871-da20-4043-a2fb-162c959b53cd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:06:15.290Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_019f5HqDdoSjUZHKE3hUb5wY","type":"message","role":"assistant","content":[{"type":"text","text":"Necesito ver dónde se define `fecha_notificacion` y verificar si `created_at` está disponible en el contexto."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":954,"cache_read_input_tokens":43906,"cache_creation":{"ephemeral_5m_input_tokens":954,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKU8TYh6r2uu4cyR4Gc4","uuid":"7f9dd146-ad2e-4a3c-85fe-e701310762d6"}
{"parentUuid":"7f9dd146-ad2e-4a3c-85fe-e701310762d6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:06:16.337Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_019f5HqDdoSjUZHKE3hUb5wY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QMMP4usH6e9mNtDTsbLfww","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","offset":420,"limit":60}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":954,"cache_read_input_tokens":43906,"cache_creation":{"ephemeral_5m_input_tokens":954,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKU8TYh6r2uu4cyR4Gc4","uuid":"51b4671b-f754-432a-b08d-f7607e89af5b"}
{"parentUuid":"51b4671b-f754-432a-b08d-f7607e89af5b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QMMP4usH6e9mNtDTsbLfww","type":"tool_result","content":"   420→    var etiqueta_estilo = '';\n   421→    if (adecuacion >= 10 && adecuacion <= 40) {\n   422→        borde_color = 'borde-indice-talento-rojo';\n   423→        etiqueta_estilo = 'badge-indice-talento-rojo';\n   424→    } else if (adecuacion >= 41 && adecuacion <= 70) {\n   425→        borde_color = 'borde-indice-talento-amarillo';\n   426→        etiqueta_estilo = 'badge-indice-talento-amarillo';\n   427→    } else if (adecuacion >= 71 && adecuacion <= 100) {\n   428→        borde_color = 'borde-indice-talento-verde';\n   429→        etiqueta_estilo = 'badge-indice-talento-verde';\n   430→    }\n   431→\n   432→    var tiene_motivo_abandono = origen === 'modal' && usuario_vacante.etapa_descarte?.motivo_abandono !== null;\n   433→\n   434→    var checkbox_html = !tiene_motivo_abandono ?\n   435→        crearCheckbox({\n   436→            id: `candidato-check-${usuario_vacante.id}`,\n   437→            name: `candidato_check`,\n   438→            value: usuario_vacante.id,\n   439→            class: 'candidato-checkbox',\n   440→            input_container_class: 'd-inline-block'\n   441→        }) : '';\n   442→\n   443→    var etapa_descarte_html = origen === 'modal' && usuario_vacante.etapa_descarte ?\n   444→        `${crearTag({\n   445→            texto: `Etapa de descarte: ${usuario_vacante.etapa_descarte.nombre}`,\n   446→            class: 'tag-tonal-orange w-fit-content',\n   447→        })}` : '';\n   448→\n   449→    var fecha_notificacion = '';\n   450→    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {\n   451→        var fecha = new Date(usuario_vacante.fecha_notificacion);\n   452→        var dia = fecha.getDate();\n   453→        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n   454→        var anio = fecha.getFullYear();\n   455→        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n   456→    }\n   457→\n   458→\n   459→    return `\n   460→        <div class=\"card candidato-card mb-3\" data-candidato-id=\"${usuario.id}\" data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\" data-tiene-pruebas-requeridas=\"${usuario_vacante.tiene_pruebas_requeridas || false}\">\n   461→            <div class=\"card-body p-3\">\n   462→                <div class=\"d-flex align-items-center gap-3\">\n   463→                    ${checkbox_html}\n   464→                    <div class=\"position-relative d-flex flex-column align-items-center justify-content-center text-center\">\n   465→                        <img class=\"candidato-avatar ${borde_color}\"\n   466→                            onclick=\"verDetalleCandidato(${usuario.id})\"\n   467→                            src=\"/usuarios-imagen/${usuario.id}\"\n   468→                            ${crearTooltip({\n   469→                                placement: `bottom`,\n   470→                                content: `Ver detalle del candidato`,\n   471→                                toggle: `popover`,\n   472→                            })}>\n   473→\n   474→                        ${(adecuacion !== null && adecuacion > 0) ? `\n   475→                            <span class=\"candidato-badge-detalle text-label-1 badge ${etiqueta_estilo} position-absolute\">\n   476→                                ${adecuacion ? `${adecuacion}%` : ''}\n   477→                            </span>\n   478→                        ` : ''}\n   479→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"23678c57-7f9c-4ab3-af6f-5b1ff9b82aae","timestamp":"2026-01-20T23:06:17.658Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","content":"    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    var tiene_motivo_abandono = origen === 'modal' && usuario_vacante.etapa_descarte?.motivo_abandono !== null;\n\n    var checkbox_html = !tiene_motivo_abandono ?\n        crearCheckbox({\n            id: `candidato-check-${usuario_vacante.id}`,\n            name: `candidato_check`,\n            value: usuario_vacante.id,\n            class: 'candidato-checkbox',\n            input_container_class: 'd-inline-block'\n        }) : '';\n\n    var etapa_descarte_html = origen === 'modal' && usuario_vacante.etapa_descarte ?\n        `${crearTag({\n            texto: `Etapa de descarte: ${usuario_vacante.etapa_descarte.nombre}`,\n            class: 'tag-tonal-orange w-fit-content',\n        })}` : '';\n\n    var fecha_notificacion = '';\n    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {\n        var fecha = new Date(usuario_vacante.fecha_notificacion);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }\n\n\n    return `\n        <div class=\"card candidato-card mb-3\" data-candidato-id=\"${usuario.id}\" data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\" data-tiene-pruebas-requeridas=\"${usuario_vacante.tiene_pruebas_requeridas || false}\">\n            <div class=\"card-body p-3\">\n                <div class=\"d-flex align-items-center gap-3\">\n                    ${checkbox_html}\n                    <div class=\"position-relative d-flex flex-column align-items-center justify-content-center text-center\">\n                        <img class=\"candidato-avatar ${borde_color}\"\n                            onclick=\"verDetalleCandidato(${usuario.id})\"\n                            src=\"/usuarios-imagen/${usuario.id}\"\n                            ${crearTooltip({\n                                placement: `bottom`,\n                                content: `Ver detalle del candidato`,\n                                toggle: `popover`,\n                            })}>\n\n                        ${(adecuacion !== null && adecuacion > 0) ? `\n                            <span class=\"candidato-badge-detalle text-label-1 badge ${etiqueta_estilo} position-absolute\">\n                                ${adecuacion ? `${adecuacion}%` : ''}\n                            </span>\n                        ` : ''}\n","numLines":60,"startLine":420,"totalLines":1845}}}
{"parentUuid":"23678c57-7f9c-4ab3-af6f-5b1ff9b82aae","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:06:21.565Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01USYVHDcyQzGcnzMspTQeHW","type":"message","role":"assistant","content":[{"type":"text","text":"Veo que usa `usuario_vacante.fecha_notificacion`. Necesito agregar lógica para usar `created_at` en su lugar. Voy a crear una nueva variable para la fecha de descarte usando `created_at`."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1337,"cache_read_input_tokens":44860,"cache_creation":{"ephemeral_5m_input_tokens":1337,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKU8xXDcmA61NrdjkfdQ","uuid":"e3b574bb-051f-47ab-ad5b-4acac5c7e8e5"}
{"parentUuid":"e3b574bb-051f-47ab-ad5b-4acac5c7e8e5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:06:29.901Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01USYVHDcyQzGcnzMspTQeHW","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01L8HTtSG2JTRDtGiMGpzxbw","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","old_string":"    var fecha_notificacion = '';\n    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {\n        var fecha = new Date(usuario_vacante.fecha_notificacion);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }","new_string":"    var fecha_descarte = '';\n    if (origen === 'modal' && usuario_vacante.created_at) {\n        var fecha = new Date(usuario_vacante.created_at);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_descarte = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1337,"cache_read_input_tokens":44860,"cache_creation":{"ephemeral_5m_input_tokens":1337,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKU8xXDcmA61NrdjkfdQ","uuid":"24878592-5cbb-43c6-8c7c-0a0feff16c6d"}
{"parentUuid":"24878592-5cbb-43c6-8c7c-0a0feff16c6d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01L8HTtSG2JTRDtGiMGpzxbw","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   445→            texto: `Etapa de descarte: ${usuario_vacante.etapa_descarte.nombre}`,\n   446→            class: 'tag-tonal-orange w-fit-content',\n   447→        })}` : '';\n   448→\n   449→    var fecha_descarte = '';\n   450→    if (origen === 'modal' && usuario_vacante.created_at) {\n   451→        var fecha = new Date(usuario_vacante.created_at);\n   452→        var dia = fecha.getDate();\n   453→        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n   454→        var anio = fecha.getFullYear();\n   455→        fecha_descarte = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n   456→    }\n   457→\n   458→\n   459→    return `\n   460→        <div class=\"card candidato-card mb-3\" data-candidato-id=\"${usuario.id}\" data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\" data-tiene-pruebas-requeridas=\"${usuario_vacante.tiene_pruebas_requeridas || false}\">"}]},"uuid":"cb2c5023-9b6e-4a3a-9fe7-4449275260a1","timestamp":"2026-01-20T23:07:29.662Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","oldString":"    var fecha_notificacion = '';\n    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {\n        var fecha = new Date(usuario_vacante.fecha_notificacion);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }","newString":"    var fecha_descarte = '';\n    if (origen === 'modal' && usuario_vacante.created_at) {\n        var fecha = new Date(usuario_vacante.created_at);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_descarte = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }","originalFile":"/**\n * Archivo para el manejo de etapas en el detalle de vacantes\n * @author Andres Morales\n*/\n\nlet candidatos_descartados = [];\nlet candidatos_seleccionados = [];\nlet json_filtros_etapas = {};\nlet es_primera_carga = true;\nlet posicion_scroll_guardada = 0;\n\n$(document).ready(function() {\n    consultarPaisesListadoCompleto(true);\n    observarCambiosChips();\n    cargarEtapasConCandidatos();\n});\n\n/**\n * Cargar etapas de la vacante con sus candidatos desde el endpoint.\n *\n * @param {Object} filtros Objeto con filtros a aplicar (opcional).\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction cargarEtapasConCandidatos(filtros = {}) {\n    // Guardar posición del scroll antes de actualizar (solo si no es la primera carga)\n    if (!es_primera_carga) {\n        var $contenedor = $('#contenido-etapas-lista');\n        if ($contenedor.length) {\n            posicion_scroll_guardada = $contenedor.scrollLeft();\n        }\n    }\n\n    $.ajax({\n        url: `/etapas-vacantes-aplicantes/${VACANTE_ID}`,\n        type: 'GET',\n        dataType: 'json',\n        data: {\n            ciudad_id: filtros.ciudad_id || '',\n            departamento_id: filtros.departamento_id || '',\n            pais_id: filtros.pais_id || '',\n            etapa_id: filtros.etapa_id || '',\n            nivel_educativo_id: filtros.nivel_educativo_id || '',\n            fecha_desde: filtros.fecha_desde || '',\n            fecha_hasta: filtros.fecha_hasta || '',\n            edad: filtros.edad || '',\n            chips: filtros.chips,\n            nivel_adecuacion: filtros.nivel_adecuacion || ''\n        },\n        success: function(respuesta) {\n            let datos = respuesta.data;\n            renderizarEtapas(datos.etapas, calcularTotalCandidatos(datos.etapas) + datos.descartados.length);\n            actualizarConteoDescartados(datos.descartados.length);\n\n            candidatos_descartados = datos.descartados;\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Calcular el total de candidatos en todas las etapas.\n *\n * @param {Array} etapas Array de etapas con candidatos.\n * @returns {number} Total de candidatos.\n * @author Andres Morales\n */\nfunction calcularTotalCandidatos(etapas) {\n    let total = 0;\n    etapas.forEach(etapa => {\n        if (etapa.usuarios_vacantes) {\n            total += etapa.usuarios_vacantes.length;\n        }\n    });\n    return total;\n}\n\n/**\n * Observar cambios en el contenedor de chips para mostrar/ocultar el wrapper.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction observarCambiosChips() {\n    var $contenedor_chips = $('#contenedor-chips-etapa-filtro-candidatos');\n    var $envolvente = $('#contenedor-chips-wrapper-etapa-filtro-candidatos');\n\n    if ($contenedor_chips.length === 0 || $envolvente.length === 0) return;\n\n    var observador = new MutationObserver(function() {\n        var tiene_chips = $contenedor_chips.children().length > 0;\n\n        if (tiene_chips) {\n            $envolvente.removeClass('d-none');\n        } else {\n            $envolvente.addClass('d-none');\n        }\n    });\n\n    observador.observe($contenedor_chips[0], {\n        childList: true,\n        subtree: false\n    });\n}\n\n/**\n * Actualizar el conteo de aplicantes en el botón.\n *\n * @param {number} conteo Número de candidatos aplicantes.\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarConteoAplicantes(conteo) {\n    $('#etapa-total-candidatos').text(`${conteo}`);\n}\n\n/**\n * Actualizar el badge de conteo de descartados.\n *\n * @param {number} conteo Número de candidatos descartados.\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarConteoDescartados(conteo) {\n    $('#etapa-total-descartados').text(conteo);\n}\n\n/**\n * Cargar las etapas en el select2 del filtro.\n *\n * @param {Array} etapas Array de etapas de la vacante.\n * @returns {void}\n * @author Andres Morales\n */\nfunction cargarEtapasEnFiltro(etapas) {\n    var $select_etapa_filtro = $('#etapa_filtro');\n\n    if (!$select_etapa_filtro.length) return;\n\n    $select_etapa_filtro.empty();\n\n    var opcion_todas = new Option('Todas', '', false, false);\n    $select_etapa_filtro.append(opcion_todas);\n\n    etapas.sort((a, b) => a.orden - b.orden);\n\n    etapas.forEach(function(etapa) {\n        var opcion = new Option(etapa.nombre, etapa.id, false, false);\n        $select_etapa_filtro.append(opcion);\n    });\n\n    $select_etapa_filtro.trigger('change');\n}\n\n/**\n * Animar scroll horizontal del contenedor de etapas.\n * Desplaza desde el final hasta el inicio (solo en primera carga).\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction animarScrollEtapas() {\n    var $contenedor = $('#contenido-etapas-lista');\n\n    if (!$contenedor.length) return;\n\n    var ancho_scroll = $contenedor[0].scrollWidth - $contenedor[0].clientWidth;\n\n    if (ancho_scroll <= 0) return;\n\n    // Posicionar al final primero\n    $contenedor.scrollLeft(ancho_scroll);\n\n    // Animar de final a inicio\n    $contenedor.animate(\n        { scrollLeft: 0 },\n        {\n            duration: 1500,\n            easing: 'swing'\n        }\n    );\n}\n\n/**\n * Renderizar las etapas de la vacante en cards horizontales.\n *\n * @param {Array} etapas Array de etapas de la vacante.\n * @param {number} conteo_aplicantes Cantidad de aplicantes de la vacante.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author Jair Carvajal\n */\nfunction renderizarEtapas(etapas, conteo_aplicantes) {\n    var $contenido_lista = $('#contenido-etapas-lista');\n    var $contenido_vacio = $('#contenido-etapas-empty');\n    var $contenido_controles = $('#contenido-etapas-controles');\n\n    // Verificar si hay filtros activos\n    var hay_filtros_activos = Object.keys(json_filtros_etapas).length > 0;\n\n    // Solo mostrar empty state si NO hay aplicantes Y NO hay filtros activos\n    if ((!conteo_aplicantes || conteo_aplicantes === 0) && !hay_filtros_activos) {\n        $contenido_lista.addClass('d-none');\n        $contenido_controles.addClass('d-none');\n        $contenido_vacio.removeClass('d-none');\n        return;\n    }\n\n    $contenido_vacio.addClass('d-none');\n    $contenido_lista.removeClass('d-none');\n    $contenido_controles.removeClass('d-none');\n\n    if (!etapas || etapas.length === 0) {\n        $contenido_lista.html(`\n            <div class=\"w-100 text-center py-5\">\n                <p class=\"text-muted\">${hay_filtros_activos ? 'No se encontraron coincidencias con los filtros aplicados. vuelve a intentar con otros filtros' : 'No hay etapas configuradas para esta vacante'}</p>\n            </div>\n        `);\n        return;\n    }\n\n    let html = '';\n    etapas.sort((a, b) => a.orden - b.orden);\n\n    // Filtrar la etapa con el orden inmediatamente anterior al orden 8 (Contratados)\n    let etapa_anterior_orden_8 = etapas\n        .filter(etapa => etapa.orden < 8)\n        .sort((a, b) => b.orden - a.orden)[0];\n\n    etapas.forEach((etapa) => {\n        html += crearTarjetaEtapa(etapa, etapa_anterior_orden_8);\n    });\n\n    $contenido_lista.html(html);\n\n    cargarEtapasEnFiltro(etapas);\n\n    // Ejecutar animación solo en la primera carga, de lo contrario restaurar posición\n    if (es_primera_carga) {\n        animarScrollEtapas();\n        es_primera_carga = false;\n    } else {\n        // Restaurar la posición del scroll guardada\n        setTimeout(() => {\n            $contenido_lista.scrollLeft(posicion_scroll_guardada);\n        }, 50);\n    }\n\n    inicializarEventosCheckboxes();\n\n    // Inicializar tooltips después de renderizar\n    setTimeout(() => {\n        inicializarTooltips();\n    }, 100);\n}\n\n/**\n * Crear una tarjeta(card) de etapa.\n *\n * @param {Object} etapa Datos de la etapa.\n * @param {Object} etapa_anterior_orden_8 Etapa con el orden inmediatamente anterior al orden 8.\n * @returns {string} HTML de la card.\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author Jair Carvajal\n */\nfunction crearTarjetaEtapa(etapa, etapa_anterior_orden_8) {\n    let etapa_anterior_contracion = false;\n\n    if (etapa_anterior_orden_8 && etapa.orden === etapa_anterior_orden_8.orden && etapa.activa == 1) {\n        etapa_anterior_contracion = true;\n    }\n\n    // Detectar si es etapa de prueba técnica sin archivos\n    let es_prueba_tecnica = etapa.nombre === 'Prueba técnica';\n    let tiene_prueba_tecnica_cargada = etapa?.prueba_cargada ?? true;\n\n    let candidatos_html = '';\n    let candidatos_totales = 0;\n    let candidatos_completaron = 0;\n\n    // Mostrar mensaje si es prueba técnica sin archivos\n    if (es_prueba_tecnica && !tiene_prueba_tecnica_cargada) {\n        let html = crearMensajeSinArchivosInstrucciones(etapa.id);\n\n        // Si hay candidatos, agregarlos después del mensaje\n        if (etapa?.usuarios_vacantes?.length > 0) {\n            etapa.usuarios_vacantes.forEach((usuario_vacante) => {\n                html += crearCardCandidato(usuario_vacante, 'listado', etapa.nombre, etapa_anterior_contracion);\n            });\n            candidatos_totales = etapa.usuarios_vacantes.length;\n            candidatos_completaron = etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.puntaje !== null || usuario_vacante.puntaje_ia !== null).length;\n        }\n\n        candidatos_html = `<div class=\"candidatos-container\">${html}</div>`;\n    } else if (etapa?.usuarios_vacantes?.length > 0) {\n        let html = '';\n\n        etapa.usuarios_vacantes.forEach((usuario_vacante) => {\n            html += crearCardCandidato(usuario_vacante, 'listado', etapa.nombre, etapa_anterior_contracion);\n        });\n\n        candidatos_html = `<div class=\"candidatos-container\">${html}</div>`;\n        candidatos_totales = etapa.usuarios_vacantes.length;\n        candidatos_completaron = etapa.nombre === 'Documentos para contratación'\n            ? etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.etapa_completada === true).length\n            : etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.puntaje !== null || usuario_vacante.puntaje_ia !== null).length;\n    } else {\n        candidatos_html = `\n            <div class=\"d-flex justify-content-center align-items-center my-5\"><div class=\"etapa-icono-circulo\"><i class=\"bi bi-arrow-90deg-right\"></i></div></div>\n            <div class=\"mt-auto pb-10 px-5\"><p class=\"text-headline-5 text-gray-40 text-center mb-5 pb-10 px-6\">Mueve candidatos con el botón o arrástralos desde la etapa anterior. </p></div>\n        `;\n    }\n    return `\n        <div class=\"card etapa-card bg-gray-90\" data-etapa-id=\"${etapa.id}\">\n            <div class=\"card-body d-flex flex-column\">\n                <div class=\"d-flex align-items-center mb-3 gap-3\">\n                    ${crearCheckbox({\n                        id: 'etapa-check-' + etapa.id,\n                        name: 'etapa_check',\n                        value: etapa.id,\n                        checked: false,\n                        input_container_class: 'd-inline-block',\n                        disabled: (candidatos_totales > 0) ? false : true\n                    })}\n                    <h6 class=\"etapa-titulo text-headline-5 fw-bold mb-0\">${etapa.nombre}</h6>\n                    ${(candidatos_totales > 0 && etapa.nombre !== 'Contratados') ?\n                        `<div class=\"ms-auto\">\n                            ${crearTag({\n                                texto: candidatos_completaron + '/' + candidatos_totales + ' completaron la tarea',\n                                class: etapa.nombre === 'Documentos para contratación' ? 'tag-tonal-green' : 'tag-tonal-blue',\n                            })}\n                        </div>`\n                    : ''}\n                </div>\n                ${candidatos_html}\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Ver candidatos descartados en modal.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction verCandidatosDescartados() {\n    let $contenedor = $('#contenedor-candidatos-descartados');\n    let $controles = $('#controles-candidatos-descartados');\n\n    if (candidatos_descartados.length === 0) {\n        $controles.addClass('d-none');\n        $contenedor.html(`\n            <div class=\"row justify-content-center align-items-center py-5\">\n                <div class=\"col-auto text-center\">\n                    <div class=\"mb-4\">\n                        <i class=\"bi bi-person-x-fill empty-state-icon\"></i>\n                    </div>\n                    <div class=\"text-gray-30 fw-semibold text-headline-4 mb-3\">\n                        No hay candidatos descartados\n                    </div>\n                    <div class=\"text-gray-50 text-body-2\">\n                        Los candidatos que descartaste aparecerán aquí\n                    </div>\n                </div>\n            </div>\n        `);\n    } else {\n        $controles.removeClass('d-none');\n        let html = '';\n        candidatos_descartados.forEach(candidato => {\n            html += crearCardCandidato(candidato, 'modal');\n        });\n        $contenedor.html(html);\n\n        setTimeout(() => {\n            inicializarTooltips();\n            inicializarEventosModalDescartados();\n        }, 100);\n    }\n\n    $('#modal-candidatos-descartados').modal('show');\n}\n\n/**\n * Crear una card individual de candidato.\n *\n * @param {Object} usuario_vacante Datos del candidato aplicante.\n * @param {string} origen Origen del render: 'listado' o 'modal'. Default: 'listado'\n * @param {string} nombre_etapa Nombre de la etapa actual. Default: null\n * @returns {string} HTML de la card del candidato.\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidato(usuario_vacante, origen = 'listado', nombre_etapa = null, etapa_anterior_contracion = false) {\n    var usuario = usuario_vacante.usuario || {};\n    var nombre_completo = usuario.nombre_completo?.trim() || 'Sin nombre';\n    var salario = usuario?.perfiles_laborales[0]?.salario || 0;\n    var salario_maximo = usuario?.perfiles_laborales[0]?.salario_maximo || 0;\n\n    var salario_solicitado = (salario_maximo > 0) ? `Salario: ${formatearSalario(salario)} a ${formatearSalario(salario_maximo)}` : `Solicita ${formatearSalario(salario)}`;\n    var experiencia_meses = usuario?.perfiles_laborales[0]?.experiencia_laboral_meses || 0;\n    var experiencia = convertirMesesAAnios(experiencia_meses);\n\n    var ciudad = usuario.ciudad?.nombre || '';\n    var pais = usuario.ciudad?.departamento?.pais?.nombre || '';\n    var ubicacion = `${ciudad}${ciudad && pais ? ',' : ''}${pais}`;\n    \n    var documento = usuario.documento || '';\n\n    var adecuacion = usuario_vacante.adecuacion;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    var tiene_motivo_abandono = origen === 'modal' && usuario_vacante.etapa_descarte?.motivo_abandono !== null;\n\n    var checkbox_html = !tiene_motivo_abandono ?\n        crearCheckbox({\n            id: `candidato-check-${usuario_vacante.id}`,\n            name: `candidato_check`,\n            value: usuario_vacante.id,\n            class: 'candidato-checkbox',\n            input_container_class: 'd-inline-block'\n        }) : '';\n\n    var etapa_descarte_html = origen === 'modal' && usuario_vacante.etapa_descarte ?\n        `${crearTag({\n            texto: `Etapa de descarte: ${usuario_vacante.etapa_descarte.nombre}`,\n            class: 'tag-tonal-orange w-fit-content',\n        })}` : '';\n\n    var fecha_notificacion = '';\n    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {\n        var fecha = new Date(usuario_vacante.fecha_notificacion);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }\n\n\n    return `\n        <div class=\"card candidato-card mb-3\" data-candidato-id=\"${usuario.id}\" data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\" data-tiene-pruebas-requeridas=\"${usuario_vacante.tiene_pruebas_requeridas || false}\">\n            <div class=\"card-body p-3\">\n                <div class=\"d-flex align-items-center gap-3\">\n                    ${checkbox_html}\n                    <div class=\"position-relative d-flex flex-column align-items-center justify-content-center text-center\">\n                        <img class=\"candidato-avatar ${borde_color}\"\n                            onclick=\"verDetalleCandidato(${usuario.id})\"\n                            src=\"/usuarios-imagen/${usuario.id}\"\n                            ${crearTooltip({\n                                placement: `bottom`,\n                                content: `Ver detalle del candidato`,\n                                toggle: `popover`,\n                            })}>\n\n                        ${(adecuacion !== null && adecuacion > 0) ? `\n                            <span class=\"candidato-badge-detalle text-label-1 badge ${etiqueta_estilo} position-absolute\">\n                                ${adecuacion ? `${adecuacion}%` : ''}\n                            </span>\n                        ` : ''}\n\n                        ${ubicacion ? `\n                            <div class=\"d-flex align-items-center gap-2 mt-3\">\n                                <span class=\"text-label-2 text-gray-30\">${ubicacion}</span>\n                            </div>\n                        ` : ''}\n                    </div>\n                    <div class=\"flex-grow-1\">\n                        <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>\n                        <div class=\"candidato-info d-flex flex-column gap-1\">\n                            ${etapa_descarte_html}\n                            ${(origen === 'modal' && fecha_notificacion) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n                                </div>\n                            ` : ''}\n                            ${documento ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <img width=\"12\" heigth=\"16\" src=\"/iconos/file-person.png\">\n                                    <span class=\"text-label-2\">No. documento: ${documento}</span>\n                                </div>\n                            ` : ''}\n                            ${experiencia ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-briefcase\"></i>\n                                    <span class=\"text-label-2\">Experiencia: ${experiencia}</span>\n                                </div>\n                            ` : ''}\n                            ${salario_solicitado ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-currency-dollar\"></i>\n                                    <span class=\"text-label-2\">${salario_solicitado}</span>\n                                </div>\n                            ` : ''}\n                        </div>\n                    </div>\n\n                    <div class=\"d-flex flex-column align-items-end gap-2\">\n                        ${generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono)}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Ver y calificar candidato.\n *\n * @param {number} candidato_id ID del candidato.\n * @returns {void}\n * @author Andres Morales\n */\nfunction verCalificarCandidatos(candidato_id) {\n    mostrarToast('info','Calificar candidato:', candidato_id);\n}\n\n/**\n * Mover candidato a la siguiente etapa.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n * @author Sergio Vargas - Modificación para modal de competencias\n */\nfunction moverEtapaCandidato(etapa_vacante_usuario_id) {\n    verificarSiguienteEtapa(etapa_vacante_usuario_id, function(es_contratados) {\n        if (es_contratados) {\n            // Obtener el valor de tiene_pruebas_requeridas desde el atributo data de la card\n            var $contenedor_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n            var tiene_pruebas = $contenedor_candidato.attr('data-tiene-pruebas-requeridas') === 'true';\n\n            if (tiene_pruebas) {\n                mostrarModalCompetenciasMejorar(etapa_vacante_usuario_id);\n            } else {\n                Swal.fire({\n                    width: '533px',\n                    showCloseButton: true,\n                    closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n                    showConfirmButton: false,\n                    showDenyButton: false,\n                    showCancelButton: false,\n                    html: `\n                        <div class=\"row w-100 mx-0 mt-2\">\n                            <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Confirmar contratación</div>\n                            <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                                Estás a punto de pasar a Contratados al canditato seleccionado y finalizar esta vacante.\n                            </div>\n                            <div class=\"col-12 mt-5 text-start text-body-2 fw-semibold\">\n                                ¿Deseas continuar?\n                            </div>\n                            <div class=\"col-6 mt-5 mb-2\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary w-100 justify-content-center',\n                                    texto: 'Volver',\n                                    onclick: `Swal.clickDeny();`\n                                })}\n                            </div>\n                            <div class=\"col-6 mt-5 mb-2\">\n                                ${crearBoton({\n                                    clases: 'btn-primary w-100 justify-content-center',\n                                    texto: 'Continuar con la contratación',\n                                    onclick: `Swal.clickConfirm();`\n                                })}\n                            </div>\n                        </div>\n                    `,\n                }).then(async (resultado) => {\n                    if (resultado.isConfirmed) {\n                        ejecutarMovimientoEtapa(etapa_vacante_usuario_id);\n                    }\n                });\n            }\n        } else {\n            ejecutarMovimientoEtapa(etapa_vacante_usuario_id);\n        }\n    });\n}\n\n/**\n * Inicializar eventos de checkboxes.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction inicializarEventosCheckboxes() {\n    $(document).off('change', 'input[name=\"candidato_check\"]');\n    $(document).on('change', 'input[name=\"candidato_check\"]', function() {\n        let $etapa_tarjeta = $(this).closest('.etapa-card');\n        validarEstadoCheckboxEtapa($etapa_tarjeta);\n\n        actualizarContadorSeleccionados();\n        actualizarEstadoBotonDescartar();\n    });\n\n    $(document).off('change', 'input[name=\"etapa_check\"]');\n    $(document).on('change', 'input[name=\"etapa_check\"]', function() {\n        let comprobado = $(this).is(':checked');\n\n        let $etapa_tarjeta = $(this).closest('.etapa-card');\n        $etapa_tarjeta.find('input[name=\"candidato_check\"]').prop('checked', comprobado);\n\n        actualizarContadorSeleccionados();\n        actualizarEstadoBotonDescartar();\n    });\n}\n\n/**\n * Validar y actualizar el estado del checkbox de una etapa según sus candidatos.\n *\n * @param {jQuery} $etapa_tarjeta Card de la etapa a validar.\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarEstadoCheckboxEtapa($etapa_tarjeta) {\n    let $checkbox_etapa = $etapa_tarjeta.find('input[name=\"etapa_check\"]');\n    let $checkboxes_candidatos = $etapa_tarjeta.find('input[name=\"candidato_check\"]');\n\n    let total_candidatos = $checkboxes_candidatos.length;\n    let candidatos_seleccionados_etapa = $checkboxes_candidatos.filter(':checked').length;\n\n    if (candidatos_seleccionados_etapa === 0) {\n        $checkbox_etapa.prop('indeterminate', false);\n        $checkbox_etapa.prop('checked', false);\n    } else if (candidatos_seleccionados_etapa === total_candidatos) {\n        $checkbox_etapa.prop('indeterminate', false);\n        $checkbox_etapa.prop('checked', true);\n    } else {\n        $checkbox_etapa.prop('indeterminate', true);\n        $checkbox_etapa.prop('checked', false);\n    }\n}\n\n/**\n * Actualizar el contador de candidatos seleccionados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarContadorSeleccionados() {\n    let checkboxes_seleccionados = $('input[name=\"candidato_check\"]:checked');\n    let contador = checkboxes_seleccionados.length;\n\n    $('#etapa-total-seleccionados').text(contador);\n\n    candidatos_seleccionados = checkboxes_seleccionados.map(function() {\n        return parseInt($(this).val(), 10);\n    }).get();\n}\n\n/**\n * Actualizar estado del botón de descartar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarEstadoBotonDescartar() {\n    let hay_seleccionados = candidatos_seleccionados.length > 0;\n\n    if (hay_seleccionados) {\n        $('#etapa-boton-descartar').prop('disabled', false);\n        $('#etapa-boton-descartar').attr('onclick', 'descartarCandidatos()');\n    } else {\n        $('#etapa-boton-descartar').prop('disabled', true);\n        $('#etapa-boton-descartar').attr('onclick', '');\n    }\n}\n\n/**\n * Aplicar filtros y recargar etapas.\n *\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction aplicarFiltrosDropdown(filtros) {\n    json_filtros_etapas = filtros;\n\n    let filtros_endpoint = {};\n\n    if (filtros.ciudad_filtro) filtros_endpoint.ciudad_id = filtros.ciudad_filtro;\n    if (filtros.departamento_filtro) filtros_endpoint.departamento_id = filtros.departamento_filtro;\n    if (filtros.pais_filtro) filtros_endpoint.pais_id = filtros.pais_filtro;\n    if (filtros.etapa_filtro) filtros_endpoint.etapa_id = filtros.etapa_filtro;\n    if (filtros.nivel_academico_filtro) filtros_endpoint.nivel_educativo_id = filtros.nivel_academico_filtro;\n    if (filtros.edad_filtro) filtros_endpoint.edad = filtros.edad_filtro;\n    if (filtros.nivel_adecuacion_filtro) filtros_endpoint.nivel_adecuacion = filtros.nivel_adecuacion_filtro;\n\n    if (filtros.fecha_agregado_filtro) {\n        let partes_fecha = filtros.fecha_agregado_filtro.split(' a ');\n        if (partes_fecha[0]) filtros_endpoint.fecha_desde = partes_fecha[0];\n        if (partes_fecha[1]) filtros_endpoint.fecha_hasta = partes_fecha[1];\n    }\n\n    if (filtros.chips && filtros.chips.length > 0) {\n        filtros_endpoint.chips = filtros.chips;\n    }\n\n    cargarEtapasConCandidatos(filtros_endpoint);\n}\n\n/**\n * Preparar objeto de filtros actuales para recargar etapas.\n *\n * @returns {Object} Objeto con filtros actuales.\n * @author Andres Morales\n */\nfunction prepararFiltrosActuales() {\n    let filtros_endpoint = {};\n\n    if (json_filtros_etapas.ciudad_filtro) filtros_endpoint.ciudad_id = json_filtros_etapas.ciudad_filtro;\n    if (json_filtros_etapas.departamento_filtro) filtros_endpoint.departamento_id = json_filtros_etapas.departamento_filtro;\n    if (json_filtros_etapas.pais_filtro) filtros_endpoint.pais_id = json_filtros_etapas.pais_filtro;\n    if (json_filtros_etapas.etapa_filtro) filtros_endpoint.etapa_id = json_filtros_etapas.etapa_filtro;\n    if (json_filtros_etapas.nivel_academico_filtro) filtros_endpoint.nivel_educativo_id = json_filtros_etapas.nivel_academico_filtro;\n    if (json_filtros_etapas.edad_filtro) filtros_endpoint.edad = json_filtros_etapas.edad_filtro;\n\n    if (json_filtros_etapas.fecha_agregado_filtro) {\n        let partes_fecha = json_filtros_etapas.fecha_agregado_filtro.split(' a ');\n        if (partes_fecha[0]) filtros_endpoint.fecha_desde = partes_fecha[0];\n        if (partes_fecha[1]) filtros_endpoint.fecha_hasta = partes_fecha[1];\n    }\n\n    if (json_filtros_etapas.chips && json_filtros_etapas.chips.length > 0) {\n        filtros_endpoint.chips = json_filtros_etapas.chips;\n    }\n\n    return filtros_endpoint;\n}\n\n/**\n * Inicializar eventos del modal de candidatos descartados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction inicializarEventosModalDescartados() {\n    // Evento para checkboxes en modal de descartados\n    $('#contenedor-candidatos-descartados').off('change', 'input[name=\"candidato_check\"]');\n    $('#contenedor-candidatos-descartados').on('change', 'input[name=\"candidato_check\"]', function() {\n        actualizarEstadoBotonRevertirDescarte();\n    });\n\n    // Evento para búsqueda en candidatos descartados\n    $('#buscar-candidatos-descartados').off('input');\n    $('#buscar-candidatos-descartados').on('input', function() {\n        let termino_busqueda = $(this).val().toLowerCase().trim();\n        filtrarCandidatosDescartados(termino_busqueda);\n    });\n\n    // Limpiar búsqueda al cerrar el modal\n    $('#modal-candidatos-descartados').off('hidden.bs.modal');\n    $('#modal-candidatos-descartados').on('hidden.bs.modal', function() {\n        $('#buscar-candidatos-descartados').val('');\n        $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]').prop('checked', false);\n        $('#boton-revertir-descarte-masivo').prop('disabled', true);\n    });\n}\n\n/**\n * Actualizar estado del botón de revertir descarte masivo.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarEstadoBotonRevertirDescarte() {\n    let checkboxes_seleccionados = $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]:checked');\n    let hay_seleccionados = checkboxes_seleccionados.length > 0;\n\n    $('#boton-revertir-descarte-masivo').prop('disabled', !hay_seleccionados);\n}\n\n/**\n * Filtrar candidatos descartados por término de búsqueda.\n *\n * @param {string} termino Término de búsqueda.\n * @returns {void}\n * @author Andres Morales\n */\nfunction filtrarCandidatosDescartados(termino) {\n    $('#contenedor-candidatos-descartados .candidato-card').each(function() {\n        let $tarjeta = $(this);\n        let nombre = $tarjeta.find('.candidato-nombre').text().toLowerCase();\n        let ubicacion = $tarjeta.find('.bi-geo-alt').next('span').text().toLowerCase();\n        let etapa_descarte = $tarjeta.find('.tag-tonal-orange').text().toLowerCase();\n\n        let coincide = nombre.includes(termino) || ubicacion.includes(termino) || etapa_descarte.includes(termino);\n\n        if (coincide || termino === '') {\n            $tarjeta.removeClass('d-none');\n        } else {\n            $tarjeta.addClass('d-none');\n        }\n    });\n}\n\n/**\n * Revertir descarte de un candidato individual.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction devolverDescarteCandidato(etapa_vacante_usuario_id) {\n    revertirDescarte([etapa_vacante_usuario_id]);\n}\n\n/**\n * Revertir descarte de candidatos seleccionados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction revertirDescarteMasivo() {\n    let checkboxes_seleccionados = $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]:checked');\n\n    if (checkboxes_seleccionados.length === 0) {\n        mostrarToast('warning', 'Selecciona al menos un candidato para revertir el descarte');\n        return;\n    }\n\n    let revertir_ids = checkboxes_seleccionados.map(function() {\n        return parseInt($(this).val(), 10);\n    }).get();\n\n    revertirDescarte(revertir_ids);\n}\n\n/**\n * Revertir descarte de uno o varios candidatos con confirmación.\n *\n * @param {Array} ids Array de IDs de relaciones etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction revertirDescarte(ids) {\n    let cantidad = ids.length;\n\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Revertir descarte?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                   ¿Estás seguro que deseas revertir el descarte ${cantidad === 1 ? 'del candidato' : 'de los candidatos'}?\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Revertir',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed) {\n            ejecutarRevertirDescarte(ids);\n        }\n    });\n}\n\n/**\n * Ejecutar la reversión de descarte.\n *\n * @param {Array} ids Array de IDs de relaciones etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction ejecutarRevertirDescarte(ids) {\n    if (ids.length > 1) {\n        $('#boton-revertir-descarte-masivo').prop('disabled', true).html('<i class=\"bi bi-hourglass-split\"></i> Procesando...');\n    }\n\n    $.ajax({\n        url: '/vacantes-revertir-descarte-aplicantes',\n        type: 'POST',\n        dataType: 'json',\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        data: {\n            ids: ids\n        },\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message || 'Descarte revertido exitosamente');\n            $('#modal-candidatos-descartados').modal('hide');\n            cargarEtapasConCandidatos(prepararFiltrosActuales());\n        },\n        error: function(xhr) {\n            var mensaje = xhr.responseJSON?.message || 'Error al revertir el descarte';\n            mostrarToast('danger', mensaje);\n        },\n        complete: function() {\n            if (ids.length > 1) {\n                $('#boton-revertir-descarte-masivo').prop('disabled', false).html('Revertir descarte');\n            }\n        }\n    });\n}\n\n/**\n * Verificar si la siguiente etapa es \"Contratados\".\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @param {function} callback Función callback con resultado booleano.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction verificarSiguienteEtapa(etapa_vacante_usuario_id, callback) {\n    var $contenedor_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n    var $etapa_contenedor = $contenedor_candidato.closest('.etapa-card');\n    var $siguiente_etapa = $etapa_contenedor.next('.etapa-card');\n\n    if ($siguiente_etapa.length > 0) {\n        var nombre_siguiente_etapa = $siguiente_etapa.find('.etapa-titulo').text().trim();\n        callback(nombre_siguiente_etapa === 'Contratados');\n    } else {\n        callback(false);\n    }\n}\n\n/**\n * Ejecutar el movimiento de etapa (flujo normal).\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @returns {void}\n * @author Sergio Vargas\n * @author Andres Gonzalez\n * @author Jair Carvajal\n * @author Andres Morales\n * @author Esperanza Olivo\n */\nfunction ejecutarMovimientoEtapa(etapa_vacante_usuario_id) {\n    var botones_mover_etapa = $(`.btn-mover-etapa-accion[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n    botones_mover_etapa.prop('disabled', true);\n\n    var modal_detalle_abierto = $('#modal-detalle-resultados').hasClass('show');\n\n    if (modal_detalle_abierto) {\n        moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n        return;\n    }\n\n    var seccion_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n\n    if (seccion_candidato.length > 0) {\n        var etapa_actual = seccion_candidato.closest('.etapa-card');\n        var etapa_siguiente = etapa_actual.next('.etapa-card');\n\n        if (etapa_siguiente.length > 0) {\n            // Ejecutar animación\n            animarMovimientoEtapaCandidato(seccion_candidato, etapa_siguiente);\n\n            moverVacantesEtapaAplicante(etapa_vacante_usuario_id, etapa_siguiente);\n        } else {\n            moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n        }\n    } else {\n        moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n    }\n}\n\n/**\n * Animar el movimiento de la tarjeta hacia la siguiente etapa.\n *\n * @param {Object} tarjeta_candidato Tarjeta del candidato.\n * @param {Object} etapa_destino Etapa destino.\n * @returns {void}\n * @author Esperanza Olivo\n */\nfunction animarMovimientoEtapaCandidato(tarjeta_candidato, etapa_destino) {\n    $('#candidato-animacion-temp').remove();\n\n    var posicion_tarjeta = tarjeta_candidato.offset();\n    var ancho_tarjeta = tarjeta_candidato.outerWidth();\n    var alto_tarjeta = tarjeta_candidato.outerHeight();\n    var scroll_vertical = $(window).scrollTop();\n\n    var contenedor_destino = etapa_destino.find('.candidatos-container, .card-body').first();\n    var destino = contenedor_destino.offset();\n    var destino_ancho = contenedor_destino.outerWidth();\n\n    tarjeta_candidato.css('visibility', 'hidden');\n\n    var tarjeta_clon_candidato = tarjeta_candidato.clone().attr('id', 'candidato-animacion-temp').css({\n        position: 'fixed',\n        top: posicion_tarjeta.top - scroll_vertical,\n        left: posicion_tarjeta.left,\n        width: ancho_tarjeta,\n        height: alto_tarjeta,\n        margin: 0,\n        zIndex: 9999,\n        visibility: 'visible',\n        pointerEvents: 'none',\n        boxShadow: '0 8px 25px rgba(0,0,0,0.18)'\n    });\n\n    $('body').append(tarjeta_clon_candidato);\n\n    var tarjetas_destino = contenedor_destino.find('.candidato-card').length;\n    var desplazamiento_vertical = tarjetas_destino * 10;\n\n    tarjeta_clon_candidato.animate({\n        top: destino.top - scroll_vertical + 80 + desplazamiento_vertical + 8, \n        left: destino.left + (destino_ancho - ancho_tarjeta) / 2\n    }, 180, 'swing', function() {\n        tarjeta_clon_candidato.remove();\n        tarjeta_candidato.css('visibility', 'visible');\n        var contenedor_destino = etapa_destino.find('.candidatos-container, .card-body').first();\n        contenedor_destino.append(tarjeta_candidato); \n    });\n}\n\n/**\n * Ejecutar el movimiento de etapa (Envio de ajax).\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @param {jQuery} etapa_siguiente Etapa destino (opcional).\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Morales\n * @author Esperanza Olivo\n */\nfunction moverVacantesEtapaAplicante(etapa_vacante_usuario_id, etapa_siguiente = null) {\n    var tiempo_inicio = Date.now();\n    const DURACION_ANIMACION = 280;\n\n    $.ajax({\n        url: `/vacantes-mover-etapa-aplicante/${etapa_vacante_usuario_id}`,\n        type: 'POST',\n        dataType: 'json',\n        headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n        success: function(respuesta) {\n            var tiempo_transcurrido = Date.now() - tiempo_inicio;\n            var tiempo_espera = Math.max(0, DURACION_ANIMACION - tiempo_transcurrido);\n\n            setTimeout(function() {\n                $('#candidato-animacion-temp').remove();\n                $('#modal-detalle-resultados').modal('hide');\n                mostrarToast('success', respuesta.message);\n\n                var filtros_actuales = prepararFiltrosActuales();\n                cargarEtapasConCandidatos(filtros_actuales);\n\n                if (etapa_siguiente && etapa_siguiente.length > 0) {\n                    setTimeout(function() {\n                        scrollHaciaEtapa(etapa_siguiente);\n                    }, 300);\n                }\n            }, tiempo_espera);\n        },\n        error: function(xhr) {\n            $('#candidato-animacion-temp').remove();\n\n            var mensaje = xhr.responseJSON?.message || 'Error al mover el candidato de etapa';\n            mostrarToast('danger', mensaje);\n\n            var botones_mover_etapa = $(`.btn-mover-etapa-accion[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n            botones_mover_etapa.prop('disabled', false);\n\n            $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`).css('visibility', 'visible');\n        }\n    });\n}\n\n/**\n * Mostrar modal de competencias por mejorar.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction mostrarModalCompetenciasMejorar(etapa_vacante_usuario_id) {\n    window.etapa_vacante_usuario_pendiente = etapa_vacante_usuario_id;\n\n    $.ajax({\n        url: `/vacantes-competencias-mejorar/${etapa_vacante_usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        beforeSend: function() {\n            $('#contenedor-competencias-mejorar').html(`\n                <div class=\"text-center py-5\">\n                    <div class=\"spinner-border text-primary\" role=\"status\">\n                        <span class=\"visually-hidden\">Cargando...</span>\n                    </div>\n                    <p class=\"mt-3 text-muted\">Consultando competencias...</p>\n                </div>\n            `);\n            $('#modal-competencias-mejorar').modal('show');\n        },\n        success: function(respuesta) {\n            renderizarCompetenciasMejorar(respuesta.data);\n\n            if (respuesta.data.usuario_id) {\n                var url_sso = `/sso/wordpress?student_id=${respuesta.data.usuario_id}`;\n                $('#btn-plataforma-capacitacion')\n                    .attr('href', url_sso)\n                    .attr('data-usuario-id', respuesta.data.usuario_id);\n            }\n        },\n        error: function(xhr) {\n            var mensaje = xhr.responseJSON?.message || 'Error al obtener competencias';\n            $('#contenedor-competencias-mejorar').html(`\n                <div class=\"alert alert-warning\" role=\"alert\">\n                    <i class=\"bi bi-exclamation-triangle me-2\"></i>${mensaje}\n                </div>\n            `);\n        }\n    });\n}\n\n/**\n * Renderizar competencias en el modal.\n *\n * @param {Object} data Datos de competencias agrupadas por prueba.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction renderizarCompetenciasMejorar(data) {\n    var html = '';\n\n    if (!data.pruebas || data.pruebas.length === 0) {\n        html = `\n            <div class=\"alert alert-info\" role=\"alert\">\n                <i class=\"bi bi-info-circle me-2\"></i>\n                No se encontraron resultados de pruebas psicométricas para este candidato.\n            </div>\n        `;\n    } else {\n        data.pruebas.forEach(function(prueba) {\n            html += `\n                <div class=\"card mb-3\">\n                    <div class=\"card-header bg-primary text-white\">\n                        <h6 class=\"mb-0\">\n                            <i class=\"bi bi-clipboard-data me-2\"></i>${prueba.nombre_prueba}\n                        </h6>\n                    </div>\n                    <div class=\"card-body\">\n            `;\n\n            if (prueba.competencias && prueba.competencias.length > 0) {\n                html += '<ul class=\"list-group list-group-flush\">';\n                prueba.competencias.forEach(function(competencia, index) {\n                    var color_badge = competencia.puntaje < 40 ? 'bg-danger' :\n                                     competencia.puntaje < 70 ? 'bg-warning' : 'bg-success';\n                    html += `\n                        <li class=\"list-group-item d-flex justify-content-between align-items-center\">\n                            <div><strong>${index + 1}. ${competencia.nombre}</strong></div>\n                            <span class=\"badge ${color_badge} rounded-pill\">${competencia.puntaje} pts</span>\n                        </li>\n                    `;\n                });\n                html += '</ul>';\n            } else {\n                html += `<p class=\"text-muted mb-0\">\n                    <i class=\"bi bi-info-circle me-2\"></i>\n                    No se identificaron competencias específicas para esta prueba.\n                </p>`;\n            }\n            html += `</div></div>`;\n        });\n    }\n\n    $('#contenedor-competencias-mejorar').html(html);\n}\n\n/**\n * Cerrar modal y ejecutar movimiento de etapa.\n *\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction cerrarModalCompetenciasMejorar() {\n    $('#modal-competencias-mejorar').modal('hide');\n    if (window.etapa_vacante_usuario_pendiente) {\n        ejecutarMovimientoEtapa(window.etapa_vacante_usuario_pendiente);\n        window.etapa_vacante_usuario_pendiente = null;\n    }\n}\n\n/**\n * Crear mensaje cuando la etapa de prueba técnica no tiene archivos de instrucciones.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {string} HTML del mensaje.\n * @author Andres Morales\n */\nfunction crearMensajeSinArchivosInstrucciones(etapa_id) {\n    return `\n        <div class=\"card candidato-card mb-3\">\n            <div class=\"card-body p-4\">\n                <div class=\"d-flex flex-column justify-content-center align-items-center py-3\">\n                    <i class=\"bi bi-folder\" style=\"font-size: 80px; color: #9CA3AF;\"></i>\n                    <p class=\"text-headline-6 text-gray-30 text-center mb-0 mt-4 px-4\">\n                        Adjunta una prueba o elimina esta etapa para continuar.\n                    </p>\n                    <div class=\"d-flex gap-3 mt-4\">\n                        ${crearBoton({\n                            clases: 'btn-primary',\n                            texto: 'Adjuntar prueba técnica',\n                            onclick: `abrirModalAdjuntarInstrucciones(${etapa_id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-danger',\n                            texto: 'Eliminar etapa',\n                            onclick: `eliminarEtapaPruebaTecnica(${etapa_id})`\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Generar botones de acción para un candidato según el contexto.\n *\n * @param {Object} usuario_vacante Datos del candidato.\n * @param {string} origen 'listado' o 'modal'.\n * @param {string} nombre_etapa Nombre de la etapa.\n * @param {boolean} etapa_anterior_contracion Si es etapa anterior a Contratados.\n * @param {boolean} tiene_motivo_abandono Si el candidato abandonó.\n * @returns {string} HTML de los botones.\n * @author Andres Morales\n * @author José Manuel Jiménez\n */\nfunction generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono) {\n    let html = '';\n\n    // Lógica para etapa de Prueba técnica\n    if (origen === 'listado' && nombre_etapa === 'Prueba técnica') {\n        let prueba_tecnica = usuario_vacante.prueba_tecnica || {};\n        let tiene_prueba = prueba_tecnica.existe && (prueba_tecnica.tiene_archivos || prueba_tecnica.tiene_enlace);\n        let tiene_calificacion = usuario_vacante.puntaje !== null;\n\n        if (!tiene_prueba) {\n            // Ojo gris - candidato NO ha subido su prueba\n            html += crearBoton({\n                clases: 'btn-outline-secondary btn-circle',\n                texto: '<i class=\"bi bi-eye-slash\"></i>',\n                disabled: true,\n                tooltip: crearTooltip({\n                    content: 'Candidato no ha subido su prueba técnica',\n                    placement: 'bottom'\n                })\n            });\n        } else if (!tiene_calificacion) {\n            // Ojo azul - abre detalle del candidato para calificar\n            html += crearBoton({\n                clases: 'btn-outline-primary btn-circle',\n                texto: '<i class=\"bi bi-eye\"></i>',\n                onclick: `verDetalleCandidato(${usuario_vacante.usuario.id}, 'Prueba técnica')`,\n                tooltip: crearTooltip({\n                    content: 'Ver detalle del candidato',\n                    placement: 'bottom'\n                })\n            });\n        } else {\n            // Flecha - puede mover de etapa\n            html += crearBoton({\n                clases: 'btn-outline-primary btn-circle btn-mover-etapa-accion',\n                adicional: `data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\"`,\n                texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                onclick: `moverEtapaCandidato(${usuario_vacante.id})`,\n                tooltip: crearTooltip({\n                    content: 'Mover de etapa',\n                    placement: 'bottom'\n                })\n            });\n        }\n    } else if (origen === 'listado' && nombre_etapa !== 'Contratados') {\n        // Lógica para otras etapas (código existente)\n        let icono = '<i class=\"bi bi-arrow-90deg-right\"></i>';\n        let mensaje = 'Mover de etapa';\n        if (etapa_anterior_contracion) {\n            icono = '<i class=\"bi bi-file-earmark-person\"></i>';\n            mensaje = 'Seleccionar como contratado';\n        }\n\n        html += crearBoton({\n            clases: 'btn-outline-primary btn-circle btn-mover-etapa-accion',\n            adicional: `data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\"`,\n            texto: icono,\n            onclick: `moverEtapaCandidato(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: mensaje,\n                placement: 'bottom'\n            }),\n            disabled: nombre_etapa === 'Documentos para contratación'\n                ? !usuario_vacante.etapa_completada\n                : ((usuario_vacante.puntaje === null && usuario_vacante.puntaje_ia === null) || usuario_vacante.etapa_completada === false || (usuario_vacante?.formato_entrevista_completado !== undefined && usuario_vacante?.formato_entrevista_completado === false))\n        });\n    }\n\n    // Botón de descartar\n    if (origen === 'listado' && nombre_etapa !== 'Contratados') {\n        html += crearBoton({\n            clases: 'btn-outline-danger btn-circle',\n            texto: `<i class=\"bi bi-person-x\"></i>`,\n            onclick: `descartarCandidatos(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: 'Descartar candidato',\n                placement: 'bottom'\n            })\n        });\n    }\n\n    // Botón de revertir descarte (para modal)\n    if (origen === 'modal') {\n        html += crearBoton({\n            clases: 'btn-outline-success btn-circle',\n            texto: `<i class=\"bi bi-person-add\"></i>`,\n            onclick: `devolverDescarteCandidato(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: tiene_motivo_abandono ? 'No se puede revertir: candidato abandonó' : 'Revertir descarte',\n                placement: 'bottom'\n            }),\n            disabled: tiene_motivo_abandono\n        });\n    }\n\n    return html;\n}\n\nvar archivos_instrucciones_prueba = [];\n\n/**\n * Abrir modal para adjuntar instrucciones de prueba técnica.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {void}\n * @author Andres Morales\n */\nfunction abrirModalAdjuntarInstrucciones(etapa_id) {\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').remove();\n\n    archivos_instrucciones_prueba = [];\n\n    $.ajax({\n        url: `/etapas-vacantes/${etapa_id}/obtener-configuraciones-prueba-tecnica`,\n        type: 'GET',\n        success: function(respuesta) {\n            crearModalConDatos(etapa_id, respuesta.data ||{});\n        },\n        error: function() {\n            crearModalConDatos(etapa_id, {});\n        }\n    });\n}\n\n/**\n * Crear el modal con los datos existentes.\n *\n * @param {number} etapa_id ID de la etapa.\n * @param {Object} datos Datos de configuración existentes.\n * @returns {void}\n * @author Andres Morales\n */\nfunction crearModalConDatos(etapa_id, datos = {}) {\n    let descripcion_valor = datos.descripcion || '';\n    let enlace_valor = datos.enlace || '';\n\n    let modal_html = crearModal({\n        id: 'modal-adjuntar-instrucciones-prueba-tecnica',\n        titulo_header: 'Prueba técnica',\n        dialog_class: 'modal-dialog-centered modal-lg modal-dialog-scrollable',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\"',\n        modal_body: `\n            <form class=\"col-12 px-3\" id=\"form-adjuntar-instrucciones\" enctype=\"multipart/form-data\">\n                <input type=\"hidden\" name=\"etapa_vacante_id\" value=\"${etapa_id}\">\n                <div class=\"col-12 px-0 text-label-1 py-2\">\n                    Puedes habilitar esta etapa aunque no tengas aún la prueba lista. Sube el archivo más adelante.\n                </div>\n                <div class=\"col-12 px-0 text-body-2 text-gray-10 my-3\">\n                    Agrega una descripción a la prueba\n                </div>\n                <div class=\"col-12 my-2 pb-2\">\n                    ${crearTextarea({\n                        id: 'descripcion_prueba',\n                        name: 'descripcion',\n                        placeholder: '',\n                        required: true,\n                        value: descripcion_valor,\n                        label: 'Descripción',\n                        contador: 1500\n                    })}\n                </div>\n                <div class=\"col-12 px-4 rounded-3 border\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-body-2 text-gray-10 my-3\">\n                            Adjuntar prueba técnica\n                        </div>\n                        <div class=\"col-12\">\n                            ${crearInput({\n                                id: 'enlace_prueba',\n                                name: 'enlace',\n                                input_container_class: 'mb-4',\n                                label: 'Agregar enlace',\n                                required: false,\n                                value: enlace_valor,\n                                adicional: 'style=\"height: 60px;\"'\n                            })}\n                        </div>\n                        <div class=\"col-12\">\n                            ${crearInputFile({\n                                id: 'archivo_prueba',\n                                name: 'archivo_prueba',\n                                placeholder: '',\n                                disabled: false,\n                                required: false,\n                                multiple: true,\n                                accept: 'image/jpg,image/jpeg,image/png,application/pdf,.doc,.docx,.xls,.xlsx',\n                            })}\n                        </div>\n                        <div class=\"col-12 pb-4\">\n                            <div class=\"col-12 pt-4 px-4 mb-4 rounded-3 border text-body-3\">\n                                Los archivos tienen que:\n                                <ul class=\"text-body-2 text-gray-10\">\n                                    <li>Estar en formato JPG, PNG, PDF, DOCX o XLSX.</li>\n                                    <li>No superar los 2000 px de alto y pesar máximo 5GB.</li>\n                                </ul>\n                            </div>\n                            <div class=\"col-12\">\n                                <div class=\"row g-3\" id=\"contenedor-archivos-instrucciones\"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </form>\n        `,\n        boton_footer1: {\n            texto: 'Cancelar',\n            class: 'btn-outline-primary',\n            cerrar_modal: true\n        },\n        boton_footer2: {\n            texto: 'Guardar',\n            class: 'btn-primary',\n            id: 'btn-guardar-instrucciones',\n            onclick: 'adjuntarInstruccionesPruebaTecnica()',\n            disabled: true\n        }\n    });\n\n    $('body').append(modal_html);\n\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').on('shown.bs.modal', function() {\n        inicializarIputsFile();\n\n        $('#archivo_prueba').off('change').on('change', function (e) {\n            let archivos_seleccionados = e.target.files;\n            for (let i = 0; i < archivos_seleccionados.length; i++) {\n                let archivo = archivos_seleccionados[i];\n                let nombre_repetido = archivos_instrucciones_prueba.some(item => item.archivo.name === archivo.name);\n                if (!nombre_repetido) {\n                    archivos_instrucciones_prueba.push({\n                        archivo: archivo,\n                        seleccionado: true,\n                        id: Date.now() + '_' + i\n                    });\n                } else {\n                    mostrarToast('warning', `El archivo \"${archivo.name}\" ya fue seleccionado anteriormente.`);\n                }\n            }\n            renderizarArchivosInstrucciones();\n        });\n\n        validarCamposModalPruebaTecnicaDetalle();\n\n        inicializarTooltips();\n    });\n\n    // Limpiar cuando se cierra el modal\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').on('hidden.bs.modal', function() {\n        // Liberar todas las URLs temporales de las imágenes\n        $('#contenedor-archivos-instrucciones img').each(function() {\n            URL.revokeObjectURL($(this).attr('src'));\n        });\n\n        $('#contenedor-archivos-instrucciones').empty();\n        $('#archivo_prueba').val('');\n        archivos_instrucciones_prueba = [];\n        $(this).remove();\n    });\n\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').modal('show');\n}\n\n/**\n * Renderizar archivos seleccionados para instrucciones.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction renderizarArchivosInstrucciones() {\n    let contenedor = $('#contenedor-archivos-instrucciones');\n    contenedor.empty();\n\n    if (archivos_instrucciones_prueba.length === 0) {\n        return;\n    }\n\n    let documentos = [];\n    let imagenes = [];\n\n    archivos_instrucciones_prueba.forEach((item) => {\n        if (!item.seleccionado) return;\n\n        let archivo = item.archivo;\n        let extension = archivo.name.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'].includes(extension);\n\n        if (es_imagen) {\n            imagenes.push(item);\n        } else {\n            documentos.push(item);\n        }\n    });\n\n    documentos.forEach((item) => {\n        let archivo = item.archivo;\n        let extension = archivo.name.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtensionDetalle(extension);\n\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono}\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\"\n                             ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash-fill text-danger pointer\" onclick=\"quitarArchivoInstruccion('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        contenedor.append(html);\n    });\n\n    imagenes.forEach((item) => {\n        let archivo = item.archivo;\n        let url_imagen = URL.createObjectURL(archivo);\n\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 px-0 imagen-archivo-previsualizacion\"\n                             src=\"${url_imagen}\"\n                             alt=\"${archivo.name}\"\n                             style=\"height: 97px; object-fit: cover; border-radius: 6px 6px 0 0;\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 text-truncate\"\n                             ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash-fill text-danger pointer\" onclick=\"quitarArchivoInstruccion('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        contenedor.append(html);\n    });\n\n    inicializarTooltips();\n}\n\n/**\n * Quitar archivo de instrucciones seleccionado.\n *\n * @param {string} id ID del archivo.\n * @returns {void}\n * @author Andres Morales\n */\nfunction quitarArchivoInstruccion(id) {\n    // Buscar la imagen en el DOM y revocar la URL temporal si existe\n    let img = $(`img[src]`).filter(function() {\n        return $(this).closest('.archivo-item').find(`[onclick*=\"${id}\"]`).length > 0;\n    });\n\n    if (img.length > 0) {\n        URL.revokeObjectURL(img.attr('src'));\n    }\n\n    archivos_instrucciones_prueba = archivos_instrucciones_prueba.filter(item => item.id !== id);\n\n    renderizarArchivosInstrucciones();\n}\n\n/**\n * Obtener icono por extensión de archivo con colores específicos.\n *\n * @param {string} extension Extensión del archivo.\n * @returns {string} Clase del icono con color.\n * @author Andres Morales\n */\nfunction obtenerIconoPorExtensionDetalle(extension) {\n    let iconos = {\n        'pdf': 'bi bi-filetype-pdf text-danger fs-2',          // Rojo\n        'doc': 'bi bi-filetype-docx text-primary fs-2',        // Azul\n        'docx': 'bi bi-filetype-docx text-primary fs-2',       // Azul\n        'xls': 'bi bi-filetype-xlsx text-success fs-2',        // Verde\n        'xlsx': 'bi bi-filetype-xlsx text-success fs-2',       // Verde\n        'jpg': 'bi bi-file-image text-info fs-2',              // Cyan\n        'jpeg': 'bi bi-file-image text-info fs-2',             // Cyan\n        'png': 'bi bi-file-image text-info fs-2',              // Cyan\n        'gif': 'bi bi-file-image text-info fs-2',              // Cyan\n        'bmp': 'bi bi-file-image text-info fs-2',              // Cyan\n        'webp': 'bi bi-file-image text-info fs-2'              // Cyan\n    };\n    return iconos[extension] || 'bi bi-file-earmark text-secondary fs-2';\n}\n\n/**\n * Adjuntar instrucciones de prueba técnica.\n *\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction adjuntarInstruccionesPruebaTecnica() {\n    let formulario_datos = new FormData();\n\n    formulario_datos.append('etapa_vacante_id', $('#form-adjuntar-instrucciones input[name=\"etapa_vacante_id\"]').val());\n    formulario_datos.append('descripcion', $('#descripcion_prueba').val());\n    formulario_datos.append('enlace', $('#enlace_prueba').val());\n    formulario_datos.append('notificar_aplicantes', 1);\n\n    archivos_instrucciones_prueba.forEach((item) => {\n        if (item.seleccionado) {\n            formulario_datos.append('archivos[]', item.archivo);\n        }\n    });\n\n    $('#btn-guardar-instrucciones').prop('disabled', true).html('<i class=\"bi bi-hourglass-split me-2\"></i>Guardando...');\n\n    $.ajax({\n        url: '/etapas-vacantes-adjuntar-archivos',\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message || 'Prueba técnica guardada correctamente');\n            $('#modal-adjuntar-instrucciones-prueba-tecnica').modal('hide');\n            cargarEtapasConCandidatos(prepararFiltrosActuales());\n        },\n        error: function(xhr) {\n            let mensaje = xhr.responseJSON?.message || 'Error al guardar la prueba técnica';\n            mostrarToast('danger', mensaje);\n            $('#btn-guardar-instrucciones').prop('disabled', false).html('Guardar');\n        }\n    });\n}\n\n/**\n * Eliminar etapa de prueba técnica.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {void}\n * @author Andres Morales\n */\nfunction eliminarEtapaPruebaTecnica(etapa_id) {\n    Swal.fire({\n        width: '533px',\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">\n                    ¿Eliminar etapa?\n                </div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                    Esta seguro de querer eliminar la etapa Prueba técnica.\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-danger w-100 justify-content-center',\n                        texto: 'Eliminar etapa',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed) {\n            $.ajax({\n                url: `/etapas-vacantes/${etapa_id}/eliminar-etapa-prueba-tecnica`,\n                type: 'DELETE',\n                headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n                success: function(respuesta) {\n                    mostrarToast('success', respuesta.message || 'Etapa eliminada correctamente');\n                    cargarEtapasConCandidatos(prepararFiltrosActuales());\n                },\n                error: function(xhr) {\n                    let mensaje = xhr.responseJSON?.message || 'Error al eliminar la etapa';\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Validar campos del modal de prueba técnica en detalle y habilitar/deshabilitar botón guardar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarCamposModalPruebaTecnicaDetalle() {\n    let campos = [\n        '#descripcion_prueba'\n    ];\n\n    // Agregar evento input a todos los campos\n    campos.forEach(function(campo) {\n        $(campo).on('input', function() {\n            validarYActualizarBotonGuardarDetalle();\n        });\n    });\n\n    validarYActualizarBotonGuardarDetalle();\n}\n\n/**\n * Validar campos y actualizar estado del botón guardar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarYActualizarBotonGuardarDetalle() {\n    let descripcion = $('#descripcion_prueba').val().trim();\n\n    let es_valido = descripcion !== '';\n\n    $('#btn-guardar-instrucciones').prop('disabled', !es_valido);\n}\n\n/**\n * Hacer scroll suave hacia una etapa específica después del movimiento.\n *\n * @param {jQuery} etapa_destino Etapa a la que hacer scroll.\n * @returns {void}\n * @author Andres Morales\n */\nfunction scrollHaciaEtapa(etapa_destino) {\n    var $contenedor = $('#contenido-etapas-lista');\n\n    if (!$contenedor.length || !etapa_destino.length) {\n        return;\n    }\n\n    var etapa_id = etapa_destino.data('etapa-id');\n    var $etapa_actualizada = $(`.etapa-card[data-etapa-id=\"${etapa_id}\"]`);\n\n    if (!$etapa_actualizada.length) {\n        return;\n    }\n\n    var desplazamiento_izquierda_contenedor = $contenedor.scrollLeft();\n    var contenedor_ancho = $contenedor.outerWidth();\n    var ancho_desplazamiento_contenedor = $contenedor[0].scrollWidth;\n\n    var posicion_etapa = $etapa_actualizada.position().left;\n    var etapa_ancho = $etapa_actualizada.outerWidth();\n\n    var limite_izquierdo = desplazamiento_izquierda_contenedor;\n    var limite_derecho = desplazamiento_izquierda_contenedor + contenedor_ancho;\n\n    var etapa_visible = (posicion_etapa >= limite_izquierdo) &&\n                       ((posicion_etapa + etapa_ancho) <= limite_derecho);\n\n    if (etapa_visible) {\n        return;\n    }\n\n    var nueva_posicion_scroll = posicion_etapa - (contenedor_ancho / 2) + (etapa_ancho / 2);\n\n    nueva_posicion_scroll = Math.max(0, Math.min(nueva_posicion_scroll, ancho_desplazamiento_contenedor - contenedor_ancho));\n\n    $contenedor.animate(\n        { scrollLeft: nueva_posicion_scroll },\n        {\n            duration: 600,\n            easing: 'swing'\n        }\n    );\n}\n\n\n","structuredPatch":[{"oldStart":446,"oldLines":13,"newStart":446,"newLines":13,"lines":["             class: 'tag-tonal-orange w-fit-content',","         })}` : '';"," ","-    var fecha_notificacion = '';","-    if (origen === 'modal' && usuario_vacante.fecha_notificacion) {","-        var fecha = new Date(usuario_vacante.fecha_notificacion);","+    var fecha_descarte = '';","+    if (origen === 'modal' && usuario_vacante.created_at) {","+        var fecha = new Date(usuario_vacante.created_at);","         var dia = fecha.getDate();","         var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');","         var anio = fecha.getFullYear();","-        fecha_notificacion = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;","+        fecha_descarte = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;","     }"," "," "]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"cb2c5023-9b6e-4a3a-9fe7-4449275260a1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:07:36.608Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KmCSPDPd22wrAMyA3z3C87","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora actualizo la referencia en el HTML:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":859,"cache_read_input_tokens":46197,"cache_creation":{"ephemeral_5m_input_tokens":859,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKUERx7qZG5AkUdAyfd3","uuid":"2c99baa2-6699-4b13-aafd-496c0a178f85"}
{"parentUuid":"2c99baa2-6699-4b13-aafd-496c0a178f85","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:07:40.759Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KmCSPDPd22wrAMyA3z3C87","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LawfaUGe62xVb4tr6SozxW","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","old_string":"${(origen === 'modal' && fecha_notificacion) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n                                </div>\n                            ` : ''}","new_string":"${(origen === 'modal' && fecha_descarte) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_descarte}</span>\n                                </div>\n                            ` : ''}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":859,"cache_read_input_tokens":46197,"cache_creation":{"ephemeral_5m_input_tokens":859,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKUERx7qZG5AkUdAyfd3","uuid":"93a79e88-0efb-48b8-9bc4-db0847ee2e99"}
{"parentUuid":"93a79e88-0efb-48b8-9bc4-db0847ee2e99","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LawfaUGe62xVb4tr6SozxW","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   486→                    <div class=\"flex-grow-1\">\n   487→                        <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>\n   488→                        <div class=\"candidato-info d-flex flex-column gap-1\">\n   489→                            ${etapa_descarte_html}\n   490→                            ${(origen === 'modal' && fecha_descarte) ? `\n   491→                                <div class=\"d-flex align-items-center gap-2\">\n   492→                                    <i class=\"bi bi-calendar-event\"></i>\n   493→                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_descarte}</span>\n   494→                                </div>\n   495→                            ` : ''}\n   496→                            ${documento ? `\n   497→                                <div class=\"d-flex align-items-center gap-2\">\n   498→                                    <img width=\"12\" heigth=\"16\" src=\"/iconos/file-person.png\">\n   499→                                    <span class=\"text-label-2\">No. documento: ${documento}</span>"}]},"uuid":"63904c92-5877-4462-b8ad-86ab6c54c564","timestamp":"2026-01-20T23:07:55.456Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","oldString":"${(origen === 'modal' && fecha_notificacion) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n                                </div>\n                            ` : ''}","newString":"${(origen === 'modal' && fecha_descarte) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_descarte}</span>\n                                </div>\n                            ` : ''}","originalFile":"/**\n * Archivo para el manejo de etapas en el detalle de vacantes\n * @author Andres Morales\n*/\n\nlet candidatos_descartados = [];\nlet candidatos_seleccionados = [];\nlet json_filtros_etapas = {};\nlet es_primera_carga = true;\nlet posicion_scroll_guardada = 0;\n\n$(document).ready(function() {\n    consultarPaisesListadoCompleto(true);\n    observarCambiosChips();\n    cargarEtapasConCandidatos();\n});\n\n/**\n * Cargar etapas de la vacante con sus candidatos desde el endpoint.\n *\n * @param {Object} filtros Objeto con filtros a aplicar (opcional).\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction cargarEtapasConCandidatos(filtros = {}) {\n    // Guardar posición del scroll antes de actualizar (solo si no es la primera carga)\n    if (!es_primera_carga) {\n        var $contenedor = $('#contenido-etapas-lista');\n        if ($contenedor.length) {\n            posicion_scroll_guardada = $contenedor.scrollLeft();\n        }\n    }\n\n    $.ajax({\n        url: `/etapas-vacantes-aplicantes/${VACANTE_ID}`,\n        type: 'GET',\n        dataType: 'json',\n        data: {\n            ciudad_id: filtros.ciudad_id || '',\n            departamento_id: filtros.departamento_id || '',\n            pais_id: filtros.pais_id || '',\n            etapa_id: filtros.etapa_id || '',\n            nivel_educativo_id: filtros.nivel_educativo_id || '',\n            fecha_desde: filtros.fecha_desde || '',\n            fecha_hasta: filtros.fecha_hasta || '',\n            edad: filtros.edad || '',\n            chips: filtros.chips,\n            nivel_adecuacion: filtros.nivel_adecuacion || ''\n        },\n        success: function(respuesta) {\n            let datos = respuesta.data;\n            renderizarEtapas(datos.etapas, calcularTotalCandidatos(datos.etapas) + datos.descartados.length);\n            actualizarConteoDescartados(datos.descartados.length);\n\n            candidatos_descartados = datos.descartados;\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Calcular el total de candidatos en todas las etapas.\n *\n * @param {Array} etapas Array de etapas con candidatos.\n * @returns {number} Total de candidatos.\n * @author Andres Morales\n */\nfunction calcularTotalCandidatos(etapas) {\n    let total = 0;\n    etapas.forEach(etapa => {\n        if (etapa.usuarios_vacantes) {\n            total += etapa.usuarios_vacantes.length;\n        }\n    });\n    return total;\n}\n\n/**\n * Observar cambios en el contenedor de chips para mostrar/ocultar el wrapper.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction observarCambiosChips() {\n    var $contenedor_chips = $('#contenedor-chips-etapa-filtro-candidatos');\n    var $envolvente = $('#contenedor-chips-wrapper-etapa-filtro-candidatos');\n\n    if ($contenedor_chips.length === 0 || $envolvente.length === 0) return;\n\n    var observador = new MutationObserver(function() {\n        var tiene_chips = $contenedor_chips.children().length > 0;\n\n        if (tiene_chips) {\n            $envolvente.removeClass('d-none');\n        } else {\n            $envolvente.addClass('d-none');\n        }\n    });\n\n    observador.observe($contenedor_chips[0], {\n        childList: true,\n        subtree: false\n    });\n}\n\n/**\n * Actualizar el conteo de aplicantes en el botón.\n *\n * @param {number} conteo Número de candidatos aplicantes.\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarConteoAplicantes(conteo) {\n    $('#etapa-total-candidatos').text(`${conteo}`);\n}\n\n/**\n * Actualizar el badge de conteo de descartados.\n *\n * @param {number} conteo Número de candidatos descartados.\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarConteoDescartados(conteo) {\n    $('#etapa-total-descartados').text(conteo);\n}\n\n/**\n * Cargar las etapas en el select2 del filtro.\n *\n * @param {Array} etapas Array de etapas de la vacante.\n * @returns {void}\n * @author Andres Morales\n */\nfunction cargarEtapasEnFiltro(etapas) {\n    var $select_etapa_filtro = $('#etapa_filtro');\n\n    if (!$select_etapa_filtro.length) return;\n\n    $select_etapa_filtro.empty();\n\n    var opcion_todas = new Option('Todas', '', false, false);\n    $select_etapa_filtro.append(opcion_todas);\n\n    etapas.sort((a, b) => a.orden - b.orden);\n\n    etapas.forEach(function(etapa) {\n        var opcion = new Option(etapa.nombre, etapa.id, false, false);\n        $select_etapa_filtro.append(opcion);\n    });\n\n    $select_etapa_filtro.trigger('change');\n}\n\n/**\n * Animar scroll horizontal del contenedor de etapas.\n * Desplaza desde el final hasta el inicio (solo en primera carga).\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction animarScrollEtapas() {\n    var $contenedor = $('#contenido-etapas-lista');\n\n    if (!$contenedor.length) return;\n\n    var ancho_scroll = $contenedor[0].scrollWidth - $contenedor[0].clientWidth;\n\n    if (ancho_scroll <= 0) return;\n\n    // Posicionar al final primero\n    $contenedor.scrollLeft(ancho_scroll);\n\n    // Animar de final a inicio\n    $contenedor.animate(\n        { scrollLeft: 0 },\n        {\n            duration: 1500,\n            easing: 'swing'\n        }\n    );\n}\n\n/**\n * Renderizar las etapas de la vacante en cards horizontales.\n *\n * @param {Array} etapas Array de etapas de la vacante.\n * @param {number} conteo_aplicantes Cantidad de aplicantes de la vacante.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author Jair Carvajal\n */\nfunction renderizarEtapas(etapas, conteo_aplicantes) {\n    var $contenido_lista = $('#contenido-etapas-lista');\n    var $contenido_vacio = $('#contenido-etapas-empty');\n    var $contenido_controles = $('#contenido-etapas-controles');\n\n    // Verificar si hay filtros activos\n    var hay_filtros_activos = Object.keys(json_filtros_etapas).length > 0;\n\n    // Solo mostrar empty state si NO hay aplicantes Y NO hay filtros activos\n    if ((!conteo_aplicantes || conteo_aplicantes === 0) && !hay_filtros_activos) {\n        $contenido_lista.addClass('d-none');\n        $contenido_controles.addClass('d-none');\n        $contenido_vacio.removeClass('d-none');\n        return;\n    }\n\n    $contenido_vacio.addClass('d-none');\n    $contenido_lista.removeClass('d-none');\n    $contenido_controles.removeClass('d-none');\n\n    if (!etapas || etapas.length === 0) {\n        $contenido_lista.html(`\n            <div class=\"w-100 text-center py-5\">\n                <p class=\"text-muted\">${hay_filtros_activos ? 'No se encontraron coincidencias con los filtros aplicados. vuelve a intentar con otros filtros' : 'No hay etapas configuradas para esta vacante'}</p>\n            </div>\n        `);\n        return;\n    }\n\n    let html = '';\n    etapas.sort((a, b) => a.orden - b.orden);\n\n    // Filtrar la etapa con el orden inmediatamente anterior al orden 8 (Contratados)\n    let etapa_anterior_orden_8 = etapas\n        .filter(etapa => etapa.orden < 8)\n        .sort((a, b) => b.orden - a.orden)[0];\n\n    etapas.forEach((etapa) => {\n        html += crearTarjetaEtapa(etapa, etapa_anterior_orden_8);\n    });\n\n    $contenido_lista.html(html);\n\n    cargarEtapasEnFiltro(etapas);\n\n    // Ejecutar animación solo en la primera carga, de lo contrario restaurar posición\n    if (es_primera_carga) {\n        animarScrollEtapas();\n        es_primera_carga = false;\n    } else {\n        // Restaurar la posición del scroll guardada\n        setTimeout(() => {\n            $contenido_lista.scrollLeft(posicion_scroll_guardada);\n        }, 50);\n    }\n\n    inicializarEventosCheckboxes();\n\n    // Inicializar tooltips después de renderizar\n    setTimeout(() => {\n        inicializarTooltips();\n    }, 100);\n}\n\n/**\n * Crear una tarjeta(card) de etapa.\n *\n * @param {Object} etapa Datos de la etapa.\n * @param {Object} etapa_anterior_orden_8 Etapa con el orden inmediatamente anterior al orden 8.\n * @returns {string} HTML de la card.\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author Jair Carvajal\n */\nfunction crearTarjetaEtapa(etapa, etapa_anterior_orden_8) {\n    let etapa_anterior_contracion = false;\n\n    if (etapa_anterior_orden_8 && etapa.orden === etapa_anterior_orden_8.orden && etapa.activa == 1) {\n        etapa_anterior_contracion = true;\n    }\n\n    // Detectar si es etapa de prueba técnica sin archivos\n    let es_prueba_tecnica = etapa.nombre === 'Prueba técnica';\n    let tiene_prueba_tecnica_cargada = etapa?.prueba_cargada ?? true;\n\n    let candidatos_html = '';\n    let candidatos_totales = 0;\n    let candidatos_completaron = 0;\n\n    // Mostrar mensaje si es prueba técnica sin archivos\n    if (es_prueba_tecnica && !tiene_prueba_tecnica_cargada) {\n        let html = crearMensajeSinArchivosInstrucciones(etapa.id);\n\n        // Si hay candidatos, agregarlos después del mensaje\n        if (etapa?.usuarios_vacantes?.length > 0) {\n            etapa.usuarios_vacantes.forEach((usuario_vacante) => {\n                html += crearCardCandidato(usuario_vacante, 'listado', etapa.nombre, etapa_anterior_contracion);\n            });\n            candidatos_totales = etapa.usuarios_vacantes.length;\n            candidatos_completaron = etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.puntaje !== null || usuario_vacante.puntaje_ia !== null).length;\n        }\n\n        candidatos_html = `<div class=\"candidatos-container\">${html}</div>`;\n    } else if (etapa?.usuarios_vacantes?.length > 0) {\n        let html = '';\n\n        etapa.usuarios_vacantes.forEach((usuario_vacante) => {\n            html += crearCardCandidato(usuario_vacante, 'listado', etapa.nombre, etapa_anterior_contracion);\n        });\n\n        candidatos_html = `<div class=\"candidatos-container\">${html}</div>`;\n        candidatos_totales = etapa.usuarios_vacantes.length;\n        candidatos_completaron = etapa.nombre === 'Documentos para contratación'\n            ? etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.etapa_completada === true).length\n            : etapa.usuarios_vacantes.filter((usuario_vacante) => usuario_vacante.puntaje !== null || usuario_vacante.puntaje_ia !== null).length;\n    } else {\n        candidatos_html = `\n            <div class=\"d-flex justify-content-center align-items-center my-5\"><div class=\"etapa-icono-circulo\"><i class=\"bi bi-arrow-90deg-right\"></i></div></div>\n            <div class=\"mt-auto pb-10 px-5\"><p class=\"text-headline-5 text-gray-40 text-center mb-5 pb-10 px-6\">Mueve candidatos con el botón o arrástralos desde la etapa anterior. </p></div>\n        `;\n    }\n    return `\n        <div class=\"card etapa-card bg-gray-90\" data-etapa-id=\"${etapa.id}\">\n            <div class=\"card-body d-flex flex-column\">\n                <div class=\"d-flex align-items-center mb-3 gap-3\">\n                    ${crearCheckbox({\n                        id: 'etapa-check-' + etapa.id,\n                        name: 'etapa_check',\n                        value: etapa.id,\n                        checked: false,\n                        input_container_class: 'd-inline-block',\n                        disabled: (candidatos_totales > 0) ? false : true\n                    })}\n                    <h6 class=\"etapa-titulo text-headline-5 fw-bold mb-0\">${etapa.nombre}</h6>\n                    ${(candidatos_totales > 0 && etapa.nombre !== 'Contratados') ?\n                        `<div class=\"ms-auto\">\n                            ${crearTag({\n                                texto: candidatos_completaron + '/' + candidatos_totales + ' completaron la tarea',\n                                class: etapa.nombre === 'Documentos para contratación' ? 'tag-tonal-green' : 'tag-tonal-blue',\n                            })}\n                        </div>`\n                    : ''}\n                </div>\n                ${candidatos_html}\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Ver candidatos descartados en modal.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction verCandidatosDescartados() {\n    let $contenedor = $('#contenedor-candidatos-descartados');\n    let $controles = $('#controles-candidatos-descartados');\n\n    if (candidatos_descartados.length === 0) {\n        $controles.addClass('d-none');\n        $contenedor.html(`\n            <div class=\"row justify-content-center align-items-center py-5\">\n                <div class=\"col-auto text-center\">\n                    <div class=\"mb-4\">\n                        <i class=\"bi bi-person-x-fill empty-state-icon\"></i>\n                    </div>\n                    <div class=\"text-gray-30 fw-semibold text-headline-4 mb-3\">\n                        No hay candidatos descartados\n                    </div>\n                    <div class=\"text-gray-50 text-body-2\">\n                        Los candidatos que descartaste aparecerán aquí\n                    </div>\n                </div>\n            </div>\n        `);\n    } else {\n        $controles.removeClass('d-none');\n        let html = '';\n        candidatos_descartados.forEach(candidato => {\n            html += crearCardCandidato(candidato, 'modal');\n        });\n        $contenedor.html(html);\n\n        setTimeout(() => {\n            inicializarTooltips();\n            inicializarEventosModalDescartados();\n        }, 100);\n    }\n\n    $('#modal-candidatos-descartados').modal('show');\n}\n\n/**\n * Crear una card individual de candidato.\n *\n * @param {Object} usuario_vacante Datos del candidato aplicante.\n * @param {string} origen Origen del render: 'listado' o 'modal'. Default: 'listado'\n * @param {string} nombre_etapa Nombre de la etapa actual. Default: null\n * @returns {string} HTML de la card del candidato.\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidato(usuario_vacante, origen = 'listado', nombre_etapa = null, etapa_anterior_contracion = false) {\n    var usuario = usuario_vacante.usuario || {};\n    var nombre_completo = usuario.nombre_completo?.trim() || 'Sin nombre';\n    var salario = usuario?.perfiles_laborales[0]?.salario || 0;\n    var salario_maximo = usuario?.perfiles_laborales[0]?.salario_maximo || 0;\n\n    var salario_solicitado = (salario_maximo > 0) ? `Salario: ${formatearSalario(salario)} a ${formatearSalario(salario_maximo)}` : `Solicita ${formatearSalario(salario)}`;\n    var experiencia_meses = usuario?.perfiles_laborales[0]?.experiencia_laboral_meses || 0;\n    var experiencia = convertirMesesAAnios(experiencia_meses);\n\n    var ciudad = usuario.ciudad?.nombre || '';\n    var pais = usuario.ciudad?.departamento?.pais?.nombre || '';\n    var ubicacion = `${ciudad}${ciudad && pais ? ',' : ''}${pais}`;\n    \n    var documento = usuario.documento || '';\n\n    var adecuacion = usuario_vacante.adecuacion;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    var tiene_motivo_abandono = origen === 'modal' && usuario_vacante.etapa_descarte?.motivo_abandono !== null;\n\n    var checkbox_html = !tiene_motivo_abandono ?\n        crearCheckbox({\n            id: `candidato-check-${usuario_vacante.id}`,\n            name: `candidato_check`,\n            value: usuario_vacante.id,\n            class: 'candidato-checkbox',\n            input_container_class: 'd-inline-block'\n        }) : '';\n\n    var etapa_descarte_html = origen === 'modal' && usuario_vacante.etapa_descarte ?\n        `${crearTag({\n            texto: `Etapa de descarte: ${usuario_vacante.etapa_descarte.nombre}`,\n            class: 'tag-tonal-orange w-fit-content',\n        })}` : '';\n\n    var fecha_descarte = '';\n    if (origen === 'modal' && usuario_vacante.created_at) {\n        var fecha = new Date(usuario_vacante.created_at);\n        var dia = fecha.getDate();\n        var mes = fecha.toLocaleDateString('es-CO', { month: 'short' }).replace('.', '');\n        var anio = fecha.getFullYear();\n        fecha_descarte = `${dia}/${mes.charAt(0).toUpperCase() + mes.slice(1)}/${anio}`;\n    }\n\n\n    return `\n        <div class=\"card candidato-card mb-3\" data-candidato-id=\"${usuario.id}\" data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\" data-tiene-pruebas-requeridas=\"${usuario_vacante.tiene_pruebas_requeridas || false}\">\n            <div class=\"card-body p-3\">\n                <div class=\"d-flex align-items-center gap-3\">\n                    ${checkbox_html}\n                    <div class=\"position-relative d-flex flex-column align-items-center justify-content-center text-center\">\n                        <img class=\"candidato-avatar ${borde_color}\"\n                            onclick=\"verDetalleCandidato(${usuario.id})\"\n                            src=\"/usuarios-imagen/${usuario.id}\"\n                            ${crearTooltip({\n                                placement: `bottom`,\n                                content: `Ver detalle del candidato`,\n                                toggle: `popover`,\n                            })}>\n\n                        ${(adecuacion !== null && adecuacion > 0) ? `\n                            <span class=\"candidato-badge-detalle text-label-1 badge ${etiqueta_estilo} position-absolute\">\n                                ${adecuacion ? `${adecuacion}%` : ''}\n                            </span>\n                        ` : ''}\n\n                        ${ubicacion ? `\n                            <div class=\"d-flex align-items-center gap-2 mt-3\">\n                                <span class=\"text-label-2 text-gray-30\">${ubicacion}</span>\n                            </div>\n                        ` : ''}\n                    </div>\n                    <div class=\"flex-grow-1\">\n                        <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>\n                        <div class=\"candidato-info d-flex flex-column gap-1\">\n                            ${etapa_descarte_html}\n                            ${(origen === 'modal' && fecha_notificacion) ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-calendar-event\"></i>\n                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>\n                                </div>\n                            ` : ''}\n                            ${documento ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <img width=\"12\" heigth=\"16\" src=\"/iconos/file-person.png\">\n                                    <span class=\"text-label-2\">No. documento: ${documento}</span>\n                                </div>\n                            ` : ''}\n                            ${experiencia ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-briefcase\"></i>\n                                    <span class=\"text-label-2\">Experiencia: ${experiencia}</span>\n                                </div>\n                            ` : ''}\n                            ${salario_solicitado ? `\n                                <div class=\"d-flex align-items-center gap-2\">\n                                    <i class=\"bi bi-currency-dollar\"></i>\n                                    <span class=\"text-label-2\">${salario_solicitado}</span>\n                                </div>\n                            ` : ''}\n                        </div>\n                    </div>\n\n                    <div class=\"d-flex flex-column align-items-end gap-2\">\n                        ${generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono)}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Ver y calificar candidato.\n *\n * @param {number} candidato_id ID del candidato.\n * @returns {void}\n * @author Andres Morales\n */\nfunction verCalificarCandidatos(candidato_id) {\n    mostrarToast('info','Calificar candidato:', candidato_id);\n}\n\n/**\n * Mover candidato a la siguiente etapa.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n * @author Sergio Vargas - Modificación para modal de competencias\n */\nfunction moverEtapaCandidato(etapa_vacante_usuario_id) {\n    verificarSiguienteEtapa(etapa_vacante_usuario_id, function(es_contratados) {\n        if (es_contratados) {\n            // Obtener el valor de tiene_pruebas_requeridas desde el atributo data de la card\n            var $contenedor_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n            var tiene_pruebas = $contenedor_candidato.attr('data-tiene-pruebas-requeridas') === 'true';\n\n            if (tiene_pruebas) {\n                mostrarModalCompetenciasMejorar(etapa_vacante_usuario_id);\n            } else {\n                Swal.fire({\n                    width: '533px',\n                    showCloseButton: true,\n                    closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n                    showConfirmButton: false,\n                    showDenyButton: false,\n                    showCancelButton: false,\n                    html: `\n                        <div class=\"row w-100 mx-0 mt-2\">\n                            <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Confirmar contratación</div>\n                            <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                                Estás a punto de pasar a Contratados al canditato seleccionado y finalizar esta vacante.\n                            </div>\n                            <div class=\"col-12 mt-5 text-start text-body-2 fw-semibold\">\n                                ¿Deseas continuar?\n                            </div>\n                            <div class=\"col-6 mt-5 mb-2\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary w-100 justify-content-center',\n                                    texto: 'Volver',\n                                    onclick: `Swal.clickDeny();`\n                                })}\n                            </div>\n                            <div class=\"col-6 mt-5 mb-2\">\n                                ${crearBoton({\n                                    clases: 'btn-primary w-100 justify-content-center',\n                                    texto: 'Continuar con la contratación',\n                                    onclick: `Swal.clickConfirm();`\n                                })}\n                            </div>\n                        </div>\n                    `,\n                }).then(async (resultado) => {\n                    if (resultado.isConfirmed) {\n                        ejecutarMovimientoEtapa(etapa_vacante_usuario_id);\n                    }\n                });\n            }\n        } else {\n            ejecutarMovimientoEtapa(etapa_vacante_usuario_id);\n        }\n    });\n}\n\n/**\n * Inicializar eventos de checkboxes.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction inicializarEventosCheckboxes() {\n    $(document).off('change', 'input[name=\"candidato_check\"]');\n    $(document).on('change', 'input[name=\"candidato_check\"]', function() {\n        let $etapa_tarjeta = $(this).closest('.etapa-card');\n        validarEstadoCheckboxEtapa($etapa_tarjeta);\n\n        actualizarContadorSeleccionados();\n        actualizarEstadoBotonDescartar();\n    });\n\n    $(document).off('change', 'input[name=\"etapa_check\"]');\n    $(document).on('change', 'input[name=\"etapa_check\"]', function() {\n        let comprobado = $(this).is(':checked');\n\n        let $etapa_tarjeta = $(this).closest('.etapa-card');\n        $etapa_tarjeta.find('input[name=\"candidato_check\"]').prop('checked', comprobado);\n\n        actualizarContadorSeleccionados();\n        actualizarEstadoBotonDescartar();\n    });\n}\n\n/**\n * Validar y actualizar el estado del checkbox de una etapa según sus candidatos.\n *\n * @param {jQuery} $etapa_tarjeta Card de la etapa a validar.\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarEstadoCheckboxEtapa($etapa_tarjeta) {\n    let $checkbox_etapa = $etapa_tarjeta.find('input[name=\"etapa_check\"]');\n    let $checkboxes_candidatos = $etapa_tarjeta.find('input[name=\"candidato_check\"]');\n\n    let total_candidatos = $checkboxes_candidatos.length;\n    let candidatos_seleccionados_etapa = $checkboxes_candidatos.filter(':checked').length;\n\n    if (candidatos_seleccionados_etapa === 0) {\n        $checkbox_etapa.prop('indeterminate', false);\n        $checkbox_etapa.prop('checked', false);\n    } else if (candidatos_seleccionados_etapa === total_candidatos) {\n        $checkbox_etapa.prop('indeterminate', false);\n        $checkbox_etapa.prop('checked', true);\n    } else {\n        $checkbox_etapa.prop('indeterminate', true);\n        $checkbox_etapa.prop('checked', false);\n    }\n}\n\n/**\n * Actualizar el contador de candidatos seleccionados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarContadorSeleccionados() {\n    let checkboxes_seleccionados = $('input[name=\"candidato_check\"]:checked');\n    let contador = checkboxes_seleccionados.length;\n\n    $('#etapa-total-seleccionados').text(contador);\n\n    candidatos_seleccionados = checkboxes_seleccionados.map(function() {\n        return parseInt($(this).val(), 10);\n    }).get();\n}\n\n/**\n * Actualizar estado del botón de descartar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarEstadoBotonDescartar() {\n    let hay_seleccionados = candidatos_seleccionados.length > 0;\n\n    if (hay_seleccionados) {\n        $('#etapa-boton-descartar').prop('disabled', false);\n        $('#etapa-boton-descartar').attr('onclick', 'descartarCandidatos()');\n    } else {\n        $('#etapa-boton-descartar').prop('disabled', true);\n        $('#etapa-boton-descartar').attr('onclick', '');\n    }\n}\n\n/**\n * Aplicar filtros y recargar etapas.\n *\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction aplicarFiltrosDropdown(filtros) {\n    json_filtros_etapas = filtros;\n\n    let filtros_endpoint = {};\n\n    if (filtros.ciudad_filtro) filtros_endpoint.ciudad_id = filtros.ciudad_filtro;\n    if (filtros.departamento_filtro) filtros_endpoint.departamento_id = filtros.departamento_filtro;\n    if (filtros.pais_filtro) filtros_endpoint.pais_id = filtros.pais_filtro;\n    if (filtros.etapa_filtro) filtros_endpoint.etapa_id = filtros.etapa_filtro;\n    if (filtros.nivel_academico_filtro) filtros_endpoint.nivel_educativo_id = filtros.nivel_academico_filtro;\n    if (filtros.edad_filtro) filtros_endpoint.edad = filtros.edad_filtro;\n    if (filtros.nivel_adecuacion_filtro) filtros_endpoint.nivel_adecuacion = filtros.nivel_adecuacion_filtro;\n\n    if (filtros.fecha_agregado_filtro) {\n        let partes_fecha = filtros.fecha_agregado_filtro.split(' a ');\n        if (partes_fecha[0]) filtros_endpoint.fecha_desde = partes_fecha[0];\n        if (partes_fecha[1]) filtros_endpoint.fecha_hasta = partes_fecha[1];\n    }\n\n    if (filtros.chips && filtros.chips.length > 0) {\n        filtros_endpoint.chips = filtros.chips;\n    }\n\n    cargarEtapasConCandidatos(filtros_endpoint);\n}\n\n/**\n * Preparar objeto de filtros actuales para recargar etapas.\n *\n * @returns {Object} Objeto con filtros actuales.\n * @author Andres Morales\n */\nfunction prepararFiltrosActuales() {\n    let filtros_endpoint = {};\n\n    if (json_filtros_etapas.ciudad_filtro) filtros_endpoint.ciudad_id = json_filtros_etapas.ciudad_filtro;\n    if (json_filtros_etapas.departamento_filtro) filtros_endpoint.departamento_id = json_filtros_etapas.departamento_filtro;\n    if (json_filtros_etapas.pais_filtro) filtros_endpoint.pais_id = json_filtros_etapas.pais_filtro;\n    if (json_filtros_etapas.etapa_filtro) filtros_endpoint.etapa_id = json_filtros_etapas.etapa_filtro;\n    if (json_filtros_etapas.nivel_academico_filtro) filtros_endpoint.nivel_educativo_id = json_filtros_etapas.nivel_academico_filtro;\n    if (json_filtros_etapas.edad_filtro) filtros_endpoint.edad = json_filtros_etapas.edad_filtro;\n\n    if (json_filtros_etapas.fecha_agregado_filtro) {\n        let partes_fecha = json_filtros_etapas.fecha_agregado_filtro.split(' a ');\n        if (partes_fecha[0]) filtros_endpoint.fecha_desde = partes_fecha[0];\n        if (partes_fecha[1]) filtros_endpoint.fecha_hasta = partes_fecha[1];\n    }\n\n    if (json_filtros_etapas.chips && json_filtros_etapas.chips.length > 0) {\n        filtros_endpoint.chips = json_filtros_etapas.chips;\n    }\n\n    return filtros_endpoint;\n}\n\n/**\n * Inicializar eventos del modal de candidatos descartados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction inicializarEventosModalDescartados() {\n    // Evento para checkboxes en modal de descartados\n    $('#contenedor-candidatos-descartados').off('change', 'input[name=\"candidato_check\"]');\n    $('#contenedor-candidatos-descartados').on('change', 'input[name=\"candidato_check\"]', function() {\n        actualizarEstadoBotonRevertirDescarte();\n    });\n\n    // Evento para búsqueda en candidatos descartados\n    $('#buscar-candidatos-descartados').off('input');\n    $('#buscar-candidatos-descartados').on('input', function() {\n        let termino_busqueda = $(this).val().toLowerCase().trim();\n        filtrarCandidatosDescartados(termino_busqueda);\n    });\n\n    // Limpiar búsqueda al cerrar el modal\n    $('#modal-candidatos-descartados').off('hidden.bs.modal');\n    $('#modal-candidatos-descartados').on('hidden.bs.modal', function() {\n        $('#buscar-candidatos-descartados').val('');\n        $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]').prop('checked', false);\n        $('#boton-revertir-descarte-masivo').prop('disabled', true);\n    });\n}\n\n/**\n * Actualizar estado del botón de revertir descarte masivo.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarEstadoBotonRevertirDescarte() {\n    let checkboxes_seleccionados = $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]:checked');\n    let hay_seleccionados = checkboxes_seleccionados.length > 0;\n\n    $('#boton-revertir-descarte-masivo').prop('disabled', !hay_seleccionados);\n}\n\n/**\n * Filtrar candidatos descartados por término de búsqueda.\n *\n * @param {string} termino Término de búsqueda.\n * @returns {void}\n * @author Andres Morales\n */\nfunction filtrarCandidatosDescartados(termino) {\n    $('#contenedor-candidatos-descartados .candidato-card').each(function() {\n        let $tarjeta = $(this);\n        let nombre = $tarjeta.find('.candidato-nombre').text().toLowerCase();\n        let ubicacion = $tarjeta.find('.bi-geo-alt').next('span').text().toLowerCase();\n        let etapa_descarte = $tarjeta.find('.tag-tonal-orange').text().toLowerCase();\n\n        let coincide = nombre.includes(termino) || ubicacion.includes(termino) || etapa_descarte.includes(termino);\n\n        if (coincide || termino === '') {\n            $tarjeta.removeClass('d-none');\n        } else {\n            $tarjeta.addClass('d-none');\n        }\n    });\n}\n\n/**\n * Revertir descarte de un candidato individual.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction devolverDescarteCandidato(etapa_vacante_usuario_id) {\n    revertirDescarte([etapa_vacante_usuario_id]);\n}\n\n/**\n * Revertir descarte de candidatos seleccionados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction revertirDescarteMasivo() {\n    let checkboxes_seleccionados = $('#contenedor-candidatos-descartados input[name=\"candidato_check\"]:checked');\n\n    if (checkboxes_seleccionados.length === 0) {\n        mostrarToast('warning', 'Selecciona al menos un candidato para revertir el descarte');\n        return;\n    }\n\n    let revertir_ids = checkboxes_seleccionados.map(function() {\n        return parseInt($(this).val(), 10);\n    }).get();\n\n    revertirDescarte(revertir_ids);\n}\n\n/**\n * Revertir descarte de uno o varios candidatos con confirmación.\n *\n * @param {Array} ids Array de IDs de relaciones etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction revertirDescarte(ids) {\n    let cantidad = ids.length;\n\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Revertir descarte?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                   ¿Estás seguro que deseas revertir el descarte ${cantidad === 1 ? 'del candidato' : 'de los candidatos'}?\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Revertir',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed) {\n            ejecutarRevertirDescarte(ids);\n        }\n    });\n}\n\n/**\n * Ejecutar la reversión de descarte.\n *\n * @param {Array} ids Array de IDs de relaciones etapa-vacante-usuario.\n * @returns {void}\n * @author Andres Morales\n */\nfunction ejecutarRevertirDescarte(ids) {\n    if (ids.length > 1) {\n        $('#boton-revertir-descarte-masivo').prop('disabled', true).html('<i class=\"bi bi-hourglass-split\"></i> Procesando...');\n    }\n\n    $.ajax({\n        url: '/vacantes-revertir-descarte-aplicantes',\n        type: 'POST',\n        dataType: 'json',\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        data: {\n            ids: ids\n        },\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message || 'Descarte revertido exitosamente');\n            $('#modal-candidatos-descartados').modal('hide');\n            cargarEtapasConCandidatos(prepararFiltrosActuales());\n        },\n        error: function(xhr) {\n            var mensaje = xhr.responseJSON?.message || 'Error al revertir el descarte';\n            mostrarToast('danger', mensaje);\n        },\n        complete: function() {\n            if (ids.length > 1) {\n                $('#boton-revertir-descarte-masivo').prop('disabled', false).html('Revertir descarte');\n            }\n        }\n    });\n}\n\n/**\n * Verificar si la siguiente etapa es \"Contratados\".\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @param {function} callback Función callback con resultado booleano.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction verificarSiguienteEtapa(etapa_vacante_usuario_id, callback) {\n    var $contenedor_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n    var $etapa_contenedor = $contenedor_candidato.closest('.etapa-card');\n    var $siguiente_etapa = $etapa_contenedor.next('.etapa-card');\n\n    if ($siguiente_etapa.length > 0) {\n        var nombre_siguiente_etapa = $siguiente_etapa.find('.etapa-titulo').text().trim();\n        callback(nombre_siguiente_etapa === 'Contratados');\n    } else {\n        callback(false);\n    }\n}\n\n/**\n * Ejecutar el movimiento de etapa (flujo normal).\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @returns {void}\n * @author Sergio Vargas\n * @author Andres Gonzalez\n * @author Jair Carvajal\n * @author Andres Morales\n * @author Esperanza Olivo\n */\nfunction ejecutarMovimientoEtapa(etapa_vacante_usuario_id) {\n    var botones_mover_etapa = $(`.btn-mover-etapa-accion[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n    botones_mover_etapa.prop('disabled', true);\n\n    var modal_detalle_abierto = $('#modal-detalle-resultados').hasClass('show');\n\n    if (modal_detalle_abierto) {\n        moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n        return;\n    }\n\n    var seccion_candidato = $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n\n    if (seccion_candidato.length > 0) {\n        var etapa_actual = seccion_candidato.closest('.etapa-card');\n        var etapa_siguiente = etapa_actual.next('.etapa-card');\n\n        if (etapa_siguiente.length > 0) {\n            // Ejecutar animación\n            animarMovimientoEtapaCandidato(seccion_candidato, etapa_siguiente);\n\n            moverVacantesEtapaAplicante(etapa_vacante_usuario_id, etapa_siguiente);\n        } else {\n            moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n        }\n    } else {\n        moverVacantesEtapaAplicante(etapa_vacante_usuario_id);\n    }\n}\n\n/**\n * Animar el movimiento de la tarjeta hacia la siguiente etapa.\n *\n * @param {Object} tarjeta_candidato Tarjeta del candidato.\n * @param {Object} etapa_destino Etapa destino.\n * @returns {void}\n * @author Esperanza Olivo\n */\nfunction animarMovimientoEtapaCandidato(tarjeta_candidato, etapa_destino) {\n    $('#candidato-animacion-temp').remove();\n\n    var posicion_tarjeta = tarjeta_candidato.offset();\n    var ancho_tarjeta = tarjeta_candidato.outerWidth();\n    var alto_tarjeta = tarjeta_candidato.outerHeight();\n    var scroll_vertical = $(window).scrollTop();\n\n    var contenedor_destino = etapa_destino.find('.candidatos-container, .card-body').first();\n    var destino = contenedor_destino.offset();\n    var destino_ancho = contenedor_destino.outerWidth();\n\n    tarjeta_candidato.css('visibility', 'hidden');\n\n    var tarjeta_clon_candidato = tarjeta_candidato.clone().attr('id', 'candidato-animacion-temp').css({\n        position: 'fixed',\n        top: posicion_tarjeta.top - scroll_vertical,\n        left: posicion_tarjeta.left,\n        width: ancho_tarjeta,\n        height: alto_tarjeta,\n        margin: 0,\n        zIndex: 9999,\n        visibility: 'visible',\n        pointerEvents: 'none',\n        boxShadow: '0 8px 25px rgba(0,0,0,0.18)'\n    });\n\n    $('body').append(tarjeta_clon_candidato);\n\n    var tarjetas_destino = contenedor_destino.find('.candidato-card').length;\n    var desplazamiento_vertical = tarjetas_destino * 10;\n\n    tarjeta_clon_candidato.animate({\n        top: destino.top - scroll_vertical + 80 + desplazamiento_vertical + 8, \n        left: destino.left + (destino_ancho - ancho_tarjeta) / 2\n    }, 180, 'swing', function() {\n        tarjeta_clon_candidato.remove();\n        tarjeta_candidato.css('visibility', 'visible');\n        var contenedor_destino = etapa_destino.find('.candidatos-container, .card-body').first();\n        contenedor_destino.append(tarjeta_candidato); \n    });\n}\n\n/**\n * Ejecutar el movimiento de etapa (Envio de ajax).\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @param {jQuery} etapa_siguiente Etapa destino (opcional).\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Morales\n * @author Esperanza Olivo\n */\nfunction moverVacantesEtapaAplicante(etapa_vacante_usuario_id, etapa_siguiente = null) {\n    var tiempo_inicio = Date.now();\n    const DURACION_ANIMACION = 280;\n\n    $.ajax({\n        url: `/vacantes-mover-etapa-aplicante/${etapa_vacante_usuario_id}`,\n        type: 'POST',\n        dataType: 'json',\n        headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n        success: function(respuesta) {\n            var tiempo_transcurrido = Date.now() - tiempo_inicio;\n            var tiempo_espera = Math.max(0, DURACION_ANIMACION - tiempo_transcurrido);\n\n            setTimeout(function() {\n                $('#candidato-animacion-temp').remove();\n                $('#modal-detalle-resultados').modal('hide');\n                mostrarToast('success', respuesta.message);\n\n                var filtros_actuales = prepararFiltrosActuales();\n                cargarEtapasConCandidatos(filtros_actuales);\n\n                if (etapa_siguiente && etapa_siguiente.length > 0) {\n                    setTimeout(function() {\n                        scrollHaciaEtapa(etapa_siguiente);\n                    }, 300);\n                }\n            }, tiempo_espera);\n        },\n        error: function(xhr) {\n            $('#candidato-animacion-temp').remove();\n\n            var mensaje = xhr.responseJSON?.message || 'Error al mover el candidato de etapa';\n            mostrarToast('danger', mensaje);\n\n            var botones_mover_etapa = $(`.btn-mover-etapa-accion[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`);\n            botones_mover_etapa.prop('disabled', false);\n\n            $(`.candidato-card[data-etapa-vacante-usuario-id=\"${etapa_vacante_usuario_id}\"]`).css('visibility', 'visible');\n        }\n    });\n}\n\n/**\n * Mostrar modal de competencias por mejorar.\n *\n * @param {number} etapa_vacante_usuario_id ID de la relación.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction mostrarModalCompetenciasMejorar(etapa_vacante_usuario_id) {\n    window.etapa_vacante_usuario_pendiente = etapa_vacante_usuario_id;\n\n    $.ajax({\n        url: `/vacantes-competencias-mejorar/${etapa_vacante_usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        beforeSend: function() {\n            $('#contenedor-competencias-mejorar').html(`\n                <div class=\"text-center py-5\">\n                    <div class=\"spinner-border text-primary\" role=\"status\">\n                        <span class=\"visually-hidden\">Cargando...</span>\n                    </div>\n                    <p class=\"mt-3 text-muted\">Consultando competencias...</p>\n                </div>\n            `);\n            $('#modal-competencias-mejorar').modal('show');\n        },\n        success: function(respuesta) {\n            renderizarCompetenciasMejorar(respuesta.data);\n\n            if (respuesta.data.usuario_id) {\n                var url_sso = `/sso/wordpress?student_id=${respuesta.data.usuario_id}`;\n                $('#btn-plataforma-capacitacion')\n                    .attr('href', url_sso)\n                    .attr('data-usuario-id', respuesta.data.usuario_id);\n            }\n        },\n        error: function(xhr) {\n            var mensaje = xhr.responseJSON?.message || 'Error al obtener competencias';\n            $('#contenedor-competencias-mejorar').html(`\n                <div class=\"alert alert-warning\" role=\"alert\">\n                    <i class=\"bi bi-exclamation-triangle me-2\"></i>${mensaje}\n                </div>\n            `);\n        }\n    });\n}\n\n/**\n * Renderizar competencias en el modal.\n *\n * @param {Object} data Datos de competencias agrupadas por prueba.\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction renderizarCompetenciasMejorar(data) {\n    var html = '';\n\n    if (!data.pruebas || data.pruebas.length === 0) {\n        html = `\n            <div class=\"alert alert-info\" role=\"alert\">\n                <i class=\"bi bi-info-circle me-2\"></i>\n                No se encontraron resultados de pruebas psicométricas para este candidato.\n            </div>\n        `;\n    } else {\n        data.pruebas.forEach(function(prueba) {\n            html += `\n                <div class=\"card mb-3\">\n                    <div class=\"card-header bg-primary text-white\">\n                        <h6 class=\"mb-0\">\n                            <i class=\"bi bi-clipboard-data me-2\"></i>${prueba.nombre_prueba}\n                        </h6>\n                    </div>\n                    <div class=\"card-body\">\n            `;\n\n            if (prueba.competencias && prueba.competencias.length > 0) {\n                html += '<ul class=\"list-group list-group-flush\">';\n                prueba.competencias.forEach(function(competencia, index) {\n                    var color_badge = competencia.puntaje < 40 ? 'bg-danger' :\n                                     competencia.puntaje < 70 ? 'bg-warning' : 'bg-success';\n                    html += `\n                        <li class=\"list-group-item d-flex justify-content-between align-items-center\">\n                            <div><strong>${index + 1}. ${competencia.nombre}</strong></div>\n                            <span class=\"badge ${color_badge} rounded-pill\">${competencia.puntaje} pts</span>\n                        </li>\n                    `;\n                });\n                html += '</ul>';\n            } else {\n                html += `<p class=\"text-muted mb-0\">\n                    <i class=\"bi bi-info-circle me-2\"></i>\n                    No se identificaron competencias específicas para esta prueba.\n                </p>`;\n            }\n            html += `</div></div>`;\n        });\n    }\n\n    $('#contenedor-competencias-mejorar').html(html);\n}\n\n/**\n * Cerrar modal y ejecutar movimiento de etapa.\n *\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction cerrarModalCompetenciasMejorar() {\n    $('#modal-competencias-mejorar').modal('hide');\n    if (window.etapa_vacante_usuario_pendiente) {\n        ejecutarMovimientoEtapa(window.etapa_vacante_usuario_pendiente);\n        window.etapa_vacante_usuario_pendiente = null;\n    }\n}\n\n/**\n * Crear mensaje cuando la etapa de prueba técnica no tiene archivos de instrucciones.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {string} HTML del mensaje.\n * @author Andres Morales\n */\nfunction crearMensajeSinArchivosInstrucciones(etapa_id) {\n    return `\n        <div class=\"card candidato-card mb-3\">\n            <div class=\"card-body p-4\">\n                <div class=\"d-flex flex-column justify-content-center align-items-center py-3\">\n                    <i class=\"bi bi-folder\" style=\"font-size: 80px; color: #9CA3AF;\"></i>\n                    <p class=\"text-headline-6 text-gray-30 text-center mb-0 mt-4 px-4\">\n                        Adjunta una prueba o elimina esta etapa para continuar.\n                    </p>\n                    <div class=\"d-flex gap-3 mt-4\">\n                        ${crearBoton({\n                            clases: 'btn-primary',\n                            texto: 'Adjuntar prueba técnica',\n                            onclick: `abrirModalAdjuntarInstrucciones(${etapa_id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-danger',\n                            texto: 'Eliminar etapa',\n                            onclick: `eliminarEtapaPruebaTecnica(${etapa_id})`\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Generar botones de acción para un candidato según el contexto.\n *\n * @param {Object} usuario_vacante Datos del candidato.\n * @param {string} origen 'listado' o 'modal'.\n * @param {string} nombre_etapa Nombre de la etapa.\n * @param {boolean} etapa_anterior_contracion Si es etapa anterior a Contratados.\n * @param {boolean} tiene_motivo_abandono Si el candidato abandonó.\n * @returns {string} HTML de los botones.\n * @author Andres Morales\n * @author José Manuel Jiménez\n */\nfunction generarBotonesAccionCandidato(usuario_vacante, origen, nombre_etapa, etapa_anterior_contracion, tiene_motivo_abandono) {\n    let html = '';\n\n    // Lógica para etapa de Prueba técnica\n    if (origen === 'listado' && nombre_etapa === 'Prueba técnica') {\n        let prueba_tecnica = usuario_vacante.prueba_tecnica || {};\n        let tiene_prueba = prueba_tecnica.existe && (prueba_tecnica.tiene_archivos || prueba_tecnica.tiene_enlace);\n        let tiene_calificacion = usuario_vacante.puntaje !== null;\n\n        if (!tiene_prueba) {\n            // Ojo gris - candidato NO ha subido su prueba\n            html += crearBoton({\n                clases: 'btn-outline-secondary btn-circle',\n                texto: '<i class=\"bi bi-eye-slash\"></i>',\n                disabled: true,\n                tooltip: crearTooltip({\n                    content: 'Candidato no ha subido su prueba técnica',\n                    placement: 'bottom'\n                })\n            });\n        } else if (!tiene_calificacion) {\n            // Ojo azul - abre detalle del candidato para calificar\n            html += crearBoton({\n                clases: 'btn-outline-primary btn-circle',\n                texto: '<i class=\"bi bi-eye\"></i>',\n                onclick: `verDetalleCandidato(${usuario_vacante.usuario.id}, 'Prueba técnica')`,\n                tooltip: crearTooltip({\n                    content: 'Ver detalle del candidato',\n                    placement: 'bottom'\n                })\n            });\n        } else {\n            // Flecha - puede mover de etapa\n            html += crearBoton({\n                clases: 'btn-outline-primary btn-circle btn-mover-etapa-accion',\n                adicional: `data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\"`,\n                texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                onclick: `moverEtapaCandidato(${usuario_vacante.id})`,\n                tooltip: crearTooltip({\n                    content: 'Mover de etapa',\n                    placement: 'bottom'\n                })\n            });\n        }\n    } else if (origen === 'listado' && nombre_etapa !== 'Contratados') {\n        // Lógica para otras etapas (código existente)\n        let icono = '<i class=\"bi bi-arrow-90deg-right\"></i>';\n        let mensaje = 'Mover de etapa';\n        if (etapa_anterior_contracion) {\n            icono = '<i class=\"bi bi-file-earmark-person\"></i>';\n            mensaje = 'Seleccionar como contratado';\n        }\n\n        html += crearBoton({\n            clases: 'btn-outline-primary btn-circle btn-mover-etapa-accion',\n            adicional: `data-etapa-vacante-usuario-id=\"${usuario_vacante.id}\"`,\n            texto: icono,\n            onclick: `moverEtapaCandidato(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: mensaje,\n                placement: 'bottom'\n            }),\n            disabled: nombre_etapa === 'Documentos para contratación'\n                ? !usuario_vacante.etapa_completada\n                : ((usuario_vacante.puntaje === null && usuario_vacante.puntaje_ia === null) || usuario_vacante.etapa_completada === false || (usuario_vacante?.formato_entrevista_completado !== undefined && usuario_vacante?.formato_entrevista_completado === false))\n        });\n    }\n\n    // Botón de descartar\n    if (origen === 'listado' && nombre_etapa !== 'Contratados') {\n        html += crearBoton({\n            clases: 'btn-outline-danger btn-circle',\n            texto: `<i class=\"bi bi-person-x\"></i>`,\n            onclick: `descartarCandidatos(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: 'Descartar candidato',\n                placement: 'bottom'\n            })\n        });\n    }\n\n    // Botón de revertir descarte (para modal)\n    if (origen === 'modal') {\n        html += crearBoton({\n            clases: 'btn-outline-success btn-circle',\n            texto: `<i class=\"bi bi-person-add\"></i>`,\n            onclick: `devolverDescarteCandidato(${usuario_vacante.id})`,\n            tooltip: crearTooltip({\n                content: tiene_motivo_abandono ? 'No se puede revertir: candidato abandonó' : 'Revertir descarte',\n                placement: 'bottom'\n            }),\n            disabled: tiene_motivo_abandono\n        });\n    }\n\n    return html;\n}\n\nvar archivos_instrucciones_prueba = [];\n\n/**\n * Abrir modal para adjuntar instrucciones de prueba técnica.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {void}\n * @author Andres Morales\n */\nfunction abrirModalAdjuntarInstrucciones(etapa_id) {\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').remove();\n\n    archivos_instrucciones_prueba = [];\n\n    $.ajax({\n        url: `/etapas-vacantes/${etapa_id}/obtener-configuraciones-prueba-tecnica`,\n        type: 'GET',\n        success: function(respuesta) {\n            crearModalConDatos(etapa_id, respuesta.data ||{});\n        },\n        error: function() {\n            crearModalConDatos(etapa_id, {});\n        }\n    });\n}\n\n/**\n * Crear el modal con los datos existentes.\n *\n * @param {number} etapa_id ID de la etapa.\n * @param {Object} datos Datos de configuración existentes.\n * @returns {void}\n * @author Andres Morales\n */\nfunction crearModalConDatos(etapa_id, datos = {}) {\n    let descripcion_valor = datos.descripcion || '';\n    let enlace_valor = datos.enlace || '';\n\n    let modal_html = crearModal({\n        id: 'modal-adjuntar-instrucciones-prueba-tecnica',\n        titulo_header: 'Prueba técnica',\n        dialog_class: 'modal-dialog-centered modal-lg modal-dialog-scrollable',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\"',\n        modal_body: `\n            <form class=\"col-12 px-3\" id=\"form-adjuntar-instrucciones\" enctype=\"multipart/form-data\">\n                <input type=\"hidden\" name=\"etapa_vacante_id\" value=\"${etapa_id}\">\n                <div class=\"col-12 px-0 text-label-1 py-2\">\n                    Puedes habilitar esta etapa aunque no tengas aún la prueba lista. Sube el archivo más adelante.\n                </div>\n                <div class=\"col-12 px-0 text-body-2 text-gray-10 my-3\">\n                    Agrega una descripción a la prueba\n                </div>\n                <div class=\"col-12 my-2 pb-2\">\n                    ${crearTextarea({\n                        id: 'descripcion_prueba',\n                        name: 'descripcion',\n                        placeholder: '',\n                        required: true,\n                        value: descripcion_valor,\n                        label: 'Descripción',\n                        contador: 1500\n                    })}\n                </div>\n                <div class=\"col-12 px-4 rounded-3 border\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-body-2 text-gray-10 my-3\">\n                            Adjuntar prueba técnica\n                        </div>\n                        <div class=\"col-12\">\n                            ${crearInput({\n                                id: 'enlace_prueba',\n                                name: 'enlace',\n                                input_container_class: 'mb-4',\n                                label: 'Agregar enlace',\n                                required: false,\n                                value: enlace_valor,\n                                adicional: 'style=\"height: 60px;\"'\n                            })}\n                        </div>\n                        <div class=\"col-12\">\n                            ${crearInputFile({\n                                id: 'archivo_prueba',\n                                name: 'archivo_prueba',\n                                placeholder: '',\n                                disabled: false,\n                                required: false,\n                                multiple: true,\n                                accept: 'image/jpg,image/jpeg,image/png,application/pdf,.doc,.docx,.xls,.xlsx',\n                            })}\n                        </div>\n                        <div class=\"col-12 pb-4\">\n                            <div class=\"col-12 pt-4 px-4 mb-4 rounded-3 border text-body-3\">\n                                Los archivos tienen que:\n                                <ul class=\"text-body-2 text-gray-10\">\n                                    <li>Estar en formato JPG, PNG, PDF, DOCX o XLSX.</li>\n                                    <li>No superar los 2000 px de alto y pesar máximo 5GB.</li>\n                                </ul>\n                            </div>\n                            <div class=\"col-12\">\n                                <div class=\"row g-3\" id=\"contenedor-archivos-instrucciones\"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </form>\n        `,\n        boton_footer1: {\n            texto: 'Cancelar',\n            class: 'btn-outline-primary',\n            cerrar_modal: true\n        },\n        boton_footer2: {\n            texto: 'Guardar',\n            class: 'btn-primary',\n            id: 'btn-guardar-instrucciones',\n            onclick: 'adjuntarInstruccionesPruebaTecnica()',\n            disabled: true\n        }\n    });\n\n    $('body').append(modal_html);\n\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').on('shown.bs.modal', function() {\n        inicializarIputsFile();\n\n        $('#archivo_prueba').off('change').on('change', function (e) {\n            let archivos_seleccionados = e.target.files;\n            for (let i = 0; i < archivos_seleccionados.length; i++) {\n                let archivo = archivos_seleccionados[i];\n                let nombre_repetido = archivos_instrucciones_prueba.some(item => item.archivo.name === archivo.name);\n                if (!nombre_repetido) {\n                    archivos_instrucciones_prueba.push({\n                        archivo: archivo,\n                        seleccionado: true,\n                        id: Date.now() + '_' + i\n                    });\n                } else {\n                    mostrarToast('warning', `El archivo \"${archivo.name}\" ya fue seleccionado anteriormente.`);\n                }\n            }\n            renderizarArchivosInstrucciones();\n        });\n\n        validarCamposModalPruebaTecnicaDetalle();\n\n        inicializarTooltips();\n    });\n\n    // Limpiar cuando se cierra el modal\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').on('hidden.bs.modal', function() {\n        // Liberar todas las URLs temporales de las imágenes\n        $('#contenedor-archivos-instrucciones img').each(function() {\n            URL.revokeObjectURL($(this).attr('src'));\n        });\n\n        $('#contenedor-archivos-instrucciones').empty();\n        $('#archivo_prueba').val('');\n        archivos_instrucciones_prueba = [];\n        $(this).remove();\n    });\n\n    $('#modal-adjuntar-instrucciones-prueba-tecnica').modal('show');\n}\n\n/**\n * Renderizar archivos seleccionados para instrucciones.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction renderizarArchivosInstrucciones() {\n    let contenedor = $('#contenedor-archivos-instrucciones');\n    contenedor.empty();\n\n    if (archivos_instrucciones_prueba.length === 0) {\n        return;\n    }\n\n    let documentos = [];\n    let imagenes = [];\n\n    archivos_instrucciones_prueba.forEach((item) => {\n        if (!item.seleccionado) return;\n\n        let archivo = item.archivo;\n        let extension = archivo.name.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'].includes(extension);\n\n        if (es_imagen) {\n            imagenes.push(item);\n        } else {\n            documentos.push(item);\n        }\n    });\n\n    documentos.forEach((item) => {\n        let archivo = item.archivo;\n        let extension = archivo.name.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtensionDetalle(extension);\n\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono}\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\"\n                             ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash-fill text-danger pointer\" onclick=\"quitarArchivoInstruccion('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        contenedor.append(html);\n    });\n\n    imagenes.forEach((item) => {\n        let archivo = item.archivo;\n        let url_imagen = URL.createObjectURL(archivo);\n\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 px-0 imagen-archivo-previsualizacion\"\n                             src=\"${url_imagen}\"\n                             alt=\"${archivo.name}\"\n                             style=\"height: 97px; object-fit: cover; border-radius: 6px 6px 0 0;\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 text-truncate\"\n                             ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash-fill text-danger pointer\" onclick=\"quitarArchivoInstruccion('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        contenedor.append(html);\n    });\n\n    inicializarTooltips();\n}\n\n/**\n * Quitar archivo de instrucciones seleccionado.\n *\n * @param {string} id ID del archivo.\n * @returns {void}\n * @author Andres Morales\n */\nfunction quitarArchivoInstruccion(id) {\n    // Buscar la imagen en el DOM y revocar la URL temporal si existe\n    let img = $(`img[src]`).filter(function() {\n        return $(this).closest('.archivo-item').find(`[onclick*=\"${id}\"]`).length > 0;\n    });\n\n    if (img.length > 0) {\n        URL.revokeObjectURL(img.attr('src'));\n    }\n\n    archivos_instrucciones_prueba = archivos_instrucciones_prueba.filter(item => item.id !== id);\n\n    renderizarArchivosInstrucciones();\n}\n\n/**\n * Obtener icono por extensión de archivo con colores específicos.\n *\n * @param {string} extension Extensión del archivo.\n * @returns {string} Clase del icono con color.\n * @author Andres Morales\n */\nfunction obtenerIconoPorExtensionDetalle(extension) {\n    let iconos = {\n        'pdf': 'bi bi-filetype-pdf text-danger fs-2',          // Rojo\n        'doc': 'bi bi-filetype-docx text-primary fs-2',        // Azul\n        'docx': 'bi bi-filetype-docx text-primary fs-2',       // Azul\n        'xls': 'bi bi-filetype-xlsx text-success fs-2',        // Verde\n        'xlsx': 'bi bi-filetype-xlsx text-success fs-2',       // Verde\n        'jpg': 'bi bi-file-image text-info fs-2',              // Cyan\n        'jpeg': 'bi bi-file-image text-info fs-2',             // Cyan\n        'png': 'bi bi-file-image text-info fs-2',              // Cyan\n        'gif': 'bi bi-file-image text-info fs-2',              // Cyan\n        'bmp': 'bi bi-file-image text-info fs-2',              // Cyan\n        'webp': 'bi bi-file-image text-info fs-2'              // Cyan\n    };\n    return iconos[extension] || 'bi bi-file-earmark text-secondary fs-2';\n}\n\n/**\n * Adjuntar instrucciones de prueba técnica.\n *\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction adjuntarInstruccionesPruebaTecnica() {\n    let formulario_datos = new FormData();\n\n    formulario_datos.append('etapa_vacante_id', $('#form-adjuntar-instrucciones input[name=\"etapa_vacante_id\"]').val());\n    formulario_datos.append('descripcion', $('#descripcion_prueba').val());\n    formulario_datos.append('enlace', $('#enlace_prueba').val());\n    formulario_datos.append('notificar_aplicantes', 1);\n\n    archivos_instrucciones_prueba.forEach((item) => {\n        if (item.seleccionado) {\n            formulario_datos.append('archivos[]', item.archivo);\n        }\n    });\n\n    $('#btn-guardar-instrucciones').prop('disabled', true).html('<i class=\"bi bi-hourglass-split me-2\"></i>Guardando...');\n\n    $.ajax({\n        url: '/etapas-vacantes-adjuntar-archivos',\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message || 'Prueba técnica guardada correctamente');\n            $('#modal-adjuntar-instrucciones-prueba-tecnica').modal('hide');\n            cargarEtapasConCandidatos(prepararFiltrosActuales());\n        },\n        error: function(xhr) {\n            let mensaje = xhr.responseJSON?.message || 'Error al guardar la prueba técnica';\n            mostrarToast('danger', mensaje);\n            $('#btn-guardar-instrucciones').prop('disabled', false).html('Guardar');\n        }\n    });\n}\n\n/**\n * Eliminar etapa de prueba técnica.\n *\n * @param {number} etapa_id ID de la etapa.\n * @returns {void}\n * @author Andres Morales\n */\nfunction eliminarEtapaPruebaTecnica(etapa_id) {\n    Swal.fire({\n        width: '533px',\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">\n                    ¿Eliminar etapa?\n                </div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                    Esta seguro de querer eliminar la etapa Prueba técnica.\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-danger w-100 justify-content-center',\n                        texto: 'Eliminar etapa',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed) {\n            $.ajax({\n                url: `/etapas-vacantes/${etapa_id}/eliminar-etapa-prueba-tecnica`,\n                type: 'DELETE',\n                headers: {'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')},\n                success: function(respuesta) {\n                    mostrarToast('success', respuesta.message || 'Etapa eliminada correctamente');\n                    cargarEtapasConCandidatos(prepararFiltrosActuales());\n                },\n                error: function(xhr) {\n                    let mensaje = xhr.responseJSON?.message || 'Error al eliminar la etapa';\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Validar campos del modal de prueba técnica en detalle y habilitar/deshabilitar botón guardar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarCamposModalPruebaTecnicaDetalle() {\n    let campos = [\n        '#descripcion_prueba'\n    ];\n\n    // Agregar evento input a todos los campos\n    campos.forEach(function(campo) {\n        $(campo).on('input', function() {\n            validarYActualizarBotonGuardarDetalle();\n        });\n    });\n\n    validarYActualizarBotonGuardarDetalle();\n}\n\n/**\n * Validar campos y actualizar estado del botón guardar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarYActualizarBotonGuardarDetalle() {\n    let descripcion = $('#descripcion_prueba').val().trim();\n\n    let es_valido = descripcion !== '';\n\n    $('#btn-guardar-instrucciones').prop('disabled', !es_valido);\n}\n\n/**\n * Hacer scroll suave hacia una etapa específica después del movimiento.\n *\n * @param {jQuery} etapa_destino Etapa a la que hacer scroll.\n * @returns {void}\n * @author Andres Morales\n */\nfunction scrollHaciaEtapa(etapa_destino) {\n    var $contenedor = $('#contenido-etapas-lista');\n\n    if (!$contenedor.length || !etapa_destino.length) {\n        return;\n    }\n\n    var etapa_id = etapa_destino.data('etapa-id');\n    var $etapa_actualizada = $(`.etapa-card[data-etapa-id=\"${etapa_id}\"]`);\n\n    if (!$etapa_actualizada.length) {\n        return;\n    }\n\n    var desplazamiento_izquierda_contenedor = $contenedor.scrollLeft();\n    var contenedor_ancho = $contenedor.outerWidth();\n    var ancho_desplazamiento_contenedor = $contenedor[0].scrollWidth;\n\n    var posicion_etapa = $etapa_actualizada.position().left;\n    var etapa_ancho = $etapa_actualizada.outerWidth();\n\n    var limite_izquierdo = desplazamiento_izquierda_contenedor;\n    var limite_derecho = desplazamiento_izquierda_contenedor + contenedor_ancho;\n\n    var etapa_visible = (posicion_etapa >= limite_izquierdo) &&\n                       ((posicion_etapa + etapa_ancho) <= limite_derecho);\n\n    if (etapa_visible) {\n        return;\n    }\n\n    var nueva_posicion_scroll = posicion_etapa - (contenedor_ancho / 2) + (etapa_ancho / 2);\n\n    nueva_posicion_scroll = Math.max(0, Math.min(nueva_posicion_scroll, ancho_desplazamiento_contenedor - contenedor_ancho));\n\n    $contenedor.animate(\n        { scrollLeft: nueva_posicion_scroll },\n        {\n            duration: 600,\n            easing: 'swing'\n        }\n    );\n}\n\n\n","structuredPatch":[{"oldStart":487,"oldLines":10,"newStart":487,"newLines":10,"lines":["                         <h6 class=\"candidato-nombre mb-2 text-headline-6 fw-bold text-gray-10\" onclick=\"verDetalleCandidato(${usuario.id})\">${nombre_completo}</h6>","                         <div class=\"candidato-info d-flex flex-column gap-1\">","                             ${etapa_descarte_html}","-                            ${(origen === 'modal' && fecha_notificacion) ? `","+                            ${(origen === 'modal' && fecha_descarte) ? `","                                 <div class=\"d-flex align-items-center gap-2\">","                                     <i class=\"bi bi-calendar-event\"></i>","-                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_notificacion}</span>","+                                    <span class=\"text-label-2\">Fecha de descarte: ${fecha_descarte}</span>","                                 </div>","                             ` : ''}","                             ${documento ? `"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"63904c92-5877-4462-b8ad-86ab6c54c564","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:08:00.373Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01H7Jcaja54vCrVHAgiuvav4","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora la fecha de descarte usa `created_at` en lugar de `fecha_notificacion`.\n\n| Antes | Ahora |\n|-------|-------|\n| `usuario_vacante.fecha_notificacion` | `usuario_vacante.created_at` |"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":730,"cache_read_input_tokens":47056,"cache_creation":{"ephemeral_5m_input_tokens":730,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKUGHMF5uE75Q9pXuFXw","uuid":"523428ce-7409-4536-945a-23bacc4cb4a6"}
{"parentUuid":"523428ce-7409-4536-945a-23bacc4cb4a6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 2498 to 2500 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\nlet archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n\nThis may or may not be related to the current task.</ide_selection>"}]},"uuid":"0f55e03e-b8df-4d9a-9f14-6327081b139c","timestamp":"2026-01-20T23:18:26.451Z"}
{"parentUuid":"0f55e03e-b8df-4d9a-9f14-6327081b139c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"listo analiza esto de este archivos function renderizarDocumentosRequeridos() { public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js y me toca hace algho parecido aqui let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`); ya que me tiene que contar dos documentos que ha caargado el aplicante pero puede que por un tipo de documento cargue varios documentos entonces no me tine que contar varis archivos si no que contaria como 1"}]},"uuid":"0abc3001-5c60-4552-bb8d-44dd4dff18a8","timestamp":"2026-01-20T23:18:26.451Z"}
{"parentUuid":"0abc3001-5c60-4552-bb8d-44dd4dff18a8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:18:30.052Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_014DeEgAXaefDfmEDoAUaMJ6","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a analizar la función `renderizarDocumentosRequeridos` para entender cómo cuenta los documentos."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":48230,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":48230,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKV4hPPpUA536awF3aKw","uuid":"303c1b61-5e75-471c-9fd6-f1e9a77ffbbc"}
{"parentUuid":"303c1b61-5e75-471c-9fd6-f1e9a77ffbbc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:18:31.265Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_014DeEgAXaefDfmEDoAUaMJ6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NKnzZ5ffiTLnezyDiZe2d5","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","offset":1,"limit":150}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":48230,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":48230,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKV4hPPpUA536awF3aKw","uuid":"ea94ecaa-5d74-4cd9-90ab-8a7f3ee127aa"}
{"parentUuid":"ea94ecaa-5d74-4cd9-90ab-8a7f3ee127aa","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NKnzZ5ffiTLnezyDiZe2d5","type":"tool_result","content":"     1→/**\n     2→ * Sistema de acciones por etapa - Documentos Solicitados\n     3→ *\n     4→ * @author Andres Morales\n     5→ */\n     6→\n     7→const TAMANIO_MAXIMO_ARCHIVO = 2 * 1024 * 1024;\n     8→const EXTENSIONES_PERMITIDAS = ['pdf', 'docx', 'xlsx'];\n     9→\n    10→let datos_etapa_documentos = null;\n    11→let archivos_documentos_seleccionados = {};\n    12→let documentos_solicitables_catalogo = [];\n    13→let archivos_guardados_backend = [];\n    14→\n    15→/**\n    16→ * Inicializa los eventos del modal de documentos al cargar el documento.\n    17→ * Configura la limpieza al cerrar el modal.\n    18→ *\n    19→ * @returns {void}\n    20→ * @author Andres Morales\n    21→ */\n    22→$(document).ready(function() {\n    23→    $('#modal-aplicacion-documentos-solicitados').on('hidden.bs.modal', function() {\n    24→        $('#contenedor-documentos-solicitados').empty();\n    25→        archivos_documentos_seleccionados = {};\n    26→        datos_etapa_documentos = null;\n    27→        documentos_solicitables_catalogo = [];\n    28→        archivos_guardados_backend = [];\n    29→    });\n    30→});\n    31→\n    32→/**\n    33→ * Obtiene el tipo MIME correspondiente a un archivo basándose en su extensión.\n    34→ * Soporta formatos PDF, DOCX y XLSX.\n    35→ *\n    36→ * @param {string} nombre_archivo - Nombre completo del archivo con extensión\n    37→ * @returns {string} Tipo MIME del archivo o 'application/octet-stream' si no se reconoce\n    38→ * @author Andres Morales\n    39→ */\n    40→function obtenerMimeTypeDocumento(nombre_archivo) {\n    41→    if (!nombre_archivo) return 'application/octet-stream';\n    42→\n    43→    var extension = nombre_archivo.split('.').pop().toLowerCase();\n    44→    var tipos_mime = {\n    45→        'pdf': 'application/pdf',\n    46→        'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    47→        'xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n    48→    };\n    49→\n    50→    return tipos_mime[extension] || 'application/octet-stream';\n    51→}\n    52→\n    53→/**\n    54→ * Abre el modal de documentos solicitados cargando los datos de la etapa.\n    55→ * Carga el catálogo de documentos y renderiza los solicitados para esta vacante.\n    56→ *\n    57→ * @param {object} datos_etapa - Objeto con los datos de la etapa y documentos solicitados\n    58→ * @returns {void}\n    59→ * @author Andres Morales\n    60→ */\n    61→function abrirModalDocumentosSolicitados(datos_etapa) {\n    62→    datos_etapa_documentos = datos_etapa;\n    63→    archivos_documentos_seleccionados = {};\n    64→\n    65→    $('#etapa_vacante_usuario_id_documentos').val(datos_etapa.etapa_vacante_usuario_id);\n    66→\n    67→    $('#contenedor-documentos-solicitados').html('<div class=\"col-12 text-center py-5\"><p class=\"text-muted\">Cargando documentos solicitados...</p></div>');\n    68→\n    69→    cargarDocumentosSolicitados();\n    70→}\n    71→\n    72→/**\n    73→ * Carga los documentos configurados para esta etapa de vacante desde el API.\n    74→ * Utiliza la ruta específica que devuelve solo los documentos solicitados para esta etapa.\n    75→ *\n    76→ * @returns {void}\n    77→ * @author Andres Morales\n    78→ */\n    79→function cargarDocumentosSolicitados() {\n    80→    var etapa_id = datos_etapa_documentos.id;\n    81→    var etapa_vacante_usuario_id = datos_etapa_documentos.etapa_vacante_usuario_id;\n    82→\n    83→    $.ajax({\n    84→        url: '/vacantes-documentos-solicitados/' + etapa_id,\n    85→        type: 'GET',\n    86→        data: {\n    87→            etapa_vacante_usuario_id: etapa_vacante_usuario_id\n    88→        },\n    89→        success: function(respuesta) {\n    90→            var datos_respuesta = respuesta.data || respuesta || {};\n    91→            documentos_solicitables_catalogo = datos_respuesta.documentos || [];\n    92→            archivos_guardados_backend = datos_respuesta.archivos_guardados || [];\n    93→            renderizarDocumentosRequeridos();\n    94→            $('#modal-aplicacion-documentos-solicitados').modal('show');\n    95→        },\n    96→        error: function(error) {\n    97→            console.error('Error al cargar documentos solicitables:', error);\n    98→            mostrarToast('danger', 'Error al cargar la lista de documentos');\n    99→            $('#contenedor-documentos-solicitados').html('<div class=\"col-12 text-center py-5\"><p class=\"text-danger\">Error al cargar documentos</p></div>');\n   100→        }\n   101→    });\n   102→}\n   103→\n   104→/**\n   105→ * Renderiza los inputs para los documentos solicitados en la vacante.\n   106→ * Los documentos ya vienen filtrados desde el backend.\n   107→ *\n   108→ * @returns {void}\n   109→ * @author Andres Morales\n   110→ */\n   111→function renderizarDocumentosRequeridos() {\n   112→    var contenedor = $('#contenedor-documentos-solicitados');\n   113→    contenedor.empty();\n   114→\n   115→    if (!documentos_solicitables_catalogo || documentos_solicitables_catalogo.length === 0) {\n   116→        contenedor.html('<div class=\"col-12 text-center py-5\"><p class=\"text-muted\">No hay documentos configurados para esta etapa</p></div>');\n   117→        return;\n   118→    }\n   119→\n   120→    documentos_solicitables_catalogo.forEach(function(documento) {\n   121→        var nombre_archivo_normalizado = documento.nombre\n   122→            .toLowerCase()\n   123→            .normalize('NFD')\n   124→            .replace(/[\\u0300-\\u036f]/g, '')\n   125→            .replace(/\\s+/g, '_')\n   126→            .replace(/[^a-z0-9_]/g, '');\n   127→\n   128→        var nombre_normalizado_comparacion = documento.nombre\n   129→            .toLowerCase()\n   130→            .normalize('NFD')\n   131→            .replace(/[\\u0300-\\u036f]/g, '');\n   132→\n   133→        var permite_multiples = (nombre_normalizado_comparacion.includes('certificado') && nombre_normalizado_comparacion.includes('laboral')) ||\n   134→                               nombre_normalizado_comparacion.includes('diploma');\n   135→\n   136→        var html_documento = `\n   137→            <div class=\"col-12 mb-3\" id=\"contenedor-documento-${documento.id}\">\n   138→                <div class=\"row\">\n   139→                    <div class=\"col-12 mb-2\">\n   140→                        <h6 class=\"text-headline-6 fw-bold text-gray-10 mb-0\">\n   141→                            ${documento.nombre}\n   142→                        </h6>\n   143→                    </div>\n   144→                    <div class=\"col-12\" id=\"inputs-documento-${documento.id}\">\n   145→                    </div>\n   146→                </div>\n   147→            </div>\n   148→        `;\n   149→\n   150→        contenedor.append(html_documento);\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"40fd05de-c957-4653-8f84-8b22529fce44","timestamp":"2026-01-20T23:18:34.112Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","content":"/**\n * Sistema de acciones por etapa - Documentos Solicitados\n *\n * @author Andres Morales\n */\n\nconst TAMANIO_MAXIMO_ARCHIVO = 2 * 1024 * 1024;\nconst EXTENSIONES_PERMITIDAS = ['pdf', 'docx', 'xlsx'];\n\nlet datos_etapa_documentos = null;\nlet archivos_documentos_seleccionados = {};\nlet documentos_solicitables_catalogo = [];\nlet archivos_guardados_backend = [];\n\n/**\n * Inicializa los eventos del modal de documentos al cargar el documento.\n * Configura la limpieza al cerrar el modal.\n *\n * @returns {void}\n * @author Andres Morales\n */\n$(document).ready(function() {\n    $('#modal-aplicacion-documentos-solicitados').on('hidden.bs.modal', function() {\n        $('#contenedor-documentos-solicitados').empty();\n        archivos_documentos_seleccionados = {};\n        datos_etapa_documentos = null;\n        documentos_solicitables_catalogo = [];\n        archivos_guardados_backend = [];\n    });\n});\n\n/**\n * Obtiene el tipo MIME correspondiente a un archivo basándose en su extensión.\n * Soporta formatos PDF, DOCX y XLSX.\n *\n * @param {string} nombre_archivo - Nombre completo del archivo con extensión\n * @returns {string} Tipo MIME del archivo o 'application/octet-stream' si no se reconoce\n * @author Andres Morales\n */\nfunction obtenerMimeTypeDocumento(nombre_archivo) {\n    if (!nombre_archivo) return 'application/octet-stream';\n\n    var extension = nombre_archivo.split('.').pop().toLowerCase();\n    var tipos_mime = {\n        'pdf': 'application/pdf',\n        'docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n        'xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n    };\n\n    return tipos_mime[extension] || 'application/octet-stream';\n}\n\n/**\n * Abre el modal de documentos solicitados cargando los datos de la etapa.\n * Carga el catálogo de documentos y renderiza los solicitados para esta vacante.\n *\n * @param {object} datos_etapa - Objeto con los datos de la etapa y documentos solicitados\n * @returns {void}\n * @author Andres Morales\n */\nfunction abrirModalDocumentosSolicitados(datos_etapa) {\n    datos_etapa_documentos = datos_etapa;\n    archivos_documentos_seleccionados = {};\n\n    $('#etapa_vacante_usuario_id_documentos').val(datos_etapa.etapa_vacante_usuario_id);\n\n    $('#contenedor-documentos-solicitados').html('<div class=\"col-12 text-center py-5\"><p class=\"text-muted\">Cargando documentos solicitados...</p></div>');\n\n    cargarDocumentosSolicitados();\n}\n\n/**\n * Carga los documentos configurados para esta etapa de vacante desde el API.\n * Utiliza la ruta específica que devuelve solo los documentos solicitados para esta etapa.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction cargarDocumentosSolicitados() {\n    var etapa_id = datos_etapa_documentos.id;\n    var etapa_vacante_usuario_id = datos_etapa_documentos.etapa_vacante_usuario_id;\n\n    $.ajax({\n        url: '/vacantes-documentos-solicitados/' + etapa_id,\n        type: 'GET',\n        data: {\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id\n        },\n        success: function(respuesta) {\n            var datos_respuesta = respuesta.data || respuesta || {};\n            documentos_solicitables_catalogo = datos_respuesta.documentos || [];\n            archivos_guardados_backend = datos_respuesta.archivos_guardados || [];\n            renderizarDocumentosRequeridos();\n            $('#modal-aplicacion-documentos-solicitados').modal('show');\n        },\n        error: function(error) {\n            console.error('Error al cargar documentos solicitables:', error);\n            mostrarToast('danger', 'Error al cargar la lista de documentos');\n            $('#contenedor-documentos-solicitados').html('<div class=\"col-12 text-center py-5\"><p class=\"text-danger\">Error al cargar documentos</p></div>');\n        }\n    });\n}\n\n/**\n * Renderiza los inputs para los documentos solicitados en la vacante.\n * Los documentos ya vienen filtrados desde el backend.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction renderizarDocumentosRequeridos() {\n    var contenedor = $('#contenedor-documentos-solicitados');\n    contenedor.empty();\n\n    if (!documentos_solicitables_catalogo || documentos_solicitables_catalogo.length === 0) {\n        contenedor.html('<div class=\"col-12 text-center py-5\"><p class=\"text-muted\">No hay documentos configurados para esta etapa</p></div>');\n        return;\n    }\n\n    documentos_solicitables_catalogo.forEach(function(documento) {\n        var nombre_archivo_normalizado = documento.nombre\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .replace(/\\s+/g, '_')\n            .replace(/[^a-z0-9_]/g, '');\n\n        var nombre_normalizado_comparacion = documento.nombre\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n\n        var permite_multiples = (nombre_normalizado_comparacion.includes('certificado') && nombre_normalizado_comparacion.includes('laboral')) ||\n                               nombre_normalizado_comparacion.includes('diploma');\n\n        var html_documento = `\n            <div class=\"col-12 mb-3\" id=\"contenedor-documento-${documento.id}\">\n                <div class=\"row\">\n                    <div class=\"col-12 mb-2\">\n                        <h6 class=\"text-headline-6 fw-bold text-gray-10 mb-0\">\n                            ${documento.nombre}\n                        </h6>\n                    </div>\n                    <div class=\"col-12\" id=\"inputs-documento-${documento.id}\">\n                    </div>\n                </div>\n            </div>\n        `;\n\n        contenedor.append(html_documento);","numLines":150,"startLine":1,"totalLines":592}}}
{"parentUuid":"40fd05de-c957-4653-8f84-8b22529fce44","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:18:38.227Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VtXGZAkkcFZDyubAZm1ZS9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01L8MKm29D9VaBFCntpYD5Mh","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","offset":150,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2583,"cache_read_input_tokens":48230,"cache_creation":{"ephemeral_5m_input_tokens":2583,"ephemeral_1h_input_tokens":0},"output_tokens":18,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKV5EZP48meA5FA2GxEE","uuid":"a4c7acd2-52c1-42fd-a8dd-1a634407f7c7"}
{"parentUuid":"a4c7acd2-52c1-42fd-a8dd-1a634407f7c7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01L8MKm29D9VaBFCntpYD5Mh","type":"tool_result","content":"   150→        contenedor.append(html_documento);\n   151→\n   152→        documento.permite_multiples = permite_multiples;\n   153→        documento.nombre_normalizado = nombre_archivo_normalizado;\n   154→\n   155→        crearInputArchivo(documento.id, nombre_archivo_normalizado, documento.nombre, permite_multiples, 0);\n   156→    });\n   157→\n   158→    cargarArchivosExistentes();\n   159→    verificarDocumentosCompletos();\n   160→}\n   161→\n   162→/**\n   163→ * Crea un input de archivo HTML normal con botón eliminar.\n   164→ *\n   165→ * @param {number} documento_id - ID del documento\n   166→ * @param {string} nombre_archivo_normalizado - Nombre normalizado del archivo\n   167→ * @param {string} documento_nombre - Nombre del documento\n   168→ * @param {boolean} permite_multiples - Si permite múltiples archivos\n   169→ * @param {number} index - Índice del input\n   170→ * @returns {void}\n   171→ * @author Andres Morales\n   172→ */\n   173→function crearInputArchivo(documento_id, nombre_archivo_normalizado, documento_nombre, permite_multiples, index) {\n   174→    var input_id = 'input_' + documento_id + '_' + index;\n   175→    var boton_id = 'btn_eliminar_' + documento_id + '_' + index;\n   176→    var label_id = 'label_' + documento_id + '_' + index;\n   177→    var texto_id = 'texto_' + documento_id + '_' + index;\n   178→\n   179→    var html_input = `\n   180→        <div class=\"mb-2 input-archivo-contenedor\" id=\"contenedor_${input_id}\" data-documento-id=\"${documento_id}\" data-index=\"${index}\">\n   181→            <div class=\"input-group\">\n   182→                <label for=\"${input_id}\" class=\"btn btn-outline-primary mb-0 label-upload-documento\" id=\"${label_id}\">\n   183→                    <i class=\"bi bi-upload icono-subir-archivo\"></i>\n   184→                </label>\n   185→                <input\n   186→                    type=\"file\"\n   187→                    class=\"d-none\"\n   188→                    id=\"${input_id}\"\n   189→                    accept=\"application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.pdf,.docx,.xlsx\"\n   190→                    data-documento-id=\"${documento_id}\"\n   191→                    data-nombre-normalizado=\"${nombre_archivo_normalizado}\"\n   192→                    data-documento-nombre=\"${documento_nombre}\"\n   193→                    data-permite-multiples=\"${permite_multiples}\"\n   194→                    data-index=\"${index}\">\n   195→                <div class=\"form-control d-flex align-items-center texto-archivo-documento\" id=\"${texto_id}\">\n   196→                    <span class=\"text-muted\">Ningún archivo seleccionado</span>\n   197→                </div>\n   198→                <button\n   199→                    type=\"button\"\n   200→                    class=\"btn btn-outline-danger btn-eliminar-archivo d-none\"\n   201→                    id=\"${boton_id}\"\n   202→                    data-archivo-id=\"\"\n   203→                    data-input-id=\"${input_id}\">\n   204→                    <i class=\"bi bi-trash\"></i>\n   205→                </button>\n   206→            </div>\n   207→        </div>\n   208→    `;\n   209→\n   210→    $('#inputs-documento-' + documento_id).append(html_input);\n   211→\n   212→    $('#' + input_id).on('change', function(evento) {\n   213→        var archivo = evento.target.files[0];\n   214→        if (archivo) {\n   215→            $('#' + texto_id).html('<span class=\"text-truncate\">' + archivo.name + '</span>');\n   216→        }\n   217→        manejarCambioArchivo(evento.target);\n   218→    });\n   219→\n   220→    $('#' + boton_id).on('click', function() {\n   221→        var archivo_id = $(this).attr('data-archivo-id');\n   222→        var input_id_elemento = $(this).attr('data-input-id');\n   223→        eliminarArchivoConConfirmacion(archivo_id, input_id_elemento, documento_id, permite_multiples, index);\n   224→    });\n   225→}\n   226→\n   227→/**\n   228→ * Maneja el cambio de archivo en un input.\n   229→ * Valida el archivo y lo guarda automáticamente.\n   230→ *\n   231→ * @param {HTMLInputElement} input_elemento - Elemento input del archivo\n   232→ * @returns {void}\n   233→ * @author Andres Morales\n   234→ */\n   235→function manejarCambioArchivo(input_elemento) {\n   236→    var archivo = input_elemento.files[0];\n   237→\n   238→    if (!archivo) {\n   239→        return;\n   240→    }\n   241→\n   242→    var extension = archivo.name.split('.').pop().toLowerCase();\n   243→\n   244→    if (EXTENSIONES_PERMITIDAS.indexOf(extension) === -1) {\n   245→        mostrarToast('danger', 'El formato no es válido. Carga un documento .pdf, .docx o .xlsx');\n   246→        $(input_elemento).val('');\n   247→        return;\n   248→    }\n   249→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"65e5c2a0-b964-4bf2-bdf1-8195af672202","timestamp":"2026-01-20T23:18:41.115Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","content":"        contenedor.append(html_documento);\n\n        documento.permite_multiples = permite_multiples;\n        documento.nombre_normalizado = nombre_archivo_normalizado;\n\n        crearInputArchivo(documento.id, nombre_archivo_normalizado, documento.nombre, permite_multiples, 0);\n    });\n\n    cargarArchivosExistentes();\n    verificarDocumentosCompletos();\n}\n\n/**\n * Crea un input de archivo HTML normal con botón eliminar.\n *\n * @param {number} documento_id - ID del documento\n * @param {string} nombre_archivo_normalizado - Nombre normalizado del archivo\n * @param {string} documento_nombre - Nombre del documento\n * @param {boolean} permite_multiples - Si permite múltiples archivos\n * @param {number} index - Índice del input\n * @returns {void}\n * @author Andres Morales\n */\nfunction crearInputArchivo(documento_id, nombre_archivo_normalizado, documento_nombre, permite_multiples, index) {\n    var input_id = 'input_' + documento_id + '_' + index;\n    var boton_id = 'btn_eliminar_' + documento_id + '_' + index;\n    var label_id = 'label_' + documento_id + '_' + index;\n    var texto_id = 'texto_' + documento_id + '_' + index;\n\n    var html_input = `\n        <div class=\"mb-2 input-archivo-contenedor\" id=\"contenedor_${input_id}\" data-documento-id=\"${documento_id}\" data-index=\"${index}\">\n            <div class=\"input-group\">\n                <label for=\"${input_id}\" class=\"btn btn-outline-primary mb-0 label-upload-documento\" id=\"${label_id}\">\n                    <i class=\"bi bi-upload icono-subir-archivo\"></i>\n                </label>\n                <input\n                    type=\"file\"\n                    class=\"d-none\"\n                    id=\"${input_id}\"\n                    accept=\"application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.pdf,.docx,.xlsx\"\n                    data-documento-id=\"${documento_id}\"\n                    data-nombre-normalizado=\"${nombre_archivo_normalizado}\"\n                    data-documento-nombre=\"${documento_nombre}\"\n                    data-permite-multiples=\"${permite_multiples}\"\n                    data-index=\"${index}\">\n                <div class=\"form-control d-flex align-items-center texto-archivo-documento\" id=\"${texto_id}\">\n                    <span class=\"text-muted\">Ningún archivo seleccionado</span>\n                </div>\n                <button\n                    type=\"button\"\n                    class=\"btn btn-outline-danger btn-eliminar-archivo d-none\"\n                    id=\"${boton_id}\"\n                    data-archivo-id=\"\"\n                    data-input-id=\"${input_id}\">\n                    <i class=\"bi bi-trash\"></i>\n                </button>\n            </div>\n        </div>\n    `;\n\n    $('#inputs-documento-' + documento_id).append(html_input);\n\n    $('#' + input_id).on('change', function(evento) {\n        var archivo = evento.target.files[0];\n        if (archivo) {\n            $('#' + texto_id).html('<span class=\"text-truncate\">' + archivo.name + '</span>');\n        }\n        manejarCambioArchivo(evento.target);\n    });\n\n    $('#' + boton_id).on('click', function() {\n        var archivo_id = $(this).attr('data-archivo-id');\n        var input_id_elemento = $(this).attr('data-input-id');\n        eliminarArchivoConConfirmacion(archivo_id, input_id_elemento, documento_id, permite_multiples, index);\n    });\n}\n\n/**\n * Maneja el cambio de archivo en un input.\n * Valida el archivo y lo guarda automáticamente.\n *\n * @param {HTMLInputElement} input_elemento - Elemento input del archivo\n * @returns {void}\n * @author Andres Morales\n */\nfunction manejarCambioArchivo(input_elemento) {\n    var archivo = input_elemento.files[0];\n\n    if (!archivo) {\n        return;\n    }\n\n    var extension = archivo.name.split('.').pop().toLowerCase();\n\n    if (EXTENSIONES_PERMITIDAS.indexOf(extension) === -1) {\n        mostrarToast('danger', 'El formato no es válido. Carga un documento .pdf, .docx o .xlsx');\n        $(input_elemento).val('');\n        return;\n    }\n","numLines":100,"startLine":150,"totalLines":592}}}
{"parentUuid":"65e5c2a0-b964-4bf2-bdf1-8195af672202","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:18:46.984Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LZzfz3C6d24mcB1TS3jW9r","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora entiendo la lógica. En ese archivo, un tipo de documento (ej: \"Certificados laborales\") puede tener múltiples archivos. Lo que necesitas es contar cuántos **tipos de documentos** tienen al menos un archivo cargado, no la cantidad total de archivos.\n\nVoy a modificar el contador en `detalle-resultados.js`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1727,"cache_read_input_tokens":50813,"cache_creation":{"ephemeral_5m_input_tokens":1727,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKV5mUUud8SrU8UxTWxd","uuid":"baa90dfa-f7c0-4e58-ab82-5ca100196f63"}
{"parentUuid":"baa90dfa-f7c0-4e58-ab82-5ca100196f63","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:18:48.710Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LZzfz3C6d24mcB1TS3jW9r","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01V8btnTTBe5omECpcfREZUG","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":2493,"limit":15}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1727,"cache_read_input_tokens":50813,"cache_creation":{"ephemeral_5m_input_tokens":1727,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKV5mUUud8SrU8UxTWxd","uuid":"d06c02b6-c0f2-47ed-bd9d-b182ef853fc5"}
{"parentUuid":"d06c02b6-c0f2-47ed-bd9d-b182ef853fc5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01V8btnTTBe5omECpcfREZUG","type":"tool_result","content":"  2493→    } else {\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );\n  2498→            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n  2499→            console.log(archivos_aplicante);\n  2500→            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2501→        }, 100);\n  2502→        return `\n  2503→            <div class=\"col-12\">\n  2504→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n  2505→                    <div class=\"col-12\">\n  2506→                        <div class=\"row justify-content-between align-items-center mb-4\">\n  2507→                            <div class=\"col-auto text-body-2 text-gray-10\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"4a53fa87-a697-41ce-abf5-a5290404e697","timestamp":"2026-01-20T23:18:51.822Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">","numLines":15,"startLine":2493,"totalLines":2699}}}
{"parentUuid":"4a53fa87-a697-41ce-abf5-a5290404e697","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:18:56.219Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Rz5BGyvMsSerxXy2qVbCMv","type":"message","role":"assistant","content":[{"type":"text","text":"Necesito ver la estructura de los datos para entender cómo identificar el tipo de documento de cada archivo. Voy a revisar cómo se normaliza el nombre en el archivo de documentos solicitados:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":613,"cache_read_input_tokens":52540,"cache_creation":{"ephemeral_5m_input_tokens":613,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKV6anLBExM22dE1uqrR","uuid":"7cc5cf1b-2b9c-4c5f-b007-a8427f834b60"}
{"parentUuid":"7cc5cf1b-2b9c-4c5f-b007-a8427f834b60","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:18:57.598Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Rz5BGyvMsSerxXy2qVbCMv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011yV2V7foGAnUTFqpnHCJjv","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","offset":280,"limit":80}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":613,"cache_read_input_tokens":52540,"cache_creation":{"ephemeral_5m_input_tokens":613,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKV6anLBExM22dE1uqrR","uuid":"6882034e-d190-4fa1-bda5-dd9d05f170b2"}
{"parentUuid":"6882034e-d190-4fa1-bda5-dd9d05f170b2","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011yV2V7foGAnUTFqpnHCJjv","type":"tool_result","content":"   280→\n   281→    if (nombre_archivo === 'Ningún archivo seleccionado') {\n   282→        nombre_archivo = 'seleccionado';\n   283→    }\n   284→\n   285→    Swal.fire({\n   286→        showCloseButton: true,\n   287→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   288→        showConfirmButton: false,\n   289→        showDenyButton: false,\n   290→        showCancelButton: false,\n   291→        html: `\n   292→            <div class=\"row w-100 mx-0 mt-2\">\n   293→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Eliminar archivo?</div>\n   294→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Se eliminara el archivo \"${nombre_archivo}\" ¿Deseas continuar?</div>\n   295→                <div class=\"col-6 mt-5 mb-2\">\n   296→                    ${crearBoton({\n   297→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   298→                        texto: 'Salir',\n   299→                        onclick: `Swal.clickDeny();`\n   300→                    })}\n   301→                </div>\n   302→                <div class=\"col-6 mt-5 mb-2\">\n   303→                    ${crearBoton({\n   304→                        clases: 'btn-danger w-100 justify-content-center',\n   305→                        texto: 'Eliminar',\n   306→                        onclick: `Swal.clickConfirm();`\n   307→                    })}\n   308→                </div>\n   309→            </div>\n   310→        `,\n   311→    }).then((resultado) => {\n   312→        if (resultado.isConfirmed) {\n   313→            $.ajax({\n   314→                url: '/archivos/' + archivo_id,\n   315→                type: 'DELETE',\n   316→                headers: {\n   317→                    'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n   318→                },\n   319→                success: function() {\n   320→                    mostrarToast('success', 'Archivo eliminado exitosamente');\n   321→\n   322→                    if (permite_multiples) {\n   323→                        $('#contenedor_' + input_id).remove();\n   324→                    } else {\n   325→                        $('#' + input_id).val('');\n   326→                        $('#btn_eliminar_' + documento_id + '_' + indice).addClass('d-none');\n   327→                        $('#btn_eliminar_' + documento_id + '_' + indice).attr('data-archivo-id', '');\n   328→                    }\n   329→\n   330→                    actualizarDatatables('tabla-tareas-pendientes');\n   331→                    cargarDocumentosSolicitados();\n   332→                },\n   333→                error: function(respuesta_xhr) {\n   334→                    var mensaje_error = 'Error al eliminar el archivo';\n   335→                    if (respuesta_xhr.responseJSON && respuesta_xhr.responseJSON.message) {\n   336→                        mensaje_error = respuesta_xhr.responseJSON.message;\n   337→                    }\n   338→                    mostrarToast('danger', mensaje_error);\n   339→                }\n   340→            });\n   341→        }\n   342→    });\n   343→}\n   344→\n   345→/**\n   346→ * Carga los archivos guardados en los inputs correspondientes.\n   347→ * Usa los archivos guardados que vienen del backend.\n   348→ *\n   349→ * @returns {void}\n   350→ * @author Andres Morales\n   351→ */\n   352→function cargarArchivosExistentes() {\n   353→    if (!archivos_guardados_backend || archivos_guardados_backend.length === 0) {\n   354→        return;\n   355→    }\n   356→\n   357→    var archivos_por_documento = {};\n   358→\n   359→    archivos_guardados_backend.forEach(function(archivo) {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f46d511f-2400-40e8-ab78-dd944e9af362","timestamp":"2026-01-20T23:19:00.547Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","content":"\n    if (nombre_archivo === 'Ningún archivo seleccionado') {\n        nombre_archivo = 'seleccionado';\n    }\n\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Eliminar archivo?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Se eliminara el archivo \"${nombre_archivo}\" ¿Deseas continuar?</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Salir',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-danger w-100 justify-content-center',\n                        texto: 'Eliminar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed) {\n            $.ajax({\n                url: '/archivos/' + archivo_id,\n                type: 'DELETE',\n                headers: {\n                    'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function() {\n                    mostrarToast('success', 'Archivo eliminado exitosamente');\n\n                    if (permite_multiples) {\n                        $('#contenedor_' + input_id).remove();\n                    } else {\n                        $('#' + input_id).val('');\n                        $('#btn_eliminar_' + documento_id + '_' + indice).addClass('d-none');\n                        $('#btn_eliminar_' + documento_id + '_' + indice).attr('data-archivo-id', '');\n                    }\n\n                    actualizarDatatables('tabla-tareas-pendientes');\n                    cargarDocumentosSolicitados();\n                },\n                error: function(respuesta_xhr) {\n                    var mensaje_error = 'Error al eliminar el archivo';\n                    if (respuesta_xhr.responseJSON && respuesta_xhr.responseJSON.message) {\n                        mensaje_error = respuesta_xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje_error);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Carga los archivos guardados en los inputs correspondientes.\n * Usa los archivos guardados que vienen del backend.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction cargarArchivosExistentes() {\n    if (!archivos_guardados_backend || archivos_guardados_backend.length === 0) {\n        return;\n    }\n\n    var archivos_por_documento = {};\n\n    archivos_guardados_backend.forEach(function(archivo) {","numLines":80,"startLine":280,"totalLines":592}}}
{"parentUuid":"f46d511f-2400-40e8-ab78-dd944e9af362","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:19:05.080Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_014rEnc3bVN3UrcD1BTrrtKB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FcA9mjyEtW1y6iC3sRuNMP","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","offset":355,"limit":80}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1400,"cache_read_input_tokens":53153,"cache_creation":{"ephemeral_5m_input_tokens":1400,"ephemeral_1h_input_tokens":0},"output_tokens":18,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKV7CRCTDNEwfx1KA8RM","uuid":"2dede9b2-7e8d-4507-8449-0746884cfcb9"}
{"parentUuid":"2dede9b2-7e8d-4507-8449-0746884cfcb9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FcA9mjyEtW1y6iC3sRuNMP","type":"tool_result","content":"   355→    }\n   356→\n   357→    var archivos_por_documento = {};\n   358→\n   359→    archivos_guardados_backend.forEach(function(archivo) {\n   360→        var nombre_documento = archivo.nombre;\n   361→        var documento_encontrado = documentos_solicitables_catalogo.find(function(doc) {\n   362→            return doc.nombre_normalizado === nombre_documento;\n   363→        });\n   364→\n   365→        if (documento_encontrado) {\n   366→            if (!archivos_por_documento[documento_encontrado.id]) {\n   367→                archivos_por_documento[documento_encontrado.id] = [];\n   368→            }\n   369→            archivos_por_documento[documento_encontrado.id].push(archivo);\n   370→        }\n   371→    });\n   372→\n   373→    Object.keys(archivos_por_documento).forEach(function(documento_id) {\n   374→        var archivos = archivos_por_documento[documento_id];\n   375→        var documento = documentos_solicitables_catalogo.find(function(doc) {\n   376→            return doc.id == documento_id;\n   377→        });\n   378→\n   379→        archivos.forEach(function(archivo, index) {\n   380→            var input_id = 'input_' + documento_id + '_' + index;\n   381→            var boton_id = 'btn_eliminar_' + documento_id + '_' + index;\n   382→            var label_id = 'label_' + documento_id + '_' + index;\n   383→            var texto_id = 'texto_' + documento_id + '_' + index;\n   384→\n   385→            var input_elemento = $('#' + input_id);\n   386→\n   387→            if (input_elemento.length === 0 && documento.permite_multiples) {\n   388→                crearInputArchivo(documento_id, documento.nombre_normalizado, documento.nombre, true, index);\n   389→                input_elemento = $('#' + input_id);\n   390→            }\n   391→\n   392→            if (input_elemento.length > 0) {\n   393→                $('#' + texto_id).html('<span class=\"text-truncate\">' + archivo.nombre_original_archivo + '</span>');\n   394→                $('#' + label_id).prop('disabled', true).css('pointer-events', 'none');\n   395→\n   396→                $('#' + boton_id).removeClass('d-none');\n   397→                $('#' + boton_id).attr('data-archivo-id', archivo.id);\n   398→\n   399→                input_elemento.prop('disabled', true);\n   400→            }\n   401→        });\n   402→\n   403→        if (documento && documento.permite_multiples) {\n   404→            var ultimo_index = archivos.length;\n   405→            crearInputArchivo(documento_id, documento.nombre_normalizado, documento.nombre, true, ultimo_index);\n   406→        }\n   407→\n   408→        var titulo_documento = $('#contenedor-documento-' + documento_id).find('h6');\n   409→        if (titulo_documento.length > 0 && !titulo_documento.find('.icono-documento-cargado').length) {\n   410→            titulo_documento.append(' <i class=\"bi bi-check-circle-fill icono-documento-cargado\"></i>');\n   411→        }\n   412→    });\n   413→\n   414→    verificarDocumentosCompletos();\n   415→}\n   416→\n   417→/**\n   418→ * Guarda un archivo inmediatamente después de ser seleccionado.\n   419→ * Muestra el estado de carga y recarga los documentos.\n   420→ *\n   421→ * @param {number} documento_id - ID del documento\n   422→ * @param {File} archivo - Archivo a guardar\n   423→ * @param {string} nombre_archivo_normalizado - Nombre normalizado del documento\n   424→ * @param {HTMLElement} input_elemento - Elemento input del archivo\n   425→ * @param {boolean} permite_multiples - Si permite múltiples archivos\n   426→ * @param {number} index - Índice del input\n   427→ * @returns {void}\n   428→ * @author Andres Morales\n   429→ */\n   430→function guardarArchivoInmediatamente(documento_id, archivo, nombre_archivo_normalizado, input_elemento, permite_multiples, index) {\n   431→    var etapa_vacante_usuario_id = $('#etapa_vacante_usuario_id_documentos').val();\n   432→    var formulario_datos = new FormData();\n   433→\n   434→    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b189fd66-95cd-4c05-ae74-a89fa90808f1","timestamp":"2026-01-20T23:19:07.947Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-documentos-solicitados.js","content":"    }\n\n    var archivos_por_documento = {};\n\n    archivos_guardados_backend.forEach(function(archivo) {\n        var nombre_documento = archivo.nombre;\n        var documento_encontrado = documentos_solicitables_catalogo.find(function(doc) {\n            return doc.nombre_normalizado === nombre_documento;\n        });\n\n        if (documento_encontrado) {\n            if (!archivos_por_documento[documento_encontrado.id]) {\n                archivos_por_documento[documento_encontrado.id] = [];\n            }\n            archivos_por_documento[documento_encontrado.id].push(archivo);\n        }\n    });\n\n    Object.keys(archivos_por_documento).forEach(function(documento_id) {\n        var archivos = archivos_por_documento[documento_id];\n        var documento = documentos_solicitables_catalogo.find(function(doc) {\n            return doc.id == documento_id;\n        });\n\n        archivos.forEach(function(archivo, index) {\n            var input_id = 'input_' + documento_id + '_' + index;\n            var boton_id = 'btn_eliminar_' + documento_id + '_' + index;\n            var label_id = 'label_' + documento_id + '_' + index;\n            var texto_id = 'texto_' + documento_id + '_' + index;\n\n            var input_elemento = $('#' + input_id);\n\n            if (input_elemento.length === 0 && documento.permite_multiples) {\n                crearInputArchivo(documento_id, documento.nombre_normalizado, documento.nombre, true, index);\n                input_elemento = $('#' + input_id);\n            }\n\n            if (input_elemento.length > 0) {\n                $('#' + texto_id).html('<span class=\"text-truncate\">' + archivo.nombre_original_archivo + '</span>');\n                $('#' + label_id).prop('disabled', true).css('pointer-events', 'none');\n\n                $('#' + boton_id).removeClass('d-none');\n                $('#' + boton_id).attr('data-archivo-id', archivo.id);\n\n                input_elemento.prop('disabled', true);\n            }\n        });\n\n        if (documento && documento.permite_multiples) {\n            var ultimo_index = archivos.length;\n            crearInputArchivo(documento_id, documento.nombre_normalizado, documento.nombre, true, ultimo_index);\n        }\n\n        var titulo_documento = $('#contenedor-documento-' + documento_id).find('h6');\n        if (titulo_documento.length > 0 && !titulo_documento.find('.icono-documento-cargado').length) {\n            titulo_documento.append(' <i class=\"bi bi-check-circle-fill icono-documento-cargado\"></i>');\n        }\n    });\n\n    verificarDocumentosCompletos();\n}\n\n/**\n * Guarda un archivo inmediatamente después de ser seleccionado.\n * Muestra el estado de carga y recarga los documentos.\n *\n * @param {number} documento_id - ID del documento\n * @param {File} archivo - Archivo a guardar\n * @param {string} nombre_archivo_normalizado - Nombre normalizado del documento\n * @param {HTMLElement} input_elemento - Elemento input del archivo\n * @param {boolean} permite_multiples - Si permite múltiples archivos\n * @param {number} index - Índice del input\n * @returns {void}\n * @author Andres Morales\n */\nfunction guardarArchivoInmediatamente(documento_id, archivo, nombre_archivo_normalizado, input_elemento, permite_multiples, index) {\n    var etapa_vacante_usuario_id = $('#etapa_vacante_usuario_id_documentos').val();\n    var formulario_datos = new FormData();\n\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);","numLines":80,"startLine":355,"totalLines":592}}}
{"parentUuid":"b189fd66-95cd-4c05-ae74-a89fa90808f1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:19:12.514Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GbKkJFphgHoumLnTsimeFr","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora entiendo. Cada archivo tiene un campo `nombre` que corresponde al nombre normalizado del tipo de documento. Lo que necesito hacer es contar cuántos **tipos de documentos únicos** tienen al menos un archivo cargado por el aplicante."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1459,"cache_read_input_tokens":54553,"cache_creation":{"ephemeral_5m_input_tokens":1459,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKV7kbx9WvVkNt1yvaYt","uuid":"ffc8627e-7546-4a48-a808-edede72b6a73"}
{"parentUuid":"ffc8627e-7546-4a48-a808-edede72b6a73","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:19:18.668Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GbKkJFphgHoumLnTsimeFr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VNyRV45o1QwfmX39gF3TeM","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","new_string":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            // Contar tipos de documentos únicos que tienen al menos un archivo cargado\n            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];\n            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1459,"cache_read_input_tokens":54553,"cache_creation":{"ephemeral_5m_input_tokens":1459,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKV7kbx9WvVkNt1yvaYt","uuid":"347d5dab-0549-4e06-aef5-cd0dcf7d66cc"}
{"parentUuid":"347d5dab-0549-4e06-aef5-cd0dcf7d66cc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VNyRV45o1QwfmX39gF3TeM","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2494→        setTimeout(() => {\n  2495→            $('#contenedor-cantidad-adjuntos').empty().append(\n  2496→                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n  2497→            );\n  2498→            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n  2499→            // Contar tipos de documentos únicos que tienen al menos un archivo cargado\n  2500→            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];\n  2501→            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n  2502→        }, 100);\n  2503→        return `\n  2504→            <div class=\"col-12\">\n  2505→                <div class=\"border rounded-4 p-4 mb-4 position-relative\">"}]},"uuid":"bf94b648-52e7-47f7-a1a0-f40ed56a874e","timestamp":"2026-01-20T23:19:52.048Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","newString":"            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            // Contar tipos de documentos únicos que tienen al menos un archivo cargado\n            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];\n            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: 'rounded-3 p-1',\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion ?? 0;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n    if (adecuacion >= 10 && adecuacion <= 40) {\n        borde_color = 'borde-indice-talento-rojo';\n        etiqueta_estilo = 'badge-indice-talento-rojo';\n    } else if (adecuacion >= 41 && adecuacion <= 70) {\n        borde_color = 'borde-indice-talento-amarillo';\n        etiqueta_estilo = 'badge-indice-talento-amarillo';\n    } else if (adecuacion >= 71 && adecuacion <= 100) {\n        borde_color = 'borde-indice-talento-verde';\n        etiqueta_estilo = 'badge-indice-talento-verde';\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => identificarMejoresCandidatos();\n        let servicio_ia_id = 7; // Generar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    if (!mostro_modal_creditos_ia) {\n        funcion_ejecucion_ia = () => preguntaCandidatoRecomendadosIA();\n        let servicio_ia_id = 10; // Preguntar mejores candidatos con IA\n        mostrarModalCreditosIA(servicio_ia_id);\n        return;\n    }\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-respuesta-candidatos-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                if (validarRespuestaCreditosIA(respuesta?.data?.error)) {\n                    return;\n                }\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || ''\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n * @author Esperanza Olivo\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.solicita_formato_entrevista && etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Convertir fecha de formato 'YYYY-MM-DD' a 'DD-MM-YYYY'.\n *\n * @param {string} fecha Fecha en formato 'YYYY-MM-DD'.\n * @returns {string} Fecha en formato 'DD-MM-YYYY' o mensaje de error.\n * @author José Manuel Jiménez\n */\nfunction convertirFecha(fecha) {\n    if (!fecha) return \"\";\n    if (typeof fecha !== \"string\") {\n        fecha = String(fecha);\n    }\n    return fecha.includes('-') ? fecha.split('-').reverse().join('-') : \"Formato incorrecto\";\n};\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction crearPregunta(pregunta) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n */\nfunction crearRespuesta(pregunta) {\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            })\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                    ${etapa.id != null ? `\n                        <div class=\"col-auto mt-10\">\n                            ${crearBoton({\n                                clases: 'btn-outline-primary',\n                                texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                onclick: \"$('#documentos_contratacion').click();\"\n                            })}\n                            <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                        </div>\n                    ` : ''}\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            console.log(archivos_aplicante);\n            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    let cuerpo_acordeon = $('[data-nombre_etapa=\"Documentos para contratación\"]').find('.accordion-body');\n                    cuerpo_acordeon.empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":2496,"oldLines":8,"newStart":2496,"newLines":9,"lines":["                 crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})","             );","             let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));","-            console.log(archivos_aplicante);","-            $('.cantidad-adjuntos').text(`${archivos_aplicante.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","+            // Contar tipos de documentos únicos que tienen al menos un archivo cargado","+            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];","+            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);","         }, 100);","         return `","             <div class=\"col-12\">"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"bf94b648-52e7-47f7-a1a0-f40ed56a874e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:20:00.299Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_0126q7MwfCLNcnFkPMWQ3J93","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora el contador funciona así:\n\n**Ejemplo:**\n- 5 documentos solicitados: Cédula, Certificados laborales, Diplomas, EPS, Antecedentes\n- Archivos cargados por el aplicante:\n  - `cedula_de_ciudadania` (1 archivo)\n  - `certificados_laborales` (3 archivos) ← cuenta como 1\n  - `diplomas_de_grado` (2 archivos) ← cuenta como 1\n\n**Resultado:** \"3 de 5 Adjuntos\"\n\nEl `Set` elimina los nombres duplicados, así que solo cuenta los **tipos de documentos únicos** que tienen al menos un archivo."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":784,"cache_read_input_tokens":56012,"cache_creation":{"ephemeral_5m_input_tokens":784,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKVB7NhRWGEZqQPfDQTk","uuid":"2187c835-17a7-4b83-a370-0fafbca123c8"}
{"parentUuid":"2187c835-17a7-4b83-a370-0fafbca123c8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 535 to 540 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js:\nif (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }\n\nThis may or may not be related to the current task.</ide_selection>"}]},"uuid":"960b6e46-2bdc-4bea-b3e9-a024aef21ffb","timestamp":"2026-01-20T23:24:44.946Z"}
{"parentUuid":"960b6e46-2bdc-4bea-b3e9-a024aef21ffb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"lsito aqui tambien en tien archivos if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        } solo contaran los que no tienen en el nobre cliente_empresa_"}]},"uuid":"a917bcd6-0ad8-46ab-8c41-3ceafa86e4bd","timestamp":"2026-01-20T23:24:44.946Z"}
{"parentUuid":"a917bcd6-0ad8-46ab-8c41-3ceafa86e4bd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:24:49.120Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_018dUEAgGNZDQd3PBd5dq2Tm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UyuyJSPsGXENqP6w9ubAbN","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js","offset":530,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":553,"cache_read_input_tokens":56796,"cache_creation":{"ephemeral_5m_input_tokens":553,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKVYbdtwuCS1TJfHbpLX","uuid":"0d9ab0d8-c3da-4559-835d-999b2bb94ed4"}
{"parentUuid":"0d9ab0d8-c3da-4559-835d-999b2bb94ed4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UyuyJSPsGXENqP6w9ubAbN","type":"tool_result","content":"   530→                clase_etiqueta = es_borrador ? 'tag-filled-blue' : 'tag-filled-yellow';\n   531→                texto_estado = es_borrador ? 'Iniciada' : 'Pendiente';\n   532→            }\n   533→        }\n   534→\n   535→        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n   536→            let archivos = etapa.usuarios_vacantes[0].archivos;\n   537→            let tiene_archivos = archivos && archivos.length > 0;\n   538→            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n   539→            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n   540→        }\n   541→\n   542→        if (nombre_normalizado === 'PREGUNTASPREFILTRO') {\n   543→            clase_etiqueta = 'tag-filled-yellow';\n   544→            texto_estado = 'Pendiente';\n   545→        }\n   546→\n   547→        if (nombre_normalizado === 'REVISIONHV') {\n   548→            clase_etiqueta = 'tag-filled-yellow';\n   549→            texto_estado = 'Pendiente';\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7b2d232b-4a1e-424c-8edf-87a52a561e21","timestamp":"2026-01-20T23:24:51.377Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js","content":"                clase_etiqueta = es_borrador ? 'tag-filled-blue' : 'tag-filled-yellow';\n                texto_estado = es_borrador ? 'Iniciada' : 'Pendiente';\n            }\n        }\n\n        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'PREGUNTASPREFILTRO') {\n            clase_etiqueta = 'tag-filled-yellow';\n            texto_estado = 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'REVISIONHV') {\n            clase_etiqueta = 'tag-filled-yellow';\n            texto_estado = 'Pendiente';","numLines":20,"startLine":530,"totalLines":1219}}}
{"parentUuid":"7b2d232b-4a1e-424c-8edf-87a52a561e21","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:24:58.229Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RKL9JxjyB3e5FTiLa9KdQg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01A8ygXZv9jEujydSK9P44kV","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js","old_string":"        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }","new_string":"        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos || [];\n            let archivos_aplicante = archivos.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            let tiene_archivos = archivos_aplicante.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":674,"cache_read_input_tokens":57349,"cache_creation":{"ephemeral_5m_input_tokens":674,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKVZ3bMauTadHsfEAp3c","uuid":"fe8ec8d0-6087-4d75-a5a2-fcd30a44cfc2"}
{"parentUuid":"fe8ec8d0-6087-4d75-a5a2-fcd30a44cfc2","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01A8ygXZv9jEujydSK9P44kV","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   531→                texto_estado = es_borrador ? 'Iniciada' : 'Pendiente';\n   532→            }\n   533→        }\n   534→\n   535→        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n   536→            let archivos = etapa.usuarios_vacantes[0].archivos || [];\n   537→            let archivos_aplicante = archivos.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n   538→            let tiene_archivos = archivos_aplicante.length > 0;\n   539→            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n   540→            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n   541→        }\n   542→\n   543→        if (nombre_normalizado === 'PREGUNTASPREFILTRO') {\n   544→            clase_etiqueta = 'tag-filled-yellow';\n   545→            texto_estado = 'Pendiente';"}]},"uuid":"c00b15d8-4c87-4388-ad24-211edbb0e0b8","timestamp":"2026-01-20T23:25:04.772Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js","oldString":"        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }","newString":"        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos || [];\n            let archivos_aplicante = archivos.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            let tiene_archivos = archivos_aplicante.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }","originalFile":"var datos_ids = [];\n\n$(`#tabla-tareas-pendientes`).DataTable({\n    ...configuracion_tablas,\n    ajax: {\n        url : `/vacantes-aplicante`,\n        data: function (datos) {\n            ($('#filtro_estado_tarea').val() != 0 ) ? datos.estado_id = $('#filtro_estado_tarea').val() : '';\n            ($('#filtro_tipo_prueba').val()) ? datos.tipo_prueba_id = $('#filtro_tipo_prueba').val() : '';\n            if (typeof $('#fecha_filtro').val() === 'string') {\n                let partes_fecha = $('#fecha_filtro').val().split(' a ');\n                (partes_fecha[0]) ? datos.fecha_inicio = partes_fecha[0] : '';\n                (partes_fecha[1]) ? datos.fecha_cierre = partes_fecha[1] : '';\n            }\n        },\n        dataSrc: function (json) {\n            return Object.values(json.data);\n        }\n    },\n    columns: [\n        {\n            data: null,\n            orderable : false,\n            class: 'p-1 rounded-3',\n            render: (dato) => {\n                let es_proceso = dato.vacante_id === null || dato.agendas !== undefined;\n\n                if (es_proceso) {\n                    return renderizarProceso(dato);\n                } else {\n                    return renderizarVacante(dato);\n                }\n            }\n        }\n    ],\n    drawCallback: function() {\n        datos_ids = $('#tabla-tareas-pendientes').DataTable().data().toArray();\n        inicializarTooltips();\n        validarDatos();\n        abrirAcordeonVacante();\n    },\n    initComplete: function() {\n        datos_ids = $('#tabla-tareas-pendientes').DataTable().data().toArray();\n        $('[aria-describedby=\"tabla-tareas-pendientes_info\"] .thead-componente').hide();\n        inicializarTooltips();\n        validarDatos();\n        abrirAcordeonVacante();\n    }\n}); \n\n$(document).ready(function() {\n    $(document).on('change', '#filtro_estado_tarea, #filtro_tipo_prueba, #filtro_fecha', function(){\n        actualizarDatatables('tabla-tareas-pendientes');\n    });\n});\n\n/**\n * Muestra u oculta tablas según la existencia de datos.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarDatos() {\n    var tiene_filtros_aplicados = verificarFiltrosAplicados();\n\n    if (datos_ids.length == 0) {\n        if (tiene_filtros_aplicados) {\n            // Si hay filtros aplicados, mostrar los controles pero con empty state en la tabla\n            $('#tabla-contenido').removeClass('d-none');\n            $('#tabla-sin-contenido').addClass('d-none');\n            mostrarEstadoVacioFiltros();\n        } else {\n            // Si no hay filtros, ocultar todo y mostrar el empty state general\n            $('#tabla-contenido').addClass('d-none');\n            $('#tabla-sin-contenido').removeClass('d-none');\n        }\n    } else {\n        $('#tabla-contenido').removeClass('d-none');\n        $('#tabla-sin-contenido').addClass('d-none');\n        ocultarEstadoVacioFiltros();\n    }\n}\n\n/**\n * Verifica si hay filtros aplicados en la tabla.\n *\n * @returns {boolean}\n * @author Andres Morales\n */\nfunction verificarFiltrosAplicados() {\n    var valor_filtro_estado = $('#filtro_estado_tarea').val();\n    var valor_filtro_fecha = $('#filtro_fecha').val();\n    var valor_buscador = $('.dt-search input').val();\n\n    return (valor_filtro_estado && valor_filtro_estado != '0') ||\n           (valor_filtro_fecha && valor_filtro_fecha.trim() !== '') ||\n           (valor_buscador && valor_buscador.trim() !== '');\n}\n\n/**\n * Muestra el empty state cuando hay filtros aplicados pero no hay resultados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction mostrarEstadoVacioFiltros() {\n    var contenedor_tabla = $('#tabla-tareas-pendientes_wrapper');\n\n    if (contenedor_tabla.find('.estado-vacio-filtros').length === 0) {\n        var html_estado_vacio = `\n            <div class=\"estado-vacio-filtros w-100 text-center p-10\">\n                <p class=\"\"><i class=\"bi bi-funnel text-gray-60 icono-estado-vacio\"></i></p>\n                <p class=\"pb-4 text-headline-5 fw-bold text-gray-30\">No se encontraron resultados con los filtros aplicados.</p>\n            </div>\n        `;\n        contenedor_tabla.find('table').hide();\n        contenedor_tabla.append(html_estado_vacio);\n    }\n}\n\n/**\n * Oculta el empty state de filtros cuando hay resultados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction ocultarEstadoVacioFiltros() {\n    var contenedor_tabla = $('#tabla-tareas-pendientes_wrapper');\n    contenedor_tabla.find('.estado-vacio-filtros').remove();\n    contenedor_tabla.find('table').show();\n}\n\n/**\n * Renderiza una tarjeta para un proceso con agendas.\n *\n * @param {Object} dato - Objeto de proceso con agendas.\n * @returns {string} HTML generado con la estructura de la tarjeta del proceso.\n * @author Andres Morales\n */\nfunction renderizarProceso(dato) {\n    let es_primera_columna = false;\n    let clase_boton = es_primera_columna ? 'accordion-button shadow-none text-body-1' : 'accordion-button shadow-none text-body-1 collapsed';\n    let area_expandida = es_primera_columna ? 'true' : 'false';\n    let clase_para_colapsado = es_primera_columna ? 'accordion-collapse collapse show' : 'accordion-collapse collapse';\n    let mostrar_empresa = (dato?.mostrar_logo_aplicante === true) || (Number(dato?.mostrar_logo_aplicante) === 1);\n    let empresa_html = mostrar_empresa ? `\n                    <div class=\"col-12 d-flex\">\n                        <i class=\"my-auto bi bi-buildings-fill text-body-3 text-gray-30\"></i>\n                        <h5 class=\"my-auto card-title text-body-3 text-gray-30 mx-2\">Empresa:</h5>\n                        <img class=\"my-auto border rounded\" width=\"24px\" height=\"24px\" src=\"/empresas-logo/${dato?.empresa_id}\" alt=\"${dato?.empresa?.nombre_comercial}\" onerror=\"this.onerror=null;\"/>\n                        <h5 class=\"my-auto card-title text-body-3 text-gray-30 mx-2\">${dato?.empresa?.nombre_comercial}</h5>\n                    </div>\n    ` : '';\n\n    let total_agendas = (dato?.agendas && dato.agendas.length > 0) ? dato.agendas.length : 1;\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"row mb-3\">\n                    <div class=\"col-12\">\n                        <h5 class=\"card-title text-body-1 fw-bolder text-gray-10\">${dato.nombre}</h5>\n                    </div>\n                    ${empresa_html}\n                </div>\n                <div class=\"accordion\" id=\"accordionProceso${dato?.id}\">\n                    <div class=\"accordion-item\">\n                        <h2 class=\"accordion-header\">\n                            <button class=\"${clase_boton} d-flex justify-content-between align-items-center\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#collapseProceso${dato.id}\" aria-expanded=\"${area_expandida}\" aria-controls=\"collapseProceso${dato.id}\">\n                                <span>Ver tareas pendientes</span>\n                                ${total_agendas > 0 ? `<span class=\"badge bg-danger rounded-pill text-label-2\">${total_agendas}</span>` : ''}\n                            </button>\n                        </h2>\n                        <div id=\"collapseProceso${dato.id}\" class=\"${clase_para_colapsado}\" data-bs-parent=\"#accordionProceso${dato?.id}\">\n                            <div class=\"accordion-body\">\n                                <h1 class=\"text-headline-5 fw-bloder text-gray-10\">Pruebas psicométricas</h1>\n                                <div class=\"row gap-4 m-0\">${procesarAgendas(dato?.agendas)}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderiza una tarjeta para una vacante con etapas.\n *\n * @param {Object} dato - Objeto de vacante con etapas.\n * @returns {string} HTML generado con la estructura de la tarjeta de la vacante.\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author José Manuel Jiménez\n */\nfunction renderizarVacante(dato) {\n    let es_primera_columna = false;\n    let clase_boton = es_primera_columna ? 'accordion-button shadow-none text-body-1' : 'accordion-button shadow-none text-body-1 collapsed';\n    let area_expandida = es_primera_columna ? 'true' : 'false';\n    let clase_para_colapsado = es_primera_columna ? 'accordion-collapse collapse show' : 'accordion-collapse collapse';\n    let mostrar_empresa = dato?.empresa !== null && dato?.empresa !== undefined;\n\n    let etapa_actual = dato.etapa_actual || 0;\n    let total_etapas = dato.total_etapas || 0;\n    let porcentaje_progreso = (etapa_actual / total_etapas) * 100;\n\n    let total_agendas = 0;\n    let total_etapas_activas = 0;\n\n    if (dato?.etapas && dato.etapas.length > 0) {\n        dato.etapas.forEach((etapa) => {\n            var nombre_normalizado = normalizarNombreEtapa(etapa.nombre);\n            if (nombre_normalizado === 'PRUEBASPSICOMETRICAS' && etapa.agendas && etapa.agendas.length > 0) {\n                total_agendas += etapa.agendas.length;\n            } else if (nombre_normalizado !== 'PRUEBASPSICOMETRICAS' && etapa.activa == 1) {\n                if (nombre_normalizado === 'VIDEOENTREVISTA') {\n                    if (etapa.usuarios_vacantes[0].etapa_video_entrevista_completa != true) {\n                        total_etapas_activas++;\n                    }\n                    let solicita_formato = obtenerConfiguracionPorLlave(etapa.configuraciones, 'solicitar_formato_videoentrevista');\n                    if (solicita_formato == '1') {\n                        let formato_entrevista = etapa.usuarios_vacantes[0].formato_entrevista;\n                        let completo_formato_entrevista = formato_entrevista && formato_entrevista.descripcion_vacante !== null;\n                        if (completo_formato_entrevista == null) {\n                            total_etapas_activas++;\n                        }\n                    }\n                } else {\n                    total_etapas_activas++;\n                }\n            } else {\n                total_etapas_activas++;\n            }\n        });\n    }\n\n    let total_tareas_alerta = total_agendas > 0 ? total_agendas : total_etapas_activas;\n\n    let titulo_tareas = total_agendas > 0\n        ? `Pruebas psicométricas (${total_agendas})`\n        : `Tareas de selección (${total_etapas_activas})`;\n\n    let empresa_html = mostrar_empresa ? `\n        <div class=\"col-12 d-flex\">\n            <i class=\"my-auto bi bi-buildings-fill text-body-3 text-gray-30\"></i>\n            <h5 class=\"my-auto card-title text-body-3 text-gray-30 mx-2\">Empresa:</h5>\n            <img class=\"my-auto border rounded\" width=\"24px\" height=\"24px\" src=\"/empresas-logo/${dato?.empresa_id}\" alt=\"${dato?.empresa?.nombre_comercial}\" onerror=\"this.onerror=null;\"/>\n            <h5 class=\"my-auto card-title text-body-3 text-gray-30 mx-2\">${dato?.empresa?.nombre_comercial}</h5>\n        </div>\n    ` : '';\n\n    let barra_progreso_html = `\n        <div class=\"col-12 mt-3\">\n            ${crearProgressBar({\n                label: '<span class=\"text-body-3 fw-bolder mb-3\"><i class=\"bi bi-bar-chart-steps me-2\"></i>Etapa actual: ' + etapa_actual + ' de ' + total_etapas + '</span>',\n                height: '8px',\n                class_label: 'mb-1',\n                porcentaje: {\n                    porcentaje: porcentaje_progreso,\n                    texto: false\n                },\n                class: 'barra-progreso-etapa',\n                rounded: 'rounded-3',\n                rounded2: 'rounded-3'\n            })}\n        </div>\n    `;\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"row mb-3\">\n                    <div class=\"col-12\">\n                        <h5 class=\"card-title text-body-1 fw-bolder text-gray-10\">${dato.nombre_vacante}</h5>\n                    </div>\n                    ${empresa_html}\n                    ${barra_progreso_html}\n                </div>\n                <div class=\"accordion\" id=\"accordionVacante${dato?.id}\">\n                    <div class=\"accordion-item\">\n                        <h2 class=\"accordion-header\">\n                            <button class=\"${clase_boton} d-flex justify-content-between align-items-center\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#collapseVacante${dato.id}\" aria-expanded=\"${area_expandida}\" aria-controls=\"collapseVacante${dato.id}\">\n                                <span>Ver tareas pendientes</span>\n                                ${total_tareas_alerta > 0 ? `<span class=\"badge bg-danger rounded-pill text-label-2\">${total_tareas_alerta}</span>` : ''}\n                            </button>\n                        </h2>\n                        <div id=\"collapseVacante${dato.id}\" class=\"${clase_para_colapsado}\" data-bs-parent=\"#accordionVacante${dato?.id}\">\n                            <div class=\"accordion-body\">\n                                ${total_tareas_alerta > 0 ? `<h1 class=\"text-headline-5 fw-bloder text-gray-10\">${titulo_tareas}</h1>` : ''}\n                                <div class=\"row gap-4 m-0\">${procesarEtapas(dato?.etapas, dato?.id)}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Genera el HTML para mostrar una lista de agendas en tarjetas (cards) con su información detallada.\n *\n * @param {Array<Object>} agendas - Arreglo de objetos de agenda a procesar.\n * @returns {string} HTML generado con la estructura de las tarjetas para cada agenda.\n * @author Andres Morales\n * @author Fahibram Cárcamo\n * @author Andres Gonzalez\n */\nfunction procesarAgendas(agendas) {\n    let estado_clases = {\n        '1': 'tag-filled-yellow',\n        '2': 'tag-filled-blue',\n        '3': 'tag-filled-green',\n        '4': 'tag-filled-red',\n        '5': 'tag-filled-gray',\n        '6': 'tag-filled-green'\n    };\n    let html = '';\n\n    if (!agendas || agendas.length === 0) {\n        return '<div class=\"col-12\"><p class=\"text-center text-gray-30\">No hay pruebas asignadas</p></div>';\n    }\n\n    let orden_estado = [2, 1, 3, 4];\n\n    agendas.sort((a, b) => {\n        let primer_estado = orden_estado.indexOf(Number(a.estado_id));\n        let segundo_estado = orden_estado.indexOf(Number(b.estado_id));\n        return (primer_estado === -1 ? orden_estado.length : primer_estado) - (segundo_estado === -1 ? orden_estado.length : segundo_estado);\n    });\n\n    agendas.forEach((agenda) => {\n        if (agenda.estado.nombre == 'Agendada') agenda.estado.nombre = 'Pendiente';\n        else if (agenda.estado.nombre == 'Sin pago') agenda.estado.nombre = 'Finalizada';\n\n        html += `\n            <div class=\"col p-0 columna-tarjeta-tarea\">\n                <div class=\"card h-100\">\n                    <div class=\"card-body d-flex flex-column cuerpo-tarjeta-tarea\">\n                        <div class=\"w-100 d-flex flex-column row-gap-3\">\n                            <div class=\"w-100 d-flex justify-content-between align-items-center\">\n                                <h5 class=\"card-title text-headline-5 text-gray-10 fw-medium fw-bold m-0\">${agenda?.prueba?.nombre ?? ''}</h5>\n                                <div class=\"d-flex flex-row\">\n                                    ${\n                                        (estado_clases[agenda.estado_id])\n                                            ? crearTag({\n                                                texto: agenda?.estado?.nombre ?? '',\n                                                class: estado_clases[agenda.estado_id]\n                                            })\n                                            : ''\n                                    }\n                                    ${\n                                        (agenda?.estado_id == \"4\")\n                                            ? `<i\n                                                class=\"bi bi-info-circle-fill text-info ms-3 text-headline-3 pointer\"\n                                                ${crearTooltip({\n                                                    placement: `top`,\n                                                    content: `Esta tarea ha expirado debido a que se ha superado el tiempo límite de entrega.`,\n                                                    toggle: `popover`\n                                                })}\n                                            ></i>`\n                                            : ''\n                                    }\n                                </div>\n                            </div>\n\n                            <div class=\"w-100 d-flex flex-column row-gap-2\">\n                                <div class=\"w-100 d-flex justify-content-start\">\n                                    <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-clock me-2\"></i>Tiempo estimo:&nbsp;${agenda?.prueba?.duracion ?? '0'}&nbsp;minutos</p>\n                                </div>\n                                <div class=\"w-100 d-flex justify-content-start\">\n                                    <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-green-cta me-2\"></i>Asignada:&nbsp;${formatearFecha(agenda?.fecha_inicio)}</p>\n                                </div>\n                                <div class=\"w-100 d-flex justify-content-start\">\n                                    <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-red-cta me-2\"></i>Expira:&nbsp;${formatearFecha(agenda?.fecha_cierre)}</p>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"w-100\">\n                            ${\n                                (agenda.estado_id == \"1\")\n                                    ? crearBoton({\n                                        clases: 'btn-primary w-100 d-flex justify-content-center',\n                                        texto: 'Responder',\n                                        onclick: `iniciarPruebaConDemograficas(${agenda.id}, ${agenda.prueba_id})`\n                                    })\n                                    : (agenda.estado_id == \"2\")\n                                        ? crearBoton({\n                                            clases: 'btn-primary w-100 d-flex justify-content-center',\n                                            texto: 'Continuar',\n                                            onclick: `iniciarPruebaConDemograficas(${agenda.id}, ${agenda.prueba_id})`\n                                        })\n                                        : ''\n                            }\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n\n    return html;\n}\n\n/**\n * Obtiene el texto del botón según el tipo de etapa\n * \n * @param {string} nombre_etapa - Nombre de la etapa\n * @returns {string} Texto del botón\n * @author Andres Morales\n */\nfunction obtenerTextoBotonEtapa(nombre_etapa) {\n    var nombre_normalizado = nombre_etapa\n        .toUpperCase()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '')\n        .replace(/[^A-Z0-9]/g, '');\n\n    switch(nombre_normalizado) {\n        case 'PREGUNTASPREFILTRO':\n            return 'Responder';\n        case 'PRUEBATECNICA':\n            return 'Responder';\n        case 'DOCUMENTOSPARACONTRATACION':\n            return `<i class=\"bi bi-eye me-2\"></i> Ver y adjuntar`;\n        case 'ENTREVISTA':\n            return 'Responder';\n        case 'REVISIONHV':\n            return 'Responder';\n        default:\n            return 'Responder';\n    }\n}\n\n/**\n * Obtiene el valor de una configuración por su llave\n * \n * @param {Array} configuraciones - Array de configuraciones\n * @param {string} llave_buscar - Llave a buscar en movimiento_configuracion (puede ser parcial)\n * @param {boolean} busqueda_parcial - Si es true, busca coincidencia parcial en la llave\n * @returns {string|null} Valor de la configuración o null si no existe\n * @author Andres Morales\n */\nfunction obtenerConfiguracionPorLlave(configuraciones, llave_buscar, busqueda_parcial = false) {\n    if (!configuraciones || configuraciones.length === 0) return null;\n\n    var configuracion = configuraciones.find(config => {\n        var llave = config?.movimiento_configuracion?.llave;\n        if (!llave) return false;\n\n        return busqueda_parcial ? llave.includes(llave_buscar) : llave === llave_buscar;\n    });\n\n    return configuracion?.valor ?? null;\n}\n\n/**\n * Normaliza el nombre de una etapa removiendo espacios, acentos y caracteres especiales.\n *\n * @param {string} nombre - Nombre de la etapa a normalizar\n * @returns {string} Nombre normalizado en mayúsculas sin espacios ni acentos\n * @author Andres Morales\n */\nfunction normalizarNombreEtapa(nombre) {\n    if (!nombre) return '';\n\n    return nombre\n        .toUpperCase()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '')\n        .replace(/[^A-Z0-9]/g, '');\n}\n\n/**\n * Genera el HTML para mostrar una lista de etapas en tarjetas (cards) con su información detallada.\n *\n * @param {Array<Object>} etapas - Arreglo de objetos de etapas a procesar.\n * @param {number} vacante_id - ID de la vacante a la que pertenecen las etapas.\n * @returns {string} HTML generado con la estructura de las tarjetas para cada etapa.\n * @author Andres Morales\n * @author Fahibram Cárcamo\n * @author Andres Gonzalez\n */\nfunction procesarEtapas(etapas, vacante_id) {\n    let html = '';\n\n    if (!etapas || etapas.length === 0) {\n        return '<div class=\"col-12\"><p class=\"text-center text-gray-30\">No hay tareas pendientes</p></div>';\n    }\n\n    let etapas_ordenadas = [...etapas].sort((a, b) => a.orden - b.orden);\n\n    etapas_ordenadas.forEach((etapa) => {\n        // Si la etapa es \"Pruebas psicométricas\" y tiene agendas, mostrarlas en lugar de la etapa\n        var nombre_normalizado = normalizarNombreEtapa(etapa.nombre);\n\n        if (nombre_normalizado === 'PRUEBASPSICOMETRICAS' && etapa.agendas && etapa.agendas.length > 0) {\n            html += procesarAgendas(etapa.agendas);\n            return;\n        }\n\n        // Si la etapa es \"Videoentrevista\" y tiene formato de entrevista configurado, mostrar ambas cards\n        if (nombre_normalizado === 'VIDEOENTREVISTA') {\n            let solicita_formato = obtenerConfiguracionPorLlave(etapa.configuraciones, 'solicitar_formato_videoentrevista');\n\n            if (solicita_formato === '1') {\n                html += generarContenedorFormatoEntrevista(etapa, vacante_id);\n                html += generarCardVideoentrevista(etapa, vacante_id);\n                return;\n            }\n        }\n\n        let esta_activa = etapa.activa == 1;\n        let tiene_tareas = etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0;\n\n        let clase_etiqueta = esta_activa ? 'tag-filled-blue' : 'tag-filled-yellow';\n        let texto_estado = esta_activa ? 'Iniciada' : 'Pendiente';\n        let $tiempo_prueba = Math.round((etapa.duracion ?? 300) / 60);\n        let nombre_etapa = etapa.nombre || '';\n\n        if (nombre_normalizado === 'PRUEBATECNICA' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let pruebas_tecnicas = etapa.usuarios_vacantes[0].pruebas_tecnicas;\n            if (pruebas_tecnicas && pruebas_tecnicas.length > 0) {\n                let es_borrador = pruebas_tecnicas[0].borrador == 1;\n                clase_etiqueta = es_borrador ? 'tag-filled-blue' : 'tag-filled-yellow';\n                texto_estado = es_borrador ? 'Iniciada' : 'Pendiente';\n            } else {\n                let es_borrador = false;\n                clase_etiqueta = es_borrador ? 'tag-filled-blue' : 'tag-filled-yellow';\n                texto_estado = es_borrador ? 'Iniciada' : 'Pendiente';\n            }\n        }\n\n        if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n            let archivos = etapa.usuarios_vacantes[0].archivos;\n            let tiene_archivos = archivos && archivos.length > 0;\n            clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'PREGUNTASPREFILTRO') {\n            clase_etiqueta = 'tag-filled-yellow';\n            texto_estado = 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'REVISIONHV') {\n            clase_etiqueta = 'tag-filled-yellow';\n            texto_estado = 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'VIDEOENTREVISTA') {\n            clase_etiqueta = 'tag-filled-yellow';\n            texto_estado = 'Pendiente';\n        }\n\n        if (nombre_normalizado === 'ENTREVISTA') {\n            $tiempo_prueba = 15\n            let formato_entrevista       = etapa.usuarios_vacantes[0].formato_entrevista;\n            let tiene_formato_entrevista = formato_entrevista && formato_entrevista.descripcion_vacante !== null;\n            clase_etiqueta               = tiene_formato_entrevista ? 'tag-filled-blue' : 'tag-filled-yellow';\n            texto_estado                 = tiene_formato_entrevista ? 'Iniciada' : 'Pendiente';\n            nombre_etapa                 = 'Formato de entrevista';\n        }\n\n        let fecha_notificacion = etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0\n            ? etapa.usuarios_vacantes[0].fecha_notificacion\n            : null;\n\n        let fecha_vencimiento = etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0\n            ? etapa.usuarios_vacantes[0].fecha_vencimiento\n            : null;\n\n        let es_documentos_solicitados = nombre_normalizado === 'DOCUMENTOSPARACONTRATACION';\n        let ocultar_tiempo_estimado = ['REVISIONHV', 'PRUEBATECNICA', 'DOCUMENTOSPARACONTRATACION'].includes(nombre_normalizado);\n\n        html += `\n            <div class=\"col p-0 columna-tarjeta-tarea\">\n                <div class=\"card h-100\">\n                    <div class=\"card-body d-flex flex-column cuerpo-tarjeta-tarea\">\n\n                        <div class=\"w-100 d-flex flex-column row-gap-3\">\n\n                            <div class=\"w-100 d-flex justify-content-between align-items-center\">\n                                <h5 class=\"card-title text-headline-5 text-gray-10 fw-medium fw-bold m-0\">${nombre_etapa ?? ''}</h5>\n                                <div class=\"d-flex flex-row\">\n                                    ${crearTag({\n                                        texto: texto_estado,\n                                        class: clase_etiqueta\n                                    })}\n                                </div>\n                            </div>\n\n                            <div class=\"w-100 d-flex flex-column row-gap-2\">\n                                ${\n                                    !ocultar_tiempo_estimado\n                                        ? `<div class=\"w-100 d-flex justify-content-start\">\n                                            <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-clock me-2\"></i>Tiempo estimado:&nbsp;${$tiempo_prueba}&nbsp;minutos</p>\n                                        </div>`\n                                        : ''\n                                }\n                                <div class=\"w-100 d-flex justify-content-start\">\n                                    <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-green-cta me-2\"></i>Asignada:&nbsp;${formatearFecha(fecha_notificacion ?? etapa.created_at)}</p>\n                                </div>\n                                <div class=\"w-100 d-flex justify-content-start\">\n                                    <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-red-cta me-2\"></i>Expira:&nbsp;${formatearFecha(fecha_vencimiento ?? etapa.created_at)}</p>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"w-100\">\n                            ${\n                                (esta_activa && tiene_tareas)\n                                    ? crearBoton({\n                                        clases: 'btn-primary w-100 d-flex justify-content-center',\n                                        texto: obtenerTextoBotonEtapa(etapa.nombre),\n                                        onclick: `ejecutarAccionEtapa(${etapa.id}, ${vacante_id})`\n                                    })\n                                    : ''\n                            }\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n\n    return html;\n}\n\n/**\n * Genera la card HTML para la etapa de Formato de entrevista dentro de Videoentrevista.\n *\n * @param {Object} etapa - Objeto de etapa de videoentrevista con formato de entrevista.\n * @param {number} vacante_id - ID de la vacante a la que pertenece la etapa.\n * @returns {string} HTML generado con la estructura de la card de formato de entrevista.\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction generarContenedorFormatoEntrevista(etapa, vacante_id) {\n    let formato_entrevista = etapa.usuarios_vacantes[0].formato_entrevista;\n    let tiene_formato_entrevista = formato_entrevista && formato_entrevista.descripcion_vacante !== null;\n\n    let descripcion_tiene_datos = formato_entrevista &&\n                                  formato_entrevista.descripcion_vacante !== null &&\n                                  formato_entrevista.descripcion_vacante !== undefined &&\n                                  formato_entrevista.descripcion_vacante.trim() !== '';\n\n    if (descripcion_tiene_datos) {\n        return '';\n    }\n\n    let clase_etiqueta = tiene_formato_entrevista ? 'tag-filled-blue' : 'tag-filled-yellow';\n    let texto_estado = tiene_formato_entrevista ? 'Iniciada' : 'Pendiente';\n    let tiempo_prueba = 15;\n\n    let fecha_notificacion = etapa.usuarios_vacantes[0].fecha_notificacion;\n    let fecha_vencimiento = etapa.usuarios_vacantes[0].fecha_vencimiento;\n\n    let esta_activa = etapa.activa == 1;\n    let tiene_tareas = etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0;\n\n    return `\n        <div class=\"col p-0 columna-tarjeta-tarea\">\n            <div class=\"card h-100\">\n                <div class=\"card-body d-flex flex-column cuerpo-tarjeta-tarea\">\n\n                    <div class=\"w-100 d-flex flex-column row-gap-3\">\n\n                        <div class=\"w-100 d-flex justify-content-between align-items-center\">\n                            <h5 class=\"card-title text-headline-5 text-gray-10 fw-medium fw-bold m-0\">Formato de entrevista</h5>\n                            <div class=\"d-flex flex-row\">\n                                ${crearTag({\n                                    texto: texto_estado,\n                                    class: clase_etiqueta\n                                })}\n                            </div>\n                        </div>\n\n                        <div class=\"w-100 d-flex flex-column row-gap-2\">\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-clock me-2\"></i>Tiempo estimado:&nbsp;${tiempo_prueba}&nbsp;minutos</p>\n                            </div>\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-green-cta me-2\"></i>Asignada:&nbsp;${formatearFecha(fecha_notificacion ?? etapa.created_at)}</p>\n                            </div>\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-red-cta me-2\"></i>Expira:&nbsp;${formatearFecha(fecha_vencimiento ?? etapa.created_at)}</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"w-100\">\n                        ${\n                            (esta_activa && tiene_tareas)\n                                ? crearBoton({\n                                    clases: 'btn-primary w-100 d-flex justify-content-center',\n                                    texto: 'Responder',\n                                    onclick: `ejecutarAccionFormatoEntrevista(${etapa.id}, ${vacante_id})`\n                                })\n                                : ''\n                        }\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Genera la card HTML para la etapa de Videoentrevista.\n *\n * @param {Object} etapa - Objeto de etapa de videoentrevista.\n * @param {number} vacante_id - ID de la vacante a la que pertenece la etapa.\n * @returns {string} HTML generado con la estructura de la card de videoentrevista.\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction generarCardVideoentrevista(etapa, vacante_id) {\n    // Si la videoentrevista está completa, no mostrar la card\n    if (etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {\n        let etapa_completa = etapa.usuarios_vacantes[0].etapa_video_entrevista_completa;\n        if (etapa_completa === true) {\n            return '';\n        }\n    }\n\n    let clase_etiqueta = 'tag-filled-yellow';\n    let texto_estado = 'Pendiente';\n    let tiempo_prueba = Math.round((etapa.duracion ?? 300) / 60);\n\n    let fecha_notificacion = etapa.usuarios_vacantes[0].fecha_notificacion;\n    let fecha_vencimiento = etapa.usuarios_vacantes[0].fecha_vencimiento;\n\n    let esta_activa = etapa.activa == 1;\n    let tiene_tareas = etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0;\n\n    return `\n        <div class=\"col p-0 columna-tarjeta-tarea\">\n            <div class=\"card h-100\">\n                <div class=\"card-body d-flex flex-column cuerpo-tarjeta-tarea\">\n\n                    <div class=\"w-100 d-flex flex-column row-gap-3\">\n\n                        <div class=\"w-100 d-flex justify-content-between align-items-center\">\n                            <h5 class=\"card-title text-headline-5 text-gray-10 fw-medium fw-bold m-0\">Video entrevista</h5>\n                            <div class=\"d-flex flex-row\">\n                                ${crearTag({\n                                    texto: texto_estado,\n                                    class: clase_etiqueta\n                                })}\n                            </div>\n                        </div>\n\n                        <div class=\"w-100 d-flex flex-column row-gap-2\">\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-clock me-2\"></i>Tiempo estimado:&nbsp;${tiempo_prueba}&nbsp;minutos</p>\n                            </div>\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-green-cta me-2\"></i>Asignada:&nbsp;${formatearFecha(fecha_notificacion ?? etapa.created_at)}</p>\n                            </div>\n                            <div class=\"w-100 d-flex justify-content-start\">\n                                <p class=\"text-label-2 text-gray-30 mb-0\"><i class=\"bi bi-circle-fill text-red-cta me-2\"></i>Expira:&nbsp;${formatearFecha(fecha_vencimiento ?? etapa.created_at)}</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"w-100\">\n                        ${\n                            (esta_activa && tiene_tareas)\n                                ? crearBoton({\n                                    clases: 'btn-primary w-100 d-flex justify-content-center',\n                                    texto: 'Responder',\n                                    onclick: `ejecutarAccionVideoentrevista(${etapa.id}, ${vacante_id})`\n                                })\n                                : ''\n                        }\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Valida si el usuario tiene la información básica completada.\n * Si no la tiene, muestra el modal de información incompleta.\n *\n * @returns {Promise<boolean>} true si la información está completa, false si no\n * @author Andres Morales\n */\nfunction validarInformacionBasicaUsuario() {\n    return new Promise((resolucion, rechazo) => {\n        $.ajax({\n            url: '/usuario-validar-informacion-basica',\n            type: 'GET',\n            success: function(respuesta) {\n                if (respuesta.data.informacion_completa) {\n                    resolucion(true);\n                } else {\n                    // Guardar el usuario_id para usarlo después\n                    window.usuario_id_actual = respuesta.data.usuario_id;\n                    $('#modal-informacion-incompleta').modal('show');\n                    resolucion(false);\n                }\n            },\n            error: function(respuesta_xhr) {\n                mostrarToast('danger', 'Error al validar la información. Intenta nuevamente.');\n                rechazo(false);\n            }\n        });\n    });\n}\n\n/**\n * Cierra el modal de información incompleta.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction cerrarModalInformacionIncompleta() {\n    $('#modal-informacion-incompleta').modal('hide');\n}\n\n/**\n * Redirige al usuario a la página de editar perfil.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction irEditarPerfil() {\n    var usuario_id = window.usuario_id_actual || '';\n    if (usuario_id) {\n        window.location.href = `/usuarios/${usuario_id}/edit`;\n    } else {\n        mostrarToast('danger', 'No se pudo obtener el ID del usuario.');\n    }\n}\n\n/**\n * Ejecuta la acción correspondiente según el tipo de etapa de la vacante.\n * Valida la existencia de la vacante y etapa, y delega a la función específica.\n *\n * @param {number} etapa_id - ID de la etapa a ejecutar\n * @param {number} vacante_id - ID de la vacante asociada\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction ejecutarAccionEtapa(etapa_id, vacante_id) {\n    // Primero validar la información básica del usuario\n    validarInformacionBasicaUsuario().then(function(informacion_completa) {\n        if (!informacion_completa) {\n            return;\n        }\n\n        // Si la información está completa, continuar con la lógica original\n        ejecutarAccionEtapaInterno(etapa_id, vacante_id);\n    });\n}\n\n/**\n * Función interna que ejecuta la acción de la etapa sin validación previa.\n *\n * @param {number} etapa_id - ID de la etapa a ejecutar\n * @param {number} vacante_id - ID de la vacante asociada\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction ejecutarAccionEtapaInterno(etapa_id, vacante_id) {\n    var vacante = datos_ids.find(elemento_vacante => elemento_vacante.id === vacante_id && elemento_vacante.hasOwnProperty('etapas'));\n\n    if (!vacante) {\n        mostrarToast('danger', 'No se encontró la vacante');\n        return;\n    }\n\n    var etapa = vacante.etapas.find(elemento_etapa => elemento_etapa.id === etapa_id);\n\n    if (!etapa) {\n        mostrarToast('danger', 'No se encontró la etapa');\n        return;\n    }\n\n    if (!etapa.usuarios_vacantes || etapa.usuarios_vacantes.length === 0) {\n        mostrarToast('danger', 'No tienes asignada esta etapa');\n        return;\n    }\n\n    var descripcion_prueba = obtenerConfiguracionPorLlave(etapa.configuraciones, 'descripcion_prueba_tecnica');\n    var fecha_vencimiento = etapa.usuarios_vacantes[0].fecha_vencimiento;\n\n    var documentos_solicitados_config = obtenerConfiguracionPorLlave(etapa.configuraciones, 'documentos_solicitados');\n    var documentos_solicitados = [];\n\n    if (documentos_solicitados_config) {\n        try {\n            documentos_solicitados = JSON.parse(documentos_solicitados_config);\n        } catch (e) {\n            console.error('Error al parsear documentos solicitados:', e);\n        }\n    }\n\n    var datos_etapa = {\n        id: etapa.id,\n        nombre: etapa.nombre,\n        etapa_vacante_usuario_id: etapa.usuarios_vacantes[0].id,\n        archivos: etapa.archivos || [],\n        vacante_nombre: vacante.nombre_vacante,\n        vacante_id: vacante.id,\n        descripcion: descripcion_prueba,\n        fecha_cierre: fecha_vencimiento,\n        documentos_solicitados: documentos_solicitados,\n        configuracion_ia_hv : obtenerConfiguracionPorLlave(etapa.configuraciones, 'revision_hv_ia'),\n        prueba_tecnica: etapa.usuarios_vacantes[0].pruebas_tecnicas && etapa.usuarios_vacantes[0].pruebas_tecnicas.length > 0\n            ? etapa.usuarios_vacantes[0].pruebas_tecnicas[0]\n            : null\n    };\n\n    var nombre_normalizado = normalizarNombreEtapa(etapa.nombre);\n\n    switch(nombre_normalizado) {\n        case 'VIDEOENTREVISTA':\n            window.location.href = `/bienvenida-preguntas-videoentrevista?etapa_vacante_id=${datos_etapa.id}`;\n            break;\n\n        case 'PREGUNTASPREFILTRO':\n            window.location.href = `/bienvenida-preguntas-prefiltro?etapa_vacante_id=${datos_etapa.id}`;\n            break;\n\n        case 'PRUEBATECNICA':\n            abrirModalPruebaTecnica(datos_etapa);\n            break;\n\n        case 'DOCUMENTOSPARACONTRATACION':\n            abrirModalDocumentosSolicitados(datos_etapa);\n            break;\n\n        case 'ENTREVISTA':\n            window.location.href = `/formatos-entrevistas/create?etapa_vacante_usuario_id=${datos_etapa.etapa_vacante_usuario_id}`;\n            break;\n\n        case 'REVISIONHV':\n            limpiarFormularioRevisionHV();\n            abrirModalRevisionHV(datos_etapa);\n            break;\n\n        default:\n            mostrarToast('info', 'No hay acciones disponibles para esta etapa');\n            break;\n    }\n}\n\n/**\n * Ejecuta la acción de videoentrevista directamente sin validación de información básica.\n *\n * @param {number} etapa_id - ID de la etapa a ejecutar\n * @param {number} vacante_id - ID de la vacante asociada\n * @returns {void}\n * @author Andres Morales\n */\nfunction ejecutarAccionVideoentrevista(etapa_id, vacante_id) {\n    validarInformacionBasicaUsuario().then(function(informacion_completa) {\n        if (!informacion_completa) {\n            return;\n        }\n        window.location.href = `/bienvenida-preguntas-videoentrevista?etapa_vacante_id=${etapa_id}`;\n    });\n}\n\n/**\n * Ejecuta la acción para abrir el formato de entrevista cuando es parte de videoentrevista.\n *\n * @param {number} etapa_id - ID de la etapa a ejecutar\n * @param {number} vacante_id - ID de la vacante asociada\n * @returns {void}\n * @author Andres Morales\n */\nfunction ejecutarAccionFormatoEntrevista(etapa_id, vacante_id) {\n    validarInformacionBasicaUsuario().then(function(informacion_completa) {\n        if (!informacion_completa) {\n            return;\n        }\n\n        var vacante = datos_ids.find(elemento_vacante => elemento_vacante.id === vacante_id && elemento_vacante.hasOwnProperty('etapas'));\n\n        if (!vacante) {\n            mostrarToast('danger', 'No se encontró la vacante');\n            return;\n        }\n\n        var etapa = vacante.etapas.find(elemento_etapa => elemento_etapa.id === etapa_id);\n\n        if (!etapa) {\n            mostrarToast('danger', 'No se encontró la etapa');\n            return;\n        }\n\n        if (!etapa.usuarios_vacantes || etapa.usuarios_vacantes.length === 0) {\n            mostrarToast('danger', 'No tienes asignada esta etapa');\n            return;\n        }\n\n        var etapa_vacante_usuario_id = etapa.usuarios_vacantes[0].id;\n        window.location.href = `/formatos-entrevistas/create?etapa_vacante_usuario_id=${etapa_vacante_usuario_id}`;\n    });\n}\n\n/**\n * Inicia la prueba verificando primero si hay demográficas pendientes.\n * Si hay demográficas, abre el modal; si no, redirige directamente a la prueba.\n *\n * @param {number} agenda_id - ID de la agenda\n * @param {number} prueba_id - ID de la prueba\n * @returns {void}\n * @author Andres Morales\n */\nfunction iniciarPruebaConDemograficas(agenda_id, prueba_id) {\n    $.ajax({\n        url: `/demograficas-ajax/${agenda_id}/${prueba_id}`,\n        type: 'GET',\n        success: function(respuesta) {\n            if (respuesta.data.redirigir_directo) {\n                // No hay demográficas o ya están completas\n                window.location.href = `/realizar-prueba/${agenda_id}`;\n            } else {\n                // Hay demográficas pendientes, abrir modal\n                abrirModalDemograficas(respuesta.data);\n            }\n        },\n        error: function(respuesta_xhr) {\n            mostrarToast('danger', 'Error al cargar las demográficas. Intenta nuevamente.');\n        }\n    });\n}\n\n/**\n * Abre el modal de demográficas y renderiza el formulario dinámicamente.\n *\n * @param {Object} datos - Objeto con datos de demográficas y agenda\n * @returns {void}\n * @author Andres Morales\n */\nfunction abrirModalDemograficas(datos) {\n    // Establecer datos en campos ocultos\n    $('#agenda_id_modal').val(datos.agenda_id);\n\n    // Actualizar título del modal con el nombre de la prueba\n    $('#titulo-modal-demograficas').text(`Datos demográficos - ${datos.agenda?.prueba?.nombre || 'Prueba'}`);\n\n    // Limpiar contenedor\n    $('#contenedor-demograficas-modal').empty();\n\n    // Renderizar cada demográfica\n    datos.demograficas.forEach(function(demografica) {\n        let html_demografica = '';\n        let elemento_id = \"\";\n        if (!demografica.otro) {\n            // Pregunta tipo select\n            elemento_id = `demografica_${demografica.id}`\n            html_demografica = `\n                <div class=\"col-12 mb-4\">\n                    ${crearSelect2({\n                        id: `${elemento_id}`,\n                        name: `${elemento_id}`,\n                        label: demografica.nombre,\n                        required: true,\n                        opciones: demografica.opciones.map(opcion => ({\n                            id: opcion.id,\n                            nombre: opcion.contenido\n                        })),\n                        buscador: true\n                    })}\n                </div>\n            `;\n        } else {\n            // Pregunta tipo texto\n            html_demografica = `\n                <div class=\"col-12\">\n                    ${crearInput({\n                        id: `demografica_opcion_${demografica.opciones[0].id}`,\n                        name: `demografica_opcion_${demografica.opciones[0].id}`,\n                        type: 'text',\n                        label: demografica.nombre,\n                        required: true,\n                        autocomplete: 'off',\n                        maxlength: 200\n                    })}\n                </div>\n            `;\n        }\n\n        $('#contenedor-demograficas-modal').append(html_demografica);\n        // Inicializar Select2 en los nuevos elementos\n    });\n    actualizarSelect2();\n\n\n    // Mostrar modal\n    $('#modal-demograficas').modal('show');\n}\n\n/**\n * Guarda las respuestas de las demográficas mediante AJAX.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction guardarDemograficasModal() {\n    var formulario = $('#formulario-demograficas-modal')[0];\n\n    if (!formulario.checkValidity()) {\n        formulario.reportValidity();\n        return;\n    }\n\n    var agenda_id = $('#agenda_id_modal').val();\n    let respuestas = [];\n\n    $('select[name^=\"demografica_\"]').each(function() {\n        var valor = $(this).val();\n        if (valor) {\n            respuestas.push({\n                demografica_opcion_id: valor\n            });\n        }\n    });\n\n    $('input[name^=\"demografica_opcion_\"]').each(function() {\n        var valor = $(this).val();\n        var opcion_id = $(this).attr('name').split('_')[2];\n        if (valor) {\n            respuestas.push({\n                demografica_opcion_id: opcion_id,\n                respuesta: valor\n            });\n        }\n    });\n\n    $('#btn-guardar-demograficas').prop('disabled', true).text('Guardando...');\n\n    $.ajax({\n        type: 'POST',\n        url: `/agendas-demograficas-opciones`,\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            agenda_id: agenda_id,\n            respuestas: JSON.stringify(respuestas)\n        },\n        success: function(respuesta) {\n            if (respuesta.data.redirigir) {\n                $('#modal-demograficas').modal({backdrop: 'static', keyboard: false});\n\n                $('button[onclick*=\"iniciarPruebaConDemograficas\"]').prop('disabled', true);\n                $('button[onclick*=\"ejecutarAccionEtapa\"]').prop('disabled', true);\n\n                $('#titulo-modal-demograficas').html('<i class=\"bi bi-hourglass-split me-2\"></i>Iniciando prueba');\n                $('#subtitulo-modal-demograficas').text('Espera un momento mientras preparamos tu evaluación');\n\n                $('#contenedor-demograficas-modal').html(`\n                    <div class=\"text-center py-5\">\n                        <div class=\"spinner-border text-primary mb-3\" role=\"status\" style=\"width: 3rem; height: 3rem;\">\n                            <span class=\"visually-hidden\">Cargando...</span>\n                        </div>\n                        <p class=\"text-body-1 text-gray-10 fw-medium mb-2\">Preparando tu evaluación...</p>\n                        <p class=\"text-body-3 text-gray-30\">Por favor no cierres esta ventana</p>\n                    </div>\n                `);\n\n                $('#modal-demograficas .modal-footer').hide();\n\n                mostrarToast('success', 'Datos guardados correctamente');\n\n                window.location.href = `/realizar-prueba/${agenda_id}`;\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar. Intenta nuevamente.');\n            $('#btn-guardar-demograficas').prop('disabled', false).text('Continuar');\n        }\n    });\n}\n\n/**\n * Cierra el modal de demográficas y limpia el formulario.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction cerrarModalDemograficas() {\n    $('button[onclick*=\"iniciarPruebaConDemograficas\"]').prop('disabled', false);\n    $('button[onclick*=\"ejecutarAccionEtapa\"]').prop('disabled', false);\n\n    $('#modal-demograficas').modal('hide');\n    $('#formulario-demograficas-modal')[0].reset();\n    $('#contenedor-demograficas-modal').empty();\n\n    $('#btn-guardar-demograficas').prop('disabled', false).text('Continuar');\n}\n\n/**\n * Abre automáticamente el acordeón de una vacante específica.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction abrirAcordeonVacante() {\n    let parametros_url = new URLSearchParams(window.location.search);\n    let vacante_id     = parametros_url.get('vacante_id');\n\n    if (vacante_id) {\n        let boton_vacante = $(`#accordionVacante${vacante_id} .accordion-button`);\n        if (boton_vacante.length > 0) {\n            boton_vacante.click();\n        }\n    }\n}\n","structuredPatch":[{"oldStart":533,"oldLines":8,"newStart":533,"newLines":9,"lines":["         }"," ","         if (nombre_normalizado === 'DOCUMENTOSPARACONTRATACION' && etapa.usuarios_vacantes && etapa.usuarios_vacantes.length > 0) {","-            let archivos = etapa.usuarios_vacantes[0].archivos;","-            let tiene_archivos = archivos && archivos.length > 0;","+            let archivos = etapa.usuarios_vacantes[0].archivos || [];","+            let archivos_aplicante = archivos.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));","+            let tiene_archivos = archivos_aplicante.length > 0;","             clase_etiqueta = tiene_archivos ? 'tag-filled-blue' : 'tag-filled-yellow';","             texto_estado = tiene_archivos ? 'Iniciada' : 'Pendiente';","         }"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"c00b15d8-4c87-4388-ad24-211edbb0e0b8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"assistant","timestamp":"2026-01-20T23:25:10.930Z","message":{"model":"claude-opus-4-5-20251101","id":"msg_01XpdTQ9XpQE7cGczib7X8Pd","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Ahora solo cuenta los archivos del aplicante (los que NO comienzan con `cliente_empresa_`) para determinar el estado de la etapa:\n\n| Archivos aplicante | Estado |\n|-------------------|--------|\n| 0 | Pendiente (amarillo) |\n| > 0 | Iniciada (azul) |"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":811,"cache_read_input_tokens":58023,"cache_creation":{"ephemeral_5m_input_tokens":811,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXKVaA35U4iGwqs2bEtFv","uuid":"41ffe40a-9eed-4bae-b018-7fc6819cf1bf"}
{"parentUuid":"41ffe40a-9eed-4bae-b018-7fc6819cf1bf","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 3 to 3 from c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Usuarios\\CompletarDatosService.php:\nnamespace App\\Http\\Services\\Usuarios;\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"hola mira tengo este eroro en la linea 3 {\n    \"message\": \"Namespace declaration statement has to be the very first statement or after any declare call in the script\",\n    \"exception\": \"Symfony\\\\Component\\\\ErrorHandler\\\\Error\\\\FatalError\",\n    \"file\": \"C:\\\\laragon\\\\www\\\\psicoalianza-2\\\\app\\\\Http\\\\Services\\\\Usuarios\\\\CompletarDatosService.php\",\n    \"line\": 3,\n    \"trace\": []\n}"}]},"uuid":"18ea9eee-1bac-4260-bc3d-4f3766d8d048","timestamp":"2026-01-21T14:15:46.458Z"}
{"parentUuid":"18ea9eee-1bac-4260-bc3d-4f3766d8d048","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01XAzjo4fTjLYT8Zq5mhRBEw","type":"message","role":"assistant","content":[{"type":"text","text":"El error indica que hay algo antes de la declaración `namespace`. Voy a revisar el archivo."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":58677,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":58677,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXLfVWTvuhGtxHMWqgSVb","type":"assistant","uuid":"bb494409-eb77-4e15-823f-92e9d058b35d","timestamp":"2026-01-21T14:15:50.825Z"}
{"parentUuid":"bb494409-eb77-4e15-823f-92e9d058b35d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01XAzjo4fTjLYT8Zq5mhRBEw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BgMpS7TePUjVJGwpXz4ghi","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Usuarios\\CompletarDatosService.php","offset":1,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":58677,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":58677,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXLfVWTvuhGtxHMWqgSVb","type":"assistant","uuid":"f8cb3098-6c8e-4e05-a0d8-bc8e1acf25b8","timestamp":"2026-01-21T14:15:56.525Z"}
{"parentUuid":"f8cb3098-6c8e-4e05-a0d8-bc8e1acf25b8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BgMpS7TePUjVJGwpXz4ghi","type":"tool_result","content":"     1→﻿<?php\n     2→\n     3→namespace App\\Http\\Services\\Usuarios;\n     4→\n     5→use Illuminate\\Http\\Request;\n     6→use App\\Models\\IA\\ServicioIA;\n     7→use App\\Models\\Usuarios\\User;\n     8→use App\\Models\\Vacantes\\EtapaVacante;\n     9→use App\\Http\\Services\\Vacantes\\VacanteService;\n    10→use App\\Http\\Repositories\\IA\\ServicioIARepository;\n    11→use App\\Http\\Repositories\\Usuarios\\UserRepository;\n    12→use App\\Http\\Services\\Empresas\\EmpresaPlanService;\n    13→use App\\Http\\Services\\Vacantes\\EtapaVacanteService;\n    14→use App\\Http\\Repositories\\Usuarios\\GeneroRepository;\n    15→use App\\Http\\Repositories\\Vacantes\\VacanteRepository;\n    16→use App\\Http\\Repositories\\Politicas\\PoliticaRepository;\n    17→use App\\Http\\Repositories\\Configuraciones\\RutaRepository;\n    18→use App\\Http\\Repositories\\Usuarios\\TipoDocumentoRepository;\n    19→use App\\Http\\Repositories\\Configuraciones\\DiscapacidadRepository;\n    20→use App\\Http\\Repositories\\OfertasLaborales\\TipoContratoRepository;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"863b6d2c-d0f9-49f7-91a3-8c3ee139ea59","timestamp":"2026-01-21T14:15:58.597Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Usuarios\\CompletarDatosService.php","content":"﻿<?php\n\nnamespace App\\Http\\Services\\Usuarios;\n\nuse Illuminate\\Http\\Request;\nuse App\\Models\\IA\\ServicioIA;\nuse App\\Models\\Usuarios\\User;\nuse App\\Models\\Vacantes\\EtapaVacante;\nuse App\\Http\\Services\\Vacantes\\VacanteService;\nuse App\\Http\\Repositories\\IA\\ServicioIARepository;\nuse App\\Http\\Repositories\\Usuarios\\UserRepository;\nuse App\\Http\\Services\\Empresas\\EmpresaPlanService;\nuse App\\Http\\Services\\Vacantes\\EtapaVacanteService;\nuse App\\Http\\Repositories\\Usuarios\\GeneroRepository;\nuse App\\Http\\Repositories\\Vacantes\\VacanteRepository;\nuse App\\Http\\Repositories\\Politicas\\PoliticaRepository;\nuse App\\Http\\Repositories\\Configuraciones\\RutaRepository;\nuse App\\Http\\Repositories\\Usuarios\\TipoDocumentoRepository;\nuse App\\Http\\Repositories\\Configuraciones\\DiscapacidadRepository;\nuse App\\Http\\Repositories\\OfertasLaborales\\TipoContratoRepository;","numLines":20,"startLine":1,"totalLines":134}},"sourceToolAssistantUUID":"f8cb3098-6c8e-4e05-a0d8-bc8e1acf25b8"}
{"parentUuid":"863b6d2c-d0f9-49f7-91a3-8c3ee139ea59","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_018yuMUkUJ6KZXu9enw6NPGt","type":"message","role":"assistant","content":[{"type":"text","text":"El problema es el carácter **BOM (Byte Order Mark)** al inicio del archivo. En la línea 1 se ve `﻿<?php` - ese carácter invisible `﻿` antes de `<?php` está causando el error."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":598,"cache_read_input_tokens":58677,"cache_creation":{"ephemeral_5m_input_tokens":598,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXLfWLo3KPYw5sq7vkSRT","type":"assistant","uuid":"3c8fb428-b399-45a4-af4a-6a8372f06af5","timestamp":"2026-01-21T14:16:02.768Z"}
{"parentUuid":"3c8fb428-b399-45a4-af4a-6a8372f06af5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_018yuMUkUJ6KZXu9enw6NPGt","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017hVcMrG45e2TrxWUi5CDyp","name":"Bash","input":{"command":"head -c 10 \"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Usuarios\\CompletarDatosService.php\" | xxd","description":"Check for BOM character at start of file"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":598,"cache_read_input_tokens":58677,"cache_creation":{"ephemeral_5m_input_tokens":598,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXLfWLo3KPYw5sq7vkSRT","type":"assistant","uuid":"68e4d916-61cb-4f8a-8447-e045eddd1152","timestamp":"2026-01-21T14:16:03.612Z"}
{"parentUuid":"68e4d916-61cb-4f8a-8447-e045eddd1152","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017hVcMrG45e2TrxWUi5CDyp","type":"tool_result","content":"00000000: efbb bf3c 3f70 6870 0a0a                 ...<?php..","is_error":false}]},"uuid":"3bf6371c-404c-4f9f-9f47-f947d8625a24","timestamp":"2026-01-21T14:16:13.544Z","toolUseResult":{"stdout":"00000000: efbb bf3c 3f70 6870 0a0a                 ...<?php..\r","stderr":"","interrupted":false,"isImage":false},"sourceToolAssistantUUID":"68e4d916-61cb-4f8a-8447-e045eddd1152"}
{"parentUuid":"3bf6371c-404c-4f9f-9f47-f947d8625a24","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VdwW82aVJKnzRYUCymxvmu","type":"message","role":"assistant","content":[{"type":"text","text":"Confirmado. Los bytes `ef bb bf` son el BOM UTF-8. Voy a eliminarlo:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":221,"cache_read_input_tokens":59275,"cache_creation":{"ephemeral_5m_input_tokens":221,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXLfXTTuovbbMQLYDkXm9","type":"assistant","uuid":"3b573899-c34e-4b8b-9e23-4292e462aa44","timestamp":"2026-01-21T14:16:16.920Z"}
{"parentUuid":"3b573899-c34e-4b8b-9e23-4292e462aa44","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VdwW82aVJKnzRYUCymxvmu","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Ad9XhEzpDTa4QL4GHqTKS8","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Usuarios\\CompletarDatosService.php","old_string":"﻿<?php\n\nnamespace App\\Http\\Services\\Usuarios;","new_string":"<?php\n\nnamespace App\\Http\\Services\\Usuarios;"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":221,"cache_read_input_tokens":59275,"cache_creation":{"ephemeral_5m_input_tokens":221,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXLfXTTuovbbMQLYDkXm9","type":"assistant","uuid":"920a5353-13d1-47e5-b649-7ac900af0d0f","timestamp":"2026-01-21T14:16:18.043Z"}
{"type":"file-history-snapshot","messageId":"920a5353-13d1-47e5-b649-7ac900af0d0f","snapshot":{"messageId":"18ea9eee-1bac-4260-bc3d-4f3766d8d048","trackedFileBackups":{"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-01-20T22:16:06.500Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v8","version":8,"backupTime":"2026-01-21T14:15:46.631Z"},"public\\js\\vacantes\\detalles\\detalle-etapas.js":{"backupFileName":"dccddb1063a31949@v3","version":3,"backupTime":"2026-01-21T14:15:46.745Z"},"public\\js\\mis-pruebas\\aplicante\\tareas-pendientes.js":{"backupFileName":"f91a5ce6abb13dfb@v2","version":2,"backupTime":"2026-01-21T14:15:46.759Z"},"app\\Http\\Services\\Usuarios\\CompletarDatosService.php":{"backupFileName":"3543b4a48206d219@v1","version":1,"backupTime":"2026-01-21T14:16:22.637Z"}},"timestamp":"2026-01-21T14:15:46.467Z"},"isSnapshotUpdate":true}
{"parentUuid":"920a5353-13d1-47e5-b649-7ac900af0d0f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Ad9XhEzpDTa4QL4GHqTKS8","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Usuarios\\CompletarDatosService.php has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     1→<?php\n     2→\n     3→namespace App\\Http\\Services\\Usuarios;\n     4→\n     5→use Illuminate\\Http\\Request;\n     6→use App\\Models\\IA\\ServicioIA;\n     7→use App\\Models\\Usuarios\\User;"}]},"uuid":"d0e037aa-4848-4a67-9ea9-2c53d2f5dc86","timestamp":"2026-01-21T14:16:22.677Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Usuarios\\CompletarDatosService.php","oldString":"﻿<?php\n\nnamespace App\\Http\\Services\\Usuarios;","newString":"<?php\n\nnamespace App\\Http\\Services\\Usuarios;","originalFile":"﻿<?php\n\nnamespace App\\Http\\Services\\Usuarios;\n\nuse Illuminate\\Http\\Request;\nuse App\\Models\\IA\\ServicioIA;\nuse App\\Models\\Usuarios\\User;\nuse App\\Models\\Vacantes\\EtapaVacante;\nuse App\\Http\\Services\\Vacantes\\VacanteService;\nuse App\\Http\\Repositories\\IA\\ServicioIARepository;\nuse App\\Http\\Repositories\\Usuarios\\UserRepository;\nuse App\\Http\\Services\\Empresas\\EmpresaPlanService;\nuse App\\Http\\Services\\Vacantes\\EtapaVacanteService;\nuse App\\Http\\Repositories\\Usuarios\\GeneroRepository;\nuse App\\Http\\Repositories\\Vacantes\\VacanteRepository;\nuse App\\Http\\Repositories\\Politicas\\PoliticaRepository;\nuse App\\Http\\Repositories\\Configuraciones\\RutaRepository;\nuse App\\Http\\Repositories\\Usuarios\\TipoDocumentoRepository;\nuse App\\Http\\Repositories\\Configuraciones\\DiscapacidadRepository;\nuse App\\Http\\Repositories\\OfertasLaborales\\TipoContratoRepository;\nuse App\\Http\\Repositories\\OfertasLaborales\\NivelEducativoRepository;\nuse App\\Http\\Repositories\\OfertasLaborales\\ModalidadTrabajoRepository;\nuse App\\Http\\Repositories\\Usuarios\\PerfilesLaborales\\JornadaRepository;\n\nclass CompletarDatosService\n{\n    /**\n     * Constructor.\n     *\n     * @param UserService $user_servicio Servicio de usuarios.\n     * @param UserRepository $user_repositorio Repositorio de usuarios.\n     * @param GeneroRepository $genero_repositorio Repositorio de generos.\n     * @param NivelEducativoRepository $nivel_educativo_repositorio Repositorio de niveles educativos.\n     * @param TipoDocumentoRepository $tipo_documento_repositorio Repositorio de tipos de documentos.\n     * @param PoliticaRepository $politica_repositorio Repositorio de politicas.\n     * @param RutaRepository $ruta_repositorio Repositorio de rutas.\n     * @param ModalidadTrabajoRepository $modalidad_trabajo_repositorio Repositorio de modalidades de trabajo.\n     * @param JornadaRepository $jornada_repositorio Repositorio de jornadas.\n     * @param TipoContratoRepository $tipo_contrato_repositorio Repositorio de tipos de contrato.\n     * @param DiscapacidadRepository $discapacidad_repositorio Repositorio de discapacidades.\n     * @param VacanteService $vacante_servicio Servicio de vacantes.\n     * @param EtapaVacanteService $etapa_vacante_servicio Servicio de etapas de vacantes.\n     * @param EmpresaPlanService $empresa_plan_servicio Servicio de planes de empresa.\n     * @param VacanteRepository $vacante_repositorio Repositorio de vacantes.\n     * @param ServicioIARepository $servicio_ia_repositorio Repositorio de servicios de IA.\n     * @return void\n     * @author Sergio Vargas\n     */\n    public function __construct(\n        protected UserService $user_servicio,\n        protected UserRepository $user_repositorio,\n        protected GeneroRepository $genero_repositorio,\n        protected NivelEducativoRepository $nivel_educativo_repositorio,\n        protected TipoDocumentoRepository $tipo_documento_repositorio,\n        protected PoliticaRepository $politica_repositorio,\n        protected RutaRepository $ruta_repositorio,\n        protected ModalidadTrabajoRepository $modalidad_trabajo_repositorio,\n        protected JornadaRepository $jornada_repositorio,\n        protected TipoContratoRepository $tipo_contrato_repositorio,\n        protected DiscapacidadRepository $discapacidad_repositorio,\n        protected VacanteService $vacante_servicio,\n        protected EtapaVacanteService $etapa_vacante_servicio,\n        protected EmpresaPlanService $empresa_plan_servicio,\n        protected VacanteRepository $vacante_repositorio,\n        protected ServicioIARepository $servicio_ia_repositorio\n    ) {}\n\n    /**\n     * Preparar la informacion de la pagina completar datos.\n     *\n     * @param Request $request Contenido de la peticion.\n     * @param int $id ID del usuario.\n     * @return array\n     * @author Sergio Vargas\n     */\n    public function prepararPaginaCompletarDatos(Request $request, int $id): array {\n        if ($this->user_servicio->verificarDatosCompletados($id)) {\n            return [\n                'debe_redirigir' => true,\n                'datos'          => []\n            ];\n        }\n\n        $creditos_disponibles       = false;\n        $resultado_configuracion_ia = false;\n        $etapa_revision_hv_activa   = false;\n        $etapa_vacante_usuario      = null;\n\n        if ($request->filled('vacante_id') && $request->vacante_id !== 'null' && $request->vacante_id !== null) {\n            $resultado_configuracion_ia = $this->vacante_servicio->validarRevisionHojaVidaIa($request->vacante_id);\n            $etapa_revision_hv_activa   = $this->vacante_servicio->validarEtapaActiva($request->vacante_id, EtapaVacante::REVISION_HV_NOMBRE);\n            $etapa_vacante_usuario      = $this->etapa_vacante_servicio->obtenerEtapaAplicanteUsuario($id, $request->vacante_id, EtapaVacante::REVISION_HV_NOMBRE);\n\n            $vacante = $this->vacante_repositorio->getUno($request->vacante_id);\n\n            if (isset($etapa_revision_hv_activa) && $etapa_revision_hv_activa && isset($vacante)) {\n                $creditos             = $this->empresa_plan_servicio->creditosDisponiblesEmpresa($vacante->empresa_id, new Request());\n                $servicio_ia          = $this->servicio_ia_repositorio->getUno(ServicioIA::OBTENER_HV_ID);\n                $creditos_disponibles = $this->empresa_plan_servicio->tieneCreditosSuficientes($creditos['empresa_plan_id'], $servicio_ia->consume_creditos);\n            }\n        }\n\n        return [\n            'debe_redirigir' => false,\n            'datos'          => [\n                'usuario'            => $this->user_repositorio->getUno($id),\n                'generos'            => $this->genero_repositorio->getTodo(new Request()),\n                'niveles_educativos' => $this->nivel_educativo_repositorio->getTodo(new Request()),\n                'tipos_documentos'   => $this->tipo_documento_repositorio->getTodo(new Request(['modelo' => User::class])),\n                'politica'           => $this->politica_repositorio->getUnoAvanzado(new Request([\n                    'nombre' => 'términos y condiciones',\n                    'activo' => true\n                ])),\n                'terminos_condiciones' => $this->politica_repositorio->getUnoAvanzado(new Request([\n                    'nombre' => \"t\\u{00E9}rminos y condiciones\",\n                    'activo' => true\n                ])),\n                'rutas_menu'               => $this->ruta_repositorio->getTodo(new Request(['rutas_principales' => true])),\n                'modalidades_trabajos'     => $this->modalidad_trabajo_repositorio->getTodo(new Request()),\n                'jornadas'                 => $this->jornada_repositorio->getTodo(new Request(['solo_globales' => true])),\n                'tipos_contratos'          => $this->tipo_contrato_repositorio->getTodo(new Request()),\n                'discapacidades'           => $this->discapacidad_repositorio->getTodo(new Request()),\n                'revision_hv_ia'           => $resultado_configuracion_ia ?? false,\n                'revision_hv'              => $etapa_revision_hv_activa ?? false,\n                'etapa_vacante_usuario_id' => $etapa_vacante_usuario->id ?? null,\n                'creditos_disponibles'     => $creditos_disponibles,\n            ],\n        ];\n    }\n}\n\n\n\n","structuredPatch":[{"oldStart":1,"oldLines":4,"newStart":1,"newLines":4,"lines":["-﻿<?php","+<?php"," "," namespace App\\Http\\Services\\Usuarios;"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"920a5353-13d1-47e5-b649-7ac900af0d0f"}
{"parentUuid":"d0e037aa-4848-4a67-9ea9-2c53d2f5dc86","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"d1230e1c-a1aa-48d4-866c-00dfadb29f2d","version":"2.1.11","gitBranch":"D26-260","slug":"toasty-leaping-whale","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Qpi2rxgPRUALSgmigdycvA","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. El error era un **BOM (Byte Order Mark)** - un carácter invisible que algunos editores agregan al inicio de archivos UTF-8. Ya fue eliminado y el archivo debería funcionar correctamente."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":334,"cache_read_input_tokens":59496,"cache_creation":{"ephemeral_5m_input_tokens":334,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXLfYEs9zGWh8Cf4tg45z","type":"assistant","uuid":"3a20abd8-48ad-4ae7-a076-aa3fd0e65b25","timestamp":"2026-01-21T14:16:27.896Z"}
