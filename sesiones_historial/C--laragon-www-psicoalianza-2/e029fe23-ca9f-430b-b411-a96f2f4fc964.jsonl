{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-28T13:12:42.516Z","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964"}
{"type":"file-history-snapshot","messageId":"4459e979-6a15-4cd5-b0d3-10ac6698cc83","snapshot":{"messageId":"4459e979-6a15-4cd5-b0d3-10ac6698cc83","trackedFileBackups":{},"timestamp":"2026-01-28T13:12:42.602Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 729 to 729 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-2.js:\nfunction automatizacionEtapas(elemento) {\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"mira tengo esta funcion function automatizacionEtapas(elemento) { pero quiero que si entra ne el if de bysacar estapa el togle quede descrhekeado anque sele de click y este es el togle"}]},"uuid":"4459e979-6a15-4cd5-b0d3-10ac6698cc83","timestamp":"2026-01-28T13:12:42.596Z","permissionMode":"default"}
{"parentUuid":"4459e979-6a15-4cd5-b0d3-10ac6698cc83","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018o4oJ8rPvibJTNQQVtNcC9","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que en la función `automatizacionEtapas`, cuando entre en el if de \"bysacar estapa\" (probablemente \"buscar etapa\"), el toggle quede desmarcado aunque se le dé click.\n\nPrimero necesito leer el archivo para ver la función completa y entender qué es lo que está pasando.","signature":"EssDCkYICxgCKkD5JQP7hDURiWHRk/l2kOtdvoG9s1Jbh/SttsAtLSs+Iee+Diu/LashLURJnffHfLtammrtYpgIUFsqDe35HY0VEgx3nNYvzztZjkqJJYIaDIAqyfYU3Jsa2F8aGyIwHNGdUAUj00ulwz0VKbh1fIlbkAiJxA3ZtRXmI3pvGeMaHo4mlI82JRv4R5dVk/LYKrIC1WvD8488VF/cOvtusqzuKxDGwYgsIjUPPZTDo30IOgPrymNYn8y47v/yRsvmMvQ6tROmJtBkwzX8NEv2UoaFfLjaNbytB1o22VBm7BCyS1Qi8nCL3g3omUWi06Rb9wuO2BNu64ehO9IN1rKIWzsvT3eWliOepI75WcaYzlX+xcEFTFsi7RhgKvuFEB1yKvR2GjM0hySf9v9zQHiYG7GC0e7fUNJWaDqMVzj4N7s8V6b9E2EnJx8DpLj2O7uUTOv8NUEiG5NOIuXAl4itCBKdGstuDbkPn8UpdwQLOngSNlUx8yi/AXgeKg30qZR/RLB0oZgu9PUGDiFvG0+s6UDwqPe4v5hbRtX5s3frXl794WZMtaHcsF1DHCjyhsmjTYafUrHlzgasDSzVJ2KwRhIpveVtGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":25106,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":25106},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXZqLwMMkZvPgkhNAdnqy","type":"assistant","uuid":"f532ca45-1340-4648-9a3d-99ffcff41360","timestamp":"2026-01-28T13:12:46.625Z"}
{"parentUuid":"f532ca45-1340-4648-9a3d-99ffcff41360","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018o4oJ8rPvibJTNQQVtNcC9","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo que necesitas que el toggle se quede desmarcado cuando entre en cierta condición del if. Déjame leer el archivo para ver la función completa y el contexto del toggle."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":25106,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":25106},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXZqLwMMkZvPgkhNAdnqy","type":"assistant","uuid":"e5056115-a13e-4977-8bbe-2e9909662fe7","timestamp":"2026-01-28T13:12:47.635Z"}
{"parentUuid":"e5056115-a13e-4977-8bbe-2e9909662fe7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018o4oJ8rPvibJTNQQVtNcC9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CP7AUpG44zPmTF2i4UmjYa","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-2.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":25106,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":25106},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXZqLwMMkZvPgkhNAdnqy","type":"assistant","uuid":"9c0013da-9212-4ce7-b7d1-06d0181cfb61","timestamp":"2026-01-28T13:12:48.195Z"}
{"parentUuid":"9c0013da-9212-4ce7-b7d1-06d0181cfb61","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CP7AUpG44zPmTF2i4UmjYa","type":"tool_result","content":"     1→/**\n     2→ * Archivo para manejar la lógica del Paso 2: Etapas de la vacante\n     3→ * @author Andres Morales\n     4→ * @author José Manuel Jiménez\n     5→ */\n     6→const CONFIGURACION_ETAPAS = {\n     7→    'Revisión HV': {\n     8→        titulo_modal_notificacion: 'Inicio proceso de selección',\n     9→        titulo_notificacion: 'Notificación inicio proceso de selección',\n    10→        titulo_etapa: 'Revisión hoja de vida',\n    11→        plantilla_correo_id: 12\n    12→    },\n    13→    'Preguntas prefiltro': {\n    14→        titulo_modal_notificacion: 'Preguntas pre-filtro',\n    15→        titulo_notificacion: 'Notificacion envío de preguntas pre-filtro',\n    16→        titulo_etapa: 'Preguntas prefiltro',\n    17→        plantilla_correo_id: 13\n    18→    },\n    19→    'Pruebas psicométricas': {\n    20→        titulo_modal_notificacion: 'Pruebas psicométricas',\n    21→        titulo_notificacion: 'Notificación envío de pruebas psicométricas',\n    22→        titulo_etapa: 'Pruebas psicométricas',\n    23→        plantilla_correo_id: 15\n    24→    },\n    25→    'Prueba técnica': {\n    26→        titulo_modal_notificacion: 'Prueba técnica',\n    27→        titulo_notificacion: 'Notificación envío de prueba técnica',\n    28→        titulo_etapa: 'Prueba técnica',\n    29→        plantilla_correo_id: 18\n    30→    },\n    31→    'Video entrevista': {\n    32→        titulo_modal_notificacion: 'Video entrevista',\n    33→        titulo_notificacion: 'Notificación envío de video entrevista',\n    34→        titulo_etapa: 'Solicitud video entrevista',\n    35→        plantilla_correo_id: 21\n    36→    },\n    37→    'Entrevista': {\n    38→        titulo_modal_notificacion: 'Entrevista',\n    39→        titulo_notificacion: 'Notificacíon de entrevista',\n    40→        titulo_etapa: 'Solicitud de entrevista',\n    41→        plantilla_correo_id: 26\n    42→    },\n    43→    'Documentos para contratación': {\n    44→        titulo_modal_notificacion: 'Documentos para contratación',\n    45→        titulo_notificacion: 'Notificación envío de solicitud de documentos',\n    46→        titulo_etapa: 'Solicitar documentos',\n    47→        plantilla_correo_id: 23\n    48→    },\n    49→    'Contratados': {\n    50→        titulo_modal_notificacion: 'Contratados',\n    51→        titulo_notificacion: 'Notificación de resultado del proceso',\n    52→        plantilla_correo_id: 27\n    53→    },\n    54→    'Descartados': {\n    55→        titulo_modal_notificacion: 'Descartados',\n    56→        titulo_notificacion: 'Notificación de resultado del proceso',\n    57→        plantilla_correo_id: 28\n    58→    }\n    59→};\n    60→\n    61→let etapa_movimiento_vacante_id_seleccionado = null;\n    62→let etapa_vacante_id_seleccionado = null;\n    63→let modal_movimiento_id_seleccionado = null;\n    64→let contador_preguntas = 0; // Contador general (mantener por compatibilidad)\n    65→let contador_preguntas_prefiltro = 0; // Contador específico para modal preguntas prefiltro\n    66→let contador_preguntas_video_entrevista = 0; // Contador específico para modal video entrevista\n    67→let contador_respuestas = 0;\n    68→let archivos_preguntas = [];\n    69→let toggle_etapa_activado = null;\n    70→let etapa_activada_desde_toggle = false;\n    71→let archivos_cargados = [];\n    72→\n    73→/**\n    74→ * Obtiene la configuración de títulos para una etapa\n    75→ *\n    76→ * @param {string} nombre_etapa Nombre de la etapa\n    77→ * @param {string} tipo_titulo Tipo de título a obtener: 'titulo_modal_notificacion', 'titulo_notificacion' o 'titulo_etapa'\n    78→ * @returns {string|null} Título configurado o null si no existe\n    79→ * @author Andres Morales\n    80→ */\n    81→function obtenerTituloEtapa(nombre_etapa, tipo_titulo = 'titulo_modal_notificacion') {\n    82→    var configuracion = CONFIGURACION_ETAPAS[nombre_etapa];\n    83→    return configuracion && configuracion[tipo_titulo] ? configuracion[tipo_titulo] : null;\n    84→}\n    85→\n    86→/**\n    87→ * Verifica si existe un título configurado para una etapa\n    88→ *\n    89→ * @param {string} nombre_etapa Nombre de la etapa\n    90→ * @param {string} tipo_titulo Tipo de título a verificar\n    91→ * @returns {boolean} True si existe el título, false si no\n    92→ * @author Andres Morales\n    93→ */\n    94→function existeTituloEtapa(nombre_etapa, tipo_titulo) {\n    95→    return obtenerTituloEtapa(nombre_etapa, tipo_titulo) !== null;\n    96→}\n    97→\n    98→/**\n    99→ * Obtiene el ID de plantilla de correo para una etapa\n   100→ *\n   101→ * @param {string} nombre_etapa Nombre de la etapa\n   102→ * @returns {number|null} ID de la plantilla o null si no existe\n   103→ * @author Andres Morales\n   104→ */\n   105→function obtenerPlantillaCorreoId(nombre_etapa) {\n   106→    var configuracion = CONFIGURACION_ETAPAS[nombre_etapa];\n   107→    return configuracion && configuracion.plantilla_correo_id ? configuracion.plantilla_correo_id : null;\n   108→}\n   109→\n   110→/**\n   111→ * Consulta la plantilla de correo de una etapa específica\n   112→ *\n   113→ * @param {string} nombre_etapa Nombre de la etapa\n   114→ * @returns {Promise} Promesa con los datos de la plantilla\n   115→ * @author Andres Morales\n   116→ */\n   117→function consultarPlantillaEtapa(nombre_etapa) {\n   118→    var plantilla_correo_id = obtenerPlantillaCorreoId(nombre_etapa);\n   119→\n   120→    if (!plantilla_correo_id) {\n   121→        console.error('No se encontró ID de plantilla para la etapa:', nombre_etapa);\n   122→        return Promise.reject('No se encontró ID de plantilla');\n   123→    }\n   124→\n   125→    return $.ajax({\n   126→        url: '/plantilla-correo',\n   127→        method: 'GET',\n   128→        data: {\n   129→            plantilla_correo_id: plantilla_correo_id,\n   130→            empresa_id: empresa?.id\n   131→        },\n   132→        dataType: 'json'\n   133→    });\n   134→}\n   135→\n   136→/**\n   137→ * Función para consultar las etapas de una vacante\n   138→ *\n   139→ * @param {number} vacante_id ID de la vacante\n   140→ * @author José Manuel Jiménez\n   141→ * @author Andres Morales\n   142→ */\n   143→function consultarEtapasVacante(vacante_id) {\n   144→    $.ajax({\n   145→        url: `/etapas-vacantes`,\n   146→        data: { vacante_id: vacante_id },\n   147→        method: 'GET',\n   148→        dataType: 'json',\n   149→        success: function(respuesta) {\n   150→            etapas_vacante = respuesta.data || [];\n   151→            mostrarEtapasVacante();\n   152→            calcularDiasDuracionProceso(vacante_id);\n   153→        }\n   154→    });\n   155→}\n   156→\n   157→/**\n   158→ * Función para calcular y mostrar los días de duración del proceso\n   159→ *\n   160→ * @param {number} vacante_id ID de la vacante\n   161→ * @returns {void}\n   162→ * @author Andres Morales\n   163→ */\n   164→function calcularDiasDuracionProceso(vacante_id) {\n   165→    $.ajax({\n   166→        url: `/vacantes-calcular-dias-duracion-proceso/${vacante_id}`,\n   167→        method: 'GET',\n   168→        dataType: 'json',\n   169→        success: function(respuesta) {\n   170→            var dias = respuesta.duracion_dias || 0;\n   171→            $('#contador-dias-proceso').html(dias);\n   172→        },\n   173→        error: function() {\n   174→            $('#contador-dias-proceso').html('0');\n   175→        }\n   176→    });\n   177→}\n   178→\n   179→/**\n   180→ * Función para mostrar las etapas de una vacante en un acordeon.\n   181→ *\n   182→ * @param {Object} etapas Array con las etapas de la vacante.\n   183→ * @author José Manuel Jiménez\n   184→ * @author Andres Morales\n   185→ */\n   186→function mostrarEtapasVacante() {\n   187→    let etapas = etapas_vacante;\n   188→    $('#contenedor-vacantes-etapas').empty().append(crearAcordeon({\n   189→        id: 'acordeon',\n   190→        acordeon: etapas.map((etapa, index) => ({\n   191→            id: `etapa-${index}`,\n   192→            titulo: `\n   193→                <div class=\"col\">\n   194→                    <div class=\"row\">\n   195→                        <div class=\"col ps-1 text-gray-10 text-body-1\">${etapa.nombre}</div>\n   196→                        <div class=\"col-auto pe-7\">\n   197→                            ${etapa.editable == 1 ? crearToggle({\n   198→                                id: `activar_etapa_${index}`,\n   199→                                name: `activar_etapa_${index}`,\n   200→                                class: 'checkbox-etapa-vacante',\n   201→                                value: etapa.id,\n   202→                                checked: etapa.activa == 1 ? true : false,\n   203→                                onchange: `activarDesactivarEtapa(this)`,\n   204→                            }) : ''}\n   205→                        </div>\n   206→                    </div>\n   207→                </div>\n   208→            `,\n   209→            contenido: `\n   210→                <div class=\"row\">\n   211→                    ${etapa.etapas_movimientos.map(etapa_movimiento => `\n   212→                        <div class=\"col-12 d-flex justify-content-between align-items-center\">\n   213→                            <div class=\"text-body-2 text-gray-30\">\n   214→                                ${etapa_movimiento.movimiento.nombre}\n   215→                            </div>\n   216→                            <div>\n   217→                                ${crearBoton({\n   218→                                    clases: 'btn-text-primary btn-circle',\n   219→                                    texto: '<i class=\"bi bi-gear\"></i>',\n   220→                                    onclick: `${etapa_movimiento.movimiento.es_notificacion == 1 ?\n   221→                                        `abrirModalNotificacionEtapa(${etapa.id})` : `abrirModalMovimientoEtapa(${etapa_movimiento.movimiento.id}, ${etapa_movimiento.id}, ${etapa_movimiento.etapa_vacante_id})`\n   222→                                    }`\n   223→                                })}\n   224→                            </div>\n   225→                        </div>\n   226→                    `).join('')}\n   227→                </div>\n   228→            `,\n   229→            disabled: etapa.activa == 0 ? true : false,\n   230→            ordenar: etapa.fija == 0 ? true : false,\n   231→            adicional: `data-orden=\"${etapa.orden}\" data-etapa_vacante_id=\"${etapa.id}\" data-fija=\"${etapa.fija}\"`,\n   232→        }))\n   233→    }));\n   234→    $(\"#acordeon\").sortable({\n   235→        items: \".accordion-item\",\n   236→        handle: \".drag-handle\",\n   237→        cursor: \"grabbing\",\n   238→        placeholder: \"ui-sortable-placeholder\",\n   239→        tolerance: \"pointer\",\n   240→        update: function(evento, elemento) {\n   241→            let elemento_actual = elemento.item;\n   242→            let orden_actual = $(elemento_actual).data('orden');\n   243→            let elemento_anterior = elemento_actual.prev();\n   244→            let orden_anterior = $(elemento_anterior).data('orden');\n   245→            let es_fijo_anterior = $(elemento_anterior).data('fija');\n   246→            if (es_fijo_anterior == 1) {\n   247→                return false;\n   248→            }\n   249→            if (orden_anterior == undefined) {\n   250→                orden_anterior = '0';\n   251→            }\n   252→            if ((parseInt(orden_actual) - 1) != orden_anterior) {\n   253→                if (parseInt(orden_actual) > parseInt(orden_anterior)) {\n   254→                    orden_anterior = parseInt(orden_anterior) + 1;\n   255→                }\n   256→                let etapa_vacante_id = $(elemento_actual).data('etapa_vacante_id');\n   257→                $.ajax({\n   258→                    url : `/etapas-vacantes-cambiar-orden`,\n   259→                    type: 'POST',\n   260→                    data: {\n   261→                        _token : $('meta[name=\"csrf-token\"]').attr('content'),\n   262→                        _method: 'PUT',\n   263→                        id: etapa_vacante_id,\n   264→                        orden: orden_anterior\n   265→                    },\n   266→                    success: function (respuesta) {\n   267→                        mostrarToast('success', respuesta.message);\n   268→                        $(elemento_actual).data('orden', orden_anterior);\n   269→                        $(elemento_anterior).data('orden', orden_actual);\n   270→                    },\n   271→                    error: function (error) {\n   272→                        mostrarToast('danger', 'Ocurrió un error al organizar');\n   273→                    }\n   274→                });\n   275→            }\n   276→        }\n   277→    });\n   278→}\n   279→\n   280→/**\n   281→ * Función para activar o desactivar un acordeon de una etapa de la vacante.\n   282→ *\n   283→ * @param {HTMLInputElement} checkbox Checkbox que activa o desactiva la etapa\n   284→ * @author José Manuel Jiménez\n   285→ * @author Andres Morales\n   286→ */\n   287→function activarDesactivarEtapa(checkbox) {\n   288→    setTimeout(() => {\n   289→        if (checkbox.checked) {\n   290→            $(checkbox).closest('.accordion-item').find('.accordion-button').removeClass('collapsed').attr('aria-disabled', 'false').attr('disabled', false);\n   291→            $(checkbox).closest('.accordion-item').find('.accordion-collapse').addClass('show').attr('aria-expanded', 'true');\n   292→\n   293→            toggle_etapa_activado = checkbox;\n   294→            etapa_activada_desde_toggle = true;\n   295→\n   296→            var etapa_vacante_id = $(checkbox).closest('.accordion-item').data('etapa_vacante_id');\n   297→\n   298→            var etapa_encontrada = etapas_vacante.find(function(etapa) {\n   299→                return etapa.id === etapa_vacante_id;\n   300→            });\n   301→\n   302→            if (etapa_encontrada && etapa_encontrada.etapas_movimientos) {\n   303→                var primer_movimiento_config = etapa_encontrada.etapas_movimientos.find(function(etapa_movimiento) {\n   304→                    return etapa_movimiento.movimiento && etapa_movimiento.movimiento.es_notificacion !== 1;\n   305→                });\n   306→\n   307→                if (primer_movimiento_config && primer_movimiento_config.movimiento) {\n   308→                    abrirModalMovimientoEtapa(\n   309→                        primer_movimiento_config.movimiento.id,\n   310→                        primer_movimiento_config.id,\n   311→                        primer_movimiento_config.etapa_vacante_id\n   312→                    );\n   313→                }\n   314→            }\n   315→        } else {\n   316→            $(checkbox).closest('.accordion-item').find('.accordion-button').addClass('collapsed').attr('aria-disabled', 'true').attr('disabled', true);\n   317→            $(checkbox).closest('.accordion-item').find('.accordion-collapse').removeClass('show').attr('aria-expanded', 'false');\n   318→        }\n   319→        $.ajax({\n   320→            url: `/etapas-vacantes/${checkbox.value}`,\n   321→            data: {\n   322→                activa: checkbox.checked ? 1 : 0,\n   323→                _token: $('meta[name=\"csrf-token\"]').attr('content')\n   324→            },\n   325→            method: 'PUT',\n   326→            dataType: 'json',\n   327→            success: function(respuesta) {\n   328→                var vacante_id = $('#id').val();\n   329→                if (vacante_id) {\n   330→                    calcularDiasDuracionProceso(vacante_id);\n   331→                }\n   332→            }\n   333→        });\n   334→    }, 500);\n   335→}\n   336→\n   337→/**\n   338→ * Función para filtrar las etapas de la vacante en el acordeon.\n   339→ *\n   340→ * @param {string} mostrar_etapas Valor del filtro: '1' para mostrar solo las etapas activas, '0' para mostrar solo las etapas inactivas, cualquier otro valor para mostrar todas las etapas.\n   341→ * @author José Manuel Jiménez\n   342→ */\n   343→function filtrarEtapasVacante(mostrar_etapas) {\n   344→    $('#acordeon .accordion-item').removeClass('d-none');\n   345→    if (mostrar_etapas == '1') {\n   346→        $('#acordeon .accordion-item').each(function() {\n   347→            if ($(this).find('.checkbox-etapa-vacante').length > 0 && !$(this).find('.checkbox-etapa-vacante').is(':checked')) {\n   348→                $(this).addClass('d-none');\n   349→            }\n   350→        });\n   351→    } else if (mostrar_etapas == '0') {\n   352→        $('#acordeon .accordion-item').each(function() {\n   353→            if ($(this).find('.checkbox-etapa-vacante').length == 0 || $(this).find('.checkbox-etapa-vacante').is(':checked')) {\n   354→                $(this).addClass('d-none');\n   355→            }\n   356→        });\n   357→    }\n   358→}\n   359→\n   360→/**\n   361→ * Función para abrir la modal de edición de plantilla de etapa\n   362→ *\n   363→ * @param {number} etapa_id ID de la etapa\n   364→ * @returns {void}\n   365→ * @author Andres Morales\n   366→ * @author Andres Gonzalez\n   367→ */\n   368→function abrirModalNotificacionEtapa(etapa_id) {\n   369→    $('#modal-editar-plantilla-etapa #etapa_id').val(etapa_id);\n   370→\n   371→    let etapa = etapas_vacante.find(e => e.id === etapa_id);\n   372→\n   373→    if (etapa) {\n   374→        $('#titulo-plantilla-modal').text(etapa.nombre);\n   375→\n   376→        if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n   377→            $('#contenedor_check_enviar_al_finalizar').html(`\n   378→                ${crearCheckbox({\n   379→                    id: 'enviar_finalizar',\n   380→                    class: 'input-dinamico',\n   381→                    label: 'Enviar comunicación únicamente cuando finalice el proceso',\n   382→                })}\n   383→            `);\n   384→        } else {\n   385→            $('#contenedor_check_enviar_al_finalizar').html(`\n   386→                ${crearCheckbox({\n   387→                    id: 'enviar_finalizar',\n   388→                    class: 'input-dinamico',\n   389→                    input_container_class: 'd-none',\n   390→                    checked: false,\n   391→                    label: 'Enviar comunicación únicamente cuando finalice el proceso',\n   392→                })}\n   393→            `);\n   394→        }\n   395→\n   396→        consultarPlantillaEtapa(etapa.nombre).then(function(respuesta) {\n   397→            var plantilla = respuesta.data;\n   398→\n   399→            $('#modal-editar-plantilla-etapa #id').val(plantilla.id);\n   400→            $('#modal-editar-plantilla-etapa #plantilla_correo_id').val(plantilla.plantilla_correo_id || plantilla.id);\n   401→            $('#modal-editar-plantilla-etapa #empresa_id').val(plantilla.empresa_id || (empresa && empresa.id) || '');\n   402→            $('#modal-editar-plantilla-etapa #grupo_id').val(plantilla.grupo_id);\n   403→            $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val(plantilla.titulo);\n   404→\n   405→            if (plantilla.con_logo_empresa == 1) {\n   406→                $('#modal-editar-plantilla-etapa #con_logo').prop('checked', true);\n   407→            } else {\n   408→                $('#modal-editar-plantilla-etapa #con_logo').prop('checked', false);\n   409→            }\n   410→\n   411→            if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n   412→                if (plantilla.notificar_fin_proceso == 1) {\n   413→                    $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', true);\n   414→                } else {\n   415→                    $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', false);\n   416→                }\n   417→            }\n   418→\n   419→            $('#contenedor_editor_texto').html(`\n   420→                ${crearEditorTexto({\n   421→                    adicional: `data-botonadicional=\"botonAdicionalCkeditorEtapa\"`,\n   422→                    id: 'descripcion_mensaje_etapa',\n   423→                    name: 'descripcion_mensaje_etapa',\n   424→                    class: 'classic-editor-opciones',\n   425→                    input_container_class: 'mb-4',\n   426→                    maxlength: 16350,\n   427→                    required: true\n   428→                })}\n   429→            `);\n   430→\n   431→            inicializarClassicEditor();\n   432→\n   433→            setTimeout(function() {\n   434→                if ($('#descripcion_mensaje_etapa').data('editor')) {\n   435→                    $('#descripcion_mensaje_etapa').data('editor').setData(plantilla.contenido || '');\n   436→                }\n   437→            }, 500);\n   438→        }).catch(function(error) {\n   439→            if (typeof empresa !== 'undefined' && empresa && empresa.id) {\n   440→                $('#modal-editar-plantilla-etapa #empresa_id').val(empresa.id);\n   441→            }\n   442→\n   443→            $('#contenedor_editor_texto').html(`\n   444→                ${crearEditorTexto({\n   445→                    adicional: `data-botonadicional=\"botonAdicionalCkeditorEtapa\"`,\n   446→                    id: 'descripcion_mensaje_etapa',\n   447→                    name: 'descripcion_mensaje_etapa',\n   448→                    class: 'classic-editor-opciones',\n   449→                    input_container_class: 'mb-4',\n   450→                    maxlength: 16350,\n   451→                    required: true\n   452→                })}\n   453→            `);\n   454→\n   455→            inicializarClassicEditor();\n   456→        });\n   457→    }\n   458→\n   459→    $('#modal-editar-plantilla-etapa').modal('show');\n   460→}\n   461→\n   462→/**\n   463→ * Crear boton adicional para ckeditor con variables de etapa\n   464→ *\n   465→ * @param {string} id ID del editor\n   466→ * @returns {html} botón adicional para ckeditor\n   467→ * @author Andres Morales\n   468→ */\n   469→function botonAdicionalCkeditorEtapa(id) {\n   470→    var variables_etapa = [\n   471→        { llave: 'nombre_informador', valor: 'Nombre de usuario (Yo)' },\n   472→        { llave: 'nombre_empresa', valor: 'Nombre de la empresa' },\n   473→        { llave: 'nombre_vacante', valor: 'Nombre de la vacante' },\n   474→        { llave: 'nombre_candidato', valor: 'Nombre del candidato' }\n   475→    ];\n   476→\n   477→    var opciones_variables = variables_etapa\n   478→        .map(variable => `<button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableEtapa('${id}', '__${variable.llave}__')\">${variable.valor}</button>`)\n   479→        .join('');\n   480→\n   481→    return `\n   482→        <div class=\"border-start border-black border-2 px-2 my-0 dropdown\">\n   483→            ${crearBoton({\n   484→                clases: 'dropdown-toggle text-body-3 btn-dropdown-ckeditor',\n   485→                texto: 'Agregar variable<i class=\"bi bi-chevron-down text-body-3 ms-2\"></i>',\n   486→                data: [{texto: 'bs-toggle', value: 'dropdown'},{texto: 'bs-auto-close', value: 'outside'}]\n   487→            })}\n   488→            <div class=\"dropdown-menu bg-white\">${opciones_variables}</div>\n   489→        </div>\n   490→    `;\n   491→}\n   492→\n   493→/**\n   494→ * Agrega la variable en el ckeditor de etapa\n   495→ *\n   496→ * @param {string} id ID del editor\n   497→ * @param {string} variable Variable a agregar\n   498→ * @returns {void}\n   499→ * @author Andres Morales\n   500→ * @author Andres Gonzalez\n   501→ */\n   502→function agregarVariableEtapa(id, variable) {\n   503→    let editor = $(`#${id}`).data('editor');\n   504→    let fragmento_vista = editor.data.processor.toView(variable);\n   505→    let fragmento_modelo = editor.data.toModel(fragmento_vista);\n   506→    editor.model.insertContent(fragmento_modelo);\n   507→}\n   508→\n   509→/**\n   510→ * Inicializar configuración del formulario de plantilla de etapa\n   511→ *\n   512→ * @returns {void}\n   513→ * @author Andres Morales\n   514→ * @author Andres Gonzalez\n   515→ */\n   516→$(document).ready(function() {\n   517→    obtenerFuncionalidadesActivasPlan();\n   518→    configurarFormulario('form-editar-plantilla-etapa');\n   519→\n   520→    $(document).on('click', '#restablecer_texto', function () {\n   521→        if (!buscarFuncionalidad('plantillas_personalizadas')) {\n   522→            modalFuncionalidadInactiva();\n   523→            return;\n   524→        }\n   525→        confirmarRestablecerTexto();\n   526→    });\n   527→\n   528→    $(document).on('click', '#btn-cancelar-plantilla-etapa', function () {\n   529→        confirmarCancelarPlantillaEtapa();\n   530→    });\n   531→\n   532→    $(\".formulario-movimiento\").each(function() {\n   533→        let $formulario_movimiento = $(this);\n   534→        $formulario_movimiento.on(\"change keyup blur\", \"input, select, textarea\", function() {\n   535→            let formulario_movimiento_valido = $formulario_movimiento.validate().checkForm();\n   536→            if (formulario_movimiento_valido) {\n   537→                $formulario_movimiento.closest('.modal-content').find('button[type=\"submit\"]').prop('disabled', false);\n   538→            } else {\n   539→                $formulario_movimiento.closest('.modal-content').find('button[type=\"submit\"]').prop('disabled', true);\n   540→            }\n   541→        });\n   542→    });\n   543→});\n   544→\n   545→/**\n   546→ * Confirmar antes de cancelar la edición de la plantilla\n   547→ *\n   548→ * @returns {void}\n   549→ * @author Andres Morales\n   550→ */\n   551→function confirmarCancelarPlantillaEtapa() {\n   552→    Swal.fire({\n   553→        showCloseButton: true,\n   554→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   555→        showConfirmButton: false,\n   556→        showDenyButton: false,\n   557→        showCancelButton: false,\n   558→        html: `\n   559→            <div class=\"row w-100 mx-0 mt-2\">\n   560→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas cancelar?</div>\n   561→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Los cambios que hayas realizado en la plantilla no se guardarán. Esta acción no se puede deshacer.</div>\n   562→                <div class=\"col-6 mt-5 mb-2\">\n   563→                    ${crearBoton({\n   564→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   565→                        texto: 'Cancelar',\n   566→                        onclick: `Swal.clickDeny();`\n   567→                    })}\n   568→                </div>\n   569→                <div class=\"col-6 mt-5 mb-2\">\n   570→                    ${crearBoton({\n   571→                        clases: 'btn-primary w-100 justify-content-center',\n   572→                        texto: 'Aceptar',\n   573→                        onclick: `Swal.clickConfirm();`\n   574→                    })}\n   575→                </div>\n   576→            </div>\n   577→        `,\n   578→    }).then((result) => {\n   579→        if (result.isConfirmed) {\n   580→            $('#modal-editar-plantilla-etapa').modal('hide');\n   581→            limpiarFormulario('form-editar-plantilla-etapa');\n   582→        }\n   583→    });\n   584→}\n   585→\n   586→/**\n   587→ * Confirmar antes de restablecer el texto de la plantilla\n   588→ *\n   589→ * @returns {void}\n   590→ * @author Andres Morales\n   591→ */\n   592→function confirmarRestablecerTexto() {\n   593→    Swal.fire({\n   594→        showCloseButton: true,\n   595→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   596→        showConfirmButton: false,\n   597→        showDenyButton: false,\n   598→        showCancelButton: false,\n   599→        html: `\n   600→            <div class=\"row w-100 mx-0 mt-2\">\n   601→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas restablecer?</div>\n   602→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Se restablecerá el texto de la plantilla a su versión por defecto. Los cambios personalizados que hayas hecho se perderán. Esta acción no se puede deshacer.</div>\n   603→                <div class=\"col-6 mt-5 mb-2\">\n   604→                    ${crearBoton({\n   605→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   606→                        texto: 'Cancelar',\n   607→                        onclick: `Swal.clickDeny();`\n   608→                    })}\n   609→                </div>\n   610→                <div class=\"col-6 mt-5 mb-2\">\n   611→                    ${crearBoton({\n   612→                        clases: 'btn-danger w-100 justify-content-center',\n   613→                        texto: 'Restablecer',\n   614→                        onclick: `Swal.clickConfirm();`\n   615→                    })}\n   616→                </div>\n   617→            </div>\n   618→        `,\n   619→    }).then((result) => {\n   620→        if (result.isConfirmed) {\n   621→            restablecerPlantillaEtapa();\n   622→        }\n   623→    });\n   624→}\n   625→\n   626→/**\n   627→ * Restablecer la plantilla de etapa a su versión por defecto\n   628→ *\n   629→ * @returns {void}\n   630→ * @author Andres Morales\n   631→ */\n   632→function restablecerPlantillaEtapa() {\n   633→    var plantilla_id = $('#modal-editar-plantilla-etapa #id').val();\n   634→    var etapa_id = $('#modal-editar-plantilla-etapa #etapa_id').val();\n   635→\n   636→    if (!plantilla_id) {\n   637→        mostrarToast('danger', 'No se ha seleccionado una plantilla para restablecer');\n   638→        return;\n   639→    }\n   640→\n   641→    if (!etapa_id) {\n   642→        mostrarToast('danger', 'No se ha identificado la etapa');\n   643→        return;\n   644→    }\n   645→\n   646→    $.ajax({\n   647→        url: `/plantillas-correos-restablecer/${plantilla_id}`,\n   648→        type: 'PUT',\n   649→        headers: {\n   650→            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n   651→        },\n   652→        success: function(respuesta) {\n   653→            mostrarToast('success', respuesta.message);\n   654→\n   655→            let etapa = etapas_vacante.find(e => e.id === parseInt(etapa_id));\n   656→\n   657→            if (etapa) {\n   658→                consultarPlantillaEtapa(etapa.nombre).then(function(respuesta_plantilla) {\n   659→                    var plantilla = respuesta_plantilla.data;\n   660→\n   661→                    $('#modal-editar-plantilla-etapa #id').val(plantilla.id);\n   662→                    $('#modal-editar-plantilla-etapa #plantilla_correo_id').val(plantilla.plantilla_correo_id);\n   663→                    $('#modal-editar-plantilla-etapa #empresa_id').val(plantilla.empresa_id || (empresa && empresa.id) || '');\n   664→                    $('#modal-editar-plantilla-etapa #grupo_id').val(plantilla.grupo_id);\n   665→                    $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val(plantilla.titulo);\n   666→\n   667→                    if (plantilla.con_logo_empresa == 1) {\n   668→                        $('#modal-editar-plantilla-etapa #con_logo').prop('checked', true);\n   669→                    } else {\n   670→                        $('#modal-editar-plantilla-etapa #con_logo').prop('checked', false);\n   671→                    }\n   672→\n   673→                    if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n   674→                        if (plantilla.notificar_fin_proceso == 1) {\n   675→                            $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', true);\n   676→                        } else {\n   677→                            $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', false);\n   678→                        }\n   679→                    }\n   680→\n   681→                    setTimeout(function() {\n   682→                        if ($('#descripcion_mensaje_etapa').data('editor')) {\n   683→                            $('#descripcion_mensaje_etapa').data('editor').setData(plantilla.contenido || '');\n   684→                        }\n   685→                    }, 300);\n   686→                }).catch(function() {\n   687→                    mostrarToast('danger', 'Error al recargar la plantilla restaurada');\n   688→                });\n   689→            }\n   690→        },\n   691→        error: function(xhr) {\n   692→            var mensaje_error = 'Error al restablecer la plantilla';\n   693→            if (xhr.responseJSON && xhr.responseJSON.message) {\n   694→                mensaje_error = xhr.responseJSON.message;\n   695→            }\n   696→            mostrarToast('danger', mensaje_error);\n   697→        }\n   698→    });\n   699→}\n   700→\n   701→/**\n   702→ * Función para abrir la modal de movimiento de etapa\n   703→ *\n   704→ * @param {number} etapa_id ID de la etapa\n   705→ * @param {number} movimiento_id ID del movimiento\n   706→ * @returns {void}\n   707→ * @author José Manuel Jiménez\n   708→ * @author Andres Morales\n   709→ */\n   710→function abrirModalMovimientoEtapa(movimiento_id, etapa_movimiento_vacante_id, etapa_vacante_id) {\n   711→    modal_movimiento_id_seleccionado = movimiento_id;\n   712→    etapa_vacante_id_seleccionado = etapa_vacante_id;\n   713→    etapa_movimiento_vacante_id_seleccionado = etapa_movimiento_vacante_id;\n   714→    if (movimiento_id == 6) {\n   715→        cargarPruebasPsicometricasVacantes();\n   716→    } else {\n   717→        $(`#modal-movimiento-${movimiento_id}`).modal('show');\n   718→    }\n   719→}\n   720→\n   721→/**\n   722→ * Activa o desactiva la automatización de etapas de vacantes y envía el formulario.\n   723→ *\n   724→ * @param {HTMLElement} elemento Elemento del toggle.\n   725→ * @returns {void}\n   726→ * @author Andres Morales\n   727→ * @author Andres Gonzalez\n   728→ */\n   729→function automatizacionEtapas(elemento) {\n   730→    if (!buscarFuncionalidad('automatizacion_etapas')) {\n   731→        modalFuncionalidadInactiva();\n   732→        $('#campo_automatizar_etapas').val(0);\n   733→        return;\n   734→    }\n   735→\n   736→    let valor = elemento ? 1 : 0;\n   737→    $('#automatizar_etapas').val(valor);\n   738→    $('#formulario-vacantes-paso-1').submit();\n   739→}\n   740→\n   741→/**\n   742→ * Maneja la selección de archivos para preguntas prefiltro\n   743→ *\n   744→ * @author José Manuel Jiménez\n   745→ */\n   746→$('#archivo_prueba').on('change', function (e) {\n   747→    let archivos_seleccionados = e.target.files;\n   748→    for (let i = 0; i < archivos_seleccionados.length; i++) {\n   749→        let archivo = archivos_seleccionados[i];\n   750→        let nombre_repetido = archivos_preguntas.some(item => item.archivo.name === archivo.name);\n   751→        if (!nombre_repetido) {\n   752→            archivos_preguntas.push({\n   753→                archivo: archivo,\n   754→                seleccionado: true,\n   755→                id: Date.now() + '_' + i\n   756→            });\n   757→        } else {\n   758→            mostrarToast('warning', `El archivo \"${archivo.name}\" ya fue seleccionado anteriormente.`);\n   759→        }\n   760→    }\n   761→    $(this).val('');\n   762→    renderizarArchivos();\n   763→});\n   764→\n   765→/**\n   766→ * Renderiza los archivos seleccionados en el contenedor\n   767→ *\n   768→ * @returns {void}\n   769→ * @author José Manuel Jiménez\n   770→ * @author Sergio Vargas\n   771→ */\n   772→function renderizarArchivos() {\n   773→    let contenedor = $('#contenedor-archivos-preguntas-prefiltro');\n   774→    contenedor.empty();\n   775→    if (archivos_preguntas.length + archivos_cargados.length === 0) {\n   776→        contenedor.html('<p class=\"text-muted\">No hay archivos seleccionados</p>');\n   777→        return;\n   778→    }\n   779→\n   780→    let documentos_nuevos = [];\n   781→    let imagenes_nuevas = [];\n   782→    let documentos_cargados = [];\n   783→    let imagenes_cargadas = [];\n   784→\n   785→    archivos_preguntas.forEach((item) => {\n   786→        if (!item.seleccionado) return;\n   787→        if (item.archivo.type.startsWith('image/')) {\n   788→            imagenes_nuevas.push(item);\n   789→        } else {\n   790→            documentos_nuevos.push(item);\n   791→        }\n   792→    });\n   793→\n   794→    archivos_cargados.forEach((archivo) => {\n   795→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n   796→        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n   797→        if (es_imagen) {\n   798→            imagenes_cargadas.push(archivo);\n   799→        } else {\n   800→            documentos_cargados.push(archivo);\n   801→        }\n   802→    });\n   803→\n   804→    // Renderizar en orden: documentos primero, imágenes después\n   805→    //Documentos nuevos\n   806→    documentos_nuevos.forEach((item) => {\n   807→        let archivo = item.archivo;\n   808→        let extension = archivo.name.split('.').pop().toLowerCase();\n   809→        let icono = obtenerIconoPorExtension(extension);\n   810→        let html = `\n   811→            <div class=\"col-auto archivo-item\">\n   812→                <div class=\"col-auto px-3 border rounded-2\">\n   813→                    <div class=\"row align-items-center\">\n   814→                        <div class=\"col-auto py-3\">\n   815→                            <i class=\"${icono} text-blue-40\"></i>\n   816→                        </div>\n   817→                        <div class=\"col px-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n   818→                            ${archivo.name}\n   819→                        </div>\n   820→                        <div class=\"col-auto\">\n   821→                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"quitarArchivo('${item.id}')\"></i>\n   822→                        </div>\n   823→                    </div>\n   824→                </div>\n   825→            </div>\n   826→        `;\n   827→        contenedor.append(html);\n   828→    });\n   829→\n   830→    //Documentos cargados\n   831→    documentos_cargados.forEach((archivo) => {\n   832→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n   833→        let icono = obtenerIconoPorExtension(extension);\n   834→        let url_archivo = `/archivos-abrir/${archivo.id}`;\n   835→        let html = `\n   836→            <div class=\"col-auto archivo-item\">\n   837→                <div class=\"col-auto px-3 border rounded-2\">\n   838→                    <div class=\"row align-items-center\">\n   839→                        <div class=\"col-auto py-3\">\n   840→                            <i class=\"${icono} text-blue-40\"></i>\n   841→                        </div>\n   842→                        <div class=\"col px-0 py-3\">\n   843→                            <a href=\"${url_archivo}\"\n   844→                               target=\"_blank\"\n   845→                               class=\"text-blue-40 nowrap text-decoration-none\"\n   846→                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n   847→                                ${archivo.nombre_original_archivo}\n   848→                            </a>\n   849→                        </div>\n   850→                        <div class=\"col-auto\">\n   851→                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"eliminarArchivoServidor(${archivo.id})\"></i>\n   852→                        </div>\n   853→                    </div>\n   854→                </div>\n   855→            </div>\n   856→        `;\n   857→        contenedor.append(html);\n   858→    });\n   859→\n   860→    //Imágenes nuevas\n   861→    imagenes_nuevas.forEach((item) => {\n   862→        let archivo = item.archivo;\n   863→        let url_imagen = URL.createObjectURL(archivo);\n   864→        let html = `\n   865→            <div class=\"col-auto archivo-item\">\n   866→                <div class=\"col-auto px-3 border rounded-2\">\n   867→                    <div class=\"row align-items-center\">\n   868→                        <img class=\"col-12 border-bottom px-0 pointer\"\n   869→                             src=\"${url_imagen}\"\n   870→                             alt=\"${archivo.name}\"\n   871→                             style=\"object-fit:cover; border-radius:6px; cursor: pointer;\"\n   872→                             onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n   873→                    </div>\n   874→                    <div class=\"row align-items-center\">\n   875→                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n   876→                            ${archivo.name}\n   877→                        </div>\n   878→                        <div class=\"col-auto\">\n   879→                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"quitarArchivo('${item.id}')\"></i>\n   880→                        </div>\n   881→                    </div>\n   882→                </div>\n   883→            </div>\n   884→        `;\n   885→        contenedor.append(html);\n   886→    });\n   887→\n   888→    //Imágenes cargadas\n   889→    imagenes_cargadas.forEach((archivo) => {\n   890→        let url_imagen = `/archivos-abrir/${archivo.id}`;\n   891→        let html = `\n   892→            <div class=\"col-4 archivo-item\">\n   893→                <div class=\"col-auto px-3 border rounded-2\">\n   894→                    <div class=\"row align-items-center\">\n   895→                        <img class=\"col-12 border-bottom px-0 pointer\"\n   896→                             src=\"${url_imagen}\"\n   897→                             alt=\"${archivo.nombre_original_archivo}\"\n   898→                             style=\"object-fit:cover; border-radius:6px; cursor: pointer;\"\n   899→                             onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n   900→                    </div>\n   901→                    <div class=\"row align-items-center\">\n   902→                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n   903→                            ${archivo.nombre_original_archivo}\n   904→                        </div>\n   905→                        <div class=\"col-auto\">\n   906→                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"eliminarArchivoServidor(${archivo.id})\"></i>\n   907→                        </div>\n   908→                    </div>\n   909→                </div>\n   910→            </div>\n   911→        `;\n   912→        contenedor.append(html);\n   913→    });\n   914→\n   915→    inicializarTooltips();\n   916→}\n   917→\n   918→/**\n   919→ * Obtiene el ícono correspondiente a una extensión de archivo\n   920→ *\n   921→ * @param {string} extension Extensión del archivo\n   922→ * @returns {string} Clase del ícono correspondiente\n   923→ * @author José Manuel Jiménez\n   924→ */\n   925→function obtenerIconoPorExtension(extension) {\n   926→    switch (extension) {\n   927→        case 'pdf':\n   928→            return 'bi bi-filetype-pdf';\n   929→        case 'doc':\n   930→        case 'docx':\n   931→            return 'bi bi-filetype-docx';\n   932→        case 'xls':\n   933→        case 'xlsx':\n   934→            return 'bi bi-filetype-xlsx';\n   935→        default:\n   936→            return 'bi bi-file-earmark';\n   937→    }\n   938→}\n   939→\n   940→/**\n   941→ * Quita un archivo de la lista de archivos seleccionados\n   942→ *\n   943→ * @param {string} id ID del archivo a quitar\n   944→ * @returns {void}\n   945→ * @author José Manuel Jiménez\n   946→ */\n   947→function quitarArchivo(id) {\n   948→    archivos_preguntas = archivos_preguntas.filter(item => item.id !== id);\n   949→    renderizarArchivos();\n   950→}\n   951→\n   952→/**\n   953→ * Elimina un archivo del servidor y actualiza la lista de archivos cargados\n   954→ *\n   955→ * @param {number} archivo_id ID del archivo a eliminar\n   956→ * @returns {void}\n   957→ * @author José Manuel Jiménez\n   958→ */\n   959→function eliminarArchivoServidor(archivo_id) {\n   960→    $.ajax({\n   961→        url: `/archivos/${archivo_id}`,\n   962→        type: 'DELETE',\n   963→        headers: {\n   964→            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n   965→        },\n   966→        success: function(respuesta) {\n   967→            mostrarToast('success', respuesta.message);\n   968→            archivos_cargados = archivos_cargados.filter(item => item.id !== archivo_id);\n   969→            renderizarArchivos();\n   970→        }\n   971→    });\n   972→}\n   973→\n   974→/**\n   975→ * Adjunta los archivos seleccionados a la etapa de vacante\n   976→ *\n   977→ * @returns {void}\n   978→ * @author José Manuel Jiménez\n   979→ */\n   980→function adjuntarArchivos() {\n   981→    if (!etapa_vacante_id_seleccionado) {\n   982→        mostrarToast('warning', 'Debe ingresar un ID de etapa de vacante');\n   983→        return;\n   984→    }\n   985→    if (archivos_preguntas.length === 0) {\n   986→        return;\n   987→    }\n   988→    let datos_form = new FormData();\n   989→    let archivos_agregados = 0;\n   990→    datos_form.append('_token', $('input[name=\"_token\"]').val());\n   991→    datos_form.append('etapa_vacante_id', etapa_vacante_id_seleccionado);\n   992→    archivos_preguntas.forEach(item => {\n   993→        if (item.seleccionado) {\n   994→            datos_form.append('archivos[]', item.archivo);\n   995→            archivos_agregados++;\n   996→        }\n   997→    });\n   998→\n   999→    if (archivos_agregados === 0) {\n  1000→        return;\n  1001→    }\n  1002→\n  1003→    $.ajax({\n  1004→        type       : 'POST',\n  1005→        url        : '/etapas-vacantes-adjuntar-archivos',\n  1006→        data       : datos_form,\n  1007→        processData: false,\n  1008→        contentType: false\n  1009→    }).done((respuesta) => {\n  1010→        mostrarToast('success', respuesta.message);\n  1011→        $('#etapa_vacante_id_prueba').val('');\n  1012→        archivos_preguntas = [];\n  1013→        renderizarArchivos();\n  1014→    }).fail((error) => {\n  1015→        let mensaje = error.responseJSON?.message || 'Ocurrió un error al adjuntar los archivos';\n  1016→        mostrarToast('danger', mensaje);\n  1017→    });\n  1018→}\n  1019→\n  1020→/**\n  1021→ * Validar las condiciones adicionales del formulario.\n  1022→ *\n  1023→ * @param {FormData} formulario Datos del formulario.\n  1024→ * @returns {Promise<Array>}\n  1025→ * @author Andres Gonzalez\n  1026→ */\n  1027→function validacionAdicional(formulario) {\n  1028→    if (formulario == \"form-editar-plantilla-etapa\") {\n  1029→        if (!buscarFuncionalidad('plantillas_personalizadas')) {\n  1030→            modalFuncionalidadInactiva();\n  1031→            return false;\n  1032→        }\n  1033→    }\n  1034→\n  1035→    return true;\n  1036→}\n  1037→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"d5878dea-8092-4e83-9f0a-a310ee9ba56c","timestamp":"2026-01-28T13:12:50.539Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-2.js","content":"/**\n * Archivo para manejar la lógica del Paso 2: Etapas de la vacante\n * @author Andres Morales\n * @author José Manuel Jiménez\n */\nconst CONFIGURACION_ETAPAS = {\n    'Revisión HV': {\n        titulo_modal_notificacion: 'Inicio proceso de selección',\n        titulo_notificacion: 'Notificación inicio proceso de selección',\n        titulo_etapa: 'Revisión hoja de vida',\n        plantilla_correo_id: 12\n    },\n    'Preguntas prefiltro': {\n        titulo_modal_notificacion: 'Preguntas pre-filtro',\n        titulo_notificacion: 'Notificacion envío de preguntas pre-filtro',\n        titulo_etapa: 'Preguntas prefiltro',\n        plantilla_correo_id: 13\n    },\n    'Pruebas psicométricas': {\n        titulo_modal_notificacion: 'Pruebas psicométricas',\n        titulo_notificacion: 'Notificación envío de pruebas psicométricas',\n        titulo_etapa: 'Pruebas psicométricas',\n        plantilla_correo_id: 15\n    },\n    'Prueba técnica': {\n        titulo_modal_notificacion: 'Prueba técnica',\n        titulo_notificacion: 'Notificación envío de prueba técnica',\n        titulo_etapa: 'Prueba técnica',\n        plantilla_correo_id: 18\n    },\n    'Video entrevista': {\n        titulo_modal_notificacion: 'Video entrevista',\n        titulo_notificacion: 'Notificación envío de video entrevista',\n        titulo_etapa: 'Solicitud video entrevista',\n        plantilla_correo_id: 21\n    },\n    'Entrevista': {\n        titulo_modal_notificacion: 'Entrevista',\n        titulo_notificacion: 'Notificacíon de entrevista',\n        titulo_etapa: 'Solicitud de entrevista',\n        plantilla_correo_id: 26\n    },\n    'Documentos para contratación': {\n        titulo_modal_notificacion: 'Documentos para contratación',\n        titulo_notificacion: 'Notificación envío de solicitud de documentos',\n        titulo_etapa: 'Solicitar documentos',\n        plantilla_correo_id: 23\n    },\n    'Contratados': {\n        titulo_modal_notificacion: 'Contratados',\n        titulo_notificacion: 'Notificación de resultado del proceso',\n        plantilla_correo_id: 27\n    },\n    'Descartados': {\n        titulo_modal_notificacion: 'Descartados',\n        titulo_notificacion: 'Notificación de resultado del proceso',\n        plantilla_correo_id: 28\n    }\n};\n\nlet etapa_movimiento_vacante_id_seleccionado = null;\nlet etapa_vacante_id_seleccionado = null;\nlet modal_movimiento_id_seleccionado = null;\nlet contador_preguntas = 0; // Contador general (mantener por compatibilidad)\nlet contador_preguntas_prefiltro = 0; // Contador específico para modal preguntas prefiltro\nlet contador_preguntas_video_entrevista = 0; // Contador específico para modal video entrevista\nlet contador_respuestas = 0;\nlet archivos_preguntas = [];\nlet toggle_etapa_activado = null;\nlet etapa_activada_desde_toggle = false;\nlet archivos_cargados = [];\n\n/**\n * Obtiene la configuración de títulos para una etapa\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @param {string} tipo_titulo Tipo de título a obtener: 'titulo_modal_notificacion', 'titulo_notificacion' o 'titulo_etapa'\n * @returns {string|null} Título configurado o null si no existe\n * @author Andres Morales\n */\nfunction obtenerTituloEtapa(nombre_etapa, tipo_titulo = 'titulo_modal_notificacion') {\n    var configuracion = CONFIGURACION_ETAPAS[nombre_etapa];\n    return configuracion && configuracion[tipo_titulo] ? configuracion[tipo_titulo] : null;\n}\n\n/**\n * Verifica si existe un título configurado para una etapa\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @param {string} tipo_titulo Tipo de título a verificar\n * @returns {boolean} True si existe el título, false si no\n * @author Andres Morales\n */\nfunction existeTituloEtapa(nombre_etapa, tipo_titulo) {\n    return obtenerTituloEtapa(nombre_etapa, tipo_titulo) !== null;\n}\n\n/**\n * Obtiene el ID de plantilla de correo para una etapa\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @returns {number|null} ID de la plantilla o null si no existe\n * @author Andres Morales\n */\nfunction obtenerPlantillaCorreoId(nombre_etapa) {\n    var configuracion = CONFIGURACION_ETAPAS[nombre_etapa];\n    return configuracion && configuracion.plantilla_correo_id ? configuracion.plantilla_correo_id : null;\n}\n\n/**\n * Consulta la plantilla de correo de una etapa específica\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @returns {Promise} Promesa con los datos de la plantilla\n * @author Andres Morales\n */\nfunction consultarPlantillaEtapa(nombre_etapa) {\n    var plantilla_correo_id = obtenerPlantillaCorreoId(nombre_etapa);\n\n    if (!plantilla_correo_id) {\n        console.error('No se encontró ID de plantilla para la etapa:', nombre_etapa);\n        return Promise.reject('No se encontró ID de plantilla');\n    }\n\n    return $.ajax({\n        url: '/plantilla-correo',\n        method: 'GET',\n        data: {\n            plantilla_correo_id: plantilla_correo_id,\n            empresa_id: empresa?.id\n        },\n        dataType: 'json'\n    });\n}\n\n/**\n * Función para consultar las etapas de una vacante\n *\n * @param {number} vacante_id ID de la vacante\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction consultarEtapasVacante(vacante_id) {\n    $.ajax({\n        url: `/etapas-vacantes`,\n        data: { vacante_id: vacante_id },\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            etapas_vacante = respuesta.data || [];\n            mostrarEtapasVacante();\n            calcularDiasDuracionProceso(vacante_id);\n        }\n    });\n}\n\n/**\n * Función para calcular y mostrar los días de duración del proceso\n *\n * @param {number} vacante_id ID de la vacante\n * @returns {void}\n * @author Andres Morales\n */\nfunction calcularDiasDuracionProceso(vacante_id) {\n    $.ajax({\n        url: `/vacantes-calcular-dias-duracion-proceso/${vacante_id}`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            var dias = respuesta.duracion_dias || 0;\n            $('#contador-dias-proceso').html(dias);\n        },\n        error: function() {\n            $('#contador-dias-proceso').html('0');\n        }\n    });\n}\n\n/**\n * Función para mostrar las etapas de una vacante en un acordeon.\n *\n * @param {Object} etapas Array con las etapas de la vacante.\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction mostrarEtapasVacante() {\n    let etapas = etapas_vacante;\n    $('#contenedor-vacantes-etapas').empty().append(crearAcordeon({\n        id: 'acordeon',\n        acordeon: etapas.map((etapa, index) => ({\n            id: `etapa-${index}`,\n            titulo: `\n                <div class=\"col\">\n                    <div class=\"row\">\n                        <div class=\"col ps-1 text-gray-10 text-body-1\">${etapa.nombre}</div>\n                        <div class=\"col-auto pe-7\">\n                            ${etapa.editable == 1 ? crearToggle({\n                                id: `activar_etapa_${index}`,\n                                name: `activar_etapa_${index}`,\n                                class: 'checkbox-etapa-vacante',\n                                value: etapa.id,\n                                checked: etapa.activa == 1 ? true : false,\n                                onchange: `activarDesactivarEtapa(this)`,\n                            }) : ''}\n                        </div>\n                    </div>\n                </div>\n            `,\n            contenido: `\n                <div class=\"row\">\n                    ${etapa.etapas_movimientos.map(etapa_movimiento => `\n                        <div class=\"col-12 d-flex justify-content-between align-items-center\">\n                            <div class=\"text-body-2 text-gray-30\">\n                                ${etapa_movimiento.movimiento.nombre}\n                            </div>\n                            <div>\n                                ${crearBoton({\n                                    clases: 'btn-text-primary btn-circle',\n                                    texto: '<i class=\"bi bi-gear\"></i>',\n                                    onclick: `${etapa_movimiento.movimiento.es_notificacion == 1 ?\n                                        `abrirModalNotificacionEtapa(${etapa.id})` : `abrirModalMovimientoEtapa(${etapa_movimiento.movimiento.id}, ${etapa_movimiento.id}, ${etapa_movimiento.etapa_vacante_id})`\n                                    }`\n                                })}\n                            </div>\n                        </div>\n                    `).join('')}\n                </div>\n            `,\n            disabled: etapa.activa == 0 ? true : false,\n            ordenar: etapa.fija == 0 ? true : false,\n            adicional: `data-orden=\"${etapa.orden}\" data-etapa_vacante_id=\"${etapa.id}\" data-fija=\"${etapa.fija}\"`,\n        }))\n    }));\n    $(\"#acordeon\").sortable({\n        items: \".accordion-item\",\n        handle: \".drag-handle\",\n        cursor: \"grabbing\",\n        placeholder: \"ui-sortable-placeholder\",\n        tolerance: \"pointer\",\n        update: function(evento, elemento) {\n            let elemento_actual = elemento.item;\n            let orden_actual = $(elemento_actual).data('orden');\n            let elemento_anterior = elemento_actual.prev();\n            let orden_anterior = $(elemento_anterior).data('orden');\n            let es_fijo_anterior = $(elemento_anterior).data('fija');\n            if (es_fijo_anterior == 1) {\n                return false;\n            }\n            if (orden_anterior == undefined) {\n                orden_anterior = '0';\n            }\n            if ((parseInt(orden_actual) - 1) != orden_anterior) {\n                if (parseInt(orden_actual) > parseInt(orden_anterior)) {\n                    orden_anterior = parseInt(orden_anterior) + 1;\n                }\n                let etapa_vacante_id = $(elemento_actual).data('etapa_vacante_id');\n                $.ajax({\n                    url : `/etapas-vacantes-cambiar-orden`,\n                    type: 'POST',\n                    data: {\n                        _token : $('meta[name=\"csrf-token\"]').attr('content'),\n                        _method: 'PUT',\n                        id: etapa_vacante_id,\n                        orden: orden_anterior\n                    },\n                    success: function (respuesta) {\n                        mostrarToast('success', respuesta.message);\n                        $(elemento_actual).data('orden', orden_anterior);\n                        $(elemento_anterior).data('orden', orden_actual);\n                    },\n                    error: function (error) {\n                        mostrarToast('danger', 'Ocurrió un error al organizar');\n                    }\n                });\n            }\n        }\n    });\n}\n\n/**\n * Función para activar o desactivar un acordeon de una etapa de la vacante.\n *\n * @param {HTMLInputElement} checkbox Checkbox que activa o desactiva la etapa\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction activarDesactivarEtapa(checkbox) {\n    setTimeout(() => {\n        if (checkbox.checked) {\n            $(checkbox).closest('.accordion-item').find('.accordion-button').removeClass('collapsed').attr('aria-disabled', 'false').attr('disabled', false);\n            $(checkbox).closest('.accordion-item').find('.accordion-collapse').addClass('show').attr('aria-expanded', 'true');\n\n            toggle_etapa_activado = checkbox;\n            etapa_activada_desde_toggle = true;\n\n            var etapa_vacante_id = $(checkbox).closest('.accordion-item').data('etapa_vacante_id');\n\n            var etapa_encontrada = etapas_vacante.find(function(etapa) {\n                return etapa.id === etapa_vacante_id;\n            });\n\n            if (etapa_encontrada && etapa_encontrada.etapas_movimientos) {\n                var primer_movimiento_config = etapa_encontrada.etapas_movimientos.find(function(etapa_movimiento) {\n                    return etapa_movimiento.movimiento && etapa_movimiento.movimiento.es_notificacion !== 1;\n                });\n\n                if (primer_movimiento_config && primer_movimiento_config.movimiento) {\n                    abrirModalMovimientoEtapa(\n                        primer_movimiento_config.movimiento.id,\n                        primer_movimiento_config.id,\n                        primer_movimiento_config.etapa_vacante_id\n                    );\n                }\n            }\n        } else {\n            $(checkbox).closest('.accordion-item').find('.accordion-button').addClass('collapsed').attr('aria-disabled', 'true').attr('disabled', true);\n            $(checkbox).closest('.accordion-item').find('.accordion-collapse').removeClass('show').attr('aria-expanded', 'false');\n        }\n        $.ajax({\n            url: `/etapas-vacantes/${checkbox.value}`,\n            data: {\n                activa: checkbox.checked ? 1 : 0,\n                _token: $('meta[name=\"csrf-token\"]').attr('content')\n            },\n            method: 'PUT',\n            dataType: 'json',\n            success: function(respuesta) {\n                var vacante_id = $('#id').val();\n                if (vacante_id) {\n                    calcularDiasDuracionProceso(vacante_id);\n                }\n            }\n        });\n    }, 500);\n}\n\n/**\n * Función para filtrar las etapas de la vacante en el acordeon.\n *\n * @param {string} mostrar_etapas Valor del filtro: '1' para mostrar solo las etapas activas, '0' para mostrar solo las etapas inactivas, cualquier otro valor para mostrar todas las etapas.\n * @author José Manuel Jiménez\n */\nfunction filtrarEtapasVacante(mostrar_etapas) {\n    $('#acordeon .accordion-item').removeClass('d-none');\n    if (mostrar_etapas == '1') {\n        $('#acordeon .accordion-item').each(function() {\n            if ($(this).find('.checkbox-etapa-vacante').length > 0 && !$(this).find('.checkbox-etapa-vacante').is(':checked')) {\n                $(this).addClass('d-none');\n            }\n        });\n    } else if (mostrar_etapas == '0') {\n        $('#acordeon .accordion-item').each(function() {\n            if ($(this).find('.checkbox-etapa-vacante').length == 0 || $(this).find('.checkbox-etapa-vacante').is(':checked')) {\n                $(this).addClass('d-none');\n            }\n        });\n    }\n}\n\n/**\n * Función para abrir la modal de edición de plantilla de etapa\n *\n * @param {number} etapa_id ID de la etapa\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction abrirModalNotificacionEtapa(etapa_id) {\n    $('#modal-editar-plantilla-etapa #etapa_id').val(etapa_id);\n\n    let etapa = etapas_vacante.find(e => e.id === etapa_id);\n\n    if (etapa) {\n        $('#titulo-plantilla-modal').text(etapa.nombre);\n\n        if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n            $('#contenedor_check_enviar_al_finalizar').html(`\n                ${crearCheckbox({\n                    id: 'enviar_finalizar',\n                    class: 'input-dinamico',\n                    label: 'Enviar comunicación únicamente cuando finalice el proceso',\n                })}\n            `);\n        } else {\n            $('#contenedor_check_enviar_al_finalizar').html(`\n                ${crearCheckbox({\n                    id: 'enviar_finalizar',\n                    class: 'input-dinamico',\n                    input_container_class: 'd-none',\n                    checked: false,\n                    label: 'Enviar comunicación únicamente cuando finalice el proceso',\n                })}\n            `);\n        }\n\n        consultarPlantillaEtapa(etapa.nombre).then(function(respuesta) {\n            var plantilla = respuesta.data;\n\n            $('#modal-editar-plantilla-etapa #id').val(plantilla.id);\n            $('#modal-editar-plantilla-etapa #plantilla_correo_id').val(plantilla.plantilla_correo_id || plantilla.id);\n            $('#modal-editar-plantilla-etapa #empresa_id').val(plantilla.empresa_id || (empresa && empresa.id) || '');\n            $('#modal-editar-plantilla-etapa #grupo_id').val(plantilla.grupo_id);\n            $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val(plantilla.titulo);\n\n            if (plantilla.con_logo_empresa == 1) {\n                $('#modal-editar-plantilla-etapa #con_logo').prop('checked', true);\n            } else {\n                $('#modal-editar-plantilla-etapa #con_logo').prop('checked', false);\n            }\n\n            if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n                if (plantilla.notificar_fin_proceso == 1) {\n                    $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', true);\n                } else {\n                    $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', false);\n                }\n            }\n\n            $('#contenedor_editor_texto').html(`\n                ${crearEditorTexto({\n                    adicional: `data-botonadicional=\"botonAdicionalCkeditorEtapa\"`,\n                    id: 'descripcion_mensaje_etapa',\n                    name: 'descripcion_mensaje_etapa',\n                    class: 'classic-editor-opciones',\n                    input_container_class: 'mb-4',\n                    maxlength: 16350,\n                    required: true\n                })}\n            `);\n\n            inicializarClassicEditor();\n\n            setTimeout(function() {\n                if ($('#descripcion_mensaje_etapa').data('editor')) {\n                    $('#descripcion_mensaje_etapa').data('editor').setData(plantilla.contenido || '');\n                }\n            }, 500);\n        }).catch(function(error) {\n            if (typeof empresa !== 'undefined' && empresa && empresa.id) {\n                $('#modal-editar-plantilla-etapa #empresa_id').val(empresa.id);\n            }\n\n            $('#contenedor_editor_texto').html(`\n                ${crearEditorTexto({\n                    adicional: `data-botonadicional=\"botonAdicionalCkeditorEtapa\"`,\n                    id: 'descripcion_mensaje_etapa',\n                    name: 'descripcion_mensaje_etapa',\n                    class: 'classic-editor-opciones',\n                    input_container_class: 'mb-4',\n                    maxlength: 16350,\n                    required: true\n                })}\n            `);\n\n            inicializarClassicEditor();\n        });\n    }\n\n    $('#modal-editar-plantilla-etapa').modal('show');\n}\n\n/**\n * Crear boton adicional para ckeditor con variables de etapa\n *\n * @param {string} id ID del editor\n * @returns {html} botón adicional para ckeditor\n * @author Andres Morales\n */\nfunction botonAdicionalCkeditorEtapa(id) {\n    var variables_etapa = [\n        { llave: 'nombre_informador', valor: 'Nombre de usuario (Yo)' },\n        { llave: 'nombre_empresa', valor: 'Nombre de la empresa' },\n        { llave: 'nombre_vacante', valor: 'Nombre de la vacante' },\n        { llave: 'nombre_candidato', valor: 'Nombre del candidato' }\n    ];\n\n    var opciones_variables = variables_etapa\n        .map(variable => `<button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableEtapa('${id}', '__${variable.llave}__')\">${variable.valor}</button>`)\n        .join('');\n\n    return `\n        <div class=\"border-start border-black border-2 px-2 my-0 dropdown\">\n            ${crearBoton({\n                clases: 'dropdown-toggle text-body-3 btn-dropdown-ckeditor',\n                texto: 'Agregar variable<i class=\"bi bi-chevron-down text-body-3 ms-2\"></i>',\n                data: [{texto: 'bs-toggle', value: 'dropdown'},{texto: 'bs-auto-close', value: 'outside'}]\n            })}\n            <div class=\"dropdown-menu bg-white\">${opciones_variables}</div>\n        </div>\n    `;\n}\n\n/**\n * Agrega la variable en el ckeditor de etapa\n *\n * @param {string} id ID del editor\n * @param {string} variable Variable a agregar\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction agregarVariableEtapa(id, variable) {\n    let editor = $(`#${id}`).data('editor');\n    let fragmento_vista = editor.data.processor.toView(variable);\n    let fragmento_modelo = editor.data.toModel(fragmento_vista);\n    editor.model.insertContent(fragmento_modelo);\n}\n\n/**\n * Inicializar configuración del formulario de plantilla de etapa\n *\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\n$(document).ready(function() {\n    obtenerFuncionalidadesActivasPlan();\n    configurarFormulario('form-editar-plantilla-etapa');\n\n    $(document).on('click', '#restablecer_texto', function () {\n        if (!buscarFuncionalidad('plantillas_personalizadas')) {\n            modalFuncionalidadInactiva();\n            return;\n        }\n        confirmarRestablecerTexto();\n    });\n\n    $(document).on('click', '#btn-cancelar-plantilla-etapa', function () {\n        confirmarCancelarPlantillaEtapa();\n    });\n\n    $(\".formulario-movimiento\").each(function() {\n        let $formulario_movimiento = $(this);\n        $formulario_movimiento.on(\"change keyup blur\", \"input, select, textarea\", function() {\n            let formulario_movimiento_valido = $formulario_movimiento.validate().checkForm();\n            if (formulario_movimiento_valido) {\n                $formulario_movimiento.closest('.modal-content').find('button[type=\"submit\"]').prop('disabled', false);\n            } else {\n                $formulario_movimiento.closest('.modal-content').find('button[type=\"submit\"]').prop('disabled', true);\n            }\n        });\n    });\n});\n\n/**\n * Confirmar antes de cancelar la edición de la plantilla\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction confirmarCancelarPlantillaEtapa() {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas cancelar?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Los cambios que hayas realizado en la plantilla no se guardarán. Esta acción no se puede deshacer.</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Aceptar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((result) => {\n        if (result.isConfirmed) {\n            $('#modal-editar-plantilla-etapa').modal('hide');\n            limpiarFormulario('form-editar-plantilla-etapa');\n        }\n    });\n}\n\n/**\n * Confirmar antes de restablecer el texto de la plantilla\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction confirmarRestablecerTexto() {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas restablecer?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Se restablecerá el texto de la plantilla a su versión por defecto. Los cambios personalizados que hayas hecho se perderán. Esta acción no se puede deshacer.</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-danger w-100 justify-content-center',\n                        texto: 'Restablecer',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((result) => {\n        if (result.isConfirmed) {\n            restablecerPlantillaEtapa();\n        }\n    });\n}\n\n/**\n * Restablecer la plantilla de etapa a su versión por defecto\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction restablecerPlantillaEtapa() {\n    var plantilla_id = $('#modal-editar-plantilla-etapa #id').val();\n    var etapa_id = $('#modal-editar-plantilla-etapa #etapa_id').val();\n\n    if (!plantilla_id) {\n        mostrarToast('danger', 'No se ha seleccionado una plantilla para restablecer');\n        return;\n    }\n\n    if (!etapa_id) {\n        mostrarToast('danger', 'No se ha identificado la etapa');\n        return;\n    }\n\n    $.ajax({\n        url: `/plantillas-correos-restablecer/${plantilla_id}`,\n        type: 'PUT',\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message);\n\n            let etapa = etapas_vacante.find(e => e.id === parseInt(etapa_id));\n\n            if (etapa) {\n                consultarPlantillaEtapa(etapa.nombre).then(function(respuesta_plantilla) {\n                    var plantilla = respuesta_plantilla.data;\n\n                    $('#modal-editar-plantilla-etapa #id').val(plantilla.id);\n                    $('#modal-editar-plantilla-etapa #plantilla_correo_id').val(plantilla.plantilla_correo_id);\n                    $('#modal-editar-plantilla-etapa #empresa_id').val(plantilla.empresa_id || (empresa && empresa.id) || '');\n                    $('#modal-editar-plantilla-etapa #grupo_id').val(plantilla.grupo_id);\n                    $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val(plantilla.titulo);\n\n                    if (plantilla.con_logo_empresa == 1) {\n                        $('#modal-editar-plantilla-etapa #con_logo').prop('checked', true);\n                    } else {\n                        $('#modal-editar-plantilla-etapa #con_logo').prop('checked', false);\n                    }\n\n                    if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n                        if (plantilla.notificar_fin_proceso == 1) {\n                            $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', true);\n                        } else {\n                            $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', false);\n                        }\n                    }\n\n                    setTimeout(function() {\n                        if ($('#descripcion_mensaje_etapa').data('editor')) {\n                            $('#descripcion_mensaje_etapa').data('editor').setData(plantilla.contenido || '');\n                        }\n                    }, 300);\n                }).catch(function() {\n                    mostrarToast('danger', 'Error al recargar la plantilla restaurada');\n                });\n            }\n        },\n        error: function(xhr) {\n            var mensaje_error = 'Error al restablecer la plantilla';\n            if (xhr.responseJSON && xhr.responseJSON.message) {\n                mensaje_error = xhr.responseJSON.message;\n            }\n            mostrarToast('danger', mensaje_error);\n        }\n    });\n}\n\n/**\n * Función para abrir la modal de movimiento de etapa\n *\n * @param {number} etapa_id ID de la etapa\n * @param {number} movimiento_id ID del movimiento\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction abrirModalMovimientoEtapa(movimiento_id, etapa_movimiento_vacante_id, etapa_vacante_id) {\n    modal_movimiento_id_seleccionado = movimiento_id;\n    etapa_vacante_id_seleccionado = etapa_vacante_id;\n    etapa_movimiento_vacante_id_seleccionado = etapa_movimiento_vacante_id;\n    if (movimiento_id == 6) {\n        cargarPruebasPsicometricasVacantes();\n    } else {\n        $(`#modal-movimiento-${movimiento_id}`).modal('show');\n    }\n}\n\n/**\n * Activa o desactiva la automatización de etapas de vacantes y envía el formulario.\n *\n * @param {HTMLElement} elemento Elemento del toggle.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction automatizacionEtapas(elemento) {\n    if (!buscarFuncionalidad('automatizacion_etapas')) {\n        modalFuncionalidadInactiva();\n        $('#campo_automatizar_etapas').val(0);\n        return;\n    }\n\n    let valor = elemento ? 1 : 0;\n    $('#automatizar_etapas').val(valor);\n    $('#formulario-vacantes-paso-1').submit();\n}\n\n/**\n * Maneja la selección de archivos para preguntas prefiltro\n *\n * @author José Manuel Jiménez\n */\n$('#archivo_prueba').on('change', function (e) {\n    let archivos_seleccionados = e.target.files;\n    for (let i = 0; i < archivos_seleccionados.length; i++) {\n        let archivo = archivos_seleccionados[i];\n        let nombre_repetido = archivos_preguntas.some(item => item.archivo.name === archivo.name);\n        if (!nombre_repetido) {\n            archivos_preguntas.push({\n                archivo: archivo,\n                seleccionado: true,\n                id: Date.now() + '_' + i\n            });\n        } else {\n            mostrarToast('warning', `El archivo \"${archivo.name}\" ya fue seleccionado anteriormente.`);\n        }\n    }\n    $(this).val('');\n    renderizarArchivos();\n});\n\n/**\n * Renderiza los archivos seleccionados en el contenedor\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Sergio Vargas\n */\nfunction renderizarArchivos() {\n    let contenedor = $('#contenedor-archivos-preguntas-prefiltro');\n    contenedor.empty();\n    if (archivos_preguntas.length + archivos_cargados.length === 0) {\n        contenedor.html('<p class=\"text-muted\">No hay archivos seleccionados</p>');\n        return;\n    }\n\n    let documentos_nuevos = [];\n    let imagenes_nuevas = [];\n    let documentos_cargados = [];\n    let imagenes_cargadas = [];\n\n    archivos_preguntas.forEach((item) => {\n        if (!item.seleccionado) return;\n        if (item.archivo.type.startsWith('image/')) {\n            imagenes_nuevas.push(item);\n        } else {\n            documentos_nuevos.push(item);\n        }\n    });\n\n    archivos_cargados.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_cargados.push(archivo);\n        }\n    });\n\n    // Renderizar en orden: documentos primero, imágenes después\n    //Documentos nuevos\n    documentos_nuevos.forEach((item) => {\n        let archivo = item.archivo;\n        let extension = archivo.name.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"quitarArchivo('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    //Documentos cargados\n    documentos_cargados.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"eliminarArchivoServidor(${archivo.id})\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    //Imágenes nuevas\n    imagenes_nuevas.forEach((item) => {\n        let archivo = item.archivo;\n        let url_imagen = URL.createObjectURL(archivo);\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer\"\n                             src=\"${url_imagen}\"\n                             alt=\"${archivo.name}\"\n                             style=\"object-fit:cover; border-radius:6px; cursor: pointer;\"\n                             onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"quitarArchivo('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    //Imágenes cargadas\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        let html = `\n            <div class=\"col-4 archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer\"\n                             src=\"${url_imagen}\"\n                             alt=\"${archivo.nombre_original_archivo}\"\n                             style=\"object-fit:cover; border-radius:6px; cursor: pointer;\"\n                             onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"eliminarArchivoServidor(${archivo.id})\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    inicializarTooltips();\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Quita un archivo de la lista de archivos seleccionados\n *\n * @param {string} id ID del archivo a quitar\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction quitarArchivo(id) {\n    archivos_preguntas = archivos_preguntas.filter(item => item.id !== id);\n    renderizarArchivos();\n}\n\n/**\n * Elimina un archivo del servidor y actualiza la lista de archivos cargados\n *\n * @param {number} archivo_id ID del archivo a eliminar\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction eliminarArchivoServidor(archivo_id) {\n    $.ajax({\n        url: `/archivos/${archivo_id}`,\n        type: 'DELETE',\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message);\n            archivos_cargados = archivos_cargados.filter(item => item.id !== archivo_id);\n            renderizarArchivos();\n        }\n    });\n}\n\n/**\n * Adjunta los archivos seleccionados a la etapa de vacante\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction adjuntarArchivos() {\n    if (!etapa_vacante_id_seleccionado) {\n        mostrarToast('warning', 'Debe ingresar un ID de etapa de vacante');\n        return;\n    }\n    if (archivos_preguntas.length === 0) {\n        return;\n    }\n    let datos_form = new FormData();\n    let archivos_agregados = 0;\n    datos_form.append('_token', $('input[name=\"_token\"]').val());\n    datos_form.append('etapa_vacante_id', etapa_vacante_id_seleccionado);\n    archivos_preguntas.forEach(item => {\n        if (item.seleccionado) {\n            datos_form.append('archivos[]', item.archivo);\n            archivos_agregados++;\n        }\n    });\n\n    if (archivos_agregados === 0) {\n        return;\n    }\n\n    $.ajax({\n        type       : 'POST',\n        url        : '/etapas-vacantes-adjuntar-archivos',\n        data       : datos_form,\n        processData: false,\n        contentType: false\n    }).done((respuesta) => {\n        mostrarToast('success', respuesta.message);\n        $('#etapa_vacante_id_prueba').val('');\n        archivos_preguntas = [];\n        renderizarArchivos();\n    }).fail((error) => {\n        let mensaje = error.responseJSON?.message || 'Ocurrió un error al adjuntar los archivos';\n        mostrarToast('danger', mensaje);\n    });\n}\n\n/**\n * Validar las condiciones adicionales del formulario.\n *\n * @param {FormData} formulario Datos del formulario.\n * @returns {Promise<Array>}\n * @author Andres Gonzalez\n */\nfunction validacionAdicional(formulario) {\n    if (formulario == \"form-editar-plantilla-etapa\") {\n        if (!buscarFuncionalidad('plantillas_personalizadas')) {\n            modalFuncionalidadInactiva();\n            return false;\n        }\n    }\n\n    return true;\n}\n","numLines":1037,"startLine":1,"totalLines":1037}},"sourceToolAssistantUUID":"9c0013da-9212-4ce7-b7d1-06d0181cfb61"}
{"parentUuid":"d5878dea-8092-4e83-9f0a-a310ee9ba56c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Sm7Wdu9uYQKSNuzbDuGiu6","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que en la función `automatizacionEtapas`, cuando entre en el if de \"buscarFuncionalidad('automatizacion_etapas')\" y no encuentre la funcionalidad (línea 730), el toggle quede desmarcado aunque se le dé click.\n\nVeo la función en las líneas 729-739:\n\n```javascript\nfunction automatizacionEtapas(elemento) {\n    if (!buscarFuncionalidad('automatizacion_etapas')) {\n        modalFuncionalidadInactiva();\n        $('#campo_automatizar_etapas').val(0);\n        return;\n    }\n\n    let valor = elemento ? 1 : 0;\n    $('#automatizar_etapas').val(valor);\n    $('#formulario-vacantes-paso-1').submit();\n}\n```\n\nCuando entra en el if `!buscarFuncionalidad('automatizacion_etapas')`, significa que la funcionalidad no está activa. En ese caso:\n1. Muestra un modal de funcionalidad inactiva\n2. Establece el valor del campo `#campo_automatizar_etapas` en 0\n3. Retorna\n\nEl usuario quiere que el toggle quede desmarcado. El toggle probablemente es el elemento que se pasa como parámetro a la función.\n\nPara desmarcar un toggle, necesitamos:\n1. Desmarcar el checkbox subyacente\n2. Posiblemente actualizar el elemento visualmente\n\nNecesito entender cómo es el toggle. Basándome en el código que vi, los toggles se crean con `crearToggle()` y son checkboxes. Para desmarcarlo, necesitaría hacer algo como `$(elemento).prop('checked', false)`.\n\nSin embargo, el parámetro `elemento` parece ser el valor booleano del estado del toggle (true/false), no el elemento HTML en sí. \n\nNecesito identificar cuál es el toggle específico que el usuario menciona. Debo buscar dónde se invoca `automatizacionEtapas()` en el archivo para determinar exactamente cuál elemento es el toggle y cómo acceder a él.","signature":"EocPCkYICxgCKkBcAZLmfwLzJ7hCeLaNE29HS8ZdutnWb1035yobGmM6dBGEMwPD43aUbKnmqKAfKwHjtUXG7O8A8mZNw1tfqF71EgwSycUAMychHY6vwoAaDNqdvAdE1h19Zlr5UCIwlGlJ6yVMsIuBhedjJ5btyP1ngDyZk5AP7ZgLYmb0O8r0qvHHrHns7scw1/9cxoH8Ku4NU5oBLEkOJt9jwdWYFStDUjtytxfTkG0fZNCoHHalKaEydOIivx48Ml5zclWlfhDIeKQ3pVmRivy+y+5CstsuJ28SCRtSADwLvHcaW+P1TkPO6u5OOh+cucJ2MLzfIZ5xq4RsuYQ0Pqu9iHLu/d6LpQe2YegPmKjHxFol0oPHK+ObRVjj6Dctl8Kd1yn4uMrKvPIp432dYMccHjGJp2ntbAHMVjW32Kn1PCKpddXimvlKnl2+WB0qT+t5sKibohN8gp9yjqqVOMqRFL89xrCW+guBErF9I0C7ZQeO4unUnl9spLUPqdTYQmb3+CftQH76TB9RgzzZeEDrsG2bcooy0c2AnGfGz1qKiJIumDqvnnxPrPpxWnYSM5s5kfcoybm9neiawyyrlpy3qESs63L5UrZY71p2tOPbYuEsESjgSj32XYv+Vqd6HF7hQqIXw1/y/bBDoYQtL1/Jidi1BLqIpfxqij+lKLtFwgxHLKGVcJE/Vi7CZdxkZO7O+5BIFJpSYCvSa9vtR0A1cL802wuv7rY2Nxi6alnWjl2Ab2Av0SvK4Le5tcOPzGSsWyrTKZV6D83QLLSd+hEAuTMyjNdwsXVkFvb1uxaaFivHbrkVtf78RU1QvaeNOwEVTMeQzwdr85Z7KR8sGwFXjLKRuB7zsnRU8aD3K39dcnzJASkxmvQj1DK74/AkOrU5kSjCobGHpVz/peBYRHwi2lP5DiGMgCyYVVxA/1szme+F2MKY95eZh/P3aDiC8pJ/bpj1c05JzDv4MdrBW4stUp+o9eHq1t4y0l8ZYjTOe4EWvqBsGjxJ0B7XkCWd2d9u5PWhIV5H/KZ/l0nkgup2sv+JfGmRJkWwfPFtRoVaL9i/fGfbyzG4zha8jOESqOOhLJDk/BZwPCBYVkwrAHT/4WJt5e8a598XFsfO/dXGAcygtbMYT6QqSd0ViQesto4icjWbWnE3laDhsXSn0b09u6JK/ZqSdAuQi9g4D0qjD2YspilgE1cNhH0E3p/a+yizmfB0P6NIjdCULK4FlW+gTE7WzKqwqu19/dZxnYH5XsOMj1IEgGL2pUjh7L1fv0tOw9MZcDE/XXxrWPPjVSoR0gsWRR8LluNqx0BR+tTvGU9uGdLWRbSqXGQPaBW5x1fmRei35PPufxKRcWh98zhsyQkNakjsgy5rBvKXNQ4rZxCZ5OXseS0ZixKZ6LsBst6A7wCG6GGhtKXHoDeApgH5x8BO59FsocxzFat0nAIFzR1Qn/jgkd1dyvXjaelXbncRHPI9XP6o/o76516g6A3ozuv6QPpts0A2YgxDD8R1Fc7XIORZt9PyuqFiNUP6RV8mxS7Ah/5AEx66rrKTUHwethCT7GiiM56dIzO1din5oHY7nUWvICKrAEo7LWQuYbrVoGcZozqg1jHhvs9xaj+UkqAuD3+1fYwjla+KMnQa0UvBdgD0SRtPbp7MtT50HytQyYDrrs2nlrSz0VVNDgYfgXcmcn4s6AnAyElPeJaF6kBCUJ/FvdfWw9QdxBeboJVZsgSj+s4zRsjxlJkDFTY1AltM7yCIoBfbIh88jimM5BwBGu2QF63aap1jzk3dOH4GB2cbDVujsFez/PceS3KfqHOEVVIFnAnb0EIktvb9bou5aQRsfZdkuLHzCLDTMlcu3PAnaQ5jAHbWQPmuXoaNg/yKkNt+YcGVIaGVvijKN9DgeoAEAhkTe8yf5YZVN1Ab+C9hqGBRBEWDSerRJHIkBHXBJtDsq3+tY0fBL6Ql4eRCIEpRFYlNIhgIX37WNN0Zzo69IZ85kwJsWuIr+mdMp2yY5+1bQ4evoTOtiAbMRoutc+Bt4hyqBo+pBxn7q5RPkJtwfadhzKyDaKh7wGGHtyMw8hqrQblbG1WtqDs7mrtzk03IOK05n0mWHw9zzhcN0g8n4+/kvHrmM62Lno//ERBg5a0vjWvdlUkO2ifv/i6XcNfmC7zC6Q3e82S+Bf1y0MlTkz2q4bvgH9GUQbAHnargLKPiIm6XGqdVR3DzrN5NsWGUl7cbw++fI6hjjxAhoUEvI4xWxppQ6lee7i+Q8wsurkvzIcyvbU8O73m1EtiGIuMbygONyMGV4DU6p9TvsRR82QpF8/trDnq2StyroROXp8VAKdP3US/QgmNT9GyFH2dIcnPr4UistvbHQXdNnZmNu3qW5njEZDrExjy1M65dwUXinlwj7xfbKgH9kT6y58E0jP46I1W27pdFAr/1P0eA92WfPA1/z52qme8I3+ixGfS+XQVr95uRNyQi680RmAoID8m70VVbXtXcECQRpZ9fzJJ2bLlo/0KkvegpAn+18i3r3rZYs4yaoNMDYXt8pauic+aeEmq/3ppZlFUeouObixgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":15524,"cache_read_input_tokens":25106,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":15524},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXZqMXKGNxkwBgkKopE6D","type":"assistant","uuid":"40773d33-3c3d-4cf5-b6a4-de4f19392f4e","timestamp":"2026-01-28T13:13:05.015Z"}
{"parentUuid":"40773d33-3c3d-4cf5-b6a4-de4f19392f4e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Sm7Wdu9uYQKSNuzbDuGiu6","type":"message","role":"assistant","content":[{"type":"text","text":"Veo la función `automatizacionEtapas`. Necesito buscar dónde se llama esta función para encontrar el toggle específico. Déjame buscar en el archivo de la vista del paso 1 donde probablemente esté el toggle."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":15524,"cache_read_input_tokens":25106,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":15524},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXZqMXKGNxkwBgkKopE6D","type":"assistant","uuid":"c578a87d-9015-4a48-bfd1-d27a66e807dc","timestamp":"2026-01-28T13:13:05.876Z"}
{"parentUuid":"c578a87d-9015-4a48-bfd1-d27a66e807dc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Sm7Wdu9uYQKSNuzbDuGiu6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Q8HY6VCaeL2X8WqZzKhbas","name":"Glob","input":{"pattern":"**/vacantes-paso-1.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":15524,"cache_read_input_tokens":25106,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":15524},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXZqMXKGNxkwBgkKopE6D","type":"assistant","uuid":"2213270a-686c-407a-9ff3-82eae4de265b","timestamp":"2026-01-28T13:13:06.702Z"}
{"parentUuid":"2213270a-686c-407a-9ff3-82eae4de265b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Sm7Wdu9uYQKSNuzbDuGiu6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DSFuoW11kHkanFnsfZfrjj","name":"Grep","input":{"pattern":"automatizacionEtapas|automatizar_etapas","output_mode":"files_with_matches"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":15524,"cache_read_input_tokens":25106,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":15524},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXZqMXKGNxkwBgkKopE6D","type":"assistant","uuid":"9dd125ce-978d-4f7f-844d-728fd066f46e","timestamp":"2026-01-28T13:13:07.420Z"}
{"parentUuid":"2213270a-686c-407a-9ff3-82eae4de265b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Q8HY6VCaeL2X8WqZzKhbas","type":"tool_result","content":"No files found"}]},"uuid":"d3f44bff-fef5-4f5b-9b29-c827a3805c3e","timestamp":"2026-01-28T13:13:14.160Z","toolUseResult":{"filenames":[],"durationMs":4115,"numFiles":0,"truncated":false},"sourceToolAssistantUUID":"2213270a-686c-407a-9ff3-82eae4de265b"}
{"parentUuid":"9dd125ce-978d-4f7f-844d-728fd066f46e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DSFuoW11kHkanFnsfZfrjj","type":"tool_result","content":"Found 10 files\npublic\\js\\vacantes\\vacantes-paso-2.js\napp\\Http\\Services\\Vacantes\\VacanteService.php\napp\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php\nresources\\views\\vacantes\\paginas\\formularios\\formulario-etapas.blade.php\nresources\\views\\vacantes\\paginas\\formularios\\formulario-informacion.blade.php\npublic\\js\\vacantes\\crear-editar-vacantes.js\napp\\Http\\Repositories\\Vacantes\\EtapaVacanteUsuarioRepository.php\napp\\Http\\Repositories\\Vacantes\\VacanteRepository.php\napp\\Models\\Vacantes\\Vacante.php\ndatabase\\migrations\\2025_10_28_085240_add_automatizar_etapas_to_vacantes_table.php"}]},"uuid":"d7c1bf59-3c27-4dcd-964a-68cec83bfb81","timestamp":"2026-01-28T13:13:25.705Z","toolUseResult":{"mode":"files_with_matches","filenames":["public\\js\\vacantes\\vacantes-paso-2.js","app\\Http\\Services\\Vacantes\\VacanteService.php","app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","resources\\views\\vacantes\\paginas\\formularios\\formulario-etapas.blade.php","resources\\views\\vacantes\\paginas\\formularios\\formulario-informacion.blade.php","public\\js\\vacantes\\crear-editar-vacantes.js","app\\Http\\Repositories\\Vacantes\\EtapaVacanteUsuarioRepository.php","app\\Http\\Repositories\\Vacantes\\VacanteRepository.php","app\\Models\\Vacantes\\Vacante.php","database\\migrations\\2025_10_28_085240_add_automatizar_etapas_to_vacantes_table.php"],"numFiles":10},"sourceToolAssistantUUID":"9dd125ce-978d-4f7f-844d-728fd066f46e"}
{"parentUuid":"d7c1bf59-3c27-4dcd-964a-68cec83bfb81","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01TTDzVVVpeSWy63KXQd1Hz4","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Necesito ver el formulario de información donde probablemente esté el toggle que llama a `automatizacionEtapas`.","signature":"EpsCCkYICxgCKkBIexD3aiJHm7+1hzX3KU8okzNtVPegw+Rog2OEbt48RTgW9kF4I6ZY/FmPggnTS9mRjOF2lQ5w418LH06/p0YEEgxRhxcD6TZ0IEnIoKcaDIPxbeJ9WhSTfdo62CIwUWNbG8p3HOb8K1jCTnhQkk+yp6zjJKQLMcVIAxvWWnL0VbYgIYYdeNwYzg2Zih1EKoIBHlEfmZUWyqo5yqiJWkNKLpYb01FYqc3eOx5qO4VnTRPh8Fkh8mKfExMYNmMkQeyJhf8Bxe9xcUimXt4eXKxR8Eq1wMWmfyQSYHnOmGmIlEY+0WMb01ibFbLt7wjoTJvX4E6M5QM2ByXRG77fjZeMe+82/w2hbMzvthuivo4KQ+Tu8RgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":14,"cache_creation_input_tokens":1037,"cache_read_input_tokens":40630,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1037},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXZqQ7bqKpyJ8HcdiFa53","type":"assistant","uuid":"e671899a-619f-4987-88e8-712566779a9e","timestamp":"2026-01-28T13:13:28.415Z"}
{"parentUuid":"e671899a-619f-4987-88e8-712566779a9e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01TTDzVVVpeSWy63KXQd1Hz4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VYZnbR2rfVczsBQzqJrmyr","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\formulario-informacion.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":14,"cache_creation_input_tokens":1037,"cache_read_input_tokens":40630,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1037},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXZqQ7bqKpyJ8HcdiFa53","type":"assistant","uuid":"af548a84-5733-4250-80d8-17238508d46e","timestamp":"2026-01-28T13:13:29.167Z"}
{"parentUuid":"af548a84-5733-4250-80d8-17238508d46e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VYZnbR2rfVczsBQzqJrmyr","type":"tool_result","content":"     1→<div class=\"col-12 px-xl-5\">\n     2→    <form id=\"formulario-vacantes-paso-1\" class=\"formularios-pasos\" action=\"/vacantes\" data-activar-siguiente=\"true\">\n     3→        @csrf\n     4→        <input type=\"hidden\" id=\"id\" name=\"id\" value=\"{{ isset($vacante) ? $vacante->id : '' }}\">\n     5→        <input type=\"hidden\" id=\"estado_id\" name=\"estado_id\" value=\"4\">\n     6→        <input type=\"hidden\" id=\"informacion\" name=\"informacion\" value=\"\">\n     7→        <input type=\"hidden\" id=\"requisitos\" name=\"requisitos\" value=\"\">\n     8→        <input type=\"hidden\" id=\"automatizar_etapas\" name=\"automatizar_etapas\" value=\"\">\n     9→        <div class=\"row mt-5 mb-4\">\n    10→            <div class=\"col-12\">\n    11→                <div class=\"d-flex justify-content-between align-items-center\">\n    12→                    <div class=\"col-auto mb-1 fw-semibold text-dark text-headline-5\">Información de la vacante</div>\n    13→                    <div class=\"col-auto\">\n    14→                        ${crearBoton({\n    15→                            clases: 'btn-yellow-ia',\n    16→                            texto: '<img class=\"me-3\" src=\"{{ asset('/iconos/icono_ia.svg') }}\"> Generar mediante IA',\n    17→                            adicional: `data-bs-toggle=\"modal\" data-bs-target=\"#modal-vacante-ia\"`\n    18→                        })}\n    19→                    </div>\n    20→                </div>\n    21→                <p class=\"my-3 text-body-3 text-gray-30\">Esta vacante es para un proceso interno, por lo que únicamente se solicita información básica.</p>\n    22→            </div>\n    23→        </div>\n    24→        <div class=\"row\">\n    25→            <div class=\"col-12 col-md-6\">\n    26→                ${crearInput({\n    27→                    id: 'nombre_vacante',\n    28→                    name: 'nombre_vacante',\n    29→                    type: 'text',\n    30→                    label: 'Nombre de la vacante',\n    31→                    placeholder: '',\n    32→                    required: true,\n    33→                    maxlength: 120,\n    34→                    value: '{{ isset($vacante) ? $vacante->nombre_vacante : \"\" }}'\n    35→                })}\n    36→            </div>\n    37→            <div class=\"col-12 col-md-6\">\n    38→                ${crearInput({\n    39→                    id: 'cantidad_vacantes',\n    40→                    name: 'cantidad_vacantes',\n    41→                    type: 'number',\n    42→                    label: 'Cantidad de vacantes',\n    43→                    placeholder: '',\n    44→                    required: true,\n    45→                    min: 1,\n    46→                    max: 10000,\n    47→                    value: '{{ isset($vacante) ? $vacante->cantidad_vacantes : \"\" }}'\n    48→                })}\n    49→            </div>\n    50→        </div>\n    51→        <div class=\"row\">\n    52→            <div class=\"col-12 mb-3 fw-semibold text-headline-5\">Funciones y responsabilidades</div>\n    53→            <div class=\"col-12 mb-2\">\n    54→                ${crearTextarea({\n    55→                    id: 'funciones',\n    56→                    name: 'funciones',\n    57→                    class: 'input-dinamico',\n    58→                    placeholder: '',\n    59→                    disabled: false,\n    60→                    required: true,\n    61→                    label: 'Describe funciones y responsabilidades',\n    62→                    contador: 500,\n    63→                })}\n    64→            </div>\n    65→        </div>\n    66→        <div class=\"row mt-5\">\n    67→            <div class=\"col-12\">\n    68→                <div class=\"card shadow-sm\">\n    69→                    <div class=\"card-body\">\n    70→                        <div class=\"text-headline-6 text-gray-10 fw-semibold\">Modalidad de trabajo</div>\n    71→                        <div class=\"row mt-2\">\n    72→                            @foreach ($modalidades_trabajos as $item)\n    73→                                <div class=\"col-auto\">\n    74→                                    ${crearRadioButton({\n    75→                                        id: 'modalidad_trabajo_id_{{ $item->id }}',\n    76→                                        name: 'modalidad_trabajo_id',\n    77→                                        value: '{{ $item->id }}',\n    78→                                        label: '{{ $item->nombre }}',\n    79→                                        @if (isset($vacante))\n    80→                                            @if ($vacante->modalidad_trabajo_id == $item->id)\n    81→                                                checked: true,\n    82→                                            @endif\n    83→                                        @else\n    84→                                            @if ($item->id == 1)\n    85→                                                checked: true,\n    86→                                            @endif\n    87→                                        @endif\n    88→                                    })}\n    89→                                </div>\n    90→                            @endforeach\n    91→                        </div>\n    92→                    </div>\n    93→                </div>\n    94→            </div>\n    95→        </div>\n    96→        <div class=\"row mt-5\">\n    97→            <div class=\"col-12\">\n    98→                <div class=\"card shadow-sm\">\n    99→                    <div class=\"card-body\">\n   100→                        <div class=\"row\">\n   101→                            <div class=\"col-12\">\n   102→                                <label class=\"form-label fw-semibold text-gray-10\">Lugar de trabajo</label>\n   103→                            </div>\n   104→                            <div class=\"col-auto\">\n   105→                                ${crearRadioButton({\n   106→                                    id: 'lugar_trabajo_actual',\n   107→                                    name: 'lugar_trabajo',\n   108→                                    value: 'actual',\n   109→                                    label: 'Actual de la empresa',\n   110→                                    checked: true,\n   111→                                })}\n   112→                            </div>\n   113→                            <div class=\"col-auto\">\n   114→                                ${crearRadioButton({\n   115→                                    id: 'lugar_trabajo_otro',\n   116→                                    name: 'lugar_trabajo',\n   117→                                    value: 'otro',\n   118→                                    label: 'Otro',\n   119→                                })}\n   120→                            </div>\n   121→                        </div>\n   122→                        <div class=\"d-none\" id=\"contenedor_ubicacion_personalizada\">\n   123→                            <div class=\"row mt-3\">\n   124→                                <div class=\"col-12 col-md-6\">\n   125→                                ${crearSelect2({\n   126→                                    id: 'pais_id',\n   127→                                    name: 'pais_id',\n   128→                                    class: 'pais_id',\n   129→                                    label: 'País',\n   130→                                    opciones: [],\n   131→                                    required: true,\n   132→                                    adicional: 'data-html_departamento_id=\"departamento_id\" data-html_ciudad_id=\"ciudad_id\"'\n   133→                                })}\n   134→                            </div>\n   135→                            <div class=\"col-12 col-md-6\">\n   136→                                    ${crearSelect2({\n   137→                                    id: 'departamento_id',\n   138→                                    name: 'departamento_id',\n   139→                                    class: 'departamento_id',\n   140→                                    label: 'Departamento',\n   141→                                    opciones: [],\n   142→                                    required: true,\n   143→                                    adicional: 'data-html_pais_id=\"pais_id\" data-html_ciudad_id=\"ciudad_id\"'\n   144→                                })}\n   145→                            </div>\n   146→                        </div>\n   147→                            <div class=\"row\">\n   148→                                <div class=\"col-12 col-md-6\">\n   149→                                    ${crearSelect2({\n   150→                                    id: 'ciudad_id',\n   151→                                    name: 'ciudad_id',\n   152→                                    class: 'ciudad_id',\n   153→                                    label: 'Ciudad',\n   154→                                    opciones: [],\n   155→                                    required: true,\n   156→                                })}\n   157→                            </div>\n   158→                            <div class=\"col-12 col-md-6\">\n   159→                                ${crearInput({\n   160→                                        id: 'direccion_trabajo',\n   161→                                        name: 'direccion_trabajo',\n   162→                                    type: 'text',\n   163→                                    label: 'Dirección',\n   164→                                    placeholder: '',\n   165→                                    maxlength: 255,\n   166→                                    required: true\n   167→                                })}\n   168→                            </div>\n   169→                        </div>\n   170→                    </div>\n   171→                </div>\n   172→                </div>\n   173→            </div>\n   174→        </div>\n   175→        <div class=\"row mt-5\">\n   176→            <div class=\"col-12\">\n   177→                <div class=\"card shadow-sm\">\n   178→                    <div class=\"card-body\">\n   179→                        <div class=\"row\">\n   180→                            <div class=\"col-12\">\n   181→                                <label class=\"form-label fw-semibold text-gray-10\">Salario</label>\n   182→                            </div>\n   183→                            <div class=\"col-auto\">\n   184→                                ${crearRadioButton({\n   185→                                    id: 'salario_especifico',\n   186→                                    name: 'tipo_salario',\n   187→                                    value: 'especifico',\n   188→                                    label: 'Específico',\n   189→                                    checked: false,\n   190→                                })}\n   191→                            </div>\n   192→                            <div class=\"col-auto\">\n   193→                                ${crearRadioButton({\n   194→                                    id: 'salario_a_convenir',\n   195→                                    name: 'tipo_salario',\n   196→                                    value: 'a_convenir',\n   197→                                    label: 'A convenir',\n   198→                                    checked: true,\n   199→                                })}\n   200→                            </div>\n   201→                        </div>\n   202→                        <div class=\"d-none\" id=\"contenedor_salario_especifico\">\n   203→                            <div class=\"row mt-3\">\n   204→                                <div class=\"col-12 col-md-6\">\n   205→                                    ${crearInput({\n   206→                                        id: 'salario_cantidad',\n   207→                                        name: 'salario_especifico',\n   208→                                        class: 'cleave',\n   209→                                        label: 'Cantidad',\n   210→                                        placeholder: '',\n   211→                                        min: 0,\n   212→                                        step: 0.01,\n   213→                                        required: true,\n   214→                                        minlength: 3,\n   215→                                        maxlength: 10,\n   216→                                        data: [{\n   217→                                            texto: 'simbolo-cleave',\n   218→                                            value: ''\n   219→                                        }],\n   220→                                        icono: '<i class=\"bi bi-currency-dollar input-icono1\"></i>',\n   221→                                    })}\n   222→                                </div>\n   223→                            </div>\n   224→                        </div>\n   225→                        <div id=\"contenedor_salario_rango\">\n   226→                            <div class=\"row mt-3\">\n   227→                                <div class=\"col-12 col-md-6\">\n   228→                                    ${crearInput({\n   229→                                        id: 'salario_desde',\n   230→                                        name: 'salario',\n   231→                                        class: 'cleave',\n   232→                                        label: 'Desde',\n   233→                                        placeholder: '',\n   234→                                        step: 0.01,\n   235→                                        required: true,\n   236→                                        minlength: 3,\n   237→                                        maxlength: 10,\n   238→                                        onchange: `validarRangoSalario()`,\n   239→                                        value: '{{ isset($vacante) ? $vacante->salario : \"\" }}',\n   240→                                        data: [{\n   241→                                            texto: 'simbolo-cleave',\n   242→                                            value: ''\n   243→                                        }],\n   244→                                        icono: '<i class=\"bi bi-currency-dollar input-icono1\"></i>',\n   245→                                    })}\n   246→                                </div>\n   247→                                <div class=\"col-12 col-md-6\">\n   248→                                    ${crearInput({\n   249→                                        id: 'salario_hasta',\n   250→                                        name: 'salario_maximo',\n   251→                                        class: 'cleave',\n   252→                                        label: 'Hasta',\n   253→                                        placeholder: '',\n   254→                                        min: 0,\n   255→                                        step: 0.01,\n   256→                                        required: true,\n   257→                                        minlength: 3,\n   258→                                        maxlength: 10,\n   259→                                        onchange: `validarRangoSalario()`,\n   260→                                        value: '{{ isset($vacante) ? $vacante->salario_maximo : \"\" }}',\n   261→                                        data: [{\n   262→                                            texto: 'simbolo-cleave',\n   263→                                            value: ''\n   264→                                        }],\n   265→                                        icono: '<i class=\"bi bi-currency-dollar input-icono1\"></i>',\n   266→                                    })}\n   267→                                </div>\n   268→                            </div>\n   269→                        </div>\n   270→                    </div>\n   271→                </div>\n   272→            </div>\n   273→        </div>\n   274→        <div class=\"row mt-5\">\n   275→            <div class=\"col-12\">\n   276→                <div class=\"d-flex align-items-center gap-2 mb-1\">\n   277→                    <label for=\"habilidades\" class=\"text-headline-5 fw-bold mb-0\">Habilidades</label>\n   278→                    <i class=\"bi bi-info-circle pointer\" role=\"button\" tabindex=\"0\"\n   279→                        ${crearTooltip({\n   280→                            placement: 'top',\n   281→                            content: 'Especifica las habilidades esenciales para el rol, tanto técnicas como personales.'\n   282→                        })}></i>\n   283→                </div>\n   284→                <p class=\"text-body-3 text-gray-30 mb-3\">Añade tus habilidades o herramientas escribiéndolas y presionando enter para crear la etiqueta.</p>\n   285→                ${crearSelectAsincronoChips({\n   286→                    id: 'habilidades',\n   287→                    name: 'habilidades',\n   288→                    class: 'crear-chips',\n   289→                    url: 'vacantes-habilidades-herramientas',\n   290→                    campo_datos: 'habilidades',\n   291→                    required: true,\n   292→                    adicional: 'data-placeholder=\"Escribe y presiona Enter\"'\n   293→                })}\n   294→            </div>\n   295→        </div>\n   296→        <div class=\"row mt-4\">\n   297→            <div class=\"col-12\">\n   298→                <div class=\"d-flex align-items-center gap-2 mb-1\">\n   299→                    <label for=\"herramientas_tecnologicas\" class=\"text-headline-5 fw-bold mb-0\">Herramientas tecnológicas</label>\n   300→                    <i class=\"bi bi-info-circle pointer\" role=\"button\" tabindex=\"0\"\n   301→                        ${crearTooltip({\n   302→                            placement: 'top',\n   303→                            content: 'Menciona los programas, plataformas o lenguajes que se usarán en el puesto.'\n   304→                        })}></i>\n   305→                </div>\n   306→                ${crearSelectAsincronoChips({\n   307→                    id: 'herramientas_tecnologicas',\n   308→                    name: 'herramientas_tecnologicas',\n   309→                    url: 'vacantes-habilidades-herramientas',\n   310→                    campo_datos: 'herramientas_tecnologicas',\n   311→                    class: 'clase-personalizada',\n   312→                    required: false,\n   313→                    adicional: 'data-placeholder=\"Escribe y presiona Enter\"'\n   314→                })}\n   315→            </div>\n   316→        </div>\n   317→        <div class=\"row mt-5\">\n   318→            <div class=\"col-12 mb-3\">\n   319→                <h6 class=\"text-headline-5 fw-bold\">Requisitos del candidato</h6>\n   320→            </div>\n   321→        </div>\n   322→        <div class=\"row mt-3\">\n   323→            <div class=\"col-12\">\n   324→                <div class=\"card shadow-sm\">\n   325→                    <div class=\"card-body\">\n   326→                        <div class=\"row\">\n   327→                            <div class=\"col-12\">\n   328→                                <label class=\"form-label fw-semibold text-gray-10\">Género</label>\n   329→                            </div>\n   330→                            <div class=\"col-auto\">\n   331→                                ${crearRadioButton({\n   332→                                    id: 'genero_masculino',\n   333→                                    name: 'genero',\n   334→                                    value: 'masculino',\n   335→                                    label: 'Masculino',\n   336→                                    checked: false\n   337→                                })}\n   338→                            </div>\n   339→                            <div class=\"col-auto\">\n   340→                                ${crearRadioButton({\n   341→                                    id: 'genero_femenino',\n   342→                                    name: 'genero',\n   343→                                    value: 'femenino',\n   344→                                    label: 'Femenino',\n   345→                                    checked: false\n   346→                                })}\n   347→                            </div>\n   348→                            <div class=\"col-auto\">\n   349→                                ${crearRadioButton({\n   350→                                    id: 'genero_indiferente',\n   351→                                    name: 'genero',\n   352→                                    value: 'indiferente',\n   353→                                    label: 'Indiferente',\n   354→                                    checked: true\n   355→                                })}\n   356→                            </div>\n   357→                        </div>\n   358→                    </div>\n   359→                </div>\n   360→            </div>\n   361→        </div>\n   362→        <div class=\"row mt-4\">\n   363→            <div class=\"col-12\">\n   364→                <div class=\"card shadow-sm\">\n   365→                    <div class=\"card-body\">\n   366→                        <div class=\"row\">\n   367→                            <div class=\"col-12\">\n   368→                                <label class=\"form-label fw-semibold text-gray-10\">Edad</label>\n   369→                            </div>\n   370→                            <div class=\"col-auto\">\n   371→                                ${crearRadioButton({\n   372→                                    id: 'edad_rango',\n   373→                                    name: 'tipo_edad',\n   374→                                    value: 'rango',\n   375→                                    label: 'Rango',\n   376→                                    checked: false,\n   377→                                })}\n   378→                            </div>\n   379→                            <div class=\"col-auto\">\n   380→                                ${crearRadioButton({\n   381→                                    id: 'edad_indiferente',\n   382→                                    name: 'tipo_edad',\n   383→                                    value: 'indiferente',\n   384→                                    label: 'Indiferente',\n   385→                                    checked: true,\n   386→                                })}\n   387→                            </div>\n   388→                        </div>\n   389→                        <div class=\"row mt-3 d-none\" id=\"contenedor_edad_rango\">\n   390→                            <div class=\"col-12 col-md-6\">\n   391→                                ${crearInput({\n   392→                                    id: 'edad_desde',\n   393→                                    name: 'edad_desde',\n   394→                                    type: 'number',\n   395→                                    label: 'Edad desde',\n   396→                                    placeholder: '',\n   397→                                    max: 99,\n   398→                                    required: true\n   399→                                })}\n   400→                            </div>\n   401→                            <div class=\"col-12 col-md-6\">\n   402→                                ${crearInput({\n   403→                                    id: 'edad_hasta',\n   404→                                    name: 'edad_hasta',\n   405→                                    type: 'number',\n   406→                                    label: 'Edad hasta',\n   407→                                    placeholder: '',\n   408→                                    max: 99,\n   409→                                    required: true\n   410→                                })}\n   411→                            </div>\n   412→                        </div>\n   413→                    </div>\n   414→                </div>\n   415→            </div>\n   416→        </div>\n   417→        <div class=\"row mt-4\">\n   418→            <div class=\"col-12\">\n   419→                <h6 class=\"text-headline-5 fw-bold mb-1\">Experiencia y nivel educativo</h6>\n   420→                <p class=\"text-body-3 text-gray-30 mb-4\">Selecciona el nivel de educación y experiencia laboral que requieres que tu candidato haya alcanzado.</p>\n   421→            </div>\n   422→            <div class=\"col-12 col-md-6 mb-3 mb-md-0\">\n   423→                ${crearSelect2({\n   424→                    id: 'experiencia_laboral',\n   425→                    name: 'experiencia_laboral',\n   426→                    label: 'Experiencia laboral',\n   427→                    placeholder: 'Experiencia laboral',\n   428→                    required: true,\n   429→                    opciones: [\n   430→                        {id: 'Sin experiencia', nombre: 'Sin experiencia'},\n   431→                        {id: 'Menos de 1 año', nombre: 'Menos de 1 año'},\n   432→                        {id: '1 año', nombre: '1 año'},\n   433→                        {id: '2 años', nombre: '2 años'},\n   434→                        {id: '3 años', nombre: '3 años'},\n   435→                        {id: '4 años', nombre: '4 años'},\n   436→                        {id: '5 años o más', nombre: '5 años o más'}\n   437→                    ],\n   438→                    buscador: false\n   439→                })}\n   440→            </div>\n   441→            <div class=\"col-12 col-md-6\">\n   442→                ${crearSelect2({\n   443→                    id: 'nivel_educativo_vacante',\n   444→                    name: 'nivel_educativo_vacante',\n   445→                    label: 'Nivel educativo',\n   446→                    placeholder: 'Nivel educativo',\n   447→                    required: true,\n   448→                    opciones: [\n   449→                        {id: 'indiferente', nombre: 'Indiferente'},\n   450→                        @foreach($niveles_educativos as $nivel)\n   451→                            {id: '{{ $nivel->nombre }}', nombre: '{{ $nivel->nombre }}'},\n   452→                        @endforeach\n   453→                    ],\n   454→                    buscador: false\n   455→                })}\n   456→            </div>\n   457→        </div>\n   458→        <div class=\"row mt-4\">\n   459→            <div class=\"col-12\">\n   460→                <div class=\"card shadow-sm\">\n   461→                    <div class=\"card-body\">\n   462→                        <h6 class=\"text-headline-5 fw-bold mb-1\">Requisitos adicionales (Opcional)</h6>\n   463→                        <div class=\"row\">\n   464→                            <div class=\"col-12 mt-4\">\n   465→                                ${crearMultiselect({\n   466→                                    opciones: [\n   467→                                        {'id': 1, 'nombre': 'Inglés'},\n   468→                                        {'id': 2, 'nombre': 'Portugués'},\n   469→                                        {'id': 3, 'nombre': 'Francés'},\n   470→                                        {'id': 4, 'nombre': 'Alemán'},\n   471→                                        {'id': 5, 'nombre': 'Mandarín'},\n   472→                                        {'id': 6, 'nombre': 'Italiano'},\n   473→                                        {'id': 7, 'nombre': 'Ruso'},\n   474→                                        {'id': 8, 'nombre': 'Árabe'},\n   475→                                    ],\n   476→                                    id: 'idiomas_seleccionados',\n   477→                                    name: 'idiomas_seleccionados',\n   478→                                    input_container_class: 'mb-0',\n   479→                                    placeholder: 'Idiomas',\n   480→                                    onchange: 'seleccionarIdioma(this)',\n   481→                                })}\n   482→                            </div>\n   483→                            <div class=\"col-12\">\n   484→                                <div class=\"row mt-2\" id=\"contenedor-idiomas\">\n   485→                                </div>\n   486→                            </div>\n   487→                        </div>\n   488→                    </div>\n   489→                </div>\n   490→            </div>\n   491→        </div>\n   492→        <div class=\"row mt-5\">\n   493→            <div class=\"col-12 mb-3\">\n   494→                <h6 class=\"text-headline-5 fw-bold\">Otros</h6>\n   495→            </div>\n   496→        </div>\n   497→        <div class=\"row mt-4\">\n   498→            <div class=\"col-12\">\n   499→                <div class=\"row align-items-center\">\n   500→                    <div class=\"col-8 col-lg-5 col-xl-4\">\n   501→                        Licencia de conducir\n   502→                    </div>\n   503→                    <div class=\"col-4 col-lg-3\">\n   504→                        ${crearToggle({\n   505→                            id: 'licencia_conducir',\n   506→                            name: 'licencia_conducir',\n   507→                            class: 'input-dinamico',\n   508→                            value: true,\n   509→                            checked: false,\n   510→                            onchange: 'seleccionarLicenciaConducir(this)',\n   511→                        })}\n   512→                    </div>\n   513→                    <div class=\"col-12 col-lg-4 col-xl-5\">\n   514→                        ${crearSelect2({\n   515→                            opciones: [\n   516→                                {id: 'A1', nombre: 'A1'},\n   517→                                {id: 'A2', nombre: 'A2'},\n   518→                                {id: 'B1', nombre: 'B1'},\n   519→                                {id: 'B2', nombre: 'B2'},\n   520→                                {id: 'B3', nombre: 'B3'},\n   521→                                {id: 'C1', nombre: 'C1'},\n   522→                                {id: 'C2', nombre: 'C2'},\n   523→                                {id: 'C3', nombre: 'C3'},\n   524→                            ],\n   525→                            id: 'tipo_licencia',\n   526→                            name: 'tipo_licencia',\n   527→                            class: 'input-dinamico',\n   528→                            input_container_class: 'mb-0',\n   529→                            label: 'Tipo de licencia',\n   530→                            required: true,\n   531→                            disabled: true,\n   532→                        })}\n   533→                    </div>\n   534→                </div>\n   535→            </div>\n   536→            <div class=\"col-8 col-lg-5 col-xl-4 mt-5\">\n   537→                Vacante apta para discapacitados\n   538→            </div>\n   539→            <div class=\"col-4 col-lg-7 col-xl-8 mt-5 mb-5\">\n   540→                ${crearToggle({\n   541→                    id: 'vacante_apta_discapacitados',\n   542→                    name: 'vacante_apta_discapacitados',\n   543→                    class: 'input-dinamico',\n   544→                    value: true,\n   545→                    checked: false\n   546→                })}\n   547→            </div>\n   548→        </div>\n   549→        <div class=\"row\">\n   550→            <div class=\"col-12\">\n   551→                <div class=\"d-flex justify-content-center gap-4 pt-5 mt-5 border-top\">\n   552→                    ${crearBoton({\n   553→                        id: 'btn_cancelar',\n   554→                        clases: 'btn-outline-primary no-visited px-14',\n   555→                        texto: `<span class=\"text-primary\">Cancelar</span>`,\n   556→                        url: '/vacantes',\n   557→                    })}\n   558→                    ${crearBoton({\n   559→                        id: 'boton_siguiente',\n   560→                        clases: 'btn-primary px-13',\n   561→                        texto: 'Siguiente',\n   562→                        type: 'submit'\n   563→                    })}\n   564→                </div>\n   565→            </div>\n   566→        </div>\n   567→    </form>\n   568→</div>\n   569→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c18d6815-ffe7-4531-bca0-e750fa95a0f0","timestamp":"2026-01-28T13:13:30.949Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\formulario-informacion.blade.php","content":"<div class=\"col-12 px-xl-5\">\n    <form id=\"formulario-vacantes-paso-1\" class=\"formularios-pasos\" action=\"/vacantes\" data-activar-siguiente=\"true\">\n        @csrf\n        <input type=\"hidden\" id=\"id\" name=\"id\" value=\"{{ isset($vacante) ? $vacante->id : '' }}\">\n        <input type=\"hidden\" id=\"estado_id\" name=\"estado_id\" value=\"4\">\n        <input type=\"hidden\" id=\"informacion\" name=\"informacion\" value=\"\">\n        <input type=\"hidden\" id=\"requisitos\" name=\"requisitos\" value=\"\">\n        <input type=\"hidden\" id=\"automatizar_etapas\" name=\"automatizar_etapas\" value=\"\">\n        <div class=\"row mt-5 mb-4\">\n            <div class=\"col-12\">\n                <div class=\"d-flex justify-content-between align-items-center\">\n                    <div class=\"col-auto mb-1 fw-semibold text-dark text-headline-5\">Información de la vacante</div>\n                    <div class=\"col-auto\">\n                        ${crearBoton({\n                            clases: 'btn-yellow-ia',\n                            texto: '<img class=\"me-3\" src=\"{{ asset('/iconos/icono_ia.svg') }}\"> Generar mediante IA',\n                            adicional: `data-bs-toggle=\"modal\" data-bs-target=\"#modal-vacante-ia\"`\n                        })}\n                    </div>\n                </div>\n                <p class=\"my-3 text-body-3 text-gray-30\">Esta vacante es para un proceso interno, por lo que únicamente se solicita información básica.</p>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"col-12 col-md-6\">\n                ${crearInput({\n                    id: 'nombre_vacante',\n                    name: 'nombre_vacante',\n                    type: 'text',\n                    label: 'Nombre de la vacante',\n                    placeholder: '',\n                    required: true,\n                    maxlength: 120,\n                    value: '{{ isset($vacante) ? $vacante->nombre_vacante : \"\" }}'\n                })}\n            </div>\n            <div class=\"col-12 col-md-6\">\n                ${crearInput({\n                    id: 'cantidad_vacantes',\n                    name: 'cantidad_vacantes',\n                    type: 'number',\n                    label: 'Cantidad de vacantes',\n                    placeholder: '',\n                    required: true,\n                    min: 1,\n                    max: 10000,\n                    value: '{{ isset($vacante) ? $vacante->cantidad_vacantes : \"\" }}'\n                })}\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"col-12 mb-3 fw-semibold text-headline-5\">Funciones y responsabilidades</div>\n            <div class=\"col-12 mb-2\">\n                ${crearTextarea({\n                    id: 'funciones',\n                    name: 'funciones',\n                    class: 'input-dinamico',\n                    placeholder: '',\n                    disabled: false,\n                    required: true,\n                    label: 'Describe funciones y responsabilidades',\n                    contador: 500,\n                })}\n            </div>\n        </div>\n        <div class=\"row mt-5\">\n            <div class=\"col-12\">\n                <div class=\"card shadow-sm\">\n                    <div class=\"card-body\">\n                        <div class=\"text-headline-6 text-gray-10 fw-semibold\">Modalidad de trabajo</div>\n                        <div class=\"row mt-2\">\n                            @foreach ($modalidades_trabajos as $item)\n                                <div class=\"col-auto\">\n                                    ${crearRadioButton({\n                                        id: 'modalidad_trabajo_id_{{ $item->id }}',\n                                        name: 'modalidad_trabajo_id',\n                                        value: '{{ $item->id }}',\n                                        label: '{{ $item->nombre }}',\n                                        @if (isset($vacante))\n                                            @if ($vacante->modalidad_trabajo_id == $item->id)\n                                                checked: true,\n                                            @endif\n                                        @else\n                                            @if ($item->id == 1)\n                                                checked: true,\n                                            @endif\n                                        @endif\n                                    })}\n                                </div>\n                            @endforeach\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"row mt-5\">\n            <div class=\"col-12\">\n                <div class=\"card shadow-sm\">\n                    <div class=\"card-body\">\n                        <div class=\"row\">\n                            <div class=\"col-12\">\n                                <label class=\"form-label fw-semibold text-gray-10\">Lugar de trabajo</label>\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearRadioButton({\n                                    id: 'lugar_trabajo_actual',\n                                    name: 'lugar_trabajo',\n                                    value: 'actual',\n                                    label: 'Actual de la empresa',\n                                    checked: true,\n                                })}\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearRadioButton({\n                                    id: 'lugar_trabajo_otro',\n                                    name: 'lugar_trabajo',\n                                    value: 'otro',\n                                    label: 'Otro',\n                                })}\n                            </div>\n                        </div>\n                        <div class=\"d-none\" id=\"contenedor_ubicacion_personalizada\">\n                            <div class=\"row mt-3\">\n                                <div class=\"col-12 col-md-6\">\n                                ${crearSelect2({\n                                    id: 'pais_id',\n                                    name: 'pais_id',\n                                    class: 'pais_id',\n                                    label: 'País',\n                                    opciones: [],\n                                    required: true,\n                                    adicional: 'data-html_departamento_id=\"departamento_id\" data-html_ciudad_id=\"ciudad_id\"'\n                                })}\n                            </div>\n                            <div class=\"col-12 col-md-6\">\n                                    ${crearSelect2({\n                                    id: 'departamento_id',\n                                    name: 'departamento_id',\n                                    class: 'departamento_id',\n                                    label: 'Departamento',\n                                    opciones: [],\n                                    required: true,\n                                    adicional: 'data-html_pais_id=\"pais_id\" data-html_ciudad_id=\"ciudad_id\"'\n                                })}\n                            </div>\n                        </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 col-md-6\">\n                                    ${crearSelect2({\n                                    id: 'ciudad_id',\n                                    name: 'ciudad_id',\n                                    class: 'ciudad_id',\n                                    label: 'Ciudad',\n                                    opciones: [],\n                                    required: true,\n                                })}\n                            </div>\n                            <div class=\"col-12 col-md-6\">\n                                ${crearInput({\n                                        id: 'direccion_trabajo',\n                                        name: 'direccion_trabajo',\n                                    type: 'text',\n                                    label: 'Dirección',\n                                    placeholder: '',\n                                    maxlength: 255,\n                                    required: true\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"row mt-5\">\n            <div class=\"col-12\">\n                <div class=\"card shadow-sm\">\n                    <div class=\"card-body\">\n                        <div class=\"row\">\n                            <div class=\"col-12\">\n                                <label class=\"form-label fw-semibold text-gray-10\">Salario</label>\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearRadioButton({\n                                    id: 'salario_especifico',\n                                    name: 'tipo_salario',\n                                    value: 'especifico',\n                                    label: 'Específico',\n                                    checked: false,\n                                })}\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearRadioButton({\n                                    id: 'salario_a_convenir',\n                                    name: 'tipo_salario',\n                                    value: 'a_convenir',\n                                    label: 'A convenir',\n                                    checked: true,\n                                })}\n                            </div>\n                        </div>\n                        <div class=\"d-none\" id=\"contenedor_salario_especifico\">\n                            <div class=\"row mt-3\">\n                                <div class=\"col-12 col-md-6\">\n                                    ${crearInput({\n                                        id: 'salario_cantidad',\n                                        name: 'salario_especifico',\n                                        class: 'cleave',\n                                        label: 'Cantidad',\n                                        placeholder: '',\n                                        min: 0,\n                                        step: 0.01,\n                                        required: true,\n                                        minlength: 3,\n                                        maxlength: 10,\n                                        data: [{\n                                            texto: 'simbolo-cleave',\n                                            value: ''\n                                        }],\n                                        icono: '<i class=\"bi bi-currency-dollar input-icono1\"></i>',\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                        <div id=\"contenedor_salario_rango\">\n                            <div class=\"row mt-3\">\n                                <div class=\"col-12 col-md-6\">\n                                    ${crearInput({\n                                        id: 'salario_desde',\n                                        name: 'salario',\n                                        class: 'cleave',\n                                        label: 'Desde',\n                                        placeholder: '',\n                                        step: 0.01,\n                                        required: true,\n                                        minlength: 3,\n                                        maxlength: 10,\n                                        onchange: `validarRangoSalario()`,\n                                        value: '{{ isset($vacante) ? $vacante->salario : \"\" }}',\n                                        data: [{\n                                            texto: 'simbolo-cleave',\n                                            value: ''\n                                        }],\n                                        icono: '<i class=\"bi bi-currency-dollar input-icono1\"></i>',\n                                    })}\n                                </div>\n                                <div class=\"col-12 col-md-6\">\n                                    ${crearInput({\n                                        id: 'salario_hasta',\n                                        name: 'salario_maximo',\n                                        class: 'cleave',\n                                        label: 'Hasta',\n                                        placeholder: '',\n                                        min: 0,\n                                        step: 0.01,\n                                        required: true,\n                                        minlength: 3,\n                                        maxlength: 10,\n                                        onchange: `validarRangoSalario()`,\n                                        value: '{{ isset($vacante) ? $vacante->salario_maximo : \"\" }}',\n                                        data: [{\n                                            texto: 'simbolo-cleave',\n                                            value: ''\n                                        }],\n                                        icono: '<i class=\"bi bi-currency-dollar input-icono1\"></i>',\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"row mt-5\">\n            <div class=\"col-12\">\n                <div class=\"d-flex align-items-center gap-2 mb-1\">\n                    <label for=\"habilidades\" class=\"text-headline-5 fw-bold mb-0\">Habilidades</label>\n                    <i class=\"bi bi-info-circle pointer\" role=\"button\" tabindex=\"0\"\n                        ${crearTooltip({\n                            placement: 'top',\n                            content: 'Especifica las habilidades esenciales para el rol, tanto técnicas como personales.'\n                        })}></i>\n                </div>\n                <p class=\"text-body-3 text-gray-30 mb-3\">Añade tus habilidades o herramientas escribiéndolas y presionando enter para crear la etiqueta.</p>\n                ${crearSelectAsincronoChips({\n                    id: 'habilidades',\n                    name: 'habilidades',\n                    class: 'crear-chips',\n                    url: 'vacantes-habilidades-herramientas',\n                    campo_datos: 'habilidades',\n                    required: true,\n                    adicional: 'data-placeholder=\"Escribe y presiona Enter\"'\n                })}\n            </div>\n        </div>\n        <div class=\"row mt-4\">\n            <div class=\"col-12\">\n                <div class=\"d-flex align-items-center gap-2 mb-1\">\n                    <label for=\"herramientas_tecnologicas\" class=\"text-headline-5 fw-bold mb-0\">Herramientas tecnológicas</label>\n                    <i class=\"bi bi-info-circle pointer\" role=\"button\" tabindex=\"0\"\n                        ${crearTooltip({\n                            placement: 'top',\n                            content: 'Menciona los programas, plataformas o lenguajes que se usarán en el puesto.'\n                        })}></i>\n                </div>\n                ${crearSelectAsincronoChips({\n                    id: 'herramientas_tecnologicas',\n                    name: 'herramientas_tecnologicas',\n                    url: 'vacantes-habilidades-herramientas',\n                    campo_datos: 'herramientas_tecnologicas',\n                    class: 'clase-personalizada',\n                    required: false,\n                    adicional: 'data-placeholder=\"Escribe y presiona Enter\"'\n                })}\n            </div>\n        </div>\n        <div class=\"row mt-5\">\n            <div class=\"col-12 mb-3\">\n                <h6 class=\"text-headline-5 fw-bold\">Requisitos del candidato</h6>\n            </div>\n        </div>\n        <div class=\"row mt-3\">\n            <div class=\"col-12\">\n                <div class=\"card shadow-sm\">\n                    <div class=\"card-body\">\n                        <div class=\"row\">\n                            <div class=\"col-12\">\n                                <label class=\"form-label fw-semibold text-gray-10\">Género</label>\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearRadioButton({\n                                    id: 'genero_masculino',\n                                    name: 'genero',\n                                    value: 'masculino',\n                                    label: 'Masculino',\n                                    checked: false\n                                })}\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearRadioButton({\n                                    id: 'genero_femenino',\n                                    name: 'genero',\n                                    value: 'femenino',\n                                    label: 'Femenino',\n                                    checked: false\n                                })}\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearRadioButton({\n                                    id: 'genero_indiferente',\n                                    name: 'genero',\n                                    value: 'indiferente',\n                                    label: 'Indiferente',\n                                    checked: true\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"row mt-4\">\n            <div class=\"col-12\">\n                <div class=\"card shadow-sm\">\n                    <div class=\"card-body\">\n                        <div class=\"row\">\n                            <div class=\"col-12\">\n                                <label class=\"form-label fw-semibold text-gray-10\">Edad</label>\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearRadioButton({\n                                    id: 'edad_rango',\n                                    name: 'tipo_edad',\n                                    value: 'rango',\n                                    label: 'Rango',\n                                    checked: false,\n                                })}\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearRadioButton({\n                                    id: 'edad_indiferente',\n                                    name: 'tipo_edad',\n                                    value: 'indiferente',\n                                    label: 'Indiferente',\n                                    checked: true,\n                                })}\n                            </div>\n                        </div>\n                        <div class=\"row mt-3 d-none\" id=\"contenedor_edad_rango\">\n                            <div class=\"col-12 col-md-6\">\n                                ${crearInput({\n                                    id: 'edad_desde',\n                                    name: 'edad_desde',\n                                    type: 'number',\n                                    label: 'Edad desde',\n                                    placeholder: '',\n                                    max: 99,\n                                    required: true\n                                })}\n                            </div>\n                            <div class=\"col-12 col-md-6\">\n                                ${crearInput({\n                                    id: 'edad_hasta',\n                                    name: 'edad_hasta',\n                                    type: 'number',\n                                    label: 'Edad hasta',\n                                    placeholder: '',\n                                    max: 99,\n                                    required: true\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"row mt-4\">\n            <div class=\"col-12\">\n                <h6 class=\"text-headline-5 fw-bold mb-1\">Experiencia y nivel educativo</h6>\n                <p class=\"text-body-3 text-gray-30 mb-4\">Selecciona el nivel de educación y experiencia laboral que requieres que tu candidato haya alcanzado.</p>\n            </div>\n            <div class=\"col-12 col-md-6 mb-3 mb-md-0\">\n                ${crearSelect2({\n                    id: 'experiencia_laboral',\n                    name: 'experiencia_laboral',\n                    label: 'Experiencia laboral',\n                    placeholder: 'Experiencia laboral',\n                    required: true,\n                    opciones: [\n                        {id: 'Sin experiencia', nombre: 'Sin experiencia'},\n                        {id: 'Menos de 1 año', nombre: 'Menos de 1 año'},\n                        {id: '1 año', nombre: '1 año'},\n                        {id: '2 años', nombre: '2 años'},\n                        {id: '3 años', nombre: '3 años'},\n                        {id: '4 años', nombre: '4 años'},\n                        {id: '5 años o más', nombre: '5 años o más'}\n                    ],\n                    buscador: false\n                })}\n            </div>\n            <div class=\"col-12 col-md-6\">\n                ${crearSelect2({\n                    id: 'nivel_educativo_vacante',\n                    name: 'nivel_educativo_vacante',\n                    label: 'Nivel educativo',\n                    placeholder: 'Nivel educativo',\n                    required: true,\n                    opciones: [\n                        {id: 'indiferente', nombre: 'Indiferente'},\n                        @foreach($niveles_educativos as $nivel)\n                            {id: '{{ $nivel->nombre }}', nombre: '{{ $nivel->nombre }}'},\n                        @endforeach\n                    ],\n                    buscador: false\n                })}\n            </div>\n        </div>\n        <div class=\"row mt-4\">\n            <div class=\"col-12\">\n                <div class=\"card shadow-sm\">\n                    <div class=\"card-body\">\n                        <h6 class=\"text-headline-5 fw-bold mb-1\">Requisitos adicionales (Opcional)</h6>\n                        <div class=\"row\">\n                            <div class=\"col-12 mt-4\">\n                                ${crearMultiselect({\n                                    opciones: [\n                                        {'id': 1, 'nombre': 'Inglés'},\n                                        {'id': 2, 'nombre': 'Portugués'},\n                                        {'id': 3, 'nombre': 'Francés'},\n                                        {'id': 4, 'nombre': 'Alemán'},\n                                        {'id': 5, 'nombre': 'Mandarín'},\n                                        {'id': 6, 'nombre': 'Italiano'},\n                                        {'id': 7, 'nombre': 'Ruso'},\n                                        {'id': 8, 'nombre': 'Árabe'},\n                                    ],\n                                    id: 'idiomas_seleccionados',\n                                    name: 'idiomas_seleccionados',\n                                    input_container_class: 'mb-0',\n                                    placeholder: 'Idiomas',\n                                    onchange: 'seleccionarIdioma(this)',\n                                })}\n                            </div>\n                            <div class=\"col-12\">\n                                <div class=\"row mt-2\" id=\"contenedor-idiomas\">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"row mt-5\">\n            <div class=\"col-12 mb-3\">\n                <h6 class=\"text-headline-5 fw-bold\">Otros</h6>\n            </div>\n        </div>\n        <div class=\"row mt-4\">\n            <div class=\"col-12\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-8 col-lg-5 col-xl-4\">\n                        Licencia de conducir\n                    </div>\n                    <div class=\"col-4 col-lg-3\">\n                        ${crearToggle({\n                            id: 'licencia_conducir',\n                            name: 'licencia_conducir',\n                            class: 'input-dinamico',\n                            value: true,\n                            checked: false,\n                            onchange: 'seleccionarLicenciaConducir(this)',\n                        })}\n                    </div>\n                    <div class=\"col-12 col-lg-4 col-xl-5\">\n                        ${crearSelect2({\n                            opciones: [\n                                {id: 'A1', nombre: 'A1'},\n                                {id: 'A2', nombre: 'A2'},\n                                {id: 'B1', nombre: 'B1'},\n                                {id: 'B2', nombre: 'B2'},\n                                {id: 'B3', nombre: 'B3'},\n                                {id: 'C1', nombre: 'C1'},\n                                {id: 'C2', nombre: 'C2'},\n                                {id: 'C3', nombre: 'C3'},\n                            ],\n                            id: 'tipo_licencia',\n                            name: 'tipo_licencia',\n                            class: 'input-dinamico',\n                            input_container_class: 'mb-0',\n                            label: 'Tipo de licencia',\n                            required: true,\n                            disabled: true,\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-8 col-lg-5 col-xl-4 mt-5\">\n                Vacante apta para discapacitados\n            </div>\n            <div class=\"col-4 col-lg-7 col-xl-8 mt-5 mb-5\">\n                ${crearToggle({\n                    id: 'vacante_apta_discapacitados',\n                    name: 'vacante_apta_discapacitados',\n                    class: 'input-dinamico',\n                    value: true,\n                    checked: false\n                })}\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"col-12\">\n                <div class=\"d-flex justify-content-center gap-4 pt-5 mt-5 border-top\">\n                    ${crearBoton({\n                        id: 'btn_cancelar',\n                        clases: 'btn-outline-primary no-visited px-14',\n                        texto: `<span class=\"text-primary\">Cancelar</span>`,\n                        url: '/vacantes',\n                    })}\n                    ${crearBoton({\n                        id: 'boton_siguiente',\n                        clases: 'btn-primary px-13',\n                        texto: 'Siguiente',\n                        type: 'submit'\n                    })}\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n","numLines":569,"startLine":1,"totalLines":569}},"sourceToolAssistantUUID":"af548a84-5733-4250-80d8-17238508d46e"}
{"parentUuid":"c18d6815-ffe7-4531-bca0-e750fa95a0f0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SmAagdiTXYNHpbsoNa2cBb","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"No veo el toggle de automatización en este archivo. Déjame buscar en el archivo de formulario de etapas.","signature":"EpICCkYICxgCKkAIsfUuQs3Atl2v7aPc5Xe8zFeK3YIzYt6Td8lXE70+32+hTEHEnL6zfkQU3UeocM/HprkOBpa+UVZbv0sUpm4YEgxNb8vMz26rp3IeLjkaDMyOgPK500rL+MSJEyIwb5aawkSokBn1KGKXU1l1VfdqwTILhRlDayy2T45zqMyFWACw7OCL/I8zsSnB+q1FKnoO4CNdiGT0PAuUpOaBtTTPbxA23eDXwOGyY7oF3tXbwU+GXQtTq8FBoR6Ok7XLiJtbhVeYqCJlJ1GrrhDUAhELnCKNzc2bfa0XVDvA7jmfPVMf0Pc3lsxBYzDnAY9ELgNPJ7tU/Y6z358h8FIP7e8eAo+cBV6nu9CLDRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":8589,"cache_read_input_tokens":41667,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8589},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXZqQVqoURGANAmXGEEXr","type":"assistant","uuid":"88c66b54-494d-440c-bd15-acd86a345838","timestamp":"2026-01-28T13:13:33.837Z"}
{"parentUuid":"88c66b54-494d-440c-bd15-acd86a345838","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SmAagdiTXYNHpbsoNa2cBb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GcS8kkBW7TySQbAaJ5hMK6","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\formulario-etapas.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":8589,"cache_read_input_tokens":41667,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8589},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXZqQVqoURGANAmXGEEXr","type":"assistant","uuid":"f56b3536-657e-4d59-97c4-cf077bb84874","timestamp":"2026-01-28T13:13:35.069Z"}
{"parentUuid":"f56b3536-657e-4d59-97c4-cf077bb84874","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GcS8kkBW7TySQbAaJ5hMK6","type":"tool_result","content":"     1→<div class=\"col-12 px-xl-5\">\n     2→    <form id=\"formulario-vacantes-paso-2\" class=\"formularios-pasos\" method=\"POST\" action=\"/vacantes-completar\" data-activar-siguiente=\"false\">\n     3→        @csrf\n     4→        <input type=\"hidden\" id=\"id\" name=\"id\" value=\"{{ isset($vacante) ? $vacante->id : '' }}\">\n     5→        <div class=\"row\">\n     6→            <div class=\"col-12 mt-6 mb-4 text-gray-10 text-headline-5 fw-semibold\">Configuración de las etapas de la vacante</div>\n     7→            <div class=\"col-5\">\n     8→                ${crearSelect2({\n     9→                    opciones: [\n    10→                        {id: 'todas', nombre: 'Mostrar todas las etapas'},\n    11→                        {id: '1', nombre: 'Mostrar etapas activas'},\n    12→                        {id: '0', nombre: 'Mostrar etapas inactivas'},\n    13→                    ],\n    14→                    id: 'mostrar_etapas',\n    15→                    class: 'select2-filtro',\n    16→                    input_container_class: 'mb-0',\n    17→                    label: '',\n    18→                    value: 'todas',\n    19→                    disabled: false,\n    20→                    onchange: 'filtrarEtapasVacante(this.value)',\n    21→                })}\n    22→            </div>\n    23→            <div class=\"col-7\">\n    24→                <div class=\"row align-items-center mt-2\">\n    25→                    <div class=\"col text-end\">\n    26→                        <i class=\"bi bi-info-circle me-1\"\n    27→                            ${crearTooltip({\n    28→                                placement: `top`,\n    29→                                content: `Al activar esta opción, los candidatos avanzarán automáticamente a la siguiente etapa del proceso una vez cumplan los criterios establecidos.`,\n    30→                                toggle: `popover`,\n    31→                            })}\n    32→                        ></i> Activar automatización de etapas\n    33→                    </div>\n    34→                    <div class=\"col-auto ps-1\">\n    35→                        ${crearToggle({\n    36→                            id: 'campo_automatizar_etapas',\n    37→                            checked: {{ isset($vacante) && $vacante->automatizar_etapas == 1 ? 'true' : 'false' }},\n    38→                            onclick: 'automatizacionEtapas(this.checked)'\n    39→                        })}\n    40→                    </div>\n    41→                </div>\n    42→            </div>\n    43→            <div class=\"col-12 mt-5\">\n    44→                ${crearAlerta('info', 'Selecciona las etapas que forman parte de tu proceso de selección. Puedes personalizarlas y organizarlas arrastrándolas al orden que desees.')}\n    45→            </div>\n    46→            <div class=\"col-12 mt-5\" id=\"contenedor-vacantes-etapas\"></div>\n    47→            <div class=\"col-12 mt-5\">\n    48→                <div class=\"d-flex align-items-center justify-content-center gap-2\">\n    49→                    <span class=\"text-body-2 text-gray-30\">Tiempo aproximado que estarán los candidatos dentro del proceso:</span>\n    50→                    <span class=\"text-body-2 text-gray-10\" id=\"contador-dias-proceso\">\n    51→                        <span class=\"spinner-border spinner-border-sm\" role=\"status\"></span>\n    52→                    </span>\n    53→                    <span class=\"text-body-2 text-gray-30\">días</span>\n    54→                </div>\n    55→            </div>\n    56→        </div>\n    57→        <div class=\"row\">\n    58→            <div class=\"col-12\">\n    59→                <div class=\"d-flex justify-content-center gap-4 pt-5 mt-5 border-top\">\n    60→                    ${crearBoton({\n    61→                        id: 'btn_cancelar_etapa_2',\n    62→                        clases: 'btn-outline-primary no-visited px-14',\n    63→                        texto: `<span class=\"text-primary\">Cancelar</span>`,\n    64→                        url: '/vacantes',\n    65→                    })}\n    66→                    ${crearBoton({\n    67→                        id: 'btn_guardar_etapas',\n    68→                        clases: 'btn-primary px-10',\n    69→                        texto: '{{ !empty($vacante) ? \"Editar vacante\" : \"Crear vacante\" }}',\n    70→                        type: 'submit',\n    71→                    })}\n    72→                </div>\n    73→            </div>\n    74→        </div>\n    75→    </form>\n    76→</div>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1c452063-9a94-41a2-917f-8469e94cd29f","timestamp":"2026-01-28T13:13:37.275Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\formulario-etapas.blade.php","content":"<div class=\"col-12 px-xl-5\">\n    <form id=\"formulario-vacantes-paso-2\" class=\"formularios-pasos\" method=\"POST\" action=\"/vacantes-completar\" data-activar-siguiente=\"false\">\n        @csrf\n        <input type=\"hidden\" id=\"id\" name=\"id\" value=\"{{ isset($vacante) ? $vacante->id : '' }}\">\n        <div class=\"row\">\n            <div class=\"col-12 mt-6 mb-4 text-gray-10 text-headline-5 fw-semibold\">Configuración de las etapas de la vacante</div>\n            <div class=\"col-5\">\n                ${crearSelect2({\n                    opciones: [\n                        {id: 'todas', nombre: 'Mostrar todas las etapas'},\n                        {id: '1', nombre: 'Mostrar etapas activas'},\n                        {id: '0', nombre: 'Mostrar etapas inactivas'},\n                    ],\n                    id: 'mostrar_etapas',\n                    class: 'select2-filtro',\n                    input_container_class: 'mb-0',\n                    label: '',\n                    value: 'todas',\n                    disabled: false,\n                    onchange: 'filtrarEtapasVacante(this.value)',\n                })}\n            </div>\n            <div class=\"col-7\">\n                <div class=\"row align-items-center mt-2\">\n                    <div class=\"col text-end\">\n                        <i class=\"bi bi-info-circle me-1\"\n                            ${crearTooltip({\n                                placement: `top`,\n                                content: `Al activar esta opción, los candidatos avanzarán automáticamente a la siguiente etapa del proceso una vez cumplan los criterios establecidos.`,\n                                toggle: `popover`,\n                            })}\n                        ></i> Activar automatización de etapas\n                    </div>\n                    <div class=\"col-auto ps-1\">\n                        ${crearToggle({\n                            id: 'campo_automatizar_etapas',\n                            checked: {{ isset($vacante) && $vacante->automatizar_etapas == 1 ? 'true' : 'false' }},\n                            onclick: 'automatizacionEtapas(this.checked)'\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-5\">\n                ${crearAlerta('info', 'Selecciona las etapas que forman parte de tu proceso de selección. Puedes personalizarlas y organizarlas arrastrándolas al orden que desees.')}\n            </div>\n            <div class=\"col-12 mt-5\" id=\"contenedor-vacantes-etapas\"></div>\n            <div class=\"col-12 mt-5\">\n                <div class=\"d-flex align-items-center justify-content-center gap-2\">\n                    <span class=\"text-body-2 text-gray-30\">Tiempo aproximado que estarán los candidatos dentro del proceso:</span>\n                    <span class=\"text-body-2 text-gray-10\" id=\"contador-dias-proceso\">\n                        <span class=\"spinner-border spinner-border-sm\" role=\"status\"></span>\n                    </span>\n                    <span class=\"text-body-2 text-gray-30\">días</span>\n                </div>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"col-12\">\n                <div class=\"d-flex justify-content-center gap-4 pt-5 mt-5 border-top\">\n                    ${crearBoton({\n                        id: 'btn_cancelar_etapa_2',\n                        clases: 'btn-outline-primary no-visited px-14',\n                        texto: `<span class=\"text-primary\">Cancelar</span>`,\n                        url: '/vacantes',\n                    })}\n                    ${crearBoton({\n                        id: 'btn_guardar_etapas',\n                        clases: 'btn-primary px-10',\n                        texto: '{{ !empty($vacante) ? \"Editar vacante\" : \"Crear vacante\" }}',\n                        type: 'submit',\n                    })}\n                </div>\n            </div>\n        </div>\n    </form>\n</div>","numLines":76,"startLine":1,"totalLines":76}},"sourceToolAssistantUUID":"f56b3536-657e-4d59-97c4-cf077bb84874"}
{"parentUuid":"1c452063-9a94-41a2-917f-8469e94cd29f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Gi61oJXfHQpTS3HtNUFdtm","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto, ahora encontré el toggle. Está en la línea 35-39:\n\n```blade\n${crearToggle({\n    id: 'campo_automatizar_etapas',\n    checked: {{ isset($vacante) && $vacante->automatizar_etapas == 1 ? 'true' : 'false' }},\n    onclick: 'automatizacionEtapas(this.checked)'\n})}\n```\n\nEl toggle tiene el ID `campo_automatizar_etapas` y cuando se hace click, llama a `automatizacionEtapas(this.checked)`, donde `this.checked` es un booleano (true/false).\n\nEn la función `automatizacionEtapas(elemento)` del archivo JavaScript (líneas 729-739):\n```javascript\nfunction automatizacionEtapas(elemento) {\n    if (!buscarFuncionalidad('automatizacion_etapas')) {\n        modalFuncionalidadInactiva();\n        $('#campo_automatizar_etapas').val(0);\n        return;\n    }\n\n    let valor = elemento ? 1 : 0;\n    $('#automatizar_etapas').val(valor);\n    $('#formulario-vacantes-paso-1').submit();\n}\n```\n\nVeo que cuando entra en el if `!buscarFuncionalidad('automatizacion_etapas')`, ya está haciendo `$('#campo_automatizar_etapas').val(0)`, pero esto establece el *valor* del campo, no su estado de checked.\n\nPara desmarcar el toggle, necesito hacer `$('#campo_automatizar_etapas').prop('checked', false)`.\n\nEl usuario quiere que cuando entre en ese if (cuando la funcionalidad no está disponible), el toggle quede desmarcado aunque se le dé click.","signature":"EtILCkYICxgCKkDDYGERxcDtQskRHq28HuQH5C6QsA8l4ZesrccQZKnBSD4Z9qpd6EM/ItQFlm5bWK7I0Yg6vijEo7K7G/Sk06IxEgzSiqwQLGhu5DVrYPcaDN2VhwnHJ2VPIDTMDSIwkDjNIGp8TcTnedwIN5Q1QHCdPtSjTbV2WxPRREqLrMi/4g8oJTWt4bLopIbxRcU6KrkKVHsfC290ByGTD2m4ObfZ+Aiw5ZF68Y3tT5AXlhOEnbz4o2CJ46sqhPfopK3s+JPBTDsViv0prnjDxKv/Y80InUYUbOXtVLDc2ofyMqmTdZo8DO+VOVNvKNVJFA1IyAmKu8lPy0aqAaSVJljsCIpBTvJ6vfTb5oibMWnmwpLJF3KWOs2r5EZS+xMk/5h6xXLrUqPrAjZ3hNkWFWkYrWJuWr2fg7KcqcnK4ZUSSufJSxDCZOXn6cEjvvnBefpbqxSbzLP2JqkqhLLuIsMOy2iMnB+Mpne8r4VBxeRNnZLBmyKIrd0fjRHv2Ues1usJKxCuplsoCMNMkLX1llOACDXMn0K72/KMxGScPEUsTXCnmKVNNNppA1KYQ880TCUM7htWR1Ep8KeDSgrTQKGC11xOUKcUuzP3i/TgVEvJdAvi2PiyOmNRSZ4aMAyuIcLOV43+oZF2PM8hz+qzDbD9DZvEUPrS1i0hF9pTri0DaKWuHYMcf+p4nBys9NjO7w591K+F+MD27J3NMlcjSOFot7ZaSbl7IUCxW6zTvJblSP5bltz3Br/1Mu6M4OyyIILlBmhwcmnRWGCMZmzAQ4hZpBqjYctQKXtS+ixQhhPV5sUQR5P4Ds5dMC5R99UXeSiTO9ytCcU3z3RJkRhA9hewTq3Gesr5T+cV17QQMp39HC+TGHCeVYondqjv1gtMPCwst0jBHgAzWTBgUNxcZ9RcH0sUfXGVfTuAQrKE9Z7HUIjTTSubVlTx/ax/M4moCN7duSagxQlWaGzR4zOe3K2PY5vHuamgRDX5hCBcHs2CJJ9QXvdWFn/M3l/CoAx4YY5wbVzbATkQDNVh9JesiYVnTapTCYnpu48WFvcH/dGTfUlSOKPMR6Mw9elKB1c4P8xkFVljUbLgGBeaxMSMYbygUkwFkitz8Xhk45BMHZWDOgrNnbFKKjn7IXjWzMPjNfZlbirf4GDbxBfO3qZyqmSuQna3ORiMRA5shlidwWKzM0SWa/rNawFSwy/kZhLWoLQcofBsSlSxOdysERsO4KOlMub/mvoPSmmD8WhsRsmyVbgddpIqtfKOdQOiE6QvDH04p515HbLrY2j8FFRrmE5yb9TmLHy64Xv+pI4wMdxu39JsDINTOjjLV/ZuZuMSx6qXwsYrAjQov5ArZGlD91Yh6/6RnmHTnNnKL1i99C6qID/MoP40fA7I394Z2hLaysYSDPJZWhw52UkYs/W3+BCsDZV1oq+jkKJJql4sRe1sRjK6SBre8xoaQ/SlCxlk3AAgXyhDRrdQQMODBUepppe2WYFKHJWue4K+Ql/lm53WmCSV445jOykBo/57OmIHkQccNmaAqtsLm4ekt8DfCTjhFfy3CUrzn6H7D9glrRF01Ae1enuxkBU59YhlylRWkCHKGVhmJRRWhHoLrzfYpJFIMevbf6UBSs45jaztxLzkW8m4KuGftdUf0K+BUhSsMVsblhbSkLHqfK04C9GnBmz1QlTMNwNG6NFovddGyj3/1ZMMe/KOZb5NBI8uRakGYoBBK448s6palfHAKJg2GEIfEOns53O1uZ7Uy+5/GrZkzZUwom91tjf2zuZ30cxS8LAGpcrjPpsjutDSNTyeLvxxZJm8AjJ9RICweSymNaUfRpryAWBlkc5fqFQixNVAz5ZJIi3aN5hLknV8yJwKxVfBm1SKR6a7VjkLrLfOhL9Z+u4spFqmHNENjs57N6uGmTIQrLKwQdh7+ka1Gv1SUiVsW/btq6cvZxA5QGgEHAgS315oeONT2DBybvU+evIYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":1571,"cache_read_input_tokens":50256,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1571},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXZqQym5UsGescAAkWCUQ","type":"assistant","uuid":"6e468ca5-4f42-4539-93dd-8285b49515c7","timestamp":"2026-01-28T13:13:47.437Z"}
{"parentUuid":"6e468ca5-4f42-4539-93dd-8285b49515c7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Gi61oJXfHQpTS3HtNUFdtm","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto, encontré el toggle. Está en [formulario-etapas.blade.php:35-39](resources/views/vacantes/paginas/formularios/formulario-etapas.blade.php#L35-L39) con el ID `campo_automatizar_etapas`.\n\nEl problema es que en la función `automatizacionEtapas`, cuando entra en el if de `!buscarFuncionalidad('automatizacion_etapas')`, solo está estableciendo el valor con `.val(0)`, pero no está desmarcando el checkbox del toggle.\n\nNecesitas agregar `.prop('checked', false)` para desmarcar el toggle. Aquí está la solución:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":1571,"cache_read_input_tokens":50256,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1571},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXZqQym5UsGescAAkWCUQ","type":"assistant","uuid":"029cf25b-4db7-4c2e-9565-7102efaaa679","timestamp":"2026-01-28T13:13:50.114Z"}
{"parentUuid":"029cf25b-4db7-4c2e-9565-7102efaaa679","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Gi61oJXfHQpTS3HtNUFdtm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01V3XWemezrxeqWCDvpn2eUi","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-2.js","old_string":"function automatizacionEtapas(elemento) {\n    if (!buscarFuncionalidad('automatizacion_etapas')) {\n        modalFuncionalidadInactiva();\n        $('#campo_automatizar_etapas').val(0);\n        return;\n    }\n\n    let valor = elemento ? 1 : 0;\n    $('#automatizar_etapas').val(valor);\n    $('#formulario-vacantes-paso-1').submit();\n}","new_string":"function automatizacionEtapas(elemento) {\n    if (!buscarFuncionalidad('automatizacion_etapas')) {\n        modalFuncionalidadInactiva();\n        $('#campo_automatizar_etapas').val(0);\n        $('#campo_automatizar_etapas').prop('checked', false);\n        return;\n    }\n\n    let valor = elemento ? 1 : 0;\n    $('#automatizar_etapas').val(valor);\n    $('#formulario-vacantes-paso-1').submit();\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":1571,"cache_read_input_tokens":50256,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1571},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXZqQym5UsGescAAkWCUQ","type":"assistant","uuid":"06b0137e-eeb0-43c5-8515-e8759ec28224","timestamp":"2026-01-28T13:13:53.118Z"}
{"type":"file-history-snapshot","messageId":"06b0137e-eeb0-43c5-8515-e8759ec28224","snapshot":{"messageId":"4459e979-6a15-4cd5-b0d3-10ac6698cc83","trackedFileBackups":{"public\\js\\vacantes\\vacantes-paso-2.js":{"backupFileName":"be128a13f079788a@v1","version":1,"backupTime":"2026-01-28T13:14:41.724Z"}},"timestamp":"2026-01-28T13:12:42.602Z"},"isSnapshotUpdate":true}
{"parentUuid":"06b0137e-eeb0-43c5-8515-e8759ec28224","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01V3XWemezrxeqWCDvpn2eUi","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-2.js has been updated successfully."}]},"uuid":"88405272-6d9e-4107-9dc6-7ac34603f25a","timestamp":"2026-01-28T13:14:41.804Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-2.js","oldString":"function automatizacionEtapas(elemento) {\n    if (!buscarFuncionalidad('automatizacion_etapas')) {\n        modalFuncionalidadInactiva();\n        $('#campo_automatizar_etapas').val(0);\n        return;\n    }\n\n    let valor = elemento ? 1 : 0;\n    $('#automatizar_etapas').val(valor);\n    $('#formulario-vacantes-paso-1').submit();\n}","newString":"function automatizacionEtapas(elemento) {\n    if (!buscarFuncionalidad('automatizacion_etapas')) {\n        modalFuncionalidadInactiva();\n        $('#campo_automatizar_etapas').val(0);\n        $('#campo_automatizar_etapas').prop('checked', false);\n        return;\n    }\n\n    let valor = elemento ? 1 : 0;\n    $('#automatizar_etapas').val(valor);\n    $('#formulario-vacantes-paso-1').submit();\n}","originalFile":"/**\n * Archivo para manejar la lógica del Paso 2: Etapas de la vacante\n * @author Andres Morales\n * @author José Manuel Jiménez\n */\nconst CONFIGURACION_ETAPAS = {\n    'Revisión HV': {\n        titulo_modal_notificacion: 'Inicio proceso de selección',\n        titulo_notificacion: 'Notificación inicio proceso de selección',\n        titulo_etapa: 'Revisión hoja de vida',\n        plantilla_correo_id: 12\n    },\n    'Preguntas prefiltro': {\n        titulo_modal_notificacion: 'Preguntas pre-filtro',\n        titulo_notificacion: 'Notificacion envío de preguntas pre-filtro',\n        titulo_etapa: 'Preguntas prefiltro',\n        plantilla_correo_id: 13\n    },\n    'Pruebas psicométricas': {\n        titulo_modal_notificacion: 'Pruebas psicométricas',\n        titulo_notificacion: 'Notificación envío de pruebas psicométricas',\n        titulo_etapa: 'Pruebas psicométricas',\n        plantilla_correo_id: 15\n    },\n    'Prueba técnica': {\n        titulo_modal_notificacion: 'Prueba técnica',\n        titulo_notificacion: 'Notificación envío de prueba técnica',\n        titulo_etapa: 'Prueba técnica',\n        plantilla_correo_id: 18\n    },\n    'Video entrevista': {\n        titulo_modal_notificacion: 'Video entrevista',\n        titulo_notificacion: 'Notificación envío de video entrevista',\n        titulo_etapa: 'Solicitud video entrevista',\n        plantilla_correo_id: 21\n    },\n    'Entrevista': {\n        titulo_modal_notificacion: 'Entrevista',\n        titulo_notificacion: 'Notificacíon de entrevista',\n        titulo_etapa: 'Solicitud de entrevista',\n        plantilla_correo_id: 26\n    },\n    'Documentos para contratación': {\n        titulo_modal_notificacion: 'Documentos para contratación',\n        titulo_notificacion: 'Notificación envío de solicitud de documentos',\n        titulo_etapa: 'Solicitar documentos',\n        plantilla_correo_id: 23\n    },\n    'Contratados': {\n        titulo_modal_notificacion: 'Contratados',\n        titulo_notificacion: 'Notificación de resultado del proceso',\n        plantilla_correo_id: 27\n    },\n    'Descartados': {\n        titulo_modal_notificacion: 'Descartados',\n        titulo_notificacion: 'Notificación de resultado del proceso',\n        plantilla_correo_id: 28\n    }\n};\n\nlet etapa_movimiento_vacante_id_seleccionado = null;\nlet etapa_vacante_id_seleccionado = null;\nlet modal_movimiento_id_seleccionado = null;\nlet contador_preguntas = 0; // Contador general (mantener por compatibilidad)\nlet contador_preguntas_prefiltro = 0; // Contador específico para modal preguntas prefiltro\nlet contador_preguntas_video_entrevista = 0; // Contador específico para modal video entrevista\nlet contador_respuestas = 0;\nlet archivos_preguntas = [];\nlet toggle_etapa_activado = null;\nlet etapa_activada_desde_toggle = false;\nlet archivos_cargados = [];\n\n/**\n * Obtiene la configuración de títulos para una etapa\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @param {string} tipo_titulo Tipo de título a obtener: 'titulo_modal_notificacion', 'titulo_notificacion' o 'titulo_etapa'\n * @returns {string|null} Título configurado o null si no existe\n * @author Andres Morales\n */\nfunction obtenerTituloEtapa(nombre_etapa, tipo_titulo = 'titulo_modal_notificacion') {\n    var configuracion = CONFIGURACION_ETAPAS[nombre_etapa];\n    return configuracion && configuracion[tipo_titulo] ? configuracion[tipo_titulo] : null;\n}\n\n/**\n * Verifica si existe un título configurado para una etapa\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @param {string} tipo_titulo Tipo de título a verificar\n * @returns {boolean} True si existe el título, false si no\n * @author Andres Morales\n */\nfunction existeTituloEtapa(nombre_etapa, tipo_titulo) {\n    return obtenerTituloEtapa(nombre_etapa, tipo_titulo) !== null;\n}\n\n/**\n * Obtiene el ID de plantilla de correo para una etapa\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @returns {number|null} ID de la plantilla o null si no existe\n * @author Andres Morales\n */\nfunction obtenerPlantillaCorreoId(nombre_etapa) {\n    var configuracion = CONFIGURACION_ETAPAS[nombre_etapa];\n    return configuracion && configuracion.plantilla_correo_id ? configuracion.plantilla_correo_id : null;\n}\n\n/**\n * Consulta la plantilla de correo de una etapa específica\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @returns {Promise} Promesa con los datos de la plantilla\n * @author Andres Morales\n */\nfunction consultarPlantillaEtapa(nombre_etapa) {\n    var plantilla_correo_id = obtenerPlantillaCorreoId(nombre_etapa);\n\n    if (!plantilla_correo_id) {\n        console.error('No se encontró ID de plantilla para la etapa:', nombre_etapa);\n        return Promise.reject('No se encontró ID de plantilla');\n    }\n\n    return $.ajax({\n        url: '/plantilla-correo',\n        method: 'GET',\n        data: {\n            plantilla_correo_id: plantilla_correo_id,\n            empresa_id: empresa?.id\n        },\n        dataType: 'json'\n    });\n}\n\n/**\n * Función para consultar las etapas de una vacante\n *\n * @param {number} vacante_id ID de la vacante\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction consultarEtapasVacante(vacante_id) {\n    $.ajax({\n        url: `/etapas-vacantes`,\n        data: { vacante_id: vacante_id },\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            etapas_vacante = respuesta.data || [];\n            mostrarEtapasVacante();\n            calcularDiasDuracionProceso(vacante_id);\n        }\n    });\n}\n\n/**\n * Función para calcular y mostrar los días de duración del proceso\n *\n * @param {number} vacante_id ID de la vacante\n * @returns {void}\n * @author Andres Morales\n */\nfunction calcularDiasDuracionProceso(vacante_id) {\n    $.ajax({\n        url: `/vacantes-calcular-dias-duracion-proceso/${vacante_id}`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            var dias = respuesta.duracion_dias || 0;\n            $('#contador-dias-proceso').html(dias);\n        },\n        error: function() {\n            $('#contador-dias-proceso').html('0');\n        }\n    });\n}\n\n/**\n * Función para mostrar las etapas de una vacante en un acordeon.\n *\n * @param {Object} etapas Array con las etapas de la vacante.\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction mostrarEtapasVacante() {\n    let etapas = etapas_vacante;\n    $('#contenedor-vacantes-etapas').empty().append(crearAcordeon({\n        id: 'acordeon',\n        acordeon: etapas.map((etapa, index) => ({\n            id: `etapa-${index}`,\n            titulo: `\n                <div class=\"col\">\n                    <div class=\"row\">\n                        <div class=\"col ps-1 text-gray-10 text-body-1\">${etapa.nombre}</div>\n                        <div class=\"col-auto pe-7\">\n                            ${etapa.editable == 1 ? crearToggle({\n                                id: `activar_etapa_${index}`,\n                                name: `activar_etapa_${index}`,\n                                class: 'checkbox-etapa-vacante',\n                                value: etapa.id,\n                                checked: etapa.activa == 1 ? true : false,\n                                onchange: `activarDesactivarEtapa(this)`,\n                            }) : ''}\n                        </div>\n                    </div>\n                </div>\n            `,\n            contenido: `\n                <div class=\"row\">\n                    ${etapa.etapas_movimientos.map(etapa_movimiento => `\n                        <div class=\"col-12 d-flex justify-content-between align-items-center\">\n                            <div class=\"text-body-2 text-gray-30\">\n                                ${etapa_movimiento.movimiento.nombre}\n                            </div>\n                            <div>\n                                ${crearBoton({\n                                    clases: 'btn-text-primary btn-circle',\n                                    texto: '<i class=\"bi bi-gear\"></i>',\n                                    onclick: `${etapa_movimiento.movimiento.es_notificacion == 1 ?\n                                        `abrirModalNotificacionEtapa(${etapa.id})` : `abrirModalMovimientoEtapa(${etapa_movimiento.movimiento.id}, ${etapa_movimiento.id}, ${etapa_movimiento.etapa_vacante_id})`\n                                    }`\n                                })}\n                            </div>\n                        </div>\n                    `).join('')}\n                </div>\n            `,\n            disabled: etapa.activa == 0 ? true : false,\n            ordenar: etapa.fija == 0 ? true : false,\n            adicional: `data-orden=\"${etapa.orden}\" data-etapa_vacante_id=\"${etapa.id}\" data-fija=\"${etapa.fija}\"`,\n        }))\n    }));\n    $(\"#acordeon\").sortable({\n        items: \".accordion-item\",\n        handle: \".drag-handle\",\n        cursor: \"grabbing\",\n        placeholder: \"ui-sortable-placeholder\",\n        tolerance: \"pointer\",\n        update: function(evento, elemento) {\n            let elemento_actual = elemento.item;\n            let orden_actual = $(elemento_actual).data('orden');\n            let elemento_anterior = elemento_actual.prev();\n            let orden_anterior = $(elemento_anterior).data('orden');\n            let es_fijo_anterior = $(elemento_anterior).data('fija');\n            if (es_fijo_anterior == 1) {\n                return false;\n            }\n            if (orden_anterior == undefined) {\n                orden_anterior = '0';\n            }\n            if ((parseInt(orden_actual) - 1) != orden_anterior) {\n                if (parseInt(orden_actual) > parseInt(orden_anterior)) {\n                    orden_anterior = parseInt(orden_anterior) + 1;\n                }\n                let etapa_vacante_id = $(elemento_actual).data('etapa_vacante_id');\n                $.ajax({\n                    url : `/etapas-vacantes-cambiar-orden`,\n                    type: 'POST',\n                    data: {\n                        _token : $('meta[name=\"csrf-token\"]').attr('content'),\n                        _method: 'PUT',\n                        id: etapa_vacante_id,\n                        orden: orden_anterior\n                    },\n                    success: function (respuesta) {\n                        mostrarToast('success', respuesta.message);\n                        $(elemento_actual).data('orden', orden_anterior);\n                        $(elemento_anterior).data('orden', orden_actual);\n                    },\n                    error: function (error) {\n                        mostrarToast('danger', 'Ocurrió un error al organizar');\n                    }\n                });\n            }\n        }\n    });\n}\n\n/**\n * Función para activar o desactivar un acordeon de una etapa de la vacante.\n *\n * @param {HTMLInputElement} checkbox Checkbox que activa o desactiva la etapa\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction activarDesactivarEtapa(checkbox) {\n    setTimeout(() => {\n        if (checkbox.checked) {\n            $(checkbox).closest('.accordion-item').find('.accordion-button').removeClass('collapsed').attr('aria-disabled', 'false').attr('disabled', false);\n            $(checkbox).closest('.accordion-item').find('.accordion-collapse').addClass('show').attr('aria-expanded', 'true');\n\n            toggle_etapa_activado = checkbox;\n            etapa_activada_desde_toggle = true;\n\n            var etapa_vacante_id = $(checkbox).closest('.accordion-item').data('etapa_vacante_id');\n\n            var etapa_encontrada = etapas_vacante.find(function(etapa) {\n                return etapa.id === etapa_vacante_id;\n            });\n\n            if (etapa_encontrada && etapa_encontrada.etapas_movimientos) {\n                var primer_movimiento_config = etapa_encontrada.etapas_movimientos.find(function(etapa_movimiento) {\n                    return etapa_movimiento.movimiento && etapa_movimiento.movimiento.es_notificacion !== 1;\n                });\n\n                if (primer_movimiento_config && primer_movimiento_config.movimiento) {\n                    abrirModalMovimientoEtapa(\n                        primer_movimiento_config.movimiento.id,\n                        primer_movimiento_config.id,\n                        primer_movimiento_config.etapa_vacante_id\n                    );\n                }\n            }\n        } else {\n            $(checkbox).closest('.accordion-item').find('.accordion-button').addClass('collapsed').attr('aria-disabled', 'true').attr('disabled', true);\n            $(checkbox).closest('.accordion-item').find('.accordion-collapse').removeClass('show').attr('aria-expanded', 'false');\n        }\n        $.ajax({\n            url: `/etapas-vacantes/${checkbox.value}`,\n            data: {\n                activa: checkbox.checked ? 1 : 0,\n                _token: $('meta[name=\"csrf-token\"]').attr('content')\n            },\n            method: 'PUT',\n            dataType: 'json',\n            success: function(respuesta) {\n                var vacante_id = $('#id').val();\n                if (vacante_id) {\n                    calcularDiasDuracionProceso(vacante_id);\n                }\n            }\n        });\n    }, 500);\n}\n\n/**\n * Función para filtrar las etapas de la vacante en el acordeon.\n *\n * @param {string} mostrar_etapas Valor del filtro: '1' para mostrar solo las etapas activas, '0' para mostrar solo las etapas inactivas, cualquier otro valor para mostrar todas las etapas.\n * @author José Manuel Jiménez\n */\nfunction filtrarEtapasVacante(mostrar_etapas) {\n    $('#acordeon .accordion-item').removeClass('d-none');\n    if (mostrar_etapas == '1') {\n        $('#acordeon .accordion-item').each(function() {\n            if ($(this).find('.checkbox-etapa-vacante').length > 0 && !$(this).find('.checkbox-etapa-vacante').is(':checked')) {\n                $(this).addClass('d-none');\n            }\n        });\n    } else if (mostrar_etapas == '0') {\n        $('#acordeon .accordion-item').each(function() {\n            if ($(this).find('.checkbox-etapa-vacante').length == 0 || $(this).find('.checkbox-etapa-vacante').is(':checked')) {\n                $(this).addClass('d-none');\n            }\n        });\n    }\n}\n\n/**\n * Función para abrir la modal de edición de plantilla de etapa\n *\n * @param {number} etapa_id ID de la etapa\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction abrirModalNotificacionEtapa(etapa_id) {\n    $('#modal-editar-plantilla-etapa #etapa_id').val(etapa_id);\n\n    let etapa = etapas_vacante.find(e => e.id === etapa_id);\n\n    if (etapa) {\n        $('#titulo-plantilla-modal').text(etapa.nombre);\n\n        if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n            $('#contenedor_check_enviar_al_finalizar').html(`\n                ${crearCheckbox({\n                    id: 'enviar_finalizar',\n                    class: 'input-dinamico',\n                    label: 'Enviar comunicación únicamente cuando finalice el proceso',\n                })}\n            `);\n        } else {\n            $('#contenedor_check_enviar_al_finalizar').html(`\n                ${crearCheckbox({\n                    id: 'enviar_finalizar',\n                    class: 'input-dinamico',\n                    input_container_class: 'd-none',\n                    checked: false,\n                    label: 'Enviar comunicación únicamente cuando finalice el proceso',\n                })}\n            `);\n        }\n\n        consultarPlantillaEtapa(etapa.nombre).then(function(respuesta) {\n            var plantilla = respuesta.data;\n\n            $('#modal-editar-plantilla-etapa #id').val(plantilla.id);\n            $('#modal-editar-plantilla-etapa #plantilla_correo_id').val(plantilla.plantilla_correo_id || plantilla.id);\n            $('#modal-editar-plantilla-etapa #empresa_id').val(plantilla.empresa_id || (empresa && empresa.id) || '');\n            $('#modal-editar-plantilla-etapa #grupo_id').val(plantilla.grupo_id);\n            $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val(plantilla.titulo);\n\n            if (plantilla.con_logo_empresa == 1) {\n                $('#modal-editar-plantilla-etapa #con_logo').prop('checked', true);\n            } else {\n                $('#modal-editar-plantilla-etapa #con_logo').prop('checked', false);\n            }\n\n            if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n                if (plantilla.notificar_fin_proceso == 1) {\n                    $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', true);\n                } else {\n                    $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', false);\n                }\n            }\n\n            $('#contenedor_editor_texto').html(`\n                ${crearEditorTexto({\n                    adicional: `data-botonadicional=\"botonAdicionalCkeditorEtapa\"`,\n                    id: 'descripcion_mensaje_etapa',\n                    name: 'descripcion_mensaje_etapa',\n                    class: 'classic-editor-opciones',\n                    input_container_class: 'mb-4',\n                    maxlength: 16350,\n                    required: true\n                })}\n            `);\n\n            inicializarClassicEditor();\n\n            setTimeout(function() {\n                if ($('#descripcion_mensaje_etapa').data('editor')) {\n                    $('#descripcion_mensaje_etapa').data('editor').setData(plantilla.contenido || '');\n                }\n            }, 500);\n        }).catch(function(error) {\n            if (typeof empresa !== 'undefined' && empresa && empresa.id) {\n                $('#modal-editar-plantilla-etapa #empresa_id').val(empresa.id);\n            }\n\n            $('#contenedor_editor_texto').html(`\n                ${crearEditorTexto({\n                    adicional: `data-botonadicional=\"botonAdicionalCkeditorEtapa\"`,\n                    id: 'descripcion_mensaje_etapa',\n                    name: 'descripcion_mensaje_etapa',\n                    class: 'classic-editor-opciones',\n                    input_container_class: 'mb-4',\n                    maxlength: 16350,\n                    required: true\n                })}\n            `);\n\n            inicializarClassicEditor();\n        });\n    }\n\n    $('#modal-editar-plantilla-etapa').modal('show');\n}\n\n/**\n * Crear boton adicional para ckeditor con variables de etapa\n *\n * @param {string} id ID del editor\n * @returns {html} botón adicional para ckeditor\n * @author Andres Morales\n */\nfunction botonAdicionalCkeditorEtapa(id) {\n    var variables_etapa = [\n        { llave: 'nombre_informador', valor: 'Nombre de usuario (Yo)' },\n        { llave: 'nombre_empresa', valor: 'Nombre de la empresa' },\n        { llave: 'nombre_vacante', valor: 'Nombre de la vacante' },\n        { llave: 'nombre_candidato', valor: 'Nombre del candidato' }\n    ];\n\n    var opciones_variables = variables_etapa\n        .map(variable => `<button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableEtapa('${id}', '__${variable.llave}__')\">${variable.valor}</button>`)\n        .join('');\n\n    return `\n        <div class=\"border-start border-black border-2 px-2 my-0 dropdown\">\n            ${crearBoton({\n                clases: 'dropdown-toggle text-body-3 btn-dropdown-ckeditor',\n                texto: 'Agregar variable<i class=\"bi bi-chevron-down text-body-3 ms-2\"></i>',\n                data: [{texto: 'bs-toggle', value: 'dropdown'},{texto: 'bs-auto-close', value: 'outside'}]\n            })}\n            <div class=\"dropdown-menu bg-white\">${opciones_variables}</div>\n        </div>\n    `;\n}\n\n/**\n * Agrega la variable en el ckeditor de etapa\n *\n * @param {string} id ID del editor\n * @param {string} variable Variable a agregar\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction agregarVariableEtapa(id, variable) {\n    let editor = $(`#${id}`).data('editor');\n    let fragmento_vista = editor.data.processor.toView(variable);\n    let fragmento_modelo = editor.data.toModel(fragmento_vista);\n    editor.model.insertContent(fragmento_modelo);\n}\n\n/**\n * Inicializar configuración del formulario de plantilla de etapa\n *\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\n$(document).ready(function() {\n    obtenerFuncionalidadesActivasPlan();\n    configurarFormulario('form-editar-plantilla-etapa');\n\n    $(document).on('click', '#restablecer_texto', function () {\n        if (!buscarFuncionalidad('plantillas_personalizadas')) {\n            modalFuncionalidadInactiva();\n            return;\n        }\n        confirmarRestablecerTexto();\n    });\n\n    $(document).on('click', '#btn-cancelar-plantilla-etapa', function () {\n        confirmarCancelarPlantillaEtapa();\n    });\n\n    $(\".formulario-movimiento\").each(function() {\n        let $formulario_movimiento = $(this);\n        $formulario_movimiento.on(\"change keyup blur\", \"input, select, textarea\", function() {\n            let formulario_movimiento_valido = $formulario_movimiento.validate().checkForm();\n            if (formulario_movimiento_valido) {\n                $formulario_movimiento.closest('.modal-content').find('button[type=\"submit\"]').prop('disabled', false);\n            } else {\n                $formulario_movimiento.closest('.modal-content').find('button[type=\"submit\"]').prop('disabled', true);\n            }\n        });\n    });\n});\n\n/**\n * Confirmar antes de cancelar la edición de la plantilla\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction confirmarCancelarPlantillaEtapa() {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas cancelar?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Los cambios que hayas realizado en la plantilla no se guardarán. Esta acción no se puede deshacer.</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Aceptar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((result) => {\n        if (result.isConfirmed) {\n            $('#modal-editar-plantilla-etapa').modal('hide');\n            limpiarFormulario('form-editar-plantilla-etapa');\n        }\n    });\n}\n\n/**\n * Confirmar antes de restablecer el texto de la plantilla\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction confirmarRestablecerTexto() {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas restablecer?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Se restablecerá el texto de la plantilla a su versión por defecto. Los cambios personalizados que hayas hecho se perderán. Esta acción no se puede deshacer.</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-danger w-100 justify-content-center',\n                        texto: 'Restablecer',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((result) => {\n        if (result.isConfirmed) {\n            restablecerPlantillaEtapa();\n        }\n    });\n}\n\n/**\n * Restablecer la plantilla de etapa a su versión por defecto\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction restablecerPlantillaEtapa() {\n    var plantilla_id = $('#modal-editar-plantilla-etapa #id').val();\n    var etapa_id = $('#modal-editar-plantilla-etapa #etapa_id').val();\n\n    if (!plantilla_id) {\n        mostrarToast('danger', 'No se ha seleccionado una plantilla para restablecer');\n        return;\n    }\n\n    if (!etapa_id) {\n        mostrarToast('danger', 'No se ha identificado la etapa');\n        return;\n    }\n\n    $.ajax({\n        url: `/plantillas-correos-restablecer/${plantilla_id}`,\n        type: 'PUT',\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message);\n\n            let etapa = etapas_vacante.find(e => e.id === parseInt(etapa_id));\n\n            if (etapa) {\n                consultarPlantillaEtapa(etapa.nombre).then(function(respuesta_plantilla) {\n                    var plantilla = respuesta_plantilla.data;\n\n                    $('#modal-editar-plantilla-etapa #id').val(plantilla.id);\n                    $('#modal-editar-plantilla-etapa #plantilla_correo_id').val(plantilla.plantilla_correo_id);\n                    $('#modal-editar-plantilla-etapa #empresa_id').val(plantilla.empresa_id || (empresa && empresa.id) || '');\n                    $('#modal-editar-plantilla-etapa #grupo_id').val(plantilla.grupo_id);\n                    $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val(plantilla.titulo);\n\n                    if (plantilla.con_logo_empresa == 1) {\n                        $('#modal-editar-plantilla-etapa #con_logo').prop('checked', true);\n                    } else {\n                        $('#modal-editar-plantilla-etapa #con_logo').prop('checked', false);\n                    }\n\n                    if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n                        if (plantilla.notificar_fin_proceso == 1) {\n                            $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', true);\n                        } else {\n                            $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', false);\n                        }\n                    }\n\n                    setTimeout(function() {\n                        if ($('#descripcion_mensaje_etapa').data('editor')) {\n                            $('#descripcion_mensaje_etapa').data('editor').setData(plantilla.contenido || '');\n                        }\n                    }, 300);\n                }).catch(function() {\n                    mostrarToast('danger', 'Error al recargar la plantilla restaurada');\n                });\n            }\n        },\n        error: function(xhr) {\n            var mensaje_error = 'Error al restablecer la plantilla';\n            if (xhr.responseJSON && xhr.responseJSON.message) {\n                mensaje_error = xhr.responseJSON.message;\n            }\n            mostrarToast('danger', mensaje_error);\n        }\n    });\n}\n\n/**\n * Función para abrir la modal de movimiento de etapa\n *\n * @param {number} etapa_id ID de la etapa\n * @param {number} movimiento_id ID del movimiento\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction abrirModalMovimientoEtapa(movimiento_id, etapa_movimiento_vacante_id, etapa_vacante_id) {\n    modal_movimiento_id_seleccionado = movimiento_id;\n    etapa_vacante_id_seleccionado = etapa_vacante_id;\n    etapa_movimiento_vacante_id_seleccionado = etapa_movimiento_vacante_id;\n    if (movimiento_id == 6) {\n        cargarPruebasPsicometricasVacantes();\n    } else {\n        $(`#modal-movimiento-${movimiento_id}`).modal('show');\n    }\n}\n\n/**\n * Activa o desactiva la automatización de etapas de vacantes y envía el formulario.\n *\n * @param {HTMLElement} elemento Elemento del toggle.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction automatizacionEtapas(elemento) {\n    if (!buscarFuncionalidad('automatizacion_etapas')) {\n        modalFuncionalidadInactiva();\n        $('#campo_automatizar_etapas').val(0);\n        return;\n    }\n\n    let valor = elemento ? 1 : 0;\n    $('#automatizar_etapas').val(valor);\n    $('#formulario-vacantes-paso-1').submit();\n}\n\n/**\n * Maneja la selección de archivos para preguntas prefiltro\n *\n * @author José Manuel Jiménez\n */\n$('#archivo_prueba').on('change', function (e) {\n    let archivos_seleccionados = e.target.files;\n    for (let i = 0; i < archivos_seleccionados.length; i++) {\n        let archivo = archivos_seleccionados[i];\n        let nombre_repetido = archivos_preguntas.some(item => item.archivo.name === archivo.name);\n        if (!nombre_repetido) {\n            archivos_preguntas.push({\n                archivo: archivo,\n                seleccionado: true,\n                id: Date.now() + '_' + i\n            });\n        } else {\n            mostrarToast('warning', `El archivo \"${archivo.name}\" ya fue seleccionado anteriormente.`);\n        }\n    }\n    $(this).val('');\n    renderizarArchivos();\n});\n\n/**\n * Renderiza los archivos seleccionados en el contenedor\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Sergio Vargas\n */\nfunction renderizarArchivos() {\n    let contenedor = $('#contenedor-archivos-preguntas-prefiltro');\n    contenedor.empty();\n    if (archivos_preguntas.length + archivos_cargados.length === 0) {\n        contenedor.html('<p class=\"text-muted\">No hay archivos seleccionados</p>');\n        return;\n    }\n\n    let documentos_nuevos = [];\n    let imagenes_nuevas = [];\n    let documentos_cargados = [];\n    let imagenes_cargadas = [];\n\n    archivos_preguntas.forEach((item) => {\n        if (!item.seleccionado) return;\n        if (item.archivo.type.startsWith('image/')) {\n            imagenes_nuevas.push(item);\n        } else {\n            documentos_nuevos.push(item);\n        }\n    });\n\n    archivos_cargados.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_cargados.push(archivo);\n        }\n    });\n\n    // Renderizar en orden: documentos primero, imágenes después\n    //Documentos nuevos\n    documentos_nuevos.forEach((item) => {\n        let archivo = item.archivo;\n        let extension = archivo.name.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"quitarArchivo('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    //Documentos cargados\n    documentos_cargados.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"eliminarArchivoServidor(${archivo.id})\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    //Imágenes nuevas\n    imagenes_nuevas.forEach((item) => {\n        let archivo = item.archivo;\n        let url_imagen = URL.createObjectURL(archivo);\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer\"\n                             src=\"${url_imagen}\"\n                             alt=\"${archivo.name}\"\n                             style=\"object-fit:cover; border-radius:6px; cursor: pointer;\"\n                             onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"quitarArchivo('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    //Imágenes cargadas\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        let html = `\n            <div class=\"col-4 archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer\"\n                             src=\"${url_imagen}\"\n                             alt=\"${archivo.nombre_original_archivo}\"\n                             style=\"object-fit:cover; border-radius:6px; cursor: pointer;\"\n                             onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"eliminarArchivoServidor(${archivo.id})\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    inicializarTooltips();\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Quita un archivo de la lista de archivos seleccionados\n *\n * @param {string} id ID del archivo a quitar\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction quitarArchivo(id) {\n    archivos_preguntas = archivos_preguntas.filter(item => item.id !== id);\n    renderizarArchivos();\n}\n\n/**\n * Elimina un archivo del servidor y actualiza la lista de archivos cargados\n *\n * @param {number} archivo_id ID del archivo a eliminar\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction eliminarArchivoServidor(archivo_id) {\n    $.ajax({\n        url: `/archivos/${archivo_id}`,\n        type: 'DELETE',\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message);\n            archivos_cargados = archivos_cargados.filter(item => item.id !== archivo_id);\n            renderizarArchivos();\n        }\n    });\n}\n\n/**\n * Adjunta los archivos seleccionados a la etapa de vacante\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction adjuntarArchivos() {\n    if (!etapa_vacante_id_seleccionado) {\n        mostrarToast('warning', 'Debe ingresar un ID de etapa de vacante');\n        return;\n    }\n    if (archivos_preguntas.length === 0) {\n        return;\n    }\n    let datos_form = new FormData();\n    let archivos_agregados = 0;\n    datos_form.append('_token', $('input[name=\"_token\"]').val());\n    datos_form.append('etapa_vacante_id', etapa_vacante_id_seleccionado);\n    archivos_preguntas.forEach(item => {\n        if (item.seleccionado) {\n            datos_form.append('archivos[]', item.archivo);\n            archivos_agregados++;\n        }\n    });\n\n    if (archivos_agregados === 0) {\n        return;\n    }\n\n    $.ajax({\n        type       : 'POST',\n        url        : '/etapas-vacantes-adjuntar-archivos',\n        data       : datos_form,\n        processData: false,\n        contentType: false\n    }).done((respuesta) => {\n        mostrarToast('success', respuesta.message);\n        $('#etapa_vacante_id_prueba').val('');\n        archivos_preguntas = [];\n        renderizarArchivos();\n    }).fail((error) => {\n        let mensaje = error.responseJSON?.message || 'Ocurrió un error al adjuntar los archivos';\n        mostrarToast('danger', mensaje);\n    });\n}\n\n/**\n * Validar las condiciones adicionales del formulario.\n *\n * @param {FormData} formulario Datos del formulario.\n * @returns {Promise<Array>}\n * @author Andres Gonzalez\n */\nfunction validacionAdicional(formulario) {\n    if (formulario == \"form-editar-plantilla-etapa\") {\n        if (!buscarFuncionalidad('plantillas_personalizadas')) {\n            modalFuncionalidadInactiva();\n            return false;\n        }\n    }\n\n    return true;\n}\n","structuredPatch":[{"oldStart":730,"oldLines":6,"newStart":730,"newLines":7,"lines":["     if (!buscarFuncionalidad('automatizacion_etapas')) {","         modalFuncionalidadInactiva();","         $('#campo_automatizar_etapas').val(0);","+        $('#campo_automatizar_etapas').prop('checked', false);","         return;","     }"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"06b0137e-eeb0-43c5-8515-e8759ec28224"}
{"parentUuid":"88405272-6d9e-4107-9dc6-7ac34603f25a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016E3prYC4QxZfoiJQ7PHXgr","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto, he agregado la línea `$('#campo_automatizar_etapas').prop('checked', false);` para que el toggle se desmarque cuando entre en el if de buscar funcionalidad. Ahora debería funcionar correctamente.","signature":"EvgCCkYICxgCKkDevH+c2EARGg6j9CMPtjrvCANU9/ywnXXZFG8Me70Jkcmi1FfiIhvsK0/T42R4JPZrw48msAKuFpzZJpXm1/xYEgzSrKbLKP7ajGAwexoaDJvgmBgyofSWTqIpSSIwWSqlPoekZVOQoVAWsqILeSHhac4IhYsfGRuwDsWSdPZ6KRFlPosSE0Dlb/dFF68QKt8B++1A36cfxs3WBqZmI2NyRmj6C1tqF7p9lU1Ifvqtuk7OUaoBS4mTrkFMkgDCQE1HFp6fs9XTPy2PraHy8DbYJgLDGjHAnomyIJozc5fOuGx6XBVG//F3Uhb0oZ6CMubn1BFRvxoU9ofPyH1T1l2ySNOLBMwt33tudfoolyFx/c0qZnU8EymDH+mMteRJZRL+7PPbVq5nOkmR0fQN7jF452rWULnf2ilCgKHbrd06f5QIRgkBjlzL9k4MOhVmCim0M+UlAKvGIGyBcKuWJLzYylKubKFYZH9lRZ8X6HnQoxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":1042,"cache_read_input_tokens":51827,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1042},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXZqVsxTzBAGED8cCqX2M","type":"assistant","uuid":"f81776f7-ee9d-40db-abad-5baebbf58a7a","timestamp":"2026-01-28T13:14:46.614Z"}
{"parentUuid":"f81776f7-ee9d-40db-abad-5baebbf58a7a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e029fe23-ca9f-430b-b411-a96f2f4fc964","version":"2.1.20","gitBranch":"D26-489","slug":"glittery-sprouting-babbage","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016E3prYC4QxZfoiJQ7PHXgr","type":"message","role":"assistant","content":[{"type":"text","text":"Listo! He agregado la línea `$('#campo_automatizar_etapas').prop('checked', false);` en la función `automatizacionEtapas`.\n\nAhora cuando entre en el if de `!buscarFuncionalidad('automatizacion_etapas')` (cuando la funcionalidad de automatización de etapas no está disponible), el toggle `campo_automatizar_etapas` quedará desmarcado aunque se le dé click.\n\nLa solución está en [vacantes-paso-2.js:733](public/js/vacantes/vacantes-paso-2.js#L733) donde se agregó la línea que desmarca el checkbox del toggle usando `.prop('checked', false)`."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":1042,"cache_read_input_tokens":51827,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1042},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXZqVsxTzBAGED8cCqX2M","type":"assistant","uuid":"d093e760-6ad0-4d46-b6ef-13cbfb7fc473","timestamp":"2026-01-28T13:14:49.090Z"}
