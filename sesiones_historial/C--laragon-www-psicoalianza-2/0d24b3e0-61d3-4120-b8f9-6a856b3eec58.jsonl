{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-13T21:03:18.664Z","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58"}
{"type":"file-history-snapshot","messageId":"675b07ac-d764-4e24-a92f-2021cb64d61d","snapshot":{"messageId":"675b07ac-d764-4e24-a92f-2021cb64d61d","trackedFileBackups":{},"timestamp":"2026-01-13T21:03:18.770Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\modals-movimientos\\modal-pruebas-psicometricas.blade.php in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"analiza este archivo con sus js resources\\views\\vacantes\\paginas\\crear.blade.php"}]},"uuid":"675b07ac-d764-4e24-a92f-2021cb64d61d","timestamp":"2026-01-13T21:03:18.764Z"}
{"parentUuid":"675b07ac-d764-4e24-a92f-2021cb64d61d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01DL544iGzJ4NjmgdMdgn8r7","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a analizar el archivo de la vista de creación de vacantes junto con sus archivos JavaScript asociados."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":24043,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24043,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX646cQboe42Ni1J43avj","type":"assistant","uuid":"61cc67ad-4760-429c-a24a-d3040bd44539","timestamp":"2026-01-13T21:03:21.897Z"}
{"parentUuid":"61cc67ad-4760-429c-a24a-d3040bd44539","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01DL544iGzJ4NjmgdMdgn8r7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VUR7mPcZWdYm2ZVAtJ3G9T","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\crear.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":24043,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24043,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX646cQboe42Ni1J43avj","type":"assistant","uuid":"77e68cf8-ebd9-40a6-8653-64a6955b0416","timestamp":"2026-01-13T21:03:22.601Z"}
{"parentUuid":"77e68cf8-ebd9-40a6-8653-64a6955b0416","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01DL544iGzJ4NjmgdMdgn8r7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018TzFmdV86D7m7DAgWBjq4R","name":"Glob","input":{"pattern":"**/vacantes/**/*.js"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":24043,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24043,"ephemeral_1h_input_tokens":0},"output_tokens":150,"service_tier":"standard"}},"requestId":"req_011CX646cQboe42Ni1J43avj","type":"assistant","uuid":"2f7abb9f-2bba-444a-a7b3-6b326690f167","timestamp":"2026-01-13T21:03:23.019Z"}
{"parentUuid":"77e68cf8-ebd9-40a6-8653-64a6955b0416","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VUR7mPcZWdYm2ZVAtJ3G9T","type":"tool_result","content":"     1→@extends('layouts.app')\n     2→\n     3→@section('titulo', 'Vacantes')\n     4→\n     5→@section('estilos')\n     6→    <link href=\"{{ asset('css/vacantes/vacantes.css') }}\" rel=\"stylesheet\">\n     7→    <link href=\"{{ asset('css/perfiles/perfiles.css') }}\" rel=\"stylesheet\">\n     8→@endsection\n     9→\n    10→@section('contenido')\n    11→    <div class=\"col-12 ps-14 pb-4\">\n    12→        @php\n    13→            $tipo_formulario = !empty($vacante) ? 'Editar' : 'Crear';\n    14→            $migas_pan       = [\n    15→                ['nombre' => 'Producto selección', 'url' => '/procesos'],\n    16→                ['nombre' => 'Vacantes', 'url' => '/vacantes'],\n    17→                ['nombre' => $tipo_formulario . ' vacante', 'url' => '', 'active' => true]\n    18→            ];\n    19→        @endphp\n    20→\n    21→        ${crearMigaDePan({migas:@json($migas_pan), volver:true})}\n    22→    </div>\n    23→\n    24→    <div class=\"row justify-content-center bg-light-gray py-5 px-5\">\n    25→        <div class=\"col-12 col-lg-11 col-xl-9 py-5 px-0 bg-white rounded-3 shadow-1\">\n    26→            <div class=\"container-fluid\">\n    27→                <div class=\"row\">\n    28→                    <div class=\"col-12\">\n    29→                        ${crearSeccionPasos({\n    30→                            id: 'vacantes',\n    31→                            tab_content_class: 'mt-10 border-top row',\n    32→                            tabs: [\n    33→                                {\n    34→                                    id: 'paso-1',\n    35→                                    titulo: `1`,\n    36→                                    subtitulo: `Información`,\n    37→                                    contenido: `\n    38→                                        @include('vacantes.paginas.formularios.formulario-informacion')\n    39→                                    `,\n    40→                                    activo: true\n    41→                                },\n    42→                                {\n    43→                                    id: 'paso-2',\n    44→                                    titulo: `2`,\n    45→                                    subtitulo: `Etapas`,\n    46→                                    contenido: `\n    47→                                        @include('vacantes.paginas.formularios.formulario-etapas')\n    48→                                    `,\n    49→                                    disabled: true,\n    50→                                    activo: false,\n    51→                                    onclick: `$('#formulario-vacantes-paso-1').submit();`\n    52→                                },\n    53→                            ]\n    54→                        })}\n    55→                    </div>\n    56→                </div>\n    57→            </div>\n    58→        </div>\n    59→    </div>\n    60→@endsection\n    61→\n    62→@section('modals')\n    63→    ${crearModal({\n    64→        id: 'modal-editar-plantilla-etapa',\n    65→        dialog_class: 'modal-lg modal-dialog-centered',\n    66→        titulo_header: 'Configurar notificación',\n    67→        boton_footer1: {\n    68→            type: 'button',\n    69→            texto: 'Cancelar',\n    70→            class: 'btn-outline-primary',\n    71→            cerrar_modal: false,\n    72→            id: 'btn-cancelar-plantilla-etapa',\n    73→        },\n    74→        boton_footer2: {\n    75→            type: 'submit',\n    76→            texto: 'Guardar',\n    77→            class: 'btn-primary',\n    78→            cerrar_modal: false,\n    79→            form: 'form-editar-plantilla-etapa'\n    80→        },\n    81→        modal_body: `\n    82→            <form class=\"w-100\" id=\"form-editar-plantilla-etapa\" action=\"/plantillas-correos\">\n    83→                @csrf\n    84→                <input type=\"hidden\" id=\"id\" name=\"id\">\n    85→                <input type=\"hidden\" id=\"etapa_id\" name=\"etapa_id\" class=\"input-dinamico\">\n    86→                <input type=\"hidden\" id=\"grupo_id\" name=\"grupo_id\" value=\"2\">\n    87→                <input type=\"hidden\" id=\"empresa_id\" name=\"empresa_id\">\n    88→                <input type=\"hidden\" id=\"plantilla_correo_id\" name=\"plantilla_correo_id\">\n    89→                <input type=\"hidden\" id=\"contenido\" name=\"contenido\">\n    90→                <input type=\"hidden\" id=\"con_logo_empresa\" name=\"con_logo_empresa\">\n    91→                <input type=\"hidden\" id=\"notificar_fin_proceso\" name=\"notificar_fin_proceso\">\n    92→\n    93→                <div class=\"row\">\n    94→                    <div class=\"col-6 text-body-2 my-auto\">\n    95→                        <i class=\"bi bi-card-checklist\"></i>\n    96→                        <span class=\"text-gray-10\">Plantilla:</span>\n    97→                        <span class=\"text-gray-30 text-body-2\" id=\"titulo-plantilla-modal\"></span>\n    98→                    </div>\n    99→                    <div class=\"col-6 text-end\">\n   100→                        ${crearBoton({\n   101→                            id: 'restablecer_texto',\n   102→                            clases: 'btn-outline-primary',\n   103→                            texto: `\n   104→                                <i class=\"bi bi-arrow-repeat me-2\"></i>Restablecer texto\n   105→                            `,\n   106→                            type: 'button',\n   107→                        })}\n   108→                    </div>\n   109→                </div>\n   110→                <div class=\"row mt-4\">\n   111→                    <div class=\"col-12\">\n   112→                        ${crearInput({\n   113→                            id: 'titulo_mensaje_plantilla',\n   114→                            label: 'Titulo o asunto del mensaje',\n   115→                            name: 'titulo',\n   116→                            required: true,\n   117→                            type: 'text',\n   118→                        })}\n   119→                    </div>\n   120→                    <div class=\"col-12\">\n   121→                        <h1 class=\"text-body-2\">Descripción del mensaje</h1>\n   122→                    </div>\n   123→                    <div class=\"col-12\" id=\"contenedor_editor_texto\"></div>\n   124→\n   125→                    <div class=\"col-12\">\n   126→                        ${crearCheckbox({\n   127→                            id: 'con_logo',\n   128→                            class: 'input-dinamico',\n   129→                            label: 'Agregar logo de empresa',\n   130→                        })}\n   131→                    </div>\n   132→                    <div class=\"col-12\" id=\"contenedor_check_enviar_al_finalizar\"></div>\n   133→                </div>\n   134→            </form>\n   135→        `\n   136→    })}\n   137→    ${crearModal({\n   138→        id: 'modal-vacante-ia',\n   139→        dialog_class: 'modal-md modal-dialog-centered',\n   140→        titulo_header: 'Generar mediante IA',\n   141→        boton_footer1: {\n   142→            type: 'button',\n   143→            texto: 'Cancelar',\n   144→            class: 'btn-outline-primary',\n   145→            cerrar_modal: true,\n   146→        },\n   147→        boton_footer2: {\n   148→            type: 'button',\n   149→            texto: '<img class=\"me-3\" src=\"{{ asset('/iconos/icono_ia.svg') }}\"> Generar vacante',\n   150→            class: 'btn-yellow',\n   151→            cerrar_modal: false,\n   152→            onclick: `generarVacanteIA()`\n   153→        },\n   154→        modal_body: `\n   155→            <div class=\"col-12\">\n   156→                <div class=\"row\">\n   157→                    <div class=\"col-12 mb-4 text-body-3 text-gray-30\">\n   158→                        Detalla el perfil que buscas, incluyendo habilidades, experiencia y nivel educativo. Entre más detalles incluyas, más precisa será la vacante generada.\n   159→                    </div>\n   160→                    <div class=\"col-12\">\n   161→                        ${crearTextarea({\n   162→                            id: 'descripcion_vacante_ia',\n   163→                            name: 'descripcion_vacante_ia',\n   164→                            class: 'py-3',\n   165→                            placeholder: '',\n   166→                            value: ``,\n   167→                            label: 'Descripción de la vacante',\n   168→                        })}\n   169→                    </div>\n   170→                </div>\n   171→            </div>\n   172→        `\n   173→    })}\n   174→    ${crearModal({\n   175→        id: 'modal-generando-ia',\n   176→        dialog_class: 'modal-md modal-dialog-centered',\n   177→        adiconales_modals_header: `data-bs-backdrop=\"static\"`,\n   178→        header_cerrar: 'd-none',\n   179→        titulo_header: 'Generando...',\n   180→        modal_body: `\n   181→            <div class=\"col-12\">\n   182→                <div class=\"row justify-content-center\">\n   183→                    <div class=\"col-4\">\n   184→                        <img class=\"w-100\" src=\"{{ asset('/imagenes/gifs/cargue-ia.gif') }}\">\n   185→                    </div>\n   186→                </div>\n   187→            </div>\n   188→        `\n   189→    })}\n   190→    @include('vacantes.paginas.formularios.modals-movimientos.modal-revision-hv')\n   191→    @include('vacantes.paginas.formularios.modals-movimientos.modal-preguntas-prefiltro')\n   192→    @include('vacantes.paginas.formularios.modals-movimientos/modal-pruebas-psicometricas')\n   193→    @include('vacantes.paginas.formularios.modals-movimientos.modal-prueba-tecnica')\n   194→    @include('vacantes.paginas.formularios.modals-movimientos.modal-video-entrevista')\n   195→    @include('vacantes.paginas.formularios.modals-movimientos.modal-entrevista')\n   196→    @include('vacantes.paginas.formularios.modals-movimientos.modal-documentos-contratacion')\n   197→\n   198→    {{-- Modal de previsualización de imágenes --}}\n   199→    ${crearModal({\n   200→        id: 'modal-previsualizacion-imagen',\n   201→        dialog_class: 'modal-lg modal-dialog-centered',\n   202→        titulo_header: 'Previsualización',\n   203→        modal_body: `\n   204→            <div class=\"col-12 p-0 overflow-hidden border rounded-3\">\n   205→                <img class=\"w-100\" id=\"imagen-previsualizacion\" src=\"\" alt=\"Imagen ampliada\">\n   206→            </div>\n   207→            <div class=\"col-12 mt-4\">\n   208→                <div class=\"row align-items-center\">\n   209→                    <div class=\"col-auto\">\n   210→                        <i class=\"h4 mb-0 bi bi-dash-circle pointer text-blue-20\" id=\"zoom-out\"></i>\n   211→                    </div>\n   212→                    <div class=\"col\">\n   213→                        <i class=\"h4 mb-0 bi bi-plus-circle pointer text-blue-20\" id=\"zoom-in\"></i>\n   214→                    </div>\n   215→                    <div class=\"col-auto pe-0\">\n   216→                        ${crearBoton({ clases: 'btn-primary', texto: 'Descargar imagen', id: 'descargar-imagen' })}\n   217→                    </div>\n   218→                </div>\n   219→            </div>\n   220→        `\n   221→    })}\n   222→\n   223→    @include('perfiles.componentes.modal-crear-perfil')\n   224→    @include('perfiles.componentes.modal-resumen-perfil')\n   225→@endsection\n   226→\n   227→@section('scripts')\n   228→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/crear-editar-vacantes.js') }}\"></script>\n   229→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-funciones.js') }}\"></script>\n   230→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-paso-1.js') }}\"></script>\n   231→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-paso-2.js') }}\"></script>\n   232→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/funciones-modals-movimientos.js') }}\"></script>\n   233→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-pruebas-psicometricas.js') }}\"></script>\n   234→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-revision-hv.js') }}\"></script>\n   235→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-preguntas-prefiltro.js') }}\"></script>\n   236→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-prueba-tecnica.js') }}\"></script>\n   237→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-video-entrevista.js') }}\"></script>\n   238→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-entrevista.js') }}\"></script>\n   239→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-documentos.js') }}\"></script>\n   240→    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-ia.js') }}\"></script>\n   241→    <script type=\"text/javascript\" src=\"{{ asset('js/seleccion/perfiles-pruebas/perfiles-pruebas.js') }}\"></script>\n   242→    <script type=\"text/javascript\">\n   243→        let empresa = @json($empresa);\n   244→        const EMPRESA_ID = @json(\\Auth::user()->empresa->id);\n   245→        let etapas_vacante = [];\n   246→        let modalidades_trabajos = @json($modalidades_trabajos);\n   247→    </script>\n   248→@endsection\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c3327896-41ed-4b52-be58-65aa5db5c5ac","timestamp":"2026-01-13T21:03:26.914Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\crear.blade.php","content":"@extends('layouts.app')\n\n@section('titulo', 'Vacantes')\n\n@section('estilos')\n    <link href=\"{{ asset('css/vacantes/vacantes.css') }}\" rel=\"stylesheet\">\n    <link href=\"{{ asset('css/perfiles/perfiles.css') }}\" rel=\"stylesheet\">\n@endsection\n\n@section('contenido')\n    <div class=\"col-12 ps-14 pb-4\">\n        @php\n            $tipo_formulario = !empty($vacante) ? 'Editar' : 'Crear';\n            $migas_pan       = [\n                ['nombre' => 'Producto selección', 'url' => '/procesos'],\n                ['nombre' => 'Vacantes', 'url' => '/vacantes'],\n                ['nombre' => $tipo_formulario . ' vacante', 'url' => '', 'active' => true]\n            ];\n        @endphp\n\n        ${crearMigaDePan({migas:@json($migas_pan), volver:true})}\n    </div>\n\n    <div class=\"row justify-content-center bg-light-gray py-5 px-5\">\n        <div class=\"col-12 col-lg-11 col-xl-9 py-5 px-0 bg-white rounded-3 shadow-1\">\n            <div class=\"container-fluid\">\n                <div class=\"row\">\n                    <div class=\"col-12\">\n                        ${crearSeccionPasos({\n                            id: 'vacantes',\n                            tab_content_class: 'mt-10 border-top row',\n                            tabs: [\n                                {\n                                    id: 'paso-1',\n                                    titulo: `1`,\n                                    subtitulo: `Información`,\n                                    contenido: `\n                                        @include('vacantes.paginas.formularios.formulario-informacion')\n                                    `,\n                                    activo: true\n                                },\n                                {\n                                    id: 'paso-2',\n                                    titulo: `2`,\n                                    subtitulo: `Etapas`,\n                                    contenido: `\n                                        @include('vacantes.paginas.formularios.formulario-etapas')\n                                    `,\n                                    disabled: true,\n                                    activo: false,\n                                    onclick: `$('#formulario-vacantes-paso-1').submit();`\n                                },\n                            ]\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n@endsection\n\n@section('modals')\n    ${crearModal({\n        id: 'modal-editar-plantilla-etapa',\n        dialog_class: 'modal-lg modal-dialog-centered',\n        titulo_header: 'Configurar notificación',\n        boton_footer1: {\n            type: 'button',\n            texto: 'Cancelar',\n            class: 'btn-outline-primary',\n            cerrar_modal: false,\n            id: 'btn-cancelar-plantilla-etapa',\n        },\n        boton_footer2: {\n            type: 'submit',\n            texto: 'Guardar',\n            class: 'btn-primary',\n            cerrar_modal: false,\n            form: 'form-editar-plantilla-etapa'\n        },\n        modal_body: `\n            <form class=\"w-100\" id=\"form-editar-plantilla-etapa\" action=\"/plantillas-correos\">\n                @csrf\n                <input type=\"hidden\" id=\"id\" name=\"id\">\n                <input type=\"hidden\" id=\"etapa_id\" name=\"etapa_id\" class=\"input-dinamico\">\n                <input type=\"hidden\" id=\"grupo_id\" name=\"grupo_id\" value=\"2\">\n                <input type=\"hidden\" id=\"empresa_id\" name=\"empresa_id\">\n                <input type=\"hidden\" id=\"plantilla_correo_id\" name=\"plantilla_correo_id\">\n                <input type=\"hidden\" id=\"contenido\" name=\"contenido\">\n                <input type=\"hidden\" id=\"con_logo_empresa\" name=\"con_logo_empresa\">\n                <input type=\"hidden\" id=\"notificar_fin_proceso\" name=\"notificar_fin_proceso\">\n\n                <div class=\"row\">\n                    <div class=\"col-6 text-body-2 my-auto\">\n                        <i class=\"bi bi-card-checklist\"></i>\n                        <span class=\"text-gray-10\">Plantilla:</span>\n                        <span class=\"text-gray-30 text-body-2\" id=\"titulo-plantilla-modal\"></span>\n                    </div>\n                    <div class=\"col-6 text-end\">\n                        ${crearBoton({\n                            id: 'restablecer_texto',\n                            clases: 'btn-outline-primary',\n                            texto: `\n                                <i class=\"bi bi-arrow-repeat me-2\"></i>Restablecer texto\n                            `,\n                            type: 'button',\n                        })}\n                    </div>\n                </div>\n                <div class=\"row mt-4\">\n                    <div class=\"col-12\">\n                        ${crearInput({\n                            id: 'titulo_mensaje_plantilla',\n                            label: 'Titulo o asunto del mensaje',\n                            name: 'titulo',\n                            required: true,\n                            type: 'text',\n                        })}\n                    </div>\n                    <div class=\"col-12\">\n                        <h1 class=\"text-body-2\">Descripción del mensaje</h1>\n                    </div>\n                    <div class=\"col-12\" id=\"contenedor_editor_texto\"></div>\n\n                    <div class=\"col-12\">\n                        ${crearCheckbox({\n                            id: 'con_logo',\n                            class: 'input-dinamico',\n                            label: 'Agregar logo de empresa',\n                        })}\n                    </div>\n                    <div class=\"col-12\" id=\"contenedor_check_enviar_al_finalizar\"></div>\n                </div>\n            </form>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-vacante-ia',\n        dialog_class: 'modal-md modal-dialog-centered',\n        titulo_header: 'Generar mediante IA',\n        boton_footer1: {\n            type: 'button',\n            texto: 'Cancelar',\n            class: 'btn-outline-primary',\n            cerrar_modal: true,\n        },\n        boton_footer2: {\n            type: 'button',\n            texto: '<img class=\"me-3\" src=\"{{ asset('/iconos/icono_ia.svg') }}\"> Generar vacante',\n            class: 'btn-yellow',\n            cerrar_modal: false,\n            onclick: `generarVacanteIA()`\n        },\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col-12 mb-4 text-body-3 text-gray-30\">\n                        Detalla el perfil que buscas, incluyendo habilidades, experiencia y nivel educativo. Entre más detalles incluyas, más precisa será la vacante generada.\n                    </div>\n                    <div class=\"col-12\">\n                        ${crearTextarea({\n                            id: 'descripcion_vacante_ia',\n                            name: 'descripcion_vacante_ia',\n                            class: 'py-3',\n                            placeholder: '',\n                            value: ``,\n                            label: 'Descripción de la vacante',\n                        })}\n                    </div>\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-generando-ia',\n        dialog_class: 'modal-md modal-dialog-centered',\n        adiconales_modals_header: `data-bs-backdrop=\"static\"`,\n        header_cerrar: 'd-none',\n        titulo_header: 'Generando...',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center\">\n                    <div class=\"col-4\">\n                        <img class=\"w-100\" src=\"{{ asset('/imagenes/gifs/cargue-ia.gif') }}\">\n                    </div>\n                </div>\n            </div>\n        `\n    })}\n    @include('vacantes.paginas.formularios.modals-movimientos.modal-revision-hv')\n    @include('vacantes.paginas.formularios.modals-movimientos.modal-preguntas-prefiltro')\n    @include('vacantes.paginas.formularios.modals-movimientos/modal-pruebas-psicometricas')\n    @include('vacantes.paginas.formularios.modals-movimientos.modal-prueba-tecnica')\n    @include('vacantes.paginas.formularios.modals-movimientos.modal-video-entrevista')\n    @include('vacantes.paginas.formularios.modals-movimientos.modal-entrevista')\n    @include('vacantes.paginas.formularios.modals-movimientos.modal-documentos-contratacion')\n\n    {{-- Modal de previsualización de imágenes --}}\n    ${crearModal({\n        id: 'modal-previsualizacion-imagen',\n        dialog_class: 'modal-lg modal-dialog-centered',\n        titulo_header: 'Previsualización',\n        modal_body: `\n            <div class=\"col-12 p-0 overflow-hidden border rounded-3\">\n                <img class=\"w-100\" id=\"imagen-previsualizacion\" src=\"\" alt=\"Imagen ampliada\">\n            </div>\n            <div class=\"col-12 mt-4\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        <i class=\"h4 mb-0 bi bi-dash-circle pointer text-blue-20\" id=\"zoom-out\"></i>\n                    </div>\n                    <div class=\"col\">\n                        <i class=\"h4 mb-0 bi bi-plus-circle pointer text-blue-20\" id=\"zoom-in\"></i>\n                    </div>\n                    <div class=\"col-auto pe-0\">\n                        ${crearBoton({ clases: 'btn-primary', texto: 'Descargar imagen', id: 'descargar-imagen' })}\n                    </div>\n                </div>\n            </div>\n        `\n    })}\n\n    @include('perfiles.componentes.modal-crear-perfil')\n    @include('perfiles.componentes.modal-resumen-perfil')\n@endsection\n\n@section('scripts')\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/crear-editar-vacantes.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-funciones.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-paso-1.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-paso-2.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/funciones-modals-movimientos.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-pruebas-psicometricas.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-revision-hv.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-preguntas-prefiltro.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-prueba-tecnica.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-video-entrevista.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-entrevista.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/modals-movimientos/modal-documentos.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/vacantes/vacantes-ia.js') }}\"></script>\n    <script type=\"text/javascript\" src=\"{{ asset('js/seleccion/perfiles-pruebas/perfiles-pruebas.js') }}\"></script>\n    <script type=\"text/javascript\">\n        let empresa = @json($empresa);\n        const EMPRESA_ID = @json(\\Auth::user()->empresa->id);\n        let etapas_vacante = [];\n        let modalidades_trabajos = @json($modalidades_trabajos);\n    </script>\n@endsection","numLines":248,"startLine":1,"totalLines":248}},"sourceToolAssistantUUID":"77e68cf8-ebd9-40a6-8653-64a6955b0416"}
{"parentUuid":"2f7abb9f-2bba-444a-a7b3-6b326690f167","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018TzFmdV86D7m7DAgWBjq4R","type":"tool_result","content":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-prueba-tecnica.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-revision-hv.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-funciones.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-documentos.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-entrevista.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-preguntas-prefiltro.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-pruebas-psicometricas.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-video-entrevista.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-1.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-2.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\aplicante\\postulaciones.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\general-vacantes.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-ia.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\funciones-modals-movimientos.js\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\crear-editar-vacantes.js"}]},"uuid":"9a7a1238-3e10-4e09-bbd8-4e858ec7bd5f","timestamp":"2026-01-13T21:03:30.430Z","toolUseResult":{"filenames":["c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-prueba-tecnica.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-revision-hv.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-funciones.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-documentos.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-entrevista.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-preguntas-prefiltro.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-pruebas-psicometricas.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-video-entrevista.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-1.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-2.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\aplicante\\postulaciones.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\general-vacantes.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-ia.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-etapas.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\funciones-modals-movimientos.js","c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\crear-editar-vacantes.js"],"durationMs":5627,"numFiles":19,"truncated":false},"sourceToolAssistantUUID":"2f7abb9f-2bba-444a-a7b3-6b326690f167"}
{"parentUuid":"9a7a1238-3e10-4e09-bbd8-4e858ec7bd5f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XapWdhGzWrKE5DxhGabYvh","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a leer los archivos JavaScript principales que se cargan en esta vista:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":4993,"cache_read_input_tokens":24043,"cache_creation":{"ephemeral_5m_input_tokens":4993,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX647TiVVoyLhiHs9YRfn","type":"assistant","uuid":"4c32a81e-e96e-48a4-981d-5088fc1958bd","timestamp":"2026-01-13T21:03:33.293Z"}
{"parentUuid":"4c32a81e-e96e-48a4-981d-5088fc1958bd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XapWdhGzWrKE5DxhGabYvh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KreAWu4YM4YdgE9UF9NEqs","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\crear-editar-vacantes.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":4993,"cache_read_input_tokens":24043,"cache_creation":{"ephemeral_5m_input_tokens":4993,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX647TiVVoyLhiHs9YRfn","type":"assistant","uuid":"de59a6c8-b67f-49a7-89c4-82040577f846","timestamp":"2026-01-13T21:03:33.874Z"}
{"parentUuid":"de59a6c8-b67f-49a7-89c4-82040577f846","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XapWdhGzWrKE5DxhGabYvh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FQuUPrN38Uf7gnteY3qMgG","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-funciones.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":4993,"cache_read_input_tokens":24043,"cache_creation":{"ephemeral_5m_input_tokens":4993,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX647TiVVoyLhiHs9YRfn","type":"assistant","uuid":"5dd53659-b178-40d2-8a13-56243f711e19","timestamp":"2026-01-13T21:03:34.385Z"}
{"parentUuid":"5dd53659-b178-40d2-8a13-56243f711e19","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XapWdhGzWrKE5DxhGabYvh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JiAho11JvMrQufredP4a3e","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-1.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":4993,"cache_read_input_tokens":24043,"cache_creation":{"ephemeral_5m_input_tokens":4993,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX647TiVVoyLhiHs9YRfn","type":"assistant","uuid":"63c643fa-d398-4c1d-a306-e1d213fc1f34","timestamp":"2026-01-13T21:03:34.927Z"}
{"parentUuid":"63c643fa-d398-4c1d-a306-e1d213fc1f34","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XapWdhGzWrKE5DxhGabYvh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MCWeeZ1WjERsxbzMPAMbR2","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-2.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":4993,"cache_read_input_tokens":24043,"cache_creation":{"ephemeral_5m_input_tokens":4993,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX647TiVVoyLhiHs9YRfn","type":"assistant","uuid":"8e4dde1f-2697-445b-9197-c83919355427","timestamp":"2026-01-13T21:03:35.517Z"}
{"parentUuid":"8e4dde1f-2697-445b-9197-c83919355427","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XapWdhGzWrKE5DxhGabYvh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QEn6zkPE2HD41hqHmPdrTx","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\funciones-modals-movimientos.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":4993,"cache_read_input_tokens":24043,"cache_creation":{"ephemeral_5m_input_tokens":4993,"ephemeral_1h_input_tokens":0},"output_tokens":366,"service_tier":"standard"}},"requestId":"req_011CX647TiVVoyLhiHs9YRfn","type":"assistant","uuid":"c4955ec0-3880-47fe-8fdf-35cf24987ed9","timestamp":"2026-01-13T21:03:35.924Z"}
{"parentUuid":"de59a6c8-b67f-49a7-89c4-82040577f846","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KreAWu4YM4YdgE9UF9NEqs","type":"tool_result","content":"     1→/**\n     2→ * Archivo principal para crear y editar vacantes\n     3→ * Contiene funciones compartidas entre los pasos del formulario\n     4→ * @author Andres Morales\n     5→ * @author José Manuel Jiménez\n     6→ */\n     7→\n     8→/**\n     9→ * Validaciones adicionales antes de enviar el formulario.\n    10→ *\n    11→ * @param {string} formulario Identificador del formulario actual.\n    12→ * @returns {boolean} True si es válido, false en caso contrario.\n    13→ * @author José Manuel Jiménez\n    14→ * @author Andres Morales\n    15→ */\n    16→function validacionAdicional(formulario) {\n    17→    if (formulario === 'form-editar-plantilla-etapa') {\n    18→        return validacionPlantillaEtapa();\n    19→    }\n    20→\n    21→    if (formulario === 'formulario-vacantes-paso-1') {\n    22→        return validacionVacantesPaso1();\n    23→    }\n    24→\n    25→    if (formulario.includes('form-movimiento')) {\n    26→        return validacionFormularioMovimientoVacante(formulario);\n    27→    }\n    28→\n    29→    return true;\n    30→}\n    31→\n    32→/**\n    33→ * Validación específica para el formulario de plantilla de etapa\n    34→ *\n    35→ * @returns {boolean} True si la validación es exitosa\n    36→ * @author Andres Morales\n    37→ */\n    38→function validacionPlantillaEtapa() {\n    39→    var titulo = $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val();\n    40→    if (!titulo || titulo.trim() === '') {\n    41→        mostrarToast('warning', 'El título o asunto del mensaje es requerido');\n    42→        return false;\n    43→    }\n    44→\n    45→    var editor = $('#descripcion_mensaje_etapa').data('editor');\n    46→    var contenido_editor = '';\n    47→\n    48→    if (editor) {\n    49→        contenido_editor = editor.getData();\n    50→        $('#contenido').val(contenido_editor);\n    51→    }\n    52→\n    53→    var contenido_texto = contenido_editor.replace(/<[^>]*>/g, '').trim();\n    54→    if (!contenido_texto || contenido_texto === '') {\n    55→        mostrarToast('warning', 'La descripción del mensaje es requerida');\n    56→        return false;\n    57→    }\n    58→\n    59→    $('#con_logo_empresa').val($('#con_logo').is(':checked') ? 1 : 0);\n    60→\n    61→    if ($('#enviar_finalizar').length) {\n    62→        $('#notificar_fin_proceso').val($('#enviar_finalizar').is(':checked') ? 1 : 0);\n    63→    }\n    64→\n    65→    if (typeof empresa !== 'undefined' && empresa && empresa.id) {\n    66→        $('#modal-editar-plantilla-etapa #empresa_id').val(empresa.id);\n    67→    }\n    68→\n    69→    return true;\n    70→}\n    71→\n    72→/**\n    73→ * Validación específica para el paso 1 de vacantes\n    74→ *\n    75→ * @returns {boolean} True si es válido, false en caso contrario\n    76→ * @author José Manuel Jiménez\n    77→ * @author Andres Morales\n    78→ */\n    79→function validacionVacantesPaso1() {\n    80→    if ($('input[name=\"tipo_salario\"]:checked').val() === 'a_convenir') {\n    81→        let salario_desde = parseFloat(limpiarCleave($('#salario_desde').val())) || 0;\n    82→        let salario_hasta = parseFloat(limpiarCleave($('#salario_hasta').val())) || 0;\n    83→        if (salario_desde >= salario_hasta) {\n    84→            $('#titulo-tab-pasos-vacantes-paso-1').click();\n    85→            mostrarToast('warning', 'El salario hasta no debe ser menor o igual al salario desde');\n    86→            return false;\n    87→        } else if (salario_desde < 0 || salario_hasta < 0) {\n    88→            $('#titulo-tab-pasos-vacantes-paso-1').click();\n    89→            mostrarToast('warning', 'Los valores de salario no pueden ser negativos.');\n    90→            return false;\n    91→        }\n    92→    } else if ($('input[name=\"tipo_salario\"]:checked').val() === 'especifico') {\n    93→        let salario_cantidad = parseFloat(limpiarCleave($('#salario_cantidad').val())) || 0;\n    94→        if (salario_cantidad < 0) {\n    95→            $('#titulo-tab-pasos-vacantes-paso-1').click();\n    96→            mostrarToast('warning', 'El salario no puede ser negativo.');\n    97→            return false;\n    98→        }\n    99→    }\n   100→\n   101→    if ($('input[name=\"tipo_edad\"]:checked').val() === 'rango') {\n   102→        let edad_desde = parseInt($('#edad_desde').val()) || 0;\n   103→        let edad_hasta = parseInt($('#edad_hasta').val()) || 0;\n   104→        if (edad_desde > edad_hasta) {\n   105→            mostrarToast('warning', 'La edad máxima no debe ser menor que la edad mínima.');\n   106→            $('#titulo-tab-pasos-vacantes-paso-1').click();\n   107→            return false;\n   108→        } else if (edad_hasta < 15 || edad_desde < 15) {\n   109→            mostrarToast('warning', 'La edad mínima debe ser 15 años.');\n   110→            $('#titulo-tab-pasos-vacantes-paso-1').click();\n   111→            return false;\n   112→        }\n   113→    }\n   114→\n   115→    let habilidades_seleccionadas = $('#habilidades').val();\n   116→    let habilidades = Array.isArray(habilidades_seleccionadas) ? habilidades_seleccionadas.join(', ') : '';\n   117→\n   118→    let herramientas_seleccionadas = $('#herramientas_tecnologicas').val();\n   119→    let herramientas = Array.isArray(herramientas_seleccionadas) ? herramientas_seleccionadas.join(', ') : '';\n   120→\n   121→    // Validar que habilidades sea obligatorio\n   122→    if (!habilidades || habilidades.trim() === '') {\n   123→        $('#titulo-tab-pasos-vacantes-paso-1').click();\n   124→        mostrarToast('warning', 'Debes seleccionar al menos una habilidad.');\n   125→        return false;\n   126→    }\n   127→\n   128→    // Validar que herramientas tecnológicas sea obligatorio\n   129→    if (!herramientas || herramientas.trim() === '') {\n   130→        $('#titulo-tab-pasos-vacantes-paso-1').click();\n   131→        mostrarToast('warning', 'Debes seleccionar al menos una herramienta tecnológica.');\n   132→        return false;\n   133→    }\n   134→\n   135→    let informacion = {\n   136→        habilidades: {\n   137→            valor: habilidades,\n   138→            es_privado: false\n   139→        },\n   140→        herramientas_tecnologicas: {\n   141→            valor: herramientas,\n   142→            es_privado: false\n   143→        },\n   144→        direccion_trabajo: {\n   145→            valor: $('#direccion_trabajo').val() || '',\n   146→            es_privado: false\n   147→        },\n   148→        funciones: {\n   149→            valor: $('#funciones').val() || '',\n   150→        }\n   151→    };\n   152→    $('#informacion').val(JSON.stringify(informacion));\n   153→\n   154→    let genero_seleccionado = $('input[name=\"genero\"]:checked').val() || 'indiferente';\n   155→    let tipo_edad = $('input[name=\"tipo_edad\"]:checked').val();\n   156→    let edad_minima = tipo_edad === 'rango' ? $('#edad_desde').val() : '';\n   157→    let edad_maxima = tipo_edad === 'rango' ? $('#edad_hasta').val() : '';\n   158→    let experiencia_laboral = $('#experiencia_laboral').val() || '';\n   159→    let nivel_educativo = $('#nivel_educativo_vacante').val() || '';\n   160→    let vacante_apta_discapacitados = $('#vacante_apta_discapacitados').prop('checked') ? '1' : '0';\n   161→\n   162→    let requisitos = {\n   163→        genero: {\n   164→            valor: genero_seleccionado,\n   165→            es_privado: false\n   166→        },\n   167→        edad_minima: {\n   168→            valor: edad_minima,\n   169→            es_privado: false\n   170→        },\n   171→        edad_maxima: {\n   172→            valor: edad_maxima,\n   173→            es_privado: false\n   174→        },\n   175→        experiencia_laboral: {\n   176→            valor: experiencia_laboral,\n   177→            es_privado: false\n   178→        },\n   179→        nivel_educativo: {\n   180→            valor: nivel_educativo,\n   181→            es_privado: false\n   182→        }\n   183→    };\n   184→\n   185→    if ($('#licencia_conducir').prop('checked')) {\n   186→        let tipo_licencia = $('#tipo_licencia').val();\n   187→        if (tipo_licencia) {\n   188→            requisitos.licencia_conducir = {\n   189→                valor: tipo_licencia,\n   190→                es_privado: false\n   191→            };\n   192→        }\n   193→    }\n   194→\n   195→    requisitos.vacante_apta_discapacitados = {\n   196→        valor: vacante_apta_discapacitados,\n   197→        es_privado: false\n   198→    };\n   199→    $('#requisitos').val(JSON.stringify(requisitos));\n   200→\n   201→    let idiomas_seleccionados = [];\n   202→    let idiomas = $('.idioma');\n   203→    let niveles = $('.nivel-idioma');\n   204→    for (let i = 0; i < idiomas.length; i++) {\n   205→        idiomas_seleccionados.push({\n   206→            idioma_id: parseInt($(idiomas[i]).val()),\n   207→            nivel    : $(niveles[i]).val()\n   208→        });\n   209→    }\n   210→\n   211→    window.idiomas_data = idiomas_seleccionados;\n   212→\n   213→    return true;\n   214→}\n   215→\n   216→/**\n   217→ * Agregar datos personalizados al FormData antes de enviar.\n   218→ * Esta función es llamada por configurarFormulario() en formularios.js\n   219→ * Recibe el ID del formulario a través del campo temporal 'formulario_id_procesar'\n   220→ *\n   221→ * @param {FormData} datos_formulario FormData a modificar\n   222→ * @returns {FormData} FormData modificado\n   223→ * @author Andres Morales\n   224→ * @author Andres Gonzalez\n   225→ */\n   226→function agregarDataForm(datos_formulario) {\n   227→    var formulario_id = datos_formulario.get('formulario_id_procesar');\n   228→\n   229→    if (formulario_id === 'form-editar-plantilla-etapa') {\n   230→        if ($('#descripcion_mensaje_etapa').data('editor')) {\n   231→            var contenido_editor = $('#descripcion_mensaje_etapa').data('editor').getData();\n   232→            datos_formulario.set('contenido', contenido_editor);\n   233→        }\n   234→\n   235→        datos_formulario.delete('descripcion_mensaje_etapa');\n   236→\n   237→        datos_formulario.set('con_logo_empresa', $('#form-editar-plantilla-etapa #con_logo').is(':checked') ? 1 : 0);\n   238→        datos_formulario.set('plantilla_correo_id', $('#form-editar-plantilla-etapa #plantilla_correo_id').val());\n   239→\n   240→        if ($('#form-editar-plantilla-etapa #enviar_finalizar').length) {\n   241→            datos_formulario.set('notificar_fin_proceso', $('#form-editar-plantilla-etapa #enviar_finalizar').is(':checked') ? 1 : 0);\n   242→        }\n   243→\n   244→        return datos_formulario;\n   245→    }\n   246→\n   247→    if (formulario_id === 'formulario-vacantes-paso-1') {\n   248→        return procesarDatosFormularioVacantesPaso1(datos_formulario);\n   249→    }\n   250→\n   251→    return datos_formulario;\n   252→}\n   253→\n   254→/**\n   255→ * Procesar FormData específico para el paso 1 de vacantes\n   256→ *\n   257→ * @param {FormData} datos_formulario FormData original\n   258→ * @returns {FormData} FormData procesado\n   259→ * @author Andres Morales\n   260→ * @author Andres Gonzalez\n   261→ */\n   262→function procesarDatosFormularioVacantesPaso1(datos_formulario) {\n   263→    let nuevo_formulario_data = new FormData();\n   264→\n   265→    let campos_permitidos = [\n   266→        'id',\n   267→        'nombre_vacante',\n   268→        'cantidad_vacantes',\n   269→        'ciudad_id',\n   270→        'salario',\n   271→        'salario_maximo',\n   272→        'estado_id',\n   273→        'informacion',\n   274→        'requisitos',\n   275→        'automatizar_etapas',\n   276→        'modalidad_trabajo_id'\n   277→    ];\n   278→\n   279→    campos_permitidos.forEach(function(campo) {\n   280→        if (datos_formulario.has(campo)) {\n   281→            let valor = datos_formulario.get(campo);\n   282→            nuevo_formulario_data.append(campo, valor);\n   283→        } else if (campo === 'id') {\n   284→            let id_dom = $('#id').val();\n   285→            if (id_dom && id_dom !== '' && id_dom !== '0') {\n   286→                nuevo_formulario_data.append('id', id_dom);\n   287→            }\n   288→        }\n   289→    });\n   290→\n   291→    let tipo_salario = $('input[name=\"tipo_salario\"]:checked').val() || 'a_convenir';\n   292→\n   293→    if (tipo_salario === 'especifico') {\n   294→        let salario_cantidad = $('#salario_cantidad').val() || '';\n   295→        nuevo_formulario_data.delete('salario_maximo');\n   296→        salario_cantidad = salario_cantidad.toString().replace(/[^0-9]/g, '');\n   297→        if (salario_cantidad) {\n   298→            nuevo_formulario_data.delete('salario');\n   299→            nuevo_formulario_data.append('salario', salario_cantidad);\n   300→        }\n   301→    } else if (tipo_salario === 'a_convenir') {\n   302→        let salario_desde = $('#salario_desde').val();\n   303→        salario_desde = salario_desde.toString().replace(/[^0-9]/g, '');\n   304→        let salario_hasta = $('#salario_hasta').val();\n   305→        salario_hasta = salario_hasta.toString().replace(/[^0-9]/g, '');\n   306→\n   307→        if (salario_desde) {\n   308→            nuevo_formulario_data.append('salario', salario_desde);\n   309→        }\n   310→        if (salario_hasta) {\n   311→            nuevo_formulario_data.append('salario_maximo', salario_hasta);\n   312→        }\n   313→    }\n   314→\n   315→    if (window.idiomas_data && window.idiomas_data.length > 0) {\n   316→        window.idiomas_data.forEach(function(idioma, index) {\n   317→            nuevo_formulario_data.append(`idiomas[${index}][idioma_id]`, idioma.idioma_id);\n   318→            nuevo_formulario_data.append(`idiomas[${index}][nivel]`, idioma.nivel);\n   319→        });\n   320→    }\n   321→\n   322→    if (datos_formulario.has('_method')) {\n   323→        nuevo_formulario_data.append('_method', datos_formulario.get('_method'));\n   324→    }\n   325→    if (datos_formulario.has('_token')) {\n   326→        nuevo_formulario_data.append('_token', datos_formulario.get('_token'));\n   327→    }\n   328→\n   329→    return nuevo_formulario_data;\n   330→}\n   331→\n   332→/**\n   333→ * Ejecución de opciones de formulario al ejecutar un guardado del paso\n   334→ *\n   335→ * @param {Object} respuesta Respuesta del guardado.\n   336→ * @returns {void} No retorna nada.\n   337→ * @author José Manuel Jiménez\n   338→ * @author Andres Morales\n   339→ */\n   340→function postSuccess(respuesta) {\n   341→    if (respuesta.formulario === 'form-editar-plantilla-etapa') {\n   342→        respuestaCorrectaPlantillaEtapa(respuesta);\n   343→        return;\n   344→    }\n   345→    if (respuesta.formulario === 'formulario-vacantes-paso-2') {\n   346→        respuestaCorrectaVacantesPaso2();\n   347→        return;\n   348→    }\n   349→\n   350→    if (respuesta.formulario.includes('form-movimiento')) {\n   351→        mostrarToast('success', respuesta.message);\n   352→        $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).modal('hide');\n   353→        if (respuesta.formulario === 'form-movimiento-8') {\n   354→            adjuntarArchivos();\n   355→        }\n   356→        var vacante_id = $('#id').val();\n   357→        if (vacante_id) {\n   358→            calcularDiasDuracionProceso(vacante_id);\n   359→        }\n   360→        modal_movimiento_id_seleccionado = null;\n   361→        etapa_vacante_id_seleccionado = null;\n   362→        etapa_movimiento_vacante_id_seleccionado = null;\n   363→        return;\n   364→    }\n   365→\n   366→    respuestaCorrectaVacantesGeneral(respuesta);\n   367→}\n   368→\n   369→/**\n   370→ * Ejecución de opciones de formulario al ocurrir un error en el guardado\n   371→ *\n   372→ * @param {Object} respuesta Respuesta del servidor\n   373→ * @returns {void}\n   374→ * @author José Manuel Jiménez\n   375→ * @author Andres Gonzalez\n   376→ */\n   377→function postError(respuesta) {\n   378→    if (respuesta.errors) {\n   379→        var mensaje_error = typeof respuesta.errors === 'string' ? respuesta.errors : '';\n   380→\n   381→        if (mensaje_error.includes('Esta empresa no cuenta con vacantes disponibles contacta a tu asesor') ||\n   382→            mensaje_error.includes('Plan inactivo o límite de vacantes alcanzado contacta a soporte')) {\n   383→            mostrarToast('danger', mensaje_error);\n   384→            return;\n   385→        }\n   386→    }\n   387→\n   388→    // Comportamiento por defecto para otros errores\n   389→    if (respuesta.formulario == 'formulario-vacantes-paso-2') {\n   390→        if (respuesta.errors) {\n   391→            mostrarToast('warning', respuesta.errors);\n   392→        } else {\n   393→            mostrarToast('danger', 'Ocurrió un error al procesar la solicitud.');\n   394→        }\n   395→    } else {\n   396→        mostrarToast('danger', 'Ocurrió un error al procesar la solicitud.');\n   397→    }\n   398→}\n   399→\n   400→/**\n   401→ * Post-success específico para el formulario de plantilla de etapa\n   402→ *\n   403→ * @param {Object} respuesta Respuesta del servidor\n   404→ * @returns {void}\n   405→ * @author Andres Morales\n   406→ */\n   407→function respuestaCorrectaPlantillaEtapa(respuesta) {\n   408→    mostrarToast('success', respuesta.message);\n   409→    $('#modal-editar-plantilla-etapa').modal('hide');\n   410→\n   411→    var vacante_id = $('#formulario-vacantes-paso-2 #id').val();\n   412→    if (vacante_id) {\n   413→        consultarEtapasVacante(vacante_id);\n   414→    }\n   415→}\n   416→\n   417→/**\n   418→ * Post-success específico para el paso 2 de vacantes\n   419→ *\n   420→ * @returns {void}\n   421→ * @author José Manuel Jiménez\n   422→ * @author Andres Morales\n   423→ */\n   424→function respuestaCorrectaVacantesPaso2() {\n   425→    localStorage.setItem('notificacionToast', JSON.stringify({\n   426→        tipo_alerta: 'success',\n   427→        texto_1: 'La vacante se ha creado exitosamente.',\n   428→    }));\n   429→    window.location.href = '/vacantes';\n   430→}\n   431→\n   432→/**\n   433→ * Post-success general para formularios de vacantes\n   434→ *\n   435→ * @param {Object} respuesta Respuesta del servidor\n   436→ * @returns {void}\n   437→ * @author José Manuel Jiménez\n   438→ * @author Andres Morales\n   439→ */\n   440→function respuestaCorrectaVacantesGeneral(respuesta) {\n   441→    if (respuesta.id) {\n   442→        $(`#${respuesta.formulario} #id`).val(respuesta.id);\n   443→    }\n   444→    let pestana = $(`#pestana-${respuesta.formulario}`).find('.nav-pasos').attr('id');\n   445→    actualizarPasos(pestana, $(`#${respuesta.formulario}`).valid());\n   446→\n   447→    if ($(`#${respuesta.formulario}`).data('activar-siguiente')) {\n   448→        $($(`#${pestana}`).closest('.tab-pasos').next().next('.tab-pasos').find('.nav-pasos')).tab('show');\n   449→        if (respuesta.id) {\n   450→            $('#formulario-vacantes-paso-1 #id').val(respuesta.id);\n   451→            $('#formulario-vacantes-paso-2 #id').val(respuesta.id);\n   452→            mostrarToast('success', respuesta.message);\n   453→            consultarEtapasVacante(respuesta.id);\n   454→        }\n   455→    }\n   456→}\n   457→\n   458→/**\n   459→ * Generar preguntas prefiltro con IA.\n   460→ *\n   461→ * @returns {void}\n   462→ * @author Daniel Beltrán\n   463→ * @deprecated\n   464→ */\n   465→function generarPreguntasPrefiltro() {\n   466→    $.ajax({\n   467→        type: 'POST',\n   468→        url : '/generar-preguntas-prefiltro',\n   469→        data: {\n   470→            _token                   : $('input[name=\"_token\"]').val(),\n   471→            nombre_vacante           : 'recepcionista',\n   472→            habilidades              : ['Puntual', 'Respetuosa'],\n   473→            herramientas_tecnologicas: ['Excel', 'Correo electrónico'],\n   474→            experiencia_laboral      : '1 año',\n   475→            nivel_educativo          : 'Profesional',\n   476→            numero_preguntas         : 2,\n   477→            tipo_preguntas           : ['abierta', 'seleccion_multiple']\n   478→        }\n   479→    }).done((respuesta) => {\n   480→        mostrarToast('success', respuesta.message);\n   481→    }).fail((error) => {\n   482→        mostrarToast('danger', 'Ocurrió un error');\n   483→    });\n   484→}\n   485→\n   486→/**\n   487→ * Generar preguntas videoentrevista con IA.\n   488→ *\n   489→ * @returns {void}\n   490→ * @author Daniel Beltrán\n   491→ */\n   492→function generarPreguntasVideoentrevista() {\n   493→    $.ajax({\n   494→        type: 'POST',\n   495→        url : '/generar-preguntas-videoentrevista',\n   496→        data: {\n   497→            _token                   : $('input[name=\"_token\"]').val(),\n   498→            nombre_vacante           : 'diseñador',\n   499→            habilidades              : ['Cumplido', 'Respetuoso'],\n   500→            herramientas_tecnologicas: ['Photoshop', 'Power Point', 'Paint'],\n   501→            experiencia_laboral      : '2 años',\n   502→            nivel_educativo          : 'Profesional'\n   503→        }\n   504→    }).done((respuesta) => {\n   505→        mostrarToast('success', respuesta.message);\n   506→    }).fail((error) => {\n   507→        mostrarToast('danger', 'Ocurrió un error');\n   508→    });\n   509→}\n   510→\n   511→/**\n   512→ * Generar pruebas psicométricas con IA.\n   513→ *\n   514→ * @returns {void}\n   515→ * @author Daniel Beltrán\n   516→ */\n   517→function generarPruebasPsicometricas() {\n   518→    $.ajax({\n   519→        type: 'POST',\n   520→        url : '/generar-pruebas-psicometricas',\n   521→        data: {\n   522→            _token                   : $('input[name=\"_token\"]').val(),\n   523→            nombre_vacante           : 'vendedor',\n   524→            habilidades              : ['Comunicación asertiva', 'Cordial', 'Amable'],\n   525→            herramientas_tecnologicas: ['Correo electrónico', 'Word'],\n   526→            experiencia_laboral      : '3 años',\n   527→            nivel_educativo          : 'Profesional'\n   528→        }\n   529→    }).done((respuesta) => {\n   530→        mostrarToast('success', respuesta.message);\n   531→    }).fail((error) => {\n   532→        mostrarToast('danger', 'Ocurrió un error');\n   533→    });\n   534→}\n   535→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"e2dfadbe-4da9-4448-96c2-dd0aa0f00a8e","timestamp":"2026-01-13T21:03:39.082Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\crear-editar-vacantes.js","content":"/**\n * Archivo principal para crear y editar vacantes\n * Contiene funciones compartidas entre los pasos del formulario\n * @author Andres Morales\n * @author José Manuel Jiménez\n */\n\n/**\n * Validaciones adicionales antes de enviar el formulario.\n *\n * @param {string} formulario Identificador del formulario actual.\n * @returns {boolean} True si es válido, false en caso contrario.\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction validacionAdicional(formulario) {\n    if (formulario === 'form-editar-plantilla-etapa') {\n        return validacionPlantillaEtapa();\n    }\n\n    if (formulario === 'formulario-vacantes-paso-1') {\n        return validacionVacantesPaso1();\n    }\n\n    if (formulario.includes('form-movimiento')) {\n        return validacionFormularioMovimientoVacante(formulario);\n    }\n\n    return true;\n}\n\n/**\n * Validación específica para el formulario de plantilla de etapa\n *\n * @returns {boolean} True si la validación es exitosa\n * @author Andres Morales\n */\nfunction validacionPlantillaEtapa() {\n    var titulo = $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val();\n    if (!titulo || titulo.trim() === '') {\n        mostrarToast('warning', 'El título o asunto del mensaje es requerido');\n        return false;\n    }\n\n    var editor = $('#descripcion_mensaje_etapa').data('editor');\n    var contenido_editor = '';\n\n    if (editor) {\n        contenido_editor = editor.getData();\n        $('#contenido').val(contenido_editor);\n    }\n\n    var contenido_texto = contenido_editor.replace(/<[^>]*>/g, '').trim();\n    if (!contenido_texto || contenido_texto === '') {\n        mostrarToast('warning', 'La descripción del mensaje es requerida');\n        return false;\n    }\n\n    $('#con_logo_empresa').val($('#con_logo').is(':checked') ? 1 : 0);\n\n    if ($('#enviar_finalizar').length) {\n        $('#notificar_fin_proceso').val($('#enviar_finalizar').is(':checked') ? 1 : 0);\n    }\n\n    if (typeof empresa !== 'undefined' && empresa && empresa.id) {\n        $('#modal-editar-plantilla-etapa #empresa_id').val(empresa.id);\n    }\n\n    return true;\n}\n\n/**\n * Validación específica para el paso 1 de vacantes\n *\n * @returns {boolean} True si es válido, false en caso contrario\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction validacionVacantesPaso1() {\n    if ($('input[name=\"tipo_salario\"]:checked').val() === 'a_convenir') {\n        let salario_desde = parseFloat(limpiarCleave($('#salario_desde').val())) || 0;\n        let salario_hasta = parseFloat(limpiarCleave($('#salario_hasta').val())) || 0;\n        if (salario_desde >= salario_hasta) {\n            $('#titulo-tab-pasos-vacantes-paso-1').click();\n            mostrarToast('warning', 'El salario hasta no debe ser menor o igual al salario desde');\n            return false;\n        } else if (salario_desde < 0 || salario_hasta < 0) {\n            $('#titulo-tab-pasos-vacantes-paso-1').click();\n            mostrarToast('warning', 'Los valores de salario no pueden ser negativos.');\n            return false;\n        }\n    } else if ($('input[name=\"tipo_salario\"]:checked').val() === 'especifico') {\n        let salario_cantidad = parseFloat(limpiarCleave($('#salario_cantidad').val())) || 0;\n        if (salario_cantidad < 0) {\n            $('#titulo-tab-pasos-vacantes-paso-1').click();\n            mostrarToast('warning', 'El salario no puede ser negativo.');\n            return false;\n        }\n    }\n\n    if ($('input[name=\"tipo_edad\"]:checked').val() === 'rango') {\n        let edad_desde = parseInt($('#edad_desde').val()) || 0;\n        let edad_hasta = parseInt($('#edad_hasta').val()) || 0;\n        if (edad_desde > edad_hasta) {\n            mostrarToast('warning', 'La edad máxima no debe ser menor que la edad mínima.');\n            $('#titulo-tab-pasos-vacantes-paso-1').click();\n            return false;\n        } else if (edad_hasta < 15 || edad_desde < 15) {\n            mostrarToast('warning', 'La edad mínima debe ser 15 años.');\n            $('#titulo-tab-pasos-vacantes-paso-1').click();\n            return false;\n        }\n    }\n\n    let habilidades_seleccionadas = $('#habilidades').val();\n    let habilidades = Array.isArray(habilidades_seleccionadas) ? habilidades_seleccionadas.join(', ') : '';\n\n    let herramientas_seleccionadas = $('#herramientas_tecnologicas').val();\n    let herramientas = Array.isArray(herramientas_seleccionadas) ? herramientas_seleccionadas.join(', ') : '';\n\n    // Validar que habilidades sea obligatorio\n    if (!habilidades || habilidades.trim() === '') {\n        $('#titulo-tab-pasos-vacantes-paso-1').click();\n        mostrarToast('warning', 'Debes seleccionar al menos una habilidad.');\n        return false;\n    }\n\n    // Validar que herramientas tecnológicas sea obligatorio\n    if (!herramientas || herramientas.trim() === '') {\n        $('#titulo-tab-pasos-vacantes-paso-1').click();\n        mostrarToast('warning', 'Debes seleccionar al menos una herramienta tecnológica.');\n        return false;\n    }\n\n    let informacion = {\n        habilidades: {\n            valor: habilidades,\n            es_privado: false\n        },\n        herramientas_tecnologicas: {\n            valor: herramientas,\n            es_privado: false\n        },\n        direccion_trabajo: {\n            valor: $('#direccion_trabajo').val() || '',\n            es_privado: false\n        },\n        funciones: {\n            valor: $('#funciones').val() || '',\n        }\n    };\n    $('#informacion').val(JSON.stringify(informacion));\n\n    let genero_seleccionado = $('input[name=\"genero\"]:checked').val() || 'indiferente';\n    let tipo_edad = $('input[name=\"tipo_edad\"]:checked').val();\n    let edad_minima = tipo_edad === 'rango' ? $('#edad_desde').val() : '';\n    let edad_maxima = tipo_edad === 'rango' ? $('#edad_hasta').val() : '';\n    let experiencia_laboral = $('#experiencia_laboral').val() || '';\n    let nivel_educativo = $('#nivel_educativo_vacante').val() || '';\n    let vacante_apta_discapacitados = $('#vacante_apta_discapacitados').prop('checked') ? '1' : '0';\n\n    let requisitos = {\n        genero: {\n            valor: genero_seleccionado,\n            es_privado: false\n        },\n        edad_minima: {\n            valor: edad_minima,\n            es_privado: false\n        },\n        edad_maxima: {\n            valor: edad_maxima,\n            es_privado: false\n        },\n        experiencia_laboral: {\n            valor: experiencia_laboral,\n            es_privado: false\n        },\n        nivel_educativo: {\n            valor: nivel_educativo,\n            es_privado: false\n        }\n    };\n\n    if ($('#licencia_conducir').prop('checked')) {\n        let tipo_licencia = $('#tipo_licencia').val();\n        if (tipo_licencia) {\n            requisitos.licencia_conducir = {\n                valor: tipo_licencia,\n                es_privado: false\n            };\n        }\n    }\n\n    requisitos.vacante_apta_discapacitados = {\n        valor: vacante_apta_discapacitados,\n        es_privado: false\n    };\n    $('#requisitos').val(JSON.stringify(requisitos));\n\n    let idiomas_seleccionados = [];\n    let idiomas = $('.idioma');\n    let niveles = $('.nivel-idioma');\n    for (let i = 0; i < idiomas.length; i++) {\n        idiomas_seleccionados.push({\n            idioma_id: parseInt($(idiomas[i]).val()),\n            nivel    : $(niveles[i]).val()\n        });\n    }\n\n    window.idiomas_data = idiomas_seleccionados;\n\n    return true;\n}\n\n/**\n * Agregar datos personalizados al FormData antes de enviar.\n * Esta función es llamada por configurarFormulario() en formularios.js\n * Recibe el ID del formulario a través del campo temporal 'formulario_id_procesar'\n *\n * @param {FormData} datos_formulario FormData a modificar\n * @returns {FormData} FormData modificado\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction agregarDataForm(datos_formulario) {\n    var formulario_id = datos_formulario.get('formulario_id_procesar');\n\n    if (formulario_id === 'form-editar-plantilla-etapa') {\n        if ($('#descripcion_mensaje_etapa').data('editor')) {\n            var contenido_editor = $('#descripcion_mensaje_etapa').data('editor').getData();\n            datos_formulario.set('contenido', contenido_editor);\n        }\n\n        datos_formulario.delete('descripcion_mensaje_etapa');\n\n        datos_formulario.set('con_logo_empresa', $('#form-editar-plantilla-etapa #con_logo').is(':checked') ? 1 : 0);\n        datos_formulario.set('plantilla_correo_id', $('#form-editar-plantilla-etapa #plantilla_correo_id').val());\n\n        if ($('#form-editar-plantilla-etapa #enviar_finalizar').length) {\n            datos_formulario.set('notificar_fin_proceso', $('#form-editar-plantilla-etapa #enviar_finalizar').is(':checked') ? 1 : 0);\n        }\n\n        return datos_formulario;\n    }\n\n    if (formulario_id === 'formulario-vacantes-paso-1') {\n        return procesarDatosFormularioVacantesPaso1(datos_formulario);\n    }\n\n    return datos_formulario;\n}\n\n/**\n * Procesar FormData específico para el paso 1 de vacantes\n *\n * @param {FormData} datos_formulario FormData original\n * @returns {FormData} FormData procesado\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction procesarDatosFormularioVacantesPaso1(datos_formulario) {\n    let nuevo_formulario_data = new FormData();\n\n    let campos_permitidos = [\n        'id',\n        'nombre_vacante',\n        'cantidad_vacantes',\n        'ciudad_id',\n        'salario',\n        'salario_maximo',\n        'estado_id',\n        'informacion',\n        'requisitos',\n        'automatizar_etapas',\n        'modalidad_trabajo_id'\n    ];\n\n    campos_permitidos.forEach(function(campo) {\n        if (datos_formulario.has(campo)) {\n            let valor = datos_formulario.get(campo);\n            nuevo_formulario_data.append(campo, valor);\n        } else if (campo === 'id') {\n            let id_dom = $('#id').val();\n            if (id_dom && id_dom !== '' && id_dom !== '0') {\n                nuevo_formulario_data.append('id', id_dom);\n            }\n        }\n    });\n\n    let tipo_salario = $('input[name=\"tipo_salario\"]:checked').val() || 'a_convenir';\n\n    if (tipo_salario === 'especifico') {\n        let salario_cantidad = $('#salario_cantidad').val() || '';\n        nuevo_formulario_data.delete('salario_maximo');\n        salario_cantidad = salario_cantidad.toString().replace(/[^0-9]/g, '');\n        if (salario_cantidad) {\n            nuevo_formulario_data.delete('salario');\n            nuevo_formulario_data.append('salario', salario_cantidad);\n        }\n    } else if (tipo_salario === 'a_convenir') {\n        let salario_desde = $('#salario_desde').val();\n        salario_desde = salario_desde.toString().replace(/[^0-9]/g, '');\n        let salario_hasta = $('#salario_hasta').val();\n        salario_hasta = salario_hasta.toString().replace(/[^0-9]/g, '');\n\n        if (salario_desde) {\n            nuevo_formulario_data.append('salario', salario_desde);\n        }\n        if (salario_hasta) {\n            nuevo_formulario_data.append('salario_maximo', salario_hasta);\n        }\n    }\n\n    if (window.idiomas_data && window.idiomas_data.length > 0) {\n        window.idiomas_data.forEach(function(idioma, index) {\n            nuevo_formulario_data.append(`idiomas[${index}][idioma_id]`, idioma.idioma_id);\n            nuevo_formulario_data.append(`idiomas[${index}][nivel]`, idioma.nivel);\n        });\n    }\n\n    if (datos_formulario.has('_method')) {\n        nuevo_formulario_data.append('_method', datos_formulario.get('_method'));\n    }\n    if (datos_formulario.has('_token')) {\n        nuevo_formulario_data.append('_token', datos_formulario.get('_token'));\n    }\n\n    return nuevo_formulario_data;\n}\n\n/**\n * Ejecución de opciones de formulario al ejecutar un guardado del paso\n *\n * @param {Object} respuesta Respuesta del guardado.\n * @returns {void} No retorna nada.\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction postSuccess(respuesta) {\n    if (respuesta.formulario === 'form-editar-plantilla-etapa') {\n        respuestaCorrectaPlantillaEtapa(respuesta);\n        return;\n    }\n    if (respuesta.formulario === 'formulario-vacantes-paso-2') {\n        respuestaCorrectaVacantesPaso2();\n        return;\n    }\n\n    if (respuesta.formulario.includes('form-movimiento')) {\n        mostrarToast('success', respuesta.message);\n        $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).modal('hide');\n        if (respuesta.formulario === 'form-movimiento-8') {\n            adjuntarArchivos();\n        }\n        var vacante_id = $('#id').val();\n        if (vacante_id) {\n            calcularDiasDuracionProceso(vacante_id);\n        }\n        modal_movimiento_id_seleccionado = null;\n        etapa_vacante_id_seleccionado = null;\n        etapa_movimiento_vacante_id_seleccionado = null;\n        return;\n    }\n\n    respuestaCorrectaVacantesGeneral(respuesta);\n}\n\n/**\n * Ejecución de opciones de formulario al ocurrir un error en el guardado\n *\n * @param {Object} respuesta Respuesta del servidor\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction postError(respuesta) {\n    if (respuesta.errors) {\n        var mensaje_error = typeof respuesta.errors === 'string' ? respuesta.errors : '';\n\n        if (mensaje_error.includes('Esta empresa no cuenta con vacantes disponibles contacta a tu asesor') ||\n            mensaje_error.includes('Plan inactivo o límite de vacantes alcanzado contacta a soporte')) {\n            mostrarToast('danger', mensaje_error);\n            return;\n        }\n    }\n\n    // Comportamiento por defecto para otros errores\n    if (respuesta.formulario == 'formulario-vacantes-paso-2') {\n        if (respuesta.errors) {\n            mostrarToast('warning', respuesta.errors);\n        } else {\n            mostrarToast('danger', 'Ocurrió un error al procesar la solicitud.');\n        }\n    } else {\n        mostrarToast('danger', 'Ocurrió un error al procesar la solicitud.');\n    }\n}\n\n/**\n * Post-success específico para el formulario de plantilla de etapa\n *\n * @param {Object} respuesta Respuesta del servidor\n * @returns {void}\n * @author Andres Morales\n */\nfunction respuestaCorrectaPlantillaEtapa(respuesta) {\n    mostrarToast('success', respuesta.message);\n    $('#modal-editar-plantilla-etapa').modal('hide');\n\n    var vacante_id = $('#formulario-vacantes-paso-2 #id').val();\n    if (vacante_id) {\n        consultarEtapasVacante(vacante_id);\n    }\n}\n\n/**\n * Post-success específico para el paso 2 de vacantes\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction respuestaCorrectaVacantesPaso2() {\n    localStorage.setItem('notificacionToast', JSON.stringify({\n        tipo_alerta: 'success',\n        texto_1: 'La vacante se ha creado exitosamente.',\n    }));\n    window.location.href = '/vacantes';\n}\n\n/**\n * Post-success general para formularios de vacantes\n *\n * @param {Object} respuesta Respuesta del servidor\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction respuestaCorrectaVacantesGeneral(respuesta) {\n    if (respuesta.id) {\n        $(`#${respuesta.formulario} #id`).val(respuesta.id);\n    }\n    let pestana = $(`#pestana-${respuesta.formulario}`).find('.nav-pasos').attr('id');\n    actualizarPasos(pestana, $(`#${respuesta.formulario}`).valid());\n\n    if ($(`#${respuesta.formulario}`).data('activar-siguiente')) {\n        $($(`#${pestana}`).closest('.tab-pasos').next().next('.tab-pasos').find('.nav-pasos')).tab('show');\n        if (respuesta.id) {\n            $('#formulario-vacantes-paso-1 #id').val(respuesta.id);\n            $('#formulario-vacantes-paso-2 #id').val(respuesta.id);\n            mostrarToast('success', respuesta.message);\n            consultarEtapasVacante(respuesta.id);\n        }\n    }\n}\n\n/**\n * Generar preguntas prefiltro con IA.\n *\n * @returns {void}\n * @author Daniel Beltrán\n * @deprecated\n */\nfunction generarPreguntasPrefiltro() {\n    $.ajax({\n        type: 'POST',\n        url : '/generar-preguntas-prefiltro',\n        data: {\n            _token                   : $('input[name=\"_token\"]').val(),\n            nombre_vacante           : 'recepcionista',\n            habilidades              : ['Puntual', 'Respetuosa'],\n            herramientas_tecnologicas: ['Excel', 'Correo electrónico'],\n            experiencia_laboral      : '1 año',\n            nivel_educativo          : 'Profesional',\n            numero_preguntas         : 2,\n            tipo_preguntas           : ['abierta', 'seleccion_multiple']\n        }\n    }).done((respuesta) => {\n        mostrarToast('success', respuesta.message);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error');\n    });\n}\n\n/**\n * Generar preguntas videoentrevista con IA.\n *\n * @returns {void}\n * @author Daniel Beltrán\n */\nfunction generarPreguntasVideoentrevista() {\n    $.ajax({\n        type: 'POST',\n        url : '/generar-preguntas-videoentrevista',\n        data: {\n            _token                   : $('input[name=\"_token\"]').val(),\n            nombre_vacante           : 'diseñador',\n            habilidades              : ['Cumplido', 'Respetuoso'],\n            herramientas_tecnologicas: ['Photoshop', 'Power Point', 'Paint'],\n            experiencia_laboral      : '2 años',\n            nivel_educativo          : 'Profesional'\n        }\n    }).done((respuesta) => {\n        mostrarToast('success', respuesta.message);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error');\n    });\n}\n\n/**\n * Generar pruebas psicométricas con IA.\n *\n * @returns {void}\n * @author Daniel Beltrán\n */\nfunction generarPruebasPsicometricas() {\n    $.ajax({\n        type: 'POST',\n        url : '/generar-pruebas-psicometricas',\n        data: {\n            _token                   : $('input[name=\"_token\"]').val(),\n            nombre_vacante           : 'vendedor',\n            habilidades              : ['Comunicación asertiva', 'Cordial', 'Amable'],\n            herramientas_tecnologicas: ['Correo electrónico', 'Word'],\n            experiencia_laboral      : '3 años',\n            nivel_educativo          : 'Profesional'\n        }\n    }).done((respuesta) => {\n        mostrarToast('success', respuesta.message);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error');\n    });\n}\n","numLines":535,"startLine":1,"totalLines":535}},"sourceToolAssistantUUID":"de59a6c8-b67f-49a7-89c4-82040577f846"}
{"parentUuid":"5dd53659-b178-40d2-8a13-56243f711e19","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FQuUPrN38Uf7gnteY3qMgG","type":"tool_result","content":"     1→/**\n     2→ * Obtener configuración de nombres de procesos duplicados.\n     3→ *\n     4→ * @returns {Promise<number>}\n     5→ * @author Jair Carvajal\n     6→ */\n     7→async function obtenerConfiguracionNombresDuplicados() {\n     8→    let valor = 0;    \n     9→    await $.ajax({\n    10→        url: '/configuraciones-obtener',\n    11→        type: 'GET',\n    12→        data: {\n    13→            modelo: 'App\\\\Models\\\\Empresas\\\\Empresa',\n    14→            modelo_id: EMPRESA_ID,\n    15→            configuracion_id: 47\n    16→        }\n    17→    }).then((respuesta) => {\n    18→        if (respuesta.data && respuesta.data.valor !== undefined) {\n    19→            valor = parseInt(respuesta.data.valor);\n    20→        }\n    21→    }).catch((error) => {});\n    22→\n    23→    return valor;\n    24→}\n    25→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"5f201919-346f-4e8c-a7a7-4da2dee724f2","timestamp":"2026-01-13T21:03:45.435Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-funciones.js","content":"/**\n * Obtener configuración de nombres de procesos duplicados.\n *\n * @returns {Promise<number>}\n * @author Jair Carvajal\n */\nasync function obtenerConfiguracionNombresDuplicados() {\n    let valor = 0;    \n    await $.ajax({\n        url: '/configuraciones-obtener',\n        type: 'GET',\n        data: {\n            modelo: 'App\\\\Models\\\\Empresas\\\\Empresa',\n            modelo_id: EMPRESA_ID,\n            configuracion_id: 47\n        }\n    }).then((respuesta) => {\n        if (respuesta.data && respuesta.data.valor !== undefined) {\n            valor = parseInt(respuesta.data.valor);\n        }\n    }).catch((error) => {});\n\n    return valor;\n}\n","numLines":25,"startLine":1,"totalLines":25}},"sourceToolAssistantUUID":"5dd53659-b178-40d2-8a13-56243f711e19"}
{"parentUuid":"63c643fa-d398-4c1d-a306-e1d213fc1f34","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JiAho11JvMrQufredP4a3e","type":"tool_result","content":"     1→/**\n     2→ * Archivo para manejar la lógica del Paso 1: Información de la vacante\n     3→ * @author Andres Morales\n     4→ * @author José Manuel Jiménez\n     5→ */\n     6→\n     7→$(document).ready(function() {\n     8→    inicializarFormularioVacante();\n     9→    configurarFormulario('formulario-vacantes-paso-1');\n    10→    toggleLugarTrabajo('actual');\n    11→    var tipo_salario_seleccionado = $('input[name=\"tipo_salario\"]:checked').val() || 'a_convenir';\n    12→    toggleCamposSalario(tipo_salario_seleccionado);\n    13→    toggleEdad($('input[name=\"tipo_edad\"]:checked').val() || 'indiferente');\n    14→    cargarHabilidadesHerramientas();\n    15→\n    16→    if (!$('#licencia_conducir').prop('checked')) {\n    17→        $('#tipo_licencia').closest('.col-12').hide();\n    18→    }\n    19→    deshabilitarBotonSiguiente();\n    20→\n    21→    $('input[name=\"lugar_trabajo\"]').on('change', function () {\n    22→        toggleLugarTrabajo($(this).val());\n    23→        validarFormularioCompleto();\n    24→    });\n    25→\n    26→    $('input[name=\"tipo_salario\"]').on('change', function () {\n    27→        toggleCamposSalario($(this).val());\n    28→        validarFormularioCompleto();\n    29→    });\n    30→\n    31→    $('#salario_desde, #salario_hasta').on('input change blur', function () {\n    32→        if ($('input[name=\"tipo_salario\"]:checked').val() === 'a_convenir') {\n    33→            validarRangoSalario();\n    34→        }\n    35→        validarFormularioCompleto();\n    36→    });\n    37→\n    38→    $('#edad_desde, #edad_hasta').on('input change blur', function () {\n    39→        if ($('input[name=\"tipo_edad\"]:checked').val() === 'rango') {\n    40→            validarRangoEdades();\n    41→        }\n    42→        validarFormularioCompleto();\n    43→    });\n    44→\n    45→    $('input[name=\"tipo_edad\"]').on('change', function () {\n    46→        toggleEdad($(this).val());\n    47→        validarFormularioCompleto();\n    48→    });\n    49→\n    50→    $('#nombre_vacante').on('change', function () {\n    51→        validarNombreVacanteDuplicado();\n    52→        validarFormularioCompleto();\n    53→    });\n    54→\n    55→    $('#nombre_vacante, #cantidad_vacantes, #direccion_trabajo').on('input change', function() {\n    56→        validarFormularioCompleto();\n    57→    });\n    58→\n    59→    $('#ciudad_id, #pais_id, #departamento_id, #experiencia_laboral, #nivel_educativo_vacante, #habilidades, #herramientas_tecnologicas, #salario_cantidad, #tipo_licencia').on('change', function() {\n    60→        validarFormularioCompleto();\n    61→    });\n    62→});\n    63→\n    64→/**\n    65→ * Inicializa el formulario de vacante\n    66→ * @description Configura el formulario de vacante, carga datos iniciales y configura validaciones\n    67→ * @returns {void}\n    68→ * @author Andres Morales\n    69→ */\n    70→function inicializarFormularioVacante() {\n    71→    consultarPaisesListadoCompleto();\n    72→    var vacante_formulario_id = $('#formulario-vacantes-paso-1 #id').val();\n    73→    var vacante_global_id = (typeof vacante_id !== 'undefined') ? vacante_id : null;\n    74→    var vacante_identificador = vacante_global_id || vacante_formulario_id;\n    75→    if (vacante_identificador) {\n    76→        cargarDatosVacante(vacante_identificador);\n    77→    }\n    78→}\n    79→\n    80→/**\n    81→ * Carga los datos de una vacante para edición\n    82→ * @description Obtiene los datos de una vacante existente y los carga en el formulario\n    83→ * @param {number} id - ID de la vacante a cargar\n    84→ * @returns {void}\n    85→ * @author Andres Morales\n    86→ */\n    87→function cargarDatosVacante(id) {\n    88→    $.getJSON('/vacantes/' + id)\n    89→        .done(function(data) {\n    90→            var vacante = data.data;\n    91→            window.vacante_edicion = vacante;\n    92→\n    93→            $('#id').val(vacante.id);\n    94→            $('#nombre_vacante').val(vacante.nombre_vacante || '');\n    95→            $('#cantidad_vacantes').val(vacante.cantidad_vacantes || '');\n    96→            $('#estado_id').val(vacante.estado_id || 4);\n    97→            if (vacante.ciudad_id) {\n    98→                $('input[name=\"lugar_trabajo\"][value=\"otro\"]').prop('checked', true);\n    99→                toggleLugarTrabajo('otro');\n   100→\n   101→                if (vacante.ciudad && vacante.ciudad.departamento && vacante.ciudad.departamento.pais) {\n   102→                    var pais_id = vacante.ciudad.departamento.pais.id;\n   103→                    var departamento_id = vacante.ciudad.departamento.id;\n   104→                    var ciudad_id = vacante.ciudad.id;\n   105→                    $('#pais_id').append(new Option(vacante.ciudad.departamento.pais.nombre, pais_id, true, true)).trigger('change');\n   106→\n   107→                    setTimeout(function() {\n   108→                        $('#departamento_id').append(new Option(vacante.ciudad.departamento.nombre, departamento_id, true, true)).trigger('change');\n   109→                        setTimeout(function() {\n   110→                            $('#ciudad_id').append(new Option(vacante.ciudad.nombre, ciudad_id, true, true)).trigger('change');\n   111→                        }, 500);\n   112→                    }, 500);\n   113→                }\n   114→            } else {\n   115→                $('input[name=\"lugar_trabajo\"][value=\"actual\"]').prop('checked', true);\n   116→                toggleLugarTrabajo('actual');\n   117→            }\n   118→\n   119→            if (vacante.salario && vacante.salario_maximo) {\n   120→                $('input[name=\"tipo_salario\"][value=\"a_convenir\"]').prop('checked', true);\n   121→                toggleCamposSalario('a_convenir');\n   122→                $('#salario_desde').val(vacante.salario);\n   123→                $('#salario_hasta').val(vacante.salario_maximo);\n   124→            } else if (vacante.salario) {\n   125→                $('input[name=\"tipo_salario\"][value=\"especifico\"]').prop('checked', true);\n   126→                toggleCamposSalario('especifico');\n   127→                $('#salario_cantidad').val(vacante.salario);\n   128→            }\n   129→\n   130→            if (vacante.datos && vacante.datos.length > 0) {\n   131→                vacante.datos.forEach(function(dato) {\n   132→\n   133→                    if (dato.llave === 'funciones') {\n   134→                        $('#funciones').val(dato.valor || '');\n   135→                    }\n   136→\n   137→                    if (dato.llave === 'direccion_trabajo') {\n   138→                        $('#direccion_trabajo').val(dato.valor || '');\n   139→                    }\n   140→\n   141→                    if (dato.llave === 'genero') {\n   142→                        $('input[name=\"genero\"][value=\"' + dato.valor + '\"]').prop('checked', true);\n   143→                    }\n   144→\n   145→                    if (dato.llave === 'edad_minima' && dato.valor) {\n   146→                        $('input[name=\"tipo_edad\"][value=\"rango\"]').prop('checked', true);\n   147→                        toggleEdad('rango');\n   148→                        $('#edad_desde').val(dato.valor);\n   149→                    }\n   150→\n   151→                    if (dato.llave === 'edad_maxima' && dato.valor) {\n   152→                        $('#edad_hasta').val(dato.valor);\n   153→                    }\n   154→\n   155→                    if (dato.llave === 'experiencia_laboral' && dato.valor) {\n   156→                        $('#experiencia_laboral').val(dato.valor).trigger('change');\n   157→                    }\n   158→\n   159→                    if (dato.llave === 'nivel_educativo' && dato.valor) {\n   160→                        $('#nivel_educativo_vacante').val(dato.valor).trigger('change');\n   161→                    }\n   162→\n   163→                    if (dato.llave === 'licencia_conducir' && dato.valor) {\n   164→                        if (dato.valor !== '0' && dato.valor !== 0) {\n   165→                            $('#licencia_conducir').prop('checked', true);\n   166→                            seleccionarLicenciaConducir($('#licencia_conducir')[0]);\n   167→                            $('#tipo_licencia').val(dato.valor).trigger('change');\n   168→                        }\n   169→                    }\n   170→\n   171→                    if (dato.llave === 'vacante_apta_discapacitados' && dato.valor === '1') {\n   172→                        $('#vacante_apta_discapacitados').prop('checked', true);\n   173→                    }\n   174→                });\n   175→            }\n   176→\n   177→            if (vacante.idiomas && vacante.idiomas.length > 0) {\n   178→                vacante.idiomas.forEach(function(idioma_modelo) {\n   179→                    $('input[name=\"multiselect_idiomas_seleccionados\"][value=\"' + idioma_modelo.idioma_id + '\"]').prop('checked', true);\n   180→                });\n   181→                var elemento_multiselect = document.getElementById('idiomas_seleccionados');\n   182→                if (elemento_multiselect) {\n   183→                    seleccionarIdioma(elemento_multiselect);\n   184→                    setTimeout(function() {\n   185→                        vacante.idiomas.forEach(function(idioma_modelo) {\n   186→                            $('#nivel_idioma_' + idioma_modelo.idioma_id).val(idioma_modelo.nivel).trigger('change');\n   187→                        });\n   188→                    }, 300);\n   189→                }\n   190→            }\n   191→            cargarHabilidadesHerramientas();\n   192→            $('#titulo-tab-pasos-vacantes-paso-2').attr('disabled', false);\n   193→            consultarEtapasVacante(vacante.id);\n   194→            setTimeout(function() {\n   195→                validarFormularioCompleto();\n   196→            }, 500);\n   197→        })\n   198→        .fail(function(jqXHR, textStatus, errorThrown) {\n   199→            console.error('Error al cargar vacante:', errorThrown || textStatus);\n   200→            mostrarToast('danger', 'No se pudo cargar la vacante');\n   201→        });\n   202→}\n   203→\n   204→/**\n   205→ * Alterna entre ubicación de empresa y ubicación personalizada\n   206→ * @description Muestra u oculta los campos de ubicación personalizada y gestiona los atributos required\n   207→ * @param {string} tipo - 'actual' para empresa actual, 'otro' para ubicación personalizada\n   208→ * @returns {void}\n   209→ * @author Andres Morales\n   210→ */\n   211→function toggleLugarTrabajo(tipo) {\n   212→    var $contenedor_ubicacion = $('#contenedor_ubicacion_personalizada');\n   213→    var $select_ciudad = $('#ciudad_id');\n   214→    var $select_pais = $('#pais_id');\n   215→    var $select_departamento = $('#departamento_id');\n   216→    var $input_direccion = $('#direccion_trabajo');\n   217→\n   218→    if (tipo === 'otro') {\n   219→        $contenedor_ubicacion.removeClass('d-none');\n   220→        $select_ciudad.attr('required', 'required');\n   221→        $select_pais.attr('required', 'required');\n   222→        $select_departamento.attr('required', 'required');\n   223→        $input_direccion.attr('required', 'required');\n   224→    } else {\n   225→        $contenedor_ubicacion.addClass('d-none');\n   226→        $select_ciudad.removeAttr('required');\n   227→        $select_pais.removeAttr('required');\n   228→        $select_departamento.removeAttr('required');\n   229→        $input_direccion.removeAttr('required');\n   230→        $select_pais.val('').trigger('change');\n   231→        $select_departamento.val('').trigger('change');\n   232→        $select_ciudad.val('').trigger('change');\n   233→        $input_direccion.val('');\n   234→    }\n   235→}\n   236→\n   237→/**\n   238→ * Alterna entre salario específico y a convenir\n   239→ * @description Muestra u oculta los campos de salario según el tipo seleccionado y limpia valores\n   240→ * @param {string} tipo - 'especifico' para cantidad única, 'a_convenir' para rango\n   241→ * @returns {void}\n   242→ * @author Andres Morales\n   243→ */\n   244→function toggleCamposSalario(tipo) {\n   245→    var $contenedor_especifico = $('#contenedor_salario_especifico');\n   246→    var $contenedor_rango = $('#contenedor_salario_rango');\n   247→    var $input_cantidad = $('#salario_cantidad');\n   248→    var $input_desde = $('#salario_desde');\n   249→    var $input_hasta = $('#salario_hasta');\n   250→\n   251→    if (tipo === 'especifico') {\n   252→        $contenedor_especifico.removeClass('d-none');\n   253→        $input_cantidad.attr('required', 'required');\n   254→        $contenedor_rango.addClass('d-none');\n   255→        $input_desde.removeAttr('required');\n   256→        $input_hasta.removeAttr('required');\n   257→        $input_desde.val('');\n   258→        $input_hasta.val('');\n   259→        $input_desde.removeClass('error');\n   260→        $input_hasta.removeClass('error');\n   261→        $input_desde.siblings('label.error').remove();\n   262→        $input_hasta.siblings('label.error').remove();\n   263→    } else {\n   264→        $contenedor_especifico.addClass('d-none');\n   265→        $input_cantidad.removeAttr('required');\n   266→        $contenedor_rango.removeClass('d-none');\n   267→        $input_desde.attr('required', 'required');\n   268→        $input_hasta.attr('required', 'required');\n   269→        $input_cantidad.val('');\n   270→        $input_cantidad.removeClass('error');\n   271→        $input_cantidad.siblings('label.error').remove();\n   272→    }\n   273→}\n   274→\n   275→/**\n   276→ * Valida el rango de salario\n   277→ * @description Verifica que el salario máximo sea mayor o igual al salario mínimo\n   278→ * @returns {boolean} true si es válido, false en caso contrario\n   279→ * @author Andres Morales\n   280→ */\n   281→function validarRangoSalario() {\n   282→    if ($('input[name=\"tipo_salario\"]:checked').val() !== 'a_convenir') {\n   283→        return true;\n   284→    }\n   285→\n   286→    var salario_desde = parseFloat(limpiarCleave($('#salario_desde').val())) || 0;\n   287→    var salario_hasta = parseFloat(limpiarCleave($('#salario_hasta').val())) || 0;\n   288→    var $input_hasta = $('#salario_hasta');\n   289→    var $contenedor_hasta = $input_hasta.closest('.input-container');\n   290→\n   291→    $input_hasta.removeClass('error');\n   292→    $contenedor_hasta.siblings('label[for=\"salario_hasta\"].error').remove();\n   293→\n   294→    if (salario_desde >= salario_hasta) {\n   295→        if (salario_hasta < salario_desde) {\n   296→            $input_hasta.addClass('error');\n   297→            $contenedor_hasta.after('<label for=\"salario_hasta\" class=\"error text-red-cta\">El salario hasta no debe ser menor o igual al salario desde</label>');\n   298→            return false;\n   299→        }\n   300→    }\n   301→\n   302→    return true;\n   303→}\n   304→\n   305→/**\n   306→ * Valida el rango de la edades\n   307→ * @description Verifica que la edad máxima sea mayor o igual a la edad mínima\n   308→ * @returns {boolean} true si es válido, false en caso contrario\n   309→ * @author Jair Carvajal\n   310→ */\n   311→function validarRangoEdades() {\n   312→    if ($('input[name=\"tipo_edad\"]:checked').val() !== 'rango') {\n   313→        return true;\n   314→    }    \n   315→    var edad_desde = $('#edad_desde').val();\n   316→    var edad_hasta = $('#edad_hasta').val();\n   317→    \n   318→    var $input_hasta = $('#edad_hasta');\n   319→    var $contenedor_hasta = $input_hasta.closest('.input-container');\n   320→\n   321→    $input_hasta.removeClass('error');\n   322→    $contenedor_hasta.siblings('label[for=\"edad_hasta\"].error').remove();\n   323→\n   324→    if (edad_desde >= edad_hasta) {\n   325→        if (edad_hasta < edad_desde) {\n   326→            $input_hasta.addClass('error');\n   327→            $contenedor_hasta.after('<label for=\"edad_hasta\" class=\"error text-red-cta\">La edad hasta no debe ser menor o igual a la edad desde</label>');\n   328→            return false;\n   329→        }\n   330→    }\n   331→\n   332→    return true;\n   333→}\n   334→\n   335→/**\n   336→ * Alterna entre rango de edad o indiferente.\n   337→ *\n   338→ * @param {string} tipo Tipo de edad seleccionado.\n   339→ * @returns {void}\n   340→ */\n   341→function toggleEdad(tipo) {\n   342→    var $contenedor_rango = $('#contenedor_edad_rango');\n   343→    var $edad_desde = $('#edad_desde');\n   344→    var $edad_hasta = $('#edad_hasta');\n   345→\n   346→    if (tipo === 'rango') {\n   347→        $contenedor_rango.removeClass('d-none');\n   348→        $edad_desde.attr('required', 'required');\n   349→        $edad_hasta.attr('required', 'required');\n   350→    } else {\n   351→        $contenedor_rango.addClass('d-none');\n   352→        $edad_desde.removeAttr('required').val('');\n   353→        $edad_hasta.removeAttr('required').val('');\n   354→        $edad_desde.removeClass('error').siblings('label.error').remove();\n   355→        $edad_hasta.removeClass('error').siblings('label.error').remove();\n   356→    }\n   357→}\n   358→\n   359→/**\n   360→ * Muestra u oculta el campo tipo de licencia según el estado del checkbox\n   361→ * @param {HTMLElement} elemento - El checkbox de licencia_conducir\n   362→ * @returns {void}\n   363→ * @author José Manuel Jiménez\n   364→ * @author Andres Morales\n   365→ */\n   366→function seleccionarLicenciaConducir(elemento) {\n   367→    let checked = $(elemento).prop('checked');\n   368→    let $contenedor_tipo_licencia = $('#tipo_licencia').closest('.col-12');\n   369→\n   370→    if (checked) {\n   371→        $contenedor_tipo_licencia.show();\n   372→        $('#tipo_licencia').prop('disabled', false);\n   373→    } else {\n   374→        $contenedor_tipo_licencia.hide();\n   375→        $('#tipo_licencia').val('').trigger('change');\n   376→        $('#tipo_licencia').prop('disabled', true);\n   377→    }\n   378→}\n   379→\n   380→let idiomas = [\n   381→    {'id': 1, 'nombre': 'Inglés'},\n   382→    {'id': 2, 'nombre': 'Portugués'},\n   383→    {'id': 3, 'nombre': 'Francés'},\n   384→    {'id': 4, 'nombre': 'Alemán'},\n   385→    {'id': 5, 'nombre': 'Mandarín'},\n   386→    {'id': 6, 'nombre': 'Italiano'},\n   387→    {'id': 7, 'nombre': 'Ruso'},\n   388→    {'id': 8, 'nombre': 'Árabe'},\n   389→];\n   390→\n   391→let niveles_idiomas = [\n   392→    {\n   393→        id: 'A1',\n   394→        nombre: 'A1 - Principiante',\n   395→        descripcion: 'A1: Principiante <br> Puede comprender y usar expresiones cotidianas básicas. Es capaz de presentarse y hacer preguntas sencillas (nombre, edad, lugar de residencia, etc.).'\n   396→    },\n   397→    {\n   398→        id: 'A2',\n   399→        nombre: 'A2 - Básico',\n   400→        descripcion: 'A2: Básico <br> Comprende frases y vocabulario frecuente relacionado con áreas de relevancia inmediata (información personal, compras, familia, etc.). Puede comunicarse en tareas simples y rutinarias. Describe en términos simples aspectos de su vida.'\n   401→    },\n   402→    {\n   403→        id: 'B1',\n   404→        nombre: 'B1 - Intermedio',\n   405→        descripcion: 'B1: Intermedio <br> Puede comprender textos y temas comunes (trabajo, escuela, ocio). Es capaz de desenvolverse en la mayoría de las situaciones que se puedan presentar mientras viaja. Expresa opiniones y relata experiencias de forma sencilla.'\n   406→    },\n   407→    {\n   408→        id: 'B2',\n   409→        nombre: 'B2 - Intermedio Alto',\n   410→        descripcion: 'B2: Intermedio Alto <br> Comprende ideas principales de textos complejos, incluidos temas técnicos. Es capaz de interactuar con fluidez y sin esfuerzo con hablantes nativos. Produce textos claros y detallados sobre una amplia gama de temas.'\n   411→    },\n   412→    {\n   413→        id: 'C1',\n   414→        nombre: 'C1 - Avanzado',\n   415→        descripcion: 'C1: Avanzado <br> Comprende textos largos y exigentes. Se comunica con espontaneidad y fluidez, adaptándose al contexto. Escribe textos estructurados, bien argumentados y detallados.'\n   416→    },\n   417→    {\n   418→        id: 'C2',\n   419→        nombre: 'C2 - Nativo',\n   420→        descripcion: 'C2: Nativo <br> Comprende todo con facilidad, incluso textos técnicos o literarios. Puede expresarse de forma precisa y matizada. Escribe y habla de manera natural, como un hablante nativo.'\n   421→    },\n   422→];\n   423→\n   424→/**\n   425→ * Función para seleccionar idioma.\n   426→ *\n   427→ * @param {HTMLElement} elemento Elemento.\n   428→ * @returns {void}\n   429→ * @author José Manuel Jiménez\n   430→ * @author Andres Morales\n   431→ */\n   432→function seleccionarIdioma(elemento) {\n   433→    let niveles = [];\n   434→    $('input[name=\"multiselect_' + elemento.name + '\"]:checked').each(function () {\n   435→        niveles.push({\n   436→            id: parseInt($(this).val()),\n   437→            nombre: $(this).closest('label').find('span').text().trim(),\n   438→        });\n   439→    });\n   440→    let campos_idiomas = '';\n   441→    for (let i = 0; i < niveles.length; i++) {\n   442→        campos_idiomas += `\n   443→            <div class=\"col-12 col-lg-6 mt-3\">\n   444→                <div class=\"text-headline-6 text-gray-10 mb-2\">${niveles[i].nombre}</div>\n   445→                ${crearSelect2({\n   446→                    opciones: niveles_idiomas,\n   447→                    id: 'nivel_idioma_' + niveles[i].id,\n   448→                    name: 'nivel_idioma_' + niveles[i].id,\n   449→                    class: 'nivel-idioma',\n   450→                    input_container_class: 'mb-0',\n   451→                    label: 'Nivel',\n   452→                    value: $('#nivel_idioma_' + niveles[i].id).val(),\n   453→                    required: true,\n   454→                })}\n   455→            </div>\n   456→            <input type=\"hidden\" value=\"${niveles[i].id}\" class=\"idioma\">\n   457→        `;\n   458→    }\n   459→    $('#contenedor-idiomas').empty();\n   460→    $('#contenedor-idiomas').append(campos_idiomas);\n   461→    actualizarSelect2();\n   462→\n   463→    $('.nivel-idioma').each(function() {\n   464→        $(this).select2({\n   465→            templateResult: formatearOpcionNivelIdioma,\n   466→            templateSelection: formatearSeleccionNivelIdioma,\n   467→            escapeMarkup: function(markup) { return markup; },\n   468→            width: '100%'\n   469→        });\n   470→\n   471→        $(this).on('select2:open', function() {\n   472→            setTimeout(function() {\n   473→                $('.select2-results__option [data-bs-toggle=\"tooltip\"]').each(function() {\n   474→                    new bootstrap.Tooltip(this, {\n   475→                        trigger: 'hover',\n   476→                        html: true\n   477→                    });\n   478→                });\n   479→            }, 0);\n   480→        });\n   481→\n   482→        $(this).on('select2:select', function() {\n   483→            destruirTooltipsActivos();\n   484→        });\n   485→\n   486→        $(this).on('select2:close', function() {\n   487→            destruirTooltipsActivos();\n   488→        });\n   489→    });\n   490→}\n   491→\n   492→/**\n   493→ * Destruye todos los tooltips activos de Bootstrap\n   494→ *\n   495→ * @returns {void}\n   496→ * @author Andres Morales\n   497→ */\n   498→function destruirTooltipsActivos() {\n   499→    $('.tooltip').each(function() {\n   500→        $(this).remove();\n   501→    });\n   502→}\n   503→\n   504→/**\n   505→ * Formatea las opciones del dropdown de nivel de idioma con tooltips\n   506→ *\n   507→ * @param {Object} opcion Opción del select\n   508→ * @returns {string} HTML formateado con tooltip\n   509→ * @author Andres Morales\n   510→ */\n   511→function formatearOpcionNivelIdioma(opcion) {\n   512→    if (!opcion.id) {\n   513→        return opcion.text;\n   514→    }\n   515→\n   516→    var nivel_encontrado = niveles_idiomas.find(function(nivel) {\n   517→        return nivel.id === opcion.id;\n   518→    });\n   519→\n   520→    if (!nivel_encontrado) {\n   521→        return opcion.text;\n   522→    }\n   523→\n   524→    var $opcion = $(\n   525→        '<div class=\"d-flex justify-content-between align-items-center\">' +\n   526→            '<span>' + nivel_encontrado.nombre + '</span>' +\n   527→            '<i class=\"bi bi-info-circle ms-2\" ' +\n   528→                'data-bs-toggle=\"tooltip\" ' +\n   529→                'data-bs-placement=\"right\" ' +\n   530→                'data-bs-html=\"true\" ' +\n   531→                'title=\"' + nivel_encontrado.descripcion + '\">' +\n   532→            '</i>' +\n   533→        '</div>'\n   534→    );\n   535→\n   536→    return $opcion;\n   537→}\n   538→\n   539→/**\n   540→ * Formatea la selección mostrada del nivel de idioma\n   541→ *\n   542→ * @param {Object} opcion Opción seleccionada\n   543→ * @returns {string} Texto de la opción\n   544→ * @author Andres Morales\n   545→ */\n   546→function formatearSeleccionNivelIdioma(opcion) {\n   547→    if (!opcion.id) {\n   548→        return opcion.text;\n   549→    }\n   550→\n   551→    var nivel_encontrado = niveles_idiomas.find(function(nivel) {\n   552→        return nivel.id === opcion.id;\n   553→    });\n   554→\n   555→    return nivel_encontrado ? nivel_encontrado.nombre : opcion.text;\n   556→}\n   557→\n   558→/**\n   559→ * Carga las herramientas tecnológicas previamente utilizadas\n   560→ * @description Obtiene las herramientas tecnológicas de vacantes anteriores para autocompletado\n   561→ * Las habilidades se cargan automáticamente con crearSelectAsincronoChips\n   562→ * @returns {void}\n   563→ * @author Andres Morales\n   564→ * @author Jair Carvajal\n   565→ */\n   566→function cargarHabilidadesHerramientas() {\n   567→    $.getJSON('/vacantes-habilidades-herramientas')\n   568→        .done(function(respuesta) {\n   569→            var datos = respuesta.data || respuesta;\n   570→\n   571→            var $select_habilidades = $('#habilidades');\n   572→            if ($select_habilidades.length && datos.habilidades && datos.habilidades.length > 0) {\n   573→                $select_habilidades.empty();\n   574→                $.each(datos.habilidades, function(_, habilidad) {\n   575→                    var option = new Option(habilidad, habilidad, false, false);\n   576→                    $select_habilidades.append(option);\n   577→                });\n   578→                $select_habilidades.trigger('change');\n   579→            }\n   580→            \n   581→            var $select_herramientas = $('#herramientas_tecnologicas');\n   582→            if ($select_herramientas.length && datos.herramientas_tecnologicas && datos.herramientas_tecnologicas.length > 0) {\n   583→                $select_herramientas.empty();\n   584→                $.each(datos.herramientas_tecnologicas, function(_, herramienta) {\n   585→                    var option = new Option(herramienta, herramienta, false, false);\n   586→                    $select_herramientas.append(option);\n   587→                });\n   588→                $select_herramientas.trigger('change');\n   589→            }\n   590→\n   591→            if (typeof actualizarSelect2 === 'function') {\n   592→                actualizarSelect2('#habilidades');\n   593→                actualizarSelect2('#herramientas_tecnologicas');\n   594→            }\n   595→\n   596→            if (window.vacante_edicion && window.vacante_edicion.datos) {\n   597→                setTimeout(function() {\n   598→                    window.vacante_edicion.datos.forEach(function(dato) {\n   599→                        if (dato.llave === 'habilidades' && dato.valor) {\n   600→                            var habilidades = dato.valor.split(',').map(function(h) { return h.trim(); }).filter(function(h) { return h !== ''; });\n   601→                            habilidades.forEach(function(habilidad) {\n   602→                                if ($('#habilidades option[value=\"' + habilidad + '\"]').length === 0) {\n   603→                                    var option = new Option(habilidad, habilidad, true, true);\n   604→                                    $('#habilidades').append(option);\n   605→                                } else {\n   606→                                    $('#habilidades option[value=\"' + habilidad + '\"]').prop('selected', true);\n   607→                                }\n   608→                            });\n   609→                            $('#habilidades').trigger('change');\n   610→                        }\n   611→                        \n   612→                        if (dato.llave === 'herramientas_tecnologicas' && dato.valor) {\n   613→                            var herramientas = dato.valor.split(',').map(function(h) { return h.trim(); }).filter(function(h) { return h !== ''; });\n   614→                            herramientas.forEach(function(herramienta) {\n   615→                                if ($('#herramientas_tecnologicas option[value=\"' + herramienta + '\"]').length === 0) {\n   616→                                    var option = new Option(herramienta, herramienta, true, true);\n   617→                                    $('#herramientas_tecnologicas').append(option);\n   618→                                } else {\n   619→                                    $('#herramientas_tecnologicas option[value=\"' + herramienta + '\"]').prop('selected', true);\n   620→                                }\n   621→                            });\n   622→                            $('#herramientas_tecnologicas').trigger('change');\n   623→                        }\n   624→                    });\n   625→                    validarFormularioCompleto();\n   626→                }, 200);\n   627→            } else {\n   628→                validarFormularioCompleto();\n   629→            }\n   630→        })\n   631→        .fail(function(jqXHR, textStatus, errorThrown) {\n   632→            if (typeof actualizarSelect2 === 'function') {\n   633→                actualizarSelect2('#habilidades');\n   634→                actualizarSelect2('#herramientas_tecnologicas');\n   635→            }\n   636→            validarFormularioCompleto();\n   637→        });\n   638→}\n   639→\n   640→/**\n   641→ * Valida si el nombre de la vacante ya existe en la base de datos\n   642→ * @description Realiza una petición AJAX para verificar si existe una vacante con el mismo nombre\n   643→ * @returns {void}\n   644→ * @author Jair Carvjaal\n   645→ */\n   646→async function validarNombreVacanteDuplicado() {\n   647→    var nombre_vacante = $('#nombre_vacante').val();\n   648→    if (!nombre_vacante || nombre_vacante.trim() === '') {\n   649→        return;\n   650→    }\n   651→    \n   652→    let permitir_duplicados = await obtenerConfiguracionNombresDuplicados();\n   653→\n   654→    if (permitir_duplicados == 0) {\n   655→        $.ajax({\n   656→            type: 'GET',\n   657→            url: '/vacantes-listado-tabla',\n   658→            data: {\n   659→                nombre_vacante: nombre_vacante.trim(),\n   660→                activo: 1\n   661→            }\n   662→        })\n   663→        .done(function(respuesta) {\n   664→            var vacantes_encontradas = respuesta.data || [];\n   665→    \n   666→            if (vacantes_encontradas.length > 0) {\n   667→                mostrarToast('danger', 'Ya existe una vacante con este nombre. Por favor, elige un nombre diferente.');\n   668→                $('#nombre_vacante').addClass('error');\n   669→                deshabilitarBotonSiguiente();\n   670→            } else {\n   671→                $('#nombre_vacante').removeClass('error');\n   672→                validarFormularioCompleto();\n   673→            }\n   674→        })\n   675→    } else {\n   676→        validarFormularioCompleto();\n   677→    }\n   678→    \n   679→}\n   680→\n   681→/**\n   682→ * Deshabilita el botón siguiente\n   683→ * @description Deshabilita el botón \"Siguiente\" y añade estilos visuales de deshabilitado\n   684→ * @returns {void}\n   685→ * @author Jair Carvajal\n   686→ */\n   687→function deshabilitarBotonSiguiente() {\n   688→    $('#btn_siguiente').prop('disabled', true).css('opacity', '0.6').css('cursor', 'not-allowed');\n   689→}\n   690→\n   691→/**\n   692→ * Habilita el botón siguiente\n   693→ * @description Habilita el botón \"Siguiente\" y elimina estilos visuales de deshabilitado\n   694→ * @returns {void}\n   695→ * @author Jair Carvajal\n   696→ */\n   697→function habilitarBotonSiguiente() {\n   698→    $('#btn_siguiente').prop('disabled', false).css('opacity', '1').css('cursor', 'pointer');\n   699→}\n   700→\n   701→/**\n   702→ * Valida que todos los campos obligatorios estén completos\n   703→ * @description Verifica que todos los campos requeridos contengan valores válidos\n   704→ * @returns {boolean} true si el formulario está completo, false en caso contrario\n   705→ * @author Jair Carvajal\n   706→ */\n   707→function validarFormularioCompleto() {\n   708→    var nombre_vacante = $('#nombre_vacante').val().trim();\n   709→    var cantidad_vacantes = $('#cantidad_vacantes').val().trim();\n   710→    var experiencia_laboral = $('#experiencia_laboral').val();\n   711→    var nivel_educativo = $('#nivel_educativo_vacante').val();\n   712→    var habilidades = $('#habilidades').val();\n   713→    var herramientas_tecnologicas = $('#herramientas_tecnologicas').val();\n   714→\n   715→    // Validar campos básicos\n   716→    if (!nombre_vacante || !cantidad_vacantes) {\n   717→        deshabilitarBotonSiguiente();\n   718→        return false;\n   719→    }\n   720→\n   721→    // Validar ubicación según tipo de lugar de trabajo\n   722→    var lugar_trabajo = $('input[name=\"lugar_trabajo\"]:checked').val();\n   723→    if (lugar_trabajo === 'otro') {\n   724→        var pais_id = $('#pais_id').val();\n   725→        var departamento_id = $('#departamento_id').val();\n   726→        var ciudad_id = $('#ciudad_id').val();\n   727→        var direccion = $('#direccion_trabajo').val().trim();\n   728→\n   729→        if (!pais_id || !departamento_id || !ciudad_id || !direccion) {\n   730→            deshabilitarBotonSiguiente();\n   731→            return false;\n   732→        }\n   733→    }\n   734→\n   735→    // Validar salario según tipo\n   736→    var tipo_salario = $('input[name=\"tipo_salario\"]:checked').val();\n   737→    if (tipo_salario === 'especifico') {\n   738→        var salario_cantidad = $('#salario_cantidad').val();\n   739→        if (!salario_cantidad) {\n   740→            deshabilitarBotonSiguiente();\n   741→            return false;\n   742→        }\n   743→    } else if (tipo_salario === 'a_convenir') {\n   744→        var salario_desde = $('#salario_desde').val();\n   745→        var salario_hasta = $('#salario_hasta').val();\n   746→        if (!salario_desde || !salario_hasta) {\n   747→            deshabilitarBotonSiguiente();\n   748→            return false;\n   749→        }\n   750→        // Validar que el rango sea correcto\n   751→        if (!validarRangoSalario()) {\n   752→            deshabilitarBotonSiguiente();\n   753→            return false;\n   754→        }\n   755→    }\n   756→\n   757→    // Validar edad si es rango\n   758→    var tipo_edad = $('input[name=\"tipo_edad\"]:checked').val();\n   759→    if (tipo_edad === 'rango') {\n   760→        var edad_desde = $('#edad_desde').val();\n   761→        var edad_hasta = $('#edad_hasta').val();\n   762→        if (!edad_desde || !edad_hasta) {\n   763→            deshabilitarBotonSiguiente();\n   764→            return false;\n   765→        }\n   766→        // Validar que el rango sea correcto\n   767→        if (!validarRangoEdades()) {\n   768→            deshabilitarBotonSiguiente();\n   769→            return false;\n   770→        }\n   771→    }\n   772→\n   773→    if (!habilidades || habilidades.length === 0) {\n   774→        deshabilitarBotonSiguiente();\n   775→        return false;\n   776→    }\n   777→\n   778→    if (!herramientas_tecnologicas || herramientas_tecnologicas.length === 0) {\n   779→        deshabilitarBotonSiguiente();\n   780→        return false;\n   781→    }\n   782→\n   783→    if (!experiencia_laboral) {\n   784→        deshabilitarBotonSiguiente();\n   785→        return false;\n   786→    }\n   787→\n   788→    if (!nivel_educativo) {\n   789→        deshabilitarBotonSiguiente();\n   790→        return false;\n   791→    }\n   792→\n   793→    if ($('#licencia_conducir').prop('checked')) {\n   794→        var tipo_licencia = $('#tipo_licencia').val();\n   795→        if (!tipo_licencia) {\n   796→            deshabilitarBotonSiguiente();\n   797→            return false;\n   798→        }\n   799→    }\n   800→\n   801→    if ($('#formulario-vacantes-paso-1').find('.error').length > 0) {\n   802→        deshabilitarBotonSiguiente();\n   803→        return false;\n   804→    }\n   805→\n   806→    // Si todo está correcto, habilitar el botón\n   807→    habilitarBotonSiguiente();\n   808→    return true;\n   809→}\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"6b09fe96-40c1-42d7-93e6-c0bf0544525e","timestamp":"2026-01-13T21:03:45.622Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-1.js","content":"/**\n * Archivo para manejar la lógica del Paso 1: Información de la vacante\n * @author Andres Morales\n * @author José Manuel Jiménez\n */\n\n$(document).ready(function() {\n    inicializarFormularioVacante();\n    configurarFormulario('formulario-vacantes-paso-1');\n    toggleLugarTrabajo('actual');\n    var tipo_salario_seleccionado = $('input[name=\"tipo_salario\"]:checked').val() || 'a_convenir';\n    toggleCamposSalario(tipo_salario_seleccionado);\n    toggleEdad($('input[name=\"tipo_edad\"]:checked').val() || 'indiferente');\n    cargarHabilidadesHerramientas();\n\n    if (!$('#licencia_conducir').prop('checked')) {\n        $('#tipo_licencia').closest('.col-12').hide();\n    }\n    deshabilitarBotonSiguiente();\n\n    $('input[name=\"lugar_trabajo\"]').on('change', function () {\n        toggleLugarTrabajo($(this).val());\n        validarFormularioCompleto();\n    });\n\n    $('input[name=\"tipo_salario\"]').on('change', function () {\n        toggleCamposSalario($(this).val());\n        validarFormularioCompleto();\n    });\n\n    $('#salario_desde, #salario_hasta').on('input change blur', function () {\n        if ($('input[name=\"tipo_salario\"]:checked').val() === 'a_convenir') {\n            validarRangoSalario();\n        }\n        validarFormularioCompleto();\n    });\n\n    $('#edad_desde, #edad_hasta').on('input change blur', function () {\n        if ($('input[name=\"tipo_edad\"]:checked').val() === 'rango') {\n            validarRangoEdades();\n        }\n        validarFormularioCompleto();\n    });\n\n    $('input[name=\"tipo_edad\"]').on('change', function () {\n        toggleEdad($(this).val());\n        validarFormularioCompleto();\n    });\n\n    $('#nombre_vacante').on('change', function () {\n        validarNombreVacanteDuplicado();\n        validarFormularioCompleto();\n    });\n\n    $('#nombre_vacante, #cantidad_vacantes, #direccion_trabajo').on('input change', function() {\n        validarFormularioCompleto();\n    });\n\n    $('#ciudad_id, #pais_id, #departamento_id, #experiencia_laboral, #nivel_educativo_vacante, #habilidades, #herramientas_tecnologicas, #salario_cantidad, #tipo_licencia').on('change', function() {\n        validarFormularioCompleto();\n    });\n});\n\n/**\n * Inicializa el formulario de vacante\n * @description Configura el formulario de vacante, carga datos iniciales y configura validaciones\n * @returns {void}\n * @author Andres Morales\n */\nfunction inicializarFormularioVacante() {\n    consultarPaisesListadoCompleto();\n    var vacante_formulario_id = $('#formulario-vacantes-paso-1 #id').val();\n    var vacante_global_id = (typeof vacante_id !== 'undefined') ? vacante_id : null;\n    var vacante_identificador = vacante_global_id || vacante_formulario_id;\n    if (vacante_identificador) {\n        cargarDatosVacante(vacante_identificador);\n    }\n}\n\n/**\n * Carga los datos de una vacante para edición\n * @description Obtiene los datos de una vacante existente y los carga en el formulario\n * @param {number} id - ID de la vacante a cargar\n * @returns {void}\n * @author Andres Morales\n */\nfunction cargarDatosVacante(id) {\n    $.getJSON('/vacantes/' + id)\n        .done(function(data) {\n            var vacante = data.data;\n            window.vacante_edicion = vacante;\n\n            $('#id').val(vacante.id);\n            $('#nombre_vacante').val(vacante.nombre_vacante || '');\n            $('#cantidad_vacantes').val(vacante.cantidad_vacantes || '');\n            $('#estado_id').val(vacante.estado_id || 4);\n            if (vacante.ciudad_id) {\n                $('input[name=\"lugar_trabajo\"][value=\"otro\"]').prop('checked', true);\n                toggleLugarTrabajo('otro');\n\n                if (vacante.ciudad && vacante.ciudad.departamento && vacante.ciudad.departamento.pais) {\n                    var pais_id = vacante.ciudad.departamento.pais.id;\n                    var departamento_id = vacante.ciudad.departamento.id;\n                    var ciudad_id = vacante.ciudad.id;\n                    $('#pais_id').append(new Option(vacante.ciudad.departamento.pais.nombre, pais_id, true, true)).trigger('change');\n\n                    setTimeout(function() {\n                        $('#departamento_id').append(new Option(vacante.ciudad.departamento.nombre, departamento_id, true, true)).trigger('change');\n                        setTimeout(function() {\n                            $('#ciudad_id').append(new Option(vacante.ciudad.nombre, ciudad_id, true, true)).trigger('change');\n                        }, 500);\n                    }, 500);\n                }\n            } else {\n                $('input[name=\"lugar_trabajo\"][value=\"actual\"]').prop('checked', true);\n                toggleLugarTrabajo('actual');\n            }\n\n            if (vacante.salario && vacante.salario_maximo) {\n                $('input[name=\"tipo_salario\"][value=\"a_convenir\"]').prop('checked', true);\n                toggleCamposSalario('a_convenir');\n                $('#salario_desde').val(vacante.salario);\n                $('#salario_hasta').val(vacante.salario_maximo);\n            } else if (vacante.salario) {\n                $('input[name=\"tipo_salario\"][value=\"especifico\"]').prop('checked', true);\n                toggleCamposSalario('especifico');\n                $('#salario_cantidad').val(vacante.salario);\n            }\n\n            if (vacante.datos && vacante.datos.length > 0) {\n                vacante.datos.forEach(function(dato) {\n\n                    if (dato.llave === 'funciones') {\n                        $('#funciones').val(dato.valor || '');\n                    }\n\n                    if (dato.llave === 'direccion_trabajo') {\n                        $('#direccion_trabajo').val(dato.valor || '');\n                    }\n\n                    if (dato.llave === 'genero') {\n                        $('input[name=\"genero\"][value=\"' + dato.valor + '\"]').prop('checked', true);\n                    }\n\n                    if (dato.llave === 'edad_minima' && dato.valor) {\n                        $('input[name=\"tipo_edad\"][value=\"rango\"]').prop('checked', true);\n                        toggleEdad('rango');\n                        $('#edad_desde').val(dato.valor);\n                    }\n\n                    if (dato.llave === 'edad_maxima' && dato.valor) {\n                        $('#edad_hasta').val(dato.valor);\n                    }\n\n                    if (dato.llave === 'experiencia_laboral' && dato.valor) {\n                        $('#experiencia_laboral').val(dato.valor).trigger('change');\n                    }\n\n                    if (dato.llave === 'nivel_educativo' && dato.valor) {\n                        $('#nivel_educativo_vacante').val(dato.valor).trigger('change');\n                    }\n\n                    if (dato.llave === 'licencia_conducir' && dato.valor) {\n                        if (dato.valor !== '0' && dato.valor !== 0) {\n                            $('#licencia_conducir').prop('checked', true);\n                            seleccionarLicenciaConducir($('#licencia_conducir')[0]);\n                            $('#tipo_licencia').val(dato.valor).trigger('change');\n                        }\n                    }\n\n                    if (dato.llave === 'vacante_apta_discapacitados' && dato.valor === '1') {\n                        $('#vacante_apta_discapacitados').prop('checked', true);\n                    }\n                });\n            }\n\n            if (vacante.idiomas && vacante.idiomas.length > 0) {\n                vacante.idiomas.forEach(function(idioma_modelo) {\n                    $('input[name=\"multiselect_idiomas_seleccionados\"][value=\"' + idioma_modelo.idioma_id + '\"]').prop('checked', true);\n                });\n                var elemento_multiselect = document.getElementById('idiomas_seleccionados');\n                if (elemento_multiselect) {\n                    seleccionarIdioma(elemento_multiselect);\n                    setTimeout(function() {\n                        vacante.idiomas.forEach(function(idioma_modelo) {\n                            $('#nivel_idioma_' + idioma_modelo.idioma_id).val(idioma_modelo.nivel).trigger('change');\n                        });\n                    }, 300);\n                }\n            }\n            cargarHabilidadesHerramientas();\n            $('#titulo-tab-pasos-vacantes-paso-2').attr('disabled', false);\n            consultarEtapasVacante(vacante.id);\n            setTimeout(function() {\n                validarFormularioCompleto();\n            }, 500);\n        })\n        .fail(function(jqXHR, textStatus, errorThrown) {\n            console.error('Error al cargar vacante:', errorThrown || textStatus);\n            mostrarToast('danger', 'No se pudo cargar la vacante');\n        });\n}\n\n/**\n * Alterna entre ubicación de empresa y ubicación personalizada\n * @description Muestra u oculta los campos de ubicación personalizada y gestiona los atributos required\n * @param {string} tipo - 'actual' para empresa actual, 'otro' para ubicación personalizada\n * @returns {void}\n * @author Andres Morales\n */\nfunction toggleLugarTrabajo(tipo) {\n    var $contenedor_ubicacion = $('#contenedor_ubicacion_personalizada');\n    var $select_ciudad = $('#ciudad_id');\n    var $select_pais = $('#pais_id');\n    var $select_departamento = $('#departamento_id');\n    var $input_direccion = $('#direccion_trabajo');\n\n    if (tipo === 'otro') {\n        $contenedor_ubicacion.removeClass('d-none');\n        $select_ciudad.attr('required', 'required');\n        $select_pais.attr('required', 'required');\n        $select_departamento.attr('required', 'required');\n        $input_direccion.attr('required', 'required');\n    } else {\n        $contenedor_ubicacion.addClass('d-none');\n        $select_ciudad.removeAttr('required');\n        $select_pais.removeAttr('required');\n        $select_departamento.removeAttr('required');\n        $input_direccion.removeAttr('required');\n        $select_pais.val('').trigger('change');\n        $select_departamento.val('').trigger('change');\n        $select_ciudad.val('').trigger('change');\n        $input_direccion.val('');\n    }\n}\n\n/**\n * Alterna entre salario específico y a convenir\n * @description Muestra u oculta los campos de salario según el tipo seleccionado y limpia valores\n * @param {string} tipo - 'especifico' para cantidad única, 'a_convenir' para rango\n * @returns {void}\n * @author Andres Morales\n */\nfunction toggleCamposSalario(tipo) {\n    var $contenedor_especifico = $('#contenedor_salario_especifico');\n    var $contenedor_rango = $('#contenedor_salario_rango');\n    var $input_cantidad = $('#salario_cantidad');\n    var $input_desde = $('#salario_desde');\n    var $input_hasta = $('#salario_hasta');\n\n    if (tipo === 'especifico') {\n        $contenedor_especifico.removeClass('d-none');\n        $input_cantidad.attr('required', 'required');\n        $contenedor_rango.addClass('d-none');\n        $input_desde.removeAttr('required');\n        $input_hasta.removeAttr('required');\n        $input_desde.val('');\n        $input_hasta.val('');\n        $input_desde.removeClass('error');\n        $input_hasta.removeClass('error');\n        $input_desde.siblings('label.error').remove();\n        $input_hasta.siblings('label.error').remove();\n    } else {\n        $contenedor_especifico.addClass('d-none');\n        $input_cantidad.removeAttr('required');\n        $contenedor_rango.removeClass('d-none');\n        $input_desde.attr('required', 'required');\n        $input_hasta.attr('required', 'required');\n        $input_cantidad.val('');\n        $input_cantidad.removeClass('error');\n        $input_cantidad.siblings('label.error').remove();\n    }\n}\n\n/**\n * Valida el rango de salario\n * @description Verifica que el salario máximo sea mayor o igual al salario mínimo\n * @returns {boolean} true si es válido, false en caso contrario\n * @author Andres Morales\n */\nfunction validarRangoSalario() {\n    if ($('input[name=\"tipo_salario\"]:checked').val() !== 'a_convenir') {\n        return true;\n    }\n\n    var salario_desde = parseFloat(limpiarCleave($('#salario_desde').val())) || 0;\n    var salario_hasta = parseFloat(limpiarCleave($('#salario_hasta').val())) || 0;\n    var $input_hasta = $('#salario_hasta');\n    var $contenedor_hasta = $input_hasta.closest('.input-container');\n\n    $input_hasta.removeClass('error');\n    $contenedor_hasta.siblings('label[for=\"salario_hasta\"].error').remove();\n\n    if (salario_desde >= salario_hasta) {\n        if (salario_hasta < salario_desde) {\n            $input_hasta.addClass('error');\n            $contenedor_hasta.after('<label for=\"salario_hasta\" class=\"error text-red-cta\">El salario hasta no debe ser menor o igual al salario desde</label>');\n            return false;\n        }\n    }\n\n    return true;\n}\n\n/**\n * Valida el rango de la edades\n * @description Verifica que la edad máxima sea mayor o igual a la edad mínima\n * @returns {boolean} true si es válido, false en caso contrario\n * @author Jair Carvajal\n */\nfunction validarRangoEdades() {\n    if ($('input[name=\"tipo_edad\"]:checked').val() !== 'rango') {\n        return true;\n    }    \n    var edad_desde = $('#edad_desde').val();\n    var edad_hasta = $('#edad_hasta').val();\n    \n    var $input_hasta = $('#edad_hasta');\n    var $contenedor_hasta = $input_hasta.closest('.input-container');\n\n    $input_hasta.removeClass('error');\n    $contenedor_hasta.siblings('label[for=\"edad_hasta\"].error').remove();\n\n    if (edad_desde >= edad_hasta) {\n        if (edad_hasta < edad_desde) {\n            $input_hasta.addClass('error');\n            $contenedor_hasta.after('<label for=\"edad_hasta\" class=\"error text-red-cta\">La edad hasta no debe ser menor o igual a la edad desde</label>');\n            return false;\n        }\n    }\n\n    return true;\n}\n\n/**\n * Alterna entre rango de edad o indiferente.\n *\n * @param {string} tipo Tipo de edad seleccionado.\n * @returns {void}\n */\nfunction toggleEdad(tipo) {\n    var $contenedor_rango = $('#contenedor_edad_rango');\n    var $edad_desde = $('#edad_desde');\n    var $edad_hasta = $('#edad_hasta');\n\n    if (tipo === 'rango') {\n        $contenedor_rango.removeClass('d-none');\n        $edad_desde.attr('required', 'required');\n        $edad_hasta.attr('required', 'required');\n    } else {\n        $contenedor_rango.addClass('d-none');\n        $edad_desde.removeAttr('required').val('');\n        $edad_hasta.removeAttr('required').val('');\n        $edad_desde.removeClass('error').siblings('label.error').remove();\n        $edad_hasta.removeClass('error').siblings('label.error').remove();\n    }\n}\n\n/**\n * Muestra u oculta el campo tipo de licencia según el estado del checkbox\n * @param {HTMLElement} elemento - El checkbox de licencia_conducir\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction seleccionarLicenciaConducir(elemento) {\n    let checked = $(elemento).prop('checked');\n    let $contenedor_tipo_licencia = $('#tipo_licencia').closest('.col-12');\n\n    if (checked) {\n        $contenedor_tipo_licencia.show();\n        $('#tipo_licencia').prop('disabled', false);\n    } else {\n        $contenedor_tipo_licencia.hide();\n        $('#tipo_licencia').val('').trigger('change');\n        $('#tipo_licencia').prop('disabled', true);\n    }\n}\n\nlet idiomas = [\n    {'id': 1, 'nombre': 'Inglés'},\n    {'id': 2, 'nombre': 'Portugués'},\n    {'id': 3, 'nombre': 'Francés'},\n    {'id': 4, 'nombre': 'Alemán'},\n    {'id': 5, 'nombre': 'Mandarín'},\n    {'id': 6, 'nombre': 'Italiano'},\n    {'id': 7, 'nombre': 'Ruso'},\n    {'id': 8, 'nombre': 'Árabe'},\n];\n\nlet niveles_idiomas = [\n    {\n        id: 'A1',\n        nombre: 'A1 - Principiante',\n        descripcion: 'A1: Principiante <br> Puede comprender y usar expresiones cotidianas básicas. Es capaz de presentarse y hacer preguntas sencillas (nombre, edad, lugar de residencia, etc.).'\n    },\n    {\n        id: 'A2',\n        nombre: 'A2 - Básico',\n        descripcion: 'A2: Básico <br> Comprende frases y vocabulario frecuente relacionado con áreas de relevancia inmediata (información personal, compras, familia, etc.). Puede comunicarse en tareas simples y rutinarias. Describe en términos simples aspectos de su vida.'\n    },\n    {\n        id: 'B1',\n        nombre: 'B1 - Intermedio',\n        descripcion: 'B1: Intermedio <br> Puede comprender textos y temas comunes (trabajo, escuela, ocio). Es capaz de desenvolverse en la mayoría de las situaciones que se puedan presentar mientras viaja. Expresa opiniones y relata experiencias de forma sencilla.'\n    },\n    {\n        id: 'B2',\n        nombre: 'B2 - Intermedio Alto',\n        descripcion: 'B2: Intermedio Alto <br> Comprende ideas principales de textos complejos, incluidos temas técnicos. Es capaz de interactuar con fluidez y sin esfuerzo con hablantes nativos. Produce textos claros y detallados sobre una amplia gama de temas.'\n    },\n    {\n        id: 'C1',\n        nombre: 'C1 - Avanzado',\n        descripcion: 'C1: Avanzado <br> Comprende textos largos y exigentes. Se comunica con espontaneidad y fluidez, adaptándose al contexto. Escribe textos estructurados, bien argumentados y detallados.'\n    },\n    {\n        id: 'C2',\n        nombre: 'C2 - Nativo',\n        descripcion: 'C2: Nativo <br> Comprende todo con facilidad, incluso textos técnicos o literarios. Puede expresarse de forma precisa y matizada. Escribe y habla de manera natural, como un hablante nativo.'\n    },\n];\n\n/**\n * Función para seleccionar idioma.\n *\n * @param {HTMLElement} elemento Elemento.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction seleccionarIdioma(elemento) {\n    let niveles = [];\n    $('input[name=\"multiselect_' + elemento.name + '\"]:checked').each(function () {\n        niveles.push({\n            id: parseInt($(this).val()),\n            nombre: $(this).closest('label').find('span').text().trim(),\n        });\n    });\n    let campos_idiomas = '';\n    for (let i = 0; i < niveles.length; i++) {\n        campos_idiomas += `\n            <div class=\"col-12 col-lg-6 mt-3\">\n                <div class=\"text-headline-6 text-gray-10 mb-2\">${niveles[i].nombre}</div>\n                ${crearSelect2({\n                    opciones: niveles_idiomas,\n                    id: 'nivel_idioma_' + niveles[i].id,\n                    name: 'nivel_idioma_' + niveles[i].id,\n                    class: 'nivel-idioma',\n                    input_container_class: 'mb-0',\n                    label: 'Nivel',\n                    value: $('#nivel_idioma_' + niveles[i].id).val(),\n                    required: true,\n                })}\n            </div>\n            <input type=\"hidden\" value=\"${niveles[i].id}\" class=\"idioma\">\n        `;\n    }\n    $('#contenedor-idiomas').empty();\n    $('#contenedor-idiomas').append(campos_idiomas);\n    actualizarSelect2();\n\n    $('.nivel-idioma').each(function() {\n        $(this).select2({\n            templateResult: formatearOpcionNivelIdioma,\n            templateSelection: formatearSeleccionNivelIdioma,\n            escapeMarkup: function(markup) { return markup; },\n            width: '100%'\n        });\n\n        $(this).on('select2:open', function() {\n            setTimeout(function() {\n                $('.select2-results__option [data-bs-toggle=\"tooltip\"]').each(function() {\n                    new bootstrap.Tooltip(this, {\n                        trigger: 'hover',\n                        html: true\n                    });\n                });\n            }, 0);\n        });\n\n        $(this).on('select2:select', function() {\n            destruirTooltipsActivos();\n        });\n\n        $(this).on('select2:close', function() {\n            destruirTooltipsActivos();\n        });\n    });\n}\n\n/**\n * Destruye todos los tooltips activos de Bootstrap\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction destruirTooltipsActivos() {\n    $('.tooltip').each(function() {\n        $(this).remove();\n    });\n}\n\n/**\n * Formatea las opciones del dropdown de nivel de idioma con tooltips\n *\n * @param {Object} opcion Opción del select\n * @returns {string} HTML formateado con tooltip\n * @author Andres Morales\n */\nfunction formatearOpcionNivelIdioma(opcion) {\n    if (!opcion.id) {\n        return opcion.text;\n    }\n\n    var nivel_encontrado = niveles_idiomas.find(function(nivel) {\n        return nivel.id === opcion.id;\n    });\n\n    if (!nivel_encontrado) {\n        return opcion.text;\n    }\n\n    var $opcion = $(\n        '<div class=\"d-flex justify-content-between align-items-center\">' +\n            '<span>' + nivel_encontrado.nombre + '</span>' +\n            '<i class=\"bi bi-info-circle ms-2\" ' +\n                'data-bs-toggle=\"tooltip\" ' +\n                'data-bs-placement=\"right\" ' +\n                'data-bs-html=\"true\" ' +\n                'title=\"' + nivel_encontrado.descripcion + '\">' +\n            '</i>' +\n        '</div>'\n    );\n\n    return $opcion;\n}\n\n/**\n * Formatea la selección mostrada del nivel de idioma\n *\n * @param {Object} opcion Opción seleccionada\n * @returns {string} Texto de la opción\n * @author Andres Morales\n */\nfunction formatearSeleccionNivelIdioma(opcion) {\n    if (!opcion.id) {\n        return opcion.text;\n    }\n\n    var nivel_encontrado = niveles_idiomas.find(function(nivel) {\n        return nivel.id === opcion.id;\n    });\n\n    return nivel_encontrado ? nivel_encontrado.nombre : opcion.text;\n}\n\n/**\n * Carga las herramientas tecnológicas previamente utilizadas\n * @description Obtiene las herramientas tecnológicas de vacantes anteriores para autocompletado\n * Las habilidades se cargan automáticamente con crearSelectAsincronoChips\n * @returns {void}\n * @author Andres Morales\n * @author Jair Carvajal\n */\nfunction cargarHabilidadesHerramientas() {\n    $.getJSON('/vacantes-habilidades-herramientas')\n        .done(function(respuesta) {\n            var datos = respuesta.data || respuesta;\n\n            var $select_habilidades = $('#habilidades');\n            if ($select_habilidades.length && datos.habilidades && datos.habilidades.length > 0) {\n                $select_habilidades.empty();\n                $.each(datos.habilidades, function(_, habilidad) {\n                    var option = new Option(habilidad, habilidad, false, false);\n                    $select_habilidades.append(option);\n                });\n                $select_habilidades.trigger('change');\n            }\n            \n            var $select_herramientas = $('#herramientas_tecnologicas');\n            if ($select_herramientas.length && datos.herramientas_tecnologicas && datos.herramientas_tecnologicas.length > 0) {\n                $select_herramientas.empty();\n                $.each(datos.herramientas_tecnologicas, function(_, herramienta) {\n                    var option = new Option(herramienta, herramienta, false, false);\n                    $select_herramientas.append(option);\n                });\n                $select_herramientas.trigger('change');\n            }\n\n            if (typeof actualizarSelect2 === 'function') {\n                actualizarSelect2('#habilidades');\n                actualizarSelect2('#herramientas_tecnologicas');\n            }\n\n            if (window.vacante_edicion && window.vacante_edicion.datos) {\n                setTimeout(function() {\n                    window.vacante_edicion.datos.forEach(function(dato) {\n                        if (dato.llave === 'habilidades' && dato.valor) {\n                            var habilidades = dato.valor.split(',').map(function(h) { return h.trim(); }).filter(function(h) { return h !== ''; });\n                            habilidades.forEach(function(habilidad) {\n                                if ($('#habilidades option[value=\"' + habilidad + '\"]').length === 0) {\n                                    var option = new Option(habilidad, habilidad, true, true);\n                                    $('#habilidades').append(option);\n                                } else {\n                                    $('#habilidades option[value=\"' + habilidad + '\"]').prop('selected', true);\n                                }\n                            });\n                            $('#habilidades').trigger('change');\n                        }\n                        \n                        if (dato.llave === 'herramientas_tecnologicas' && dato.valor) {\n                            var herramientas = dato.valor.split(',').map(function(h) { return h.trim(); }).filter(function(h) { return h !== ''; });\n                            herramientas.forEach(function(herramienta) {\n                                if ($('#herramientas_tecnologicas option[value=\"' + herramienta + '\"]').length === 0) {\n                                    var option = new Option(herramienta, herramienta, true, true);\n                                    $('#herramientas_tecnologicas').append(option);\n                                } else {\n                                    $('#herramientas_tecnologicas option[value=\"' + herramienta + '\"]').prop('selected', true);\n                                }\n                            });\n                            $('#herramientas_tecnologicas').trigger('change');\n                        }\n                    });\n                    validarFormularioCompleto();\n                }, 200);\n            } else {\n                validarFormularioCompleto();\n            }\n        })\n        .fail(function(jqXHR, textStatus, errorThrown) {\n            if (typeof actualizarSelect2 === 'function') {\n                actualizarSelect2('#habilidades');\n                actualizarSelect2('#herramientas_tecnologicas');\n            }\n            validarFormularioCompleto();\n        });\n}\n\n/**\n * Valida si el nombre de la vacante ya existe en la base de datos\n * @description Realiza una petición AJAX para verificar si existe una vacante con el mismo nombre\n * @returns {void}\n * @author Jair Carvjaal\n */\nasync function validarNombreVacanteDuplicado() {\n    var nombre_vacante = $('#nombre_vacante').val();\n    if (!nombre_vacante || nombre_vacante.trim() === '') {\n        return;\n    }\n    \n    let permitir_duplicados = await obtenerConfiguracionNombresDuplicados();\n\n    if (permitir_duplicados == 0) {\n        $.ajax({\n            type: 'GET',\n            url: '/vacantes-listado-tabla',\n            data: {\n                nombre_vacante: nombre_vacante.trim(),\n                activo: 1\n            }\n        })\n        .done(function(respuesta) {\n            var vacantes_encontradas = respuesta.data || [];\n    \n            if (vacantes_encontradas.length > 0) {\n                mostrarToast('danger', 'Ya existe una vacante con este nombre. Por favor, elige un nombre diferente.');\n                $('#nombre_vacante').addClass('error');\n                deshabilitarBotonSiguiente();\n            } else {\n                $('#nombre_vacante').removeClass('error');\n                validarFormularioCompleto();\n            }\n        })\n    } else {\n        validarFormularioCompleto();\n    }\n    \n}\n\n/**\n * Deshabilita el botón siguiente\n * @description Deshabilita el botón \"Siguiente\" y añade estilos visuales de deshabilitado\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction deshabilitarBotonSiguiente() {\n    $('#btn_siguiente').prop('disabled', true).css('opacity', '0.6').css('cursor', 'not-allowed');\n}\n\n/**\n * Habilita el botón siguiente\n * @description Habilita el botón \"Siguiente\" y elimina estilos visuales de deshabilitado\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction habilitarBotonSiguiente() {\n    $('#btn_siguiente').prop('disabled', false).css('opacity', '1').css('cursor', 'pointer');\n}\n\n/**\n * Valida que todos los campos obligatorios estén completos\n * @description Verifica que todos los campos requeridos contengan valores válidos\n * @returns {boolean} true si el formulario está completo, false en caso contrario\n * @author Jair Carvajal\n */\nfunction validarFormularioCompleto() {\n    var nombre_vacante = $('#nombre_vacante').val().trim();\n    var cantidad_vacantes = $('#cantidad_vacantes').val().trim();\n    var experiencia_laboral = $('#experiencia_laboral').val();\n    var nivel_educativo = $('#nivel_educativo_vacante').val();\n    var habilidades = $('#habilidades').val();\n    var herramientas_tecnologicas = $('#herramientas_tecnologicas').val();\n\n    // Validar campos básicos\n    if (!nombre_vacante || !cantidad_vacantes) {\n        deshabilitarBotonSiguiente();\n        return false;\n    }\n\n    // Validar ubicación según tipo de lugar de trabajo\n    var lugar_trabajo = $('input[name=\"lugar_trabajo\"]:checked').val();\n    if (lugar_trabajo === 'otro') {\n        var pais_id = $('#pais_id').val();\n        var departamento_id = $('#departamento_id').val();\n        var ciudad_id = $('#ciudad_id').val();\n        var direccion = $('#direccion_trabajo').val().trim();\n\n        if (!pais_id || !departamento_id || !ciudad_id || !direccion) {\n            deshabilitarBotonSiguiente();\n            return false;\n        }\n    }\n\n    // Validar salario según tipo\n    var tipo_salario = $('input[name=\"tipo_salario\"]:checked').val();\n    if (tipo_salario === 'especifico') {\n        var salario_cantidad = $('#salario_cantidad').val();\n        if (!salario_cantidad) {\n            deshabilitarBotonSiguiente();\n            return false;\n        }\n    } else if (tipo_salario === 'a_convenir') {\n        var salario_desde = $('#salario_desde').val();\n        var salario_hasta = $('#salario_hasta').val();\n        if (!salario_desde || !salario_hasta) {\n            deshabilitarBotonSiguiente();\n            return false;\n        }\n        // Validar que el rango sea correcto\n        if (!validarRangoSalario()) {\n            deshabilitarBotonSiguiente();\n            return false;\n        }\n    }\n\n    // Validar edad si es rango\n    var tipo_edad = $('input[name=\"tipo_edad\"]:checked').val();\n    if (tipo_edad === 'rango') {\n        var edad_desde = $('#edad_desde').val();\n        var edad_hasta = $('#edad_hasta').val();\n        if (!edad_desde || !edad_hasta) {\n            deshabilitarBotonSiguiente();\n            return false;\n        }\n        // Validar que el rango sea correcto\n        if (!validarRangoEdades()) {\n            deshabilitarBotonSiguiente();\n            return false;\n        }\n    }\n\n    if (!habilidades || habilidades.length === 0) {\n        deshabilitarBotonSiguiente();\n        return false;\n    }\n\n    if (!herramientas_tecnologicas || herramientas_tecnologicas.length === 0) {\n        deshabilitarBotonSiguiente();\n        return false;\n    }\n\n    if (!experiencia_laboral) {\n        deshabilitarBotonSiguiente();\n        return false;\n    }\n\n    if (!nivel_educativo) {\n        deshabilitarBotonSiguiente();\n        return false;\n    }\n\n    if ($('#licencia_conducir').prop('checked')) {\n        var tipo_licencia = $('#tipo_licencia').val();\n        if (!tipo_licencia) {\n            deshabilitarBotonSiguiente();\n            return false;\n        }\n    }\n\n    if ($('#formulario-vacantes-paso-1').find('.error').length > 0) {\n        deshabilitarBotonSiguiente();\n        return false;\n    }\n\n    // Si todo está correcto, habilitar el botón\n    habilitarBotonSiguiente();\n    return true;\n}","numLines":809,"startLine":1,"totalLines":809}},"sourceToolAssistantUUID":"63c643fa-d398-4c1d-a306-e1d213fc1f34"}
{"parentUuid":"8e4dde1f-2697-445b-9197-c83919355427","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MCWeeZ1WjERsxbzMPAMbR2","type":"tool_result","content":"     1→/**\n     2→ * Archivo para manejar la lógica del Paso 2: Etapas de la vacante\n     3→ * @author Andres Morales\n     4→ * @author José Manuel Jiménez\n     5→ */\n     6→const CONFIGURACION_ETAPAS = {\n     7→    'Revisión HV': {\n     8→        titulo_modal_notificacion: 'Inicio proceso de selección',\n     9→        titulo_notificacion: 'Notificación inicio proceso de selección',\n    10→        titulo_etapa: 'Revisión hoja de vida',\n    11→        plantilla_correo_id: 12\n    12→    },\n    13→    'Preguntas prefiltro': {\n    14→        titulo_modal_notificacion: 'Preguntas pre-filtro',\n    15→        titulo_notificacion: 'Notificacion envío de preguntas pre-filtro',\n    16→        titulo_etapa: 'Preguntas prefiltro',\n    17→        plantilla_correo_id: 13\n    18→    },\n    19→    'Pruebas psicométricas': {\n    20→        titulo_modal_notificacion: 'Pruebas psicométricas',\n    21→        titulo_notificacion: 'Notificación envío de pruebas psicométricas',\n    22→        titulo_etapa: 'Pruebas psicométricas',\n    23→        plantilla_correo_id: 15\n    24→    },\n    25→    'Prueba técnica': {\n    26→        titulo_modal_notificacion: 'Prueba técnica',\n    27→        titulo_notificacion: 'Notificación envío de prueba técnica',\n    28→        titulo_etapa: 'Prueba técnica',\n    29→        plantilla_correo_id: 18\n    30→    },\n    31→    'Video entrevista': {\n    32→        titulo_modal_notificacion: 'Video entrevista',\n    33→        titulo_notificacion: 'Notificación envío de video entrevista',\n    34→        titulo_etapa: 'Solicitud video entrevista',\n    35→        plantilla_correo_id: 21\n    36→    },\n    37→    'Entrevista': {\n    38→        titulo_modal_notificacion: 'Entrevista',\n    39→        titulo_notificacion: 'Notificacíon de entrevista',\n    40→        titulo_etapa: 'Solicitud de entrevista',\n    41→        plantilla_correo_id: 26\n    42→    },\n    43→    'Documentos para contratación': {\n    44→        titulo_modal_notificacion: 'Documentos para contratación',\n    45→        titulo_notificacion: 'Notificación envío de solicitud de documentos',\n    46→        titulo_etapa: 'Solicitar documentos',\n    47→        plantilla_correo_id: 23\n    48→    },\n    49→    'Contratados': {\n    50→        titulo_modal_notificacion: 'Contratados',\n    51→        titulo_notificacion: 'Notificación de resultado del proceso',\n    52→        plantilla_correo_id: 27\n    53→    },\n    54→    'Descartados': {\n    55→        titulo_modal_notificacion: 'Descartados',\n    56→        titulo_notificacion: 'Notificación de resultado del proceso',\n    57→        plantilla_correo_id: 28\n    58→    }\n    59→};\n    60→\n    61→let etapa_movimiento_vacante_id_seleccionado = null;\n    62→let etapa_vacante_id_seleccionado = null;\n    63→let modal_movimiento_id_seleccionado = null;\n    64→let contador_preguntas = 0; // Contador general (mantener por compatibilidad)\n    65→let contador_preguntas_prefiltro = 0; // Contador específico para modal preguntas prefiltro\n    66→let contador_preguntas_video_entrevista = 0; // Contador específico para modal video entrevista\n    67→let contador_respuestas = 0;\n    68→let archivos_preguntas = [];\n    69→let toggle_etapa_activado = null;\n    70→let etapa_activada_desde_toggle = false;\n    71→let archivos_cargados = [];\n    72→\n    73→/**\n    74→ * Obtiene la configuración de títulos para una etapa\n    75→ *\n    76→ * @param {string} nombre_etapa Nombre de la etapa\n    77→ * @param {string} tipo_titulo Tipo de título a obtener: 'titulo_modal_notificacion', 'titulo_notificacion' o 'titulo_etapa'\n    78→ * @returns {string|null} Título configurado o null si no existe\n    79→ * @author Andres Morales\n    80→ */\n    81→function obtenerTituloEtapa(nombre_etapa, tipo_titulo = 'titulo_modal_notificacion') {\n    82→    var configuracion = CONFIGURACION_ETAPAS[nombre_etapa];\n    83→    return configuracion && configuracion[tipo_titulo] ? configuracion[tipo_titulo] : null;\n    84→}\n    85→\n    86→/**\n    87→ * Verifica si existe un título configurado para una etapa\n    88→ *\n    89→ * @param {string} nombre_etapa Nombre de la etapa\n    90→ * @param {string} tipo_titulo Tipo de título a verificar\n    91→ * @returns {boolean} True si existe el título, false si no\n    92→ * @author Andres Morales\n    93→ */\n    94→function existeTituloEtapa(nombre_etapa, tipo_titulo) {\n    95→    return obtenerTituloEtapa(nombre_etapa, tipo_titulo) !== null;\n    96→}\n    97→\n    98→/**\n    99→ * Obtiene el ID de plantilla de correo para una etapa\n   100→ *\n   101→ * @param {string} nombre_etapa Nombre de la etapa\n   102→ * @returns {number|null} ID de la plantilla o null si no existe\n   103→ * @author Andres Morales\n   104→ */\n   105→function obtenerPlantillaCorreoId(nombre_etapa) {\n   106→    var configuracion = CONFIGURACION_ETAPAS[nombre_etapa];\n   107→    return configuracion && configuracion.plantilla_correo_id ? configuracion.plantilla_correo_id : null;\n   108→}\n   109→\n   110→/**\n   111→ * Consulta la plantilla de correo de una etapa específica\n   112→ *\n   113→ * @param {string} nombre_etapa Nombre de la etapa\n   114→ * @returns {Promise} Promesa con los datos de la plantilla\n   115→ * @author Andres Morales\n   116→ */\n   117→function consultarPlantillaEtapa(nombre_etapa) {\n   118→    var plantilla_correo_id = obtenerPlantillaCorreoId(nombre_etapa);\n   119→\n   120→    if (!plantilla_correo_id) {\n   121→        console.error('No se encontró ID de plantilla para la etapa:', nombre_etapa);\n   122→        return Promise.reject('No se encontró ID de plantilla');\n   123→    }\n   124→\n   125→    return $.ajax({\n   126→        url: '/plantilla-correo',\n   127→        method: 'GET',\n   128→        data: {\n   129→            plantilla_correo_id: plantilla_correo_id,\n   130→            empresa_id: empresa?.id\n   131→        },\n   132→        dataType: 'json'\n   133→    });\n   134→}\n   135→\n   136→/**\n   137→ * Función para consultar las etapas de una vacante\n   138→ *\n   139→ * @param {number} vacante_id ID de la vacante\n   140→ * @author José Manuel Jiménez\n   141→ * @author Andres Morales\n   142→ */\n   143→function consultarEtapasVacante(vacante_id) {\n   144→    $.ajax({\n   145→        url: `/etapas-vacantes`,\n   146→        data: { vacante_id: vacante_id },\n   147→        method: 'GET',\n   148→        dataType: 'json',\n   149→        success: function(respuesta) {\n   150→            etapas_vacante = respuesta.data || [];\n   151→            mostrarEtapasVacante();\n   152→            calcularDiasDuracionProceso(vacante_id);\n   153→        }\n   154→    });\n   155→}\n   156→\n   157→/**\n   158→ * Función para calcular y mostrar los días de duración del proceso\n   159→ *\n   160→ * @param {number} vacante_id ID de la vacante\n   161→ * @returns {void}\n   162→ * @author Andres Morales\n   163→ */\n   164→function calcularDiasDuracionProceso(vacante_id) {\n   165→    $.ajax({\n   166→        url: `/vacantes-calcular-dias-duracion-proceso/${vacante_id}`,\n   167→        method: 'GET',\n   168→        dataType: 'json',\n   169→        success: function(respuesta) {\n   170→            var dias = respuesta.duracion_dias || 0;\n   171→            $('#contador-dias-proceso').html(dias);\n   172→        },\n   173→        error: function() {\n   174→            $('#contador-dias-proceso').html('0');\n   175→        }\n   176→    });\n   177→}\n   178→\n   179→/**\n   180→ * Función para mostrar las etapas de una vacante en un acordeon.\n   181→ *\n   182→ * @param {Object} etapas Array con las etapas de la vacante.\n   183→ * @author José Manuel Jiménez\n   184→ * @author Andres Morales\n   185→ */\n   186→function mostrarEtapasVacante() {\n   187→    let etapas = etapas_vacante;\n   188→    $('#contenedor-vacantes-etapas').empty().append(crearAcordeon({\n   189→        id: 'acordeon',\n   190→        acordeon: etapas.map((etapa, index) => ({\n   191→            id: `etapa-${index}`,\n   192→            titulo: `\n   193→                <div class=\"col\">\n   194→                    <div class=\"row\">\n   195→                        <div class=\"col ps-1 text-gray-10 text-body-1\">${etapa.nombre}</div>\n   196→                        <div class=\"col-auto pe-7\">\n   197→                            ${etapa.editable == 1 ? crearToggle({\n   198→                                id: `activar_etapa_${index}`,\n   199→                                name: `activar_etapa_${index}`,\n   200→                                class: 'checkbox-etapa-vacante',\n   201→                                value: etapa.id,\n   202→                                checked: etapa.activa == 1 ? true : false,\n   203→                                onchange: `activarDesactivarEtapa(this)`,\n   204→                            }) : ''}\n   205→                        </div>\n   206→                    </div>\n   207→                </div>\n   208→            `,\n   209→            contenido: `\n   210→                <div class=\"row\">\n   211→                    ${etapa.etapas_movimientos.map(etapa_movimiento => `\n   212→                        <div class=\"col-12 d-flex justify-content-between align-items-center\">\n   213→                            <div class=\"text-body-2 text-gray-30\">\n   214→                                ${etapa_movimiento.movimiento.nombre}\n   215→                            </div>\n   216→                            <div>\n   217→                                ${crearBoton({\n   218→                                    clases: 'btn-text-primary btn-circle',\n   219→                                    texto: '<i class=\"bi bi-gear\"></i>',\n   220→                                    onclick: `${etapa_movimiento.movimiento.es_notificacion == 1 ?\n   221→                                        `abrirModalNotificacionEtapa(${etapa.id})` : `abrirModalMovimientoEtapa(${etapa_movimiento.movimiento.id}, ${etapa_movimiento.id}, ${etapa_movimiento.etapa_vacante_id})`\n   222→                                    }`\n   223→                                })}\n   224→                            </div>\n   225→                        </div>\n   226→                    `).join('')}\n   227→                </div>\n   228→            `,\n   229→            disabled: etapa.activa == 0 ? true : false,\n   230→            ordenar: etapa.fija == 0 ? true : false,\n   231→            adicional: `data-orden=\"${etapa.orden}\" data-etapa_vacante_id=\"${etapa.id}\" data-fija=\"${etapa.fija}\"`,\n   232→        }))\n   233→    }));\n   234→    $(\"#acordeon\").sortable({\n   235→        items: \".accordion-item\",\n   236→        handle: \".drag-handle\",\n   237→        cursor: \"grabbing\",\n   238→        placeholder: \"ui-sortable-placeholder\",\n   239→        tolerance: \"pointer\",\n   240→        update: function(evento, elemento) {\n   241→            let elemento_actual = elemento.item;\n   242→            let orden_actual = $(elemento_actual).data('orden');\n   243→            let elemento_anterior = elemento_actual.prev();\n   244→            let orden_anterior = $(elemento_anterior).data('orden');\n   245→            let es_fijo_anterior = $(elemento_anterior).data('fija');\n   246→            if (es_fijo_anterior == 1) {\n   247→                return false;\n   248→            }\n   249→            if (orden_anterior == undefined) {\n   250→                orden_anterior = '0';\n   251→            }\n   252→            if ((parseInt(orden_actual) - 1) != orden_anterior) {\n   253→                if (parseInt(orden_actual) > parseInt(orden_anterior)) {\n   254→                    orden_anterior = parseInt(orden_anterior) + 1;\n   255→                }\n   256→                let etapa_vacante_id = $(elemento_actual).data('etapa_vacante_id');\n   257→                $.ajax({\n   258→                    url : `/etapas-vacantes-cambiar-orden`,\n   259→                    type: 'POST',\n   260→                    data: {\n   261→                        _token : $('meta[name=\"csrf-token\"]').attr('content'),\n   262→                        _method: 'PUT',\n   263→                        id: etapa_vacante_id,\n   264→                        orden: orden_anterior\n   265→                    },\n   266→                    success: function (respuesta) {\n   267→                        mostrarToast('success', respuesta.message);\n   268→                        $(elemento_actual).data('orden', orden_anterior);\n   269→                        $(elemento_anterior).data('orden', orden_actual);\n   270→                    },\n   271→                    error: function (error) {\n   272→                        mostrarToast('danger', 'Ocurrió un error al organizar');\n   273→                    }\n   274→                });\n   275→            }\n   276→        }\n   277→    });\n   278→}\n   279→\n   280→/**\n   281→ * Función para activar o desactivar un acordeon de una etapa de la vacante.\n   282→ *\n   283→ * @param {HTMLInputElement} checkbox Checkbox que activa o desactiva la etapa\n   284→ * @author José Manuel Jiménez\n   285→ * @author Andres Morales\n   286→ */\n   287→function activarDesactivarEtapa(checkbox) {\n   288→    setTimeout(() => {\n   289→        if (checkbox.checked) {\n   290→            $(checkbox).closest('.accordion-item').find('.accordion-button').removeClass('collapsed').attr('aria-disabled', 'false').attr('disabled', false);\n   291→            $(checkbox).closest('.accordion-item').find('.accordion-collapse').addClass('show').attr('aria-expanded', 'true');\n   292→\n   293→            toggle_etapa_activado = checkbox;\n   294→            etapa_activada_desde_toggle = true;\n   295→\n   296→            var etapa_vacante_id = $(checkbox).closest('.accordion-item').data('etapa_vacante_id');\n   297→\n   298→            var etapa_encontrada = etapas_vacante.find(function(etapa) {\n   299→                return etapa.id === etapa_vacante_id;\n   300→            });\n   301→\n   302→            if (etapa_encontrada && etapa_encontrada.etapas_movimientos) {\n   303→                var primer_movimiento_config = etapa_encontrada.etapas_movimientos.find(function(etapa_movimiento) {\n   304→                    return etapa_movimiento.movimiento && etapa_movimiento.movimiento.es_notificacion !== 1;\n   305→                });\n   306→\n   307→                if (primer_movimiento_config && primer_movimiento_config.movimiento) {\n   308→                    abrirModalMovimientoEtapa(\n   309→                        primer_movimiento_config.movimiento.id,\n   310→                        primer_movimiento_config.id,\n   311→                        primer_movimiento_config.etapa_vacante_id\n   312→                    );\n   313→                }\n   314→            }\n   315→        } else {\n   316→            $(checkbox).closest('.accordion-item').find('.accordion-button').addClass('collapsed').attr('aria-disabled', 'true').attr('disabled', true);\n   317→            $(checkbox).closest('.accordion-item').find('.accordion-collapse').removeClass('show').attr('aria-expanded', 'false');\n   318→        }\n   319→        $.ajax({\n   320→            url: `/etapas-vacantes/${checkbox.value}`,\n   321→            data: {\n   322→                activa: checkbox.checked ? 1 : 0,\n   323→                _token: $('meta[name=\"csrf-token\"]').attr('content')\n   324→            },\n   325→            method: 'PUT',\n   326→            dataType: 'json',\n   327→            success: function(respuesta) {\n   328→                var vacante_id = $('#id').val();\n   329→                if (vacante_id) {\n   330→                    calcularDiasDuracionProceso(vacante_id);\n   331→                }\n   332→            }\n   333→        });\n   334→    }, 500);\n   335→}\n   336→\n   337→/**\n   338→ * Función para filtrar las etapas de la vacante en el acordeon.\n   339→ *\n   340→ * @param {string} mostrar_etapas Valor del filtro: '1' para mostrar solo las etapas activas, '0' para mostrar solo las etapas inactivas, cualquier otro valor para mostrar todas las etapas.\n   341→ * @author José Manuel Jiménez\n   342→ */\n   343→function filtrarEtapasVacante(mostrar_etapas) {\n   344→    $('#acordeon .accordion-item').removeClass('d-none');\n   345→    if (mostrar_etapas == '1') {\n   346→        $('#acordeon .accordion-item').each(function() {\n   347→            if ($(this).find('.checkbox-etapa-vacante').length > 0 && !$(this).find('.checkbox-etapa-vacante').is(':checked')) {\n   348→                $(this).addClass('d-none');\n   349→            }\n   350→        });\n   351→    } else if (mostrar_etapas == '0') {\n   352→        $('#acordeon .accordion-item').each(function() {\n   353→            if ($(this).find('.checkbox-etapa-vacante').length == 0 || $(this).find('.checkbox-etapa-vacante').is(':checked')) {\n   354→                $(this).addClass('d-none');\n   355→            }\n   356→        });\n   357→    }\n   358→}\n   359→\n   360→/**\n   361→ * Función para abrir la modal de edición de plantilla de etapa\n   362→ *\n   363→ * @param {number} etapa_id ID de la etapa\n   364→ * @returns {void}\n   365→ * @author Andres Morales\n   366→ * @author Andres Gonzalez\n   367→ */\n   368→function abrirModalNotificacionEtapa(etapa_id) {\n   369→    $('#modal-editar-plantilla-etapa #etapa_id').val(etapa_id);\n   370→\n   371→    let etapa = etapas_vacante.find(e => e.id === etapa_id);\n   372→\n   373→    if (etapa) {\n   374→        $('#titulo-plantilla-modal').text(etapa.nombre);\n   375→\n   376→        if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n   377→            $('#contenedor_check_enviar_al_finalizar').html(`\n   378→                ${crearCheckbox({\n   379→                    id: 'enviar_finalizar',\n   380→                    class: 'input-dinamico',\n   381→                    label: 'Enviar comunicación únicamente cuando finalice el proceso',\n   382→                })}\n   383→            `);\n   384→        } else {\n   385→            $('#contenedor_check_enviar_al_finalizar').html(`\n   386→                ${crearCheckbox({\n   387→                    id: 'enviar_finalizar',\n   388→                    class: 'input-dinamico',\n   389→                    input_container_class: 'd-none',\n   390→                    checked: false,\n   391→                    label: 'Enviar comunicación únicamente cuando finalice el proceso',\n   392→                })}\n   393→            `);\n   394→        }\n   395→\n   396→        consultarPlantillaEtapa(etapa.nombre).then(function(respuesta) {\n   397→            var plantilla = respuesta.data;\n   398→\n   399→            $('#modal-editar-plantilla-etapa #id').val(plantilla.id);\n   400→            $('#modal-editar-plantilla-etapa #plantilla_correo_id').val(plantilla.plantilla_correo_id || plantilla.id);\n   401→            $('#modal-editar-plantilla-etapa #empresa_id').val(plantilla.empresa_id || (empresa && empresa.id) || '');\n   402→            $('#modal-editar-plantilla-etapa #grupo_id').val(plantilla.grupo_id);\n   403→            $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val(plantilla.titulo);\n   404→\n   405→            if (plantilla.con_logo_empresa == 1) {\n   406→                $('#modal-editar-plantilla-etapa #con_logo').prop('checked', true);\n   407→            } else {\n   408→                $('#modal-editar-plantilla-etapa #con_logo').prop('checked', false);\n   409→            }\n   410→\n   411→            if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n   412→                if (plantilla.notificar_fin_proceso == 1) {\n   413→                    $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', true);\n   414→                } else {\n   415→                    $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', false);\n   416→                }\n   417→            }\n   418→\n   419→            $('#contenedor_editor_texto').html(`\n   420→                ${crearEditorTexto({\n   421→                    adicional: `data-botonadicional=\"botonAdicionalCkeditorEtapa\"`,\n   422→                    id: 'descripcion_mensaje_etapa',\n   423→                    name: 'descripcion_mensaje_etapa',\n   424→                    class: 'classic-editor-opciones',\n   425→                    input_container_class: 'mb-4',\n   426→                    maxlength: 16350,\n   427→                    required: true\n   428→                })}\n   429→            `);\n   430→\n   431→            inicializarClassicEditor();\n   432→\n   433→            setTimeout(function() {\n   434→                if ($('#descripcion_mensaje_etapa').data('editor')) {\n   435→                    $('#descripcion_mensaje_etapa').data('editor').setData(plantilla.contenido || '');\n   436→                }\n   437→            }, 500);\n   438→        }).catch(function(error) {\n   439→            if (typeof empresa !== 'undefined' && empresa && empresa.id) {\n   440→                $('#modal-editar-plantilla-etapa #empresa_id').val(empresa.id);\n   441→            }\n   442→\n   443→            $('#contenedor_editor_texto').html(`\n   444→                ${crearEditorTexto({\n   445→                    adicional: `data-botonadicional=\"botonAdicionalCkeditorEtapa\"`,\n   446→                    id: 'descripcion_mensaje_etapa',\n   447→                    name: 'descripcion_mensaje_etapa',\n   448→                    class: 'classic-editor-opciones',\n   449→                    input_container_class: 'mb-4',\n   450→                    maxlength: 16350,\n   451→                    required: true\n   452→                })}\n   453→            `);\n   454→\n   455→            inicializarClassicEditor();\n   456→        });\n   457→    }\n   458→\n   459→    $('#modal-editar-plantilla-etapa').modal('show');\n   460→}\n   461→\n   462→/**\n   463→ * Crear boton adicional para ckeditor con variables de etapa\n   464→ *\n   465→ * @param {string} id ID del editor\n   466→ * @returns {html} botón adicional para ckeditor\n   467→ * @author Andres Morales\n   468→ */\n   469→function botonAdicionalCkeditorEtapa(id) {\n   470→    var variables_etapa = [\n   471→        { llave: 'nombre_informador', valor: 'Nombre de usuario (Yo)' },\n   472→        { llave: 'nombre_empresa', valor: 'Nombre de la empresa' },\n   473→        { llave: 'nombre_vacante', valor: 'Nombre de la vacante' },\n   474→        { llave: 'nombre_candidato', valor: 'Nombre del candidato' }\n   475→    ];\n   476→\n   477→    var opciones_variables = variables_etapa\n   478→        .map(variable => `<button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableEtapa('${id}', '__${variable.llave}__')\">${variable.valor}</button>`)\n   479→        .join('');\n   480→\n   481→    return `\n   482→        <div class=\"border-start border-black border-2 px-2 my-0 dropdown\">\n   483→            ${crearBoton({\n   484→                clases: 'dropdown-toggle text-body-3 btn-dropdown-ckeditor',\n   485→                texto: 'Agregar variable<i class=\"bi bi-chevron-down text-body-3 ms-2\"></i>',\n   486→                data: [{texto: 'bs-toggle', value: 'dropdown'},{texto: 'bs-auto-close', value: 'outside'}]\n   487→            })}\n   488→            <div class=\"dropdown-menu bg-white\">${opciones_variables}</div>\n   489→        </div>\n   490→    `;\n   491→}\n   492→\n   493→/**\n   494→ * Agrega la variable en el ckeditor de etapa\n   495→ *\n   496→ * @param {string} id ID del editor\n   497→ * @param {string} variable Variable a agregar\n   498→ * @returns {void}\n   499→ * @author Andres Morales\n   500→ * @author Andres Gonzalez\n   501→ */\n   502→function agregarVariableEtapa(id, variable) {\n   503→    let editor = $(`#${id}`).data('editor');\n   504→    let fragmento_vista = editor.data.processor.toView(variable);\n   505→    let fragmento_modelo = editor.data.toModel(fragmento_vista);\n   506→    editor.model.insertContent(fragmento_modelo);\n   507→}\n   508→\n   509→/**\n   510→ * Inicializar configuración del formulario de plantilla de etapa\n   511→ *\n   512→ * @returns {void}\n   513→ * @author Andres Morales\n   514→ */\n   515→$(document).ready(function() {\n   516→    configurarFormulario('form-editar-plantilla-etapa');\n   517→\n   518→    $(document).on('click', '#restablecer_texto', function () {\n   519→        confirmarRestablecerTexto();\n   520→    });\n   521→\n   522→    $(document).on('click', '#btn-cancelar-plantilla-etapa', function () {\n   523→        confirmarCancelarPlantillaEtapa();\n   524→    });\n   525→\n   526→    $(\".formulario-movimiento\").each(function() {\n   527→        let $formulario_movimiento = $(this);\n   528→        $formulario_movimiento.on(\"change keyup blur\", \"input, select, textarea\", function() {\n   529→            let formulario_movimiento_valido = $formulario_movimiento.validate().checkForm();\n   530→            if (formulario_movimiento_valido) {\n   531→                $formulario_movimiento.closest('.modal-content').find('button[type=\"submit\"]').prop('disabled', false);\n   532→            } else {\n   533→                $formulario_movimiento.closest('.modal-content').find('button[type=\"submit\"]').prop('disabled', true);\n   534→            }\n   535→        });\n   536→    });\n   537→});\n   538→\n   539→/**\n   540→ * Confirmar antes de cancelar la edición de la plantilla\n   541→ *\n   542→ * @returns {void}\n   543→ * @author Andres Morales\n   544→ */\n   545→function confirmarCancelarPlantillaEtapa() {\n   546→    Swal.fire({\n   547→        showCloseButton: true,\n   548→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   549→        showConfirmButton: false,\n   550→        showDenyButton: false,\n   551→        showCancelButton: false,\n   552→        html: `\n   553→            <div class=\"row w-100 mx-0 mt-2\">\n   554→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas cancelar?</div>\n   555→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Los cambios que hayas realizado en la plantilla no se guardarán. Esta acción no se puede deshacer.</div>\n   556→                <div class=\"col-6 mt-5 mb-2\">\n   557→                    ${crearBoton({\n   558→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   559→                        texto: 'Cancelar',\n   560→                        onclick: `Swal.clickDeny();`\n   561→                    })}\n   562→                </div>\n   563→                <div class=\"col-6 mt-5 mb-2\">\n   564→                    ${crearBoton({\n   565→                        clases: 'btn-primary w-100 justify-content-center',\n   566→                        texto: 'Aceptar',\n   567→                        onclick: `Swal.clickConfirm();`\n   568→                    })}\n   569→                </div>\n   570→            </div>\n   571→        `,\n   572→    }).then((result) => {\n   573→        if (result.isConfirmed) {\n   574→            $('#modal-editar-plantilla-etapa').modal('hide');\n   575→            limpiarFormulario('form-editar-plantilla-etapa');\n   576→        }\n   577→    });\n   578→}\n   579→\n   580→/**\n   581→ * Confirmar antes de restablecer el texto de la plantilla\n   582→ *\n   583→ * @returns {void}\n   584→ * @author Andres Morales\n   585→ */\n   586→function confirmarRestablecerTexto() {\n   587→    Swal.fire({\n   588→        showCloseButton: true,\n   589→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   590→        showConfirmButton: false,\n   591→        showDenyButton: false,\n   592→        showCancelButton: false,\n   593→        html: `\n   594→            <div class=\"row w-100 mx-0 mt-2\">\n   595→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas restablecer?</div>\n   596→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Se restablecerá el texto de la plantilla a su versión por defecto. Los cambios personalizados que hayas hecho se perderán. Esta acción no se puede deshacer.</div>\n   597→                <div class=\"col-6 mt-5 mb-2\">\n   598→                    ${crearBoton({\n   599→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   600→                        texto: 'Cancelar',\n   601→                        onclick: `Swal.clickDeny();`\n   602→                    })}\n   603→                </div>\n   604→                <div class=\"col-6 mt-5 mb-2\">\n   605→                    ${crearBoton({\n   606→                        clases: 'btn-danger w-100 justify-content-center',\n   607→                        texto: 'Restablecer',\n   608→                        onclick: `Swal.clickConfirm();`\n   609→                    })}\n   610→                </div>\n   611→            </div>\n   612→        `,\n   613→    }).then((result) => {\n   614→        if (result.isConfirmed) {\n   615→            restablecerPlantillaEtapa();\n   616→        }\n   617→    });\n   618→}\n   619→\n   620→/**\n   621→ * Restablecer la plantilla de etapa a su versión por defecto\n   622→ *\n   623→ * @returns {void}\n   624→ * @author Andres Morales\n   625→ */\n   626→function restablecerPlantillaEtapa() {\n   627→    var plantilla_id = $('#modal-editar-plantilla-etapa #id').val();\n   628→    var etapa_id = $('#modal-editar-plantilla-etapa #etapa_id').val();\n   629→\n   630→    if (!plantilla_id) {\n   631→        mostrarToast('danger', 'No se ha seleccionado una plantilla para restablecer');\n   632→        return;\n   633→    }\n   634→\n   635→    if (!etapa_id) {\n   636→        mostrarToast('danger', 'No se ha identificado la etapa');\n   637→        return;\n   638→    }\n   639→\n   640→    $.ajax({\n   641→        url: `/plantillas-correos-restablecer/${plantilla_id}`,\n   642→        type: 'PUT',\n   643→        headers: {\n   644→            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n   645→        },\n   646→        success: function(respuesta) {\n   647→            mostrarToast('success', respuesta.message);\n   648→\n   649→            let etapa = etapas_vacante.find(e => e.id === parseInt(etapa_id));\n   650→\n   651→            if (etapa) {\n   652→                consultarPlantillaEtapa(etapa.nombre).then(function(respuesta_plantilla) {\n   653→                    var plantilla = respuesta_plantilla.data;\n   654→\n   655→                    $('#modal-editar-plantilla-etapa #id').val(plantilla.id);\n   656→                    $('#modal-editar-plantilla-etapa #plantilla_correo_id').val(plantilla.plantilla_correo_id);\n   657→                    $('#modal-editar-plantilla-etapa #empresa_id').val(plantilla.empresa_id || (empresa && empresa.id) || '');\n   658→                    $('#modal-editar-plantilla-etapa #grupo_id').val(plantilla.grupo_id);\n   659→                    $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val(plantilla.titulo);\n   660→\n   661→                    if (plantilla.con_logo_empresa == 1) {\n   662→                        $('#modal-editar-plantilla-etapa #con_logo').prop('checked', true);\n   663→                    } else {\n   664→                        $('#modal-editar-plantilla-etapa #con_logo').prop('checked', false);\n   665→                    }\n   666→\n   667→                    if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n   668→                        if (plantilla.notificar_fin_proceso == 1) {\n   669→                            $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', true);\n   670→                        } else {\n   671→                            $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', false);\n   672→                        }\n   673→                    }\n   674→\n   675→                    setTimeout(function() {\n   676→                        if ($('#descripcion_mensaje_etapa').data('editor')) {\n   677→                            $('#descripcion_mensaje_etapa').data('editor').setData(plantilla.contenido || '');\n   678→                        }\n   679→                    }, 300);\n   680→                }).catch(function() {\n   681→                    mostrarToast('danger', 'Error al recargar la plantilla restaurada');\n   682→                });\n   683→            }\n   684→        },\n   685→        error: function(xhr) {\n   686→            var mensaje_error = 'Error al restablecer la plantilla';\n   687→            if (xhr.responseJSON && xhr.responseJSON.message) {\n   688→                mensaje_error = xhr.responseJSON.message;\n   689→            }\n   690→            mostrarToast('danger', mensaje_error);\n   691→        }\n   692→    });\n   693→}\n   694→\n   695→/**\n   696→ * Función para abrir la modal de movimiento de etapa\n   697→ *\n   698→ * @param {number} etapa_id ID de la etapa\n   699→ * @param {number} movimiento_id ID del movimiento\n   700→ * @returns {void}\n   701→ * @author José Manuel Jiménez\n   702→ * @author Andres Morales\n   703→ */\n   704→function abrirModalMovimientoEtapa(movimiento_id, etapa_movimiento_vacante_id, etapa_vacante_id) {\n   705→    modal_movimiento_id_seleccionado = movimiento_id;\n   706→    etapa_vacante_id_seleccionado = etapa_vacante_id;\n   707→    etapa_movimiento_vacante_id_seleccionado = etapa_movimiento_vacante_id;\n   708→    if (movimiento_id == 6) {\n   709→        cargarPruebasPsicometricasVacantes();\n   710→    } else {\n   711→        $(`#modal-movimiento-${movimiento_id}`).modal('show');\n   712→    }\n   713→}\n   714→\n   715→/**\n   716→ * Activa o desactiva la automatización de etapas de vacantes y envía el formulario.\n   717→ *\n   718→ * @param {HTMLElement} elemento Elemento del toggle.\n   719→ * @returns {void}\n   720→ * @author Andres Morales\n   721→ * @author Andres Gonzalez\n   722→ */\n   723→function automatizacionEtapas(elemento) {\n   724→    let valor = elemento ? 1 : 0;\n   725→    $('#automatizar_etapas').val(valor);\n   726→    $('#formulario-vacantes-paso-1').submit();\n   727→}\n   728→\n   729→/**\n   730→ * Maneja la selección de archivos para preguntas prefiltro\n   731→ *\n   732→ * @author José Manuel Jiménez\n   733→ */\n   734→$('#archivo_prueba').on('change', function (e) {\n   735→    let archivos_seleccionados = e.target.files;\n   736→    for (let i = 0; i < archivos_seleccionados.length; i++) {\n   737→        let archivo = archivos_seleccionados[i];\n   738→        let nombre_repetido = archivos_preguntas.some(item => item.archivo.name === archivo.name);\n   739→        if (!nombre_repetido) {\n   740→            archivos_preguntas.push({\n   741→                archivo: archivo,\n   742→                seleccionado: true,\n   743→                id: Date.now() + '_' + i\n   744→            });\n   745→        } else {\n   746→            mostrarToast('warning', `El archivo \"${archivo.name}\" ya fue seleccionado anteriormente.`);\n   747→        }\n   748→    }\n   749→    $(this).val('');\n   750→    renderizarArchivos();\n   751→});\n   752→\n   753→/**\n   754→ * Renderiza los archivos seleccionados en el contenedor\n   755→ *\n   756→ * @returns {void}\n   757→ * @author José Manuel Jiménez\n   758→ * @author Sergio Vargas\n   759→ */\n   760→function renderizarArchivos() {\n   761→    let contenedor = $('#contenedor-archivos-preguntas-prefiltro');\n   762→    contenedor.empty();\n   763→    if (archivos_preguntas.length + archivos_cargados.length === 0) {\n   764→        contenedor.html('<p class=\"text-muted\">No hay archivos seleccionados</p>');\n   765→        return;\n   766→    }\n   767→\n   768→    let documentos_nuevos = [];\n   769→    let imagenes_nuevas = [];\n   770→    let documentos_cargados = [];\n   771→    let imagenes_cargadas = [];\n   772→\n   773→    archivos_preguntas.forEach((item) => {\n   774→        if (!item.seleccionado) return;\n   775→        if (item.archivo.type.startsWith('image/')) {\n   776→            imagenes_nuevas.push(item);\n   777→        } else {\n   778→            documentos_nuevos.push(item);\n   779→        }\n   780→    });\n   781→\n   782→    archivos_cargados.forEach((archivo) => {\n   783→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n   784→        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n   785→        if (es_imagen) {\n   786→            imagenes_cargadas.push(archivo);\n   787→        } else {\n   788→            documentos_cargados.push(archivo);\n   789→        }\n   790→    });\n   791→\n   792→    // Renderizar en orden: documentos primero, imágenes después\n   793→    //Documentos nuevos\n   794→    documentos_nuevos.forEach((item) => {\n   795→        let archivo = item.archivo;\n   796→        let extension = archivo.name.split('.').pop().toLowerCase();\n   797→        let icono = obtenerIconoPorExtension(extension);\n   798→        let html = `\n   799→            <div class=\"col-auto archivo-item\">\n   800→                <div class=\"col-auto px-3 border rounded-2\">\n   801→                    <div class=\"row align-items-center\">\n   802→                        <div class=\"col-auto py-3\">\n   803→                            <i class=\"${icono} text-blue-40\"></i>\n   804→                        </div>\n   805→                        <div class=\"col px-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n   806→                            ${archivo.name}\n   807→                        </div>\n   808→                        <div class=\"col-auto\">\n   809→                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"quitarArchivo('${item.id}')\"></i>\n   810→                        </div>\n   811→                    </div>\n   812→                </div>\n   813→            </div>\n   814→        `;\n   815→        contenedor.append(html);\n   816→    });\n   817→\n   818→    //Documentos cargados\n   819→    documentos_cargados.forEach((archivo) => {\n   820→        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n   821→        let icono = obtenerIconoPorExtension(extension);\n   822→        let url_archivo = `/archivos-abrir/${archivo.id}`;\n   823→        let html = `\n   824→            <div class=\"col-auto archivo-item\">\n   825→                <div class=\"col-auto px-3 border rounded-2\">\n   826→                    <div class=\"row align-items-center\">\n   827→                        <div class=\"col-auto py-3\">\n   828→                            <i class=\"${icono} text-blue-40\"></i>\n   829→                        </div>\n   830→                        <div class=\"col px-0 py-3\">\n   831→                            <a href=\"${url_archivo}\"\n   832→                               target=\"_blank\"\n   833→                               class=\"text-blue-40 nowrap text-decoration-none\"\n   834→                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n   835→                                ${archivo.nombre_original_archivo}\n   836→                            </a>\n   837→                        </div>\n   838→                        <div class=\"col-auto\">\n   839→                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"eliminarArchivoServidor(${archivo.id})\"></i>\n   840→                        </div>\n   841→                    </div>\n   842→                </div>\n   843→            </div>\n   844→        `;\n   845→        contenedor.append(html);\n   846→    });\n   847→\n   848→    //Imágenes nuevas\n   849→    imagenes_nuevas.forEach((item) => {\n   850→        let archivo = item.archivo;\n   851→        let url_imagen = URL.createObjectURL(archivo);\n   852→        let html = `\n   853→            <div class=\"col-auto archivo-item\">\n   854→                <div class=\"col-auto px-3 border rounded-2\">\n   855→                    <div class=\"row align-items-center\">\n   856→                        <img class=\"col-12 border-bottom px-0 pointer\"\n   857→                             src=\"${url_imagen}\"\n   858→                             alt=\"${archivo.name}\"\n   859→                             style=\"object-fit:cover; border-radius:6px; cursor: pointer;\"\n   860→                             onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n   861→                    </div>\n   862→                    <div class=\"row align-items-center\">\n   863→                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n   864→                            ${archivo.name}\n   865→                        </div>\n   866→                        <div class=\"col-auto\">\n   867→                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"quitarArchivo('${item.id}')\"></i>\n   868→                        </div>\n   869→                    </div>\n   870→                </div>\n   871→            </div>\n   872→        `;\n   873→        contenedor.append(html);\n   874→    });\n   875→\n   876→    //Imágenes cargadas\n   877→    imagenes_cargadas.forEach((archivo) => {\n   878→        let url_imagen = `/archivos-abrir/${archivo.id}`;\n   879→        let html = `\n   880→            <div class=\"col-4 archivo-item\">\n   881→                <div class=\"col-auto px-3 border rounded-2\">\n   882→                    <div class=\"row align-items-center\">\n   883→                        <img class=\"col-12 border-bottom px-0 pointer\"\n   884→                             src=\"${url_imagen}\"\n   885→                             alt=\"${archivo.nombre_original_archivo}\"\n   886→                             style=\"object-fit:cover; border-radius:6px; cursor: pointer;\"\n   887→                             onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n   888→                    </div>\n   889→                    <div class=\"row align-items-center\">\n   890→                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n   891→                            ${archivo.nombre_original_archivo}\n   892→                        </div>\n   893→                        <div class=\"col-auto\">\n   894→                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"eliminarArchivoServidor(${archivo.id})\"></i>\n   895→                        </div>\n   896→                    </div>\n   897→                </div>\n   898→            </div>\n   899→        `;\n   900→        contenedor.append(html);\n   901→    });\n   902→\n   903→    inicializarTooltips();\n   904→}\n   905→\n   906→/**\n   907→ * Obtiene el ícono correspondiente a una extensión de archivo\n   908→ *\n   909→ * @param {string} extension Extensión del archivo\n   910→ * @returns {string} Clase del ícono correspondiente\n   911→ * @author José Manuel Jiménez\n   912→ */\n   913→function obtenerIconoPorExtension(extension) {\n   914→    switch (extension) {\n   915→        case 'pdf':\n   916→            return 'bi bi-filetype-pdf';\n   917→        case 'doc':\n   918→        case 'docx':\n   919→            return 'bi bi-filetype-docx';\n   920→        case 'xls':\n   921→        case 'xlsx':\n   922→            return 'bi bi-filetype-xlsx';\n   923→        default:\n   924→            return 'bi bi-file-earmark';\n   925→    }\n   926→}\n   927→\n   928→/**\n   929→ * Quita un archivo de la lista de archivos seleccionados\n   930→ *\n   931→ * @param {string} id ID del archivo a quitar\n   932→ * @returns {void}\n   933→ * @author José Manuel Jiménez\n   934→ */\n   935→function quitarArchivo(id) {\n   936→    archivos_preguntas = archivos_preguntas.filter(item => item.id !== id);\n   937→    renderizarArchivos();\n   938→}\n   939→\n   940→/**\n   941→ * Elimina un archivo del servidor y actualiza la lista de archivos cargados\n   942→ *\n   943→ * @param {number} archivo_id ID del archivo a eliminar\n   944→ * @returns {void}\n   945→ * @author José Manuel Jiménez\n   946→ */\n   947→function eliminarArchivoServidor(archivo_id) {\n   948→    $.ajax({\n   949→        url: `/archivos/${archivo_id}`,\n   950→        type: 'DELETE',\n   951→        headers: {\n   952→            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n   953→        },\n   954→        success: function(respuesta) {\n   955→            mostrarToast('success', respuesta.message);\n   956→            archivos_cargados = archivos_cargados.filter(item => item.id !== archivo_id);\n   957→            renderizarArchivos();\n   958→        }\n   959→    });\n   960→}\n   961→\n   962→/**\n   963→ * Adjunta los archivos seleccionados a la etapa de vacante\n   964→ *\n   965→ * @returns {void}\n   966→ * @author José Manuel Jiménez\n   967→ */\n   968→function adjuntarArchivos() {\n   969→    if (!etapa_vacante_id_seleccionado) {\n   970→        mostrarToast('warning', 'Debe ingresar un ID de etapa de vacante');\n   971→        return;\n   972→    }\n   973→    if (archivos_preguntas.length === 0) {\n   974→        return;\n   975→    }\n   976→    let datos_form = new FormData();\n   977→    let archivos_agregados = 0;\n   978→    datos_form.append('_token', $('input[name=\"_token\"]').val());\n   979→    datos_form.append('etapa_vacante_id', etapa_vacante_id_seleccionado);\n   980→    archivos_preguntas.forEach(item => {\n   981→        if (item.seleccionado) {\n   982→            datos_form.append('archivos[]', item.archivo);\n   983→            archivos_agregados++;\n   984→        }\n   985→    });\n   986→\n   987→    if (archivos_agregados === 0) {\n   988→        return;\n   989→    }\n   990→\n   991→    $.ajax({\n   992→        type       : 'POST',\n   993→        url        : '/etapas-vacantes-adjuntar-archivos',\n   994→        data       : datos_form,\n   995→        processData: false,\n   996→        contentType: false\n   997→    }).done((respuesta) => {\n   998→        mostrarToast('success', respuesta.message);\n   999→        $('#etapa_vacante_id_prueba').val('');\n  1000→        archivos_preguntas = [];\n  1001→        renderizarArchivos();\n  1002→    }).fail((error) => {\n  1003→        let mensaje = error.responseJSON?.message || 'Ocurrió un error al adjuntar los archivos';\n  1004→        mostrarToast('danger', mensaje);\n  1005→    });\n  1006→}\n  1007→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"85fd9741-5bf6-47a9-ba34-34c558243297","timestamp":"2026-01-13T21:03:45.637Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-paso-2.js","content":"/**\n * Archivo para manejar la lógica del Paso 2: Etapas de la vacante\n * @author Andres Morales\n * @author José Manuel Jiménez\n */\nconst CONFIGURACION_ETAPAS = {\n    'Revisión HV': {\n        titulo_modal_notificacion: 'Inicio proceso de selección',\n        titulo_notificacion: 'Notificación inicio proceso de selección',\n        titulo_etapa: 'Revisión hoja de vida',\n        plantilla_correo_id: 12\n    },\n    'Preguntas prefiltro': {\n        titulo_modal_notificacion: 'Preguntas pre-filtro',\n        titulo_notificacion: 'Notificacion envío de preguntas pre-filtro',\n        titulo_etapa: 'Preguntas prefiltro',\n        plantilla_correo_id: 13\n    },\n    'Pruebas psicométricas': {\n        titulo_modal_notificacion: 'Pruebas psicométricas',\n        titulo_notificacion: 'Notificación envío de pruebas psicométricas',\n        titulo_etapa: 'Pruebas psicométricas',\n        plantilla_correo_id: 15\n    },\n    'Prueba técnica': {\n        titulo_modal_notificacion: 'Prueba técnica',\n        titulo_notificacion: 'Notificación envío de prueba técnica',\n        titulo_etapa: 'Prueba técnica',\n        plantilla_correo_id: 18\n    },\n    'Video entrevista': {\n        titulo_modal_notificacion: 'Video entrevista',\n        titulo_notificacion: 'Notificación envío de video entrevista',\n        titulo_etapa: 'Solicitud video entrevista',\n        plantilla_correo_id: 21\n    },\n    'Entrevista': {\n        titulo_modal_notificacion: 'Entrevista',\n        titulo_notificacion: 'Notificacíon de entrevista',\n        titulo_etapa: 'Solicitud de entrevista',\n        plantilla_correo_id: 26\n    },\n    'Documentos para contratación': {\n        titulo_modal_notificacion: 'Documentos para contratación',\n        titulo_notificacion: 'Notificación envío de solicitud de documentos',\n        titulo_etapa: 'Solicitar documentos',\n        plantilla_correo_id: 23\n    },\n    'Contratados': {\n        titulo_modal_notificacion: 'Contratados',\n        titulo_notificacion: 'Notificación de resultado del proceso',\n        plantilla_correo_id: 27\n    },\n    'Descartados': {\n        titulo_modal_notificacion: 'Descartados',\n        titulo_notificacion: 'Notificación de resultado del proceso',\n        plantilla_correo_id: 28\n    }\n};\n\nlet etapa_movimiento_vacante_id_seleccionado = null;\nlet etapa_vacante_id_seleccionado = null;\nlet modal_movimiento_id_seleccionado = null;\nlet contador_preguntas = 0; // Contador general (mantener por compatibilidad)\nlet contador_preguntas_prefiltro = 0; // Contador específico para modal preguntas prefiltro\nlet contador_preguntas_video_entrevista = 0; // Contador específico para modal video entrevista\nlet contador_respuestas = 0;\nlet archivos_preguntas = [];\nlet toggle_etapa_activado = null;\nlet etapa_activada_desde_toggle = false;\nlet archivos_cargados = [];\n\n/**\n * Obtiene la configuración de títulos para una etapa\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @param {string} tipo_titulo Tipo de título a obtener: 'titulo_modal_notificacion', 'titulo_notificacion' o 'titulo_etapa'\n * @returns {string|null} Título configurado o null si no existe\n * @author Andres Morales\n */\nfunction obtenerTituloEtapa(nombre_etapa, tipo_titulo = 'titulo_modal_notificacion') {\n    var configuracion = CONFIGURACION_ETAPAS[nombre_etapa];\n    return configuracion && configuracion[tipo_titulo] ? configuracion[tipo_titulo] : null;\n}\n\n/**\n * Verifica si existe un título configurado para una etapa\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @param {string} tipo_titulo Tipo de título a verificar\n * @returns {boolean} True si existe el título, false si no\n * @author Andres Morales\n */\nfunction existeTituloEtapa(nombre_etapa, tipo_titulo) {\n    return obtenerTituloEtapa(nombre_etapa, tipo_titulo) !== null;\n}\n\n/**\n * Obtiene el ID de plantilla de correo para una etapa\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @returns {number|null} ID de la plantilla o null si no existe\n * @author Andres Morales\n */\nfunction obtenerPlantillaCorreoId(nombre_etapa) {\n    var configuracion = CONFIGURACION_ETAPAS[nombre_etapa];\n    return configuracion && configuracion.plantilla_correo_id ? configuracion.plantilla_correo_id : null;\n}\n\n/**\n * Consulta la plantilla de correo de una etapa específica\n *\n * @param {string} nombre_etapa Nombre de la etapa\n * @returns {Promise} Promesa con los datos de la plantilla\n * @author Andres Morales\n */\nfunction consultarPlantillaEtapa(nombre_etapa) {\n    var plantilla_correo_id = obtenerPlantillaCorreoId(nombre_etapa);\n\n    if (!plantilla_correo_id) {\n        console.error('No se encontró ID de plantilla para la etapa:', nombre_etapa);\n        return Promise.reject('No se encontró ID de plantilla');\n    }\n\n    return $.ajax({\n        url: '/plantilla-correo',\n        method: 'GET',\n        data: {\n            plantilla_correo_id: plantilla_correo_id,\n            empresa_id: empresa?.id\n        },\n        dataType: 'json'\n    });\n}\n\n/**\n * Función para consultar las etapas de una vacante\n *\n * @param {number} vacante_id ID de la vacante\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction consultarEtapasVacante(vacante_id) {\n    $.ajax({\n        url: `/etapas-vacantes`,\n        data: { vacante_id: vacante_id },\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            etapas_vacante = respuesta.data || [];\n            mostrarEtapasVacante();\n            calcularDiasDuracionProceso(vacante_id);\n        }\n    });\n}\n\n/**\n * Función para calcular y mostrar los días de duración del proceso\n *\n * @param {number} vacante_id ID de la vacante\n * @returns {void}\n * @author Andres Morales\n */\nfunction calcularDiasDuracionProceso(vacante_id) {\n    $.ajax({\n        url: `/vacantes-calcular-dias-duracion-proceso/${vacante_id}`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            var dias = respuesta.duracion_dias || 0;\n            $('#contador-dias-proceso').html(dias);\n        },\n        error: function() {\n            $('#contador-dias-proceso').html('0');\n        }\n    });\n}\n\n/**\n * Función para mostrar las etapas de una vacante en un acordeon.\n *\n * @param {Object} etapas Array con las etapas de la vacante.\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction mostrarEtapasVacante() {\n    let etapas = etapas_vacante;\n    $('#contenedor-vacantes-etapas').empty().append(crearAcordeon({\n        id: 'acordeon',\n        acordeon: etapas.map((etapa, index) => ({\n            id: `etapa-${index}`,\n            titulo: `\n                <div class=\"col\">\n                    <div class=\"row\">\n                        <div class=\"col ps-1 text-gray-10 text-body-1\">${etapa.nombre}</div>\n                        <div class=\"col-auto pe-7\">\n                            ${etapa.editable == 1 ? crearToggle({\n                                id: `activar_etapa_${index}`,\n                                name: `activar_etapa_${index}`,\n                                class: 'checkbox-etapa-vacante',\n                                value: etapa.id,\n                                checked: etapa.activa == 1 ? true : false,\n                                onchange: `activarDesactivarEtapa(this)`,\n                            }) : ''}\n                        </div>\n                    </div>\n                </div>\n            `,\n            contenido: `\n                <div class=\"row\">\n                    ${etapa.etapas_movimientos.map(etapa_movimiento => `\n                        <div class=\"col-12 d-flex justify-content-between align-items-center\">\n                            <div class=\"text-body-2 text-gray-30\">\n                                ${etapa_movimiento.movimiento.nombre}\n                            </div>\n                            <div>\n                                ${crearBoton({\n                                    clases: 'btn-text-primary btn-circle',\n                                    texto: '<i class=\"bi bi-gear\"></i>',\n                                    onclick: `${etapa_movimiento.movimiento.es_notificacion == 1 ?\n                                        `abrirModalNotificacionEtapa(${etapa.id})` : `abrirModalMovimientoEtapa(${etapa_movimiento.movimiento.id}, ${etapa_movimiento.id}, ${etapa_movimiento.etapa_vacante_id})`\n                                    }`\n                                })}\n                            </div>\n                        </div>\n                    `).join('')}\n                </div>\n            `,\n            disabled: etapa.activa == 0 ? true : false,\n            ordenar: etapa.fija == 0 ? true : false,\n            adicional: `data-orden=\"${etapa.orden}\" data-etapa_vacante_id=\"${etapa.id}\" data-fija=\"${etapa.fija}\"`,\n        }))\n    }));\n    $(\"#acordeon\").sortable({\n        items: \".accordion-item\",\n        handle: \".drag-handle\",\n        cursor: \"grabbing\",\n        placeholder: \"ui-sortable-placeholder\",\n        tolerance: \"pointer\",\n        update: function(evento, elemento) {\n            let elemento_actual = elemento.item;\n            let orden_actual = $(elemento_actual).data('orden');\n            let elemento_anterior = elemento_actual.prev();\n            let orden_anterior = $(elemento_anterior).data('orden');\n            let es_fijo_anterior = $(elemento_anterior).data('fija');\n            if (es_fijo_anterior == 1) {\n                return false;\n            }\n            if (orden_anterior == undefined) {\n                orden_anterior = '0';\n            }\n            if ((parseInt(orden_actual) - 1) != orden_anterior) {\n                if (parseInt(orden_actual) > parseInt(orden_anterior)) {\n                    orden_anterior = parseInt(orden_anterior) + 1;\n                }\n                let etapa_vacante_id = $(elemento_actual).data('etapa_vacante_id');\n                $.ajax({\n                    url : `/etapas-vacantes-cambiar-orden`,\n                    type: 'POST',\n                    data: {\n                        _token : $('meta[name=\"csrf-token\"]').attr('content'),\n                        _method: 'PUT',\n                        id: etapa_vacante_id,\n                        orden: orden_anterior\n                    },\n                    success: function (respuesta) {\n                        mostrarToast('success', respuesta.message);\n                        $(elemento_actual).data('orden', orden_anterior);\n                        $(elemento_anterior).data('orden', orden_actual);\n                    },\n                    error: function (error) {\n                        mostrarToast('danger', 'Ocurrió un error al organizar');\n                    }\n                });\n            }\n        }\n    });\n}\n\n/**\n * Función para activar o desactivar un acordeon de una etapa de la vacante.\n *\n * @param {HTMLInputElement} checkbox Checkbox que activa o desactiva la etapa\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction activarDesactivarEtapa(checkbox) {\n    setTimeout(() => {\n        if (checkbox.checked) {\n            $(checkbox).closest('.accordion-item').find('.accordion-button').removeClass('collapsed').attr('aria-disabled', 'false').attr('disabled', false);\n            $(checkbox).closest('.accordion-item').find('.accordion-collapse').addClass('show').attr('aria-expanded', 'true');\n\n            toggle_etapa_activado = checkbox;\n            etapa_activada_desde_toggle = true;\n\n            var etapa_vacante_id = $(checkbox).closest('.accordion-item').data('etapa_vacante_id');\n\n            var etapa_encontrada = etapas_vacante.find(function(etapa) {\n                return etapa.id === etapa_vacante_id;\n            });\n\n            if (etapa_encontrada && etapa_encontrada.etapas_movimientos) {\n                var primer_movimiento_config = etapa_encontrada.etapas_movimientos.find(function(etapa_movimiento) {\n                    return etapa_movimiento.movimiento && etapa_movimiento.movimiento.es_notificacion !== 1;\n                });\n\n                if (primer_movimiento_config && primer_movimiento_config.movimiento) {\n                    abrirModalMovimientoEtapa(\n                        primer_movimiento_config.movimiento.id,\n                        primer_movimiento_config.id,\n                        primer_movimiento_config.etapa_vacante_id\n                    );\n                }\n            }\n        } else {\n            $(checkbox).closest('.accordion-item').find('.accordion-button').addClass('collapsed').attr('aria-disabled', 'true').attr('disabled', true);\n            $(checkbox).closest('.accordion-item').find('.accordion-collapse').removeClass('show').attr('aria-expanded', 'false');\n        }\n        $.ajax({\n            url: `/etapas-vacantes/${checkbox.value}`,\n            data: {\n                activa: checkbox.checked ? 1 : 0,\n                _token: $('meta[name=\"csrf-token\"]').attr('content')\n            },\n            method: 'PUT',\n            dataType: 'json',\n            success: function(respuesta) {\n                var vacante_id = $('#id').val();\n                if (vacante_id) {\n                    calcularDiasDuracionProceso(vacante_id);\n                }\n            }\n        });\n    }, 500);\n}\n\n/**\n * Función para filtrar las etapas de la vacante en el acordeon.\n *\n * @param {string} mostrar_etapas Valor del filtro: '1' para mostrar solo las etapas activas, '0' para mostrar solo las etapas inactivas, cualquier otro valor para mostrar todas las etapas.\n * @author José Manuel Jiménez\n */\nfunction filtrarEtapasVacante(mostrar_etapas) {\n    $('#acordeon .accordion-item').removeClass('d-none');\n    if (mostrar_etapas == '1') {\n        $('#acordeon .accordion-item').each(function() {\n            if ($(this).find('.checkbox-etapa-vacante').length > 0 && !$(this).find('.checkbox-etapa-vacante').is(':checked')) {\n                $(this).addClass('d-none');\n            }\n        });\n    } else if (mostrar_etapas == '0') {\n        $('#acordeon .accordion-item').each(function() {\n            if ($(this).find('.checkbox-etapa-vacante').length == 0 || $(this).find('.checkbox-etapa-vacante').is(':checked')) {\n                $(this).addClass('d-none');\n            }\n        });\n    }\n}\n\n/**\n * Función para abrir la modal de edición de plantilla de etapa\n *\n * @param {number} etapa_id ID de la etapa\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction abrirModalNotificacionEtapa(etapa_id) {\n    $('#modal-editar-plantilla-etapa #etapa_id').val(etapa_id);\n\n    let etapa = etapas_vacante.find(e => e.id === etapa_id);\n\n    if (etapa) {\n        $('#titulo-plantilla-modal').text(etapa.nombre);\n\n        if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n            $('#contenedor_check_enviar_al_finalizar').html(`\n                ${crearCheckbox({\n                    id: 'enviar_finalizar',\n                    class: 'input-dinamico',\n                    label: 'Enviar comunicación únicamente cuando finalice el proceso',\n                })}\n            `);\n        } else {\n            $('#contenedor_check_enviar_al_finalizar').html(`\n                ${crearCheckbox({\n                    id: 'enviar_finalizar',\n                    class: 'input-dinamico',\n                    input_container_class: 'd-none',\n                    checked: false,\n                    label: 'Enviar comunicación únicamente cuando finalice el proceso',\n                })}\n            `);\n        }\n\n        consultarPlantillaEtapa(etapa.nombre).then(function(respuesta) {\n            var plantilla = respuesta.data;\n\n            $('#modal-editar-plantilla-etapa #id').val(plantilla.id);\n            $('#modal-editar-plantilla-etapa #plantilla_correo_id').val(plantilla.plantilla_correo_id || plantilla.id);\n            $('#modal-editar-plantilla-etapa #empresa_id').val(plantilla.empresa_id || (empresa && empresa.id) || '');\n            $('#modal-editar-plantilla-etapa #grupo_id').val(plantilla.grupo_id);\n            $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val(plantilla.titulo);\n\n            if (plantilla.con_logo_empresa == 1) {\n                $('#modal-editar-plantilla-etapa #con_logo').prop('checked', true);\n            } else {\n                $('#modal-editar-plantilla-etapa #con_logo').prop('checked', false);\n            }\n\n            if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n                if (plantilla.notificar_fin_proceso == 1) {\n                    $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', true);\n                } else {\n                    $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', false);\n                }\n            }\n\n            $('#contenedor_editor_texto').html(`\n                ${crearEditorTexto({\n                    adicional: `data-botonadicional=\"botonAdicionalCkeditorEtapa\"`,\n                    id: 'descripcion_mensaje_etapa',\n                    name: 'descripcion_mensaje_etapa',\n                    class: 'classic-editor-opciones',\n                    input_container_class: 'mb-4',\n                    maxlength: 16350,\n                    required: true\n                })}\n            `);\n\n            inicializarClassicEditor();\n\n            setTimeout(function() {\n                if ($('#descripcion_mensaje_etapa').data('editor')) {\n                    $('#descripcion_mensaje_etapa').data('editor').setData(plantilla.contenido || '');\n                }\n            }, 500);\n        }).catch(function(error) {\n            if (typeof empresa !== 'undefined' && empresa && empresa.id) {\n                $('#modal-editar-plantilla-etapa #empresa_id').val(empresa.id);\n            }\n\n            $('#contenedor_editor_texto').html(`\n                ${crearEditorTexto({\n                    adicional: `data-botonadicional=\"botonAdicionalCkeditorEtapa\"`,\n                    id: 'descripcion_mensaje_etapa',\n                    name: 'descripcion_mensaje_etapa',\n                    class: 'classic-editor-opciones',\n                    input_container_class: 'mb-4',\n                    maxlength: 16350,\n                    required: true\n                })}\n            `);\n\n            inicializarClassicEditor();\n        });\n    }\n\n    $('#modal-editar-plantilla-etapa').modal('show');\n}\n\n/**\n * Crear boton adicional para ckeditor con variables de etapa\n *\n * @param {string} id ID del editor\n * @returns {html} botón adicional para ckeditor\n * @author Andres Morales\n */\nfunction botonAdicionalCkeditorEtapa(id) {\n    var variables_etapa = [\n        { llave: 'nombre_informador', valor: 'Nombre de usuario (Yo)' },\n        { llave: 'nombre_empresa', valor: 'Nombre de la empresa' },\n        { llave: 'nombre_vacante', valor: 'Nombre de la vacante' },\n        { llave: 'nombre_candidato', valor: 'Nombre del candidato' }\n    ];\n\n    var opciones_variables = variables_etapa\n        .map(variable => `<button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableEtapa('${id}', '__${variable.llave}__')\">${variable.valor}</button>`)\n        .join('');\n\n    return `\n        <div class=\"border-start border-black border-2 px-2 my-0 dropdown\">\n            ${crearBoton({\n                clases: 'dropdown-toggle text-body-3 btn-dropdown-ckeditor',\n                texto: 'Agregar variable<i class=\"bi bi-chevron-down text-body-3 ms-2\"></i>',\n                data: [{texto: 'bs-toggle', value: 'dropdown'},{texto: 'bs-auto-close', value: 'outside'}]\n            })}\n            <div class=\"dropdown-menu bg-white\">${opciones_variables}</div>\n        </div>\n    `;\n}\n\n/**\n * Agrega la variable en el ckeditor de etapa\n *\n * @param {string} id ID del editor\n * @param {string} variable Variable a agregar\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction agregarVariableEtapa(id, variable) {\n    let editor = $(`#${id}`).data('editor');\n    let fragmento_vista = editor.data.processor.toView(variable);\n    let fragmento_modelo = editor.data.toModel(fragmento_vista);\n    editor.model.insertContent(fragmento_modelo);\n}\n\n/**\n * Inicializar configuración del formulario de plantilla de etapa\n *\n * @returns {void}\n * @author Andres Morales\n */\n$(document).ready(function() {\n    configurarFormulario('form-editar-plantilla-etapa');\n\n    $(document).on('click', '#restablecer_texto', function () {\n        confirmarRestablecerTexto();\n    });\n\n    $(document).on('click', '#btn-cancelar-plantilla-etapa', function () {\n        confirmarCancelarPlantillaEtapa();\n    });\n\n    $(\".formulario-movimiento\").each(function() {\n        let $formulario_movimiento = $(this);\n        $formulario_movimiento.on(\"change keyup blur\", \"input, select, textarea\", function() {\n            let formulario_movimiento_valido = $formulario_movimiento.validate().checkForm();\n            if (formulario_movimiento_valido) {\n                $formulario_movimiento.closest('.modal-content').find('button[type=\"submit\"]').prop('disabled', false);\n            } else {\n                $formulario_movimiento.closest('.modal-content').find('button[type=\"submit\"]').prop('disabled', true);\n            }\n        });\n    });\n});\n\n/**\n * Confirmar antes de cancelar la edición de la plantilla\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction confirmarCancelarPlantillaEtapa() {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas cancelar?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Los cambios que hayas realizado en la plantilla no se guardarán. Esta acción no se puede deshacer.</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Aceptar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((result) => {\n        if (result.isConfirmed) {\n            $('#modal-editar-plantilla-etapa').modal('hide');\n            limpiarFormulario('form-editar-plantilla-etapa');\n        }\n    });\n}\n\n/**\n * Confirmar antes de restablecer el texto de la plantilla\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction confirmarRestablecerTexto() {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas restablecer?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Se restablecerá el texto de la plantilla a su versión por defecto. Los cambios personalizados que hayas hecho se perderán. Esta acción no se puede deshacer.</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-danger w-100 justify-content-center',\n                        texto: 'Restablecer',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((result) => {\n        if (result.isConfirmed) {\n            restablecerPlantillaEtapa();\n        }\n    });\n}\n\n/**\n * Restablecer la plantilla de etapa a su versión por defecto\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction restablecerPlantillaEtapa() {\n    var plantilla_id = $('#modal-editar-plantilla-etapa #id').val();\n    var etapa_id = $('#modal-editar-plantilla-etapa #etapa_id').val();\n\n    if (!plantilla_id) {\n        mostrarToast('danger', 'No se ha seleccionado una plantilla para restablecer');\n        return;\n    }\n\n    if (!etapa_id) {\n        mostrarToast('danger', 'No se ha identificado la etapa');\n        return;\n    }\n\n    $.ajax({\n        url: `/plantillas-correos-restablecer/${plantilla_id}`,\n        type: 'PUT',\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message);\n\n            let etapa = etapas_vacante.find(e => e.id === parseInt(etapa_id));\n\n            if (etapa) {\n                consultarPlantillaEtapa(etapa.nombre).then(function(respuesta_plantilla) {\n                    var plantilla = respuesta_plantilla.data;\n\n                    $('#modal-editar-plantilla-etapa #id').val(plantilla.id);\n                    $('#modal-editar-plantilla-etapa #plantilla_correo_id').val(plantilla.plantilla_correo_id);\n                    $('#modal-editar-plantilla-etapa #empresa_id').val(plantilla.empresa_id || (empresa && empresa.id) || '');\n                    $('#modal-editar-plantilla-etapa #grupo_id').val(plantilla.grupo_id);\n                    $('#modal-editar-plantilla-etapa #titulo_mensaje_plantilla').val(plantilla.titulo);\n\n                    if (plantilla.con_logo_empresa == 1) {\n                        $('#modal-editar-plantilla-etapa #con_logo').prop('checked', true);\n                    } else {\n                        $('#modal-editar-plantilla-etapa #con_logo').prop('checked', false);\n                    }\n\n                    if (etapa.nombre === 'Contratados' || etapa.nombre === 'Descartados') {\n                        if (plantilla.notificar_fin_proceso == 1) {\n                            $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', true);\n                        } else {\n                            $('#modal-editar-plantilla-etapa #enviar_finalizar').prop('checked', false);\n                        }\n                    }\n\n                    setTimeout(function() {\n                        if ($('#descripcion_mensaje_etapa').data('editor')) {\n                            $('#descripcion_mensaje_etapa').data('editor').setData(plantilla.contenido || '');\n                        }\n                    }, 300);\n                }).catch(function() {\n                    mostrarToast('danger', 'Error al recargar la plantilla restaurada');\n                });\n            }\n        },\n        error: function(xhr) {\n            var mensaje_error = 'Error al restablecer la plantilla';\n            if (xhr.responseJSON && xhr.responseJSON.message) {\n                mensaje_error = xhr.responseJSON.message;\n            }\n            mostrarToast('danger', mensaje_error);\n        }\n    });\n}\n\n/**\n * Función para abrir la modal de movimiento de etapa\n *\n * @param {number} etapa_id ID de la etapa\n * @param {number} movimiento_id ID del movimiento\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction abrirModalMovimientoEtapa(movimiento_id, etapa_movimiento_vacante_id, etapa_vacante_id) {\n    modal_movimiento_id_seleccionado = movimiento_id;\n    etapa_vacante_id_seleccionado = etapa_vacante_id;\n    etapa_movimiento_vacante_id_seleccionado = etapa_movimiento_vacante_id;\n    if (movimiento_id == 6) {\n        cargarPruebasPsicometricasVacantes();\n    } else {\n        $(`#modal-movimiento-${movimiento_id}`).modal('show');\n    }\n}\n\n/**\n * Activa o desactiva la automatización de etapas de vacantes y envía el formulario.\n *\n * @param {HTMLElement} elemento Elemento del toggle.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction automatizacionEtapas(elemento) {\n    let valor = elemento ? 1 : 0;\n    $('#automatizar_etapas').val(valor);\n    $('#formulario-vacantes-paso-1').submit();\n}\n\n/**\n * Maneja la selección de archivos para preguntas prefiltro\n *\n * @author José Manuel Jiménez\n */\n$('#archivo_prueba').on('change', function (e) {\n    let archivos_seleccionados = e.target.files;\n    for (let i = 0; i < archivos_seleccionados.length; i++) {\n        let archivo = archivos_seleccionados[i];\n        let nombre_repetido = archivos_preguntas.some(item => item.archivo.name === archivo.name);\n        if (!nombre_repetido) {\n            archivos_preguntas.push({\n                archivo: archivo,\n                seleccionado: true,\n                id: Date.now() + '_' + i\n            });\n        } else {\n            mostrarToast('warning', `El archivo \"${archivo.name}\" ya fue seleccionado anteriormente.`);\n        }\n    }\n    $(this).val('');\n    renderizarArchivos();\n});\n\n/**\n * Renderiza los archivos seleccionados en el contenedor\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Sergio Vargas\n */\nfunction renderizarArchivos() {\n    let contenedor = $('#contenedor-archivos-preguntas-prefiltro');\n    contenedor.empty();\n    if (archivos_preguntas.length + archivos_cargados.length === 0) {\n        contenedor.html('<p class=\"text-muted\">No hay archivos seleccionados</p>');\n        return;\n    }\n\n    let documentos_nuevos = [];\n    let imagenes_nuevas = [];\n    let documentos_cargados = [];\n    let imagenes_cargadas = [];\n\n    archivos_preguntas.forEach((item) => {\n        if (!item.seleccionado) return;\n        if (item.archivo.type.startsWith('image/')) {\n            imagenes_nuevas.push(item);\n        } else {\n            documentos_nuevos.push(item);\n        }\n    });\n\n    archivos_cargados.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_cargados.push(archivo);\n        }\n    });\n\n    // Renderizar en orden: documentos primero, imágenes después\n    //Documentos nuevos\n    documentos_nuevos.forEach((item) => {\n        let archivo = item.archivo;\n        let extension = archivo.name.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"quitarArchivo('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    //Documentos cargados\n    documentos_cargados.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"eliminarArchivoServidor(${archivo.id})\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    //Imágenes nuevas\n    imagenes_nuevas.forEach((item) => {\n        let archivo = item.archivo;\n        let url_imagen = URL.createObjectURL(archivo);\n        let html = `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer\"\n                             src=\"${url_imagen}\"\n                             alt=\"${archivo.name}\"\n                             style=\"object-fit:cover; border-radius:6px; cursor: pointer;\"\n                             onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.name, toggle: 'popover'})}>\n                            ${archivo.name}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"quitarArchivo('${item.id}')\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    //Imágenes cargadas\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        let html = `\n            <div class=\"col-4 archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer\"\n                             src=\"${url_imagen}\"\n                             alt=\"${archivo.nombre_original_archivo}\"\n                             style=\"object-fit:cover; border-radius:6px; cursor: pointer;\"\n                             onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <div class=\"col-auto\">\n                            <i class=\"bi bi-trash text-danger pointer\" onclick=\"eliminarArchivoServidor(${archivo.id})\"></i>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        contenedor.append(html);\n    });\n\n    inicializarTooltips();\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Quita un archivo de la lista de archivos seleccionados\n *\n * @param {string} id ID del archivo a quitar\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction quitarArchivo(id) {\n    archivos_preguntas = archivos_preguntas.filter(item => item.id !== id);\n    renderizarArchivos();\n}\n\n/**\n * Elimina un archivo del servidor y actualiza la lista de archivos cargados\n *\n * @param {number} archivo_id ID del archivo a eliminar\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction eliminarArchivoServidor(archivo_id) {\n    $.ajax({\n        url: `/archivos/${archivo_id}`,\n        type: 'DELETE',\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', respuesta.message);\n            archivos_cargados = archivos_cargados.filter(item => item.id !== archivo_id);\n            renderizarArchivos();\n        }\n    });\n}\n\n/**\n * Adjunta los archivos seleccionados a la etapa de vacante\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction adjuntarArchivos() {\n    if (!etapa_vacante_id_seleccionado) {\n        mostrarToast('warning', 'Debe ingresar un ID de etapa de vacante');\n        return;\n    }\n    if (archivos_preguntas.length === 0) {\n        return;\n    }\n    let datos_form = new FormData();\n    let archivos_agregados = 0;\n    datos_form.append('_token', $('input[name=\"_token\"]').val());\n    datos_form.append('etapa_vacante_id', etapa_vacante_id_seleccionado);\n    archivos_preguntas.forEach(item => {\n        if (item.seleccionado) {\n            datos_form.append('archivos[]', item.archivo);\n            archivos_agregados++;\n        }\n    });\n\n    if (archivos_agregados === 0) {\n        return;\n    }\n\n    $.ajax({\n        type       : 'POST',\n        url        : '/etapas-vacantes-adjuntar-archivos',\n        data       : datos_form,\n        processData: false,\n        contentType: false\n    }).done((respuesta) => {\n        mostrarToast('success', respuesta.message);\n        $('#etapa_vacante_id_prueba').val('');\n        archivos_preguntas = [];\n        renderizarArchivos();\n    }).fail((error) => {\n        let mensaje = error.responseJSON?.message || 'Ocurrió un error al adjuntar los archivos';\n        mostrarToast('danger', mensaje);\n    });\n}\n","numLines":1007,"startLine":1,"totalLines":1007}},"sourceToolAssistantUUID":"8e4dde1f-2697-445b-9197-c83919355427"}
{"parentUuid":"c4955ec0-3880-47fe-8fdf-35cf24987ed9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QEn6zkPE2HD41hqHmPdrTx","type":"tool_result","content":"     1→$(document).ready(function() {\n     2→    let formularios_movimientos =$('.formulario-movimiento');\n     3→    $.each(formularios_movimientos, function(index, formulario) {\n     4→        configurarFormulario($(formulario).attr('id'));\n     5→    });\n     6→\n     7→    $('.modal[id^=\"modal-movimiento-\"]').on('hidden.bs.modal', function() {\n     8→        if (etapa_activada_desde_toggle && toggle_etapa_activado) {\n     9→            toggle_etapa_activado = null;\n    10→            etapa_activada_desde_toggle = false;\n    11→        }\n    12→    });\n    13→});\n    14→\n    15→/**\n    16→ * Validar formulario de movimientos de una vacante.\n    17→ *\n    18→ * @param {string} formulario ID del formulario a validar.\n    19→ * @returns {boolean} Resultado de la validación.\n    20→ * @author José Manuel Jiménez\n    21→ * @author Andres Morales\n    22→ */\n    23→function validacionFormularioMovimientoVacante(formulario) {\n    24→    let configuraciones = [];\n    25→    let formulario_valido = true;\n    26→    if (modal_movimiento_id_seleccionado === 6) {\n    27→        if (!validarPruebasPsicometricas()) {\n    28→            return false;\n    29→        }\n    30→        configuraciones = recopilarDatosPruebasPsicometricas();\n    31→    }\n    32→\n    33→    if (modal_movimiento_id_seleccionado === 14) {\n    34→        let documentos_checkeados = $('.checkbox-documento:checked').length;\n    35→        if (documentos_checkeados === 0) {\n    36→            mostrarToast('warning', 'Al configurar esta etapa, las casillas aparecerán desactivadas.');\n    37→            return false;\n    38→        }\n    39→        let datos_documentos = recopilarDocumentosSeleccionados();\n    40→        $(`#form-movimiento-14 #configuraciones`).val(JSON.stringify(datos_documentos));\n    41→        return true;\n    42→    }\n    43→\n    44→    if (formulario == 'form-movimiento-4' || formulario == 'form-movimiento-10') {\n    45→        let preguntas = [];\n    46→        let preguntas_agregadas = $(`#contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`).find('.pregunta');\n    47→        let cantidad_preguntas_descartar = $(`#form-movimiento-${modal_movimiento_id_seleccionado} .numero-preguntas`).val();\n    48→        if (preguntas_agregadas.length === 0) {\n    49→            mostrarToast('warning', 'Agrega al menos una pregunta a la entrevista.');\n    50→            formulario_valido = false;\n    51→        } else if (cantidad_preguntas_descartar > preguntas_agregadas.length) {\n    52→            mostrarToast('warning', 'La cantidad de preguntas para descartar candidatos debe ser menor o igual a la cantidad de preguntas agregadas.');\n    53→            formulario_valido = false;\n    54→        }\n    55→        preguntas_agregadas.each(function() {\n    56→            let $pregunta = $(this);\n    57→            let es_abierta = $pregunta.find('.tipo-pregunta').val() == 'abierta' ? true : false;\n    58→            let opciones = null;\n    59→            if (!es_abierta) {\n    60→                $pregunta.find('.error-opciones').addClass('d-none');\n    61→                $pregunta.find('.error-respuesta-correcta').addClass('d-none');\n    62→                $pregunta.removeData('mostrar-error-opciones');\n    63→                $pregunta.removeData('mostrar-error-respuesta');\n    64→                opciones = [];\n    65→                let i = 1;\n    66→                let respuestas = $pregunta.find('.respuesta');\n    67→                let existe_correcta = false;\n    68→                respuestas.each(function() {\n    69→                    if ($(this).find('.form-check-input').prop('checked')) {\n    70→                        existe_correcta = true;\n    71→                    }\n    72→                    let opcion = {\n    73→                        id: $(this).data('id') ? $(this).data('id') : null,\n    74→                        texto: $(this).find('.input-respuesta').val(),\n    75→                        orden: i,\n    76→                        es_correcta: $(this).find('.form-check-input').prop('checked') ? true : false\n    77→                    };\n    78→                    opciones.push(opcion);\n    79→                    i++;\n    80→                });\n    81→                if (respuestas.length < 2) {\n    82→                    if (formulario_valido) {\n    83→                        mostrarToast('warning', 'Agrega al menos dos opciones de respuesta en preguntas de selección múltiple y única.');\n    84→                    }\n    85→                    formulario_valido = false;\n    86→                    $pregunta.find('.error-opciones').removeClass('d-none');\n    87→                    $pregunta.data('mostrar-error-opciones', true);\n    88→                }\n    89→                if (!existe_correcta) {\n    90→                    if (formulario_valido) {\n    91→                        mostrarToast('warning', 'Selecciona al menos una respuesta correcta por cada pregunta de selección múltiple y única.');\n    92→                    }\n    93→                    formulario_valido = false;\n    94→                    $pregunta.find('.error-respuesta-correcta').removeClass('d-none');\n    95→                    $pregunta.data('mostrar-error-respuesta', true);\n    96→                }\n    97→            }\n    98→            let pregunta = {\n    99→                id: $pregunta.data('id') ? $pregunta.data('id') : null,\n   100→                enunciado: $pregunta.find('.enunciado').val(),\n   101→                es_abierta: es_abierta,\n   102→                tiempo_respuesta: $pregunta.find('.tiempo-respuesta').val() ? parseInt($pregunta.find('.tiempo-respuesta').val()) * 60 : null,\n   103→                puntaje: $pregunta.find('.puntuacion').val() ? parseInt($pregunta.find('.puntuacion').val()) : 0,\n   104→            };\n   105→            if (!es_abierta) pregunta.opciones = opciones;\n   106→            preguntas.push(pregunta);\n   107→        });\n   108→        if ($(`#${formulario}`).find('input.error , select.error , textarea.error').length > 0) {\n   109→            formulario_valido = false;\n   110→        }\n   111→        if (formulario_valido) {\n   112→            $.ajax({\n   113→                url: '/vacantes-preguntas',\n   114→                method: 'POST',\n   115→                data: {\n   116→                    _token : $('meta[name=\"csrf-token\"]').attr('content'),\n   117→                    vacante_id: $('#formulario-vacantes-paso-2 #id').val(),\n   118→                    etapa_vacante_id: etapa_vacante_id_seleccionado,\n   119→                    preguntas : JSON.stringify(preguntas)\n   120→                },\n   121→                error: function(xhr, status, error) {\n   122→                    console.error('Ocurrió un error:', error);\n   123→                }\n   124→            });\n   125→        }\n   126→    }\n   127→    if (formulario_valido) {\n   128→        let campos_movimientos = $(`.campos-form-movimiento-${modal_movimiento_id_seleccionado}`);\n   129→        $.each(campos_movimientos, function(index, campo) {\n   130→            let $campo = $(campo);\n   131→            let tipo_campo = $campo.attr('type');\n   132→            let valor = null;\n   133→            if (tipo_campo == 'checkbox' || tipo_campo == 'radio') {\n   134→                valor = $campo.prop('checked') ? \"1\" : \"0\";\n   135→            } else {\n   136→                valor = $campo.val();\n   137→            }\n   138→            configuraciones.push({\n   139→                etapa_movimiento_vacante_id: etapa_movimiento_vacante_id_seleccionado,\n   140→                movimiento_vacante_configuracion_id: parseInt($campo.data('movimiento_vacante_configuracion_id')),\n   141→                valor: valor\n   142→            });\n   143→        });\n   144→        if (modal_movimiento_id_seleccionado === 6) {\n   145→            const tipoCaducidadSeleccionado = $('input[name=\"tipo_caducidad\"]:checked').val();\n   146→            if (tipoCaducidadSeleccionado === 'dias' || tipoCaducidadSeleccionado === 'fecha') {\n   147→                configuraciones = configuraciones.filter(configuracion => {\n   148→                    if (configuracion.movimiento_vacante_configuracion_id === 16) {\n   149→                        return tipoCaducidadSeleccionado === 'dias';\n   150→                    }\n   151→                    if (configuracion.movimiento_vacante_configuracion_id === 17) {\n   152→                        return tipoCaducidadSeleccionado === 'fecha';\n   153→                    }\n   154→                    return true;\n   155→                });\n   156→            }\n   157→        }\n   158→        $(`#form-movimiento-${modal_movimiento_id_seleccionado} #configuraciones`).val(JSON.stringify(configuraciones));\n   159→    }\n   160→    return formulario_valido;\n   161→}\n   162→\n   163→/**\n   164→ * Función para mostrar las configuraciones guardadas de la etapa de movimiento.\n   165→ * \n   166→ * @returns {void}\n   167→ * @author José Manuel Jiménez\n   168→ * @author Jair Carvajal\n   169→ */\n   170→function mostrarConfiguracionesEtapaMovimientos() {\n   171→    if (!etapa_movimiento_vacante_id_seleccionado) {\n   172→        return;\n   173→    }\n   174→    $.ajax({\n   175→        url: `/configuraciones-etapa-movimiento/${etapa_movimiento_vacante_id_seleccionado}`,\n   176→        type: 'GET',\n   177→        success: function(respuesta) {\n   178→            let configuraciones = respuesta.data;\n   179→            $.each(configuraciones, function(index, configuracion) {\n   180→                if (configuracion.prueba_id) {\n   181→                    let prueba = pruebas_empresa_vacantes.find(p => p.id == configuracion.prueba_id);\n   182→                    if (prueba) {\n   183→                        slug = prueba.slug;\n   184→                        let llave = slug.replace(/-/g, '_');\n   185→                        let checkbox = $(`#prueba_${llave}`);\n   186→                        if (checkbox.length) {\n   187→                            checkbox.prop('checked', true);\n   188→                            seleccionarPruebaVacante(checkbox[0]);\n   189→        \n   190→                            setTimeout(function() {\n   191→                                if (configuracion.perfil_id) {\n   192→                                    $(`#perfil_id_${llave}`).val(configuracion.perfil_id).trigger('change');\n   193→                                }\n   194→        \n   195→                                if (configuracion.valor) {\n   196→                                    $(`#porcentaje_${llave}`).val(configuracion.valor);\n   197→                                    actualizarPorcentajeTotalVacantes();\n   198→                                }\n   199→                            }, 500 + (index * 100));\n   200→                        }\n   201→                    }\n   202→                } else {\n   203→                    let elemento = $(`#movimiento_vacante_configuracion_id_${configuracion.movimiento_vacante_configuracion_id}`);\n   204→                    let activar_elemento = $(`#activar_movimiento_vacante_configuracion_id_${configuracion.movimiento_vacante_configuracion_id}`);\n   205→                    if (activar_elemento.length > 0 && configuracion.valor != null && configuracion.valor != '') {\n   206→                        activar_elemento.prop('checked', configuracion.valor ? true : false);\n   207→                        activar_elemento.trigger('change');\n   208→                    }\n   209→                    if (elemento.length > 0) {\n   210→                        let tipo_campo = elemento.attr('type');\n   211→                        if (tipo_campo == 'checkbox' || tipo_campo == 'radio') {\n   212→                            elemento.prop('checked', configuracion.valor == \"1\" ? true : false);\n   213→                            elemento.trigger('change');\n   214→                        } else {\n   215→                            if (elemento.hasClass('flatpickr-input')) {\n   216→                                let campo_fecha = elemento[0]._flatpickr;\n   217→                                if (campo_fecha) {\n   218→                                    let fecha = moment(configuracion.valor, 'YYYY-MM-DD HH:mm:ss').toDate();\n   219→                                    campo_fecha.setDate(fecha, true);\n   220→                                } else {\n   221→                                    let campo_fecha = elemento[0]._flatpickr;\n   222→                                    if (campo_fecha) {\n   223→                                        let fecha = moment(configuracion.valor, 'YYYY-MM-DD HH:mm:ss').toDate();\n   224→                                        campo_fecha.setDate(fecha, true);\n   225→                                    }\n   226→                                }\n   227→                            } else {\n   228→                                elemento.val(configuracion.valor);\n   229→                                elemento.trigger('change');\n   230→                            }\n   231→                        }\n   232→                        \n   233→                    }\n   234→                }\n   235→            });\n   236→            if (modal_movimiento_id_seleccionado == 8) {\n   237→                $('#contenedor-archivos-preguntas-prefiltro').empty();\n   238→                $.ajax({\n   239→                    url: `/archivos`,\n   240→                    data: {\n   241→                        modelo_id: etapa_vacante_id_seleccionado,\n   242→                        modelo: 'App\\\\Models\\\\Vacantes\\\\EtapaVacante'\n   243→                    },\n   244→                    type: 'GET',\n   245→                    success: function(respuesta) {\n   246→                        archivos_cargados = respuesta.data;\n   247→                        renderizarArchivos();\n   248→                    }\n   249→                })\n   250→            }\n   251→            \n   252→            if (modal_movimiento_id_seleccionado == 6) {\n   253→                setTimeout(function() {\n   254→                    validarFormularioPruebasPsicometricas();\n   255→                }, 1500);\n   256→            }\n   257→        }\n   258→    });\n   259→}\n   260→\n   261→/**\n   262→ * Función para agregar preguntas.\n   263→ * \n   264→ * @param {string} tipo_pregunta Tipo de pregunta.\n   265→ * @param {string} contenedor Contenedor HTML donde se agregará la pregunta.\n   266→ * @param {number|null} contador_pregunta_cambiar Contador de pregunta a cambiar (opcional).\n   267→ * @param {boolean} es_ia Indica si la pregunta es generada por IA (opcional).\n   268→ * @returns {void}\n   269→ * @author José Manuel Jiménez\n   270→ * @author Andres Morales\n   271→ */\n   272→function agregarPregunta(tipo_pregunta, contenedor, contador_pregunta_cambiar = null, es_ia = false) {\n   273→    let contador_pregunta_crear = null;\n   274→    if (contador_pregunta_cambiar == null) {\n   275→        // Detectar qué modal está activo y usar su contador específico\n   276→        if (contenedor === 'contenedor-preguntas-movimiento-4') {\n   277→            contador_preguntas_prefiltro++;\n   278→            contador_pregunta_crear = contador_preguntas_prefiltro;\n   279→        } else if (contenedor === 'contenedor-preguntas-movimiento-10') {\n   280→            contador_preguntas_video_entrevista++;\n   281→            contador_pregunta_crear = contador_preguntas_video_entrevista;\n   282→        } else {\n   283→            contador_preguntas++;\n   284→            contador_pregunta_crear = contador_preguntas;\n   285→        }\n   286→    } else {\n   287→        contador_pregunta_crear = contador_pregunta_cambiar;\n   288→    }\n   289→    if ((contenedor == 'contenedor-preguntas-movimiento-10' && $(`#${contenedor} .pregunta`).length >= 5) && contador_pregunta_cambiar == null) {\n   290→        mostrarToast('warning', 'No puedes agregar más de 5 preguntas a la video entrevista');\n   291→        return;\n   292→    } else if ((contenedor == 'contenedor-preguntas-movimiento-4' && $(`#${contenedor} .pregunta`).length >= 15) && contador_pregunta_cambiar == null) {\n   293→        mostrarToast('warning', 'No puedes agregar más de 15 preguntas al prefiltro');\n   294→        return;\n   295→    }\n   296→\n   297→    // Validar límite de preguntas abiertas para prefiltro\n   298→    if (contenedor === 'contenedor-preguntas-movimiento-4' && tipo_pregunta === 'abierta') {\n   299→        var limite_preguntas_abiertas = 2;\n   300→        var cantidad_abiertas_actuales = contarPreguntasAbiertas();\n   301→\n   302→        // Si estamos cambiando el tipo de una pregunta existente\n   303→        if (contador_pregunta_cambiar != null) {\n   304→            // Verificar si la pregunta que estamos cambiando ya es abierta\n   305→            var pregunta_actual = $(`#pregunta-${contador_pregunta_cambiar}`);\n   306→            var es_abierta_actualmente = pregunta_actual.find('.tipo-pregunta').val() === 'abierta';\n   307→\n   308→            // Si la pregunta actual no es abierta y ya hay 2 abiertas, no permitir el cambio\n   309→            if (!es_abierta_actualmente && cantidad_abiertas_actuales >= limite_preguntas_abiertas) {\n   310→                mostrarAlertaLimitePreguntasAbiertas();\n   311→                return;\n   312→            }\n   313→        } else {\n   314→            // Si estamos agregando una nueva pregunta abierta\n   315→            if (cantidad_abiertas_actuales >= limite_preguntas_abiertas) {\n   316→                mostrarAlertaLimitePreguntasAbiertas();\n   317→                contador_preguntas_prefiltro--;\n   318→                return;\n   319→            }\n   320→        }\n   321→    }\n   322→    let minutos_tiempo_respuesta = tipo_pregunta == 'abierta' && modal_movimiento_id_seleccionado == 10 && es_ia ? 1 : '';\n   323→    let html_pregunta = `\n   324→        <div class=\"rounded-3 p-3 bg-light-gray\">\n   325→            <div class=\"row justify-content-between align-items-center\">\n   326→                <div class=\"col-auto text-headline-4 text-gray-10 ${modal_movimiento_id_seleccionado == 4 ? 'pointer' : ''}\" ${modal_movimiento_id_seleccionado == 4 ? 'data-bs-toggle=\"dropdown\" aria-expanded=\"false\"' : ''}>\n   327→                    <span class=\"numero-pregunta\">Pregunta ${contador_pregunta_crear}</span>${contenedor != 'contenedor-preguntas-movimiento-10' ? ` - ${tipo_pregunta == 'abierta' ? 'Pregunta abierta' : 'Pregunta selección ' + tipo_pregunta}` : ''} ${modal_movimiento_id_seleccionado == 4 ? '<i class=\"bi bi-chevron-down ms-2\"></i>' : ''}\n   328→                </div>\n   329→                ${modal_movimiento_id_seleccionado == 4 ? `\n   330→                    <div class=\"dropdown-menu w-250px\">\n   331→                        <div class=\"dropdown-item\" onclick=\"agregarPregunta('abierta', 'contenedor-preguntas-movimiento-4', ${contador_pregunta_crear})\">Pregunta abierta</div>\n   332→                        <div class=\"dropdown-item\" onclick=\"agregarPregunta('múltiple', 'contenedor-preguntas-movimiento-4', ${contador_pregunta_crear})\">Pregunta selección múltiple</div>\n   333→                        <div class=\"dropdown-item\" onclick=\"agregarPregunta('única', 'contenedor-preguntas-movimiento-4', ${contador_pregunta_crear})\">Pregunta selección única</div>\n   334→                    </div>\n   335→                ` : ''}\n   336→                <div class=\"col-auto\">\n   337→                    ${crearBoton({\n   338→                        id:'generar_pregunta_prefiltro_con_ia',\n   339→                        clases: 'btn-yellow btn-circle justify-content-center w-fit-content mb-2 ps-2',\n   340→                        texto: `<img class=\"me-2\" src=\"/iconos/icono_ia.svg\">`,\n   341→                        onclick: `generarUnaPreguntaPrefiltroIA(${contador_pregunta_crear}, '${tipo_pregunta == 'múltiple' ? 'seleccion_multiple' : tipo_pregunta == 'única' ? 'seleccion_unica' : 'abierta'}')`,\n   342→                    })}\n   343→                </div>\n   344→            </div>\n   345→            ${tipo_pregunta == 'abierta' ? `\n   346→                <div class=\"row justify-content-between align-items-center mt-3\">\n   347→                    <input type=\"hidden\" class=\"input-dinamico tipo-pregunta\" value=\"${tipo_pregunta}\">\n   348→                    <div class=\"col-12 mb-3\">\n   349→                        ${crearTextarea({\n   350→                            id: `pregunta_abierta_${contador_pregunta_crear}`,\n   351→                            name: `pregunta_abierta_${contador_pregunta_crear}`,\n   352→                            class: 'input-dinamico enunciado',\n   353→                            type: 'text',\n   354→                            input_container_class: 'mb-0',\n   355→                            placeholder: '',\n   356→                            required: true,\n   357→                            label: 'Pregunta',\n   358→                            maxlength: 500,\n   359→                        })}\n   360→                    </div>\n   361→                    <div class=\"col-12 col-lg-5 my-3\">\n   362→                        ${crearInput({\n   363→                            id: `tiempo_respuesta_${contador_pregunta_crear}`,\n   364→                            name: `tiempo_respuesta_${contador_pregunta_crear}`,\n   365→                            class: 'tiempo-respuesta input-dinamico',\n   366→                            input_container_class: 'mb-0',\n   367→                            type: 'number',\n   368→                            placeholder: '',\n   369→                            required: false,\n   370→                            label: 'Minutos para responder',\n   371→                            min: 1,\n   372→                            max: 1440,\n   373→                            onkeyup: `calcularPuntuacionTotal('${contenedor}')`,\n   374→                            value: minutos_tiempo_respuesta\n   375→                        })}\n   376→                    </div>\n   377→                    <div class=\"col-auto my-3\">\n   378→                        ${crearBoton({\n   379→                            clases: 'btn-outline-danger btn-circle',\n   380→                            texto: '<i class=\"bi bi-trash-fill\"></i>',\n   381→                            onclick: `eliminarPregunta(this, '${contenedor}')`,\n   382→                        })}\n   383→                    </div>\n   384→                </div>\n   385→            ` : `\n   386→                <div class=\"row justify-content-end mt-3\">\n   387→                    <div class=\"col-12\">\n   388→                        ${crearInput({\n   389→                            id: `pregunta_seleccion_unica_${contador_pregunta_crear}`,\n   390→                            name: `pregunta_seleccion_unica_${contador_pregunta_crear}`,\n   391→                            class: 'input-dinamico enunciado',\n   392→                            input_container_class: 'mb-0',\n   393→                            placeholder: '',\n   394→                            required: true,\n   395→                            label: 'Pregunta',\n   396→                        })}\n   397→                    </div>\n   398→                    <input type=\"hidden\" class=\"input-dinamico tipo-pregunta\" value=\"${tipo_pregunta}\">\n   399→                    <div class=\"col-12 mt-3 text-body-2 fw-normal\">\n   400→                        ${tipo_pregunta == 'única' ? 'Agrega y selecciona la respuesta correcta' : 'Agrega y selecciona las respuestas correctas'}\n   401→                    </div>\n   402→                </div>\n   403→                <div class=\"row contenedor-respuestas\" id=\"contenedor-respuestas-${contador_pregunta_crear}\"></div>\n   404→                <div class=\"row mt-3\">\n   405→                    <div class=\"col-auto ps-5\">\n   406→                        ${tipo_pregunta == 'única' ?\n   407→                            crearRadioButton({\n   408→                                disabled: true,\n   409→                            }) : crearCheckbox({\n   410→                                disabled: true,\n   411→                            })\n   412→                        }\n   413→                    </div>\n   414→                    <div class=\"col-auto ps-0\">\n   415→                        ${crearBoton({\n   416→                            id: `agregar_respuesta_${contador_pregunta_crear}`,\n   417→                            clases: 'btn-text-primary',\n   418→                            texto: 'Agregar una opción',\n   419→                            onclick: `agregarRespuestaPregunta(this, '${tipo_pregunta}')`,\n   420→                        })}\n   421→                    </div>\n   422→                </div>\n   423→                <div class=\"row justify-content-between align-items-center mt-3\">\n   424→                    <div class=\"col-12 col-lg-5 my-3\">\n   425→                        ${crearInput({\n   426→                            id: `tiempo_respuesta_${contador_pregunta_crear}`,\n   427→                            name: `tiempo_respuesta_${contador_pregunta_crear}`,\n   428→                            class: 'tiempo-respuesta input-dinamico',\n   429→                            input_container_class: 'mb-0',\n   430→                            type: 'number',\n   431→                            placeholder: '',\n   432→                            required: false,\n   433→                            label: 'Minutos para responder',\n   434→                            min: 1,\n   435→                            max: 1440,\n   436→                            value: '2',\n   437→                            onkeyup: `calcularPuntuacionTotal('${contenedor}')`\n   438→                        })}\n   439→                    </div>\n   440→                    <div class=\"col-auto my-3\">\n   441→                        ${crearBoton({\n   442→                            clases: 'btn-outline-danger btn-circle',\n   443→                            texto: '<i class=\"bi bi-trash-fill\"></i>',\n   444→                            onclick: `eliminarPregunta(this, '${contenedor}')`,\n   445→                        })}\n   446→                    </div>\n   447→                </div>\n   448→            `}\n   449→        </div>\n   450→    `;\n   451→    if (contador_pregunta_cambiar == null) {\n   452→        $(`#${contenedor}`).append(`\n   453→            <div id=\"pregunta-${contador_pregunta_crear}\" class=\"col-12 mb-5 pregunta\" data-numero-pregunta=\"${contador_pregunta_crear}\">\n   454→                ${html_pregunta}\n   455→            </div>\n   456→        `);\n   457→    } else {\n   458→        $(`#pregunta-${contador_pregunta_crear}`).html(html_pregunta);\n   459→    }\n   460→    $('.pregunta').fadeIn();\n   461→    setTimeout(() => {\n   462→        calcularPuntuacionTotal(contenedor);\n   463→    }, 100);\n   464→}\n   465→\n   466→/**\n   467→ * Función para calcular la puntuación total.\n   468→ * \n   469→ * @returns {number} Puntuación total.\n   470→ * @author José Manuel Jiménez\n   471→ */\n   472→function calcularPuntuacionTotal(contenedor) {\n   473→    let total_preguntas = 0;\n   474→    $(`#${contenedor}`).parent().find(`.puntuacion`).each(function () {\n   475→        total_preguntas++;\n   476→    });\n   477→    let total_tiempo_segundos = 0;\n   478→    $(`#${contenedor}`).parent().find(`.tiempo-respuesta`).each(function () {\n   479→        if ($(this).val() != '') {\n   480→            total_tiempo_segundos += parseInt($(this).val()) * 60;\n   481→        } else {\n   482→            total_tiempo_segundos += 120;\n   483→        }\n   484→    });\n   485→    let total_tiempo_horas_minutos = obtenerTiempoString(total_tiempo_segundos);\n   486→    $(`#${contenedor}`).parent().find(`#total-tiempo`).text(total_tiempo_horas_minutos);\n   487→}\n   488→\n   489→/**\n   490→ * Función para obtener el tiempo en formato de cadena.\n   491→ * \n   492→ * @param {number} segundos Segundos.\n   493→ * @returns {string} Tiempo en formato de cadena.\n   494→ * @author José Manuel Jiménez\n   495→ */\n   496→function obtenerTiempoString(segundos) {\n   497→    let horas = Math.floor(segundos / 3600);\n   498→    let minutos = Math.floor((segundos % 3600) / 60);\n   499→    return `${horas ? horas + ' hora(s)' : ''} ${minutos} minutos`;\n   500→}\n   501→\n   502→/**\n   503→ * Función para eliminar una pregunta de prefiltro.\n   504→ * \n   505→ * @param {HTMLElement} elemento Elemento.\n   506→ * @param {string} contenedor Contenedor HTML donde se encuentra la pregunta.\n   507→ * @returns {void}\n   508→ * @author José Manuel Jiménez\n   509→ */\n   510→function eliminarPregunta(elemento, contenedor) {\n   511→    Swal.fire({\n   512→        showCloseButton: true,\n   513→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   514→        showConfirmButton: false,\n   515→        showDenyButton: false,\n   516→        showCancelButton: false,\n   517→        html: `\n   518→            <div class=\"row w-100 mx-0 mt-2\">\n   519→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Eliminar?</div>\n   520→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Esta seguro de querer eliminar la pregunta</div>\n   521→                <div class=\"col-6 mt-5 mb-2\">\n   522→                    ${crearBoton({\n   523→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   524→                        texto: 'Cancelar',\n   525→                        onclick:`Swal.close();`\n   526→                    })}\n   527→                </div>\n   528→                <div class=\"col-6 mt-5 mb-2\">\n   529→                    ${crearBoton({\n   530→                        clases: 'btn-danger w-100 justify-content-center',\n   531→                        texto: 'Eliminar',\n   532→                        onclick:`Swal.clickConfirm();`\n   533→                    })}\n   534→                </div>\n   535→            </div>\n   536→        `,\n   537→    }).then((result) => {\n   538→        if (result.isConfirmed) {\n   539→            $(elemento).closest('.pregunta').fadeOut();\n   540→            setTimeout(() => {\n   541→                $(elemento).closest('.pregunta').remove();\n   542→                calcularPuntuacionTotal(contenedor);\n   543→                renumerarPreguntas(contenedor);\n   544→            }, 500);\n   545→            mostrarToast('success', 'La pregunta ha sido eliminada correctamente');\n   546→        }\n   547→    });\n   548→}\n   549→\n   550→/**\n   551→ * Función para renumerar las preguntas de un contenedor.\n   552→ *\n   553→ * @param {string} contenedor Contenedor HTML donde se encuentran las preguntas.\n   554→ * @returns {void}\n   555→ * @author Claude Code\n   556→ */\n   557→function renumerarPreguntas(contenedor) {\n   558→    var $preguntas = $(`#${contenedor}`).find('.pregunta');\n   559→\n   560→    $preguntas.each(function(index) {\n   561→        var numero_nuevo = index + 1;\n   562→        $(this).attr('data-numero-pregunta', numero_nuevo);\n   563→        $(this).find('.numero-pregunta').text('Pregunta ' + numero_nuevo);\n   564→    });\n   565→}\n   566→\n   567→/**\n   568→ * Función para agregar una respuesta a una pregunta.\n   569→ * \n   570→ * @param {HTMLElement} elemento Elemento.\n   571→ * @param {string} tipo_pregunta Tipo de pregunta.\n   572→ * @param {boolean} checked Indica si la respuesta está marcada como correcta.\n   573→ * @returns {void}\n   574→ * @author José Manuel Jiménez\n   575→ */\n   576→function agregarRespuestaPregunta(elemento, tipo_pregunta, checked = false) {\n   577→    contador_respuestas++;\n   578→    var numero_pregunta = $(elemento).closest('.pregunta').data('numero-pregunta') || 0;\n   579→    $(elemento).closest('.pregunta').data('numero-respuesta-pregunta', (($(elemento).closest('.pregunta').data('numero-respuesta-pregunta') || 0) + 1));\n   580→    var contador_respuesta_preguntas = $(elemento).closest('.pregunta').data('numero-respuesta-pregunta');\n   581→    var $pregunta = $(elemento).closest('.pregunta');\n   582→    $pregunta.find('.contenedor-respuestas').append(`\n   583→        <div class=\"col-12 mt-5 px-5 respuesta\">\n   584→            <div class=\"row align-items-center\">\n   585→                <div class=\"col-auto\">\n   586→                    ${tipo_pregunta == 'única' ?\n   587→                        crearRadioButton({\n   588→                            id: `checkbox-respuesta-${contador_respuestas}`,\n   589→                            name: `checkbox-respuesta-${numero_pregunta}`,\n   590→                            class: `input-dinamico ${checked ? 'radio-state-green' : ''}`,\n   591→                            value: '1',\n   592→                            onchange: `seleccionarRespuestaPregunta(this, '${tipo_pregunta}')`,\n   593→                            checked: checked,\n   594→                        }) : crearCheckbox({\n   595→                            id: `checkbox-respuesta-${contador_respuestas}`,\n   596→                            name: `checkbox-respuesta-${numero_pregunta}`,\n   597→                            class: `input-dinamico ${checked ? 'check-state-green' : ''}`,\n   598→                            value: '1',\n   599→                            onchange: `seleccionarRespuestaPregunta(this, '${tipo_pregunta}')`,\n   600→                            checked: checked,\n   601→                        })\n   602→                    }\n   603→                </div>\n   604→                <div class=\"col ps-0\">\n   605→                    ${crearInput({\n   606→                        id: `respuesta_${contador_respuestas}`,\n   607→                        name: `respuesta_${contador_respuestas}`,\n   608→                        input_container_class: 'mb-0',\n   609→                        class: `input-respuesta input-dinamico ${checked ? 'text-state-green' : ''}`,\n   610→                        placeholder: '',\n   611→                        required: true,\n   612→                    })}\n   613→                </div>\n   614→                <div class=\"col-auto ps-2 pe-4\">\n   615→                    <i class=\"bi bi-dash-circle text-state-red pointer\" onclick=\"quitarRespuesta(this)\"></i>\n   616→                </div>\n   617→            </div>\n   618→        </div>\n   619→    `);\n   620→    if ($pregunta.data('mostrar-error-opciones')) {\n   621→        const totalRespuestas = $pregunta.find('.respuesta').length;\n   622→        if (totalRespuestas >= 2) {\n   623→            $pregunta.find('.error-opciones').addClass('d-none');\n   624→            $pregunta.removeData('mostrar-error-opciones');\n   625→        }\n   626→    }\n   627→}\n   628→\n   629→/**\n   630→ * Función para quitar una respuesta.\n   631→ * \n   632→ * @param {HTMLElement} elemento Elemento.\n   633→ * @returns {void}\n   634→ * @author José Manuel Jiménez\n   635→ */\n   636→function quitarRespuesta(elemento) {\n   637→    let $pregunta = $(elemento).closest('.pregunta');\n   638→    let $respuesta = $(elemento).closest('.respuesta');\n   639→    $pregunta.data('numero-respuesta-pregunta', (($pregunta.data('numero-respuesta-pregunta') || 0) - 1));\n   640→    $respuesta.fadeOut();\n   641→    setTimeout(() => {\n   642→        $respuesta.remove();\n   643→        const totalRespuestas = $pregunta.find('.respuesta').length;\n   644→        if ($pregunta.data('mostrar-error-opciones')) {\n   645→            if (totalRespuestas >= 2) {\n   646→                $pregunta.find('.error-opciones').addClass('d-none');\n   647→                $pregunta.removeData('mostrar-error-opciones');\n   648→            } else {\n   649→                $pregunta.find('.error-opciones').removeClass('d-none');\n   650→            }\n   651→        }\n   652→        if ($pregunta.data('mostrar-error-respuesta')) {\n   653→            if ($pregunta.find('.form-check-input:checked').length > 0) {\n   654→                $pregunta.find('.error-respuesta-correcta').addClass('d-none');\n   655→                $pregunta.removeData('mostrar-error-respuesta');\n   656→            } else {\n   657→                $pregunta.find('.error-respuesta-correcta').removeClass('d-none');\n   658→            }\n   659→        }\n   660→    }, 500);\n   661→}\n   662→\n   663→/**\n   664→ * Función para seleccionar una respuesta y colocar color verde a la(s) correcta(s).\n   665→ * \n   666→ * @param {HTMLElement} elemento Elemento.\n   667→ * @returns {void} Elemento seleccionado.\n   668→ * @author José Manuel Jiménez\n   669→ */\n   670→function seleccionarRespuestaPregunta(elemento, tipo_pregunta) {\n   671→    let checked = $(elemento).prop('checked');\n   672→    if (checked) {\n   673→        if (tipo_pregunta == 'única') {\n   674→            $(elemento).closest('.contenedor-respuestas').find('.input-respuesta').removeClass('text-state-green');\n   675→            $(elemento).closest('.contenedor-respuestas').find('.radio-state-green').removeClass('radio-state-green');\n   676→            $(elemento).addClass('radio-state-green');\n   677→            $(elemento).closest('.respuesta').find('.input-respuesta').addClass('text-state-green');\n   678→        } else {\n   679→            $(elemento).addClass('check-state-green');\n   680→            $(elemento).closest('.respuesta').find('.input-respuesta').addClass('text-state-green');\n   681→        }\n   682→    } else {\n   683→        if (tipo_pregunta == 'única') {\n   684→            $(elemento).removeClass('radio-state-green');\n   685→            $(elemento).closest('.respuesta').find('.input-respuesta').removeClass('text-state-green');\n   686→        } else {\n   687→            $(elemento).removeClass('check-state-green');\n   688→            $(elemento).closest('.respuesta').find('.input-respuesta').removeClass('text-state-green');\n   689→        }\n   690→    }\n   691→    const $pregunta = $(elemento).closest('.pregunta');\n   692→    if ($pregunta.find('.form-check-input:checked').length > 0) {\n   693→        $pregunta.find('.error-respuesta-correcta').addClass('d-none');\n   694→        $pregunta.removeData('mostrar-error-respuesta');\n   695→    } else if ($pregunta.data('mostrar-error-respuesta')) {\n   696→        $pregunta.find('.error-respuesta-correcta').removeClass('d-none');\n   697→    }\n   698→}\n   699→\n   700→/**\n   701→ * Función para cerrar el modal de movimiento con validación.\n   702→ *\n   703→ * @returns {void}\n   704→ * @author José Manuel Jiménez\n   705→ * @author Andres Morales\n   706→ */\n   707→function cerrarModalMovimiento() {\n   708→    Swal.fire({\n   709→        showCloseButton: true,\n   710→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   711→        showConfirmButton: false,\n   712→        showDenyButton: false,\n   713→        showCancelButton: false,\n   714→        html: `\n   715→            <div class=\"row w-100 mx-0 mt-2\">\n   716→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Cancelar</div>\n   717→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Perderás las configuraciones que no hayas guardado</div>\n   718→                <div class=\"col-6 mt-5 mb-2\">\n   719→                    ${crearBoton({\n   720→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   721→                        texto: 'Cancelar',\n   722→                        onclick:`Swal.close();`\n   723→                    })}\n   724→                </div>\n   725→                <div class=\"col-6 mt-5 mb-2\">\n   726→                    ${crearBoton({\n   727→                        clases: 'btn-primary w-100 justify-content-center',\n   728→                        texto: 'Aceptar',\n   729→                        onclick:`Swal.clickConfirm();`\n   730→                    })}\n   731→                </div>\n   732→            </div>\n   733→        `,\n   734→    }).then((result) => {\n   735→        if (result.isConfirmed) {\n   736→            if (etapa_activada_desde_toggle && toggle_etapa_activado) {\n   737→                $(toggle_etapa_activado).prop('checked', false);\n   738→                $(toggle_etapa_activado).trigger('change');\n   739→\n   740→                $(toggle_etapa_activado).closest('.accordion-item').find('.accordion-button').addClass('collapsed').attr('aria-disabled', 'true').attr('disabled', true);\n   741→                $(toggle_etapa_activado).closest('.accordion-item').find('.accordion-collapse').removeClass('show').attr('aria-expanded', 'false');\n   742→\n   743→                $.ajax({\n   744→                    url: `/etapas-vacantes/${toggle_etapa_activado.value}`,\n   745→                    data: {\n   746→                        activa: 0,\n   747→                        _token: $('meta[name=\"csrf-token\"]').attr('content')\n   748→                    },\n   749→                    method: 'PUT',\n   750→                    dataType: 'json',\n   751→                    success: function(respuesta) {}\n   752→                });\n   753→\n   754→                toggle_etapa_activado = null;\n   755→                etapa_activada_desde_toggle = false;\n   756→            }\n   757→\n   758→            $('.modal.show').modal('hide');\n   759→        }\n   760→    });\n   761→}\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"721f6a87-a4f5-4ffa-b8cd-5d16eb085694","timestamp":"2026-01-13T21:03:45.765Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\funciones-modals-movimientos.js","content":"$(document).ready(function() {\n    let formularios_movimientos =$('.formulario-movimiento');\n    $.each(formularios_movimientos, function(index, formulario) {\n        configurarFormulario($(formulario).attr('id'));\n    });\n\n    $('.modal[id^=\"modal-movimiento-\"]').on('hidden.bs.modal', function() {\n        if (etapa_activada_desde_toggle && toggle_etapa_activado) {\n            toggle_etapa_activado = null;\n            etapa_activada_desde_toggle = false;\n        }\n    });\n});\n\n/**\n * Validar formulario de movimientos de una vacante.\n *\n * @param {string} formulario ID del formulario a validar.\n * @returns {boolean} Resultado de la validación.\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction validacionFormularioMovimientoVacante(formulario) {\n    let configuraciones = [];\n    let formulario_valido = true;\n    if (modal_movimiento_id_seleccionado === 6) {\n        if (!validarPruebasPsicometricas()) {\n            return false;\n        }\n        configuraciones = recopilarDatosPruebasPsicometricas();\n    }\n\n    if (modal_movimiento_id_seleccionado === 14) {\n        let documentos_checkeados = $('.checkbox-documento:checked').length;\n        if (documentos_checkeados === 0) {\n            mostrarToast('warning', 'Al configurar esta etapa, las casillas aparecerán desactivadas.');\n            return false;\n        }\n        let datos_documentos = recopilarDocumentosSeleccionados();\n        $(`#form-movimiento-14 #configuraciones`).val(JSON.stringify(datos_documentos));\n        return true;\n    }\n\n    if (formulario == 'form-movimiento-4' || formulario == 'form-movimiento-10') {\n        let preguntas = [];\n        let preguntas_agregadas = $(`#contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`).find('.pregunta');\n        let cantidad_preguntas_descartar = $(`#form-movimiento-${modal_movimiento_id_seleccionado} .numero-preguntas`).val();\n        if (preguntas_agregadas.length === 0) {\n            mostrarToast('warning', 'Agrega al menos una pregunta a la entrevista.');\n            formulario_valido = false;\n        } else if (cantidad_preguntas_descartar > preguntas_agregadas.length) {\n            mostrarToast('warning', 'La cantidad de preguntas para descartar candidatos debe ser menor o igual a la cantidad de preguntas agregadas.');\n            formulario_valido = false;\n        }\n        preguntas_agregadas.each(function() {\n            let $pregunta = $(this);\n            let es_abierta = $pregunta.find('.tipo-pregunta').val() == 'abierta' ? true : false;\n            let opciones = null;\n            if (!es_abierta) {\n                $pregunta.find('.error-opciones').addClass('d-none');\n                $pregunta.find('.error-respuesta-correcta').addClass('d-none');\n                $pregunta.removeData('mostrar-error-opciones');\n                $pregunta.removeData('mostrar-error-respuesta');\n                opciones = [];\n                let i = 1;\n                let respuestas = $pregunta.find('.respuesta');\n                let existe_correcta = false;\n                respuestas.each(function() {\n                    if ($(this).find('.form-check-input').prop('checked')) {\n                        existe_correcta = true;\n                    }\n                    let opcion = {\n                        id: $(this).data('id') ? $(this).data('id') : null,\n                        texto: $(this).find('.input-respuesta').val(),\n                        orden: i,\n                        es_correcta: $(this).find('.form-check-input').prop('checked') ? true : false\n                    };\n                    opciones.push(opcion);\n                    i++;\n                });\n                if (respuestas.length < 2) {\n                    if (formulario_valido) {\n                        mostrarToast('warning', 'Agrega al menos dos opciones de respuesta en preguntas de selección múltiple y única.');\n                    }\n                    formulario_valido = false;\n                    $pregunta.find('.error-opciones').removeClass('d-none');\n                    $pregunta.data('mostrar-error-opciones', true);\n                }\n                if (!existe_correcta) {\n                    if (formulario_valido) {\n                        mostrarToast('warning', 'Selecciona al menos una respuesta correcta por cada pregunta de selección múltiple y única.');\n                    }\n                    formulario_valido = false;\n                    $pregunta.find('.error-respuesta-correcta').removeClass('d-none');\n                    $pregunta.data('mostrar-error-respuesta', true);\n                }\n            }\n            let pregunta = {\n                id: $pregunta.data('id') ? $pregunta.data('id') : null,\n                enunciado: $pregunta.find('.enunciado').val(),\n                es_abierta: es_abierta,\n                tiempo_respuesta: $pregunta.find('.tiempo-respuesta').val() ? parseInt($pregunta.find('.tiempo-respuesta').val()) * 60 : null,\n                puntaje: $pregunta.find('.puntuacion').val() ? parseInt($pregunta.find('.puntuacion').val()) : 0,\n            };\n            if (!es_abierta) pregunta.opciones = opciones;\n            preguntas.push(pregunta);\n        });\n        if ($(`#${formulario}`).find('input.error , select.error , textarea.error').length > 0) {\n            formulario_valido = false;\n        }\n        if (formulario_valido) {\n            $.ajax({\n                url: '/vacantes-preguntas',\n                method: 'POST',\n                data: {\n                    _token : $('meta[name=\"csrf-token\"]').attr('content'),\n                    vacante_id: $('#formulario-vacantes-paso-2 #id').val(),\n                    etapa_vacante_id: etapa_vacante_id_seleccionado,\n                    preguntas : JSON.stringify(preguntas)\n                },\n                error: function(xhr, status, error) {\n                    console.error('Ocurrió un error:', error);\n                }\n            });\n        }\n    }\n    if (formulario_valido) {\n        let campos_movimientos = $(`.campos-form-movimiento-${modal_movimiento_id_seleccionado}`);\n        $.each(campos_movimientos, function(index, campo) {\n            let $campo = $(campo);\n            let tipo_campo = $campo.attr('type');\n            let valor = null;\n            if (tipo_campo == 'checkbox' || tipo_campo == 'radio') {\n                valor = $campo.prop('checked') ? \"1\" : \"0\";\n            } else {\n                valor = $campo.val();\n            }\n            configuraciones.push({\n                etapa_movimiento_vacante_id: etapa_movimiento_vacante_id_seleccionado,\n                movimiento_vacante_configuracion_id: parseInt($campo.data('movimiento_vacante_configuracion_id')),\n                valor: valor\n            });\n        });\n        if (modal_movimiento_id_seleccionado === 6) {\n            const tipoCaducidadSeleccionado = $('input[name=\"tipo_caducidad\"]:checked').val();\n            if (tipoCaducidadSeleccionado === 'dias' || tipoCaducidadSeleccionado === 'fecha') {\n                configuraciones = configuraciones.filter(configuracion => {\n                    if (configuracion.movimiento_vacante_configuracion_id === 16) {\n                        return tipoCaducidadSeleccionado === 'dias';\n                    }\n                    if (configuracion.movimiento_vacante_configuracion_id === 17) {\n                        return tipoCaducidadSeleccionado === 'fecha';\n                    }\n                    return true;\n                });\n            }\n        }\n        $(`#form-movimiento-${modal_movimiento_id_seleccionado} #configuraciones`).val(JSON.stringify(configuraciones));\n    }\n    return formulario_valido;\n}\n\n/**\n * Función para mostrar las configuraciones guardadas de la etapa de movimiento.\n * \n * @returns {void}\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n */\nfunction mostrarConfiguracionesEtapaMovimientos() {\n    if (!etapa_movimiento_vacante_id_seleccionado) {\n        return;\n    }\n    $.ajax({\n        url: `/configuraciones-etapa-movimiento/${etapa_movimiento_vacante_id_seleccionado}`,\n        type: 'GET',\n        success: function(respuesta) {\n            let configuraciones = respuesta.data;\n            $.each(configuraciones, function(index, configuracion) {\n                if (configuracion.prueba_id) {\n                    let prueba = pruebas_empresa_vacantes.find(p => p.id == configuracion.prueba_id);\n                    if (prueba) {\n                        slug = prueba.slug;\n                        let llave = slug.replace(/-/g, '_');\n                        let checkbox = $(`#prueba_${llave}`);\n                        if (checkbox.length) {\n                            checkbox.prop('checked', true);\n                            seleccionarPruebaVacante(checkbox[0]);\n        \n                            setTimeout(function() {\n                                if (configuracion.perfil_id) {\n                                    $(`#perfil_id_${llave}`).val(configuracion.perfil_id).trigger('change');\n                                }\n        \n                                if (configuracion.valor) {\n                                    $(`#porcentaje_${llave}`).val(configuracion.valor);\n                                    actualizarPorcentajeTotalVacantes();\n                                }\n                            }, 500 + (index * 100));\n                        }\n                    }\n                } else {\n                    let elemento = $(`#movimiento_vacante_configuracion_id_${configuracion.movimiento_vacante_configuracion_id}`);\n                    let activar_elemento = $(`#activar_movimiento_vacante_configuracion_id_${configuracion.movimiento_vacante_configuracion_id}`);\n                    if (activar_elemento.length > 0 && configuracion.valor != null && configuracion.valor != '') {\n                        activar_elemento.prop('checked', configuracion.valor ? true : false);\n                        activar_elemento.trigger('change');\n                    }\n                    if (elemento.length > 0) {\n                        let tipo_campo = elemento.attr('type');\n                        if (tipo_campo == 'checkbox' || tipo_campo == 'radio') {\n                            elemento.prop('checked', configuracion.valor == \"1\" ? true : false);\n                            elemento.trigger('change');\n                        } else {\n                            if (elemento.hasClass('flatpickr-input')) {\n                                let campo_fecha = elemento[0]._flatpickr;\n                                if (campo_fecha) {\n                                    let fecha = moment(configuracion.valor, 'YYYY-MM-DD HH:mm:ss').toDate();\n                                    campo_fecha.setDate(fecha, true);\n                                } else {\n                                    let campo_fecha = elemento[0]._flatpickr;\n                                    if (campo_fecha) {\n                                        let fecha = moment(configuracion.valor, 'YYYY-MM-DD HH:mm:ss').toDate();\n                                        campo_fecha.setDate(fecha, true);\n                                    }\n                                }\n                            } else {\n                                elemento.val(configuracion.valor);\n                                elemento.trigger('change');\n                            }\n                        }\n                        \n                    }\n                }\n            });\n            if (modal_movimiento_id_seleccionado == 8) {\n                $('#contenedor-archivos-preguntas-prefiltro').empty();\n                $.ajax({\n                    url: `/archivos`,\n                    data: {\n                        modelo_id: etapa_vacante_id_seleccionado,\n                        modelo: 'App\\\\Models\\\\Vacantes\\\\EtapaVacante'\n                    },\n                    type: 'GET',\n                    success: function(respuesta) {\n                        archivos_cargados = respuesta.data;\n                        renderizarArchivos();\n                    }\n                })\n            }\n            \n            if (modal_movimiento_id_seleccionado == 6) {\n                setTimeout(function() {\n                    validarFormularioPruebasPsicometricas();\n                }, 1500);\n            }\n        }\n    });\n}\n\n/**\n * Función para agregar preguntas.\n * \n * @param {string} tipo_pregunta Tipo de pregunta.\n * @param {string} contenedor Contenedor HTML donde se agregará la pregunta.\n * @param {number|null} contador_pregunta_cambiar Contador de pregunta a cambiar (opcional).\n * @param {boolean} es_ia Indica si la pregunta es generada por IA (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction agregarPregunta(tipo_pregunta, contenedor, contador_pregunta_cambiar = null, es_ia = false) {\n    let contador_pregunta_crear = null;\n    if (contador_pregunta_cambiar == null) {\n        // Detectar qué modal está activo y usar su contador específico\n        if (contenedor === 'contenedor-preguntas-movimiento-4') {\n            contador_preguntas_prefiltro++;\n            contador_pregunta_crear = contador_preguntas_prefiltro;\n        } else if (contenedor === 'contenedor-preguntas-movimiento-10') {\n            contador_preguntas_video_entrevista++;\n            contador_pregunta_crear = contador_preguntas_video_entrevista;\n        } else {\n            contador_preguntas++;\n            contador_pregunta_crear = contador_preguntas;\n        }\n    } else {\n        contador_pregunta_crear = contador_pregunta_cambiar;\n    }\n    if ((contenedor == 'contenedor-preguntas-movimiento-10' && $(`#${contenedor} .pregunta`).length >= 5) && contador_pregunta_cambiar == null) {\n        mostrarToast('warning', 'No puedes agregar más de 5 preguntas a la video entrevista');\n        return;\n    } else if ((contenedor == 'contenedor-preguntas-movimiento-4' && $(`#${contenedor} .pregunta`).length >= 15) && contador_pregunta_cambiar == null) {\n        mostrarToast('warning', 'No puedes agregar más de 15 preguntas al prefiltro');\n        return;\n    }\n\n    // Validar límite de preguntas abiertas para prefiltro\n    if (contenedor === 'contenedor-preguntas-movimiento-4' && tipo_pregunta === 'abierta') {\n        var limite_preguntas_abiertas = 2;\n        var cantidad_abiertas_actuales = contarPreguntasAbiertas();\n\n        // Si estamos cambiando el tipo de una pregunta existente\n        if (contador_pregunta_cambiar != null) {\n            // Verificar si la pregunta que estamos cambiando ya es abierta\n            var pregunta_actual = $(`#pregunta-${contador_pregunta_cambiar}`);\n            var es_abierta_actualmente = pregunta_actual.find('.tipo-pregunta').val() === 'abierta';\n\n            // Si la pregunta actual no es abierta y ya hay 2 abiertas, no permitir el cambio\n            if (!es_abierta_actualmente && cantidad_abiertas_actuales >= limite_preguntas_abiertas) {\n                mostrarAlertaLimitePreguntasAbiertas();\n                return;\n            }\n        } else {\n            // Si estamos agregando una nueva pregunta abierta\n            if (cantidad_abiertas_actuales >= limite_preguntas_abiertas) {\n                mostrarAlertaLimitePreguntasAbiertas();\n                contador_preguntas_prefiltro--;\n                return;\n            }\n        }\n    }\n    let minutos_tiempo_respuesta = tipo_pregunta == 'abierta' && modal_movimiento_id_seleccionado == 10 && es_ia ? 1 : '';\n    let html_pregunta = `\n        <div class=\"rounded-3 p-3 bg-light-gray\">\n            <div class=\"row justify-content-between align-items-center\">\n                <div class=\"col-auto text-headline-4 text-gray-10 ${modal_movimiento_id_seleccionado == 4 ? 'pointer' : ''}\" ${modal_movimiento_id_seleccionado == 4 ? 'data-bs-toggle=\"dropdown\" aria-expanded=\"false\"' : ''}>\n                    <span class=\"numero-pregunta\">Pregunta ${contador_pregunta_crear}</span>${contenedor != 'contenedor-preguntas-movimiento-10' ? ` - ${tipo_pregunta == 'abierta' ? 'Pregunta abierta' : 'Pregunta selección ' + tipo_pregunta}` : ''} ${modal_movimiento_id_seleccionado == 4 ? '<i class=\"bi bi-chevron-down ms-2\"></i>' : ''}\n                </div>\n                ${modal_movimiento_id_seleccionado == 4 ? `\n                    <div class=\"dropdown-menu w-250px\">\n                        <div class=\"dropdown-item\" onclick=\"agregarPregunta('abierta', 'contenedor-preguntas-movimiento-4', ${contador_pregunta_crear})\">Pregunta abierta</div>\n                        <div class=\"dropdown-item\" onclick=\"agregarPregunta('múltiple', 'contenedor-preguntas-movimiento-4', ${contador_pregunta_crear})\">Pregunta selección múltiple</div>\n                        <div class=\"dropdown-item\" onclick=\"agregarPregunta('única', 'contenedor-preguntas-movimiento-4', ${contador_pregunta_crear})\">Pregunta selección única</div>\n                    </div>\n                ` : ''}\n                <div class=\"col-auto\">\n                    ${crearBoton({\n                        id:'generar_pregunta_prefiltro_con_ia',\n                        clases: 'btn-yellow btn-circle justify-content-center w-fit-content mb-2 ps-2',\n                        texto: `<img class=\"me-2\" src=\"/iconos/icono_ia.svg\">`,\n                        onclick: `generarUnaPreguntaPrefiltroIA(${contador_pregunta_crear}, '${tipo_pregunta == 'múltiple' ? 'seleccion_multiple' : tipo_pregunta == 'única' ? 'seleccion_unica' : 'abierta'}')`,\n                    })}\n                </div>\n            </div>\n            ${tipo_pregunta == 'abierta' ? `\n                <div class=\"row justify-content-between align-items-center mt-3\">\n                    <input type=\"hidden\" class=\"input-dinamico tipo-pregunta\" value=\"${tipo_pregunta}\">\n                    <div class=\"col-12 mb-3\">\n                        ${crearTextarea({\n                            id: `pregunta_abierta_${contador_pregunta_crear}`,\n                            name: `pregunta_abierta_${contador_pregunta_crear}`,\n                            class: 'input-dinamico enunciado',\n                            type: 'text',\n                            input_container_class: 'mb-0',\n                            placeholder: '',\n                            required: true,\n                            label: 'Pregunta',\n                            maxlength: 500,\n                        })}\n                    </div>\n                    <div class=\"col-12 col-lg-5 my-3\">\n                        ${crearInput({\n                            id: `tiempo_respuesta_${contador_pregunta_crear}`,\n                            name: `tiempo_respuesta_${contador_pregunta_crear}`,\n                            class: 'tiempo-respuesta input-dinamico',\n                            input_container_class: 'mb-0',\n                            type: 'number',\n                            placeholder: '',\n                            required: false,\n                            label: 'Minutos para responder',\n                            min: 1,\n                            max: 1440,\n                            onkeyup: `calcularPuntuacionTotal('${contenedor}')`,\n                            value: minutos_tiempo_respuesta\n                        })}\n                    </div>\n                    <div class=\"col-auto my-3\">\n                        ${crearBoton({\n                            clases: 'btn-outline-danger btn-circle',\n                            texto: '<i class=\"bi bi-trash-fill\"></i>',\n                            onclick: `eliminarPregunta(this, '${contenedor}')`,\n                        })}\n                    </div>\n                </div>\n            ` : `\n                <div class=\"row justify-content-end mt-3\">\n                    <div class=\"col-12\">\n                        ${crearInput({\n                            id: `pregunta_seleccion_unica_${contador_pregunta_crear}`,\n                            name: `pregunta_seleccion_unica_${contador_pregunta_crear}`,\n                            class: 'input-dinamico enunciado',\n                            input_container_class: 'mb-0',\n                            placeholder: '',\n                            required: true,\n                            label: 'Pregunta',\n                        })}\n                    </div>\n                    <input type=\"hidden\" class=\"input-dinamico tipo-pregunta\" value=\"${tipo_pregunta}\">\n                    <div class=\"col-12 mt-3 text-body-2 fw-normal\">\n                        ${tipo_pregunta == 'única' ? 'Agrega y selecciona la respuesta correcta' : 'Agrega y selecciona las respuestas correctas'}\n                    </div>\n                </div>\n                <div class=\"row contenedor-respuestas\" id=\"contenedor-respuestas-${contador_pregunta_crear}\"></div>\n                <div class=\"row mt-3\">\n                    <div class=\"col-auto ps-5\">\n                        ${tipo_pregunta == 'única' ?\n                            crearRadioButton({\n                                disabled: true,\n                            }) : crearCheckbox({\n                                disabled: true,\n                            })\n                        }\n                    </div>\n                    <div class=\"col-auto ps-0\">\n                        ${crearBoton({\n                            id: `agregar_respuesta_${contador_pregunta_crear}`,\n                            clases: 'btn-text-primary',\n                            texto: 'Agregar una opción',\n                            onclick: `agregarRespuestaPregunta(this, '${tipo_pregunta}')`,\n                        })}\n                    </div>\n                </div>\n                <div class=\"row justify-content-between align-items-center mt-3\">\n                    <div class=\"col-12 col-lg-5 my-3\">\n                        ${crearInput({\n                            id: `tiempo_respuesta_${contador_pregunta_crear}`,\n                            name: `tiempo_respuesta_${contador_pregunta_crear}`,\n                            class: 'tiempo-respuesta input-dinamico',\n                            input_container_class: 'mb-0',\n                            type: 'number',\n                            placeholder: '',\n                            required: false,\n                            label: 'Minutos para responder',\n                            min: 1,\n                            max: 1440,\n                            value: '2',\n                            onkeyup: `calcularPuntuacionTotal('${contenedor}')`\n                        })}\n                    </div>\n                    <div class=\"col-auto my-3\">\n                        ${crearBoton({\n                            clases: 'btn-outline-danger btn-circle',\n                            texto: '<i class=\"bi bi-trash-fill\"></i>',\n                            onclick: `eliminarPregunta(this, '${contenedor}')`,\n                        })}\n                    </div>\n                </div>\n            `}\n        </div>\n    `;\n    if (contador_pregunta_cambiar == null) {\n        $(`#${contenedor}`).append(`\n            <div id=\"pregunta-${contador_pregunta_crear}\" class=\"col-12 mb-5 pregunta\" data-numero-pregunta=\"${contador_pregunta_crear}\">\n                ${html_pregunta}\n            </div>\n        `);\n    } else {\n        $(`#pregunta-${contador_pregunta_crear}`).html(html_pregunta);\n    }\n    $('.pregunta').fadeIn();\n    setTimeout(() => {\n        calcularPuntuacionTotal(contenedor);\n    }, 100);\n}\n\n/**\n * Función para calcular la puntuación total.\n * \n * @returns {number} Puntuación total.\n * @author José Manuel Jiménez\n */\nfunction calcularPuntuacionTotal(contenedor) {\n    let total_preguntas = 0;\n    $(`#${contenedor}`).parent().find(`.puntuacion`).each(function () {\n        total_preguntas++;\n    });\n    let total_tiempo_segundos = 0;\n    $(`#${contenedor}`).parent().find(`.tiempo-respuesta`).each(function () {\n        if ($(this).val() != '') {\n            total_tiempo_segundos += parseInt($(this).val()) * 60;\n        } else {\n            total_tiempo_segundos += 120;\n        }\n    });\n    let total_tiempo_horas_minutos = obtenerTiempoString(total_tiempo_segundos);\n    $(`#${contenedor}`).parent().find(`#total-tiempo`).text(total_tiempo_horas_minutos);\n}\n\n/**\n * Función para obtener el tiempo en formato de cadena.\n * \n * @param {number} segundos Segundos.\n * @returns {string} Tiempo en formato de cadena.\n * @author José Manuel Jiménez\n */\nfunction obtenerTiempoString(segundos) {\n    let horas = Math.floor(segundos / 3600);\n    let minutos = Math.floor((segundos % 3600) / 60);\n    return `${horas ? horas + ' hora(s)' : ''} ${minutos} minutos`;\n}\n\n/**\n * Función para eliminar una pregunta de prefiltro.\n * \n * @param {HTMLElement} elemento Elemento.\n * @param {string} contenedor Contenedor HTML donde se encuentra la pregunta.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction eliminarPregunta(elemento, contenedor) {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Eliminar?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Esta seguro de querer eliminar la pregunta</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick:`Swal.close();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-danger w-100 justify-content-center',\n                        texto: 'Eliminar',\n                        onclick:`Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((result) => {\n        if (result.isConfirmed) {\n            $(elemento).closest('.pregunta').fadeOut();\n            setTimeout(() => {\n                $(elemento).closest('.pregunta').remove();\n                calcularPuntuacionTotal(contenedor);\n                renumerarPreguntas(contenedor);\n            }, 500);\n            mostrarToast('success', 'La pregunta ha sido eliminada correctamente');\n        }\n    });\n}\n\n/**\n * Función para renumerar las preguntas de un contenedor.\n *\n * @param {string} contenedor Contenedor HTML donde se encuentran las preguntas.\n * @returns {void}\n * @author Claude Code\n */\nfunction renumerarPreguntas(contenedor) {\n    var $preguntas = $(`#${contenedor}`).find('.pregunta');\n\n    $preguntas.each(function(index) {\n        var numero_nuevo = index + 1;\n        $(this).attr('data-numero-pregunta', numero_nuevo);\n        $(this).find('.numero-pregunta').text('Pregunta ' + numero_nuevo);\n    });\n}\n\n/**\n * Función para agregar una respuesta a una pregunta.\n * \n * @param {HTMLElement} elemento Elemento.\n * @param {string} tipo_pregunta Tipo de pregunta.\n * @param {boolean} checked Indica si la respuesta está marcada como correcta.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction agregarRespuestaPregunta(elemento, tipo_pregunta, checked = false) {\n    contador_respuestas++;\n    var numero_pregunta = $(elemento).closest('.pregunta').data('numero-pregunta') || 0;\n    $(elemento).closest('.pregunta').data('numero-respuesta-pregunta', (($(elemento).closest('.pregunta').data('numero-respuesta-pregunta') || 0) + 1));\n    var contador_respuesta_preguntas = $(elemento).closest('.pregunta').data('numero-respuesta-pregunta');\n    var $pregunta = $(elemento).closest('.pregunta');\n    $pregunta.find('.contenedor-respuestas').append(`\n        <div class=\"col-12 mt-5 px-5 respuesta\">\n            <div class=\"row align-items-center\">\n                <div class=\"col-auto\">\n                    ${tipo_pregunta == 'única' ?\n                        crearRadioButton({\n                            id: `checkbox-respuesta-${contador_respuestas}`,\n                            name: `checkbox-respuesta-${numero_pregunta}`,\n                            class: `input-dinamico ${checked ? 'radio-state-green' : ''}`,\n                            value: '1',\n                            onchange: `seleccionarRespuestaPregunta(this, '${tipo_pregunta}')`,\n                            checked: checked,\n                        }) : crearCheckbox({\n                            id: `checkbox-respuesta-${contador_respuestas}`,\n                            name: `checkbox-respuesta-${numero_pregunta}`,\n                            class: `input-dinamico ${checked ? 'check-state-green' : ''}`,\n                            value: '1',\n                            onchange: `seleccionarRespuestaPregunta(this, '${tipo_pregunta}')`,\n                            checked: checked,\n                        })\n                    }\n                </div>\n                <div class=\"col ps-0\">\n                    ${crearInput({\n                        id: `respuesta_${contador_respuestas}`,\n                        name: `respuesta_${contador_respuestas}`,\n                        input_container_class: 'mb-0',\n                        class: `input-respuesta input-dinamico ${checked ? 'text-state-green' : ''}`,\n                        placeholder: '',\n                        required: true,\n                    })}\n                </div>\n                <div class=\"col-auto ps-2 pe-4\">\n                    <i class=\"bi bi-dash-circle text-state-red pointer\" onclick=\"quitarRespuesta(this)\"></i>\n                </div>\n            </div>\n        </div>\n    `);\n    if ($pregunta.data('mostrar-error-opciones')) {\n        const totalRespuestas = $pregunta.find('.respuesta').length;\n        if (totalRespuestas >= 2) {\n            $pregunta.find('.error-opciones').addClass('d-none');\n            $pregunta.removeData('mostrar-error-opciones');\n        }\n    }\n}\n\n/**\n * Función para quitar una respuesta.\n * \n * @param {HTMLElement} elemento Elemento.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction quitarRespuesta(elemento) {\n    let $pregunta = $(elemento).closest('.pregunta');\n    let $respuesta = $(elemento).closest('.respuesta');\n    $pregunta.data('numero-respuesta-pregunta', (($pregunta.data('numero-respuesta-pregunta') || 0) - 1));\n    $respuesta.fadeOut();\n    setTimeout(() => {\n        $respuesta.remove();\n        const totalRespuestas = $pregunta.find('.respuesta').length;\n        if ($pregunta.data('mostrar-error-opciones')) {\n            if (totalRespuestas >= 2) {\n                $pregunta.find('.error-opciones').addClass('d-none');\n                $pregunta.removeData('mostrar-error-opciones');\n            } else {\n                $pregunta.find('.error-opciones').removeClass('d-none');\n            }\n        }\n        if ($pregunta.data('mostrar-error-respuesta')) {\n            if ($pregunta.find('.form-check-input:checked').length > 0) {\n                $pregunta.find('.error-respuesta-correcta').addClass('d-none');\n                $pregunta.removeData('mostrar-error-respuesta');\n            } else {\n                $pregunta.find('.error-respuesta-correcta').removeClass('d-none');\n            }\n        }\n    }, 500);\n}\n\n/**\n * Función para seleccionar una respuesta y colocar color verde a la(s) correcta(s).\n * \n * @param {HTMLElement} elemento Elemento.\n * @returns {void} Elemento seleccionado.\n * @author José Manuel Jiménez\n */\nfunction seleccionarRespuestaPregunta(elemento, tipo_pregunta) {\n    let checked = $(elemento).prop('checked');\n    if (checked) {\n        if (tipo_pregunta == 'única') {\n            $(elemento).closest('.contenedor-respuestas').find('.input-respuesta').removeClass('text-state-green');\n            $(elemento).closest('.contenedor-respuestas').find('.radio-state-green').removeClass('radio-state-green');\n            $(elemento).addClass('radio-state-green');\n            $(elemento).closest('.respuesta').find('.input-respuesta').addClass('text-state-green');\n        } else {\n            $(elemento).addClass('check-state-green');\n            $(elemento).closest('.respuesta').find('.input-respuesta').addClass('text-state-green');\n        }\n    } else {\n        if (tipo_pregunta == 'única') {\n            $(elemento).removeClass('radio-state-green');\n            $(elemento).closest('.respuesta').find('.input-respuesta').removeClass('text-state-green');\n        } else {\n            $(elemento).removeClass('check-state-green');\n            $(elemento).closest('.respuesta').find('.input-respuesta').removeClass('text-state-green');\n        }\n    }\n    const $pregunta = $(elemento).closest('.pregunta');\n    if ($pregunta.find('.form-check-input:checked').length > 0) {\n        $pregunta.find('.error-respuesta-correcta').addClass('d-none');\n        $pregunta.removeData('mostrar-error-respuesta');\n    } else if ($pregunta.data('mostrar-error-respuesta')) {\n        $pregunta.find('.error-respuesta-correcta').removeClass('d-none');\n    }\n}\n\n/**\n * Función para cerrar el modal de movimiento con validación.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction cerrarModalMovimiento() {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Cancelar</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Perderás las configuraciones que no hayas guardado</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick:`Swal.close();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Aceptar',\n                        onclick:`Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((result) => {\n        if (result.isConfirmed) {\n            if (etapa_activada_desde_toggle && toggle_etapa_activado) {\n                $(toggle_etapa_activado).prop('checked', false);\n                $(toggle_etapa_activado).trigger('change');\n\n                $(toggle_etapa_activado).closest('.accordion-item').find('.accordion-button').addClass('collapsed').attr('aria-disabled', 'true').attr('disabled', true);\n                $(toggle_etapa_activado).closest('.accordion-item').find('.accordion-collapse').removeClass('show').attr('aria-expanded', 'false');\n\n                $.ajax({\n                    url: `/etapas-vacantes/${toggle_etapa_activado.value}`,\n                    data: {\n                        activa: 0,\n                        _token: $('meta[name=\"csrf-token\"]').attr('content')\n                    },\n                    method: 'PUT',\n                    dataType: 'json',\n                    success: function(respuesta) {}\n                });\n\n                toggle_etapa_activado = null;\n                etapa_activada_desde_toggle = false;\n            }\n\n            $('.modal.show').modal('hide');\n        }\n    });\n}","numLines":761,"startLine":1,"totalLines":761}},"sourceToolAssistantUUID":"c4955ec0-3880-47fe-8fdf-35cf24987ed9"}
{"parentUuid":"721f6a87-a4f5-4ffa-b8cd-5d16eb085694","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QL8PTJefka3mjHxpzvn85g","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a leer algunos archivos JavaScript relacionados con los modales de movimientos para tener un análisis completo:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":47775,"cache_read_input_tokens":29036,"cache_creation":{"ephemeral_5m_input_tokens":47775,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX648c45AB82pwrt8xAKs","type":"assistant","uuid":"0941369f-64f7-4a1e-8c27-a1eac920496a","timestamp":"2026-01-13T21:03:50.587Z"}
{"parentUuid":"0941369f-64f7-4a1e-8c27-a1eac920496a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QL8PTJefka3mjHxpzvn85g","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NDB1nJR2m7kxRg7N6uQD7Z","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-pruebas-psicometricas.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":47775,"cache_read_input_tokens":29036,"cache_creation":{"ephemeral_5m_input_tokens":47775,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX648c45AB82pwrt8xAKs","type":"assistant","uuid":"fc73b408-58e5-4f85-899a-7cc54e17fd6a","timestamp":"2026-01-13T21:03:52.419Z"}
{"parentUuid":"fc73b408-58e5-4f85-899a-7cc54e17fd6a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QL8PTJefka3mjHxpzvn85g","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0166km27GbCvtHcVdMVWqAy6","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-ia.js"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":47775,"cache_read_input_tokens":29036,"cache_creation":{"ephemeral_5m_input_tokens":47775,"ephemeral_1h_input_tokens":0},"output_tokens":187,"service_tier":"standard"}},"requestId":"req_011CX648c45AB82pwrt8xAKs","type":"assistant","uuid":"749d522a-a867-4755-9b07-bab293f32c98","timestamp":"2026-01-13T21:03:52.823Z"}
{"parentUuid":"fc73b408-58e5-4f85-899a-7cc54e17fd6a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NDB1nJR2m7kxRg7N6uQD7Z","type":"tool_result","content":"     1→/**\n     2→ * Archivo para manejar la lógica del modal de pruebas psicométricas\n     3→ * @author Andres Morales\n     4→ */\n     5→\n     6→let pruebas_empresa_vacantes = [];\n     7→let configuraciones_pruebas_guardadas = [];\n     8→let validacion_tiempo = null;\n     9→\n    10→const MAPA_CONFIGURACIONES_PRUEBAS = {\n    11→    '3': 5,\n    12→    '4': 6,\n    13→    '7': 7,\n    14→    '10': 8,\n    15→    '11': 9,\n    16→    '2': 10,\n    17→    '12': 11,\n    18→    '1': 51,\n    19→};\n    20→\n    21→$(document).ready(function() {\n    22→    $('#modal-movimiento-6').on('hidden.bs.modal', function() {\n    23→        $('#modal-movimiento-6 .perfil-select').each(function() {\n    24→            if ($(this).hasClass('select2-hidden-accessible')) {\n    25→                $(this).select2('destroy');\n    26→            }\n    27→        });\n    28→    });\n    29→    \n    30→    $('#modal-movimiento-6').on('shown.bs.modal', function() {\n    31→        verificarYAplicarConfiguracionesPruebas();\n    32→    });\n    33→\n    34→    $(document).on('change', '#modal-movimiento-6 .prueba-checkbox', function() {\n    35→        validarFormularioPruebasPsicometricas();\n    36→    });\n    37→\n    38→    $(document).on('change', '#modal-movimiento-6 .perfil-select', function() {\n    39→        let valor = $(this).val();\n    40→        let prueba_id = $(this).data('id');\n    41→        if (valor == 'creacion_perfil') {\n    42→            $(this).val($(this).find('option:first').val()).trigger('change');\n    43→            $('#modal-movimiento-6').addClass('d-none');\n    44→            crearPerfil(prueba_id);\n    45→        } else {\n    46→            validarFormularioPruebasPsicometricas();\n    47→        }\n    48→    });\n    49→\n    50→    $(document).on('blur', '#modal-movimiento-6 .porcentaje-input', function() {\n    51→        validarFormularioPruebasPsicometricas();\n    52→    });\n    53→\n    54→    $(document).on('keyup', '.campos-form-movimiento-6', function() {\n    55→        let boton_guardar = $('#form-movimiento-6').closest('.modal').find('[form=\"form-movimiento-6\"][type=\"submit\"]');\n    56→        if ($(this).val() && $(this).val() !== '') {\n    57→            boton_guardar.prop('disabled', false);\n    58→        } else {\n    59→            boton_guardar.prop('disabled', true);\n    60→        }\n    61→    });\n    62→\n    63→    $(document).on('change', 'input[name=\"tipo_caducidad\"]', function() {\n    64→        validarFormularioPruebasPsicometricas();\n    65→    });\n    66→\n    67→    $(document).on('change', '#modal-movimiento-6 #movimiento_vacante_configuracion_id_16', function() {\n    68→        validarFormularioPruebasPsicometricas();\n    69→    });\n    70→\n    71→    $(document).on('change', '#modal-movimiento-6 #movimiento_vacante_configuracion_id_17', function() {\n    72→        validarFormularioPruebasPsicometricas();\n    73→    });\n    74→});\n    75→\n    76→/**\n    77→ * Validar el formulario en tiempo real y habilitar/deshabilitar el botón Guardar\n    78→ * Utiliza debouncing para evitar múltiples ejecuciones simultáneas\n    79→ *\n    80→ * @returns {void}\n    81→ * @author Andres Morales\n    82→ * @author Jair Carvajal\n    83→ */\n    84→function validarFormularioPruebasPsicometricas() {\n    85→    if (validacion_tiempo) {\n    86→        clearTimeout(validacion_tiempo);\n    87→    }\n    88→    validacion_tiempo = setTimeout(function() {\n    89→        ejecutarValidacionPruebasPsicometricas();\n    90→    }, 50);\n    91→}\n    92→\n    93→/**\n    94→ * Ejecutar la validación real del formulario\n    95→ *\n    96→ * @returns {void}\n    97→ * @author Andres Morales\n    98→ * @author Jair Carvajal\n    99→ */\n   100→function ejecutarValidacionPruebasPsicometricas() {\n   101→    let es_valido = true;\n   102→    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n   103→    let boton_guardar = $('#form-movimiento-6').closest('.modal').find('[form=\"form-movimiento-6\"][type=\"submit\"]');\n   104→\n   105→    if (pruebas_seleccionadas.length === 0) {\n   106→        es_valido = false;\n   107→    } else {\n   108→        let porcentaje_total = 0;\n   109→        let todas_tienen_valores = true;\n   110→\n   111→        pruebas_seleccionadas.each(function() {\n   112→            let fila = $(this).closest('tr');\n   113→            let perfil_select = fila.find('.perfil-select').eq(0);\n   114→            let porcentaje_input = fila.find('.porcentaje-input').eq(0);\n   115→            let perfil = perfil_select.val();\n   116→            let porcentaje = porcentaje_input.val();\n   117→            if (!perfil || perfil === '') {\n   118→                todas_tienen_valores = false;\n   119→                es_valido = false;\n   120→            }\n   121→\n   122→            if (!porcentaje || porcentaje === '' || parseInt(porcentaje) <= 0) {\n   123→                todas_tienen_valores = false;\n   124→                es_valido = false;\n   125→            }\n   126→            if (perfil && perfil !== '' && porcentaje && porcentaje !== '' && parseInt(porcentaje) > 0) {\n   127→                porcentaje_total += parseInt(porcentaje);\n   128→            }\n   129→        });\n   130→\n   131→        if (es_valido && todas_tienen_valores) {\n   132→            if (porcentaje_total !== 100) {\n   133→                es_valido = false;\n   134→            }\n   135→        }\n   136→\n   137→        if (es_valido) {\n   138→            let tipo_caducidad = $('input[name=\"tipo_caducidad\"]:checked').val();\n   139→            if (tipo_caducidad === 'dias') {\n   140→                let cantidad_dias = $('#movimiento_vacante_configuracion_id_16').val();\n   141→                if (!cantidad_dias || cantidad_dias === '' || parseInt(cantidad_dias) <= 0) {\n   142→                    es_valido = false;\n   143→                }\n   144→            } else if (tipo_caducidad === 'fecha') {\n   145→                let fecha = $('#movimiento_vacante_configuracion_id_17').val();\n   146→                if (!fecha || fecha === '') {\n   147→                    es_valido = false;\n   148→                }\n   149→            }\n   150→        }\n   151→    }\n   152→\n   153→    if (boton_guardar.length > 0) {\n   154→        boton_guardar.prop('disabled', !es_valido);\n   155→    }\n   156→}\n   157→\n   158→/**\n   159→ * Verificar si hay configuraciones guardadas y aplicarlas o limpiar el modal\n   160→ *\n   161→ * @returns {void}\n   162→ * @author Andres Morales\n   163→ */\n   164→function verificarYAplicarConfiguracionesPruebas() {\n   165→    if (!etapa_movimiento_vacante_id_seleccionado) {\n   166→        limpiarModalPruebasPsicometricas();\n   167→        return;\n   168→    }\n   169→    $.ajax({\n   170→        url: `/configuraciones-etapa-movimiento/${etapa_movimiento_vacante_id_seleccionado}`,\n   171→        type: 'GET',\n   172→        success: function(respuesta) {\n   173→            let configuraciones = respuesta.data;\n   174→            if (!configuraciones || configuraciones.length === 0) {\n   175→                limpiarModalPruebasPsicometricas();\n   176→            } else {\n   177→                mostrarConfiguracionesEtapaMovimientos();\n   178→            }\n   179→        },\n   180→        error: function() {\n   181→            limpiarModalPruebasPsicometricas();\n   182→        }\n   183→    });\n   184→}\n   185→\n   186→/**\n   187→ * Limpiar el modal de pruebas psicométricas dejándolo sin configuraciones\n   188→ *\n   189→ * @returns {void}\n   190→ * @author Andres Morales\n   191→ */\n   192→function limpiarModalPruebasPsicometricas() {\n   193→    $('#movimiento_vacante_configuracion_id_12').prop('checked', true);\n   194→    $('#movimiento_vacante_configuracion_id_13').prop('checked', false);\n   195→    $('#movimiento_vacante_configuracion_id_14').prop('checked', true);\n   196→    $('#movimiento_vacante_configuracion_id_15').prop('checked', false);\n   197→\n   198→    $('#activar_movimiento_vacante_configuracion_id_16').prop('checked', true);\n   199→    $('#activar_movimiento_vacante_configuracion_id_17').prop('checked', false);\n   200→\n   201→    let campo_fecha = $('#movimiento_vacante_configuracion_id_17')[0];\n   202→    if (campo_fecha && campo_fecha._flatpickr) {\n   203→        campo_fecha._flatpickr.clear();\n   204→    }\n   205→\n   206→    $('#contenedor-cantidad-dias').removeClass('d-none')\n   207→    $('#contenedor-fecha-caducidad').addClass('d-none');\n   208→\n   209→    $('#modal-movimiento-6 #porcentaje-pruebas').text('0%').removeClass('text-green-20 text-danger');\n   210→\n   211→    $('#tabla-pruebas-vacantes tbody tr').each(function() {\n   212→        $(this).find('.prueba-checkbox').prop('disabled', false);\n   213→        $(this).removeClass('opacity-50');\n   214→    });\n   215→\n   216→    let contenedor_alerta = $('#modal-movimiento-6 .alerta-porcentajes');\n   217→    contenedor_alerta.removeClass('alert-warning').addClass('alert-info');\n   218→    contenedor_alerta.find('.text-alerta').text('Los porcentajes de las pruebas deben sumar 100%, ajusta los porcentajes de acuerdo al valor de cada prueba.');\n   219→\n   220→    validarFormularioPruebasPsicometricas();\n   221→}\n   222→\n   223→/**\n   224→ * Cargar las pruebas psicométricas disponibles para la empresa\n   225→ *\n   226→ * @returns {void}\n   227→ * @author Andres Morales\n   228→ */\n   229→function cargarPruebasPsicometricasVacantes() {\n   230→    if (typeof empresa === 'undefined' || !empresa || !empresa.id) {\n   231→        mostrarToast('warning', 'No se ha identificado la empresa');\n   232→        return;\n   233→    }\n   234→    $.ajax({\n   235→        url: `/pruebas-empresas/${empresa.id}`,\n   236→        type: 'GET',\n   237→        data: {\n   238→            tipo_prueba_id: 1,\n   239→        },\n   240→        success: function(respuesta) {\n   241→            pruebas_empresa_vacantes = respuesta.data || [];\n   242→            mostrarPruebasPsicometricasVacantes();\n   243→            validarFormularioPruebasPsicometricas();\n   244→        },\n   245→        error: function(error) {\n   246→            mostrarToast('danger', 'Error al cargar las pruebas psicométricas');\n   247→            console.error('Error al cargar pruebas:', error);\n   248→        }\n   249→    });\n   250→}\n   251→\n   252→/**\n   253→ * Mostrar las pruebas psicométricas en el modal\n   254→ *\n   255→ * @returns {void}\n   256→ * @author Andres Morales\n   257→ * @author Jair Carvajal\n   258→ * @author José Manuel Jiménez\n   259→ */\n   260→function mostrarPruebasPsicometricasVacantes() {\n   261→    let contenedor = $('#modal-movimiento-6 #contenedor-pruebas');\n   262→    contenedor.empty();\n   263→\n   264→    if (pruebas_empresa_vacantes.length === 0) {\n   265→        contenedor.html(`\n   266→            <div class=\"col-12 px-6 py-4\">\n   267→                <div class=\"alert alert-info mb-0\">\n   268→                    No hay pruebas psicométricas disponibles para esta empresa.\n   269→                </div>\n   270→            </div>\n   271→        `);\n   272→        return;\n   273→    }\n   274→    \n   275→    let tabla_html = `\n   276→        <div class=\"col-12 px-6\">\n   277→            <table class=\"table\" id=\"tabla-pruebas-vacantes\">\n   278→                <tbody>\n   279→    `;\n   280→\n   281→    pruebas_empresa_vacantes.forEach(function(prueba) {        \n   282→        let llave = prueba.slug.replace(/-/g, '_');    \n   283→        tabla_html += `\n   284→            <tr class=\"contenedor-prueba\" aria-id=\"${prueba.id}\" aria-name=\"${prueba.nombre}\">\n   285→                <td style=\"width: 50px;\">\n   286→                    ${crearCheckbox({\n   287→                        id: `prueba_${llave}`,\n   288→                        name: 'checkbox',\n   289→                        class: 'input-dinamico prueba-checkbox',\n   290→                        value: prueba.id,\n   291→                        checked: false,\n   292→                        onchange: `seleccionarPruebaVacante(this)`,\n   293→                        adicional: `data-slug=\"${prueba.slug}\"`\n   294→                    })}\n   295→                </td>\n   296→                <td class=\"text-body-2 align-middle text-gray-30\">${prueba.nombre}</td>\n   297→                <td style=\"width: 60px;\">\n   298→                    <img ${crearTooltip({placement: `top`, content: `${prueba.descripcion}`, toggle: `popover` })} src=\"/imagenes/logos/pruebas/${prueba.slug}.png\" width=\"40px\" height=\"40px\" alt=\"Logo ${prueba.nombre}\">\n   299→                </td>\n   300→                <td style=\"width: 250px;\">\n   301→                    <div class=\"d-none contenedor-input-perfiles\">\n   302→                        <input type=\"hidden\" name=\"pruebas[]['id']\" value=\"${prueba.id}\">\n   303→                        ${crearSelect2({\n   304→                            id: `perfil_id_${llave}`,\n   305→                            name: `perfil_id_${prueba.id}`,\n   306→                            class: 'input-dinamico perfil-select',\n   307→                            label: 'Perfil',\n   308→                            required: true,\n   309→                            disabled: true,\n   310→                            opciones: [],\n   311→                            input_container_class: 'mb-0',\n   312→                            adicional: `data-id=\"${prueba.id}\"`\n   313→                        })}\n   314→                    </div>\n   315→                </td>\n   316→                <td style=\"width: 150px;\">\n   317→                    <div class=\"d-none contenedor-input-perfiles\">\n   318→                        ${crearInput({\n   319→                            autocomplete: 'off',\n   320→                            class: 'input-dinamico porcentaje-input',\n   321→                            id: `porcentaje_${llave}`,\n   322→                            label: 'Porcentaje',\n   323→                            name: `porcentaje_prueba_${prueba.id}`,\n   324→                            input_container_class: 'mb-0',\n   325→                            maxlength: 3,\n   326→                            required: true,\n   327→                            type: 'number',\n   328→                            disabled: true,\n   329→                            min: 1,\n   330→                            max: 100,\n   331→                            onchange: `actualizarPorcentajePruebaIndividual(this)`,\n   332→                            adicional: `data-prueba_id=\"${prueba.id}\"`\n   333→                        })}\n   334→                    </div>\n   335→                </td>\n   336→                <td>\n   337→                    <div class=\"d-none contenedor-input-perfiles\">\n   338→                        ${crearBoton({\n   339→                            clases: 'btn-state-on-light btn-circle',\n   340→                            texto: '<i class=\"bi bi-eye text-blue-40\"></i>',\n   341→                            onclick: `verPerfilSeleccionado(${prueba.id})`,\n   342→                        })}\n   343→                    </div>\n   344→                </td>\n   345→            </tr>\n   346→        `;\n   347→    });\n   348→\n   349→    tabla_html += `\n   350→                </tbody>\n   351→            </table>\n   352→        </div>\n   353→    `;\n   354→\n   355→    contenedor.append(tabla_html);\n   356→    $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).modal('show');\n   357→    inicializarTooltips();\n   358→}\n   359→\n   360→/**\n   361→ * Seleccionar o deseleccionar una prueba psicométrica\n   362→ *\n   363→ * @param {HTMLInputElement} checkbox Checkbox de la prueba\n   364→ * @returns {void}\n   365→ * @author Andres Morales\n   366→ */\n   367→function seleccionarPruebaVacante(checkbox) {\n   368→    let checked = checkbox.checked;\n   369→    let prueba_id = $(checkbox).val();\n   370→    let slug = $(checkbox).data('slug');\n   371→    let fila = $(checkbox).closest('tr');\n   372→    let contenedores_input = fila.find('.contenedor-input-perfiles');\n   373→    let select_perfil = fila.find('.perfil-select');\n   374→    let input_porcentaje = fila.find('.porcentaje-input');\n   375→\n   376→    if (checked) {\n   377→        contenedores_input.removeClass('d-none');\n   378→        input_porcentaje.prop('disabled', false);\n   379→        cargarPerfilesPrueba(prueba_id, slug);\n   380→        fila.addClass('prueba-seleccionada');\n   381→    } else {\n   382→        if (select_perfil.hasClass('select2-hidden-accessible')) {\n   383→            select_perfil.select2('destroy');\n   384→        }\n   385→        contenedores_input.addClass('d-none');\n   386→        select_perfil.prop('disabled', true).empty().append('<option value=\"\"></option>');\n   387→        input_porcentaje.prop('disabled', true).val('');\n   388→        input_porcentaje.closest('.input-container').removeClass('error');\n   389→        fila.removeClass('prueba-seleccionada');\n   390→    }\n   391→\n   392→    actualizarPorcentajeTotalVacantes();\n   393→    validarFormularioPruebasPsicometricas();\n   394→}\n   395→\n   396→/**\n   397→ * Cargar los perfiles disponibles para una prueba\n   398→ *\n   399→ * @param {number} prueba_id ID de la prueba\n   400→ * @param {string} slug Slug de la prueba\n   401→ * @param {number|null} perfil_seleccionado_id ID del perfil previamente seleccionado\n   402→ * @returns {void}\n   403→ * @author Andres Morales\n   404→ * @author José Manuel Jiménez\n   405→ */\n   406→function cargarPerfilesPrueba(prueba_id, slug, perfil_seleccionado_id = null) {\n   407→    let llave = slug.replace(/-/g, '_');\n   408→\n   409→    $.ajax({\n   410→        url: `/perfiles-listado-empresa`,\n   411→        type: 'GET',\n   412→        data: {\n   413→            prueba_id: prueba_id\n   414→        },\n   415→        success: function(respuesta) {\n   416→            let perfiles = respuesta.data || [];\n   417→            let select = $(`#perfil_id_${llave}`);\n   418→\n   419→            if (select.hasClass('select2-hidden-accessible')) {\n   420→                select.select2('destroy');\n   421→            }\n   422→\n   423→            select.empty().append('<option value=\"\"></option>');\n   424→\n   425→            perfiles.forEach(function(perfil) {\n   426→                let selected = perfil_seleccionado_id && perfil.id == perfil_seleccionado_id ? 'selected' : '';\n   427→                select.append(`<option value=\"${perfil.id}\" ${selected}>${perfil.nombre}</option>`);\n   428→            });\n   429→            select.append(`<option class=\"border-top\" value=\"creacion_perfil\">Crear perfil</option>`);\n   430→\n   431→            select.prop('disabled', false);\n   432→            actualizarSelect2(`#perfil_id_${llave}`);\n   433→\n   434→            if (perfil_seleccionado_id) {\n   435→                select.trigger('change');\n   436→            }\n   437→        },\n   438→        error: function(error) {\n   439→            mostrarToast('danger', 'Error al cargar los perfiles de la prueba');\n   440→            console.error('Error al cargar perfiles:', error);\n   441→        }\n   442→    });\n   443→}\n   444→\n   445→/**\n   446→ * Actualizar el porcentaje total de las pruebas seleccionadas\n   447→ *\n   448→ * @returns {void}\n   449→ * @author Andres Morales\n   450→ * @author Jair Carvajal\n   451→ */\n   452→function actualizarPorcentajeTotalVacantes() {\n   453→    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n   454→    let cantidad_pruebas = pruebas_seleccionadas.length;\n   455→    let porcentaje_total = 0;\n   456→    let porcentaje_base = cantidad_pruebas > 0 ? Math.floor(100 / cantidad_pruebas) : 0;\n   457→    let residuo = cantidad_pruebas > 0 ? 100 % cantidad_pruebas : 0;\n   458→\n   459→    pruebas_seleccionadas.each(function(index) {\n   460→        let fila = $(this).closest('tr');\n   461→        let input_porcentaje = fila.find('.porcentaje-input');\n   462→        input_porcentaje.closest('.input-container').removeClass('error');\n   463→        let porcentaje_prueba = porcentaje_base + (index === pruebas_seleccionadas.length - 1 ? residuo : 0);\n   464→        input_porcentaje.val(porcentaje_prueba);\n   465→        porcentaje_total += porcentaje_prueba;\n   466→    });\n   467→\n   468→    actualizarVisualizacionPorcentajesTotales(pruebas_seleccionadas, porcentaje_total);\n   469→}\n   470→\n   471→/**\n   472→ * Actualizar el porcentaje total cuando se cambia manualmente el valor de una prueba\n   473→ * Solo recalcula el total sin reasignar automáticamente los porcentajes\n   474→ *\n   475→ * @param {HTMLInputElement} input Input del porcentaje\n   476→ * @returns {void}\n   477→ * @author Jair Carvajal\n   478→ */\n   479→function actualizarPorcentajePruebaIndividual(input) {\n   480→    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n   481→    let porcentaje_total = 0;\n   482→\n   483→    pruebas_seleccionadas.each(function() {\n   484→        let fila = $(this).closest('tr');\n   485→        let input_porcentaje = fila.find('.porcentaje-input');\n   486→        let valor = parseInt(input_porcentaje.val()) || 0;\n   487→        porcentaje_total += valor;\n   488→    });\n   489→\n   490→    actualizarVisualizacionPorcentajesTotales(pruebas_seleccionadas, porcentaje_total);\n   491→    validarFormularioPruebasPsicometricas();\n   492→}\n   493→\n   494→/**\n   495→ * Actualizar la visualización del porcentaje total y estados del modal\n   496→ * Maneja la actualización de colores, mensajes de alerta y deshabilitación de checkboxes\n   497→ *\n   498→ * @param {jQuery} pruebas_seleccionadas Checkboxes de pruebas seleccionadas\n   499→ * @param {number} porcentaje_total Total de porcentajes\n   500→ * @returns {void}\n   501→ * @author Andres Morales\n   502→ */\n   503→function actualizarVisualizacionPorcentajesTotales(pruebas_seleccionadas, porcentaje_total) {\n   504→    let elemento_porcentaje = $('#modal-movimiento-6 #porcentaje-pruebas');\n   505→    let contenedor_alerta = $('#modal-movimiento-6 .alerta-porcentajes');\n   506→\n   507→    elemento_porcentaje.text(`${porcentaje_total}%`);\n   508→\n   509→    if (porcentaje_total > 100) {\n   510→        elemento_porcentaje.removeClass('text-green-20').addClass('text-danger');\n   511→        contenedor_alerta.removeClass('alert-info').addClass('alert-warning');\n   512→        contenedor_alerta.find('.text-alerta').text('Has superado el porcentaje permitido, la suma de los porcentajes de las pruebas debe sumar 100%.');\n   513→\n   514→        pruebas_seleccionadas.each(function() {\n   515→            $(this).closest('tr').find('.porcentaje-input').closest('.input-container').addClass('error');\n   516→        });\n   517→    } else if (porcentaje_total === 100) {\n   518→        elemento_porcentaje.removeClass('text-danger').addClass('text-green-20');\n   519→        contenedor_alerta.removeClass('alert-warning').addClass('alert-info');\n   520→        contenedor_alerta.find('.text-alerta').text('Los porcentajes de las pruebas deben sumar 100%, ajusta los porcentajes de acuerdo al valor de cada prueba.');\n   521→    } else {\n   522→        elemento_porcentaje.removeClass('text-green-20').addClass('text-danger');\n   523→        contenedor_alerta.removeClass('alert-warning').addClass('alert-info');\n   524→        contenedor_alerta.find('.text-alerta').text('Los porcentajes de las pruebas deben sumar 100%, ajusta los porcentajes de acuerdo al valor de cada prueba.');\n   525→    }\n   526→}\n   527→\n   528→/**\n   529→ * Validar que las pruebas seleccionadas tengan perfil y porcentaje\n   530→ *\n   531→ * @returns {boolean} True si es válido\n   532→ * @author Andres Morales\n   533→ */\n   534→function validarPruebasPsicometricas() {\n   535→    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n   536→\n   537→    if (pruebas_seleccionadas.length === 0) {\n   538→        mostrarToast('warning', 'Debes seleccionar al menos una prueba psicométrica');\n   539→        return false;\n   540→    }\n   541→\n   542→    let valido = true;\n   543→    let porcentaje_total = 0;\n   544→\n   545→    pruebas_seleccionadas.each(function() {\n   546→        let contenedor = $(this).closest('.contenedor-prueba');\n   547→        let perfil = contenedor.find('.perfil-select').val();\n   548→        let porcentaje = contenedor.find('.porcentaje-input').val();\n   549→\n   550→        if (!perfil || perfil === '') {\n   551→            mostrarToast('warning', 'Debes seleccionar un perfil para todas las pruebas');\n   552→            valido = false;\n   553→            return false;\n   554→        }\n   555→\n   556→        if (!porcentaje || porcentaje === '' || parseInt(porcentaje) <= 0) {\n   557→            mostrarToast('warning', 'Debes ingresar un porcentaje válido para todas las pruebas');\n   558→            valido = false;\n   559→            return false;\n   560→        }\n   561→\n   562→        porcentaje_total += parseInt(porcentaje);\n   563→    });\n   564→\n   565→    if (valido && porcentaje_total !== 100) {\n   566→        mostrarToast('warning', 'La suma de los porcentajes debe ser igual a 100%');\n   567→        return false;\n   568→    }\n   569→    \n   570→    let tipo_caducidad = $('input[name=\"tipo_caducidad\"]:checked').val();\n   571→    if (tipo_caducidad === 'dias') {\n   572→        let cantidad_dias = $('#movimiento_vacante_configuracion_id_16').val();\n   573→        if (!cantidad_dias || cantidad_dias === '' || parseInt(cantidad_dias) <= 0) {\n   574→            mostrarToast('warning', 'Debes ingresar una cantidad de días válida');\n   575→            $('#movimiento_vacante_configuracion_id_16').closest('.input-container').addClass('error');\n   576→            return false;\n   577→        }\n   578→        $('#movimiento_vacante_configuracion_id_16').closest('.input-container').removeClass('error');\n   579→    } else if (tipo_caducidad === 'fecha') {\n   580→        let fecha = $('#movimiento_vacante_configuracion_id_17').val();\n   581→        if (!fecha || fecha === '') {\n   582→            mostrarToast('warning', 'Debes seleccionar una fecha de caducidad');\n   583→            $('#movimiento_vacante_configuracion_id_17').closest('.input-container').addClass('error');\n   584→            return false;\n   585→        }\n   586→        $('#movimiento_vacante_configuracion_id_17').closest('.input-container').removeClass('error');\n   587→    }\n   588→\n   589→    return valido;\n   590→}\n   591→\n   592→/**\n   593→ * Recopilar datos de pruebas para enviar al backend\n   594→ *\n   595→ * @returns {Array} Array de configuraciones de pruebas\n   596→ * @author Andres Morales\n   597→ */\n   598→function recopilarDatosPruebasPsicometricas() {\n   599→    let configuraciones = [];\n   600→    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n   601→\n   602→    pruebas_seleccionadas.each(function() {\n   603→        let contenedor = $(this).closest('.contenedor-prueba');\n   604→        let prueba_id = $(this).val();\n   605→        let perfil_id = contenedor.find('.perfil-select').val();\n   606→        let porcentaje = contenedor.find('.porcentaje-input').val();\n   607→        let configuracion_id = MAPA_CONFIGURACIONES_PRUEBAS[prueba_id];\n   608→\n   609→        if (configuracion_id) {\n   610→            configuraciones.push({\n   611→                etapa_movimiento_vacante_id: etapa_movimiento_vacante_id_seleccionado,\n   612→                movimiento_vacante_configuracion_id: parseInt(configuracion_id),\n   613→                prueba_id: parseInt(prueba_id),\n   614→                perfil_id: parseInt(perfil_id),\n   615→                valor: porcentaje.toString()\n   616→            });\n   617→        }\n   618→    });\n   619→\n   620→    return configuraciones;\n   621→}\n   622→\n   623→/**\n   624→ * Cambiar entre tipo de caducidad (días o fecha)\n   625→ *\n   626→ * @param {HTMLInputElement} radio Radio button seleccionado\n   627→ * @returns {void}\n   628→ * @author Andres Morales\n   629→ */\n   630→function cambiarTipoCaducidad(radio) {\n   631→    let valor = $(radio).val();\n   632→    if (valor === 'dias') {\n   633→        $('#contenedor-cantidad-dias').removeClass('d-none');\n   634→        $('#contenedor-fecha-caducidad').addClass('d-none');\n   635→        let elemento = $('#movimiento_vacante_configuracion_id_17');\n   636→        let campo_fecha = elemento[0]._flatpickr;\n   637→        if (campo_fecha) {\n   638→            campo_fecha.clear();\n   639→        }\n   640→    } else if (valor === 'fecha') {\n   641→        $('#contenedor-cantidad-dias').addClass('d-none');\n   642→        $('#contenedor-fecha-caducidad').removeClass('d-none');\n   643→        $('#movimiento_vacante_configuracion_id_16').val('').trigger('change');\n   644→    }\n   645→    validarFormularioPruebasPsicometricas();\n   646→}\n   647→\n   648→/**\n   649→ * Manejar el cambio del checkbox de puntuaciones medias\n   650→ * Si se marca, automáticamente marca el de puntuaciones bajas\n   651→ *\n   652→ * @param {HTMLElement} checkbox Elemento checkbox\n   653→ * @returns {void}\n   654→ * @author Andres Morales\n   655→ */\n   656→function manejarCheckPuntuacionesMedias(checkbox) {\n   657→    var checkbox_bajas = $('#movimiento_vacante_configuracion_id_14');\n   658→\n   659→    if ($(checkbox).prop('checked')) {\n   660→        checkbox_bajas.prop('checked', true);\n   661→    }\n   662→}\n   663→\n   664→/**\n   665→ * Manejar el cambio del checkbox de puntuaciones bajas\n   666→ * Si se desmarca, automáticamente desmarca el de puntuaciones medias\n   667→ *\n   668→ * @param {HTMLElement} checkbox Elemento checkbox\n   669→ * @returns {void}\n   670→ * @author Andres Morales\n   671→ */\n   672→function manejarCheckPuntuacionesBajas(checkbox) {\n   673→    var checkbox_medias = $('#movimiento_vacante_configuracion_id_15');\n   674→\n   675→    if (!$(checkbox).prop('checked')) {\n   676→        checkbox_medias.prop('checked', false);\n   677→    }\n   678→}\n   679→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"796937b4-05b7-46bc-8d16-969c6d0aa943","timestamp":"2026-01-13T21:03:54.647Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-pruebas-psicometricas.js","content":"/**\n * Archivo para manejar la lógica del modal de pruebas psicométricas\n * @author Andres Morales\n */\n\nlet pruebas_empresa_vacantes = [];\nlet configuraciones_pruebas_guardadas = [];\nlet validacion_tiempo = null;\n\nconst MAPA_CONFIGURACIONES_PRUEBAS = {\n    '3': 5,\n    '4': 6,\n    '7': 7,\n    '10': 8,\n    '11': 9,\n    '2': 10,\n    '12': 11,\n    '1': 51,\n};\n\n$(document).ready(function() {\n    $('#modal-movimiento-6').on('hidden.bs.modal', function() {\n        $('#modal-movimiento-6 .perfil-select').each(function() {\n            if ($(this).hasClass('select2-hidden-accessible')) {\n                $(this).select2('destroy');\n            }\n        });\n    });\n    \n    $('#modal-movimiento-6').on('shown.bs.modal', function() {\n        verificarYAplicarConfiguracionesPruebas();\n    });\n\n    $(document).on('change', '#modal-movimiento-6 .prueba-checkbox', function() {\n        validarFormularioPruebasPsicometricas();\n    });\n\n    $(document).on('change', '#modal-movimiento-6 .perfil-select', function() {\n        let valor = $(this).val();\n        let prueba_id = $(this).data('id');\n        if (valor == 'creacion_perfil') {\n            $(this).val($(this).find('option:first').val()).trigger('change');\n            $('#modal-movimiento-6').addClass('d-none');\n            crearPerfil(prueba_id);\n        } else {\n            validarFormularioPruebasPsicometricas();\n        }\n    });\n\n    $(document).on('blur', '#modal-movimiento-6 .porcentaje-input', function() {\n        validarFormularioPruebasPsicometricas();\n    });\n\n    $(document).on('keyup', '.campos-form-movimiento-6', function() {\n        let boton_guardar = $('#form-movimiento-6').closest('.modal').find('[form=\"form-movimiento-6\"][type=\"submit\"]');\n        if ($(this).val() && $(this).val() !== '') {\n            boton_guardar.prop('disabled', false);\n        } else {\n            boton_guardar.prop('disabled', true);\n        }\n    });\n\n    $(document).on('change', 'input[name=\"tipo_caducidad\"]', function() {\n        validarFormularioPruebasPsicometricas();\n    });\n\n    $(document).on('change', '#modal-movimiento-6 #movimiento_vacante_configuracion_id_16', function() {\n        validarFormularioPruebasPsicometricas();\n    });\n\n    $(document).on('change', '#modal-movimiento-6 #movimiento_vacante_configuracion_id_17', function() {\n        validarFormularioPruebasPsicometricas();\n    });\n});\n\n/**\n * Validar el formulario en tiempo real y habilitar/deshabilitar el botón Guardar\n * Utiliza debouncing para evitar múltiples ejecuciones simultáneas\n *\n * @returns {void}\n * @author Andres Morales\n * @author Jair Carvajal\n */\nfunction validarFormularioPruebasPsicometricas() {\n    if (validacion_tiempo) {\n        clearTimeout(validacion_tiempo);\n    }\n    validacion_tiempo = setTimeout(function() {\n        ejecutarValidacionPruebasPsicometricas();\n    }, 50);\n}\n\n/**\n * Ejecutar la validación real del formulario\n *\n * @returns {void}\n * @author Andres Morales\n * @author Jair Carvajal\n */\nfunction ejecutarValidacionPruebasPsicometricas() {\n    let es_valido = true;\n    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n    let boton_guardar = $('#form-movimiento-6').closest('.modal').find('[form=\"form-movimiento-6\"][type=\"submit\"]');\n\n    if (pruebas_seleccionadas.length === 0) {\n        es_valido = false;\n    } else {\n        let porcentaje_total = 0;\n        let todas_tienen_valores = true;\n\n        pruebas_seleccionadas.each(function() {\n            let fila = $(this).closest('tr');\n            let perfil_select = fila.find('.perfil-select').eq(0);\n            let porcentaje_input = fila.find('.porcentaje-input').eq(0);\n            let perfil = perfil_select.val();\n            let porcentaje = porcentaje_input.val();\n            if (!perfil || perfil === '') {\n                todas_tienen_valores = false;\n                es_valido = false;\n            }\n\n            if (!porcentaje || porcentaje === '' || parseInt(porcentaje) <= 0) {\n                todas_tienen_valores = false;\n                es_valido = false;\n            }\n            if (perfil && perfil !== '' && porcentaje && porcentaje !== '' && parseInt(porcentaje) > 0) {\n                porcentaje_total += parseInt(porcentaje);\n            }\n        });\n\n        if (es_valido && todas_tienen_valores) {\n            if (porcentaje_total !== 100) {\n                es_valido = false;\n            }\n        }\n\n        if (es_valido) {\n            let tipo_caducidad = $('input[name=\"tipo_caducidad\"]:checked').val();\n            if (tipo_caducidad === 'dias') {\n                let cantidad_dias = $('#movimiento_vacante_configuracion_id_16').val();\n                if (!cantidad_dias || cantidad_dias === '' || parseInt(cantidad_dias) <= 0) {\n                    es_valido = false;\n                }\n            } else if (tipo_caducidad === 'fecha') {\n                let fecha = $('#movimiento_vacante_configuracion_id_17').val();\n                if (!fecha || fecha === '') {\n                    es_valido = false;\n                }\n            }\n        }\n    }\n\n    if (boton_guardar.length > 0) {\n        boton_guardar.prop('disabled', !es_valido);\n    }\n}\n\n/**\n * Verificar si hay configuraciones guardadas y aplicarlas o limpiar el modal\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction verificarYAplicarConfiguracionesPruebas() {\n    if (!etapa_movimiento_vacante_id_seleccionado) {\n        limpiarModalPruebasPsicometricas();\n        return;\n    }\n    $.ajax({\n        url: `/configuraciones-etapa-movimiento/${etapa_movimiento_vacante_id_seleccionado}`,\n        type: 'GET',\n        success: function(respuesta) {\n            let configuraciones = respuesta.data;\n            if (!configuraciones || configuraciones.length === 0) {\n                limpiarModalPruebasPsicometricas();\n            } else {\n                mostrarConfiguracionesEtapaMovimientos();\n            }\n        },\n        error: function() {\n            limpiarModalPruebasPsicometricas();\n        }\n    });\n}\n\n/**\n * Limpiar el modal de pruebas psicométricas dejándolo sin configuraciones\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction limpiarModalPruebasPsicometricas() {\n    $('#movimiento_vacante_configuracion_id_12').prop('checked', true);\n    $('#movimiento_vacante_configuracion_id_13').prop('checked', false);\n    $('#movimiento_vacante_configuracion_id_14').prop('checked', true);\n    $('#movimiento_vacante_configuracion_id_15').prop('checked', false);\n\n    $('#activar_movimiento_vacante_configuracion_id_16').prop('checked', true);\n    $('#activar_movimiento_vacante_configuracion_id_17').prop('checked', false);\n\n    let campo_fecha = $('#movimiento_vacante_configuracion_id_17')[0];\n    if (campo_fecha && campo_fecha._flatpickr) {\n        campo_fecha._flatpickr.clear();\n    }\n\n    $('#contenedor-cantidad-dias').removeClass('d-none')\n    $('#contenedor-fecha-caducidad').addClass('d-none');\n\n    $('#modal-movimiento-6 #porcentaje-pruebas').text('0%').removeClass('text-green-20 text-danger');\n\n    $('#tabla-pruebas-vacantes tbody tr').each(function() {\n        $(this).find('.prueba-checkbox').prop('disabled', false);\n        $(this).removeClass('opacity-50');\n    });\n\n    let contenedor_alerta = $('#modal-movimiento-6 .alerta-porcentajes');\n    contenedor_alerta.removeClass('alert-warning').addClass('alert-info');\n    contenedor_alerta.find('.text-alerta').text('Los porcentajes de las pruebas deben sumar 100%, ajusta los porcentajes de acuerdo al valor de cada prueba.');\n\n    validarFormularioPruebasPsicometricas();\n}\n\n/**\n * Cargar las pruebas psicométricas disponibles para la empresa\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction cargarPruebasPsicometricasVacantes() {\n    if (typeof empresa === 'undefined' || !empresa || !empresa.id) {\n        mostrarToast('warning', 'No se ha identificado la empresa');\n        return;\n    }\n    $.ajax({\n        url: `/pruebas-empresas/${empresa.id}`,\n        type: 'GET',\n        data: {\n            tipo_prueba_id: 1,\n        },\n        success: function(respuesta) {\n            pruebas_empresa_vacantes = respuesta.data || [];\n            mostrarPruebasPsicometricasVacantes();\n            validarFormularioPruebasPsicometricas();\n        },\n        error: function(error) {\n            mostrarToast('danger', 'Error al cargar las pruebas psicométricas');\n            console.error('Error al cargar pruebas:', error);\n        }\n    });\n}\n\n/**\n * Mostrar las pruebas psicométricas en el modal\n *\n * @returns {void}\n * @author Andres Morales\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n */\nfunction mostrarPruebasPsicometricasVacantes() {\n    let contenedor = $('#modal-movimiento-6 #contenedor-pruebas');\n    contenedor.empty();\n\n    if (pruebas_empresa_vacantes.length === 0) {\n        contenedor.html(`\n            <div class=\"col-12 px-6 py-4\">\n                <div class=\"alert alert-info mb-0\">\n                    No hay pruebas psicométricas disponibles para esta empresa.\n                </div>\n            </div>\n        `);\n        return;\n    }\n    \n    let tabla_html = `\n        <div class=\"col-12 px-6\">\n            <table class=\"table\" id=\"tabla-pruebas-vacantes\">\n                <tbody>\n    `;\n\n    pruebas_empresa_vacantes.forEach(function(prueba) {        \n        let llave = prueba.slug.replace(/-/g, '_');    \n        tabla_html += `\n            <tr class=\"contenedor-prueba\" aria-id=\"${prueba.id}\" aria-name=\"${prueba.nombre}\">\n                <td style=\"width: 50px;\">\n                    ${crearCheckbox({\n                        id: `prueba_${llave}`,\n                        name: 'checkbox',\n                        class: 'input-dinamico prueba-checkbox',\n                        value: prueba.id,\n                        checked: false,\n                        onchange: `seleccionarPruebaVacante(this)`,\n                        adicional: `data-slug=\"${prueba.slug}\"`\n                    })}\n                </td>\n                <td class=\"text-body-2 align-middle text-gray-30\">${prueba.nombre}</td>\n                <td style=\"width: 60px;\">\n                    <img ${crearTooltip({placement: `top`, content: `${prueba.descripcion}`, toggle: `popover` })} src=\"/imagenes/logos/pruebas/${prueba.slug}.png\" width=\"40px\" height=\"40px\" alt=\"Logo ${prueba.nombre}\">\n                </td>\n                <td style=\"width: 250px;\">\n                    <div class=\"d-none contenedor-input-perfiles\">\n                        <input type=\"hidden\" name=\"pruebas[]['id']\" value=\"${prueba.id}\">\n                        ${crearSelect2({\n                            id: `perfil_id_${llave}`,\n                            name: `perfil_id_${prueba.id}`,\n                            class: 'input-dinamico perfil-select',\n                            label: 'Perfil',\n                            required: true,\n                            disabled: true,\n                            opciones: [],\n                            input_container_class: 'mb-0',\n                            adicional: `data-id=\"${prueba.id}\"`\n                        })}\n                    </div>\n                </td>\n                <td style=\"width: 150px;\">\n                    <div class=\"d-none contenedor-input-perfiles\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            class: 'input-dinamico porcentaje-input',\n                            id: `porcentaje_${llave}`,\n                            label: 'Porcentaje',\n                            name: `porcentaje_prueba_${prueba.id}`,\n                            input_container_class: 'mb-0',\n                            maxlength: 3,\n                            required: true,\n                            type: 'number',\n                            disabled: true,\n                            min: 1,\n                            max: 100,\n                            onchange: `actualizarPorcentajePruebaIndividual(this)`,\n                            adicional: `data-prueba_id=\"${prueba.id}\"`\n                        })}\n                    </div>\n                </td>\n                <td>\n                    <div class=\"d-none contenedor-input-perfiles\">\n                        ${crearBoton({\n                            clases: 'btn-state-on-light btn-circle',\n                            texto: '<i class=\"bi bi-eye text-blue-40\"></i>',\n                            onclick: `verPerfilSeleccionado(${prueba.id})`,\n                        })}\n                    </div>\n                </td>\n            </tr>\n        `;\n    });\n\n    tabla_html += `\n                </tbody>\n            </table>\n        </div>\n    `;\n\n    contenedor.append(tabla_html);\n    $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).modal('show');\n    inicializarTooltips();\n}\n\n/**\n * Seleccionar o deseleccionar una prueba psicométrica\n *\n * @param {HTMLInputElement} checkbox Checkbox de la prueba\n * @returns {void}\n * @author Andres Morales\n */\nfunction seleccionarPruebaVacante(checkbox) {\n    let checked = checkbox.checked;\n    let prueba_id = $(checkbox).val();\n    let slug = $(checkbox).data('slug');\n    let fila = $(checkbox).closest('tr');\n    let contenedores_input = fila.find('.contenedor-input-perfiles');\n    let select_perfil = fila.find('.perfil-select');\n    let input_porcentaje = fila.find('.porcentaje-input');\n\n    if (checked) {\n        contenedores_input.removeClass('d-none');\n        input_porcentaje.prop('disabled', false);\n        cargarPerfilesPrueba(prueba_id, slug);\n        fila.addClass('prueba-seleccionada');\n    } else {\n        if (select_perfil.hasClass('select2-hidden-accessible')) {\n            select_perfil.select2('destroy');\n        }\n        contenedores_input.addClass('d-none');\n        select_perfil.prop('disabled', true).empty().append('<option value=\"\"></option>');\n        input_porcentaje.prop('disabled', true).val('');\n        input_porcentaje.closest('.input-container').removeClass('error');\n        fila.removeClass('prueba-seleccionada');\n    }\n\n    actualizarPorcentajeTotalVacantes();\n    validarFormularioPruebasPsicometricas();\n}\n\n/**\n * Cargar los perfiles disponibles para una prueba\n *\n * @param {number} prueba_id ID de la prueba\n * @param {string} slug Slug de la prueba\n * @param {number|null} perfil_seleccionado_id ID del perfil previamente seleccionado\n * @returns {void}\n * @author Andres Morales\n * @author José Manuel Jiménez\n */\nfunction cargarPerfilesPrueba(prueba_id, slug, perfil_seleccionado_id = null) {\n    let llave = slug.replace(/-/g, '_');\n\n    $.ajax({\n        url: `/perfiles-listado-empresa`,\n        type: 'GET',\n        data: {\n            prueba_id: prueba_id\n        },\n        success: function(respuesta) {\n            let perfiles = respuesta.data || [];\n            let select = $(`#perfil_id_${llave}`);\n\n            if (select.hasClass('select2-hidden-accessible')) {\n                select.select2('destroy');\n            }\n\n            select.empty().append('<option value=\"\"></option>');\n\n            perfiles.forEach(function(perfil) {\n                let selected = perfil_seleccionado_id && perfil.id == perfil_seleccionado_id ? 'selected' : '';\n                select.append(`<option value=\"${perfil.id}\" ${selected}>${perfil.nombre}</option>`);\n            });\n            select.append(`<option class=\"border-top\" value=\"creacion_perfil\">Crear perfil</option>`);\n\n            select.prop('disabled', false);\n            actualizarSelect2(`#perfil_id_${llave}`);\n\n            if (perfil_seleccionado_id) {\n                select.trigger('change');\n            }\n        },\n        error: function(error) {\n            mostrarToast('danger', 'Error al cargar los perfiles de la prueba');\n            console.error('Error al cargar perfiles:', error);\n        }\n    });\n}\n\n/**\n * Actualizar el porcentaje total de las pruebas seleccionadas\n *\n * @returns {void}\n * @author Andres Morales\n * @author Jair Carvajal\n */\nfunction actualizarPorcentajeTotalVacantes() {\n    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n    let cantidad_pruebas = pruebas_seleccionadas.length;\n    let porcentaje_total = 0;\n    let porcentaje_base = cantidad_pruebas > 0 ? Math.floor(100 / cantidad_pruebas) : 0;\n    let residuo = cantidad_pruebas > 0 ? 100 % cantidad_pruebas : 0;\n\n    pruebas_seleccionadas.each(function(index) {\n        let fila = $(this).closest('tr');\n        let input_porcentaje = fila.find('.porcentaje-input');\n        input_porcentaje.closest('.input-container').removeClass('error');\n        let porcentaje_prueba = porcentaje_base + (index === pruebas_seleccionadas.length - 1 ? residuo : 0);\n        input_porcentaje.val(porcentaje_prueba);\n        porcentaje_total += porcentaje_prueba;\n    });\n\n    actualizarVisualizacionPorcentajesTotales(pruebas_seleccionadas, porcentaje_total);\n}\n\n/**\n * Actualizar el porcentaje total cuando se cambia manualmente el valor de una prueba\n * Solo recalcula el total sin reasignar automáticamente los porcentajes\n *\n * @param {HTMLInputElement} input Input del porcentaje\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction actualizarPorcentajePruebaIndividual(input) {\n    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n    let porcentaje_total = 0;\n\n    pruebas_seleccionadas.each(function() {\n        let fila = $(this).closest('tr');\n        let input_porcentaje = fila.find('.porcentaje-input');\n        let valor = parseInt(input_porcentaje.val()) || 0;\n        porcentaje_total += valor;\n    });\n\n    actualizarVisualizacionPorcentajesTotales(pruebas_seleccionadas, porcentaje_total);\n    validarFormularioPruebasPsicometricas();\n}\n\n/**\n * Actualizar la visualización del porcentaje total y estados del modal\n * Maneja la actualización de colores, mensajes de alerta y deshabilitación de checkboxes\n *\n * @param {jQuery} pruebas_seleccionadas Checkboxes de pruebas seleccionadas\n * @param {number} porcentaje_total Total de porcentajes\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarVisualizacionPorcentajesTotales(pruebas_seleccionadas, porcentaje_total) {\n    let elemento_porcentaje = $('#modal-movimiento-6 #porcentaje-pruebas');\n    let contenedor_alerta = $('#modal-movimiento-6 .alerta-porcentajes');\n\n    elemento_porcentaje.text(`${porcentaje_total}%`);\n\n    if (porcentaje_total > 100) {\n        elemento_porcentaje.removeClass('text-green-20').addClass('text-danger');\n        contenedor_alerta.removeClass('alert-info').addClass('alert-warning');\n        contenedor_alerta.find('.text-alerta').text('Has superado el porcentaje permitido, la suma de los porcentajes de las pruebas debe sumar 100%.');\n\n        pruebas_seleccionadas.each(function() {\n            $(this).closest('tr').find('.porcentaje-input').closest('.input-container').addClass('error');\n        });\n    } else if (porcentaje_total === 100) {\n        elemento_porcentaje.removeClass('text-danger').addClass('text-green-20');\n        contenedor_alerta.removeClass('alert-warning').addClass('alert-info');\n        contenedor_alerta.find('.text-alerta').text('Los porcentajes de las pruebas deben sumar 100%, ajusta los porcentajes de acuerdo al valor de cada prueba.');\n    } else {\n        elemento_porcentaje.removeClass('text-green-20').addClass('text-danger');\n        contenedor_alerta.removeClass('alert-warning').addClass('alert-info');\n        contenedor_alerta.find('.text-alerta').text('Los porcentajes de las pruebas deben sumar 100%, ajusta los porcentajes de acuerdo al valor de cada prueba.');\n    }\n}\n\n/**\n * Validar que las pruebas seleccionadas tengan perfil y porcentaje\n *\n * @returns {boolean} True si es válido\n * @author Andres Morales\n */\nfunction validarPruebasPsicometricas() {\n    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n\n    if (pruebas_seleccionadas.length === 0) {\n        mostrarToast('warning', 'Debes seleccionar al menos una prueba psicométrica');\n        return false;\n    }\n\n    let valido = true;\n    let porcentaje_total = 0;\n\n    pruebas_seleccionadas.each(function() {\n        let contenedor = $(this).closest('.contenedor-prueba');\n        let perfil = contenedor.find('.perfil-select').val();\n        let porcentaje = contenedor.find('.porcentaje-input').val();\n\n        if (!perfil || perfil === '') {\n            mostrarToast('warning', 'Debes seleccionar un perfil para todas las pruebas');\n            valido = false;\n            return false;\n        }\n\n        if (!porcentaje || porcentaje === '' || parseInt(porcentaje) <= 0) {\n            mostrarToast('warning', 'Debes ingresar un porcentaje válido para todas las pruebas');\n            valido = false;\n            return false;\n        }\n\n        porcentaje_total += parseInt(porcentaje);\n    });\n\n    if (valido && porcentaje_total !== 100) {\n        mostrarToast('warning', 'La suma de los porcentajes debe ser igual a 100%');\n        return false;\n    }\n    \n    let tipo_caducidad = $('input[name=\"tipo_caducidad\"]:checked').val();\n    if (tipo_caducidad === 'dias') {\n        let cantidad_dias = $('#movimiento_vacante_configuracion_id_16').val();\n        if (!cantidad_dias || cantidad_dias === '' || parseInt(cantidad_dias) <= 0) {\n            mostrarToast('warning', 'Debes ingresar una cantidad de días válida');\n            $('#movimiento_vacante_configuracion_id_16').closest('.input-container').addClass('error');\n            return false;\n        }\n        $('#movimiento_vacante_configuracion_id_16').closest('.input-container').removeClass('error');\n    } else if (tipo_caducidad === 'fecha') {\n        let fecha = $('#movimiento_vacante_configuracion_id_17').val();\n        if (!fecha || fecha === '') {\n            mostrarToast('warning', 'Debes seleccionar una fecha de caducidad');\n            $('#movimiento_vacante_configuracion_id_17').closest('.input-container').addClass('error');\n            return false;\n        }\n        $('#movimiento_vacante_configuracion_id_17').closest('.input-container').removeClass('error');\n    }\n\n    return valido;\n}\n\n/**\n * Recopilar datos de pruebas para enviar al backend\n *\n * @returns {Array} Array de configuraciones de pruebas\n * @author Andres Morales\n */\nfunction recopilarDatosPruebasPsicometricas() {\n    let configuraciones = [];\n    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n\n    pruebas_seleccionadas.each(function() {\n        let contenedor = $(this).closest('.contenedor-prueba');\n        let prueba_id = $(this).val();\n        let perfil_id = contenedor.find('.perfil-select').val();\n        let porcentaje = contenedor.find('.porcentaje-input').val();\n        let configuracion_id = MAPA_CONFIGURACIONES_PRUEBAS[prueba_id];\n\n        if (configuracion_id) {\n            configuraciones.push({\n                etapa_movimiento_vacante_id: etapa_movimiento_vacante_id_seleccionado,\n                movimiento_vacante_configuracion_id: parseInt(configuracion_id),\n                prueba_id: parseInt(prueba_id),\n                perfil_id: parseInt(perfil_id),\n                valor: porcentaje.toString()\n            });\n        }\n    });\n\n    return configuraciones;\n}\n\n/**\n * Cambiar entre tipo de caducidad (días o fecha)\n *\n * @param {HTMLInputElement} radio Radio button seleccionado\n * @returns {void}\n * @author Andres Morales\n */\nfunction cambiarTipoCaducidad(radio) {\n    let valor = $(radio).val();\n    if (valor === 'dias') {\n        $('#contenedor-cantidad-dias').removeClass('d-none');\n        $('#contenedor-fecha-caducidad').addClass('d-none');\n        let elemento = $('#movimiento_vacante_configuracion_id_17');\n        let campo_fecha = elemento[0]._flatpickr;\n        if (campo_fecha) {\n            campo_fecha.clear();\n        }\n    } else if (valor === 'fecha') {\n        $('#contenedor-cantidad-dias').addClass('d-none');\n        $('#contenedor-fecha-caducidad').removeClass('d-none');\n        $('#movimiento_vacante_configuracion_id_16').val('').trigger('change');\n    }\n    validarFormularioPruebasPsicometricas();\n}\n\n/**\n * Manejar el cambio del checkbox de puntuaciones medias\n * Si se marca, automáticamente marca el de puntuaciones bajas\n *\n * @param {HTMLElement} checkbox Elemento checkbox\n * @returns {void}\n * @author Andres Morales\n */\nfunction manejarCheckPuntuacionesMedias(checkbox) {\n    var checkbox_bajas = $('#movimiento_vacante_configuracion_id_14');\n\n    if ($(checkbox).prop('checked')) {\n        checkbox_bajas.prop('checked', true);\n    }\n}\n\n/**\n * Manejar el cambio del checkbox de puntuaciones bajas\n * Si se desmarca, automáticamente desmarca el de puntuaciones medias\n *\n * @param {HTMLElement} checkbox Elemento checkbox\n * @returns {void}\n * @author Andres Morales\n */\nfunction manejarCheckPuntuacionesBajas(checkbox) {\n    var checkbox_medias = $('#movimiento_vacante_configuracion_id_15');\n\n    if (!$(checkbox).prop('checked')) {\n        checkbox_medias.prop('checked', false);\n    }\n}\n","numLines":679,"startLine":1,"totalLines":679}},"sourceToolAssistantUUID":"fc73b408-58e5-4f85-899a-7cc54e17fd6a"}
{"parentUuid":"749d522a-a867-4755-9b07-bab293f32c98","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0166km27GbCvtHcVdMVWqAy6","type":"tool_result","content":"     1→var preguntas_generadas = [];\n     2→\n     3→/**\n     4→ * Generar vacante con IA.\n     5→ *\n     6→ * @returns {void}\n     7→ * @author José Manuel Jiménez\n     8→ * @author Andres Morales\n     9→ */\n    10→function generarVacanteIA() {\n    11→    let descripcion_vacante_ia = $('#descripcion_vacante_ia').val().trim();\n    12→    if (descripcion_vacante_ia.length >= 5) {\n    13→        $('#modal-vacante-ia').modal('hide');\n    14→        $('#modal-generando-ia').modal('show');\n    15→        $.ajax({\n    16→            type: 'POST',\n    17→            url : '/generar-vacante',\n    18→            data: {\n    19→                _token: $('input[name=\"_token\"]').val(),\n    20→                descripcion: descripcion_vacante_ia,\n    21→            },\n    22→            success: function(respuesta) {\n    23→                let vacante_ia = respuesta.data;\n    24→                // Llenar el nombre de la vacante\n    25→                if (vacante_ia.nombre_vacante) {\n    26→                    $('#nombre_vacante').val(vacante_ia.nombre_vacante);\n    27→                }\n    28→                if (vacante_ia.salario.fijo) {\n    29→                    $('#salario_especifico').prop('checked', true).trigger('change');\n    30→                    $('#salario_cantidad').val(numeroCleave(vacante_ia.salario.fijo));\n    31→                } else {\n    32→                    $('#salario_a_convenir').prop('checked', true).trigger('change');\n    33→                    $('#salario_desde').val(numeroCleave(vacante_ia.salario.minimo));\n    34→                    $('#salario_hasta').val(numeroCleave(vacante_ia.salario.maximo));\n    35→                }\n    36→                $('#habilidades').val([]);\n    37→                let habilidades = vacante_ia.habilidades.map(item => item.trim());\n    38→                for (let i = 0; i < habilidades.length; i++) {\n    39→                    if (habilidades[i]) {\n    40→                        $('#habilidades').append(new Option(habilidades[i], habilidades[i], false, true));\n    41→                    }\n    42→                }\n    43→                $('#herramientas_tecnologicas').val([]);\n    44→                let herramientas_tecnologicas = vacante_ia.herramientas_tecnologicas.map(item => item.trim());\n    45→                for (let i = 0; i < herramientas_tecnologicas.length; i++) {\n    46→                    if (herramientas_tecnologicas[i]) {\n    47→                        $('#herramientas_tecnologicas').append(new Option(herramientas_tecnologicas[i], herramientas_tecnologicas[i], false, true));\n    48→                    }\n    49→                }\n    50→                $('#experiencia_laboral').val(vacante_ia.experiencia_laboral).trigger('change.select2');\n    51→                $('#nivel_educativo_vacante').val(vacante_ia.nivel_educativo).trigger('change.select2');\n    52→\n    53→                $('#idiomas_seleccionados').val([]);\n    54→                $('#idiomas_seleccionados').multiselect(\"refresh\");\n    55→                $('#contenedor-idiomas').empty();\n    56→\n    57→                if (vacante_ia.idiomas && vacante_ia.idiomas.length > 0) {\n    58→                    let ids_idiomas = vacante_ia.idiomas.map(function(item) {\n    59→                        let idioma = idiomas.find(function(idioma) {\n    60→                            return idioma.nombre === item.idioma;\n    61→                        });\n    62→                        return idioma.id;\n    63→                    });\n    64→\n    65→                    $('#idiomas_seleccionados').val(ids_idiomas);\n    66→                    $('#idiomas_seleccionados').multiselect(\"refresh\");\n    67→                    $('#idiomas_seleccionados').trigger('change');\n    68→\n    69→                    $.each(ids_idiomas, function(index, id_idioma) {\n    70→                        $(`#nivel_idioma_${id_idioma}`).val(vacante_ia.idiomas[index].nivel).trigger('change.select2');\n    71→                    });\n    72→                }\n    73→                let modalidad_trabajo = modalidades_trabajos.find(item => item.nombre.toLowerCase() === vacante_ia.modalidad_trabajo.toLowerCase());\n    74→                if (modalidad_trabajo) {\n    75→                    $(`#modalidad_trabajo_id_${modalidad_trabajo.id}`).prop('checked', true).trigger('change');\n    76→                }\n    77→                $('#funciones').val(vacante_ia.funciones || '').trigger('input');\n    78→                $('#modal-generando-ia').modal('hide');\n    79→                mostrarToast('success', 'Información generada exitosamente');\n    80→            }, error: function(error) {\n    81→                $('#modal-generando-ia').modal('hide');\n    82→                mostrarToast('danger', 'Ocurrió un error al generar la vacante, respuesta de la IA: ' + error.responseJSON.errors);\n    83→            }\n    84→        });\n    85→    } else {\n    86→        mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n    87→    }\n    88→}\n    89→\n    90→/**\n    91→ * Generar preguntas de prefiltro con IA.\n    92→ *\n    93→ * @returns {void}\n    94→ * @author José Manuel Jiménez\n    95→ * @author Daniel Beltrán\n    96→ * @author Andres Morales\n    97→ */\n    98→function generarPreguntasPrefiltroIA() {\n    99→    let nombre_vacante = $('#nombre_vacante').val().trim();\n   100→    let habilidades = $('#habilidades').val() || [];\n   101→    let herramientas_tecnologicas = $('#herramientas_tecnologicas').val() || [];\n   102→    let experiencia_laboral = $('#experiencia_laboral').val();\n   103→    let nivel_educativo = $('#nivel_educativo_vacante').val();\n   104→    let vacante_id = $('#formulario-vacantes-paso-1 #id').val() || $('#formulario-vacantes-paso-2 #id').val() || $('#id').val() || null;\n   105→    if (nombre_vacante.length >= 5 && habilidades.length > 0 && herramientas_tecnologicas.length > 0 && experiencia_laboral && nivel_educativo) {\n   106→        $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).addClass('d-none');\n   107→        $('#modal-generando-ia').modal('show');\n   108→        let url_ia = '/generar-preguntas-prefiltro';\n   109→        let tipo_preguntas = ['abierta', 'seleccion_unica', 'seleccion_multiple'];\n   110→        if (modal_movimiento_id_seleccionado == 10) {\n   111→            url_ia = '/generar-preguntas-videoentrevista';\n   112→            tipo_preguntas = ['abierta'];\n   113→        }\n   114→        $.ajax({\n   115→            type: 'POST',\n   116→            url : url_ia,\n   117→            data: {\n   118→                _token: $('input[name=\"_token\"]').val(),\n   119→                vacante_id: vacante_id,\n   120→                nombre_vacante: nombre_vacante,\n   121→                habilidades: habilidades,\n   122→                herramientas_tecnologicas: herramientas_tecnologicas,\n   123→                experiencia_laboral: experiencia_laboral,\n   124→                nivel_educativo: nivel_educativo,\n   125→                numero_preguntas: 5,\n   126→                tipo_preguntas: tipo_preguntas\n   127→            },\n   128→            success: function(respuesta) {\n   129→                $(`#contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`).html('');\n   130→\n   131→                if (modal_movimiento_id_seleccionado == 4) {\n   132→                    contador_preguntas_prefiltro = 0;\n   133→                } else if (modal_movimiento_id_seleccionado == 10) {\n   134→                    contador_preguntas_video_entrevista = 0;\n   135→                }\n   136→                contador_respuestas = 0;\n   137→\n   138→                // Contar cuántas preguntas abiertas se generarán\n   139→                var limite_preguntas_abiertas = 2;\n   140→                var contador_preguntas_abiertas_generadas = 0;\n   141→\n   142→                respuesta.data.preguntas.forEach((pregunta) => {\n   143→                    // Validar límite de preguntas abiertas para prefiltro\n   144→                    if (modal_movimiento_id_seleccionado == 4 && pregunta.tipo === 'abierta') {\n   145→                        contador_preguntas_abiertas_generadas++;\n   146→                        if (contador_preguntas_abiertas_generadas > limite_preguntas_abiertas) {\n   147→                            return; // Saltar esta pregunta si excede el límite\n   148→                        }\n   149→                    }\n   150→                    preguntas_generadas.push(pregunta.texto);\n   151→\n   152→                    let contador_actual = modal_movimiento_id_seleccionado == 4\n   153→                        ? contador_preguntas_prefiltro\n   154→                        : contador_preguntas_video_entrevista;\n   155→\n   156→                    if (pregunta.tipo === 'abierta') {\n   157→                        agregarPregunta('abierta', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, null, true);\n   158→\n   159→                        contador_actual = modal_movimiento_id_seleccionado == 4\n   160→                            ? contador_preguntas_prefiltro\n   161→                            : contador_preguntas_video_entrevista;\n   162→\n   163→                        $(`#pregunta_abierta_${contador_actual}`).val(pregunta.texto);\n   164→                        if (pregunta.tiempo_segundos) {\n   165→                            $(`#tiempo_respuesta_${contador_actual}`).val(pregunta.tiempo_segundos / 60);\n   166→                        }\n   167→                    } else {\n   168→                        if (pregunta.tipo === 'seleccion_unica') {\n   169→                            agregarPregunta('única', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, null, true);\n   170→                        } else {\n   171→                            agregarPregunta('múltiple', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, null, true);\n   172→                        }\n   173→\n   174→                        contador_actual = modal_movimiento_id_seleccionado == 4\n   175→                            ? contador_preguntas_prefiltro\n   176→                            : contador_preguntas_video_entrevista;\n   177→\n   178→                        $(`#pregunta_seleccion_unica_${contador_actual}`).val(pregunta.texto);\n   179→                        pregunta.opciones.forEach((opcion) => {\n   180→                            let checked = false;\n   181→                            if (pregunta.respuestas_correctas.find((item) => item === opcion)) {\n   182→                                checked = true;\n   183→                            }\n   184→                            if (pregunta.tipo === 'seleccion_unica') {\n   185→                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_actual}`), 'única', checked);\n   186→                            } else {\n   187→                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_actual}`), 'múltiple', checked);\n   188→                            }\n   189→                            $(`#contenedor-respuestas-${contador_actual} #respuesta_${contador_respuestas}`).val(opcion);\n   190→                        });\n   191→                    }\n   192→                });\n   193→\n   194→                $('#modal-generando-ia').modal('hide');\n   195→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   196→\n   197→                // Mostrar alerta si se omitieron preguntas abiertas por el límite\n   198→                if (modal_movimiento_id_seleccionado == 4 && contador_preguntas_abiertas_generadas > limite_preguntas_abiertas) {\n   199→                    var preguntas_omitidas = contador_preguntas_abiertas_generadas - limite_preguntas_abiertas;\n   200→                    mostrarToast('info', `Se generaron solo ${limite_preguntas_abiertas} preguntas abiertas debido al límite establecido. ${preguntas_omitidas} pregunta(s) abierta(s) fueron omitidas.`);\n   201→                }\n   202→            }, error: function(error) {\n   203→                mostrarToast('danger', 'Ocurrió un error al generar las preguntas, respuesta de la IA: ' + error.responseJSON.errors);\n   204→                $('#modal-generando-ia').modal('hide');\n   205→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   206→            }\n   207→        });\n   208→    } else {\n   209→        if (nombre_vacante.length < 5) {\n   210→            mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n   211→        } else if (habilidades.length == 0) {\n   212→            mostrarToast('warning', 'Debe seleccionar al menos una habilidad');\n   213→        } else if (herramientas_tecnologicas.length == 0) {\n   214→            mostrarToast('warning', 'Debe seleccionar al menos una herramienta tecnológica');\n   215→        } else if (!experiencia_laboral) {\n   216→            mostrarToast('warning', 'Debe seleccionar la experiencia laboral');\n   217→        } else if (!nivel_educativo) {\n   218→            mostrarToast('warning', 'Debe seleccionar el nivel educativo');\n   219→        }\n   220→    }\n   221→    calcularPuntuacionTotal(`contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`);\n   222→}\n   223→\n   224→/**\n   225→ * Generar una pregunta de prefiltro con IA.\n   226→ *\n   227→ * @param {number} contador_pregunta Número de la pregunta a generar\n   228→ * @param {string|null} tipo_pregunta Tipo de pregunta a generar (opcional).\n   229→ * @returns {void}\n   230→ * @author José Manuel Jiménez\n   231→ * @author Daniel Beltrán\n   232→ * @author Andres Morales\n   233→ */\n   234→function generarUnaPreguntaPrefiltroIA(contador_pregunta, tipo_pregunta = null) {\n   235→    let nombre_vacante = $('#nombre_vacante').val().trim();\n   236→    let habilidades = $('#habilidades').val() || [];\n   237→    let herramientas_tecnologicas = $('#herramientas_tecnologicas').val() || [];\n   238→    let experiencia_laboral = $('#experiencia_laboral').val();\n   239→    let nivel_educativo = $('#nivel_educativo_vacante').val();\n   240→    let vacante_id = $('#formulario-vacantes-paso-1 #id').val() || $('#formulario-vacantes-paso-2 #id').val() || $('#id').val() || null;\n   241→\n   242→    // Validar límite de preguntas abiertas antes de generar con IA\n   243→    if (modal_movimiento_id_seleccionado == 4 && tipo_pregunta === 'abierta') {\n   244→        var limite_preguntas_abiertas = 2;\n   245→        var cantidad_abiertas_actuales = contarPreguntasAbiertas();\n   246→\n   247→        if (cantidad_abiertas_actuales >= limite_preguntas_abiertas) {\n   248→            mostrarAlertaLimitePreguntasAbiertas();\n   249→            return;\n   250→        }\n   251→    }\n   252→\n   253→    if (nombre_vacante.length >= 5 && habilidades.length > 0 && herramientas_tecnologicas.length > 0 && experiencia_laboral && nivel_educativo) {\n   254→        $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).addClass('d-none');\n   255→        $('#modal-generando-ia').modal('show');\n   256→        let url_ia = '/generar-preguntas-prefiltro';\n   257→        let tipo_preguntas = ['abierta', 'seleccion_unica', 'seleccion_multiple'];\n   258→        if (modal_movimiento_id_seleccionado == 10) {\n   259→            url_ia = '/generar-preguntas-videoentrevista';\n   260→            tipo_preguntas = ['abierta'];\n   261→        }\n   262→        if (tipo_pregunta) {\n   263→            tipo_preguntas = [tipo_pregunta];\n   264→        }\n   265→\n   266→        let datos = {\n   267→            _token                   : $('input[name=\"_token\"]').val(),\n   268→            vacante_id               : vacante_id,\n   269→            nombre_vacante           : nombre_vacante,\n   270→            habilidades              : habilidades,\n   271→            herramientas_tecnologicas: herramientas_tecnologicas,\n   272→            experiencia_laboral      : experiencia_laboral,\n   273→            nivel_educativo          : nivel_educativo,\n   274→            numero_preguntas         : 1,\n   275→            tipo_preguntas           : tipo_preguntas\n   276→        };\n   277→\n   278→        if (preguntas_generadas.length > 0) {\n   279→            datos.preguntas_existentes = JSON.stringify(preguntas_generadas);\n   280→        }\n   281→\n   282→        $.ajax({\n   283→            type: 'POST',\n   284→            url : url_ia,\n   285→            data: datos,\n   286→            success: function(respuesta) {\n   287→                $(`#pregunta-${contador_pregunta}`).empty();\n   288→\n   289→                respuesta.data.preguntas.forEach((pregunta) => {\n   290→                    preguntas_generadas.push(pregunta.texto);\n   291→\n   292→                    if (pregunta.tipo === 'abierta') {\n   293→                        agregarPregunta('abierta', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, contador_pregunta, true);\n   294→                        $(`#pregunta_abierta_${contador_pregunta}`).val(pregunta.texto);\n   295→                        if (pregunta.tiempo_segundos) {\n   296→                            $(`#tiempo_respuesta_${contador_pregunta}`).val(pregunta.tiempo_segundos / 60);\n   297→                        }\n   298→                    } else {\n   299→                        if (pregunta.tipo === 'seleccion_unica') {\n   300→                            agregarPregunta('única', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, contador_pregunta, true);\n   301→                        } else {\n   302→                            agregarPregunta('múltiple', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, contador_pregunta, true);\n   303→                        }\n   304→                        $(`#pregunta_seleccion_unica_${contador_pregunta}`).val(pregunta.texto);\n   305→                        pregunta.opciones.forEach((opcion) => {\n   306→                            let checked = false;\n   307→                            if (pregunta.respuestas_correctas.find((item) => item === opcion)) {\n   308→                                checked = true;\n   309→                            }\n   310→                            if (pregunta.tipo === 'seleccion_unica') {\n   311→                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_pregunta}`), 'única', checked);\n   312→                            } else {\n   313→                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_pregunta}`), 'múltiple', checked);\n   314→                            }\n   315→                            $(`#contenedor-respuestas-${contador_pregunta} #respuesta_${contador_respuestas}`).val(opcion);\n   316→                        });\n   317→                    }\n   318→                });\n   319→                $('#modal-generando-ia').modal('hide');\n   320→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   321→            }, error: function(error) {\n   322→                mostrarToast('danger', 'Ocurrió un error al generar las preguntas, respuesta de la IA: ' + error.responseJSON.errors);\n   323→                $('#modal-generando-ia').modal('hide');\n   324→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   325→            }\n   326→        });\n   327→    } else {\n   328→        if (nombre_vacante.length < 5) {\n   329→            mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n   330→        } else if (habilidades.length == 0) {\n   331→            mostrarToast('warning', 'Debe seleccionar al menos una habilidad');\n   332→        } else if (herramientas_tecnologicas.length == 0) {\n   333→            mostrarToast('warning', 'Debe seleccionar al menos una herramienta tecnológica');\n   334→        } else if (!experiencia_laboral) {\n   335→            mostrarToast('warning', 'Debe seleccionar la experiencia laboral');\n   336→        } else if (!nivel_educativo) {\n   337→            mostrarToast('warning', 'Debe seleccionar el nivel educativo');\n   338→        }\n   339→    }\n   340→    calcularPuntuacionTotal(`contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`);\n   341→}\n   342→\n   343→/**\n   344→ * Generar pruebas psicométricas con IA.\n   345→ *\n   346→ * @returns {void}\n   347→ * @author José Manuel Jiménez\n   348→ * @author Andres Morales\n   349→ */\n   350→function generarPruebasPsicometricasIA() {\n   351→    let nombre_vacante = $('#nombre_vacante').val().trim();\n   352→    let habilidades = $('#habilidades').val() || [];\n   353→    let herramientas_tecnologicas = $('#herramientas_tecnologicas').val() || [];\n   354→    let experiencia_laboral = $('#experiencia_laboral').val();\n   355→    let nivel_educativo = $('#nivel_educativo_vacante').val();\n   356→    let vacante_id = $('#formulario-vacantes-paso-1 #id').val() || $('#formulario-vacantes-paso-2 #id').val() || $('#id').val() || null;\n   357→    if (nombre_vacante.length >= 5 && habilidades.length > 0 && herramientas_tecnologicas.length > 0 && experiencia_laboral && nivel_educativo) {\n   358→        $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).addClass('d-none');\n   359→        $('#modal-generando-ia').modal('show');\n   360→        $.ajax({\n   361→            type: 'POST',\n   362→            url : '/generar-pruebas-psicometricas',\n   363→            data: {\n   364→                _token: $('input[name=\"_token\"]').val(),\n   365→                vacante_id: vacante_id,\n   366→                nombre_vacante: nombre_vacante,\n   367→                habilidades: habilidades,\n   368→                herramientas_tecnologicas: herramientas_tecnologicas,\n   369→                experiencia_laboral: experiencia_laboral,\n   370→                nivel_educativo: nivel_educativo\n   371→            },\n   372→            success: function(respuesta) {\n   373→                $('#modal-generando-ia').modal('hide');\n   374→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   375→                // Limpiar selección previa\n   376→                $('.prueba-checkbox').prop('checked', false).trigger('change');\n   377→\n   378→                let pruebas_generadas = respuesta.data.pruebas || [];\n   379→\n   380→                // Helpers para seleccionar perfil cuando el select se llene\n   381→                const esperarYSeleccionarPerfil = (selector, valor, intentos = 10) => {\n   382→                    if (!valor || intentos <= 0) return;\n   383→                    const $select = $(selector);\n   384→                    if ($select.length === 0) return;\n   385→                    if ($select.find(`option[value=\"${valor}\"]`).length > 0) {\n   386→                        $select.val(valor).trigger('change.select2');\n   387→                        return;\n   388→                    }\n   389→                    setTimeout(() => esperarYSeleccionarPerfil(selector, valor, intentos - 1), 300);\n   390→                };\n   391→                const esperarYSeleccionarPerfilPorTexto = (selector, texto, intentos = 10) => {\n   392→                    if (!texto || intentos <= 0) return;\n   393→                    const $select = $(selector);\n   394→                    if ($select.length === 0) return;\n   395→                    const opcion = $select.find('option').filter(function() {\n   396→                        return ($(this).text() || '').trim().toLowerCase() === texto.trim().toLowerCase();\n   397→                    }).first();\n   398→                    if (opcion.length) {\n   399→                        const valor = opcion.val();\n   400→                        if (valor) {\n   401→                            $select.val(valor).trigger('change.select2');\n   402→                            return;\n   403→                        }\n   404→                    }\n   405→                    setTimeout(() => esperarYSeleccionarPerfilPorTexto(selector, texto, intentos - 1), 300);\n   406→                };\n   407→\n   408→                pruebas_generadas.forEach((prueba_generada) => {\n   409→                    // Buscar la prueba en el catálogo cargado en el modal por nombre\n   410→                    let prueba_catalogo = (pruebas_empresa_vacantes || []).find(p =>\n   411→                        (p.nombre || '').trim().toLowerCase() === (prueba_generada.nombre || '').trim().toLowerCase()\n   412→                    );\n   413→\n   414→                    if (!prueba_catalogo) {\n   415→                        return;\n   416→                    }\n   417→\n   418→                    // Marcar checkbox de la prueba encontrada\n   419→                    $(`.prueba-checkbox[value=\"${prueba_catalogo.id}\"]`).prop('checked', true).trigger('change');\n   420→\n   421→                    // Intentar resolver el perfil por nombre\n   422→                    const perfil_nombre_objetivo = (prueba_generada.perfil || '').trim();\n   423→                    let perfil_id = null;\n   424→                    if (perfil_nombre_objetivo) {\n   425→                        let perfil_catalogo = (prueba_catalogo.perfiles || []).find(perfil =>\n   426→                            (perfil.nombre || '').trim().toLowerCase() === perfil_nombre_objetivo.toLowerCase()\n   427→                        );\n   428→                        if (perfil_catalogo) {\n   429→                            perfil_id = perfil_catalogo.id;\n   430→                        }\n   431→                    }\n   432→\n   433→                    // Completar select y porcentaje\n   434→                    setTimeout(() => {\n   435→                        if (prueba_generada.porcentaje) {\n   436→                            $(`input[name=\"porcentaje_prueba_${prueba_catalogo.id}\"]`).val(prueba_generada.porcentaje).trigger('keyup');\n   437→                        }\n   438→                        const selectorPerfil = `select[name=\"perfil_id_${prueba_catalogo.id}\"]`;\n   439→                        // esperar a que cargarPerfilesPrueba (llamado al marcar) termine de poblar opciones\n   440→                        if (perfil_id) {\n   441→                            esperarYSeleccionarPerfil(selectorPerfil, perfil_id);\n   442→                        } else if (perfil_nombre_objetivo) {\n   443→                            esperarYSeleccionarPerfilPorTexto(selectorPerfil, perfil_nombre_objetivo);\n   444→                        }\n   445→                    }, 500);\n   446→                });\n   447→            }, error: function(error) {\n   448→                mostrarToast('danger', 'Ocurrió un error al generar las pruebas psicométricas, respuesta de la IA: ' + error.responseJSON.errors);\n   449→                $('#modal-generando-ia').modal('hide');\n   450→                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n   451→            }\n   452→        });\n   453→    } else {\n   454→        if (nombre_vacante.length < 5) {\n   455→            mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n   456→        } else if (habilidades.length == 0) {\n   457→            mostrarToast('warning', 'Debe seleccionar al menos una habilidad');\n   458→        } else if (herramientas_tecnologicas.length == 0) {\n   459→            mostrarToast('warning', 'Debe seleccionar al menos una herramienta tecnológica');\n   460→        } else if (!experiencia_laboral) {\n   461→            mostrarToast('warning', 'Debe seleccionar la experiencia laboral');\n   462→        } else if (!nivel_educativo) {\n   463→            mostrarToast('warning', 'Debe seleccionar el nivel educativo');\n   464→        }\n   465→    }\n   466→}\n   467→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"529c3f32-0802-4a22-b236-e623181dbf56","timestamp":"2026-01-13T21:03:56.330Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\vacantes-ia.js","content":"var preguntas_generadas = [];\n\n/**\n * Generar vacante con IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction generarVacanteIA() {\n    let descripcion_vacante_ia = $('#descripcion_vacante_ia').val().trim();\n    if (descripcion_vacante_ia.length >= 5) {\n        $('#modal-vacante-ia').modal('hide');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            type: 'POST',\n            url : '/generar-vacante',\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                descripcion: descripcion_vacante_ia,\n            },\n            success: function(respuesta) {\n                let vacante_ia = respuesta.data;\n                // Llenar el nombre de la vacante\n                if (vacante_ia.nombre_vacante) {\n                    $('#nombre_vacante').val(vacante_ia.nombre_vacante);\n                }\n                if (vacante_ia.salario.fijo) {\n                    $('#salario_especifico').prop('checked', true).trigger('change');\n                    $('#salario_cantidad').val(numeroCleave(vacante_ia.salario.fijo));\n                } else {\n                    $('#salario_a_convenir').prop('checked', true).trigger('change');\n                    $('#salario_desde').val(numeroCleave(vacante_ia.salario.minimo));\n                    $('#salario_hasta').val(numeroCleave(vacante_ia.salario.maximo));\n                }\n                $('#habilidades').val([]);\n                let habilidades = vacante_ia.habilidades.map(item => item.trim());\n                for (let i = 0; i < habilidades.length; i++) {\n                    if (habilidades[i]) {\n                        $('#habilidades').append(new Option(habilidades[i], habilidades[i], false, true));\n                    }\n                }\n                $('#herramientas_tecnologicas').val([]);\n                let herramientas_tecnologicas = vacante_ia.herramientas_tecnologicas.map(item => item.trim());\n                for (let i = 0; i < herramientas_tecnologicas.length; i++) {\n                    if (herramientas_tecnologicas[i]) {\n                        $('#herramientas_tecnologicas').append(new Option(herramientas_tecnologicas[i], herramientas_tecnologicas[i], false, true));\n                    }\n                }\n                $('#experiencia_laboral').val(vacante_ia.experiencia_laboral).trigger('change.select2');\n                $('#nivel_educativo_vacante').val(vacante_ia.nivel_educativo).trigger('change.select2');\n\n                $('#idiomas_seleccionados').val([]);\n                $('#idiomas_seleccionados').multiselect(\"refresh\");\n                $('#contenedor-idiomas').empty();\n\n                if (vacante_ia.idiomas && vacante_ia.idiomas.length > 0) {\n                    let ids_idiomas = vacante_ia.idiomas.map(function(item) {\n                        let idioma = idiomas.find(function(idioma) {\n                            return idioma.nombre === item.idioma;\n                        });\n                        return idioma.id;\n                    });\n\n                    $('#idiomas_seleccionados').val(ids_idiomas);\n                    $('#idiomas_seleccionados').multiselect(\"refresh\");\n                    $('#idiomas_seleccionados').trigger('change');\n\n                    $.each(ids_idiomas, function(index, id_idioma) {\n                        $(`#nivel_idioma_${id_idioma}`).val(vacante_ia.idiomas[index].nivel).trigger('change.select2');\n                    });\n                }\n                let modalidad_trabajo = modalidades_trabajos.find(item => item.nombre.toLowerCase() === vacante_ia.modalidad_trabajo.toLowerCase());\n                if (modalidad_trabajo) {\n                    $(`#modalidad_trabajo_id_${modalidad_trabajo.id}`).prop('checked', true).trigger('change');\n                }\n                $('#funciones').val(vacante_ia.funciones || '').trigger('input');\n                $('#modal-generando-ia').modal('hide');\n                mostrarToast('success', 'Información generada exitosamente');\n            }, error: function(error) {\n                $('#modal-generando-ia').modal('hide');\n                mostrarToast('danger', 'Ocurrió un error al generar la vacante, respuesta de la IA: ' + error.responseJSON.errors);\n            }\n        });\n    } else {\n        mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n    }\n}\n\n/**\n * Generar preguntas de prefiltro con IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales\n */\nfunction generarPreguntasPrefiltroIA() {\n    let nombre_vacante = $('#nombre_vacante').val().trim();\n    let habilidades = $('#habilidades').val() || [];\n    let herramientas_tecnologicas = $('#herramientas_tecnologicas').val() || [];\n    let experiencia_laboral = $('#experiencia_laboral').val();\n    let nivel_educativo = $('#nivel_educativo_vacante').val();\n    let vacante_id = $('#formulario-vacantes-paso-1 #id').val() || $('#formulario-vacantes-paso-2 #id').val() || $('#id').val() || null;\n    if (nombre_vacante.length >= 5 && habilidades.length > 0 && herramientas_tecnologicas.length > 0 && experiencia_laboral && nivel_educativo) {\n        $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).addClass('d-none');\n        $('#modal-generando-ia').modal('show');\n        let url_ia = '/generar-preguntas-prefiltro';\n        let tipo_preguntas = ['abierta', 'seleccion_unica', 'seleccion_multiple'];\n        if (modal_movimiento_id_seleccionado == 10) {\n            url_ia = '/generar-preguntas-videoentrevista';\n            tipo_preguntas = ['abierta'];\n        }\n        $.ajax({\n            type: 'POST',\n            url : url_ia,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: vacante_id,\n                nombre_vacante: nombre_vacante,\n                habilidades: habilidades,\n                herramientas_tecnologicas: herramientas_tecnologicas,\n                experiencia_laboral: experiencia_laboral,\n                nivel_educativo: nivel_educativo,\n                numero_preguntas: 5,\n                tipo_preguntas: tipo_preguntas\n            },\n            success: function(respuesta) {\n                $(`#contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`).html('');\n\n                if (modal_movimiento_id_seleccionado == 4) {\n                    contador_preguntas_prefiltro = 0;\n                } else if (modal_movimiento_id_seleccionado == 10) {\n                    contador_preguntas_video_entrevista = 0;\n                }\n                contador_respuestas = 0;\n\n                // Contar cuántas preguntas abiertas se generarán\n                var limite_preguntas_abiertas = 2;\n                var contador_preguntas_abiertas_generadas = 0;\n\n                respuesta.data.preguntas.forEach((pregunta) => {\n                    // Validar límite de preguntas abiertas para prefiltro\n                    if (modal_movimiento_id_seleccionado == 4 && pregunta.tipo === 'abierta') {\n                        contador_preguntas_abiertas_generadas++;\n                        if (contador_preguntas_abiertas_generadas > limite_preguntas_abiertas) {\n                            return; // Saltar esta pregunta si excede el límite\n                        }\n                    }\n                    preguntas_generadas.push(pregunta.texto);\n\n                    let contador_actual = modal_movimiento_id_seleccionado == 4\n                        ? contador_preguntas_prefiltro\n                        : contador_preguntas_video_entrevista;\n\n                    if (pregunta.tipo === 'abierta') {\n                        agregarPregunta('abierta', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, null, true);\n\n                        contador_actual = modal_movimiento_id_seleccionado == 4\n                            ? contador_preguntas_prefiltro\n                            : contador_preguntas_video_entrevista;\n\n                        $(`#pregunta_abierta_${contador_actual}`).val(pregunta.texto);\n                        if (pregunta.tiempo_segundos) {\n                            $(`#tiempo_respuesta_${contador_actual}`).val(pregunta.tiempo_segundos / 60);\n                        }\n                    } else {\n                        if (pregunta.tipo === 'seleccion_unica') {\n                            agregarPregunta('única', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, null, true);\n                        } else {\n                            agregarPregunta('múltiple', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, null, true);\n                        }\n\n                        contador_actual = modal_movimiento_id_seleccionado == 4\n                            ? contador_preguntas_prefiltro\n                            : contador_preguntas_video_entrevista;\n\n                        $(`#pregunta_seleccion_unica_${contador_actual}`).val(pregunta.texto);\n                        pregunta.opciones.forEach((opcion) => {\n                            let checked = false;\n                            if (pregunta.respuestas_correctas.find((item) => item === opcion)) {\n                                checked = true;\n                            }\n                            if (pregunta.tipo === 'seleccion_unica') {\n                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_actual}`), 'única', checked);\n                            } else {\n                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_actual}`), 'múltiple', checked);\n                            }\n                            $(`#contenedor-respuestas-${contador_actual} #respuesta_${contador_respuestas}`).val(opcion);\n                        });\n                    }\n                });\n\n                $('#modal-generando-ia').modal('hide');\n                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n\n                // Mostrar alerta si se omitieron preguntas abiertas por el límite\n                if (modal_movimiento_id_seleccionado == 4 && contador_preguntas_abiertas_generadas > limite_preguntas_abiertas) {\n                    var preguntas_omitidas = contador_preguntas_abiertas_generadas - limite_preguntas_abiertas;\n                    mostrarToast('info', `Se generaron solo ${limite_preguntas_abiertas} preguntas abiertas debido al límite establecido. ${preguntas_omitidas} pregunta(s) abierta(s) fueron omitidas.`);\n                }\n            }, error: function(error) {\n                mostrarToast('danger', 'Ocurrió un error al generar las preguntas, respuesta de la IA: ' + error.responseJSON.errors);\n                $('#modal-generando-ia').modal('hide');\n                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n            }\n        });\n    } else {\n        if (nombre_vacante.length < 5) {\n            mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n        } else if (habilidades.length == 0) {\n            mostrarToast('warning', 'Debe seleccionar al menos una habilidad');\n        } else if (herramientas_tecnologicas.length == 0) {\n            mostrarToast('warning', 'Debe seleccionar al menos una herramienta tecnológica');\n        } else if (!experiencia_laboral) {\n            mostrarToast('warning', 'Debe seleccionar la experiencia laboral');\n        } else if (!nivel_educativo) {\n            mostrarToast('warning', 'Debe seleccionar el nivel educativo');\n        }\n    }\n    calcularPuntuacionTotal(`contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`);\n}\n\n/**\n * Generar una pregunta de prefiltro con IA.\n *\n * @param {number} contador_pregunta Número de la pregunta a generar\n * @param {string|null} tipo_pregunta Tipo de pregunta a generar (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales\n */\nfunction generarUnaPreguntaPrefiltroIA(contador_pregunta, tipo_pregunta = null) {\n    let nombre_vacante = $('#nombre_vacante').val().trim();\n    let habilidades = $('#habilidades').val() || [];\n    let herramientas_tecnologicas = $('#herramientas_tecnologicas').val() || [];\n    let experiencia_laboral = $('#experiencia_laboral').val();\n    let nivel_educativo = $('#nivel_educativo_vacante').val();\n    let vacante_id = $('#formulario-vacantes-paso-1 #id').val() || $('#formulario-vacantes-paso-2 #id').val() || $('#id').val() || null;\n\n    // Validar límite de preguntas abiertas antes de generar con IA\n    if (modal_movimiento_id_seleccionado == 4 && tipo_pregunta === 'abierta') {\n        var limite_preguntas_abiertas = 2;\n        var cantidad_abiertas_actuales = contarPreguntasAbiertas();\n\n        if (cantidad_abiertas_actuales >= limite_preguntas_abiertas) {\n            mostrarAlertaLimitePreguntasAbiertas();\n            return;\n        }\n    }\n\n    if (nombre_vacante.length >= 5 && habilidades.length > 0 && herramientas_tecnologicas.length > 0 && experiencia_laboral && nivel_educativo) {\n        $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).addClass('d-none');\n        $('#modal-generando-ia').modal('show');\n        let url_ia = '/generar-preguntas-prefiltro';\n        let tipo_preguntas = ['abierta', 'seleccion_unica', 'seleccion_multiple'];\n        if (modal_movimiento_id_seleccionado == 10) {\n            url_ia = '/generar-preguntas-videoentrevista';\n            tipo_preguntas = ['abierta'];\n        }\n        if (tipo_pregunta) {\n            tipo_preguntas = [tipo_pregunta];\n        }\n\n        let datos = {\n            _token                   : $('input[name=\"_token\"]').val(),\n            vacante_id               : vacante_id,\n            nombre_vacante           : nombre_vacante,\n            habilidades              : habilidades,\n            herramientas_tecnologicas: herramientas_tecnologicas,\n            experiencia_laboral      : experiencia_laboral,\n            nivel_educativo          : nivel_educativo,\n            numero_preguntas         : 1,\n            tipo_preguntas           : tipo_preguntas\n        };\n\n        if (preguntas_generadas.length > 0) {\n            datos.preguntas_existentes = JSON.stringify(preguntas_generadas);\n        }\n\n        $.ajax({\n            type: 'POST',\n            url : url_ia,\n            data: datos,\n            success: function(respuesta) {\n                $(`#pregunta-${contador_pregunta}`).empty();\n\n                respuesta.data.preguntas.forEach((pregunta) => {\n                    preguntas_generadas.push(pregunta.texto);\n\n                    if (pregunta.tipo === 'abierta') {\n                        agregarPregunta('abierta', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, contador_pregunta, true);\n                        $(`#pregunta_abierta_${contador_pregunta}`).val(pregunta.texto);\n                        if (pregunta.tiempo_segundos) {\n                            $(`#tiempo_respuesta_${contador_pregunta}`).val(pregunta.tiempo_segundos / 60);\n                        }\n                    } else {\n                        if (pregunta.tipo === 'seleccion_unica') {\n                            agregarPregunta('única', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, contador_pregunta, true);\n                        } else {\n                            agregarPregunta('múltiple', `contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`, contador_pregunta, true);\n                        }\n                        $(`#pregunta_seleccion_unica_${contador_pregunta}`).val(pregunta.texto);\n                        pregunta.opciones.forEach((opcion) => {\n                            let checked = false;\n                            if (pregunta.respuestas_correctas.find((item) => item === opcion)) {\n                                checked = true;\n                            }\n                            if (pregunta.tipo === 'seleccion_unica') {\n                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_pregunta}`), 'única', checked);\n                            } else {\n                                agregarRespuestaPregunta($(`#agregar_respuesta_${contador_pregunta}`), 'múltiple', checked);\n                            }\n                            $(`#contenedor-respuestas-${contador_pregunta} #respuesta_${contador_respuestas}`).val(opcion);\n                        });\n                    }\n                });\n                $('#modal-generando-ia').modal('hide');\n                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n            }, error: function(error) {\n                mostrarToast('danger', 'Ocurrió un error al generar las preguntas, respuesta de la IA: ' + error.responseJSON.errors);\n                $('#modal-generando-ia').modal('hide');\n                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n            }\n        });\n    } else {\n        if (nombre_vacante.length < 5) {\n            mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n        } else if (habilidades.length == 0) {\n            mostrarToast('warning', 'Debe seleccionar al menos una habilidad');\n        } else if (herramientas_tecnologicas.length == 0) {\n            mostrarToast('warning', 'Debe seleccionar al menos una herramienta tecnológica');\n        } else if (!experiencia_laboral) {\n            mostrarToast('warning', 'Debe seleccionar la experiencia laboral');\n        } else if (!nivel_educativo) {\n            mostrarToast('warning', 'Debe seleccionar el nivel educativo');\n        }\n    }\n    calcularPuntuacionTotal(`contenedor-preguntas-movimiento-${modal_movimiento_id_seleccionado}`);\n}\n\n/**\n * Generar pruebas psicométricas con IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction generarPruebasPsicometricasIA() {\n    let nombre_vacante = $('#nombre_vacante').val().trim();\n    let habilidades = $('#habilidades').val() || [];\n    let herramientas_tecnologicas = $('#herramientas_tecnologicas').val() || [];\n    let experiencia_laboral = $('#experiencia_laboral').val();\n    let nivel_educativo = $('#nivel_educativo_vacante').val();\n    let vacante_id = $('#formulario-vacantes-paso-1 #id').val() || $('#formulario-vacantes-paso-2 #id').val() || $('#id').val() || null;\n    if (nombre_vacante.length >= 5 && habilidades.length > 0 && herramientas_tecnologicas.length > 0 && experiencia_laboral && nivel_educativo) {\n        $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).addClass('d-none');\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            type: 'POST',\n            url : '/generar-pruebas-psicometricas',\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: vacante_id,\n                nombre_vacante: nombre_vacante,\n                habilidades: habilidades,\n                herramientas_tecnologicas: herramientas_tecnologicas,\n                experiencia_laboral: experiencia_laboral,\n                nivel_educativo: nivel_educativo\n            },\n            success: function(respuesta) {\n                $('#modal-generando-ia').modal('hide');\n                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n                // Limpiar selección previa\n                $('.prueba-checkbox').prop('checked', false).trigger('change');\n\n                let pruebas_generadas = respuesta.data.pruebas || [];\n\n                // Helpers para seleccionar perfil cuando el select se llene\n                const esperarYSeleccionarPerfil = (selector, valor, intentos = 10) => {\n                    if (!valor || intentos <= 0) return;\n                    const $select = $(selector);\n                    if ($select.length === 0) return;\n                    if ($select.find(`option[value=\"${valor}\"]`).length > 0) {\n                        $select.val(valor).trigger('change.select2');\n                        return;\n                    }\n                    setTimeout(() => esperarYSeleccionarPerfil(selector, valor, intentos - 1), 300);\n                };\n                const esperarYSeleccionarPerfilPorTexto = (selector, texto, intentos = 10) => {\n                    if (!texto || intentos <= 0) return;\n                    const $select = $(selector);\n                    if ($select.length === 0) return;\n                    const opcion = $select.find('option').filter(function() {\n                        return ($(this).text() || '').trim().toLowerCase() === texto.trim().toLowerCase();\n                    }).first();\n                    if (opcion.length) {\n                        const valor = opcion.val();\n                        if (valor) {\n                            $select.val(valor).trigger('change.select2');\n                            return;\n                        }\n                    }\n                    setTimeout(() => esperarYSeleccionarPerfilPorTexto(selector, texto, intentos - 1), 300);\n                };\n\n                pruebas_generadas.forEach((prueba_generada) => {\n                    // Buscar la prueba en el catálogo cargado en el modal por nombre\n                    let prueba_catalogo = (pruebas_empresa_vacantes || []).find(p =>\n                        (p.nombre || '').trim().toLowerCase() === (prueba_generada.nombre || '').trim().toLowerCase()\n                    );\n\n                    if (!prueba_catalogo) {\n                        return;\n                    }\n\n                    // Marcar checkbox de la prueba encontrada\n                    $(`.prueba-checkbox[value=\"${prueba_catalogo.id}\"]`).prop('checked', true).trigger('change');\n\n                    // Intentar resolver el perfil por nombre\n                    const perfil_nombre_objetivo = (prueba_generada.perfil || '').trim();\n                    let perfil_id = null;\n                    if (perfil_nombre_objetivo) {\n                        let perfil_catalogo = (prueba_catalogo.perfiles || []).find(perfil =>\n                            (perfil.nombre || '').trim().toLowerCase() === perfil_nombre_objetivo.toLowerCase()\n                        );\n                        if (perfil_catalogo) {\n                            perfil_id = perfil_catalogo.id;\n                        }\n                    }\n\n                    // Completar select y porcentaje\n                    setTimeout(() => {\n                        if (prueba_generada.porcentaje) {\n                            $(`input[name=\"porcentaje_prueba_${prueba_catalogo.id}\"]`).val(prueba_generada.porcentaje).trigger('keyup');\n                        }\n                        const selectorPerfil = `select[name=\"perfil_id_${prueba_catalogo.id}\"]`;\n                        // esperar a que cargarPerfilesPrueba (llamado al marcar) termine de poblar opciones\n                        if (perfil_id) {\n                            esperarYSeleccionarPerfil(selectorPerfil, perfil_id);\n                        } else if (perfil_nombre_objetivo) {\n                            esperarYSeleccionarPerfilPorTexto(selectorPerfil, perfil_nombre_objetivo);\n                        }\n                    }, 500);\n                });\n            }, error: function(error) {\n                mostrarToast('danger', 'Ocurrió un error al generar las pruebas psicométricas, respuesta de la IA: ' + error.responseJSON.errors);\n                $('#modal-generando-ia').modal('hide');\n                $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).removeClass('d-none');\n            }\n        });\n    } else {\n        if (nombre_vacante.length < 5) {\n            mostrarToast('warning', 'La descripción debe tener al menos 5 caracteres');\n        } else if (habilidades.length == 0) {\n            mostrarToast('warning', 'Debe seleccionar al menos una habilidad');\n        } else if (herramientas_tecnologicas.length == 0) {\n            mostrarToast('warning', 'Debe seleccionar al menos una herramienta tecnológica');\n        } else if (!experiencia_laboral) {\n            mostrarToast('warning', 'Debe seleccionar la experiencia laboral');\n        } else if (!nivel_educativo) {\n            mostrarToast('warning', 'Debe seleccionar el nivel educativo');\n        }\n    }\n}\n","numLines":467,"startLine":1,"totalLines":467}},"sourceToolAssistantUUID":"749d522a-a867-4755-9b07-bab293f32c98"}
{"parentUuid":"529c3f32-0802-4a22-b236-e623181dbf56","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01ThEDcjzV9PStRBzGngiWR2","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a leer algunos archivos de las vistas Blade incluidas para completar el análisis:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":18810,"cache_read_input_tokens":76811,"cache_creation":{"ephemeral_5m_input_tokens":18810,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX649P31hhFPEd6KqD2tw","type":"assistant","uuid":"6c47572f-1b70-4ca7-ae28-86d370639930","timestamp":"2026-01-13T21:04:00.712Z"}
{"parentUuid":"6c47572f-1b70-4ca7-ae28-86d370639930","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01ThEDcjzV9PStRBzGngiWR2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019t9BN2LYXus79huW2BFtWT","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\formulario-informacion.blade.php","limit":150}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":18810,"cache_read_input_tokens":76811,"cache_creation":{"ephemeral_5m_input_tokens":18810,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX649P31hhFPEd6KqD2tw","type":"assistant","uuid":"b272e026-f505-4e3e-a4d7-567028ace0ea","timestamp":"2026-01-13T21:04:02.557Z"}
{"parentUuid":"b272e026-f505-4e3e-a4d7-567028ace0ea","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01ThEDcjzV9PStRBzGngiWR2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Dp5wLVB8oAyTvLFP5wrbio","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\formulario-etapas.blade.php","limit":150}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":18810,"cache_read_input_tokens":76811,"cache_creation":{"ephemeral_5m_input_tokens":18810,"ephemeral_1h_input_tokens":0},"output_tokens":223,"service_tier":"standard"}},"requestId":"req_011CX649P31hhFPEd6KqD2tw","type":"assistant","uuid":"5c9bad29-d01b-40c9-b620-f6dce57f2f24","timestamp":"2026-01-13T21:04:03.268Z"}
{"parentUuid":"b272e026-f505-4e3e-a4d7-567028ace0ea","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019t9BN2LYXus79huW2BFtWT","type":"tool_result","content":"     1→<div class=\"col-12 px-xl-5\">\n     2→    <form id=\"formulario-vacantes-paso-1\" class=\"formularios-pasos\" action=\"/vacantes\" data-activar-siguiente=\"true\">\n     3→        @csrf\n     4→        <input type=\"hidden\" id=\"id\" name=\"id\" value=\"{{ isset($vacante) ? $vacante->id : '' }}\">\n     5→        <input type=\"hidden\" id=\"estado_id\" name=\"estado_id\" value=\"4\">\n     6→        <input type=\"hidden\" id=\"informacion\" name=\"informacion\" value=\"\">\n     7→        <input type=\"hidden\" id=\"requisitos\" name=\"requisitos\" value=\"\">\n     8→        <input type=\"hidden\" id=\"automatizar_etapas\" name=\"automatizar_etapas\" value=\"\">\n     9→        <div class=\"row mt-5 mb-4\">\n    10→            <div class=\"col-12\">\n    11→                <div class=\"d-flex justify-content-between align-items-center\">\n    12→                    <div class=\"col-auto mb-1 fw-semibold text-dark text-headline-5\">Información de la vacante</div>\n    13→                    <div class=\"col-auto\">\n    14→                        ${crearBoton({\n    15→                            clases: 'btn-yellow-ia',\n    16→                            texto: '<img class=\"me-3\" src=\"{{ asset('/iconos/icono_ia.svg') }}\"> Generar mediante IA',\n    17→                            adicional: `data-bs-toggle=\"modal\" data-bs-target=\"#modal-vacante-ia\"`\n    18→                        })}\n    19→                    </div>\n    20→                </div>\n    21→                <p class=\"my-3 text-body-3 text-gray-30\">Esta vacante es para un proceso interno, por lo que únicamente se solicita información básica.</p>\n    22→            </div>\n    23→        </div>\n    24→        <div class=\"row\">\n    25→            <div class=\"col-12 col-md-6\">\n    26→                ${crearInput({\n    27→                    id: 'nombre_vacante',\n    28→                    name: 'nombre_vacante',\n    29→                    type: 'text',\n    30→                    label: 'Nombre de la vacante',\n    31→                    placeholder: '',\n    32→                    required: true,\n    33→                    maxlength: 120,\n    34→                    value: '{{ isset($vacante) ? $vacante->nombre_vacante : \"\" }}'\n    35→                })}\n    36→            </div>\n    37→            <div class=\"col-12 col-md-6\">\n    38→                ${crearInput({\n    39→                    id: 'cantidad_vacantes',\n    40→                    name: 'cantidad_vacantes',\n    41→                    type: 'number',\n    42→                    label: 'Cantidad de vacantes',\n    43→                    placeholder: '',\n    44→                    required: true,\n    45→                    min: 1,\n    46→                    max: 10000,\n    47→                    value: '{{ isset($vacante) ? $vacante->cantidad_vacantes : \"\" }}'\n    48→                })}\n    49→            </div>\n    50→        </div>\n    51→        <div class=\"row\">\n    52→            <div class=\"col-12 mb-3 fw-semibold text-headline-5\">Funciones y responsabilidades</div>\n    53→            <div class=\"col-12 mb-2\">\n    54→                ${crearTextarea({\n    55→                    id: 'funciones',\n    56→                    name: 'funciones',\n    57→                    class: 'input-dinamico',\n    58→                    placeholder: '',\n    59→                    disabled: false,\n    60→                    required: true,\n    61→                    label: 'Describe funciones y responsabilidades',\n    62→                    contador: 500,\n    63→                })}\n    64→            </div>\n    65→        </div>\n    66→        <div class=\"row mt-5\">\n    67→            <div class=\"col-12\">\n    68→                <div class=\"card shadow-sm\">\n    69→                    <div class=\"card-body\">\n    70→                        <div class=\"text-headline-6 text-gray-10 fw-semibold\">Modalidad de trabajo</div>\n    71→                        <div class=\"row mt-2\">\n    72→                            @foreach ($modalidades_trabajos as $item)\n    73→                                <div class=\"col-auto\">\n    74→                                    ${crearRadioButton({\n    75→                                        id: 'modalidad_trabajo_id_{{ $item->id }}',\n    76→                                        name: 'modalidad_trabajo_id',\n    77→                                        value: '{{ $item->id }}',\n    78→                                        label: '{{ $item->nombre }}',\n    79→                                        @if (isset($vacante))\n    80→                                            @if ($vacante->modalidad_trabajo_id == $item->id)\n    81→                                                checked: true,\n    82→                                            @endif\n    83→                                        @else\n    84→                                            @if ($item->id == 1)\n    85→                                                checked: true,\n    86→                                            @endif\n    87→                                        @endif\n    88→                                    })}\n    89→                                </div>\n    90→                            @endforeach\n    91→                        </div>\n    92→                    </div>\n    93→                </div>\n    94→            </div>\n    95→        </div>\n    96→        <div class=\"row mt-5\">\n    97→            <div class=\"col-12\">\n    98→                <div class=\"card shadow-sm\">\n    99→                    <div class=\"card-body\">\n   100→                        <div class=\"row\">\n   101→                            <div class=\"col-12\">\n   102→                                <label class=\"form-label fw-semibold text-gray-10\">Lugar de trabajo</label>\n   103→                            </div>\n   104→                            <div class=\"col-auto\">\n   105→                                ${crearRadioButton({\n   106→                                    id: 'lugar_trabajo_actual',\n   107→                                    name: 'lugar_trabajo',\n   108→                                    value: 'actual',\n   109→                                    label: 'Actual de la empresa',\n   110→                                    checked: true,\n   111→                                })}\n   112→                            </div>\n   113→                            <div class=\"col-auto\">\n   114→                                ${crearRadioButton({\n   115→                                    id: 'lugar_trabajo_otro',\n   116→                                    name: 'lugar_trabajo',\n   117→                                    value: 'otro',\n   118→                                    label: 'Otro',\n   119→                                })}\n   120→                            </div>\n   121→                        </div>\n   122→                        <div class=\"d-none\" id=\"contenedor_ubicacion_personalizada\">\n   123→                            <div class=\"row mt-3\">\n   124→                                <div class=\"col-12 col-md-6\">\n   125→                                ${crearSelect2({\n   126→                                    id: 'pais_id',\n   127→                                    name: 'pais_id',\n   128→                                    class: 'pais_id',\n   129→                                    label: 'País',\n   130→                                    opciones: [],\n   131→                                    required: true,\n   132→                                    adicional: 'data-html_departamento_id=\"departamento_id\" data-html_ciudad_id=\"ciudad_id\"'\n   133→                                })}\n   134→                            </div>\n   135→                            <div class=\"col-12 col-md-6\">\n   136→                                    ${crearSelect2({\n   137→                                    id: 'departamento_id',\n   138→                                    name: 'departamento_id',\n   139→                                    class: 'departamento_id',\n   140→                                    label: 'Departamento',\n   141→                                    opciones: [],\n   142→                                    required: true,\n   143→                                    adicional: 'data-html_pais_id=\"pais_id\" data-html_ciudad_id=\"ciudad_id\"'\n   144→                                })}\n   145→                            </div>\n   146→                        </div>\n   147→                            <div class=\"row\">\n   148→                                <div class=\"col-12 col-md-6\">\n   149→                                    ${crearSelect2({\n   150→                                    id: 'ciudad_id',\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"9ace518c-5668-4363-a38b-9cd2f26f9fb8","timestamp":"2026-01-13T21:04:05.136Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\formulario-informacion.blade.php","content":"<div class=\"col-12 px-xl-5\">\n    <form id=\"formulario-vacantes-paso-1\" class=\"formularios-pasos\" action=\"/vacantes\" data-activar-siguiente=\"true\">\n        @csrf\n        <input type=\"hidden\" id=\"id\" name=\"id\" value=\"{{ isset($vacante) ? $vacante->id : '' }}\">\n        <input type=\"hidden\" id=\"estado_id\" name=\"estado_id\" value=\"4\">\n        <input type=\"hidden\" id=\"informacion\" name=\"informacion\" value=\"\">\n        <input type=\"hidden\" id=\"requisitos\" name=\"requisitos\" value=\"\">\n        <input type=\"hidden\" id=\"automatizar_etapas\" name=\"automatizar_etapas\" value=\"\">\n        <div class=\"row mt-5 mb-4\">\n            <div class=\"col-12\">\n                <div class=\"d-flex justify-content-between align-items-center\">\n                    <div class=\"col-auto mb-1 fw-semibold text-dark text-headline-5\">Información de la vacante</div>\n                    <div class=\"col-auto\">\n                        ${crearBoton({\n                            clases: 'btn-yellow-ia',\n                            texto: '<img class=\"me-3\" src=\"{{ asset('/iconos/icono_ia.svg') }}\"> Generar mediante IA',\n                            adicional: `data-bs-toggle=\"modal\" data-bs-target=\"#modal-vacante-ia\"`\n                        })}\n                    </div>\n                </div>\n                <p class=\"my-3 text-body-3 text-gray-30\">Esta vacante es para un proceso interno, por lo que únicamente se solicita información básica.</p>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"col-12 col-md-6\">\n                ${crearInput({\n                    id: 'nombre_vacante',\n                    name: 'nombre_vacante',\n                    type: 'text',\n                    label: 'Nombre de la vacante',\n                    placeholder: '',\n                    required: true,\n                    maxlength: 120,\n                    value: '{{ isset($vacante) ? $vacante->nombre_vacante : \"\" }}'\n                })}\n            </div>\n            <div class=\"col-12 col-md-6\">\n                ${crearInput({\n                    id: 'cantidad_vacantes',\n                    name: 'cantidad_vacantes',\n                    type: 'number',\n                    label: 'Cantidad de vacantes',\n                    placeholder: '',\n                    required: true,\n                    min: 1,\n                    max: 10000,\n                    value: '{{ isset($vacante) ? $vacante->cantidad_vacantes : \"\" }}'\n                })}\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"col-12 mb-3 fw-semibold text-headline-5\">Funciones y responsabilidades</div>\n            <div class=\"col-12 mb-2\">\n                ${crearTextarea({\n                    id: 'funciones',\n                    name: 'funciones',\n                    class: 'input-dinamico',\n                    placeholder: '',\n                    disabled: false,\n                    required: true,\n                    label: 'Describe funciones y responsabilidades',\n                    contador: 500,\n                })}\n            </div>\n        </div>\n        <div class=\"row mt-5\">\n            <div class=\"col-12\">\n                <div class=\"card shadow-sm\">\n                    <div class=\"card-body\">\n                        <div class=\"text-headline-6 text-gray-10 fw-semibold\">Modalidad de trabajo</div>\n                        <div class=\"row mt-2\">\n                            @foreach ($modalidades_trabajos as $item)\n                                <div class=\"col-auto\">\n                                    ${crearRadioButton({\n                                        id: 'modalidad_trabajo_id_{{ $item->id }}',\n                                        name: 'modalidad_trabajo_id',\n                                        value: '{{ $item->id }}',\n                                        label: '{{ $item->nombre }}',\n                                        @if (isset($vacante))\n                                            @if ($vacante->modalidad_trabajo_id == $item->id)\n                                                checked: true,\n                                            @endif\n                                        @else\n                                            @if ($item->id == 1)\n                                                checked: true,\n                                            @endif\n                                        @endif\n                                    })}\n                                </div>\n                            @endforeach\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"row mt-5\">\n            <div class=\"col-12\">\n                <div class=\"card shadow-sm\">\n                    <div class=\"card-body\">\n                        <div class=\"row\">\n                            <div class=\"col-12\">\n                                <label class=\"form-label fw-semibold text-gray-10\">Lugar de trabajo</label>\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearRadioButton({\n                                    id: 'lugar_trabajo_actual',\n                                    name: 'lugar_trabajo',\n                                    value: 'actual',\n                                    label: 'Actual de la empresa',\n                                    checked: true,\n                                })}\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearRadioButton({\n                                    id: 'lugar_trabajo_otro',\n                                    name: 'lugar_trabajo',\n                                    value: 'otro',\n                                    label: 'Otro',\n                                })}\n                            </div>\n                        </div>\n                        <div class=\"d-none\" id=\"contenedor_ubicacion_personalizada\">\n                            <div class=\"row mt-3\">\n                                <div class=\"col-12 col-md-6\">\n                                ${crearSelect2({\n                                    id: 'pais_id',\n                                    name: 'pais_id',\n                                    class: 'pais_id',\n                                    label: 'País',\n                                    opciones: [],\n                                    required: true,\n                                    adicional: 'data-html_departamento_id=\"departamento_id\" data-html_ciudad_id=\"ciudad_id\"'\n                                })}\n                            </div>\n                            <div class=\"col-12 col-md-6\">\n                                    ${crearSelect2({\n                                    id: 'departamento_id',\n                                    name: 'departamento_id',\n                                    class: 'departamento_id',\n                                    label: 'Departamento',\n                                    opciones: [],\n                                    required: true,\n                                    adicional: 'data-html_pais_id=\"pais_id\" data-html_ciudad_id=\"ciudad_id\"'\n                                })}\n                            </div>\n                        </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 col-md-6\">\n                                    ${crearSelect2({\n                                    id: 'ciudad_id',","numLines":150,"startLine":1,"totalLines":569}},"sourceToolAssistantUUID":"b272e026-f505-4e3e-a4d7-567028ace0ea"}
{"parentUuid":"5c9bad29-d01b-40c9-b620-f6dce57f2f24","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Dp5wLVB8oAyTvLFP5wrbio","type":"tool_result","content":"     1→<div class=\"col-12 px-xl-5\">\n     2→    <form id=\"formulario-vacantes-paso-2\" class=\"formularios-pasos\" method=\"POST\" action=\"/vacantes-completar\" data-activar-siguiente=\"false\">\n     3→        @csrf\n     4→        <input type=\"hidden\" id=\"id\" name=\"id\" value=\"{{ isset($vacante) ? $vacante->id : '' }}\">\n     5→        <div class=\"row\">\n     6→            <div class=\"col-12 mt-6 mb-4 text-gray-10 text-headline-5 fw-semibold\">Configuración de las etapas de la vacante</div>\n     7→            <div class=\"col-5\">\n     8→                ${crearSelect2({\n     9→                    opciones: [\n    10→                        {id: 'todas', nombre: 'Mostrar todas las etapas'},\n    11→                        {id: '1', nombre: 'Mostrar etapas activas'},\n    12→                        {id: '0', nombre: 'Mostrar etapas inactivas'},\n    13→                    ],\n    14→                    id: 'mostrar_etapas',\n    15→                    class: 'select2-filtro',\n    16→                    input_container_class: 'mb-0',\n    17→                    label: '',\n    18→                    value: 'todas',\n    19→                    disabled: false,\n    20→                    onchange: 'filtrarEtapasVacante(this.value)',\n    21→                })}\n    22→            </div>\n    23→            <div class=\"col-7\">\n    24→                <div class=\"row align-items-center mt-2\">\n    25→                    <div class=\"col text-end\">\n    26→                        <i class=\"bi bi-info-circle me-1\"\n    27→                            ${crearTooltip({\n    28→                                placement: `top`,\n    29→                                content: `Al activar esta opción, los candidatos avanzarán automáticamente a la siguiente etapa del proceso una vez cumplan los criterios establecidos.`,\n    30→                                toggle: `popover`,\n    31→                            })}\n    32→                        ></i> Activar automatización de etapas\n    33→                    </div>\n    34→                    <div class=\"col-auto ps-1\">\n    35→                        ${crearToggle({\n    36→                            id: 'campo_automatizar_etapas',\n    37→                            checked: {{ isset($vacante) && $vacante->automatizar_etapas == 1 ? 'true' : 'false' }},\n    38→                            onclick: 'automatizacionEtapas(this.checked)'\n    39→                        })}\n    40→                    </div>\n    41→                </div>\n    42→            </div>\n    43→            <div class=\"col-12 mt-5\">\n    44→                ${crearAlerta('info', 'Selecciona las etapas que forman parte de tu proceso de selección. Puedes personalizarlas y organizarlas arrastrándolas al orden que desees.')}\n    45→            </div>\n    46→            <div class=\"col-12 mt-5\" id=\"contenedor-vacantes-etapas\"></div>\n    47→            <div class=\"col-12 mt-5\">\n    48→                <div class=\"d-flex align-items-center justify-content-center gap-2\">\n    49→                    <span class=\"text-body-2 text-gray-30\">Tiempo aproximado que estarán los candidatos dentro del proceso:</span>\n    50→                    <span class=\"text-body-2 text-gray-10\" id=\"contador-dias-proceso\">\n    51→                        <span class=\"spinner-border spinner-border-sm\" role=\"status\"></span>\n    52→                    </span>\n    53→                    <span class=\"text-body-2 text-gray-30\">días</span>\n    54→                </div>\n    55→            </div>\n    56→        </div>\n    57→        <div class=\"row\">\n    58→            <div class=\"col-12\">\n    59→                <div class=\"d-flex justify-content-center gap-4 pt-5 mt-5 border-top\">\n    60→                    ${crearBoton({\n    61→                        id: 'btn_cancelar_etapa_2',\n    62→                        clases: 'btn-outline-primary no-visited px-14',\n    63→                        texto: `<span class=\"text-primary\">Cancelar</span>`,\n    64→                        url: '/vacantes',\n    65→                    })}\n    66→                    ${crearBoton({\n    67→                        id: 'btn_guardar_etapas',\n    68→                        clases: 'btn-primary px-10',\n    69→                        texto: '{{ !empty($vacante) ? \"Editar vacante\" : \"Crear vacante\" }}',\n    70→                        type: 'submit',\n    71→                    })}\n    72→                </div>\n    73→            </div>\n    74→        </div>\n    75→    </form>\n    76→</div>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7a6dea71-284b-42d5-9a1e-eccb08cea322","timestamp":"2026-01-13T21:04:06.685Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\formulario-etapas.blade.php","content":"<div class=\"col-12 px-xl-5\">\n    <form id=\"formulario-vacantes-paso-2\" class=\"formularios-pasos\" method=\"POST\" action=\"/vacantes-completar\" data-activar-siguiente=\"false\">\n        @csrf\n        <input type=\"hidden\" id=\"id\" name=\"id\" value=\"{{ isset($vacante) ? $vacante->id : '' }}\">\n        <div class=\"row\">\n            <div class=\"col-12 mt-6 mb-4 text-gray-10 text-headline-5 fw-semibold\">Configuración de las etapas de la vacante</div>\n            <div class=\"col-5\">\n                ${crearSelect2({\n                    opciones: [\n                        {id: 'todas', nombre: 'Mostrar todas las etapas'},\n                        {id: '1', nombre: 'Mostrar etapas activas'},\n                        {id: '0', nombre: 'Mostrar etapas inactivas'},\n                    ],\n                    id: 'mostrar_etapas',\n                    class: 'select2-filtro',\n                    input_container_class: 'mb-0',\n                    label: '',\n                    value: 'todas',\n                    disabled: false,\n                    onchange: 'filtrarEtapasVacante(this.value)',\n                })}\n            </div>\n            <div class=\"col-7\">\n                <div class=\"row align-items-center mt-2\">\n                    <div class=\"col text-end\">\n                        <i class=\"bi bi-info-circle me-1\"\n                            ${crearTooltip({\n                                placement: `top`,\n                                content: `Al activar esta opción, los candidatos avanzarán automáticamente a la siguiente etapa del proceso una vez cumplan los criterios establecidos.`,\n                                toggle: `popover`,\n                            })}\n                        ></i> Activar automatización de etapas\n                    </div>\n                    <div class=\"col-auto ps-1\">\n                        ${crearToggle({\n                            id: 'campo_automatizar_etapas',\n                            checked: {{ isset($vacante) && $vacante->automatizar_etapas == 1 ? 'true' : 'false' }},\n                            onclick: 'automatizacionEtapas(this.checked)'\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-5\">\n                ${crearAlerta('info', 'Selecciona las etapas que forman parte de tu proceso de selección. Puedes personalizarlas y organizarlas arrastrándolas al orden que desees.')}\n            </div>\n            <div class=\"col-12 mt-5\" id=\"contenedor-vacantes-etapas\"></div>\n            <div class=\"col-12 mt-5\">\n                <div class=\"d-flex align-items-center justify-content-center gap-2\">\n                    <span class=\"text-body-2 text-gray-30\">Tiempo aproximado que estarán los candidatos dentro del proceso:</span>\n                    <span class=\"text-body-2 text-gray-10\" id=\"contador-dias-proceso\">\n                        <span class=\"spinner-border spinner-border-sm\" role=\"status\"></span>\n                    </span>\n                    <span class=\"text-body-2 text-gray-30\">días</span>\n                </div>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"col-12\">\n                <div class=\"d-flex justify-content-center gap-4 pt-5 mt-5 border-top\">\n                    ${crearBoton({\n                        id: 'btn_cancelar_etapa_2',\n                        clases: 'btn-outline-primary no-visited px-14',\n                        texto: `<span class=\"text-primary\">Cancelar</span>`,\n                        url: '/vacantes',\n                    })}\n                    ${crearBoton({\n                        id: 'btn_guardar_etapas',\n                        clases: 'btn-primary px-10',\n                        texto: '{{ !empty($vacante) ? \"Editar vacante\" : \"Crear vacante\" }}',\n                        type: 'submit',\n                    })}\n                </div>\n            </div>\n        </div>\n    </form>\n</div>","numLines":76,"startLine":1,"totalLines":76}},"sourceToolAssistantUUID":"5c9bad29-d01b-40c9-b620-f6dce57f2f24"}
{"parentUuid":"7a6dea71-284b-42d5-9a1e-eccb08cea322","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0176CFme12FFGJa3BVhdWX1i","type":"message","role":"assistant","content":[{"type":"text","text":"# Análisis Completo del Archivo de Creación de Vacantes\n\n## Resumen General\n\nEl archivo [crear.blade.php](resources/views/vacantes/paginas/crear.blade.php) es la vista principal para crear y editar **vacantes** (ofertas laborales internas) en PsicoAlianza. Implementa un sistema de **formulario multipaso** (wizard) con integración de **inteligencia artificial** y un **sistema complejo de etapas configurables** para procesos de selección.\n\n---\n\n## Estructura de la Vista\n\n### 1. **Layout y Organización** (líneas 1-60)\n\n```blade\n@extends('layouts.app')\n@section('titulo', 'Vacantes')\n```\n\n- **Estilos CSS especializados**:\n  - `vacantes.css` - Estilos específicos del módulo\n  - `perfiles.css` - Estilos para el sistema de perfiles psicométricos\n\n- **Migas de pan dinámicas**: Cambia entre \"Crear vacante\" y \"Editar vacante\" según el contexto\n- **Componente `crearMigaDePan`**: Sistema de navegación con botón \"volver\"\n\n### 2. **Sistema de Pasos** (líneas 29-54)\n\nUtiliza el componente `crearSeccionPasos` con **2 pasos principales**:\n\n#### **Paso 1: Información de la Vacante**\n- **Archivo incluido**: `formularios/formulario-informacion.blade.php`\n- **Activo por defecto**: `activo: true`\n- **Campos principales**:\n  - Nombre de la vacante\n  - Cantidad de plazas\n  - Funciones y responsabilidades\n  - Modalidad de trabajo (presencial, remoto, híbrido)\n  - Ubicación (actual de empresa u otra)\n  - Salario (específico o rango)\n  - Requisitos: género, edad, experiencia laboral, nivel educativo\n  - Habilidades y herramientas tecnológicas\n  - Idiomas con niveles (A1-C2)\n  - Licencia de conducir (opcional)\n\n#### **Paso 2: Configuración de Etapas**\n- **Archivo incluido**: `formularios/formulario-etapas.blade.php`\n- **Deshabilitado inicialmente**: `disabled: true`\n- **Se activa** cuando se completa exitosamente el paso 1\n- **Funcionalidad**:\n  - Configuración de etapas del proceso de selección\n  - Sistema de acordeón con drag & drop para reordenar\n  - Filtrado de etapas (activas/inactivas/todas)\n  - Activación de automatización de etapas\n\n---\n\n## Modales Principales\n\n### 3. **Modal de Edición de Plantilla de Etapa** (líneas 63-136)\n\n**Propósito**: Personalizar las notificaciones por correo de cada etapa del proceso.\n\n**Campos**:\n- `titulo_mensaje_plantilla` - Asunto del correo\n- Editor de texto enriquecido (CKEditor) para el contenido\n- Checkbox `con_logo` - Agregar logo de la empresa\n- Checkbox `enviar_finalizar` - Enviar solo al finalizar proceso (etapas finales)\n\n**Variables dinámicas disponibles**:\n- `__nombre_informador__`\n- `__nombre_empresa__`\n- `__nombre_vacante__`\n- `__nombre_candidato__`\n\n**Botones de acción**:\n- Restablecer texto (vuelve a plantilla predeterminada)\n- Cancelar\n- Guardar\n\n### 4. **Modal de Generación de Vacante con IA** (líneas 137-173)\n\n**Propósito**: Generar automáticamente datos de la vacante mediante inteligencia artificial.\n\n**Funcionamiento**:\n- Usuario describe el perfil deseado en un textarea\n- La IA genera:\n  - Nombre de la vacante\n  - Rango salarial\n  - Habilidades requeridas\n  - Herramientas tecnológicas\n  - Experiencia laboral\n  - Nivel educativo\n  - Idiomas con niveles\n  - Modalidad de trabajo\n  - Funciones y responsabilidades\n\n**Validación**: Mínimo 5 caracteres en la descripción.\n\n### 5. **Modal de Generación en Proceso (IA)** (líneas 174-189)\n\nModal de carga con GIF animado mientras la IA procesa:\n- **Backdrop estático**: No se puede cerrar\n- **Sin botón de cierre**\n- **Título**: \"Generando...\"\n\n### 6. **Modales de Movimientos de Etapas** (líneas 190-196)\n\nSistema modular de modales para configurar cada tipo de etapa:\n\n- **`modal-revision-hv`** - Revisión de hojas de vida\n- **`modal-preguntas-prefiltro`** - Preguntas de pre-filtro (hasta 15 preguntas, máx. 2 abiertas)\n- **`modal-pruebas-psicometricas`** - Configuración de pruebas psicométricas\n- **`modal-prueba-tecnica`** - Configuración de pruebas técnicas\n- **`modal-video-entrevista`** - Video entrevista (máx. 5 preguntas)\n- **`modal-entrevista`** - Entrevista presencial/virtual\n- **`modal-documentos-contratacion`** - Documentos requeridos\n\n### 7. **Modal de Previsualización de Imágenes** (líneas 198-221)\n\n**Funcionalidades**:\n- Zoom in/out con iconos\n- Botón de descarga\n- Visualización ampliada de imágenes adjuntas en etapas\n\n### 8. **Modales de Perfiles Psicométricos** (líneas 223-224)\n\n- **`modal-crear-perfil`** - Creación de nuevos perfiles de pruebas\n- **`modal-resumen-perfil`** - Visualización de perfiles existentes\n\n---\n\n## Archivos JavaScript Cargados\n\n### **Scripts Principales** (líneas 227-241)\n\n#### 1. **`crear-editar-vacantes.js`** - Orquestador principal\n\n**Funciones clave**:\n- `validacionAdicional(formulario)` - Validaciones antes de enviar\n- `validacionVacantesPaso1()` - Validaciones del paso 1:\n  - Rango de salarios válido\n  - Edad mínima >= 15 años\n  - Habilidades obligatorias\n  - Herramientas tecnológicas obligatorias\n  - Construcción de JSON para `informacion` y `requisitos`\n- `agregarDataForm(datos_formulario)` - Procesa FormData antes de enviar\n- `procesarDatosFormularioVacantesPaso1()` - Limpia y prepara datos del paso 1\n- `postSuccess(respuesta)` - Maneja respuestas exitosas\n- `postError(respuesta)` - Maneja errores del servidor\n\n#### 2. **`vacantes-funciones.js`** - Utilidades generales\n\n**Función principal**:\n- `obtenerConfiguracionNombresDuplicados()` - Verifica si se permiten nombres duplicados de vacantes (configuración ID: 47)\n\n#### 3. **`vacantes-paso-1.js`** - Lógica del primer paso\n\n**Funciones principales**:\n- `inicializarFormularioVacante()` - Inicializa el formulario, carga países, carga datos si es edición\n- `cargarDatosVacante(id)` - Carga datos de vacante existente para edición\n- `toggleLugarTrabajo(tipo)` - Alterna entre ubicación de empresa o personalizada\n- `toggleCamposSalario(tipo)` - Alterna entre salario específico o rango\n- `toggleEdad(tipo)` - Alterna entre rango de edad o indiferente\n- `validarRangoSalario()` - Valida que salario_hasta > salario_desde\n- `validarRangoEdades()` - Valida que edad_hasta > edad_desde\n- `seleccionarLicenciaConducir(elemento)` - Muestra/oculta tipo de licencia\n- `seleccionarIdioma(elemento)` - Genera campos para niveles de idiomas seleccionados\n- `formatearOpcionNivelIdioma(opcion)` - Tooltips con descripciones de niveles (A1-C2)\n- `cargarHabilidadesHerramientas()` - Carga habilidades/herramientas de vacantes anteriores\n- `validarNombreVacanteDuplicado()` - Consulta si ya existe vacante con ese nombre\n- `validarFormularioCompleto()` - Validación en tiempo real, habilita/deshabilita botón \"Siguiente\"\n\n**Datos estáticos**:\n- Array `idiomas`: 8 idiomas (Inglés, Portugués, Francés, Alemán, Mandarín, Italiano, Ruso, Árabe)\n- Array `niveles_idiomas`: Niveles A1 (Principiante) hasta C2 (Nativo) con descripciones detalladas\n\n#### 4. **`vacantes-paso-2.js`** - Lógica del segundo paso\n\n**Configuración de etapas** (líneas 6-59):\nObjeto `CONFIGURACION_ETAPAS` con 9 etapas predefinidas:\n1. Revisión HV (plantilla_correo_id: 12)\n2. Preguntas prefiltro (plantilla_correo_id: 13)\n3. Pruebas psicométricas (plantilla_correo_id: 15)\n4. Prueba técnica (plantilla_correo_id: 18)\n5. Video entrevista (plantilla_correo_id: 21)\n6. Entrevista (plantilla_correo_id: 26)\n7. Documentos para contratación (plantilla_correo_id: 23)\n8. Contratados (plantilla_correo_id: 27)\n9. Descartados (plantilla_correo_id: 28)\n\n**Funciones principales**:\n- `consultarEtapasVacante(vacante_id)` - Obtiene etapas desde `/etapas-vacantes`\n- `calcularDiasDuracionProceso(vacante_id)` - Calcula días estimados del proceso\n- `mostrarEtapasVacante()` - Renderiza acordeón con etapas, drag & drop (jQuery UI Sortable)\n- `activarDesactivarEtapa(checkbox)` - Toggle de etapas, abre modal de configuración automáticamente\n- `abrirModalNotificacionEtapa(etapa_id)` - Abre modal para editar plantilla de correo\n- `abrirModalMovimientoEtapa(movimiento_id, ...)` - Abre modal de configuración de movimiento\n- `restablecerPlantillaEtapa()` - Restablece plantilla a versión por defecto\n- `renderizarArchivos()` - Renderiza archivos adjuntos (documentos e imágenes)\n\n**Variables de estado**:\n- `etapa_movimiento_vacante_id_seleccionado`\n- `etapa_vacante_id_seleccionado`\n- `modal_movimiento_id_seleccionado`\n- `contador_preguntas_prefiltro`, `contador_preguntas_video_entrevista`\n- `archivos_preguntas`, `archivos_cargados`\n\n#### 5. **`funciones-modals-movimientos.js`** - Funciones comunes de modales\n\n**Funciones principales**:\n- `validacionFormularioMovimientoVacante(formulario)` - Valida configuraciones de movimientos\n- `mostrarConfiguracionesEtapaMovimientos()` - Carga configuraciones guardadas\n- `agregarPregunta(tipo_pregunta, contenedor, ...)` - Crea preguntas (abiertas/selección múltiple/única)\n- `calcularPuntuacionTotal(contenedor)` - Calcula tiempo total de preguntas\n- `eliminarPregunta(elemento, contenedor)` - Elimina pregunta con confirmación SweetAlert2\n- `agregarRespuestaPregunta(...)` - Agrega opciones de respuesta a preguntas de selección\n- `cerrarModalMovimiento()` - Cierra modal con confirmación, revierte toggle si es necesario\n\n**Validaciones especiales**:\n- Preguntas prefiltro: máximo 15 preguntas, máximo 2 abiertas\n- Video entrevista: máximo 5 preguntas\n- Al menos 2 opciones de respuesta en preguntas de selección\n- Al menos 1 respuesta correcta por pregunta\n\n#### 6. **`modal-pruebas-psicometricas.js`** - Modal de pruebas psicométricas\n\n**Constantes**:\n- `MAPA_CONFIGURACIONES_PRUEBAS`: Mapea IDs de pruebas a IDs de configuración\n\n**Funciones principales**:\n- `cargarPruebasPsicometricasVacantes()` - Obtiene pruebas disponibles de `/pruebas-empresas/{empresa_id}`\n- `mostrarPruebasPsicometricasVacantes()` - Renderiza tabla de pruebas\n- `seleccionarPruebaVacante(checkbox)` - Selecciona/deselecciona prueba, carga perfiles\n- `cargarPerfilesPrueba(prueba_id, slug)` - Carga perfiles desde `/perfiles-listado-empresa`\n- `actualizarPorcentajeTotalVacantes()` - Distribuye porcentajes automáticamente (100%)\n- `validarFormularioPruebasPsicometricas()` - Validación en tiempo real con debouncing (50ms)\n- `recopilarDatosPruebasPsicometricas()` - Prepara datos para enviar al backend\n- `cambiarTipoCaducidad(radio)` - Alterna entre caducidad por días o fecha específica\n\n**Validaciones**:\n- Suma de porcentajes debe ser exactamente 100%\n- Todas las pruebas seleccionadas deben tener perfil asignado\n- Tipo de caducidad requerido (días o fecha)\n\n#### 7. **`vacantes-ia.js`** - Integraciones de inteligencia artificial\n\n**Funciones de generación con IA**:\n\n1. **`generarVacanteIA()`** - Genera datos completos de la vacante\n   - Endpoint: `/generar-vacante`\n   - Llena automáticamente todos los campos del paso 1\n\n2. **`generarPreguntasPrefiltroIA()`** - Genera 5 preguntas de pre-filtro\n   - Endpoint: `/generar-preguntas-prefiltro`\n   - Tipos: abierta, selección única, selección múltiple\n   - Respeta límite de 2 preguntas abiertas para prefiltro\n\n3. **`generarUnaPreguntaPrefiltroIA(contador_pregunta, tipo_pregunta)`** - Genera 1 pregunta específica\n   - Regenera pregunta existente con tipo específico\n   - Envía `preguntas_existentes` para evitar duplicados\n\n4. **`generarPruebasPsicometricasIA()`** - Recomienda pruebas psicométricas\n   - Endpoint: `/generar-pruebas-psicometricas`\n   - Selecciona automáticamente pruebas, perfiles y porcentajes\n\n**Validaciones previas a generación IA**:\n- Nombre de vacante >= 5 caracteres\n- Al menos 1 habilidad seleccionada\n- Al menos 1 herramienta tecnológica seleccionada\n- Experiencia laboral definida\n- Nivel educativo definido\n\n---\n\n## Variables Globales JavaScript (líneas 243-246)\n\n```javascript\nlet empresa = @json($empresa);\nconst EMPRESA_ID = @json(\\Auth::user()->empresa->id);\nlet etapas_vacante = [];\nlet modalidades_trabajos = @json($modalidades_trabajos);\n```\n\n---\n\n## Flujo de Trabajo Completo\n\n### **Creación de Vacante Nueva**:\n\n1. **Usuario ingresa a `/vacantes/crear`**\n2. **Paso 1 activo**, Paso 2 deshabilitado\n3. Usuario puede:\n   - Llenar formulario manualmente\n   - **O usar IA**: Describe perfil → `generarVacanteIA()` → Campos llenados automáticamente\n4. **Validación en tiempo real**:\n   - `validarFormularioCompleto()` se ejecuta en cada cambio\n   - Botón \"Siguiente\" se habilita/deshabilita dinámicamente\n5. **Al hacer clic en \"Siguiente\"**:\n   - `validacionVacantesPaso1()` valida todos los campos\n   - `agregarDataForm()` procesa los datos\n   - `procesarDatosFormularioVacantesPaso1()` limpia valores (salarios, idiomas)\n   - Se envía a `/vacantes` (POST)\n6. **Respuesta exitosa**:\n   - `postSuccess()` maneja la respuesta\n   - Habilita Paso 2\n   - Carga etapas con `consultarEtapasVacante(vacante_id)`\n7. **Paso 2: Configuración de etapas**:\n   - Usuario activa/desactiva etapas con toggles\n   - Al activar una etapa → se abre automáticamente el modal de configuración\n   - Usuario configura cada movimiento:\n     - **Revisión HV**: Criterios de descarte\n     - **Preguntas prefiltro**: Puede generar con IA o crear manualmente\n     - **Pruebas psicométricas**: Selecciona pruebas, perfiles, porcentajes (100%)\n     - **Documentos**: Selecciona documentos requeridos\n     - Etc.\n   - Usuario puede reordenar etapas (drag & drop)\n   - Configura notificaciones por correo para cada etapa\n8. **Finalización**:\n   - Click en \"Crear vacante\"\n   - Se envía a `/vacantes-completar` (POST)\n   - Redirección a `/vacantes` con toast de éxito\n\n### **Edición de Vacante Existente**:\n\n1. **Usuario ingresa a `/vacantes/{id}/editar`**\n2. `cargarDatosVacante(id)` se ejecuta automáticamente\n3. Ambos pasos habilitados\n4. Todos los campos prellenados:\n   - Datos básicos\n   - Salarios\n   - Idiomas con niveles\n   - Habilidades y herramientas\n5. **Paso 2 muestra etapas configuradas**:\n   - `mostrarConfiguracionesEtapaMovimientos()` carga configuraciones guardadas\n   - Pruebas psicométricas: checkboxes marcados, perfiles seleccionados, porcentajes cargados\n   - Preguntas prefiltro/video entrevista: preguntas existentes renderizadas\n6. Usuario modifica lo que necesite\n7. Guarda cambios\n\n---\n\n## Características Avanzadas\n\n### **1. Integración de IA Completa**:\n- Generación de vacante completa\n- Generación de preguntas de pre-filtro (individuales o múltiples)\n- Generación de preguntas de video entrevista\n- Recomendación de pruebas psicométricas con perfiles y porcentajes\n\n### **2. Sistema de Validación Robusto**:\n- Validación en tiempo real (keyup, change, blur)\n- Debouncing para evitar validaciones excesivas\n- Validaciones personalizadas por tipo de campo\n- Mensajes de error específicos\n\n### **3. Sistema de Plantillas de Correo**:\n- Personalización de asunto y contenido\n- Editor de texto enriquecido (CKEditor)\n- Variables dinámicas (nombre_candidato, nombre_vacante, etc.)\n- Opción de agregar logo de empresa\n- Restablecimiento a plantilla por defecto\n\n### **4. Gestión de Archivos Avanzada**:\n- Carga de múltiples archivos\n- Previsualización de imágenes\n- Diferenciación entre documentos e imágenes\n- Eliminación con confirmación\n- Zoom y descarga de imágenes\n\n### **5. Sistema de Perfiles Psicométricos**:\n- Selección de perfiles por prueba\n- Creación de perfiles nuevos desde el modal\n- Visualización de perfiles existentes\n- Distribución automática de porcentajes (100%)\n- Validación estricta de porcentajes\n\n### **6. Drag & Drop de Etapas**:\n- Reordenamiento visual con jQuery UI Sortable\n- Actualización automática de orden en backend\n- Etapas fijas no movibles (Revisión HV, Contratados, Descartados)\n\n### **7. Sistema de Configuraciones Dinámicas**:\n- Cada movimiento tiene configuraciones específicas\n- Se cargan/guardan desde `configuraciones_etapa_movimiento`\n- Soporte para checkboxes, inputs, selects, datepickers\n\n---\n\n## Convenciones y Buenas Prácticas\n\n### **Nomenclatura**:\n- **Variables JS**: `snake_case` (var_ejemplo)\n- **Constantes JS**: `SNAKE_CASE_MAYUSCULAS` (VAR_EJEMPLO)\n- **Funciones JS**: `camelCase` (miFuncion)\n- **Clases CSS**: `kebab-case` (clase-ejemplo)\n- **IDs HTML**: `snake_case` (id_ejemplo)\n\n### **Componentes UI**:\n- Uso de **template literals** `${}` en Blade\n- Componentes: `crearInput`, `crearSelect2`, `crearTextarea`, `crearCheckbox`, `crearToggle`, `crearBoton`, `crearModal`, `crearAlerta`, etc.\n- Integración de datos PHP con `@foreach` dentro de opciones\n\n### **Manejo de Errores**:\n- Toasts para mensajes al usuario (`mostrarToast`)\n- SweetAlert2 para confirmaciones críticas\n- Validaciones con jQuery Validate\n- Manejo de errores AJAX con mensajes específicos\n\n---\n\n## Endpoints del Backend Utilizados\n\n| Método | Endpoint | Descripción |\n|--------|----------|-------------|\n| GET | `/vacantes/{id}` | Obtener datos de una vacante |\n| POST | `/vacantes` | Crear/actualizar vacante paso 1 |\n| POST | `/vacantes-completar` | Finalizar creación de vacante |\n| GET | `/etapas-vacantes` | Obtener etapas de una vacante |\n| PUT | `/etapas-vacantes/{id}` | Activar/desactivar etapa |\n| PUT | `/etapas-vacantes-cambiar-orden` | Cambiar orden de etapas |\n| GET | `/configuraciones-etapa-movimiento/{id}` | Obtener configuraciones |\n| GET | `/plantilla-correo` | Obtener plantilla de correo |\n| POST | `/plantillas-correos` | Guardar plantilla personalizada |\n| PUT | `/plantillas-correos-restablecer/{id}` | Restablecer plantilla |\n| POST | `/vacantes-preguntas` | Guardar preguntas |\n| GET | `/pruebas-empresas/{empresa_id}` | Obtener pruebas disponibles |\n| GET | `/perfiles-listado-empresa` | Obtener perfiles de prueba |\n| POST | `/generar-vacante` | Generar vacante con IA |\n| POST | `/generar-preguntas-prefiltro` | Generar preguntas con IA |\n| POST | `/generar-preguntas-videoentrevista` | Generar preguntas video con IA |\n| POST | `/generar-pruebas-psicometricas` | Generar pruebas con IA |\n| GET | `/vacantes-habilidades-herramientas` | Obtener habilidades/herramientas previas |\n| GET | `/vacantes-listado-tabla` | Validar nombres duplicados |\n| GET | `/configuraciones-obtener` | Obtener configuración empresa |\n\n---\n\n## Resumen Final\n\nEste archivo implementa un **sistema completo de gestión de vacantes internas** con:\n- ✅ Formulario multipaso (wizard) con validación en tiempo real\n- ✅ Generación asistida por IA en múltiples puntos del flujo\n- ✅ Sistema flexible de etapas configurables con drag & drop\n- ✅ Integración con pruebas psicométricas y perfiles\n- ✅ Gestión de notificaciones por correo personalizables\n- ✅ Soporte para preguntas de pre-filtro y video entrevista\n- ✅ Sistema de archivos adjuntos\n- ✅ Validaciones robustas en frontend y backend\n- ✅ Experiencia de usuario fluida con carga dinámica de datos\n- ✅ Arquitectura modular y mantenible\n\n**Total de líneas de código analizadas**: ~9,000 líneas entre Blade, JavaScript y funciones auxiliares."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":4060,"cache_read_input_tokens":95621,"cache_creation":{"ephemeral_5m_input_tokens":4060,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CX64A9FpLbioUoHg3gucz","type":"assistant","uuid":"f40a4c5e-b07b-4a11-afcf-eb3ccea7c122","timestamp":"2026-01-13T21:06:15.281Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-13T21:07:22.998Z","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58"}
{"type":"file-history-snapshot","messageId":"a198ebd8-2c10-4cf8-8131-4e727693cd96","snapshot":{"messageId":"a198ebd8-2c10-4cf8-8131-4e727693cd96","trackedFileBackups":{},"timestamp":"2026-01-13T21:07:23.977Z"},"isSnapshotUpdate":false}
{"parentUuid":"f40a4c5e-b07b-4a11-afcf-eb3ccea7c122","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 192 to 192 from c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\crear.blade.php:\n@include('vacantes.paginas.formularios.modals-movimientos/modal-pruebas-psicometricas')\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"@include('vacantes.paginas.formularios.modals-movimientos/modal-pruebas-psicometricas') listo esa vista llama este m,odal y el priblma es que cuando se elecciona ua de las pruebas seleccino la prueba y logo se despliega un listado de perfiles y de ultimas un item de crear perfil y cuando se clikea se abre otra modal para crear le perfil pero cuando se crea o se ciera el se modal el slect de donde sale el listado d eperfiles quea como pegado y no me deja hacer scroll en el modal donde se esleciona la prueba"}]},"uuid":"a198ebd8-2c10-4cf8-8131-4e727693cd96","timestamp":"2026-01-13T21:07:23.970Z"}
{"parentUuid":"a198ebd8-2c10-4cf8-8131-4e727693cd96","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01AEFL9LTxWVpaqxT95qK8qX","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo el problema perfectamente. Cuando se abre el modal de crear perfil desde dentro del select2 del modal de pruebas psicométricas, al cerrar el modal de crear perfil, el select2 queda \"pegado\" (stuck) y no permite hacer scroll en el modal principal. Este es un problema común de **conflicto entre modales anidados y Select2**.\n\nVoy a leer el archivo del modal de pruebas psicométricas para ver la implementación actual:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":6837,"cache_read_input_tokens":99681,"cache_creation":{"ephemeral_5m_input_tokens":6837,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX64QfxfouBcQDBcGF2fH","type":"assistant","uuid":"e53bde8f-f3db-4b0c-91ba-e661c37418ca","timestamp":"2026-01-13T21:07:29.830Z"}
{"parentUuid":"e53bde8f-f3db-4b0c-91ba-e661c37418ca","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01AEFL9LTxWVpaqxT95qK8qX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Ar21LuA2w4fN7CsnmRrQm5","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\modals-movimientos\\modal-pruebas-psicometricas.blade.php"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":6837,"cache_read_input_tokens":99681,"cache_creation":{"ephemeral_5m_input_tokens":6837,"ephemeral_1h_input_tokens":0},"output_tokens":219,"service_tier":"standard"}},"requestId":"req_011CX64QfxfouBcQDBcGF2fH","type":"assistant","uuid":"8b43689d-f5e7-4b13-96ac-96d6782570f5","timestamp":"2026-01-13T21:07:30.744Z"}
{"parentUuid":"8b43689d-f5e7-4b13-96ac-96d6782570f5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Ar21LuA2w4fN7CsnmRrQm5","type":"tool_result","content":"     1→${crearModal({\n     2→    id: 'modal-movimiento-6',\n     3→    dialog_class: 'modal-lg modal-dialog-centered modal-dialog-scrollable',\n     4→    clase_adiocional: 'modal-prueba-psicometrica',\n     5→    adiconales_modals_header: `data-bs-backdrop=\"static\"`,\n     6→    adiconales_cerrar_modal_header: `onclick=\"cerrarModalMovimiento();\"`,\n     7→    titulo_header: 'Pruebas psicométricas',\n     8→    boton_footer1: {\n     9→        type: 'button',\n    10→        texto: 'Cancelar',\n    11→        class: 'btn-outline-primary',\n    12→        cerrar_modal: false,\n    13→        onclick: `cerrarModalMovimiento();`\n    14→    },\n    15→    boton_footer2: {\n    16→        type: 'submit',\n    17→        texto: 'Guardar',\n    18→        class: 'btn-primary',\n    19→        cerrar_modal: false,\n    20→        form: 'form-movimiento-6',\n    21→        disabled: true\n    22→    },\n    23→    modal_body: `\n    24→        <form class=\"col-12 formulario-movimiento\" id=\"form-movimiento-6\" action=\"/etapas-movimientos-vacantes-configuraciones\">\n    25→            @csrf\n    26→            <input type=\"hidden\" id=\"configuraciones\" name=\"configuraciones\">\n    27→            <div class=\"row\">\n    28→                <div class=\"col px-6 mb-3 align-content-center\">\n    29→                    <p class=\"text-body-2 mb-0\">Configura las pruebas psicométricas manualmente o con apoyo de IA.</p>\n    30→                </div>\n    31→                <div class=\"col-auto px-6 mb-3\">\n    32→                    ${crearBoton({\n    33→                        id: 'generar_pruebas_con_ia',\n    34→                        clases: 'btn-yellow justify-content-center w-100',\n    35→                        texto: '<img class=\"me-3\" src=\"/iconos/icono_ia.svg\" width=\"20\" height=\"20\">Generar pruebas con IA',\n    36→                        onclick: 'generarPruebasPsicometricasIA()'\n    37→                    })}\n    38→                </div>\n    39→                <div class=\"col-12\">\n    40→                    <div class=\"row\" id=\"contenedor-pruebas\">\n    41→                    </div>\n    42→                </div>\n    43→                <div class=\"col text-end my-3 px-6\">\n    44→                    <span class=\"text-gray-10 text-body-1\">Porcentaje total:</span> <span class=\"text-body-1\" id=\"porcentaje-pruebas\">0%</span>\n    45→                </div>\n    46→                <div class=\"col-12 mb-3 px-6\">\n    47→                    <div class=\"alert alert-info alerta-porcentajes mb-0\" role=\"alert\">\n    48→                        <span class=\"text-alerta\">Los porcentajes de las pruebas deben sumar 100%, ajusta los porcentajes de acuerdo al valor de cada prueba.</span>\n    49→                    </div>\n    50→                </div>\n    51→                <div class=\"col-12 px-6\">\n    52→                    <div class=\"row mb-4 border-bottom\">\n    53→                        <div class=\"col-12 px-0 text-body-2 text-gray-10 mt-2 mb-3\">Verificar identidad de candidatos</div>\n    54→                        <div class=\"col-6 py-2\">\n    55→                            ${crearCheckbox({\n    56→                                id: 'movimiento_vacante_configuracion_id_12',\n    57→                                class: 'campos-form-movimiento-6',\n    58→                                label: 'Obtener registro fotográfico',\n    59→                                checked: true,\n    60→                                adicional: `data-movimiento_vacante_configuracion_id=\"12\"`\n    61→                            })}\n    62→                        </div>\n    63→                        <div class=\"col-6 py-2\">\n    64→                            ${crearCheckbox({\n    65→                                id: 'movimiento_vacante_configuracion_id_13',\n    66→                                class: 'campos-form-movimiento-6',\n    67→                                label: 'Obtener videograbación',\n    68→                                checked: false,\n    69→                                adicional: `data-movimiento_vacante_configuracion_id=\"13\"`\n    70→                            })}\n    71→                        </div>\n    72→                    </div>\n    73→                </div>\n    74→                <div class=\"col-12 px-6\">\n    75→                    <div class=\"row mb-4 border-bottom\">\n    76→                        <div class=\"col-12 px-0 text-body-2 text-gray-10 mt-2 mb-3\">Descartar candidatos</div>\n    77→                        <div class=\"col-6 py-2\">\n    78→                            ${crearCheckbox({\n    79→                                id: 'movimiento_vacante_configuracion_id_14',\n    80→                                class: 'campos-form-movimiento-6',\n    81→                                label: 'Con puntuaciones bajas',\n    82→                                checked: true,\n    83→                                onchange: 'manejarCheckPuntuacionesBajas(this)',\n    84→                                adicional: `data-movimiento_vacante_configuracion_id=\"14\"`\n    85→                            })}\n    86→                        </div>\n    87→                        <div class=\"col-6 py-2\">\n    88→                            ${crearCheckbox({\n    89→                                id: 'movimiento_vacante_configuracion_id_15',\n    90→                                class: 'campos-form-movimiento-6',\n    91→                                label: 'Con puntuación medias',\n    92→                                checked: false,\n    93→                                onchange: 'manejarCheckPuntuacionesMedias(this)',\n    94→                                adicional: `data-movimiento_vacante_configuracion_id=\"15\"`\n    95→                            })}\n    96→                        </div>\n    97→                    </div>\n    98→                </div>\n    99→                <div class=\"col-12 px-6\">\n   100→                    <div class=\"row mb-4\">\n   101→                        <div class=\"col-12 px-0 text-body-2 text-gray-10 mb-3\">Al enviar, caducar el acceso después de:</div>\n   102→                        <div class=\"col-12\">\n   103→                            <div class=\"row align-items-center\">\n   104→                                <div class=\"col-4\">\n   105→                                    ${crearRadioButton({\n   106→                                        id: 'activar_movimiento_vacante_configuracion_id_16',\n   107→                                        name: 'tipo_caducidad',\n   108→                                        label: 'Días',\n   109→                                        class: 'tipo-caducidad-radio',\n   110→                                        value: 'dias',\n   111→                                        checked: true,\n   112→                                        onchange: 'cambiarTipoCaducidad(this)'\n   113→                                    })}\n   114→                                </div>\n   115→                                <div class=\"col-4\">\n   116→                                    ${crearRadioButton({\n   117→                                        id: 'activar_movimiento_vacante_configuracion_id_17',\n   118→                                        name: 'tipo_caducidad',\n   119→                                        label: 'Elegir fecha',\n   120→                                        class: 'tipo-caducidad-radio',\n   121→                                        value: 'fecha',\n   122→                                        checked: false,\n   123→                                        onchange: 'cambiarTipoCaducidad(this)'\n   124→                                    })}\n   125→                                </div>\n   126→                                <div class=\"col-4\">\n   127→                                    <div id=\"contenedor-cantidad-dias\">\n   128→                                        ${crearInput({\n   129→                                            id: 'movimiento_vacante_configuracion_id_16',\n   130→                                            type: 'number',\n   131→                                            class: 'campos-form-movimiento-6',\n   132→                                            input_container_class: 'mb-0',\n   133→                                            label: 'Cantidad',\n   134→                                            placeholder: '',\n   135→                                            value: '',\n   136→                                            min: '1',\n   137→                                            max: '365',\n   138→                                            adicional: `data-movimiento_vacante_configuracion_id=\"16\"`\n   139→                                        })}\n   140→                                    </div>\n   141→                                    <div id=\"contenedor-fecha-caducidad\" class=\"d-none\">\n   142→                                        @php\n   143→                                            $fecha_minima = date('Y-m-d');\n   144→                                            $fecha_maxima = date('Y-m-d', strtotime('+1 year'));\n   145→                                        @endphp\n   146→                                        ${crearDatePicker({\n   147→                                            id: 'movimiento_vacante_configuracion_id_17',\n   148→                                            class: 'campos-form-movimiento-6 flatpickr-time',\n   149→                                            placeholder: 'dd/mm/yyyy - hh:mm',\n   150→                                            input_container_class: 'mb-0',\n   151→                                            label: 'Fecha',\n   152→                                            min: '{{ $fecha_minima }}',\n   153→                                            max: '{{ $fecha_maxima }}',\n   154→                                            adicional: `data-movimiento_vacante_configuracion_id=\"17\"`\n   155→                                        })}\n   156→                                    </div>\n   157→                                </div>\n   158→                            </div>\n   159→                        </div>\n   160→                    </div>\n   161→                </div>\n   162→            </div>\n   163→        </form>\n   164→    `\n   165→})}\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"af8c1ac1-b99b-41a4-838c-9f328c8d14d0","timestamp":"2026-01-13T21:07:32.984Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\vacantes\\paginas\\formularios\\modals-movimientos\\modal-pruebas-psicometricas.blade.php","content":"${crearModal({\n    id: 'modal-movimiento-6',\n    dialog_class: 'modal-lg modal-dialog-centered modal-dialog-scrollable',\n    clase_adiocional: 'modal-prueba-psicometrica',\n    adiconales_modals_header: `data-bs-backdrop=\"static\"`,\n    adiconales_cerrar_modal_header: `onclick=\"cerrarModalMovimiento();\"`,\n    titulo_header: 'Pruebas psicométricas',\n    boton_footer1: {\n        type: 'button',\n        texto: 'Cancelar',\n        class: 'btn-outline-primary',\n        cerrar_modal: false,\n        onclick: `cerrarModalMovimiento();`\n    },\n    boton_footer2: {\n        type: 'submit',\n        texto: 'Guardar',\n        class: 'btn-primary',\n        cerrar_modal: false,\n        form: 'form-movimiento-6',\n        disabled: true\n    },\n    modal_body: `\n        <form class=\"col-12 formulario-movimiento\" id=\"form-movimiento-6\" action=\"/etapas-movimientos-vacantes-configuraciones\">\n            @csrf\n            <input type=\"hidden\" id=\"configuraciones\" name=\"configuraciones\">\n            <div class=\"row\">\n                <div class=\"col px-6 mb-3 align-content-center\">\n                    <p class=\"text-body-2 mb-0\">Configura las pruebas psicométricas manualmente o con apoyo de IA.</p>\n                </div>\n                <div class=\"col-auto px-6 mb-3\">\n                    ${crearBoton({\n                        id: 'generar_pruebas_con_ia',\n                        clases: 'btn-yellow justify-content-center w-100',\n                        texto: '<img class=\"me-3\" src=\"/iconos/icono_ia.svg\" width=\"20\" height=\"20\">Generar pruebas con IA',\n                        onclick: 'generarPruebasPsicometricasIA()'\n                    })}\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\" id=\"contenedor-pruebas\">\n                    </div>\n                </div>\n                <div class=\"col text-end my-3 px-6\">\n                    <span class=\"text-gray-10 text-body-1\">Porcentaje total:</span> <span class=\"text-body-1\" id=\"porcentaje-pruebas\">0%</span>\n                </div>\n                <div class=\"col-12 mb-3 px-6\">\n                    <div class=\"alert alert-info alerta-porcentajes mb-0\" role=\"alert\">\n                        <span class=\"text-alerta\">Los porcentajes de las pruebas deben sumar 100%, ajusta los porcentajes de acuerdo al valor de cada prueba.</span>\n                    </div>\n                </div>\n                <div class=\"col-12 px-6\">\n                    <div class=\"row mb-4 border-bottom\">\n                        <div class=\"col-12 px-0 text-body-2 text-gray-10 mt-2 mb-3\">Verificar identidad de candidatos</div>\n                        <div class=\"col-6 py-2\">\n                            ${crearCheckbox({\n                                id: 'movimiento_vacante_configuracion_id_12',\n                                class: 'campos-form-movimiento-6',\n                                label: 'Obtener registro fotográfico',\n                                checked: true,\n                                adicional: `data-movimiento_vacante_configuracion_id=\"12\"`\n                            })}\n                        </div>\n                        <div class=\"col-6 py-2\">\n                            ${crearCheckbox({\n                                id: 'movimiento_vacante_configuracion_id_13',\n                                class: 'campos-form-movimiento-6',\n                                label: 'Obtener videograbación',\n                                checked: false,\n                                adicional: `data-movimiento_vacante_configuracion_id=\"13\"`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 px-6\">\n                    <div class=\"row mb-4 border-bottom\">\n                        <div class=\"col-12 px-0 text-body-2 text-gray-10 mt-2 mb-3\">Descartar candidatos</div>\n                        <div class=\"col-6 py-2\">\n                            ${crearCheckbox({\n                                id: 'movimiento_vacante_configuracion_id_14',\n                                class: 'campos-form-movimiento-6',\n                                label: 'Con puntuaciones bajas',\n                                checked: true,\n                                onchange: 'manejarCheckPuntuacionesBajas(this)',\n                                adicional: `data-movimiento_vacante_configuracion_id=\"14\"`\n                            })}\n                        </div>\n                        <div class=\"col-6 py-2\">\n                            ${crearCheckbox({\n                                id: 'movimiento_vacante_configuracion_id_15',\n                                class: 'campos-form-movimiento-6',\n                                label: 'Con puntuación medias',\n                                checked: false,\n                                onchange: 'manejarCheckPuntuacionesMedias(this)',\n                                adicional: `data-movimiento_vacante_configuracion_id=\"15\"`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 px-6\">\n                    <div class=\"row mb-4\">\n                        <div class=\"col-12 px-0 text-body-2 text-gray-10 mb-3\">Al enviar, caducar el acceso después de:</div>\n                        <div class=\"col-12\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-4\">\n                                    ${crearRadioButton({\n                                        id: 'activar_movimiento_vacante_configuracion_id_16',\n                                        name: 'tipo_caducidad',\n                                        label: 'Días',\n                                        class: 'tipo-caducidad-radio',\n                                        value: 'dias',\n                                        checked: true,\n                                        onchange: 'cambiarTipoCaducidad(this)'\n                                    })}\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearRadioButton({\n                                        id: 'activar_movimiento_vacante_configuracion_id_17',\n                                        name: 'tipo_caducidad',\n                                        label: 'Elegir fecha',\n                                        class: 'tipo-caducidad-radio',\n                                        value: 'fecha',\n                                        checked: false,\n                                        onchange: 'cambiarTipoCaducidad(this)'\n                                    })}\n                                </div>\n                                <div class=\"col-4\">\n                                    <div id=\"contenedor-cantidad-dias\">\n                                        ${crearInput({\n                                            id: 'movimiento_vacante_configuracion_id_16',\n                                            type: 'number',\n                                            class: 'campos-form-movimiento-6',\n                                            input_container_class: 'mb-0',\n                                            label: 'Cantidad',\n                                            placeholder: '',\n                                            value: '',\n                                            min: '1',\n                                            max: '365',\n                                            adicional: `data-movimiento_vacante_configuracion_id=\"16\"`\n                                        })}\n                                    </div>\n                                    <div id=\"contenedor-fecha-caducidad\" class=\"d-none\">\n                                        @php\n                                            $fecha_minima = date('Y-m-d');\n                                            $fecha_maxima = date('Y-m-d', strtotime('+1 year'));\n                                        @endphp\n                                        ${crearDatePicker({\n                                            id: 'movimiento_vacante_configuracion_id_17',\n                                            class: 'campos-form-movimiento-6 flatpickr-time',\n                                            placeholder: 'dd/mm/yyyy - hh:mm',\n                                            input_container_class: 'mb-0',\n                                            label: 'Fecha',\n                                            min: '{{ $fecha_minima }}',\n                                            max: '{{ $fecha_maxima }}',\n                                            adicional: `data-movimiento_vacante_configuracion_id=\"17\"`\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </form>\n    `\n})}","numLines":165,"startLine":1,"totalLines":165}},"sourceToolAssistantUUID":"8b43689d-f5e7-4b13-96ac-96d6782570f5"}
{"parentUuid":"af8c1ac1-b99b-41a4-838c-9f328c8d14d0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01CzPWWsTE2pFmcFoRMKQtJG","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a revisar el modal de crear perfil para entender la implementación completa:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":3077,"cache_read_input_tokens":106518,"cache_creation":{"ephemeral_5m_input_tokens":3077,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX64RQKrPuj8Dm49JoSCN","type":"assistant","uuid":"4cd3cf66-aa46-4803-b813-5f34cd378fbb","timestamp":"2026-01-13T21:07:36.946Z"}
{"parentUuid":"4cd3cf66-aa46-4803-b813-5f34cd378fbb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01CzPWWsTE2pFmcFoRMKQtJG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01W4GKNwSVmn49CFkNAEacfa","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\perfiles\\componentes\\modal-crear-perfil.blade.php"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":3077,"cache_read_input_tokens":106518,"cache_creation":{"ephemeral_5m_input_tokens":3077,"ephemeral_1h_input_tokens":0},"output_tokens":111,"service_tier":"standard"}},"requestId":"req_011CX64RQKrPuj8Dm49JoSCN","type":"assistant","uuid":"02d2a31e-7e57-49bc-a6ba-cc266ae7d05f","timestamp":"2026-01-13T21:07:38.625Z"}
{"parentUuid":"02d2a31e-7e57-49bc-a6ba-cc266ae7d05f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01W4GKNwSVmn49CFkNAEacfa","type":"tool_result","content":"     1→${crearModal({\n     2→        id: 'modal-crear-perfil',\n     3→        dialog_class: 'modal-xl modal-dialog-centered',\n     4→        titulo_header: 'Crear perfil',\n     5→        content_class: 'px-0-important',\n     6→        header_class: 'px-4',\n     7→        modal_body_class: 'p-0',\n     8→        clase_footer: 'modal-crear-perfil',\n     9→        boton_footer1: {\n    10→            type: 'button',\n    11→            texto: 'Cancelar',\n    12→            class: 'btn-outline-primary mx-8',\n    13→            cerrar_modal: true,\n    14→        },\n    15→        boton_footer2: {\n    16→            id: 'siguiente_perfil',\n    17→            type: 'button',\n    18→            texto: 'Siguiente',\n    19→            class: 'btn-primary mx-8',\n    20→            onclick: '',\n    21→            disabled: true,\n    22→        },\n    23→        modal_body: `\n    24→            <input type=\"hidden\" id=\"id_perfil\" name=\"id_perfil\" value=\"0\">\n    25→            <div class=\"container contendeor-crear\">\n    26→                <div class=\"bg-blue-80 p-3\">\n    27→                    <div class=\"mx-2\">\n    28→                        ${crearInput({\n    29→                            id: 'nombre-perfil',\n    30→                            name: 'nombre-perfil',\n    31→                            type: 'text',\n    32→                            class: '',\n    33→                            maxlength: '34',\n    34→                            placeholder: '',\n    35→                            disabled: false,\n    36→                            required: true,\n    37→                            autocomplete: 'off',\n    38→                            value: '',\n    39→                            label: 'Nombre del perfil',\n    40→                        })}\n    41→                    </div>\n    42→                    <div class=\"form-check mt-3\">\n    43→                        ${crearCheckbox({\n    44→                            id: 'compartir_perfil',\n    45→                            name: 'compartir_perfil',\n    46→                            checked: true,\n    47→                            label: 'Compartir perfil con mis sucursales',\n    48→                        })}\n    49→                    </div>\n    50→                </div>\n    51→\n    52→                <div class=\"row g-3 mx-3 mt-2\">\n    53→                    <div id=\"tipo_prueba_div\" class=\"col-md-6\">\n    54→                        ${crearSelect2({\n    55→                            opciones: @json($pruebas_plan_activo_seleccion),\n    56→                            id: 'tipo_prueba',\n    57→                            label: '',\n    58→                            value: '',\n    59→                            disabled: true,\n    60→                        })}\n    61→                    </div>\n    62→                    <div id=\"nivel_educativo_div\" class=\"col-md-6\">\n    63→                        ${crearSelect2({\n    64→                            opciones: @json($nivel_educativo),\n    65→                            id: 'nivel_educativo',\n    66→                            label: 'Nivel educativo de la vacante',\n    67→                            required: true,\n    68→                        })}\n    69→                    </div>\n    70→                </div>\n    71→\n    72→                <div class=\"mx-4 mt-4\" id=\"tabs-container\">\n    73→                </div>\n    74→            </div>\n    75→        `\n    76→    })}\n    77→\n    78→    \n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"21a090c7-77af-40b8-882b-669e559e78c9","timestamp":"2026-01-13T21:07:40.812Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\perfiles\\componentes\\modal-crear-perfil.blade.php","content":"${crearModal({\n        id: 'modal-crear-perfil',\n        dialog_class: 'modal-xl modal-dialog-centered',\n        titulo_header: 'Crear perfil',\n        content_class: 'px-0-important',\n        header_class: 'px-4',\n        modal_body_class: 'p-0',\n        clase_footer: 'modal-crear-perfil',\n        boton_footer1: {\n            type: 'button',\n            texto: 'Cancelar',\n            class: 'btn-outline-primary mx-8',\n            cerrar_modal: true,\n        },\n        boton_footer2: {\n            id: 'siguiente_perfil',\n            type: 'button',\n            texto: 'Siguiente',\n            class: 'btn-primary mx-8',\n            onclick: '',\n            disabled: true,\n        },\n        modal_body: `\n            <input type=\"hidden\" id=\"id_perfil\" name=\"id_perfil\" value=\"0\">\n            <div class=\"container contendeor-crear\">\n                <div class=\"bg-blue-80 p-3\">\n                    <div class=\"mx-2\">\n                        ${crearInput({\n                            id: 'nombre-perfil',\n                            name: 'nombre-perfil',\n                            type: 'text',\n                            class: '',\n                            maxlength: '34',\n                            placeholder: '',\n                            disabled: false,\n                            required: true,\n                            autocomplete: 'off',\n                            value: '',\n                            label: 'Nombre del perfil',\n                        })}\n                    </div>\n                    <div class=\"form-check mt-3\">\n                        ${crearCheckbox({\n                            id: 'compartir_perfil',\n                            name: 'compartir_perfil',\n                            checked: true,\n                            label: 'Compartir perfil con mis sucursales',\n                        })}\n                    </div>\n                </div>\n\n                <div class=\"row g-3 mx-3 mt-2\">\n                    <div id=\"tipo_prueba_div\" class=\"col-md-6\">\n                        ${crearSelect2({\n                            opciones: @json($pruebas_plan_activo_seleccion),\n                            id: 'tipo_prueba',\n                            label: '',\n                            value: '',\n                            disabled: true,\n                        })}\n                    </div>\n                    <div id=\"nivel_educativo_div\" class=\"col-md-6\">\n                        ${crearSelect2({\n                            opciones: @json($nivel_educativo),\n                            id: 'nivel_educativo',\n                            label: 'Nivel educativo de la vacante',\n                            required: true,\n                        })}\n                    </div>\n                </div>\n\n                <div class=\"mx-4 mt-4\" id=\"tabs-container\">\n                </div>\n            </div>\n        `\n    })}\n\n    ","numLines":78,"startLine":1,"totalLines":78}},"sourceToolAssistantUUID":"02d2a31e-7e57-49bc-a6ba-cc266ae7d05f"}
{"parentUuid":"21a090c7-77af-40b8-882b-669e559e78c9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018nmvUphiXqDKKzYJPz71rq","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto, ahora entiendo el problema completo. El issue ocurre porque:\n\n1. **Modal de pruebas psicométricas** (`modal-movimiento-6`) está abierto\n2. Usuario hace clic en \"Crear perfil\" desde el **Select2** del perfil\n3. Se abre el **modal de crear perfil** (`modal-crear-perfil`) encima\n4. Al cerrar el modal de crear perfil, el **Select2 queda en un estado \"abierto\" fantasma** que bloquea el scroll del modal principal\n\nEste es un problema conocido de **Select2 + Modales anidados de Bootstrap**. Voy a revisar el código JavaScript relacionado:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":1190,"cache_read_input_tokens":109595,"cache_creation":{"ephemeral_5m_input_tokens":1190,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX64RyDGoaZQJ1hEXE9t2","type":"assistant","uuid":"70d91a88-f444-4065-bfd8-7925c08e0fd6","timestamp":"2026-01-13T21:07:48.567Z"}
{"parentUuid":"70d91a88-f444-4065-bfd8-7925c08e0fd6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018nmvUphiXqDKKzYJPz71rq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Esv1CGLaLifZuRvA1UfonP","name":"Grep","input":{"pattern":"function crearPerfil","output_mode":"content","-C":10}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":1190,"cache_read_input_tokens":109595,"cache_creation":{"ephemeral_5m_input_tokens":1190,"ephemeral_1h_input_tokens":0},"output_tokens":264,"service_tier":"standard"}},"requestId":"req_011CX64RyDGoaZQJ1hEXE9t2","type":"assistant","uuid":"c9a9379b-44a0-4f61-919e-d61306156448","timestamp":"2026-01-13T21:07:49.473Z"}
{"parentUuid":"c9a9379b-44a0-4f61-919e-d61306156448","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Esv1CGLaLifZuRvA1UfonP","type":"tool_result","content":"c:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1479-        $('#contenedor-otra-discapacidad').empty();\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1480-    }\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1481-}\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1482-\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1483-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1484- * Función para crear el perfil manualmente.\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1485- * \nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1486- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1487- * @author José Manuel Jiménez\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1488- */\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js:1489:function crearPerfilManualmente() {\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1490-    $('#contenedor-campos-perfil').removeClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1491-    $('#contenedor-opciones-crear-ia').addClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1492-}\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1493-\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1494-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1495- * Función para manejar el cambio de archivo.\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1496- * \nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1497- * @param {HTMLElement} archivo Elemento HTML del archivo cargado.\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1498- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1499- * @author José Manuel Jiménez\n--\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1321-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1322-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1323-}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1324-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1325-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1326- * Función para consultar los factores y abrir la modal de creación de perfiles.\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1327- *\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1328- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1329- * @author Jair Carvajal\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1330- */\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js:1331:function crearPerfil(id_prueba = 0) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1332-    var id = 0;\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1333-    if (id_prueba == 0) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1334-        id = $(\"#btn_crear_perfil\").data('prueba');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1335-    } else {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1336-        id = id_prueba.toString();\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1337-        prueba_actual = id_prueba; \nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1338-    }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1339-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1340-    $('#tabs-container').removeClass('mx-4');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1341-\n--\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-843-            $boton.prop('disabled', false).html(textoOriginal);\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-844-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-845-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-846-}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-847-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-848-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-849- * Crea el perfil final con todos los datos\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-850- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-851- * @author Sergio Vargas\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-852- */\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js:853:function crearPerfilFinal() {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-854-    if (!perfil_generado) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-855-        mostrarToast('danger', 'No hay datos de perfil para crear');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-856-        return;\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-857-    }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-858-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-859-    if ($(\"#nivel_educativo_perfil\").val() == \"\" && (prueba_actual == 12 || prueba_actual == 7)) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-860-        mostrarErrorEnInput('#nivel_educativo_perfil', 'El nivel educativo es obligatorio');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-861-        return;       \nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-862-    }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-863-    \n--\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-485-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-486-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-487-}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-488-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-489-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-490- * Muestra el formulario de perfil manualmente\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-491- *\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-492- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-493- * @author Andres Gonzalez\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-494- */\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js:495:function crearPerfilManualmenteRevision() {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-496-    $('#contenedor-campos-perfil-revision').removeClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-497-    $('#contenedor-opciones-crear-ia-revision').addClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-498-}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-499-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-500-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-501- * Abre el modal para agregar un nivel educativo\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-502- *\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-503- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-504- * @author Andres Gonzalez\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-505- */"}]},"uuid":"f8aa48ee-322b-4693-98af-f54c2c563fc5","timestamp":"2026-01-13T21:07:54.708Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"c:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1479-        $('#contenedor-otra-discapacidad').empty();\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1480-    }\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1481-}\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1482-\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1483-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1484- * Función para crear el perfil manualmente.\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1485- * \nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1486- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1487- * @author José Manuel Jiménez\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1488- */\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js:1489:function crearPerfilManualmente() {\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1490-    $('#contenedor-campos-perfil').removeClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1491-    $('#contenedor-opciones-crear-ia').addClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1492-}\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1493-\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1494-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1495- * Función para manejar el cambio de archivo.\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1496- * \nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1497- * @param {HTMLElement} archivo Elemento HTML del archivo cargado.\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1498- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\src\\portal-empleo\\crear.js-1499- * @author José Manuel Jiménez\n--\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1321-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1322-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1323-}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1324-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1325-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1326- * Función para consultar los factores y abrir la modal de creación de perfiles.\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1327- *\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1328- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1329- * @author Jair Carvajal\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1330- */\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js:1331:function crearPerfil(id_prueba = 0) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1332-    var id = 0;\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1333-    if (id_prueba == 0) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1334-        id = $(\"#btn_crear_perfil\").data('prueba');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1335-    } else {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1336-        id = id_prueba.toString();\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1337-        prueba_actual = id_prueba; \nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1338-    }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1339-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1340-    $('#tabs-container').removeClass('mx-4');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1341-\n--\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-843-            $boton.prop('disabled', false).html(textoOriginal);\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-844-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-845-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-846-}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-847-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-848-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-849- * Crea el perfil final con todos los datos\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-850- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-851- * @author Sergio Vargas\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-852- */\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js:853:function crearPerfilFinal() {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-854-    if (!perfil_generado) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-855-        mostrarToast('danger', 'No hay datos de perfil para crear');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-856-        return;\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-857-    }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-858-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-859-    if ($(\"#nivel_educativo_perfil\").val() == \"\" && (prueba_actual == 12 || prueba_actual == 7)) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-860-        mostrarErrorEnInput('#nivel_educativo_perfil', 'El nivel educativo es obligatorio');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-861-        return;       \nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-862-    }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\generar-pruebas-ia.js-863-    \n--\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-485-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-486-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-487-}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-488-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-489-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-490- * Muestra el formulario de perfil manualmente\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-491- *\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-492- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-493- * @author Andres Gonzalez\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-494- */\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js:495:function crearPerfilManualmenteRevision() {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-496-    $('#contenedor-campos-perfil-revision').removeClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-497-    $('#contenedor-opciones-crear-ia-revision').addClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-498-}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-499-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-500-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-501- * Abre el modal para agregar un nivel educativo\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-502- *\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-503- * @returns {void}\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-504- * @author Andres Gonzalez\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\mis-pruebas\\aplicante\\aplicacion-revision-hv.js-505- */","numLines":87},"sourceToolAssistantUUID":"c9a9379b-44a0-4f61-919e-d61306156448"}
{"parentUuid":"f8aa48ee-322b-4693-98af-f54c2c563fc5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UBeDyQdzRnQLrWjDd5vc4i","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a revisar la función `crearPerfil` completa:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":4303,"cache_read_input_tokens":110785,"cache_creation":{"ephemeral_5m_input_tokens":4303,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX64T2Xym7MXnrB1W244N","type":"assistant","uuid":"8fb71689-3142-45d6-b6b4-19de6227d1e7","timestamp":"2026-01-13T21:07:58.862Z"}
{"parentUuid":"8fb71689-3142-45d6-b6b4-19de6227d1e7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UBeDyQdzRnQLrWjDd5vc4i","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DE9tBNRpeQzpUbuYT1F33r","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js","offset":1330,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":4303,"cache_read_input_tokens":110785,"cache_creation":{"ephemeral_5m_input_tokens":4303,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX64T2Xym7MXnrB1W244N","type":"assistant","uuid":"634fbf46-7b89-4df5-aacd-bc65d9c6ab0a","timestamp":"2026-01-13T21:08:00.646Z"}
{"parentUuid":"634fbf46-7b89-4df5-aacd-bc65d9c6ab0a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DE9tBNRpeQzpUbuYT1F33r","type":"tool_result","content":"  1330→ */\n  1331→function crearPerfil(id_prueba = 0) {\n  1332→    var id = 0;\n  1333→    if (id_prueba == 0) {\n  1334→        id = $(\"#btn_crear_perfil\").data('prueba');\n  1335→    } else {\n  1336→        id = id_prueba.toString();\n  1337→        prueba_actual = id_prueba; \n  1338→    }\n  1339→\n  1340→    $('#tabs-container').removeClass('mx-4');\n  1341→\n  1342→    if (id != 4) {\n  1343→        $('#tabs-container').addClass('mx-4')\n  1344→    }\n  1345→    $(\"#modal-crear-perfil_label\").text('Crear perfil');\n  1346→    $(\"#siguiente_perfil\").text('Siguiente');\n  1347→    $('#siguiente_perfil').data('id', 1);\n  1348→    $(\"#siguiente_perfil\").attr('disabled', true);\n  1349→    var clases_tab = '';\n  1350→    var instrucciones = '';\n  1351→    var clase_personalizada = '';\n  1352→    es_editar = false;\n  1353→    factores_etikos = {};\n  1354→\n  1355→    switch (id) {\n  1356→        case '3':\n  1357→            es_inteligencia = false;\n  1358→            clases_tab = 'col-4 justify-content-center';\n  1359→            instrucciones = 'Selecciona los valores que deseas evaluar en este perfil.';\n  1360→            clase_personalizada = 'perfil_selected';\n  1361→            $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n  1362→            $('#nivel_educativo_div').hide();\n  1363→\n  1364→            break;\n  1365→        case '4':\n  1366→            clases_tab = 'col-3 justify-content-center';\n  1367→            instrucciones = 'Arrastra las habilidades cognitivas de acuerdo al nivel que deseas asignar.';\n  1368→            $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n  1369→            $('#nivel_educativo_div').hide();\n  1370→\n  1371→            break;\n  1372→        case '7':\n  1373→            clases_tab = 'col-3 justify-content-center';\n  1374→            instrucciones = 'Arrastra las etiquetas de acuerdo al nivel que deseas asignar. .';\n  1375→            $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6')\n  1376→            $('#nivel_educativo_div').show();\n  1377→            break;\n  1378→        default:\n  1379→            clases_tab = 'col-3 justify-content-center';\n  1380→            $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6')\n  1381→            $('#nivel_educativo_div').show();\n  1382→            break;\n  1383→    }\n  1384→    let tag_etiquetas = '';\n  1385→    $('#tabs-container').empty();\n  1386→    restablecerBotones();\n  1387→    $.ajax({\n  1388→        url: `/pruebas/${id}/factores`,\n  1389→        type: 'GET',\n  1390→        success: function (response) {\n  1391→            informacion = response.data;\n  1392→            \n  1393→            var tabs = '';\n  1394→            if (id != 4) {\n  1395→                tabs = `\n  1396→                    ${crearTabsHorizontal({\n  1397→                    id: 'factores',\n  1398→                    tabs: response.data\n  1399→                        .filter(element => element.factor_id !== 78 && element.factor_id !== 16 && element.factor_id !== 35)\n  1400→                        .map((element, index) => {\n  1401→                            let etiquetas = '';\n  1402→                            element.factor.dimensiones.forEach(dimension => {\n  1403→                                if (element.factor_id == 77 || element.prueba_id == 3) {\n  1404→                                    tag_etiquetas = 'row justify-content-center gap-3';\n  1405→                                    var icono = '';\n  1406→                                    var tooltip = '';\n  1407→                                    if (element.factor_id == 77) {\n  1408→                                        icono = '<i class=\"bi bi-flag-fill text-danger me-3\"></i>';\n  1409→                                        tooltip = `${crearTooltip({ placement: `top`, content:  `${dimension.descripcion}`, toggle: `popover` })}`;\n  1410→                                    }\n  1411→                                    \n  1412→                                    etiquetas += `\n  1413→                                            ${crearCard({\n  1414→                                                col_tamanio: 'col-md-auto ',\n  1415→                                                nombre_grupo: `etiqueta_${element.factor_id}`,\n  1416→                                                hidden: true,\n  1417→                                                adicional: clase_personalizada,\n  1418→                                                contenido: `<div ${tooltip} class=\"text-center ${clase_personalizada}_contenido\" data-factor_id=\"${element.factor_id}\" data-dimension=\"${dimension.id}\">${icono} ${dimension.nombre}</div>`\n  1419→                                            })}\n  1420→                                        `;\n  1421→                                } else {\n  1422→                                    etiquetas += `<div class=\"tag\" data-id=\"${dimension.id}\">${dimension.nombre}</div>`;\n  1423→                                }\n  1424→                            });\n  1425→                            if (element.prueba_id == 12) {\n  1426→                                instrucciones = `Arrastra las ${element.factor.dimensiones.length} etiquetas de acuerdo al nivel que deseas asignar.`;\n  1427→                            }\n  1428→                            let minimo_Requerido = '';\n  1429→                            if (index == 0) {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"228623b1-8ebe-4ea7-a499-6e7f98964eea","timestamp":"2026-01-13T21:08:02.785Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js","content":" */\nfunction crearPerfil(id_prueba = 0) {\n    var id = 0;\n    if (id_prueba == 0) {\n        id = $(\"#btn_crear_perfil\").data('prueba');\n    } else {\n        id = id_prueba.toString();\n        prueba_actual = id_prueba; \n    }\n\n    $('#tabs-container').removeClass('mx-4');\n\n    if (id != 4) {\n        $('#tabs-container').addClass('mx-4')\n    }\n    $(\"#modal-crear-perfil_label\").text('Crear perfil');\n    $(\"#siguiente_perfil\").text('Siguiente');\n    $('#siguiente_perfil').data('id', 1);\n    $(\"#siguiente_perfil\").attr('disabled', true);\n    var clases_tab = '';\n    var instrucciones = '';\n    var clase_personalizada = '';\n    es_editar = false;\n    factores_etikos = {};\n\n    switch (id) {\n        case '3':\n            es_inteligencia = false;\n            clases_tab = 'col-4 justify-content-center';\n            instrucciones = 'Selecciona los valores que deseas evaluar en este perfil.';\n            clase_personalizada = 'perfil_selected';\n            $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n            $('#nivel_educativo_div').hide();\n\n            break;\n        case '4':\n            clases_tab = 'col-3 justify-content-center';\n            instrucciones = 'Arrastra las habilidades cognitivas de acuerdo al nivel que deseas asignar.';\n            $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n            $('#nivel_educativo_div').hide();\n\n            break;\n        case '7':\n            clases_tab = 'col-3 justify-content-center';\n            instrucciones = 'Arrastra las etiquetas de acuerdo al nivel que deseas asignar. .';\n            $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6')\n            $('#nivel_educativo_div').show();\n            break;\n        default:\n            clases_tab = 'col-3 justify-content-center';\n            $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6')\n            $('#nivel_educativo_div').show();\n            break;\n    }\n    let tag_etiquetas = '';\n    $('#tabs-container').empty();\n    restablecerBotones();\n    $.ajax({\n        url: `/pruebas/${id}/factores`,\n        type: 'GET',\n        success: function (response) {\n            informacion = response.data;\n            \n            var tabs = '';\n            if (id != 4) {\n                tabs = `\n                    ${crearTabsHorizontal({\n                    id: 'factores',\n                    tabs: response.data\n                        .filter(element => element.factor_id !== 78 && element.factor_id !== 16 && element.factor_id !== 35)\n                        .map((element, index) => {\n                            let etiquetas = '';\n                            element.factor.dimensiones.forEach(dimension => {\n                                if (element.factor_id == 77 || element.prueba_id == 3) {\n                                    tag_etiquetas = 'row justify-content-center gap-3';\n                                    var icono = '';\n                                    var tooltip = '';\n                                    if (element.factor_id == 77) {\n                                        icono = '<i class=\"bi bi-flag-fill text-danger me-3\"></i>';\n                                        tooltip = `${crearTooltip({ placement: `top`, content:  `${dimension.descripcion}`, toggle: `popover` })}`;\n                                    }\n                                    \n                                    etiquetas += `\n                                            ${crearCard({\n                                                col_tamanio: 'col-md-auto ',\n                                                nombre_grupo: `etiqueta_${element.factor_id}`,\n                                                hidden: true,\n                                                adicional: clase_personalizada,\n                                                contenido: `<div ${tooltip} class=\"text-center ${clase_personalizada}_contenido\" data-factor_id=\"${element.factor_id}\" data-dimension=\"${dimension.id}\">${icono} ${dimension.nombre}</div>`\n                                            })}\n                                        `;\n                                } else {\n                                    etiquetas += `<div class=\"tag\" data-id=\"${dimension.id}\">${dimension.nombre}</div>`;\n                                }\n                            });\n                            if (element.prueba_id == 12) {\n                                instrucciones = `Arrastra las ${element.factor.dimensiones.length} etiquetas de acuerdo al nivel que deseas asignar.`;\n                            }\n                            let minimo_Requerido = '';\n                            if (index == 0) {","numLines":100,"startLine":1330,"totalLines":2541}},"sourceToolAssistantUUID":"634fbf46-7b89-4df5-aacd-bc65d9c6ab0a"}
{"parentUuid":"228623b1-8ebe-4ea7-a499-6e7f98964eea","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01AqFJ85udRBGL6wGcYGRHLD","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora necesito ver los eventos del modal de crear perfil para entender qué sucede al cerrarse:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":1885,"cache_read_input_tokens":115088,"cache_creation":{"ephemeral_5m_input_tokens":1885,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX64TfxkW9bd9bovRBGAv","type":"assistant","uuid":"d86923ee-6587-4b38-b6db-635a2a7f3b76","timestamp":"2026-01-13T21:08:07.889Z"}
{"parentUuid":"d86923ee-6587-4b38-b6db-635a2a7f3b76","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01AqFJ85udRBGL6wGcYGRHLD","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KMtSD2g9BkAyuUobXVGh7A","name":"Grep","input":{"pattern":"modal-crear-perfil.*hidden","output_mode":"content","-C":15}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":1885,"cache_read_input_tokens":115088,"cache_creation":{"ephemeral_5m_input_tokens":1885,"ephemeral_1h_input_tokens":0},"output_tokens":123,"service_tier":"standard"}},"requestId":"req_011CX64TfxkW9bd9bovRBGAv","type":"assistant","uuid":"8c7d6305-e440-4509-8c01-3c8a73a76732","timestamp":"2026-01-13T21:08:08.935Z"}
{"parentUuid":"8c7d6305-e440-4509-8c01-3c8a73a76732","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KMtSD2g9BkAyuUobXVGh7A","type":"tool_result","content":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1135-            return;\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1136-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1137-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1138-        if (tabulador_id == 'factor_id_0' || tabulador_id == 'factor_id_1' && !es_editar) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1139-            if (tabs_Completados[tabulador_id]) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1140-                $('#siguiente_perfil').attr('disabled', false);\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1141-            } else {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1142-                $('#siguiente_perfil').attr('disabled', true);\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1143-            }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1144-        } else {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1145-            $('#siguiente_perfil').attr('disabled', false);\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1146-            return;\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1147-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1148-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1149-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js:1150:    $('#modal-crear-perfil').on('hidden.bs.modal', function () {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1151-        if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1152-            $(\"#siguiente_perfil\").text('Siguiente');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1153-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1154-        if ($('#modal-movimiento-6').length) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1155-            $('#modal-movimiento-6').removeClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1156-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1157-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1158-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1159-    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1160-        $('#modal-movimiento-6').removeClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1161-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1162-});\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1163-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1164-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1165- * Función para aplicar los filtros avanzados aplicados."}]},"uuid":"a8105c8e-c044-4186-8a63-b8265cce3f15","timestamp":"2026-01-13T21:08:12.650Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1135-            return;\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1136-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1137-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1138-        if (tabulador_id == 'factor_id_0' || tabulador_id == 'factor_id_1' && !es_editar) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1139-            if (tabs_Completados[tabulador_id]) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1140-                $('#siguiente_perfil').attr('disabled', false);\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1141-            } else {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1142-                $('#siguiente_perfil').attr('disabled', true);\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1143-            }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1144-        } else {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1145-            $('#siguiente_perfil').attr('disabled', false);\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1146-            return;\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1147-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1148-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1149-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js:1150:    $('#modal-crear-perfil').on('hidden.bs.modal', function () {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1151-        if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1152-            $(\"#siguiente_perfil\").text('Siguiente');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1153-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1154-        if ($('#modal-movimiento-6').length) {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1155-            $('#modal-movimiento-6').removeClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1156-        }\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1157-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1158-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1159-    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1160-        $('#modal-movimiento-6').removeClass('d-none');\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1161-    });\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1162-});\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1163-\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1164-/**\nc:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js-1165- * Función para aplicar los filtros avanzados aplicados.","numLines":31},"sourceToolAssistantUUID":"8c7d6305-e440-4509-8c01-3c8a73a76732"}
{"parentUuid":"a8105c8e-c044-4186-8a63-b8265cce3f15","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01FeBqCaKA89XM5J7Hd2RjPo","type":"message","role":"assistant","content":[{"type":"text","text":"¡Perfecto! Encontré el problema y la solución. El issue está en las líneas 1154-1156 del archivo `perfiles-pruebas.js`. Cuando el modal de crear perfil se cierra, se vuelve a mostrar el modal de pruebas psicométricas, pero **NO se está cerrando el Select2** que quedó abierto.\n\nAhora voy a implementar la solución:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":1727,"cache_read_input_tokens":116973,"cache_creation":{"ephemeral_5m_input_tokens":1727,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CX64UW4iXZMqk8RpwKH7R","type":"assistant","uuid":"f2992ec0-a417-40e6-a86b-573488e52766","timestamp":"2026-01-13T21:08:26.007Z"}
{"parentUuid":"f2992ec0-a417-40e6-a86b-573488e52766","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01FeBqCaKA89XM5J7Hd2RjPo","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TBZcczT8kEVMNezZLNQ9po","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js","offset":1145,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":1727,"cache_read_input_tokens":116973,"cache_creation":{"ephemeral_5m_input_tokens":1727,"ephemeral_1h_input_tokens":0},"output_tokens":231,"service_tier":"standard"}},"requestId":"req_011CX64UW4iXZMqk8RpwKH7R","type":"assistant","uuid":"e9d311e1-a33e-457d-b046-982d31a309dc","timestamp":"2026-01-13T21:08:26.956Z"}
{"parentUuid":"e9d311e1-a33e-457d-b046-982d31a309dc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TBZcczT8kEVMNezZLNQ9po","type":"tool_result","content":"  1145→            $('#siguiente_perfil').attr('disabled', false);\n  1146→            return;\n  1147→        }\n  1148→    });\n  1149→\n  1150→    $('#modal-crear-perfil').on('hidden.bs.modal', function () {\n  1151→        if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\n  1152→            $(\"#siguiente_perfil\").text('Siguiente');\n  1153→        }\n  1154→        if ($('#modal-movimiento-6').length) {\n  1155→            $('#modal-movimiento-6').removeClass('d-none');\n  1156→        }\n  1157→    });\n  1158→\n  1159→    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\n  1160→        $('#modal-movimiento-6').removeClass('d-none');\n  1161→    });\n  1162→});\n  1163→\n  1164→/**\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"42f60e23-417c-47d5-a464-37b6c66da5cd","timestamp":"2026-01-13T21:08:29.128Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js","content":"            $('#siguiente_perfil').attr('disabled', false);\n            return;\n        }\n    });\n\n    $('#modal-crear-perfil').on('hidden.bs.modal', function () {\n        if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\n            $(\"#siguiente_perfil\").text('Siguiente');\n        }\n        if ($('#modal-movimiento-6').length) {\n            $('#modal-movimiento-6').removeClass('d-none');\n        }\n    });\n\n    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\n        $('#modal-movimiento-6').removeClass('d-none');\n    });\n});\n\n/**","numLines":20,"startLine":1145,"totalLines":2541}},"sourceToolAssistantUUID":"e9d311e1-a33e-457d-b046-982d31a309dc"}
{"parentUuid":"42f60e23-417c-47d5-a464-37b6c66da5cd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01E2vDFbmiLxiF1XaihBLBzm","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a aplicar la solución. El problema es que cuando se cierra el modal de crear perfil, los Select2 del modal de pruebas psicométricas pueden quedar abiertos. La solución es **cerrar todos los Select2 abiertos** antes de volver a mostrar el modal principal:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":570,"cache_read_input_tokens":118700,"cache_creation":{"ephemeral_5m_input_tokens":570,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CX64VY3Z89TYexmqG3cvF","type":"assistant","uuid":"c07886ac-ffa9-4da9-8283-36168d47532b","timestamp":"2026-01-13T21:08:33.788Z"}
{"parentUuid":"c07886ac-ffa9-4da9-8283-36168d47532b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01E2vDFbmiLxiF1XaihBLBzm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RGBrJX7WaySRPToXNFuGB3","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js","old_string":"    $('#modal-crear-perfil').on('hidden.bs.modal', function () {\n        if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\n            $(\"#siguiente_perfil\").text('Siguiente');\n        }\n        if ($('#modal-movimiento-6').length) {\n            $('#modal-movimiento-6').removeClass('d-none');\n        }\n    });","new_string":"    $('#modal-crear-perfil').on('hidden.bs.modal', function () {\n        if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\n            $(\"#siguiente_perfil\").text('Siguiente');\n        }\n        if ($('#modal-movimiento-6').length) {\n            // Cerrar todos los Select2 abiertos para evitar que queden \"pegados\"\n            $('#modal-movimiento-6 .select2-hidden-accessible').each(function() {\n                $(this).select2('close');\n            });\n\n            // Remover cualquier dropdown de Select2 que pueda quedar abierto\n            $('.select2-container--open').removeClass('select2-container--open');\n\n            $('#modal-movimiento-6').removeClass('d-none');\n        }\n    });"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":570,"cache_read_input_tokens":118700,"cache_creation":{"ephemeral_5m_input_tokens":570,"ephemeral_1h_input_tokens":0},"output_tokens":497,"service_tier":"standard"}},"requestId":"req_011CX64VY3Z89TYexmqG3cvF","type":"assistant","uuid":"f3d39d07-e696-440d-8890-ed4f98927aff","timestamp":"2026-01-13T21:08:38.230Z"}
{"type":"file-history-snapshot","messageId":"f3d39d07-e696-440d-8890-ed4f98927aff","snapshot":{"messageId":"a198ebd8-2c10-4cf8-8131-4e727693cd96","trackedFileBackups":{"public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js":{"backupFileName":"377b8b3bd26fae44@v1","version":1,"backupTime":"2026-01-13T21:10:12.621Z"}},"timestamp":"2026-01-13T21:07:23.977Z"},"isSnapshotUpdate":true}
{"parentUuid":"f3d39d07-e696-440d-8890-ed4f98927aff","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01RGBrJX7WaySRPToXNFuGB3","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  1146→            return;\n  1147→        }\n  1148→    });\n  1149→\n  1150→    $('#modal-crear-perfil').on('hidden.bs.modal', function () {\n  1151→        if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\n  1152→            $(\"#siguiente_perfil\").text('Siguiente');\n  1153→        }\n  1154→        if ($('#modal-movimiento-6').length) {\n  1155→            // Cerrar todos los Select2 abiertos para evitar que queden \"pegados\"\n  1156→            $('#modal-movimiento-6 .select2-hidden-accessible').each(function() {\n  1157→                $(this).select2('close');\n  1158→            });\n  1159→\n  1160→            // Remover cualquier dropdown de Select2 que pueda quedar abierto\n  1161→            $('.select2-container--open').removeClass('select2-container--open');\n  1162→\n  1163→            $('#modal-movimiento-6').removeClass('d-none');\n  1164→        }\n  1165→    });\n  1166→\n  1167→    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\n  1168→        $('#modal-movimiento-6').removeClass('d-none');\n  1169→    });"}]},"uuid":"50c5754a-9391-4b4e-bba4-189321e9d885","timestamp":"2026-01-13T21:10:12.770Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js","oldString":"    $('#modal-crear-perfil').on('hidden.bs.modal', function () {\n        if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\n            $(\"#siguiente_perfil\").text('Siguiente');\n        }\n        if ($('#modal-movimiento-6').length) {\n            $('#modal-movimiento-6').removeClass('d-none');\n        }\n    });","newString":"    $('#modal-crear-perfil').on('hidden.bs.modal', function () {\n        if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\n            $(\"#siguiente_perfil\").text('Siguiente');\n        }\n        if ($('#modal-movimiento-6').length) {\n            // Cerrar todos los Select2 abiertos para evitar que queden \"pegados\"\n            $('#modal-movimiento-6 .select2-hidden-accessible').each(function() {\n                $(this).select2('close');\n            });\n\n            // Remover cualquier dropdown de Select2 que pueda quedar abierto\n            $('.select2-container--open').removeClass('select2-container--open');\n\n            $('#modal-movimiento-6').removeClass('d-none');\n        }\n    });","originalFile":"var datos_ids = [];\nvar json_filtros = {};\nvar filtro_html = '';\nvar es_archivado = false;\nvar nombre_tabla = 'tabla-pefiles-pruebas';\nvar tabs_Completados = {};\nvar es_editar = false;\nvar factores_etikos = {}\nvar informacion;\nvar prueba_actual = 0;\nlet perfil_generado = null;\nlet es_inteligencia = false;\nlet es_detalle = false;\n\n$(`#${nombre_tabla}`).DataTable({\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [10, 25, 50, 100, 200],\n        [10, 25, 50, 100, 200]\n    ],\n    scrollX: true,\n    scrollY: false,\n    scrollCollapse: true,\n    ajax: {\n        url: `/perfiles-listado-empresa`,\n        data: function (datos) {\n            prueba_actual = $('#listado_pruebas_perfiles button.active').val();\n            datos.prueba_id = $('#listado_pruebas_perfiles button.active').val();\n            datos.archivado = es_archivado;\n            datos.recientes = $('#filtro_mas_recientes').val();\n            (json_filtros?.chips?.length > 0) ? datos.nombres = json_filtros.chips : '';\n            (json_filtros.nombre_creador) ? datos.usuario_id = json_filtros.nombre_creador : '';\n            if (typeof json_filtros.fecha_filtro === 'string') {\n                const partesFecha = json_filtros.fecha_filtro.split(' a ');\n                (partesFecha[0]) ? datos.fecha_inicio = partesFecha[0] : '';\n                (partesFecha[1]) ? datos.fecha_fin = partesFecha[1] : '';\n            }\n            $(\"#btn_crear_perfil\").data(\"prueba\", prueba_actual);\n            if (['12', '3', '4', '7'].includes(prueba_actual)) {\n                $(\"#btn_crear_perfil\").attr('disabled', false)\n            } else {\n                $(\"#btn_crear_perfil\").attr('disabled', true)\n            }\n        }\n    },\n    columns: [\n        {\n            data: null,\n            orderable: false,\n            className: 'p-2 rounded-3',\n            render: (dato) => {\n                var color_borde = '';\n                switch (prueba_actual) {\n                    case '3':\n                        color_borde = 'borde-ethikos';\n                        break;\n                    case '4':\n                        color_borde = 'borde-iq';\n                        break;\n                    case '7':\n                        color_borde = 'borde-potencial';\n                        break;\n                    case '12':\n                        color_borde = 'borde-tendisc';\n                        break;\n                    default:\n                        break;\n                }\n                return `\n                    <div class=\"card card-hover-opciones rounded-3 shadow-1 position-relative card-area-trabajo\">\n                        <div class=\"card-body ${dato?.es_publico == 1 ? color_borde : ''}\">\n                            <div class=\"row\">\n                                <div class=\"col-auto row my-auto\">\n                                    <img src='/imagenes/logos/pruebas/${dato?.prueba?.slug ?? ''}.png' class=\"rounded-circle\" alt=\"Foto de perfil\" width=\"60px\" height=\"60px\">\n                                </div>\n                                <div class=\"col\">\n                                   <p class=\"text-body-2 text-gray-10 fw-semibold\">${dato?.nombre ?? 'N/A'}</p>\n                                   <p class=\"text-body-2 mb-0 text-gray-30\">Creador: ${dato?.usuario?.nombre_completo ?? 'N/A'}</p>\n                                   <p class=\"text-body-2 mb-0 text-gray-30\">Creación: ${formatearFecha2(`${dato.created_at}`)}</p>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"opciones-card-hover rounded-end-3\">\n                            ${(!es_archivado) ? `\n                                    ${crearBoton({ clases: `btn-text-primary rounded-circle editar-perfil ${dato?.tiene_procesos_prueba || dato?.es_publico == 1 ? 'd-none' : ''}`, texto: '<i class=\"text-body-1 bi bi-pencil-square\"></i>', adicional: `${crearTooltip({ placement: `top`, content: `Editar`, toggle: `popover`, })} ${dato?.tiene_procesos_prueba || dato?.es_publico == 1 ? 'disabled' : ''} data-id_perfil='${dato.id}'` })}\n                                    <div class=\"boton-mas-opciones position-relative\">\n                                        <button class=\"btn btn-text-primary btn-circle\">\n                                            <i class=\"bi bi-three-dots\"></i>\n                                        </button>\n                                        <!-- Menú personalizado oculto -->\n                                        <div class=\"menu-mas-opciones\">\n                                            <button class=\"dropdown-item\" onclick=\"descargarPDF(${dato.id})\">Descargar</button>\n                                            <button class=\"dropdown-item\" onclick=\"$('#modal-duplicar-perfil').modal('show'); $('#id_perfil_duplicar').val(${dato.id}); $('#nombre_perfil_copia').val('${dato.nombre}'+' (Copia)')\">Duplicar</button>\n                                            <button class=\"dropdown-item ver-detalle\" data-id_perfil='${dato.id}'>Ver detalle</button>\n                                            <button class=\"${dato?.es_publico == 1 ? 'd-none' : ''} dropdown-item\" onclick=\"$('#modal-archivar-perfil').modal('show'); $('#id_perfil_archivar').val(${dato.id})\" ${dato?.es_publico == 1 ? 'disabled' : ''}>Archivar</button>\n                                            <button class=\"${dato?.tiene_procesos_prueba || dato?.es_publico == 1 ? 'd-none' : ''} dropdown-item text-danger\" onclick=\"$('#modal-eliminar-perfil').modal('show'); $('#id_perfil_eliminar').val(${dato.id})\" ${dato?.tiene_procesos_prueba || dato?.es_publico == 1 ? 'disabled' : ''}>Eliminar</button>\n                                        </div>\n                                    </div>\n                                ` : `\n                                    ${crearBoton({ clases: 'btn-text-primary rounded-circle', texto: '<i class=\"text-body-1 bi bi-archive-fill\"></i>', onclick: `archivarPerfil(${dato.id}, false)`, adicional: `${crearTooltip({ placement: `top`, content: `Desarchivar`, toggle: `popover`, })}` })}\n                                `\n                            }\n                        </div>\n                    </div>\n                `;\n            }\n        }\n    ],\n    drawCallback: function (settings) {\n        datos_ids = $(`#${nombre_tabla}`).DataTable().data().toArray();\n        validarDatos();\n        inicializarTooltips();\n        $('.opciones-card-hover').hide();\n        if ($('.card-area-trabajo').last().parent()[0] != undefined) {\n            $('.card-area-trabajo').last().parent()[0].classList.add('tamanio-uno');\n        }\n    },\n    initComplete: function (settings, json) {\n        datos_ids = $(`#${nombre_tabla}`).DataTable().data().toArray();\n        $(`#${nombre_tabla}`).find('tbody').addClass('tabla-cards-horizontal perfiles-horizontal');\n        $(`[aria-describedby=\"${nombre_tabla}_info\"] .thead-componente`).hide();\n        validarDatos();\n        inicializarTooltips();\n        $('.opciones-card-hover').hide();\n    }\n});\n\n$(document).ready(function () {\n    $(document).on('click', '.botones-grupo', function () {\n        $('.botones-grupo').removeClass('active');\n        $(this).addClass('active');\n        actualizarDatatables(`${nombre_tabla}`);\n    });\n\n    $(document).on('click', '.editar-perfil', function () {\n        es_detalle = false;\n        let id_perfil = $(this).data('id_perfil');\n        $(\"#id_perfil\").val(id_perfil);\n        $(\"#modal-crear-perfil_label\").text('Editar perfil');\n        restablecerBotones();\n        $('#tabs-container').empty();\n        $.ajax({\n            url: `/perfiles/${id_perfil}`,\n            type: 'GET',\n            success: function (response) {\n                response = response.data;\n                es_editar = true;\n                $('#siguiente_perfil').attr('disabled', false);\n                $('#modal-crear-perfil').modal('show');\n                $('#nombre-perfil').val(response.nombre);\n                $('#nivel_educativo').val(response.nivel_educativo_id).trigger('change');\n                $('#tipo_prueba').val(response.prueba_id).trigger('change');\n\n                $.ajax({\n                    url: `/pruebas/${response.prueba_id}/factores`,\n                    type: 'GET',\n                    success: function (resp_factores) {\n                        informacion = resp_factores.data;\n                        let tabs_data = [];\n                        let alerta = '';\n                        switch (response.prueba_id) {\n                            case 3:\n                                es_inteligencia = false;\n                                tabs_data = resp_factores.data.filter(element => element.factor_id !== 16).map((element, index) => {\n                                    let etiquetas = '';\n                                    let clase_personalizada = 'perfil_selected';\n                                    let tag_etiquetas = 'row justify-content-center gap-3';\n\n                                    let factor_perfil = response.factores_perfiles.find(fp => fp.factor_id === element.factor_id);\n                                    let dimensiones_seleccionadas = factor_perfil\n                                        ? factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id)\n                                        : [];\n\n                                    element.factor.dimensiones.forEach(dimension => {\n                                        let es_Seleccionada = dimensiones_seleccionadas.includes(dimension.id);\n                                        let clase_Extra = es_Seleccionada ? `${clase_personalizada} selected` : clase_personalizada;\n\n                                        etiquetas += `\n                                            ${crearCard({\n                                            col_tamanio: 'col-md-auto',\n                                            nombre_grupo: `etiqueta_${element.factor_id}`,\n                                            hidden: true,\n                                            adicional: clase_Extra,\n                                            contenido: `<div class=\"text-center ${clase_personalizada}_contenido ${es_Seleccionada ? 'selected' : ''}\"\n                                                                data-factor_id=\"${element.factor_id}\"\n                                                                data-dimension=\"${dimension.id}\">\n                                                                ${dimension.nombre}\n                                                            </div>`\n                                        })}\n                                        `;\n                                    });\n\n                                    return {\n                                        id: 'factor_id_' + index,\n                                        titulo: element.factor.nombre,\n                                        tooltip: element.factor.descripcion,\n                                        clase_nav: 'col-4 justify-content-center',\n                                        contenido: `\n                                            <div class=\"row mx-3\">\n                                                <input type=\"hidden\" id=\"factor_id_escondido\" name=\"factor_id\" value=\"${element.factor_id}\">\n                                                <div class=\"mt-4\">\n                                                    <p>Selecciona minimo 2 valores que deseas para evaluar en este perfil.</p>\n                                                </div>\n                                                <div class=\"tags-container ${tag_etiquetas} col-10\">\n                                                    ${etiquetas}\n                                                </div>\n                                            </div>\n                                        `,\n                                        activo: index === 0,\n                                        disabled: es_editar ? false : index !== 0\n                                    };\n                                });\n\n                                $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n                                $('#nivel_educativo_div').hide();\n                                break;\n                            case 4:\n                                let etiquetas_libres_case4 = '';\n                                let etiquetas_medio = '';\n                                let etiquetas_alto = '';\n                                let etiquetas_avanzado = '';\n\n                                resp_factores.data.forEach(factorPrueba => {\n                                    // buscamos si este factor está en response.factores_perfiles\n                                    let factorPerfil = response.factores_perfiles.find(fp => fp.factor_id === factorPrueba.factor.id);\n\n                                    if (factorPerfil && factorPerfil.dimensiones_factores_perfiles.length > 0) {\n                                        // tomar solo el primer dato de dimensiones_factores_perfiles\n                                        let dfp = factorPerfil.dimensiones_factores_perfiles[0];\n                                        let etiquetaHTML = `<div class=\"tag\" data-id=\"${factorPrueba.factor.id}\">${factorPrueba.factor.nombre}</div>`;\n\n                                        if (dfp.limite_inferior >= 50 && dfp.limite_superior <= 70) {\n                                            etiquetas_medio += etiquetaHTML;\n                                        } else if (dfp.limite_inferior >= 71 && dfp.limite_superior <= 90) {\n                                            etiquetas_alto += etiquetaHTML;\n                                        } else if (dfp.limite_inferior >= 91 && dfp.limite_superior <= 100) {\n                                            etiquetas_avanzado += etiquetaHTML;\n                                        } else {\n                                            etiquetas_libres_case4 += etiquetaHTML; // si no cae en ningún rango\n                                        }\n                                    } else {\n                                        // si el factor no está en el perfil → queda libre\n                                        etiquetas_libres_case4 += `<div class=\"tag\" data-id=\"${factorPrueba.factor.id}\">${factorPrueba.factor.nombre}</div>`;\n                                    }\n                                });\n\n                                let valor_medio = '50 - 70';\n                                let valor_alto = '71 - 90';\n                                let valor_avanzado = '91 - 100';\n\n                                let contenido_case4 = `\n                                        <div class=\"row mx-3\">\n                                            <div class=\"mt-4\">\n                                                <p>Arrastra las habilidades cognitivas de acuerdo al nivel que deseas asignar.</p>\n                                            </div>\n                                            <div class=\"d-flex mb-2\">\n                                                ${crearBoton({\n                                                    type: 'button',\n                                                    clases: 'btn-primary btn-restablecer-etiquetas',\n                                                    texto: '<i class=\"bi bi-bag-x-fill me-3\"></i> Restablecer',\n                                                    data: [{ texto: 'FACTOR-id', value: 4 }]\n                                                })}\n                                                <div class=\"tags-container col-10\">\n                                                    ${etiquetas_libres_case4}\n                                                </div>\n                                            </div>\n                                            <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                    <div class=\"nivel medio\">\n                                                        <div class=\"zona-tags drop-zone\" data-nivel=\"medio\"><label class=\"arrastra_medio text-gray-60 text-body-2\"></label>${etiquetas_medio}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio}`, toggle: `popover` })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                    <div class=\"nivel alto\">\n                                                        <div class=\"zona-tags drop-zone\" data-nivel=\"alto\"><label class=\"arrastra_alto text-gray-60 text-body-2\"></label>${etiquetas_alto}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto}`, toggle: `popover` })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                    <div class=\"nivel avanzado\">\n                                                        <div class=\"zona-tags drop-zone\" data-nivel=\"avanzado\"><label class=\"arrastra_avanzado text-gray-60 text-body-2\"></label>${etiquetas_avanzado}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado}`, toggle: `popover` })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    `;\n\n                                $('#tabs-container').append(contenido_case4);\n                                $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n                                $('#nivel_educativo_div').hide();\n                                break;\n\n                            case 7:\n                                tabs_data = response.factores_perfiles\n                                    .filter(factor_perfil => factor_perfil.factor_id !== 35)\n                                    .map((factor_perfil, index) => {\n                                        let factor_Prueba = resp_factores.data.find(f => f.factor_id === factor_perfil.factor_id);\n                                        let dimensiones_Perfil_Ids = factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id);\n                                        let dimensiones_Prueba = factor_Prueba.factor.dimensiones;\n                                        let etiquetas_libres = '';\n                                        dimensiones_Prueba\n                                            .filter(d => !dimensiones_Perfil_Ids.includes(d.id))\n                                            .forEach(d => {\n                                                etiquetas_libres += `<div class=\"tag\" data-id=\"${d.id}\">${d.nombre}</div>`;\n                                            });\n\n                                        let etiquetas_medio = '';\n                                        let etiquetas_alto = '';\n                                        let etiquetas_avanzado = '';\n\n                                        factor_perfil.dimensiones_factores_perfiles.forEach(df => {\n                                            let etiquetaHTML = `<div class=\"tag\" data-id=\"${df.dimension.id}\">${df.dimension.nombre}</div>`;\n                                            if (df.limite_inferior >= 50 && df.limite_superior <= 70) etiquetas_medio += etiquetaHTML;\n                                            else if (df.limite_inferior >= 71 && df.limite_superior <= 90) etiquetas_alto += etiquetaHTML;\n                                            else if (df.limite_inferior >= 91 && df.limite_superior <= 100) etiquetas_avanzado += etiquetaHTML;\n                                        });\n\n                                        let instrucciones = `Arrastra las ${dimensiones_Prueba.length} etiquetas de acuerdo al nivel que deseas asignar.`;\n\n                                        let valor_medio = '50 - 70';\n                                        let valor_alto = '71 - 90';\n                                        let valor_avanzado = '91 - 100';\n\n                                        let contenido_medio = `\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                <div class=\"nivel medio\">\n                                                    <div class=\"zona-tags drop-zone\" data-nivel=\"medio\"><label class=\"arrastra_medio text-gray-60 text-body-2\"></label>${etiquetas_medio}</div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio}`, toggle: `popover` })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        `;\n\n                                        let contenido_alto = `\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                <div class=\"nivel alto\">\n                                                    <div class=\"zona-tags drop-zone\" data-nivel=\"alto\"><label class=\"arrastra_alto text-gray-60 text-body-2\"></label>${etiquetas_alto}</div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto}`, toggle: `popover` })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        `;\n\n                                        let contenido_avanzado = `\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                <div class=\"nivel avanzado\">\n                                                    <div class=\"zona-tags drop-zone\" data-nivel=\"avanzado\"><label class=\"arrastra_avanzado text-gray-60 text-body-2\"></label>${etiquetas_avanzado}</div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado}`, toggle: `popover` })} class=\"zona-rango text-white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        `;\n\n                                        return {\n                                            id: 'factor_id_' + index,\n                                            titulo: factor_perfil.factor.nombre,\n                                            tooltip: factor_perfil.factor.descripcion,\n                                            activo: index === 0,\n                                            disabled: false,\n                                            contenido: `\n                                            <div class=\"row mx-3\">\n                                                <input type=\"hidden\" name=\"factor_id\" value=\"${factor_perfil.factor_id}\">\n                                                <div class=\"mt-4\">\n                                                    <p>${instrucciones}</p>\n                                                </div>\n                                                <div class=\"d-flex mb-2\">\n                                                    ${crearBoton({\n                                                        type: 'button',\n                                                        clases: 'btn-primary btn-restablecer-etiquetas',\n                                                        texto: '<i class=\"bi bi-bag-x-fill me-3\"></i> Restablecer',\n                                                        data: [{ texto: 'FACTOR-id', value: factor_perfil.factor_id }]\n                                                    })}\n                                                    <div class=\"tags-container col-10\">\n                                                        ${etiquetas_libres}\n                                                    </div>\n                                                </div>\n                                                <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                    ${contenido_medio}\n                                                    ${contenido_alto}\n                                                    ${contenido_avanzado}\n                                                </div>\n                                            </div>\n                                        `\n                                        };\n                                    });\n                                    \n                                $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6');\n                                $('#nivel_educativo_div').show();\n                                restablecerBoton();\n                                break;\n\n                            case 12:\n                                tabs_data = response.factores_perfiles\n                                    .filter(factor_perfil => factor_perfil.factor_id !== 78)\n                                    .map((factor_perfil, index) => {\n                                        if (factor_perfil.factor_id == 77) {\n                                            let factor_Prueba = resp_factores.data.find(f => f.factor_id == 77);\n                                            let etiquetas = '';\n                                            factor_Prueba.factor.dimensiones.forEach(element => {\n                                                etiquetas += `\n                                                    ${crearCard({\n                                                        col_tamanio: 'col-md-auto',\n                                                        nombre_grupo: `etiqueta_${element.factor_id}`,\n                                                        hidden: true,\n                                                        contenido: `<div ${crearTooltip({ placement: `top`, content:  `${element.descripcion}`, toggle: `popover` })}><i class=\"bi bi-flag-fill text-danger me-3\"></i> ${element.nombre}</div>`\n                                                    })}\n                                                `;\n                                            });\n\n                                            return {\n                                                id: 'factor_id_riesgos',\n                                                titulo: 'Riesgos laborales',\n                                                tooltip: 'Riesgos laborales',\n                                                activo: false,\n                                                disabled: false,\n                                                contenido: `\n                                                <div class=\"row mx-3\">\n                                                    <div class=\"mt-4\">\n                                                        <p>\n                                                            Conoce los riesgos emocionales que evaluamos en Ten DISC Plus.\n                                                            Acerca el cursor para ver la definición.\n                                                        </p>\n                                                    </div>\n                                                    <div class=\"row justify-content-center gap-3\">\n                                                        ${etiquetas}\n                                                    </div>\n                                                </div>\n                                            `\n                                            };\n                                        }\n\n                                        let factor_Prueba = resp_factores.data.find(f => f.factor_id === factor_perfil.factor_id);\n                                        let dimensiones_Perfil_Ids = factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id);\n                                        let dimensiones_Prueba = factor_Prueba.factor.dimensiones;\n\n                                        let etiquetas_libres = '';\n                                        dimensiones_Prueba\n                                            .filter(d => !dimensiones_Perfil_Ids.includes(d.id))\n                                            .forEach(d => {\n                                                etiquetas_libres += `<div class=\"tag\" data-id=\"${d.id}\">${d.nombre}</div>`;\n                                            });\n\n                                        let etiquetas_bajo = '';\n                                        let etiquetas_medio = '';\n                                        let etiquetas_alto = '';\n                                        let etiquetas_avanzado = '';\n\n                                        factor_perfil.dimensiones_factores_perfiles.forEach(df => {\n                                            let etiquetaHTML = `<div class=\"tag\" data-id=\"${df.dimension.id}\">${df.dimension.nombre}</div>`;\n                                            if (df.limite_inferior >= 10 && df.limite_superior <= 40) etiquetas_bajo += etiquetaHTML;\n                                            else if (df.limite_inferior >= 41 && df.limite_superior <= 70) etiquetas_medio += etiquetaHTML;\n                                            else if ((index == 0 && df.limite_inferior >= 71 && df.limite_superior <= 100) || df.limite_inferior >= 71 && df.limite_superior <= 90) etiquetas_alto += etiquetaHTML;\n                                            else if (df.limite_inferior >= 91 && df.limite_superior <= 100) etiquetas_avanzado += etiquetaHTML;\n                                        });\n\n                                        let instrucciones = `Arrastra las ${dimensiones_Prueba.length} etiquetas de acuerdo al nivel que deseas asignar.`;\n                                        if (factor_perfil.factor_id == 77) {\n                                            instrucciones = `Conoce los riesgos emocionales que evaluamos en Ten DISC Plus. Acerca el cursor para ver la definición.`;\n                                        }\n\n                                        let valor_bajo = '10 - 40';\n                                        let valor_medio = '50 - 70';\n                                        let valor_alto = '71 - 90';\n                                        let valor_avanzado = '91 - 100';\n\n                                        let contenido_bajo = '';\n                                        if (index === 0) {\n                                            valor_medio = '41 - 70';\n                                            valor_alto = '71 - 100';\n                                            contenido_bajo = `\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill bajo-color mx-2\"></i><strong>Bajo</strong></p>\n                                                    <div class=\"nivel bajo\">\n                                                        <div class=\"zona-tags drop-zone\" data-nivel=\"bajo\"><label class=\"arrastra_bajo text-gray-60 text-body-2\"></label>${etiquetas_bajo}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_bajo}`, toggle: `popover` })} class=\"zona-rango\">${valor_bajo}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                            `;\n                                        }\n\n                                        let contenido_medio = `\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                    <div class=\"nivel medio\">\n                                                        <div class=\"zona-tags drop-zone\" data-nivel=\"medio\"><label class=\"arrastra_medio text-gray-60 text-body-2\"></label>${etiquetas_medio}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio}`, toggle: `popover` })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                            `;\n\n                                        let contenido_alto = `\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                <div class=\"nivel alto\">\n                                                    <div class=\"zona-tags drop-zone\" data-nivel=\"alto\"><label class=\"arrastra_alto text-gray-60 text-body-2\"></label>${etiquetas_alto}</div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto}`, toggle: `popover` })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        `;\n\n                                        let contenido_avanzado = '';\n                                        if (factor_perfil.factor_id == 75 || factor_perfil.factor_id == 76) {\n                                            contenido_avanzado = `\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                <div class=\"nivel avanzado\">\n                                                    <div class=\"zona-tags drop-zone\" data-nivel=\"avanzado\"><label class=\"arrastra_avanzado text-gray-60 text-body-2\"></label>${etiquetas_avanzado}</div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado}`, toggle: `popover` })} class=\"zona-rango text-white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        `;\n                                        }\n\n                                        if (factor_perfil.factor_id == 76) {\n                                            instrucciones = `Arrastra las etiquetas de acuerdo al nivel que deseas asignar.`;\n                                            alerta = `\n                                                    <div class=\"my-4\">\n                                                            ${crearAlerta('info', 'Esta sección es opcional. Puedes completarla si deseas incluir competencias específicas')}\n                                                    </div>\n                                                `;\n                                        }\n\n                                        return {\n                                            id: 'factor_id_' + index,\n                                            titulo: factor_perfil.factor.nombre,\n                                            tooltip: factor_perfil.factor.descripcion,\n                                            activo: index === 0,\n                                            disabled: false,\n                                            contenido: `\n                                            <div class=\"row mx-3\">\n                                                <input type=\"hidden\" name=\"factor_id\" value=\"${factor_perfil.factor_id}\">\n                                                ${alerta}\n                                                <div class=\"mt-4\">\n                                                    <p>${instrucciones}</p>\n                                                </div>\n                                                <div class=\"d-flex mb-2\">\n                                                    ${crearBoton({\n                                                        type: 'button',\n                                                        clases: 'btn-primary btn-restablecer-etiquetas',\n                                                        texto: '<i class=\"bi bi-bag-x-fill me-3\"></i> Restablecer',\n                                                        data: [{ texto: 'FACTOR-id', value: factor_perfil.factor_id }]\n                                                    })}\n                                                    <div class=\"tags-container col-10\">\n                                                        ${etiquetas_libres}\n                                                    </div>\n                                                </div>\n                                                <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                    ${contenido_bajo}\n                                                    ${contenido_medio}\n                                                    ${contenido_alto}\n                                                    ${contenido_avanzado}\n                                                </div>\n                                            </div>\n                                        `\n                                        };\n                                    });\n\n                                $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6')\n                                $('#nivel_educativo_div').show();\n                                restablecerBoton();\n                                break;\n                        }\n\n                        let tabs = crearTabsHorizontal({ id: 'factores', tabs: tabs_data });\n                        $('#tabs-container').append(tabs);\n                        inicializarTooltips();\n                        activarDrop();\n                    }\n                });\n            },\n            error: function () {\n                mostrarToast('danger', 'Ocurrió un error');\n            }\n        });\n        $(\"#siguiente_perfil\").removeAttr('data-id');\n        $(\"#siguiente_perfil\").removeData('id');\n        if (prueba_actual != 4) {\n            $(\"#siguiente_perfil\").text('Siguiente');\n        } else {\n            $(\"#siguiente_perfil\").text('Editar perfil');\n        }\n    });\n\n    $(document).on('click', '.ver-detalle', function () {\n        es_detalle = true;\n        let id_perfil = $(this).data('id_perfil');\n        $(\"#id_perfil\").val(id_perfil);\n        $(\"#modal-crear-perfil_label\").text('Visualizar perfil');\n        $(\".modal-crear-perfil\").addClass('d-none');\n        $('#tabs-container').empty();\n\n        $.ajax({\n            url: `/perfiles/${id_perfil}`,\n            type: 'GET',\n            success: function (response) {\n                response = response.data;\n                es_editar = false;\n                $('#siguiente_perfil').attr('disabled', true).hide(); \n                $('#modal-crear-perfil').modal('show');\n\n                $('#nombre-perfil').val(response.nombre).prop('disabled', true);\n                $('#nivel_educativo').val(response.nivel_educativo_id).trigger('change').prop('disabled', true);\n                $('#tipo_prueba').val(response.prueba_id).trigger('change').prop('disabled', true);\n\n                $.ajax({\n                    url: `/pruebas/${response.prueba_id}/factores`,\n                    type: 'GET',\n                    success: function (resp_factores) {\n                        informacion = resp_factores.data;\n                        let tabs_data = [];\n                        \n                        switch (response.prueba_id) {\n                            case 3:\n                                tabs_data = resp_factores.data\n                                    .filter(element => element.factor_id !== 16)\n                                    .map((element, index) => {\n                                        let etiquetas = '';\n                                        let clase_personalizada = 'perfil_seleccionado';\n\n                                        let factor_perfil = response.factores_perfiles.find(fp => fp.factor_id === element.factor_id);\n                                        let dimensiones_seleccionadas = factor_perfil\n                                            ? factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id)\n                                            : [];\n\n                                        element.factor.dimensiones.forEach(dimension => {\n                                            let es_Seleccionada = dimensiones_seleccionadas.includes(dimension.id);\n                                            let clase_Extra = es_Seleccionada ? `${clase_personalizada} selected` : `${clase_personalizada} disabled`;\n\n                                            etiquetas += `\n                                                ${crearCard({\n                                                    col_tamanio: 'col-md-auto',\n                                                    nombre_grupo: `etiqueta_${element.factor_id}`,\n                                                    hidden: true,\n                                                    adicional: clase_Extra,\n                                                    contenido: `<div class=\"text-center ${clase_personalizada}_contenido ${es_Seleccionada ? 'selected' : 'disabled'} no-interactive\"\n                                                                    data-factor_id=\"${element.factor_id}\"\n                                                                    data-dimension=\"${dimension.id}\">\n                                                                    ${dimension.nombre}\n                                                                </div>`\n                                                })}\n                                            `;\n                                        });\n\n                                        return {\n                                            id: 'factor_id_' + index,\n                                            titulo: element.factor.nombre,\n                                            tooltip: element.factor.descripcion,\n                                            clase_nav: 'col-4 justify-content-center',\n                                            contenido: `\n                                                <div class=\"row mx-3 m-4\">\n                                                    <div class=\"tags-container row justify-content-center gap-3 no-interactive\">\n                                                        ${etiquetas}\n                                                    </div>\n                                                </div>\n                                            `,\n                                            activo: index === 0,\n                                            disabled: false\n                                        };\n                                    });\n\n                                $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n                                $('#nivel_educativo_div').hide();\n                                break;\n\n                            case 4:\n                                let etiquetas_libres_case4 = '';\n                                let etiquetas_medio = '';\n                                let etiquetas_alto = '';\n                                let etiquetas_avanzado = '';\n                                resp_factores.data.forEach(factorPrueba => {\n                                    let factorPerfil = response.factores_perfiles.find(fp => fp.factor_id === factorPrueba.factor.id);\n                                    if (factorPerfil && factorPerfil.dimensiones_factores_perfiles.length > 0) {\n                                        let dfp = factorPerfil.dimensiones_factores_perfiles[0];\n                                        let etiquetaHTML = `<div class=\"tag disabled\">${factorPrueba.factor.nombre}</div>`;\n                                        if (dfp.limite_inferior >= 50 && dfp.limite_superior <= 70) etiquetas_medio += etiquetaHTML;\n                                        else if (dfp.limite_inferior >= 71 && dfp.limite_superior <= 90) etiquetas_alto += etiquetaHTML;\n                                        else if (dfp.limite_inferior >= 91 && dfp.limite_superior <= 100) etiquetas_avanzado += etiquetaHTML;\n                                        else etiquetas_libres_case4 += etiquetaHTML;\n                                    } else {\n                                        etiquetas_libres_case4 += `<div class=\"tag disabled\">${factorPrueba.factor.nombre}</div>`;\n                                    }\n                                });\n                                let valor_medio = '50 - 70';\n                                let valor_alto = '71 - 90';\n                                let valor_avanzado = '91 - 100';\n                                let contenido_case4 = `\n                                    <div class=\"row mx-3 mt-4\">\n                                        <div class=\"tags-container\">${etiquetas_libres_case4}</div>\n                                        <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                <div class=\"nivel medio readonly\">\n                                                    <div class=\"zona-tags\" data-nivel=\"medio\">\n                                                        ${etiquetas_medio}\n                                                    </div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                <div class=\"nivel alto readonly\">\n                                                    <div class=\"zona-tags\" data-nivel=\"alto\">\n                                                        ${etiquetas_alto}\n                                                    </div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                <div class=\"nivel avanzado readonly\">\n                                                    <div class=\"zona-tags\" data-nivel=\"avanzado\">\n                                                        ${etiquetas_avanzado}    \n                                                    </div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                `;\n                                $('#tabs-container').append(contenido_case4);\n                                $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n                                $('#nivel_educativo_div').hide();\n                                break;\n\n                            case 7:\n                                tabs_data = response.factores_perfiles\n                                    .filter(factor_perfil => factor_perfil.factor_id !== 35)\n                                    .map((factor_perfil, index) => {\n                                        let factor_Prueba = resp_factores.data.find(f => f.factor_id === factor_perfil.factor_id);\n                                        let dimensiones_Perfil_Ids = factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id);\n                                        let dimensiones_Prueba = factor_Prueba.factor.dimensiones;\n                                        let etiquetas_libres = '';\n                                        dimensiones_Prueba\n                                            .filter(d => !dimensiones_Perfil_Ids.includes(d.id))\n                                            .forEach(d => {\n                                                etiquetas_libres += `<div class=\"tag disabled\">${d.nombre}</div>`;\n                                            });\n                                        let etiquetas_medio = '';\n                                        let etiquetas_alto = '';\n                                        let etiquetas_avanzado = '';\n                                        factor_perfil.dimensiones_factores_perfiles.forEach(df => {\n                                            let etiquetaHTML = `<div class=\"tag disabled\">${df.dimension.nombre}</div>`;\n                                            if (df.limite_inferior >= 50 && df.limite_superior <= 70) etiquetas_medio += etiquetaHTML;\n                                            else if (df.limite_inferior >= 71 && df.limite_superior <= 90) etiquetas_alto += etiquetaHTML;\n                                            else if (df.limite_inferior >= 91 && df.limite_superior <= 100) etiquetas_avanzado += etiquetaHTML;\n                                        });\n                                        let valor_medio = '50 - 70';\n                                        let valor_alto = '71 - 90';\n                                        let valor_avanzado = '91 - 100';\n                                        return {\n                                            id: 'factor_id_' + index,\n                                            titulo: factor_perfil.factor.nombre,\n                                            tooltip: factor_perfil.factor.descripcion,\n                                            activo: index === 0,\n                                            disabled: false,\n                                            contenido: `\n                                                <div class=\"row mx-3 mt-4\">\n                                                    <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                        <div class=\"col-4\">\n                                                            <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                            <div class=\"nivel medio readonly\">\n                                                                <div class=\"zona-tags\" data-nivel=\"medio\">\n                                                                    ${etiquetas_medio}\n                                                                </div>\n                                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                            </div>\n                                                        </div>\n                                                        <div class=\"col-4\">\n                                                            <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                            <div class=\"nivel alto readonly\">\n                                                                <div class=\"zona-tags\" data-nivel=\"alto\">\n                                                                    ${etiquetas_alto}\n                                                                </div>\n                                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                            </div>\n                                                        </div>\n                                                        <div class=\"col-4\">\n                                                            <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                            <div class=\"nivel avanzado readonly\">\n                                                                <div class=\"zona-tags\" data-nivel=\"avanzado\">\n                                                                    ${etiquetas_avanzado}    \n                                                                </div>\n                                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            `\n                                        };\n                                    });\n                                $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6');\n                                $('#nivel_educativo_div').show();\n                                break;\n\n                            case 12:\n                                tabs_data = response.factores_perfiles\n                                    .filter(factor_perfil => factor_perfil.factor_id !== 78)\n                                    .map((factor_perfil, index) => {\n                                        if (factor_perfil.factor_id == 77) {\n                                            let factor_Prueba = resp_factores.data.find(f => f.factor_id == 77);\n                                            let etiquetas = '';\n                                            factor_Prueba.factor.dimensiones.forEach(element => {\n                                                var icono = '';\n                                                var tooltip = '';\n                                                if (element.factor_id == 77) {\n                                                    icono = '<i class=\"bi bi-flag-fill text-danger me-3\"></i>';\n                                                    tooltip = `${crearTooltip({ placement: `top`, content:  `${element.descripcion}`, toggle: `popover` })}`;\n                                                }\n                                                etiquetas += `\n                                                        ${crearCard({\n                                                            col_tamanio: 'col-md-auto ',\n                                                            nombre_grupo: `etiqueta_${element.factor_id}`,\n                                                            hidden: true,\n                                                            contenido: `<div ${tooltip} class=\"text-center\" data-factor_id=\"${element.factor_id}\" data-dimension=\"${element.id}\">${icono} ${element.nombre}</div>`\n                                                        })}\n                                                    `;\n                                            });\n                                            return {\n                                                id: 'factor_id_riesgos',\n                                                titulo: 'Riesgos laborales',\n                                                activo: false,\n                                                disabled: false,\n                                                contenido: `\n                                                    <div class=\"row mx-3 mt-4\">\n                                                        <div class=\"row justify-content-center gap-3\">${etiquetas}</div>\n                                                    </div>\n                                                `\n                                            };\n                                        }\n                                        let factor_Prueba = resp_factores.data.find(f => f.factor_id === factor_perfil.factor_id);\n                                        let dimensiones_Perfil_Ids = factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id);\n                                        let dimensiones_Prueba = factor_Prueba.factor.dimensiones;\n                                        let etiquetas_libres = '';\n                                        dimensiones_Prueba\n                                            .filter(d => !dimensiones_Perfil_Ids.includes(d.id))\n                                            .forEach(d => {\n                                                etiquetas_libres += `<div class=\"tag disabled\">${d.nombre}</div>`;\n                                            });\n                                        let etiquetas_bajo = '';\n                                        let etiquetas_medio = '';\n                                        let etiquetas_alto = '';\n                                        let etiquetas_avanzado = '';\n                                        factor_perfil.dimensiones_factores_perfiles.forEach(df => {\n                                            let etiquetaHTML = `<div class=\"tag disabled\">${df.dimension.nombre}</div>`;\n                                            if (df.limite_inferior >= 10 && df.limite_superior <= 40) etiquetas_bajo += etiquetaHTML;\n                                            else if (df.limite_inferior >= 41 && df.limite_superior <= 70) etiquetas_medio += etiquetaHTML;\n                                            else if ((index == 0 && df.limite_inferior >= 71 && df.limite_superior <= 100) || df.limite_inferior >= 71 && df.limite_superior <= 90) etiquetas_alto += etiquetaHTML;\n                                            else if (df.limite_inferior >= 91 && df.limite_superior <= 100) etiquetas_avanzado += etiquetaHTML;\n                                        });\n                                        let valor_bajo = '10 - 40';\n                                        let valor_medio = (index === 0 ? '41 - 70' : '50 - 70');\n                                        let valor_alto = (index === 0 ? '71 - 100' : '71 - 90');\n                                        let valor_avanzado = '91 - 100';\n                                        let contenido_bajo = '';\n                                        if (index === 0) {\n                                            contenido_bajo = `\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill bajo-color mx-2\"></i><strong>Bajo</strong></p>\n                                                    <div class=\"nivel bajo readonly\">\n                                                        <div class=\"zona-tags\" data-nivel=\"bajo\">${etiquetas_bajo}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_bajo} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango\">${valor_bajo}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                            `;\n                                        }\n                                        let contenido_avanzado = '';\n                                        if (factor_perfil.factor_id == 75 || factor_perfil.factor_id == 76) {\n                                            contenido_avanzado = `\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                    <div class=\"nivel avanzado readonly\">\n                                                        <div class=\"zona-tags\" data-nivel=\"avanzado\">\n                                                            ${etiquetas_avanzado}    \n                                                        </div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                            `;\n                                        }\n                                        return {\n                                            id: 'factor_id_' + index,\n                                            titulo: factor_perfil.factor.nombre,\n                                            tooltip: factor_perfil.factor.descripcion,\n                                            activo: index === 0,\n                                            disabled: false,\n                                            contenido: `\n                                                <div class=\"row mx-3 mt-4\">\n                                                    <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                        ${contenido_bajo}\n                                                        <div class=\"col-4\">\n                                                            <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                            <div class=\"nivel medio readonly\">\n                                                                <div class=\"zona-tags\" data-nivel=\"medio\">\n                                                                    ${etiquetas_medio}\n                                                                </div>\n                                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                            </div>\n                                                        </div>\n                                                        <div class=\"col-4\">\n                                                            <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                            <div class=\"nivel alto readonly\">\n                                                                <div class=\"zona-tags\" data-nivel=\"alto\">\n                                                                    ${etiquetas_alto}\n                                                                </div>\n                                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                            </div>\n                                                        </div>\n                                                        ${contenido_avanzado}\n                                                    </div>\n                                                </div>\n                                            `\n                                        };\n                                    });\n                                $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6');\n                                $('#nivel_educativo_div').show();\n                                break;\n                        }\n                        let tabs = crearTabsHorizontal({ id: 'factores', tabs: tabs_data });\n                        $('#tabs-container').append(tabs);\n                        inicializarTooltips();\n                    }\n                });\n            },\n            error: function () {\n                mostrarToast('danger', 'Ocurrió un error al visualizar el perfil');\n            }\n        });\n    });\n\n    $(document).on('change', '#filtro_mas_recientes', function () {\n        actualizarDatatables(nombre_tabla);\n    });\n\n    $(document).on('click', '.perfil_selected', function () {\n        $(this).toggleClass('selected');\n        factores_etikos = actualizaFactoresEthikos(0);\n    });\n\n    $(document).on('click', '#btn_ver_perfiles_archivados', function () {\n        es_archivado = !es_archivado;\n        $('#btn_ver_perfiles_archivados').html(`<i class=\"bi ${es_archivado ? 'bi-chevron-left' : 'bi-archive'} me-2\"></i>${es_archivado ? 'Volver a perfiles activos' : 'Ver perfiles archivados'}`);\n        $('#btn_crear_perfil').toggleClass('d-none');\n        $('#filtro-dropdown-filtro_dropdown').toggleClass('d-none');\n        restablecerFiltrosComponente('filtro_dropdown');\n        $('#filtro_mas_recientes').closest('.input-container').toggleClass('d-none');\n        $('#filtro_mas_recientes').val(1).trigger('change');\n        $('#contenedor-texto-cabecera').text(es_archivado ? 'Perfiles archivados' : 'Producto selección');\n        actualizarDatatables(nombre_tabla);\n    });\n\n    $(document).on('mouseenter', '.card-hover-opciones', function () {\n        $(this).find('.opciones-card-hover').show();\n    });\n\n    $(`#${nombre_tabla}`).on('mouseleave', '.card-hover-opciones', function () {\n        $(this).find('.opciones-card-hover').hide();\n    });\n\n    $(document).on('click', '#siguiente_perfil', function () {\n        let tabulador_factor = 1;\n        if ($(this).data('id')) {\n            tabulador_factor = parseInt($(this).data('id'));\n        }\n        let factor_actual = 'factor_id_' + (tabulador_factor - 1);\n        let factor_siguiente = 'factor_id_' + tabulador_factor;\n        let es_crear = $(this).text() == 'Crear perfil';\n        tabs_Completados[factor_actual] = true;\n        if ($(this).text() == 'Crear perfil' || $(this).text() == 'Editar perfil') {\n            if ($(\"#nombre-perfil\").val() == \"\") {\n                mostrarErrorEnInput('#nombre-perfil', 'El nombre del perfil es obligatorio');\n                return;\n            } else {\n                $.ajax({\n                    url: `/perfiles-listado-empresa?prueba_id=${prueba_actual}&nombres[]=${$(\"#nombre-perfil\").val()}`,\n                    method: 'GET',\n                    success: function (respuesta) {\n                        if (es_crear && respuesta.data.length != 0) {\n                            mostrarErrorEnInput('#nombre-perfil', 'Ya hay un perfil creado con este nombre.');\n                            return;\n                        } else {\n                            let factores = {};\n                            if (prueba_actual == 3) {\n                                factores = factores_etikos;\n                                var sinceridad = informacion.find(item => item.id == 16);\n                                factores[16] = {\n                                    peso: 0,\n                                    dimensiones: sinceridad.factor.dimensiones.map(dimension => ({\n                                        dimension_id: dimension.id,\n                                        peso: 100,\n                                        cantidad_preguntas: null,\n                                        limite_inferior: 71,\n                                        limite_superior: 100\n                                    }))\n                                };\n                            } else {\n                                if ($(\"#nivel_educativo\").val() == \"\" && prueba_actual != 4) {\n                                    mostrarErrorEnInput('#nivel_educativo', 'El nivel educativo es obligatorio');\n                                    return;\n                                }\n\n                                if (prueba_actual == 4) {\n                                    factores = actualizaFactoresIQ(0);\n                                } else {\n                                    factores = actualizaFactores();\n                                }\n                                actualizarPesos(factores);\n                            }\n\n                            let payload = {\n                                prueba_id: prueba_actual,\n                                nivel_educativo_id: parseInt($(\"#nivel_educativo\").val()) || null,\n                                compartir_sucursales: $(\"#compartir_perfil\").is(\":checked\"),\n                                nombre: $(\"#nombre-perfil\").val() || \"\",\n                                empresas: [$(\"#empresa_sesion_id\").val()],\n                                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                                factores: JSON.stringify(factores)\n                            };\n\n                            if (!es_crear) {\n                                payload.id = $(\"#id_perfil\").val();\n                            }\n                            $.ajax({\n                                url: '/perfiles',\n                                method: 'POST',\n                                data: payload,\n                                success: function (respuesta) {\n                                    mostrarToast('success', respuesta.message);\n                                    $('#modal-crear-perfil').modal('hide');\n\n                                    if ($('#crear_perfil_proceso').length) {\n                                        // Aplica cuando se crea el perfil desde el proceso\n                                        let nueva_opcion = new Option(payload.nombre, respuesta.id, true, true);\n                                        $('#perfil_id_'+payload.prueba_id).prepend(nueva_opcion).trigger('change');\n                                    } else if ($('#modal-movimiento-6').length) {\n                                        // Aplica cuando se crea el perfil desde vacantes\n                                        let nueva_opcion = new Option(payload.nombre, respuesta.id, true, true);\n                                        $('select[name=\"perfil_id_' + payload.prueba_id + '\"]').prepend(nueva_opcion).trigger('change');\n                                        $('#modal-movimiento-6').removeClass('d-none');\n                                    } else {\n                                        actualizarDatatables(nombre_tabla);\n                                        mostrarEncuestaCreacionPerfiles();\n                                    }\n                                },\n                                error: function (err) {\n                                    console.error(\"Error al guardar\", err);\n                                }\n                            });\n                            return;\n                        }\n                    },\n                    error: function (err) {\n                        console.error(\"Error al guardar\", err);\n                    }\n                });\n            }\n            return;\n        }\n        \n        if (tabulador_factor == 2 && (prueba_actual == 7 || prueba_actual == 3)) {\n            $(this).text(es_editar ? 'Editar perfil' : 'Crear perfil');\n            if (prueba_actual == 7) {\n                $(this).attr('disabled', true);\n            }\n        }\n        \n        if (tabulador_factor == 4 || (tabulador_factor === 3 && prueba_actual !== 12)) {\n            $(this).text(es_editar ? 'Editar perfil' : 'Crear perfil');\n        }\n        $(`#${factor_siguiente}`)\n            .attr('disabled', false)\n            .attr('aria-disabled', 'false')\n            .removeClass('disabled');\n        $(this)\n            .attr('data-id', tabulador_factor + 1)\n            .data('id', tabulador_factor + 1);\n            if (es_editar && factor_siguiente == 'factor_id_3' && prueba_actual == 12) {\n                factor_siguiente = 'factor_id_riesgos';\n            }\n            \n        $(`a.nav-item-horizontal#${factor_siguiente}`).tab('show');\n        if (tabulador_factor < 2 && !es_editar) {\n            $(this).attr('disabled', true);\n        }\n        if (tabulador_factor == 2 && prueba_actual == 7) {\n            $('#siguiente_perfil').attr('disabled', true);\n        }\n    });\n\n    $(document).on('shown.bs.tab', 'a.nav-item-horizontal', function () {\n        let tabulador_id = $(this).attr('id');\n        let total_tabs = $('#tabs-container .nav-item-horizontal').length;\n        let indice_actual = $(this).index();\n\n        // Manejar pestañas especiales como 'factor_id_riesgos'\n        if (tabulador_id === 'factor_id_riesgos') {\n            // La pestaña de riesgos es la última en TenDisc Plus\n            $('#siguiente_perfil').attr('data-id', 4).data('id', 4);\n            $('#siguiente_perfil').text(es_editar ? 'Editar perfil' : 'Crear perfil');\n        } else {\n            // Procesamiento normal para pestañas numéricas\n            let numero_tabulador = parseInt(tabulador_id.replace(/factor_id_(ia_)?/, \"\")) + 1;\n            $('#siguiente_perfil').attr('data-id', numero_tabulador).data('id', numero_tabulador);\n\n            if (indice_actual + 1 < total_tabs) {\n                $('#siguiente_perfil').text('Siguiente');\n            } else {\n                $('#siguiente_perfil').text(es_editar ? 'Editar perfil' : 'Crear perfil');\n            }\n        }\n        if (!es_detalle) {\n            setTimeout(() => {\n                verificarBotonSiguiente();\n            }, 100);\n        }\n        if (es_editar && $('#tipo_prueba').val() == '3') {\n            $('#siguiente_perfil').attr('disabled', false);\n            return;\n        }\n\n        if ($('#tipo_prueba').val() == '3' && !es_editar) {\n            $('#siguiente_perfil').attr('disabled', true);\n            return;\n        }\n\n        if (tabulador_id == 'factor_id_0' || tabulador_id == 'factor_id_1' && !es_editar) {\n            if (tabs_Completados[tabulador_id]) {\n                $('#siguiente_perfil').attr('disabled', false);\n            } else {\n                $('#siguiente_perfil').attr('disabled', true);\n            }\n        } else {\n            $('#siguiente_perfil').attr('disabled', false);\n            return;\n        }\n    });\n\n    $('#modal-crear-perfil').on('hidden.bs.modal', function () {\n        if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\n            $(\"#siguiente_perfil\").text('Siguiente');\n        }\n        if ($('#modal-movimiento-6').length) {\n            $('#modal-movimiento-6').removeClass('d-none');\n        }\n    });\n\n    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\n        $('#modal-movimiento-6').removeClass('d-none');\n    });\n});\n\n/**\n * Función para aplicar los filtros avanzados aplicados.\n *\n * @param {String} filtro id del elemento html del filtro\n * @param {Object} filtros filtros aplicados\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction aplicarFiltrosDropdown(filtro, filtros) {\n    filtro_html = filtro;\n    json_filtros = filtros;\n    actualizarDatatables(nombre_tabla);\n}\n\n/**\n * Muestra u oculta tablas según la existencia de datos en los procesos.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarDatos() {\n    if (datos_ids[0]?.procesos?.length == 0 && datos_ids[1].procesos?.length == 0 && datos_ids[2].procesos?.length == 0) {\n        $('#tabla_con_datos').addClass('d-none');\n        $('#tabla_sin_datos').removeClass('d-none');\n    } else {\n        $('#tabla_con_datos').removeClass('d-none');\n        $('#tabla_sin_datos').addClass('d-none');\n    }\n}\n\n/**\n * Duplicar perfil.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction duplicarPerfil() {\n    if ($(\"#nombre_perfil_copia\").val() == \"\") {\n        mostrarToast('danger', 'El nombre del perfil es obligatorio');\n        return;\n    } else {\n        $.ajax({\n            url: `/perfiles-listado-empresa?prueba_id=${prueba_actual}&nombres[]=${$(\"#nombre_perfil_copia\").val()}`,\n            method: 'GET',\n            success: function (respuesta) {\n                if (respuesta.data.length != 0) {;\n                    mostrarToast('danger', 'Ya hay un perfil creado con este nombre.');\n                    return;\n                } else {\n                    $.ajax({\n                        url: `/perfiles-clonar`,\n                        type: 'POST',\n                        data: {\n                            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                            perfil_id : $('#id_perfil_duplicar').val(),\n                            nombre: $('#nombre_perfil_copia').val()\n                        },\n                        success: function (response) {\n                            mostrarToast(\"success\", \"Perfil duplicado con éxito\");\n                            actualizarDatatables(nombre_tabla);\n                            $('#modal-duplicar-perfil').modal('hide');\n                        },\n                        error: function () {\n                            mostrarToast('danger', 'Ocurrió un error al clonar el perfil');\n                        }\n                    });\n                }\n            },\n            error: function (error) {\n                console.error(\"Ocurrió un error al clonar el perfil\", error);\n            }\n        });\n    }\n}\n\n/**\n * Descargar el PDF del perfil.\n *\n * @param {number} id ID del perfil.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction descargarPDF(id) {\n    $.ajax({\n        type: 'POST',\n        url : `/perfiles-pdf/${id}`,\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        xhrFields: {\n            responseType: 'blob'\n        },\n        success: function(data, status, xhr) {\n            // Crear una URL para el Blob\n            let url = window.URL.createObjectURL(data);\n            let etiqueta_a   = document.createElement('a');\n            etiqueta_a.href  = url;\n\n            etiqueta_a.download = `perfil${id}.pdf`;\n            document.body.appendChild(etiqueta_a);\n            etiqueta_a.click();\n            window.URL.revokeObjectURL(url);\n            document.body.removeChild(etiqueta_a);\n        }\n    }).then(() => {\n        mostrarToast('success', 'PDF generado correctamente.');\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al descargar el archivo.');\n    });\n}\n\n/**\n * Elimina un perfil específico mediante una solicitud AJAX y actualiza la tabla.\n *\n * @param {number|string} id - ID del perfil que se desea eliminar.\n * @returns {void}\n * @author Andres Morales\n */\nfunction eliminarPerfil(id) {\n    $.ajax({\n        url: `/perfiles/${id}`,\n        type: 'DELETE',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function (response) {\n            mostrarToast(response.tipo, response.mensaje);\n            actualizarDatatables(nombre_tabla);\n        },\n        error: function () {\n            mostrarToast('danger', 'Ocurrió un error al eliminar el perfil');\n        }\n    });\n}\n\n/**\n * Elimina un perfil específico mediante una solicitud AJAX y actualiza la tabla.\n *\n * @param {number|string} id - ID del perfil que se desea archivar.\n * @param {boolean} accion_archivar - Acción para archivar o desarchivar.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction archivarPerfil(id, accion_archivar) {\n    $.ajax({\n        url: `/perfiles-archivar/${id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            archivar: accion_archivar\n        },\n        success: function (response) {            \n            mostrarToast(response.tipo, response.mensaje);\n            actualizarDatatables(nombre_tabla);\n        },\n        error: function () {\n            mostrarToast('danger', 'Ocurrió un error al eliminar el perfil');\n        }\n    });\n}\n\n/**\n * Función para consultar los factores y abrir la modal de creación de perfiles.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction crearPerfil(id_prueba = 0) {\n    var id = 0;\n    if (id_prueba == 0) {\n        id = $(\"#btn_crear_perfil\").data('prueba');\n    } else {\n        id = id_prueba.toString();\n        prueba_actual = id_prueba; \n    }\n\n    $('#tabs-container').removeClass('mx-4');\n\n    if (id != 4) {\n        $('#tabs-container').addClass('mx-4')\n    }\n    $(\"#modal-crear-perfil_label\").text('Crear perfil');\n    $(\"#siguiente_perfil\").text('Siguiente');\n    $('#siguiente_perfil').data('id', 1);\n    $(\"#siguiente_perfil\").attr('disabled', true);\n    var clases_tab = '';\n    var instrucciones = '';\n    var clase_personalizada = '';\n    es_editar = false;\n    factores_etikos = {};\n\n    switch (id) {\n        case '3':\n            es_inteligencia = false;\n            clases_tab = 'col-4 justify-content-center';\n            instrucciones = 'Selecciona los valores que deseas evaluar en este perfil.';\n            clase_personalizada = 'perfil_selected';\n            $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n            $('#nivel_educativo_div').hide();\n\n            break;\n        case '4':\n            clases_tab = 'col-3 justify-content-center';\n            instrucciones = 'Arrastra las habilidades cognitivas de acuerdo al nivel que deseas asignar.';\n            $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n            $('#nivel_educativo_div').hide();\n\n            break;\n        case '7':\n            clases_tab = 'col-3 justify-content-center';\n            instrucciones = 'Arrastra las etiquetas de acuerdo al nivel que deseas asignar. .';\n            $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6')\n            $('#nivel_educativo_div').show();\n            break;\n        default:\n            clases_tab = 'col-3 justify-content-center';\n            $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6')\n            $('#nivel_educativo_div').show();\n            break;\n    }\n    let tag_etiquetas = '';\n    $('#tabs-container').empty();\n    restablecerBotones();\n    $.ajax({\n        url: `/pruebas/${id}/factores`,\n        type: 'GET',\n        success: function (response) {\n            informacion = response.data;\n            \n            var tabs = '';\n            if (id != 4) {\n                tabs = `\n                    ${crearTabsHorizontal({\n                    id: 'factores',\n                    tabs: response.data\n                        .filter(element => element.factor_id !== 78 && element.factor_id !== 16 && element.factor_id !== 35)\n                        .map((element, index) => {\n                            let etiquetas = '';\n                            element.factor.dimensiones.forEach(dimension => {\n                                if (element.factor_id == 77 || element.prueba_id == 3) {\n                                    tag_etiquetas = 'row justify-content-center gap-3';\n                                    var icono = '';\n                                    var tooltip = '';\n                                    if (element.factor_id == 77) {\n                                        icono = '<i class=\"bi bi-flag-fill text-danger me-3\"></i>';\n                                        tooltip = `${crearTooltip({ placement: `top`, content:  `${dimension.descripcion}`, toggle: `popover` })}`;\n                                    }\n                                    \n                                    etiquetas += `\n                                            ${crearCard({\n                                                col_tamanio: 'col-md-auto ',\n                                                nombre_grupo: `etiqueta_${element.factor_id}`,\n                                                hidden: true,\n                                                adicional: clase_personalizada,\n                                                contenido: `<div ${tooltip} class=\"text-center ${clase_personalizada}_contenido\" data-factor_id=\"${element.factor_id}\" data-dimension=\"${dimension.id}\">${icono} ${dimension.nombre}</div>`\n                                            })}\n                                        `;\n                                } else {\n                                    etiquetas += `<div class=\"tag\" data-id=\"${dimension.id}\">${dimension.nombre}</div>`;\n                                }\n                            });\n                            if (element.prueba_id == 12) {\n                                instrucciones = `Arrastra las ${element.factor.dimensiones.length} etiquetas de acuerdo al nivel que deseas asignar.`;\n                            }\n                            let minimo_Requerido = '';\n                            if (index == 0) {\n                                $('#siguiente_perfil').attr('data-id', 1);\n                                if (element.prueba_id == 12) {\n                                    minimo_Requerido = 'Completa todas las cajas con mínimo una etiqueta.';\n                                }\n                            }\n\n                            let contenido_bajo = '';\n                            let alerta = '';\n                            let contenido_avanzado = '';\n                            let valor_medio = '50 - 70';\n                            let valor_alto = '71 - 90';\n                            let valor_avanzado = '91 - 100';\n\n                            if (element.factor_id == 74) {\n                                var valor_bajo = '10 - 40';\n                                valor_medio = '41 - 70';\n                                valor_alto = '71 - 100';\n                                contenido_bajo = `\n                                        <div class=\"col-4\">\n                                            <p><i class=\"bi bi-bar-chart-fill bajo-color mx-2\"></i><strong>Bajo</strong></p>\n                                            <div class=\"nivel bajo\">\n                                                <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"bajo\"><label class=\"arrastra_bajo text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_bajo} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango\">${valor_bajo}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                            </div>\n                                        </div>\n                                    `;\n                            }\n                            let contenido = '';\n                            if ((element.factor_id !== 77 && element.prueba_id == 12) || element.prueba_id == 7) {\n                                contenido = `\n                                    <div class=\"col-4\">\n                                        <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                        <div class=\"nivel medio\">\n                                            <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"medio\"><label class=\"arrastra_medio text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                            <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                        </div>\n                                    </div>\n                                    <div class=\"col-4\">\n                                        <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                        <div class=\"nivel alto\">\n                                            <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"alto\"><label class=\"arrastra_alto text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                            <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                        </div>\n                                    </div>\n                                `;\n                            } else {\n                                if (element.prueba_id == 12) {\n                                    instrucciones = `Conoce los riesgos emocionales que evaluamos en Ten DISC Plus. Acerca el cursor para ver la definición`;\n                                }\n                            }\n\n                            if (element.factor_id == 75 || element.factor_id == 76 || element.prueba_id == 7) {\n                                contenido_avanzado = `\n                                        <div class=\"col-4\">\n                                            <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                            <div class=\"nivel avanzado\">\n                                                <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"avanzado\"><label class=\"arrastra_avanzado text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                            </div>\n                                        </div>\n                                    `;\n                                if (element.factor_id == 76) {\n                                    instrucciones = `Arrastra las etiquetas de acuerdo al nivel que deseas asignar.`;\n                                    alerta = `\n                                            <div class=\"my-4\">\n                                                    ${crearAlerta('info', 'Esta sección es opcional. Puedes completarla si deseas incluir competencias específicas')}\n                                            </div>\n                                        `;\n                                }\n                            }\n\n                            return {\n                                id: 'factor_id_' + index,\n                                titulo: element.factor.nombre,\n                                tooltip: element.factor.descripcion,\n                                clase_nav: clases_tab,\n                                contenido: `\n                                        <div class=\"row mx-3\">\n                                            <input type=\"hidden\" id=\"factor_id_escondido\" name=\"factor_id\" value=\"${element.factor_id}\">\n                                            ${alerta}\n                                            <div class=\"mt-4\">\n                                                <p>${instrucciones} ${minimo_Requerido}</p>\n                                            </div>\n                                            <div class=\"d-flex mb-2\">\n                                                ${crearBoton({\n                                                    type: 'button',\n                                                    clases: 'btn-primary btn-restablecer-etiquetas d-none',\n                                                    texto: '<i class=\"bi bi-bag-x-fill me-3\"></i> Restablecer',\n                                                    data: [{ texto: 'FACTOR-id', value: element.factor_id }]\n                                                })}\n                                                <div class=\"tags-container ${tag_etiquetas} col-10\">\n                                                    ${etiquetas}\n                                                </div>\n                                            </div>\n                                            <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                ${contenido_bajo}\n                                                ${contenido}\n                                                ${contenido_avanzado}\n                                            </div>\n                                        </div>\n                                    `,\n                                activo: index === 0,\n                                disabled: index !== 0\n                            };\n                        })\n                })}\n                `;\n            } else {\n                let etiquetas = '';\n                let valor_medio = '50 - 70';\n                let valor_alto = '71 - 90';\n                let valor_avanzado = '91 - 100';\n                response.data.forEach(facotres => {\n                    etiquetas += `<div ${crearTooltip({ placement: `top`, content: `${facotres.factor.descripcion}`, toggle: `popover`, })} class=\"tag\" data-id=\"${facotres.factor.id}\">${facotres.factor.nombre}</div>`;\n                });\n\n                tabs = `\n                    <div class=\"row mx-3\">\n                        <div class=\"mt-4\">\n                            <p>${instrucciones}</p>\n                        </div>\n                        <div class=\"d-flex mb-2\">\n                            ${crearBoton({\n                                type: 'button',\n                                clases: 'btn-primary btn-restablecer-etiquetas d-none',\n                                texto: '<i class=\"bi bi-bag-x-fill me-3\"></i> Restablecer',\n                                data: [{ texto: 'FACTOR-id', value: id }]\n                            })}\n                            <div class=\"tags-container col-10\">\n                                ${etiquetas}\n                            </div>\n                        </div>\n                        <div class=\"niveles col-12 row justify-content-center mb-4\">\n                            <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                <div class=\"col-4\">\n                                    <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                    <div class=\"nivel medio\">\n                                        <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"medio\"><label class=\"arrastra_medio text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                    </div>\n                                </div>\n                                <div class=\"col-4\">\n                                    <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                    <div class=\"nivel alto\">\n                                        <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"alto\"><label class=\"arrastra_alto text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                    </div>\n                                </div>\n                                <div class=\"col-4\">\n                                    <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                    <div class=\"nivel avanzado\">\n                                        <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"avanzado\"><label class=\"arrastra_avanzado text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `;\n                $('#siguiente_perfil').attr('data-id', id);\n                $(\"#siguiente_perfil\").text('Crear perfil');\n            }\n            $('#nombre-perfil').val('');        \n            es_detalle = false;\n            $('#modal-crear-perfil').modal('show');\n            $('#tipo_prueba').val(id).select2().trigger('select2:select');\n            $('#nivel_educativo').val(null).select2().trigger('select2:select');\n            $('#tabs-container').append(tabs);\n            inicializarTooltips();\n        },\n        error: function () {\n            mostrarToast('danger', 'Ocurrió un error');\n        }\n    });\n    activarDrop();\n}\n\n/**\n * Función para calcular el porcentaje.\n *\n * @param {number|string} total - total del porcetaje.\n * @param {number|string} parts - partes del porcentaje.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction porcentajeEvento(total, parts) {\n    if (parts <= 0) return [];\n    const base = Math.floor(total / parts);\n    let remainder = total - base * parts;\n    return Array(parts)\n        .fill(base)\n        .map((v, i) => (i < remainder ? v + 1 : v));\n}\n\n/**\n * Función actualizar el peso en los factores.\n *\n * @param {number|string} data - informacion para actualizar peso.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction actualizarPesos(data) {\n    const pesos = Object.keys(data);\n\n    const peso_con_dimensiones = pesos.filter(\n        (k) =>\n            k !== \"78\" && k !== \"35\" &&\n            Array.isArray(data[k].dimensiones) &&\n            data[k].dimensiones.length > 0\n    );\n\n    const pesos_Factores = porcentajeEvento(100, peso_con_dimensiones.length);\n\n    pesos.forEach((k) => {\n        const FACTOR = data[k];\n        const TIENE_DIMENSIONES =\n            Array.isArray(FACTOR.dimensiones) && FACTOR.dimensiones.length > 0;\n\n        if (!TIENE_DIMENSIONES) {\n            FACTOR.peso = 0;\n            return;\n        }\n        if (k === \"78\" || k === \"35\") {\n            FACTOR.peso = 0;\n            return;\n        }\n\n        const ID_PESO = peso_con_dimensiones.indexOf(k);\n        FACTOR.peso = pesos_Factores[ID_PESO];\n        var reglas = [];\n        var pesosRegla;\n        var suma;\n        var sobrante;\n\n        switch (k) {\n            case '74':\n                reglas = [\n                    { li: 10, ls: 40, porcentaje: 35 },\n                    { li: 41, ls: 70, porcentaje: 25 },\n                    { li: 71, ls: 100, porcentaje: 40 },\n                ];\n                pesosRegla = reglas.map((r) =>\n                    Math.floor((r.porcentaje * 100) / 100)\n                );\n                suma = pesosRegla.reduce((a, b) => a + b, 0);\n                sobrante = FACTOR.peso - suma;\n                for (let i = 0; sobrante > 0; i++, sobrante--) {\n                    pesosRegla[i % pesosRegla.length] += 1;\n                }\n                FACTOR.dimensiones.forEach((dim) => (dim.peso = 0));\n                reglas.forEach((regla, i) => {\n                    const dimensionesDeRegla = FACTOR.dimensiones.filter(\n                        (dim) =>\n                            dim.limite_inferior === regla.li &&\n                            dim.limite_superior === regla.ls\n                    );\n\n                    if (dimensionesDeRegla.length > 0) {\n                        let distribucion = porcentajeEvento(\n                            pesosRegla[i],\n                            dimensionesDeRegla.length\n                        );\n\n                        dimensionesDeRegla.forEach((dim, idx) => {\n                            dim.peso = distribucion[idx];\n                        });\n                    }\n                });\n                break;\n\n            case '32':\n            case '75':\n                reglas = [\n                    { li: 50, ls: 70, porcentaje: 10 },\n                    { li: 71, ls: 90, porcentaje: 30 },\n                    { li: 91, ls: 100, porcentaje: 60 },\n                ];\n\n                const FACTOR_SIN_MEDIO_TRANSVERSAL = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 50 && dim.limite_superior === 70\n                );\n\n                const FACTOR_SIN_ALTO_TRANSVERSAL = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 71 && dim.limite_superior === 90\n                );\n\n                const FACTOR_SIN_AVANZADO_TRANSVERSAL = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 91 && dim.limite_superior === 100\n                );\n\n                const RANGOS_ACTIVOS_TRANSVERSAL = [FACTOR_SIN_MEDIO_TRANSVERSAL, FACTOR_SIN_ALTO_TRANSVERSAL, FACTOR_SIN_AVANZADO_TRANSVERSAL].filter(Boolean).length;\n\n                if (RANGOS_ACTIVOS_TRANSVERSAL === 1) {\n                    if (FACTOR_SIN_MEDIO_TRANSVERSAL) {\n                        reglas = [{ li: 50, ls: 70, porcentaje: 100 }];\n                    } else if (FACTOR_SIN_ALTO_TRANSVERSAL) {\n                        reglas = [{ li: 71, ls: 90, porcentaje: 100 }];\n                    } else if (FACTOR_SIN_AVANZADO_TRANSVERSAL) {\n                        reglas = [{ li: 91, ls: 100, porcentaje: 100 }];\n                    }\n                } else {\n                    if (!FACTOR_SIN_MEDIO_TRANSVERSAL) {\n                        reglas = [\n                            { li: 71, ls: 90, porcentaje: 34 },\n                            { li: 91, ls: 100, porcentaje: 66 },\n                        ];\n                    }\n\n                    if (!FACTOR_SIN_ALTO_TRANSVERSAL) {\n                        reglas = [\n                            { li: 50, ls: 70, porcentaje: 15 },\n                            { li: 91, ls: 100, porcentaje: 85 },\n                        ];\n                    }\n\n                    if (!FACTOR_SIN_AVANZADO_TRANSVERSAL) {\n                        reglas = [\n                            { li: 50, ls: 70, porcentaje: 25 },\n                            { li: 71, ls: 90, porcentaje: 75 },\n                        ];\n                    }\n                }\n\n                pesosRegla = reglas.map((r) =>\n                    Math.floor((r.porcentaje * 100) / 100)\n                );\n                suma = pesosRegla.reduce((a, b) => a + b, 0);\n                sobrante = FACTOR.peso - suma;\n                for (let i = 0; sobrante > 0; i++, sobrante--) {\n                    pesosRegla[i % pesosRegla.length] += 1;\n                }\n                FACTOR.dimensiones.forEach((dim) => (dim.peso = 0));\n                reglas.forEach((regla, i) => {\n                    const dimensionesDeRegla = FACTOR.dimensiones.filter(\n                        (dim) =>\n                            dim.limite_inferior === regla.li &&\n                            dim.limite_superior === regla.ls\n                    );\n\n                    if (dimensionesDeRegla.length > 0) {\n                        let distribucion = porcentajeEvento(\n                            pesosRegla[i],\n                            dimensionesDeRegla.length\n                        );\n\n                        dimensionesDeRegla.forEach((dim, idx) => {\n                            dim.peso = distribucion[idx];\n                        });\n                    }\n                });\n                break;\n\n            case '33':\n            case '34':\n            case '76':\n                reglas = [\n                    { li: 50, ls: 70, porcentaje: 25 },\n                    { li: 71, ls: 90, porcentaje: 10 },\n                    { li: 91, ls: 100, porcentaje: 65 },\n                ];\n\n                const FACTOR_SIN_MEDIO = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 50 && dim.limite_superior === 70\n                );\n\n                const FACTOR_SIN_ALTO = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 71 && dim.limite_superior === 90\n                );\n\n                const FACTOR_SIN_AVANZADO = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 91 && dim.limite_superior === 100\n                );\n\n                const rangosActivos = [FACTOR_SIN_MEDIO, FACTOR_SIN_ALTO, FACTOR_SIN_AVANZADO].filter(Boolean).length;\n\n                if (rangosActivos === 1) {\n                    if (FACTOR_SIN_MEDIO) {\n                        reglas = [{ li: 50, ls: 70, porcentaje: 100 }];\n                    } else if (FACTOR_SIN_ALTO) {\n                        reglas = [{ li: 71, ls: 90, porcentaje: 100 }];\n                    } else if (FACTOR_SIN_AVANZADO) {\n                        reglas = [{ li: 91, ls: 100, porcentaje: 100 }];\n                    }\n                } else {\n                    if (!FACTOR_SIN_MEDIO) {\n                        reglas = [\n                            { li: 71, ls: 90, porcentaje: 13 },\n                            { li: 91, ls: 100, porcentaje: 87 },\n                        ];\n                    }\n\n                    if (!FACTOR_SIN_ALTO) {\n                        reglas = [\n                            { li: 50, ls: 70, porcentaje: 28 },\n                            { li: 91, ls: 100, porcentaje: 72 },\n                        ];\n                    }\n\n                    if (!FACTOR_SIN_AVANZADO) {\n                        reglas = [\n                            { li: 50, ls: 70, porcentaje: 71 },\n                            { li: 71, ls: 90, porcentaje: 29 },\n                        ];\n                    }\n                }\n\n                pesosRegla = reglas.map((r) =>\n                    Math.floor((r.porcentaje * 100) / 100)\n                );\n\n                suma = pesosRegla.reduce((a, b) => a + b, 0);\n                sobrante = FACTOR.peso - suma;\n                for (let i = 0; sobrante > 0; i++, sobrante--) {\n                    pesosRegla[i % pesosRegla.length] += 1;\n                }\n\n                FACTOR.dimensiones.forEach((dim) => (dim.peso = 0));\n\n                reglas.forEach((regla, i) => {\n                    const dimensionesDeRegla = FACTOR.dimensiones.filter(\n                        (dim) =>\n                            dim.limite_inferior === regla.li &&\n                            dim.limite_superior === regla.ls\n                    );\n\n                    if (dimensionesDeRegla.length > 0) {\n                        let distribucion = porcentajeEvento(\n                            pesosRegla[i],\n                            dimensionesDeRegla.length\n                        );\n\n                        dimensionesDeRegla.forEach((dim, idx) => {\n                            dim.peso = distribucion[idx];\n                        });\n                    }\n                });\n\n                break;\n\n            case '77':\n                FACTOR.dimensiones.forEach((dim) => {\n                    dim.peso = 20;\n                });\n                break;\n\n            default:\n                const CONTADOR = FACTOR.dimensiones.length;\n                var dimension_peso = [];\n                dimension_peso = porcentajeEvento(100, CONTADOR);\n                FACTOR.dimensiones.forEach((dim, i) => {\n                    dim.peso = dimension_peso[i];\n                });\n                break;\n        }\n\n        if (k === \"34\") {\n            FACTOR.peso = 34;\n            return;\n        }\n        if (k === \"32\" || k === \"33\") {\n            FACTOR.peso = 33;\n            return;\n        }\n    });\n\n    return data;\n}\n\n/**\n * Función para obtener los factores seleccionados.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction actualizaFactores(tiene_factor_id = 0) {\n    var factores = {};\n\n    let modal = (es_inteligencia || tiene_factor_id === 1) ? $('#modal-vista-previa-perfil') : $('#modal-crear-perfil');\n\n    modal.find(\".tab-pane\").each(function () {\n        let tab = $(this);\n        let factor_Id = parseInt(tab.find('input[name=\"factor_id\"]').val());\n        if (isNaN(factor_Id)) {\n            return;\n        }\n        let peso_factor = parseFloat(tab.find('input[name=\"peso_factor\"]').val());\n        if (isNaN(peso_factor)) peso_factor = 0;\n\n        factores[factor_Id] = {\n            peso: peso_factor,\n            dimensiones: []\n        };\n\n        if (tiene_factor_id == 1) {\n            factores[factor_Id][\"factor_id\"] = factor_Id;\n        }\n\n        tab.find(\".niveles .drop-zone\").each(function () {\n            let zona = $(this);\n            let rango_Texto = zona.closest(\".nivel\").find(\".zona-rango\").text().trim();\n            let limites = rango_Texto.match(/(\\d+)\\s*-\\s*(\\d+)/);\n            let limite_Inferior = limites ? parseInt(limites[1]) : 0;\n            let limite_Superior = limites ? parseInt(limites[2]) : 100;\n\n            zona.find(\".tag\").each(function () {\n                let dimension_Id = parseInt($(this).data(\"id\"));\n                if (isNaN(dimension_Id)) return;\n                let pesoDimension = parseFloat($(this).data(\"peso\"));\n                if (isNaN(pesoDimension)) pesoDimension = 1.0;\n\n                factores[factor_Id].dimensiones.push({\n                    dimension_id: dimension_Id,\n                    peso: pesoDimension,\n                    cantidad_preguntas: null,\n                    limite_inferior: limite_Inferior,\n                    limite_superior: limite_Superior\n                });\n            });\n        });\n    });\n\n    const CONFIGURACION = {\n        35: { limite_inferior: 71, limite_superior: 100, porcentaje: 100 },\n        77: { limite_inferior: 10, limite_superior: 40, porcentaje: 20 },\n        78: { limite_inferior: 71, limite_superior: 100, porcentaje: 100 },\n    };\n\n    Object.entries(CONFIGURACION).forEach(([id, limites]) => {\n        const factorData = informacion.find(item => item.id === Number(id));\n        if (!factorData) return;\n\n        factores[id] = {\n            peso: 0,\n            dimensiones: factorData.factor.dimensiones.map(dimension => {\n                let base = {\n                    dimension_id: dimension.id,\n                    peso: limites.porcentaje,\n                    cantidad_preguntas: null\n                };\n                if (tiene_factor_id == 1) {\n                    base.limite_inferior = limites.limite_inferior;\n                    base.limite_superior = limites.limite_superior;\n                } else {\n                    base.limite_inferior = limites.limite_inferior;\n                    base.limite_superior = limites.limite_superior;\n                }\n\n                return base;\n            })\n        };\n\n        if (id == \"78\") {\n            const totalDim = factores[id].dimensiones.length;\n            const pesos = porcentajeEvento(100, totalDim);\n            factores[id].dimensiones.forEach((dim, i) => {\n                dim.peso = pesos[i];\n            });\n        }\n\n        if (tiene_factor_id == 1) {\n            factores[id][\"factor_id\"] = Number(id);\n        }\n    });\n\n    return factores;\n}\n\n/**\n * Función para obtener los factores seleccionados.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction actualizaFactoresIQ(tiene_factor_id = 0) {\n    var factores = {};\n    \n    let modal = (es_inteligencia || tiene_factor_id === 1) ? $('#modal-vista-previa-perfil') : $('#modal-crear-perfil');\n    \n    modal.find(\".niveles .drop-zone\").each(function () {\n        let zona = $(this);\n        let rango_Texto = zona.closest(\".nivel\").find(\".zona-rango\").text().trim();\n\n        let limites = rango_Texto.match(/(\\d+)\\s*-\\s*(\\d+)/);\n        let limite_Inferior = limites ? parseInt(limites[1]) : 0;\n        let limite_Superior = limites ? parseInt(limites[2]) : 100;\n\n        // Ahora cada tag decide si pertenece al factor actual\n        zona.find(\".tag\").each(function () {\n            let id_factor = parseInt($(this).data(\"id\"));\n            let resultado = informacion.find(item => item.id === id_factor);\n            factores[id_factor] = {\n                peso: 0,\n                dimensiones: []\n            };\n            if (tiene_factor_id == 1) {\n                factores[id_factor][\"factor_id\"] = id_factor;\n            }\n            resultado.factor.dimensiones.forEach(dimension => {\n                factores[id_factor].dimensiones.push({\n                    dimension_id: dimension.id,\n                    peso: 25,\n                    cantidad_preguntas: null,\n                    limite_inferior: limite_Inferior,\n                    limite_superior: limite_Superior\n                });\n            });\n        });\n    });\n    return factores;\n}\n\n/**\n * Función activar los drag and Drop de las etiquetas.\n *\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n */\nfunction activarDrop() {\n    const inicializarDragAndDrop = () => {\n        $(\".tag\").each(function () {\n            if ($(this).data(\"uiDraggable\")) {\n                $(this).draggable(\"destroy\");\n            }\n        });\n\n        $(\".drop-zone, .tags-container\").each(function () {\n            if ($(this).data(\"uiDroppable\")) {\n                $(this).droppable(\"destroy\");\n            }\n        });\n\n        var tags_Container = $(\".tags-container\");\n        var max_Caja_Factor = 2;\n        var pares_Prohibidos_Factor = [\n            [261, 263],\n            [262, 264]\n        ];\n\n        const limpiarPosicion = (elemento) => {\n            elemento.css({ top: \"\", left: \"\", position: \"\", transform: \"\" });\n        };\n\n        const inicializarDraggables = () => {\n            $(\".tag\").each(function (index) {\n                let $tag = $(this);\n\n                $tag.draggable({\n                    revert: \"invalid\",\n                    helper: \"clone\",\n                    appendTo: \"body\",\n                    cursor: \"move\",\n                    zIndex: 99999,\n                    opacity: 0.7\n                });\n            });\n        };\n\n        const verificarCambiosYMostrarBoton = () => {\n            let tab_activo = $('.tab-pane.active');\n            let hay_etiquetas_movidas = tab_activo.find('.drop-zone .tag').length > 0;\n            let boton_restablecer = tab_activo.find('.btn-restablecer-etiquetas');\n            if (prueba_actual == '4') {\n                hay_etiquetas_movidas = $('.drop-zone .tag').length > 0;\n                boton_restablecer = $('.btn-restablecer-etiquetas');\n            }\n            if (hay_etiquetas_movidas) {\n                boton_restablecer.removeClass('d-none');\n            } else {\n                boton_restablecer.addClass('d-none');\n            }\n            arrastraAqui();\n        };\n\n        const mostrarErrorEnContenedor = (contenedor, mensaje) => {\n            const nivelContenedor = contenedor.closest('.nivel');\n            nivelContenedor.siblings('.error-message').remove();\n            nivelContenedor.find('.error-message').remove();\n            const errorDiv = $(`<div class=\"error-message text-danger small mt-2\" style=\"font-size: 12px; margin-left: 0;\">${mensaje}</div>`);\n\n            nivelContenedor.after(errorDiv);\n\n            setTimeout(() => {\n                errorDiv.fadeOut(300, function () {\n                    $(this).remove();\n                });\n            }, 4000);\n        };\n\n        const restablecerEtiquetas = (factor_id) => {\n            let tab_activo = $('.tab-pane.active');\n            let tags_container = tab_activo.find('.tags-container');\n            let drop_zones = tab_activo.find('.drop-zone');\n            var prueba_tab = true;\n            if (prueba_actual == '4') {\n                tags_container = $('.tags-container:visible');\n                drop_zones = $('.drop-zone:visible');\n                prueba_tab = false;\n            }\n            drop_zones.find('.tag').each(function () {\n                $(this).appendTo(tags_container);\n                limpiarPosicion($(this));\n            });\n            inicializarDraggables();\n            configurarDropZones();\n            if (prueba_tab) {\n                tab_activo.find('.btn-restablecer-etiquetas').addClass('d-none');\n            } else {\n                $('.btn-restablecer-etiquetas').addClass('d-none');\n            }\n\n            if (prueba_actual != 12 && tab_activo.attr('id') != 'tab-factor_id_2') {\n                $(\"#siguiente_perfil\").attr('disabled', true);\n            }\n            if (prueba_actual == 12  && tab_activo.attr('id') != 'tab-factor_id_2') {\n                $(\"#siguiente_perfil\").attr('disabled', true);\n                $(\"#btn-crear-perfil-final\").attr('disabled', true);\n            }\n            \n            arrastraAqui();\n            mostrarToast('success', 'Etiquetas restablecidas correctamente');\n        };\n\n        const manejarDrop = (destino, ui) => {\n            let original = $(ui.draggable);\n            let tag_id = parseInt(original.data(\"id\"));\n            let nivel_caja = destino.data(\"nivel\");\n            let factor_id_activo = $('.tab-pane.active').attr('id');\n            let maximo_caja_avanzado = 3;\n\n            // Validaciones específicas para el primer factor\n            if (factor_id_activo === 'tab-factor_id_0' || factor_id_activo === 'tab-factor_id_ia_0') {\n                if (prueba_actual == '12') {\n                    if (destino.find(\".tag\").length >= max_Caja_Factor) {\n                        mostrarErrorEnContenedor(destino, 'Solo puedes agregar 2 etiquetas por nivel');\n                        return;\n                    }\n                    if (nivel_caja === 'bajo' || nivel_caja === 'alto') {\n                        let ids_en_caja = destino.find(\".tag\").map(function () {\n                            return parseInt($(this).data(\"id\"));\n                        }).get();\n                        for (let i = 0; i < pares_Prohibidos_Factor.length; i++) {\n                            let [id_a, id_b] = pares_Prohibidos_Factor[i];\n                            if ((tag_id === id_a && ids_en_caja.includes(id_b)) ||\n                                (tag_id === id_b && ids_en_caja.includes(id_a))) {\n                                mostrarErrorEnContenedor(destino, 'Rasgos incompatibles. Elige otro.');\n                                return;\n                            }\n                        }\n                    }\n                }\n            }\n            if (factor_id_activo === 'tab-factor_id_2' || factor_id_activo === 'tab-factor_id_ia_2')\n                maximo_caja_avanzado = 2;\n\n            if (prueba_actual == '7') {\n                if (nivel_caja == 'avanzado') {\n                    if (destino.find(\".tag\").length >= maximo_caja_avanzado) {\n                        mostrarErrorEnContenedor(destino, `Solo puedes agregar ${maximo_caja_avanzado} etiquetas en este nivel`);\n                        return;\n                    }\n                }\n            }\n\n            // Verificar que no esté duplicado\n            if (destino.find(`.tag[data-id=\"${tag_id}\"]`).length === 0) {\n                original.appendTo(destino);\n                limpiarPosicion(original);\n                setTimeout(() => {\n                    inicializarDraggables();\n                    configurarDropZones();\n                    verificarBotonSiguiente();\n                    verificarCambiosYMostrarBoton();\n                }, 50);\n            }\n\n            arrastraAqui();\n        };\n\n        const configurarDropZones = () => {\n            $(\".drop-zone\").droppable({\n                accept: \".tag\",\n                tolerance: \"pointer\",\n                greedy: true,\n                drop: function (event, ui) {\n                    manejarDrop($(this), ui);\n                }\n            });\n\n            tags_Container.droppable({\n                accept: \".tag\",\n                tolerance: \"pointer\",\n                greedy: false,\n                drop: function (event, ui) {\n                    let original = $(ui.draggable);\n                    original.appendTo($(this));\n                    limpiarPosicion(original);\n\n                    setTimeout(() => {\n                        inicializarDraggables();\n                        configurarDropZones();\n                        verificarBotonSiguiente();\n                        verificarCambiosYMostrarBoton();\n                    }, 50);\n                }\n            });\n        };\n\n        $(document).off('click', '.btn-restablecer-etiquetas').on('click', '.btn-restablecer-etiquetas', function () {\n            var factor_id = $(this).data('factor-id');\n            restablecerEtiquetas(factor_id);\n        });\n\n        $(document).off('shown.bs.tab', '.nav-link').on('shown.bs.tab', '.nav-link', function () {\n            setTimeout(function () {\n                verificarCambiosYMostrarBoton();\n            }, 100);\n        });\n\n        // Inicializar todo\n        if ($(\".tag\").length > 0) {\n            inicializarDraggables();\n            configurarDropZones();\n        }\n    };\n\n    // Ejecutar inmediatamente con timeout\n    setTimeout(inicializarDragAndDrop, 200);\n\n    // También configurar para que se ejecute cuando se muestre el modal\n    $('#modal-crear-perfil').off('shown.bs.modal.dragdrop').on('shown.bs.modal.dragdrop', function () {\n        setTimeout(inicializarDragAndDrop, 100);\n        $('#nivel_educativo').select2({\n            dropdownParent: $('#modal-crear-perfil')\n        });\n    });\n}\n\n/**\n * Función para validar si se debe o no activar el botón siguiente y las pestañas.\n * \n * @returns {void}\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n * */\nfunction verificarBotonSiguiente() {\n    let id_activo = $(\".nav-item-horizontal.active\").eq(1).attr(\"id\");\n    let id_prueba = prueba_actual;\n    let todas_dimensiones_asignadas = validarTodasDimensionesAsignadas(id_prueba, id_activo);\n    let todas_cajas_con_uno = validarTodasCajasConUno(id_prueba, id_activo);\n    let cantidad_hijos = $('.tags-container:visible').children().length;\n    let validacion_potencial_comercial = true;\n    let validacion_iq_factorial = true;\n    let validacion_ethikos = true;\n    if (id_prueba == 7) {\n        let contador_general = 0;\n        $(\".drop-zone:visible\").each(function () {\n            const CANTIDAD_TAGS = $(this).find(\".tag\").length;\n            contador_general += CANTIDAD_TAGS;\n            if (id_activo == 'factor_id_2') {\n                if (cantidad_hijos > 3) {\n                    validacion_potencial_comercial = false;\n                }\n            }\n        });\n        if (contador_general < 3) {\n            validacion_potencial_comercial = false;\n        }\n    } else if (id_prueba == 4) {\n        let contador_general = 0;\n        $(\".drop-zone\").each(function () {\n            const CANTIDAD_TAGS = $(this).find(\".tag\").length;\n            contador_general += CANTIDAD_TAGS;\n        });\n        if (contador_general < 2) {\n            validacion_potencial_comercial = false;\n        }\n    } else if (id_prueba == 3) {\n        factores_ethikos = actualizaFactoresEthikos(0);\n        let index_tab = null;\n\n        if ($(\"#tabs-container .nav-item-horizontal.active\").length) {\n            index_tab = $(\"#tabs-container .nav-item-horizontal.active\").index();\n        } else if ($(\"#preview-factores-container .nav-item-horizontal.active\").length) {\n            index_tab = $(\"#preview-factores-container .nav-item-horizontal.active\").index();\n        }\n\n        let key_ethikos = Object.keys(factores_ethikos)[index_tab];        \n        if (key_ethikos == undefined || factores_ethikos[key_ethikos]?.dimensiones.length < 2) {\n            validacion_ethikos = false;\n        } else {\n            validacion_ethikos = true;\n        }        \n    }    \n\n    if (todas_cajas_con_uno && todas_dimensiones_asignadas && validacion_potencial_comercial && validacion_iq_factorial && validacion_ethikos) {\n        $(\"#siguiente_perfil\").attr('disabled', false);\n        $(\"#btn-crear-perfil-final\").attr('disabled', false);\n        $(\"#tabs-container .nav-item-horizontal.active\").next().attr('disabled', false).removeClass('disabled').attr('aria-disabled', 'false');\n        $(\"#preview-factores-container .nav-item-horizontal.active\").next().attr('disabled', false).removeClass('disabled').attr('aria-disabled', 'false');\n    } else {\n        $(\"#siguiente_perfil\").attr('disabled', true);\n        $(\"#btn-crear-perfil-final\").attr('disabled', true);\n        $(\"#tabs-container .nav-item-horizontal\").each(function () {\n            if ($(this).index() > $(\"#tabs-container .nav-item-horizontal.active\").index()) {\n                $(this).attr('disabled', true).addClass('disabled').attr('aria-disabled', 'true');\n            }\n        });\n        $(\"#preview-factores-container .nav-item-horizontal\").each(function () {\n            if ($(this).index() > $(\"#preview-factores-container .nav-item-horizontal.active\").index()) {\n                $(this).attr('disabled', true).addClass('disabled').attr('aria-disabled', 'true');\n            }\n        });\n    }\n};\n\n/**\n * Función para validar si todas las dimensiones han sido asignadas según el tipo de prueba.\n * \n * @param {number} id_prueba - ID de la prueba.\n * @param {string} id_factor - ID del HTML del factor activo.\n * @return {boolean} - Retorna true si todas las dimensiones están asignadas o si no es el caso y false en caso contrario.\n * @author José Manuel Jiménez\n */\nfunction validarTodasDimensionesAsignadas(id_prueba, id_factor) {\n    let todas_dimensiones_asignadas = true;\n    if (id_prueba == 12) { // Validación Ten DISC Plus\n        if (/^factor_id_(ia_)?(0|1)$/.test(id_factor)) { // Personalidad o Transversales\n            let cantidad_hijos = $('.tags-container:visible').children().length;\n            if (cantidad_hijos > 0) {\n                todas_dimensiones_asignadas = false;\n            }\n        }\n    }\n    return todas_dimensiones_asignadas;\n}\n\n/**\n * Función para validar si todas las cajas tienen al menos una dimensión asignada según el tipo de prueba.\n * \n * @param {number} id_prueba - ID de la prueba.\n * @param {string} id_factor - ID del HTML del factor activo.\n * @return {boolean} - Retorna true si todas las cajas tienen al menos una dimensión asignada o si no es el caso y false en caso contrario.\n * @author José Manuel Jiménez\n */\nfunction validarTodasCajasConUno(id_prueba, id_factor) {\n    let todas_cajas_con_uno = true;\n    if (id_prueba == 12) { // Validación Ten DISC Plus\n        if (id_factor == 'factor_id_0' || id_factor == 'factor_id_1') { // Personalidad o Transversales\n            $(\".drop-zone:visible\").each(function () {\n                const CANTIDAD_TAGS = $(this).find(\".tag\").length;        \n                if (CANTIDAD_TAGS == 0) {\n                    todas_cajas_con_uno = false;\n                }\n            });\n        }\n    }\n    return todas_cajas_con_uno;\n}\n\n/**\n * Función para volver a restablecer los botones.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction restablecerBotones() {\n    $(\"#nombre-perfil\").attr('disabled', false);\n    $(\"#nivel_educativo\").attr('disabled', false);\n    $(\".modal-crear-perfil\").removeClass('d-none');\n}\n\n/**\n * Función para activar los textos del arrastre aqui.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction arrastraAqui() {\n    $(\".drop-zone:visible\").each(function () {\n        const CANTIDAD_TAGS = $(this).find(\".tag\").length;        \n        var data_nivel = $(this).data(\"nivel\");\n\n        if (CANTIDAD_TAGS > 0) {\n            $(`.arrastra_${data_nivel}:visible`).text('');\n            $(`.arrastra_${data_nivel}:visible`).parent().removeClass(\"d-flex justify-content-center align-items-center\");\n        } else {\n            $(`.arrastra_${data_nivel}:visible`).text('Arrastra aquí');\n            $(`.arrastra_${data_nivel}:visible`).parent().addClass(\"d-flex justify-content-center align-items-center\");\n        }\n\n        if (CANTIDAD_TAGS == 0) {\n            todas_Con_Uno = false;\n        }\n    });\n}\n\n/**\n * Función para mostrar error en input.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction mostrarErrorEnInput(inputId, mensaje) {\n    var input = $(inputId);\n    input.siblings('.error-message').remove();\n    input.closest('.form-group').find('.error-message').remove();\n\n    const ERRORDIV = $(`<div class=\"error-message text-danger small\" style=\"font-size: 12px; margin-top: -1rem;\">${mensaje}</div>`);\n\n    input.parent().after(ERRORDIV);\n    setTimeout(() => {\n        ERRORDIV.fadeOut(300, function () {\n            $(this).remove();\n        });\n    }, 4000);\n}\n\n/**\n * Función para ver el perfil seleccionado.\n * \n * @param {number} prueba_id - ID de la prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verPerfilSeleccionado(prueba_id) {\n    let perfil_id = $('select[name=\"perfil_id_' + prueba_id + '\"]').val();\n    if (!perfil_id) {\n        mostrarToast('warning', 'Seleccione un perfil para ver su información');\n        return;\n    }\n    $.ajax({\n        url: `/perfiles/${perfil_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function (respuesta) {\n            let fecha_modificacion = respuesta.data.updated_at;\n            if (fecha_modificacion != null) {\n                fecha_modificacion = moment(fecha_modificacion).format('DD/MM/YYYY');\n                $('#fecha-modificacion-perfil').text(fecha_modificacion);\n            } else {\n                $('#fecha-modificacion-perfil').text('');\n            }\n            let factores = respuesta.data.factores_perfiles || [];\n            $('#contenedor-resumen-perfil').empty().append(crearAcordeon({\n                id: 'acordeon-perfil',\n                acordeon: factores.map((factor, indice_factor) => ({\n                    id: `factor-${indice_factor}`,\n                    titulo: factor.factor.nombre,\n                    contenido: `\n                        ${factor.dimensiones_factores_perfiles.map((dimension, indice_dimension) => `\n                            <div class=\"col-12 ${(indice_dimension + 1) !== factor.dimensiones_factores_perfiles.length ? 'border-bottom' : ''}\">\n                                <div class=\"row justify-content-between align-items-center\">\n                                    <div class=\"col-auto text-body-2 text-gray-30\">\n                                        ${dimension.dimension.nombre}\n                                    </div>\n                                    <div class=\"col-auto py-2\">\n                                        ${obtenerTagFactor(dimension)}\n                                    </div>\n                                </div>\n                            </div>\n                        `).join('')}\n                    `\n                }))\n            }));\n            inicializarTooltips();\n            $('#modal-resumen-perfil').modal('show');\n            $('#modal-movimiento-6').addClass('d-none');\n        },\n        error: function () {\n            mostrarToast('danger', 'Ocurrió un error al obtener el perfil');\n        }\n    });\n}\n\n/**\n * Función para obtener el tag de la dimensión segun los límites.\n * \n * @param {Object} dimension - Objeto de la dimensión.\n * @returns {string}\n * @author José Manuel Jiménez\n */\nfunction obtenerTagFactor(dimension) {\n    let tipo_alerta = '';\n    let puntaje = '';\n    if (dimension.limite_superior == 40) {\n        tipo_alerta = 'danger';\n        puntaje = 'Bajo';\n    } else if (dimension.limite_superior == 70) {\n        tipo_alerta = 'warning';\n        puntaje = 'Medio';\n    } else if (dimension.limite_inferior == 71) {\n        tipo_alerta = 'success';\n        puntaje = 'Alto';\n    } else if (dimension.limite_inferior == 91) {\n        tipo_alerta = 'info';\n        puntaje = 'Avanzado';\n    }\n    return `\n        ${crearAlerta(\n            tipo_alerta,\n            `${puntaje}\n            <i class=\"bi bi-info-circle ms-1\"\n                ${crearTooltip({\n                    placement: `top`,\n                    content: `Tus candidatos deben sacar un puntaje de ${dimension.limite_inferior} - ${dimension.limite_superior} para lograr un ajuste con la competencia.`,\n                    toggle: `popover`,\n                })}>\n            </i>`, 'p-2'\n        )}\n    `;\n}","structuredPatch":[{"oldStart":1152,"oldLines":6,"newStart":1152,"newLines":14,"lines":["             $(\"#siguiente_perfil\").text('Siguiente');","         }","         if ($('#modal-movimiento-6').length) {","+            // Cerrar todos los Select2 abiertos para evitar que queden \"pegados\"","+            $('#modal-movimiento-6 .select2-hidden-accessible').each(function() {","+                $(this).select2('close');","+            });","+","+            // Remover cualquier dropdown de Select2 que pueda quedar abierto","+            $('.select2-container--open').removeClass('select2-container--open');","+","             $('#modal-movimiento-6').removeClass('d-none');","         }","     });"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"f3d39d07-e696-440d-8890-ed4f98927aff"}
{"parentUuid":"50c5754a-9391-4b4e-bba4-189321e9d885","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_012Bh572K7dgsB24SU4BaH5F","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto, ahora también necesito aplicar la misma solución para el modal de resumen de perfil. Voy a actualizarlo:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2121,"cache_read_input_tokens":119270,"cache_creation":{"ephemeral_5m_input_tokens":2121,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX64dHqG48ixxeh4RP1FJ","type":"assistant","uuid":"8a771663-2018-47f2-bb29-fe249ba08daa","timestamp":"2026-01-13T21:10:18.883Z"}
{"parentUuid":"8a771663-2018-47f2-bb29-fe249ba08daa","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_012Bh572K7dgsB24SU4BaH5F","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018EQ6oVdNzzvwVzzpzzrT1F","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js","old_string":"    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\n        $('#modal-movimiento-6').removeClass('d-none');\n    });","new_string":"    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\n        // Cerrar todos los Select2 abiertos para evitar que queden \"pegados\"\n        $('#modal-movimiento-6 .select2-hidden-accessible').each(function() {\n            $(this).select2('close');\n        });\n\n        // Remover cualquier dropdown de Select2 que pueda quedar abierto\n        $('.select2-container--open').removeClass('select2-container--open');\n\n        $('#modal-movimiento-6').removeClass('d-none');\n    });"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2121,"cache_read_input_tokens":119270,"cache_creation":{"ephemeral_5m_input_tokens":2121,"ephemeral_1h_input_tokens":0},"output_tokens":341,"service_tier":"standard"}},"requestId":"req_011CX64dHqG48ixxeh4RP1FJ","type":"assistant","uuid":"145fdcae-99bf-4a49-93ce-21d1ada29ef9","timestamp":"2026-01-13T21:10:23.204Z"}
{"parentUuid":"145fdcae-99bf-4a49-93ce-21d1ada29ef9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018EQ6oVdNzzvwVzzpzzrT1F","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  1163→            $('#modal-movimiento-6').removeClass('d-none');\n  1164→        }\n  1165→    });\n  1166→\n  1167→    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\n  1168→        // Cerrar todos los Select2 abiertos para evitar que queden \"pegados\"\n  1169→        $('#modal-movimiento-6 .select2-hidden-accessible').each(function() {\n  1170→            $(this).select2('close');\n  1171→        });\n  1172→\n  1173→        // Remover cualquier dropdown de Select2 que pueda quedar abierto\n  1174→        $('.select2-container--open').removeClass('select2-container--open');\n  1175→\n  1176→        $('#modal-movimiento-6').removeClass('d-none');\n  1177→    });\n  1178→});\n  1179→\n  1180→/**\n  1181→ * Función para aplicar los filtros avanzados aplicados."}]},"uuid":"3b28a8f5-51a4-4337-b327-c030d4d01936","timestamp":"2026-01-13T21:10:29.361Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js","oldString":"    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\n        $('#modal-movimiento-6').removeClass('d-none');\n    });","newString":"    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\n        // Cerrar todos los Select2 abiertos para evitar que queden \"pegados\"\n        $('#modal-movimiento-6 .select2-hidden-accessible').each(function() {\n            $(this).select2('close');\n        });\n\n        // Remover cualquier dropdown de Select2 que pueda quedar abierto\n        $('.select2-container--open').removeClass('select2-container--open');\n\n        $('#modal-movimiento-6').removeClass('d-none');\n    });","originalFile":"var datos_ids = [];\nvar json_filtros = {};\nvar filtro_html = '';\nvar es_archivado = false;\nvar nombre_tabla = 'tabla-pefiles-pruebas';\nvar tabs_Completados = {};\nvar es_editar = false;\nvar factores_etikos = {}\nvar informacion;\nvar prueba_actual = 0;\nlet perfil_generado = null;\nlet es_inteligencia = false;\nlet es_detalle = false;\n\n$(`#${nombre_tabla}`).DataTable({\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [10, 25, 50, 100, 200],\n        [10, 25, 50, 100, 200]\n    ],\n    scrollX: true,\n    scrollY: false,\n    scrollCollapse: true,\n    ajax: {\n        url: `/perfiles-listado-empresa`,\n        data: function (datos) {\n            prueba_actual = $('#listado_pruebas_perfiles button.active').val();\n            datos.prueba_id = $('#listado_pruebas_perfiles button.active').val();\n            datos.archivado = es_archivado;\n            datos.recientes = $('#filtro_mas_recientes').val();\n            (json_filtros?.chips?.length > 0) ? datos.nombres = json_filtros.chips : '';\n            (json_filtros.nombre_creador) ? datos.usuario_id = json_filtros.nombre_creador : '';\n            if (typeof json_filtros.fecha_filtro === 'string') {\n                const partesFecha = json_filtros.fecha_filtro.split(' a ');\n                (partesFecha[0]) ? datos.fecha_inicio = partesFecha[0] : '';\n                (partesFecha[1]) ? datos.fecha_fin = partesFecha[1] : '';\n            }\n            $(\"#btn_crear_perfil\").data(\"prueba\", prueba_actual);\n            if (['12', '3', '4', '7'].includes(prueba_actual)) {\n                $(\"#btn_crear_perfil\").attr('disabled', false)\n            } else {\n                $(\"#btn_crear_perfil\").attr('disabled', true)\n            }\n        }\n    },\n    columns: [\n        {\n            data: null,\n            orderable: false,\n            className: 'p-2 rounded-3',\n            render: (dato) => {\n                var color_borde = '';\n                switch (prueba_actual) {\n                    case '3':\n                        color_borde = 'borde-ethikos';\n                        break;\n                    case '4':\n                        color_borde = 'borde-iq';\n                        break;\n                    case '7':\n                        color_borde = 'borde-potencial';\n                        break;\n                    case '12':\n                        color_borde = 'borde-tendisc';\n                        break;\n                    default:\n                        break;\n                }\n                return `\n                    <div class=\"card card-hover-opciones rounded-3 shadow-1 position-relative card-area-trabajo\">\n                        <div class=\"card-body ${dato?.es_publico == 1 ? color_borde : ''}\">\n                            <div class=\"row\">\n                                <div class=\"col-auto row my-auto\">\n                                    <img src='/imagenes/logos/pruebas/${dato?.prueba?.slug ?? ''}.png' class=\"rounded-circle\" alt=\"Foto de perfil\" width=\"60px\" height=\"60px\">\n                                </div>\n                                <div class=\"col\">\n                                   <p class=\"text-body-2 text-gray-10 fw-semibold\">${dato?.nombre ?? 'N/A'}</p>\n                                   <p class=\"text-body-2 mb-0 text-gray-30\">Creador: ${dato?.usuario?.nombre_completo ?? 'N/A'}</p>\n                                   <p class=\"text-body-2 mb-0 text-gray-30\">Creación: ${formatearFecha2(`${dato.created_at}`)}</p>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"opciones-card-hover rounded-end-3\">\n                            ${(!es_archivado) ? `\n                                    ${crearBoton({ clases: `btn-text-primary rounded-circle editar-perfil ${dato?.tiene_procesos_prueba || dato?.es_publico == 1 ? 'd-none' : ''}`, texto: '<i class=\"text-body-1 bi bi-pencil-square\"></i>', adicional: `${crearTooltip({ placement: `top`, content: `Editar`, toggle: `popover`, })} ${dato?.tiene_procesos_prueba || dato?.es_publico == 1 ? 'disabled' : ''} data-id_perfil='${dato.id}'` })}\n                                    <div class=\"boton-mas-opciones position-relative\">\n                                        <button class=\"btn btn-text-primary btn-circle\">\n                                            <i class=\"bi bi-three-dots\"></i>\n                                        </button>\n                                        <!-- Menú personalizado oculto -->\n                                        <div class=\"menu-mas-opciones\">\n                                            <button class=\"dropdown-item\" onclick=\"descargarPDF(${dato.id})\">Descargar</button>\n                                            <button class=\"dropdown-item\" onclick=\"$('#modal-duplicar-perfil').modal('show'); $('#id_perfil_duplicar').val(${dato.id}); $('#nombre_perfil_copia').val('${dato.nombre}'+' (Copia)')\">Duplicar</button>\n                                            <button class=\"dropdown-item ver-detalle\" data-id_perfil='${dato.id}'>Ver detalle</button>\n                                            <button class=\"${dato?.es_publico == 1 ? 'd-none' : ''} dropdown-item\" onclick=\"$('#modal-archivar-perfil').modal('show'); $('#id_perfil_archivar').val(${dato.id})\" ${dato?.es_publico == 1 ? 'disabled' : ''}>Archivar</button>\n                                            <button class=\"${dato?.tiene_procesos_prueba || dato?.es_publico == 1 ? 'd-none' : ''} dropdown-item text-danger\" onclick=\"$('#modal-eliminar-perfil').modal('show'); $('#id_perfil_eliminar').val(${dato.id})\" ${dato?.tiene_procesos_prueba || dato?.es_publico == 1 ? 'disabled' : ''}>Eliminar</button>\n                                        </div>\n                                    </div>\n                                ` : `\n                                    ${crearBoton({ clases: 'btn-text-primary rounded-circle', texto: '<i class=\"text-body-1 bi bi-archive-fill\"></i>', onclick: `archivarPerfil(${dato.id}, false)`, adicional: `${crearTooltip({ placement: `top`, content: `Desarchivar`, toggle: `popover`, })}` })}\n                                `\n                            }\n                        </div>\n                    </div>\n                `;\n            }\n        }\n    ],\n    drawCallback: function (settings) {\n        datos_ids = $(`#${nombre_tabla}`).DataTable().data().toArray();\n        validarDatos();\n        inicializarTooltips();\n        $('.opciones-card-hover').hide();\n        if ($('.card-area-trabajo').last().parent()[0] != undefined) {\n            $('.card-area-trabajo').last().parent()[0].classList.add('tamanio-uno');\n        }\n    },\n    initComplete: function (settings, json) {\n        datos_ids = $(`#${nombre_tabla}`).DataTable().data().toArray();\n        $(`#${nombre_tabla}`).find('tbody').addClass('tabla-cards-horizontal perfiles-horizontal');\n        $(`[aria-describedby=\"${nombre_tabla}_info\"] .thead-componente`).hide();\n        validarDatos();\n        inicializarTooltips();\n        $('.opciones-card-hover').hide();\n    }\n});\n\n$(document).ready(function () {\n    $(document).on('click', '.botones-grupo', function () {\n        $('.botones-grupo').removeClass('active');\n        $(this).addClass('active');\n        actualizarDatatables(`${nombre_tabla}`);\n    });\n\n    $(document).on('click', '.editar-perfil', function () {\n        es_detalle = false;\n        let id_perfil = $(this).data('id_perfil');\n        $(\"#id_perfil\").val(id_perfil);\n        $(\"#modal-crear-perfil_label\").text('Editar perfil');\n        restablecerBotones();\n        $('#tabs-container').empty();\n        $.ajax({\n            url: `/perfiles/${id_perfil}`,\n            type: 'GET',\n            success: function (response) {\n                response = response.data;\n                es_editar = true;\n                $('#siguiente_perfil').attr('disabled', false);\n                $('#modal-crear-perfil').modal('show');\n                $('#nombre-perfil').val(response.nombre);\n                $('#nivel_educativo').val(response.nivel_educativo_id).trigger('change');\n                $('#tipo_prueba').val(response.prueba_id).trigger('change');\n\n                $.ajax({\n                    url: `/pruebas/${response.prueba_id}/factores`,\n                    type: 'GET',\n                    success: function (resp_factores) {\n                        informacion = resp_factores.data;\n                        let tabs_data = [];\n                        let alerta = '';\n                        switch (response.prueba_id) {\n                            case 3:\n                                es_inteligencia = false;\n                                tabs_data = resp_factores.data.filter(element => element.factor_id !== 16).map((element, index) => {\n                                    let etiquetas = '';\n                                    let clase_personalizada = 'perfil_selected';\n                                    let tag_etiquetas = 'row justify-content-center gap-3';\n\n                                    let factor_perfil = response.factores_perfiles.find(fp => fp.factor_id === element.factor_id);\n                                    let dimensiones_seleccionadas = factor_perfil\n                                        ? factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id)\n                                        : [];\n\n                                    element.factor.dimensiones.forEach(dimension => {\n                                        let es_Seleccionada = dimensiones_seleccionadas.includes(dimension.id);\n                                        let clase_Extra = es_Seleccionada ? `${clase_personalizada} selected` : clase_personalizada;\n\n                                        etiquetas += `\n                                            ${crearCard({\n                                            col_tamanio: 'col-md-auto',\n                                            nombre_grupo: `etiqueta_${element.factor_id}`,\n                                            hidden: true,\n                                            adicional: clase_Extra,\n                                            contenido: `<div class=\"text-center ${clase_personalizada}_contenido ${es_Seleccionada ? 'selected' : ''}\"\n                                                                data-factor_id=\"${element.factor_id}\"\n                                                                data-dimension=\"${dimension.id}\">\n                                                                ${dimension.nombre}\n                                                            </div>`\n                                        })}\n                                        `;\n                                    });\n\n                                    return {\n                                        id: 'factor_id_' + index,\n                                        titulo: element.factor.nombre,\n                                        tooltip: element.factor.descripcion,\n                                        clase_nav: 'col-4 justify-content-center',\n                                        contenido: `\n                                            <div class=\"row mx-3\">\n                                                <input type=\"hidden\" id=\"factor_id_escondido\" name=\"factor_id\" value=\"${element.factor_id}\">\n                                                <div class=\"mt-4\">\n                                                    <p>Selecciona minimo 2 valores que deseas para evaluar en este perfil.</p>\n                                                </div>\n                                                <div class=\"tags-container ${tag_etiquetas} col-10\">\n                                                    ${etiquetas}\n                                                </div>\n                                            </div>\n                                        `,\n                                        activo: index === 0,\n                                        disabled: es_editar ? false : index !== 0\n                                    };\n                                });\n\n                                $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n                                $('#nivel_educativo_div').hide();\n                                break;\n                            case 4:\n                                let etiquetas_libres_case4 = '';\n                                let etiquetas_medio = '';\n                                let etiquetas_alto = '';\n                                let etiquetas_avanzado = '';\n\n                                resp_factores.data.forEach(factorPrueba => {\n                                    // buscamos si este factor está en response.factores_perfiles\n                                    let factorPerfil = response.factores_perfiles.find(fp => fp.factor_id === factorPrueba.factor.id);\n\n                                    if (factorPerfil && factorPerfil.dimensiones_factores_perfiles.length > 0) {\n                                        // tomar solo el primer dato de dimensiones_factores_perfiles\n                                        let dfp = factorPerfil.dimensiones_factores_perfiles[0];\n                                        let etiquetaHTML = `<div class=\"tag\" data-id=\"${factorPrueba.factor.id}\">${factorPrueba.factor.nombre}</div>`;\n\n                                        if (dfp.limite_inferior >= 50 && dfp.limite_superior <= 70) {\n                                            etiquetas_medio += etiquetaHTML;\n                                        } else if (dfp.limite_inferior >= 71 && dfp.limite_superior <= 90) {\n                                            etiquetas_alto += etiquetaHTML;\n                                        } else if (dfp.limite_inferior >= 91 && dfp.limite_superior <= 100) {\n                                            etiquetas_avanzado += etiquetaHTML;\n                                        } else {\n                                            etiquetas_libres_case4 += etiquetaHTML; // si no cae en ningún rango\n                                        }\n                                    } else {\n                                        // si el factor no está en el perfil → queda libre\n                                        etiquetas_libres_case4 += `<div class=\"tag\" data-id=\"${factorPrueba.factor.id}\">${factorPrueba.factor.nombre}</div>`;\n                                    }\n                                });\n\n                                let valor_medio = '50 - 70';\n                                let valor_alto = '71 - 90';\n                                let valor_avanzado = '91 - 100';\n\n                                let contenido_case4 = `\n                                        <div class=\"row mx-3\">\n                                            <div class=\"mt-4\">\n                                                <p>Arrastra las habilidades cognitivas de acuerdo al nivel que deseas asignar.</p>\n                                            </div>\n                                            <div class=\"d-flex mb-2\">\n                                                ${crearBoton({\n                                                    type: 'button',\n                                                    clases: 'btn-primary btn-restablecer-etiquetas',\n                                                    texto: '<i class=\"bi bi-bag-x-fill me-3\"></i> Restablecer',\n                                                    data: [{ texto: 'FACTOR-id', value: 4 }]\n                                                })}\n                                                <div class=\"tags-container col-10\">\n                                                    ${etiquetas_libres_case4}\n                                                </div>\n                                            </div>\n                                            <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                    <div class=\"nivel medio\">\n                                                        <div class=\"zona-tags drop-zone\" data-nivel=\"medio\"><label class=\"arrastra_medio text-gray-60 text-body-2\"></label>${etiquetas_medio}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio}`, toggle: `popover` })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                    <div class=\"nivel alto\">\n                                                        <div class=\"zona-tags drop-zone\" data-nivel=\"alto\"><label class=\"arrastra_alto text-gray-60 text-body-2\"></label>${etiquetas_alto}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto}`, toggle: `popover` })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                    <div class=\"nivel avanzado\">\n                                                        <div class=\"zona-tags drop-zone\" data-nivel=\"avanzado\"><label class=\"arrastra_avanzado text-gray-60 text-body-2\"></label>${etiquetas_avanzado}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado}`, toggle: `popover` })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    `;\n\n                                $('#tabs-container').append(contenido_case4);\n                                $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n                                $('#nivel_educativo_div').hide();\n                                break;\n\n                            case 7:\n                                tabs_data = response.factores_perfiles\n                                    .filter(factor_perfil => factor_perfil.factor_id !== 35)\n                                    .map((factor_perfil, index) => {\n                                        let factor_Prueba = resp_factores.data.find(f => f.factor_id === factor_perfil.factor_id);\n                                        let dimensiones_Perfil_Ids = factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id);\n                                        let dimensiones_Prueba = factor_Prueba.factor.dimensiones;\n                                        let etiquetas_libres = '';\n                                        dimensiones_Prueba\n                                            .filter(d => !dimensiones_Perfil_Ids.includes(d.id))\n                                            .forEach(d => {\n                                                etiquetas_libres += `<div class=\"tag\" data-id=\"${d.id}\">${d.nombre}</div>`;\n                                            });\n\n                                        let etiquetas_medio = '';\n                                        let etiquetas_alto = '';\n                                        let etiquetas_avanzado = '';\n\n                                        factor_perfil.dimensiones_factores_perfiles.forEach(df => {\n                                            let etiquetaHTML = `<div class=\"tag\" data-id=\"${df.dimension.id}\">${df.dimension.nombre}</div>`;\n                                            if (df.limite_inferior >= 50 && df.limite_superior <= 70) etiquetas_medio += etiquetaHTML;\n                                            else if (df.limite_inferior >= 71 && df.limite_superior <= 90) etiquetas_alto += etiquetaHTML;\n                                            else if (df.limite_inferior >= 91 && df.limite_superior <= 100) etiquetas_avanzado += etiquetaHTML;\n                                        });\n\n                                        let instrucciones = `Arrastra las ${dimensiones_Prueba.length} etiquetas de acuerdo al nivel que deseas asignar.`;\n\n                                        let valor_medio = '50 - 70';\n                                        let valor_alto = '71 - 90';\n                                        let valor_avanzado = '91 - 100';\n\n                                        let contenido_medio = `\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                <div class=\"nivel medio\">\n                                                    <div class=\"zona-tags drop-zone\" data-nivel=\"medio\"><label class=\"arrastra_medio text-gray-60 text-body-2\"></label>${etiquetas_medio}</div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio}`, toggle: `popover` })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        `;\n\n                                        let contenido_alto = `\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                <div class=\"nivel alto\">\n                                                    <div class=\"zona-tags drop-zone\" data-nivel=\"alto\"><label class=\"arrastra_alto text-gray-60 text-body-2\"></label>${etiquetas_alto}</div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto}`, toggle: `popover` })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        `;\n\n                                        let contenido_avanzado = `\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                <div class=\"nivel avanzado\">\n                                                    <div class=\"zona-tags drop-zone\" data-nivel=\"avanzado\"><label class=\"arrastra_avanzado text-gray-60 text-body-2\"></label>${etiquetas_avanzado}</div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado}`, toggle: `popover` })} class=\"zona-rango text-white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        `;\n\n                                        return {\n                                            id: 'factor_id_' + index,\n                                            titulo: factor_perfil.factor.nombre,\n                                            tooltip: factor_perfil.factor.descripcion,\n                                            activo: index === 0,\n                                            disabled: false,\n                                            contenido: `\n                                            <div class=\"row mx-3\">\n                                                <input type=\"hidden\" name=\"factor_id\" value=\"${factor_perfil.factor_id}\">\n                                                <div class=\"mt-4\">\n                                                    <p>${instrucciones}</p>\n                                                </div>\n                                                <div class=\"d-flex mb-2\">\n                                                    ${crearBoton({\n                                                        type: 'button',\n                                                        clases: 'btn-primary btn-restablecer-etiquetas',\n                                                        texto: '<i class=\"bi bi-bag-x-fill me-3\"></i> Restablecer',\n                                                        data: [{ texto: 'FACTOR-id', value: factor_perfil.factor_id }]\n                                                    })}\n                                                    <div class=\"tags-container col-10\">\n                                                        ${etiquetas_libres}\n                                                    </div>\n                                                </div>\n                                                <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                    ${contenido_medio}\n                                                    ${contenido_alto}\n                                                    ${contenido_avanzado}\n                                                </div>\n                                            </div>\n                                        `\n                                        };\n                                    });\n                                    \n                                $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6');\n                                $('#nivel_educativo_div').show();\n                                restablecerBoton();\n                                break;\n\n                            case 12:\n                                tabs_data = response.factores_perfiles\n                                    .filter(factor_perfil => factor_perfil.factor_id !== 78)\n                                    .map((factor_perfil, index) => {\n                                        if (factor_perfil.factor_id == 77) {\n                                            let factor_Prueba = resp_factores.data.find(f => f.factor_id == 77);\n                                            let etiquetas = '';\n                                            factor_Prueba.factor.dimensiones.forEach(element => {\n                                                etiquetas += `\n                                                    ${crearCard({\n                                                        col_tamanio: 'col-md-auto',\n                                                        nombre_grupo: `etiqueta_${element.factor_id}`,\n                                                        hidden: true,\n                                                        contenido: `<div ${crearTooltip({ placement: `top`, content:  `${element.descripcion}`, toggle: `popover` })}><i class=\"bi bi-flag-fill text-danger me-3\"></i> ${element.nombre}</div>`\n                                                    })}\n                                                `;\n                                            });\n\n                                            return {\n                                                id: 'factor_id_riesgos',\n                                                titulo: 'Riesgos laborales',\n                                                tooltip: 'Riesgos laborales',\n                                                activo: false,\n                                                disabled: false,\n                                                contenido: `\n                                                <div class=\"row mx-3\">\n                                                    <div class=\"mt-4\">\n                                                        <p>\n                                                            Conoce los riesgos emocionales que evaluamos en Ten DISC Plus.\n                                                            Acerca el cursor para ver la definición.\n                                                        </p>\n                                                    </div>\n                                                    <div class=\"row justify-content-center gap-3\">\n                                                        ${etiquetas}\n                                                    </div>\n                                                </div>\n                                            `\n                                            };\n                                        }\n\n                                        let factor_Prueba = resp_factores.data.find(f => f.factor_id === factor_perfil.factor_id);\n                                        let dimensiones_Perfil_Ids = factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id);\n                                        let dimensiones_Prueba = factor_Prueba.factor.dimensiones;\n\n                                        let etiquetas_libres = '';\n                                        dimensiones_Prueba\n                                            .filter(d => !dimensiones_Perfil_Ids.includes(d.id))\n                                            .forEach(d => {\n                                                etiquetas_libres += `<div class=\"tag\" data-id=\"${d.id}\">${d.nombre}</div>`;\n                                            });\n\n                                        let etiquetas_bajo = '';\n                                        let etiquetas_medio = '';\n                                        let etiquetas_alto = '';\n                                        let etiquetas_avanzado = '';\n\n                                        factor_perfil.dimensiones_factores_perfiles.forEach(df => {\n                                            let etiquetaHTML = `<div class=\"tag\" data-id=\"${df.dimension.id}\">${df.dimension.nombre}</div>`;\n                                            if (df.limite_inferior >= 10 && df.limite_superior <= 40) etiquetas_bajo += etiquetaHTML;\n                                            else if (df.limite_inferior >= 41 && df.limite_superior <= 70) etiquetas_medio += etiquetaHTML;\n                                            else if ((index == 0 && df.limite_inferior >= 71 && df.limite_superior <= 100) || df.limite_inferior >= 71 && df.limite_superior <= 90) etiquetas_alto += etiquetaHTML;\n                                            else if (df.limite_inferior >= 91 && df.limite_superior <= 100) etiquetas_avanzado += etiquetaHTML;\n                                        });\n\n                                        let instrucciones = `Arrastra las ${dimensiones_Prueba.length} etiquetas de acuerdo al nivel que deseas asignar.`;\n                                        if (factor_perfil.factor_id == 77) {\n                                            instrucciones = `Conoce los riesgos emocionales que evaluamos en Ten DISC Plus. Acerca el cursor para ver la definición.`;\n                                        }\n\n                                        let valor_bajo = '10 - 40';\n                                        let valor_medio = '50 - 70';\n                                        let valor_alto = '71 - 90';\n                                        let valor_avanzado = '91 - 100';\n\n                                        let contenido_bajo = '';\n                                        if (index === 0) {\n                                            valor_medio = '41 - 70';\n                                            valor_alto = '71 - 100';\n                                            contenido_bajo = `\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill bajo-color mx-2\"></i><strong>Bajo</strong></p>\n                                                    <div class=\"nivel bajo\">\n                                                        <div class=\"zona-tags drop-zone\" data-nivel=\"bajo\"><label class=\"arrastra_bajo text-gray-60 text-body-2\"></label>${etiquetas_bajo}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_bajo}`, toggle: `popover` })} class=\"zona-rango\">${valor_bajo}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                            `;\n                                        }\n\n                                        let contenido_medio = `\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                    <div class=\"nivel medio\">\n                                                        <div class=\"zona-tags drop-zone\" data-nivel=\"medio\"><label class=\"arrastra_medio text-gray-60 text-body-2\"></label>${etiquetas_medio}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio}`, toggle: `popover` })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                            `;\n\n                                        let contenido_alto = `\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                <div class=\"nivel alto\">\n                                                    <div class=\"zona-tags drop-zone\" data-nivel=\"alto\"><label class=\"arrastra_alto text-gray-60 text-body-2\"></label>${etiquetas_alto}</div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto}`, toggle: `popover` })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        `;\n\n                                        let contenido_avanzado = '';\n                                        if (factor_perfil.factor_id == 75 || factor_perfil.factor_id == 76) {\n                                            contenido_avanzado = `\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                <div class=\"nivel avanzado\">\n                                                    <div class=\"zona-tags drop-zone\" data-nivel=\"avanzado\"><label class=\"arrastra_avanzado text-gray-60 text-body-2\"></label>${etiquetas_avanzado}</div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado}`, toggle: `popover` })} class=\"zona-rango text-white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        `;\n                                        }\n\n                                        if (factor_perfil.factor_id == 76) {\n                                            instrucciones = `Arrastra las etiquetas de acuerdo al nivel que deseas asignar.`;\n                                            alerta = `\n                                                    <div class=\"my-4\">\n                                                            ${crearAlerta('info', 'Esta sección es opcional. Puedes completarla si deseas incluir competencias específicas')}\n                                                    </div>\n                                                `;\n                                        }\n\n                                        return {\n                                            id: 'factor_id_' + index,\n                                            titulo: factor_perfil.factor.nombre,\n                                            tooltip: factor_perfil.factor.descripcion,\n                                            activo: index === 0,\n                                            disabled: false,\n                                            contenido: `\n                                            <div class=\"row mx-3\">\n                                                <input type=\"hidden\" name=\"factor_id\" value=\"${factor_perfil.factor_id}\">\n                                                ${alerta}\n                                                <div class=\"mt-4\">\n                                                    <p>${instrucciones}</p>\n                                                </div>\n                                                <div class=\"d-flex mb-2\">\n                                                    ${crearBoton({\n                                                        type: 'button',\n                                                        clases: 'btn-primary btn-restablecer-etiquetas',\n                                                        texto: '<i class=\"bi bi-bag-x-fill me-3\"></i> Restablecer',\n                                                        data: [{ texto: 'FACTOR-id', value: factor_perfil.factor_id }]\n                                                    })}\n                                                    <div class=\"tags-container col-10\">\n                                                        ${etiquetas_libres}\n                                                    </div>\n                                                </div>\n                                                <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                    ${contenido_bajo}\n                                                    ${contenido_medio}\n                                                    ${contenido_alto}\n                                                    ${contenido_avanzado}\n                                                </div>\n                                            </div>\n                                        `\n                                        };\n                                    });\n\n                                $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6')\n                                $('#nivel_educativo_div').show();\n                                restablecerBoton();\n                                break;\n                        }\n\n                        let tabs = crearTabsHorizontal({ id: 'factores', tabs: tabs_data });\n                        $('#tabs-container').append(tabs);\n                        inicializarTooltips();\n                        activarDrop();\n                    }\n                });\n            },\n            error: function () {\n                mostrarToast('danger', 'Ocurrió un error');\n            }\n        });\n        $(\"#siguiente_perfil\").removeAttr('data-id');\n        $(\"#siguiente_perfil\").removeData('id');\n        if (prueba_actual != 4) {\n            $(\"#siguiente_perfil\").text('Siguiente');\n        } else {\n            $(\"#siguiente_perfil\").text('Editar perfil');\n        }\n    });\n\n    $(document).on('click', '.ver-detalle', function () {\n        es_detalle = true;\n        let id_perfil = $(this).data('id_perfil');\n        $(\"#id_perfil\").val(id_perfil);\n        $(\"#modal-crear-perfil_label\").text('Visualizar perfil');\n        $(\".modal-crear-perfil\").addClass('d-none');\n        $('#tabs-container').empty();\n\n        $.ajax({\n            url: `/perfiles/${id_perfil}`,\n            type: 'GET',\n            success: function (response) {\n                response = response.data;\n                es_editar = false;\n                $('#siguiente_perfil').attr('disabled', true).hide(); \n                $('#modal-crear-perfil').modal('show');\n\n                $('#nombre-perfil').val(response.nombre).prop('disabled', true);\n                $('#nivel_educativo').val(response.nivel_educativo_id).trigger('change').prop('disabled', true);\n                $('#tipo_prueba').val(response.prueba_id).trigger('change').prop('disabled', true);\n\n                $.ajax({\n                    url: `/pruebas/${response.prueba_id}/factores`,\n                    type: 'GET',\n                    success: function (resp_factores) {\n                        informacion = resp_factores.data;\n                        let tabs_data = [];\n                        \n                        switch (response.prueba_id) {\n                            case 3:\n                                tabs_data = resp_factores.data\n                                    .filter(element => element.factor_id !== 16)\n                                    .map((element, index) => {\n                                        let etiquetas = '';\n                                        let clase_personalizada = 'perfil_seleccionado';\n\n                                        let factor_perfil = response.factores_perfiles.find(fp => fp.factor_id === element.factor_id);\n                                        let dimensiones_seleccionadas = factor_perfil\n                                            ? factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id)\n                                            : [];\n\n                                        element.factor.dimensiones.forEach(dimension => {\n                                            let es_Seleccionada = dimensiones_seleccionadas.includes(dimension.id);\n                                            let clase_Extra = es_Seleccionada ? `${clase_personalizada} selected` : `${clase_personalizada} disabled`;\n\n                                            etiquetas += `\n                                                ${crearCard({\n                                                    col_tamanio: 'col-md-auto',\n                                                    nombre_grupo: `etiqueta_${element.factor_id}`,\n                                                    hidden: true,\n                                                    adicional: clase_Extra,\n                                                    contenido: `<div class=\"text-center ${clase_personalizada}_contenido ${es_Seleccionada ? 'selected' : 'disabled'} no-interactive\"\n                                                                    data-factor_id=\"${element.factor_id}\"\n                                                                    data-dimension=\"${dimension.id}\">\n                                                                    ${dimension.nombre}\n                                                                </div>`\n                                                })}\n                                            `;\n                                        });\n\n                                        return {\n                                            id: 'factor_id_' + index,\n                                            titulo: element.factor.nombre,\n                                            tooltip: element.factor.descripcion,\n                                            clase_nav: 'col-4 justify-content-center',\n                                            contenido: `\n                                                <div class=\"row mx-3 m-4\">\n                                                    <div class=\"tags-container row justify-content-center gap-3 no-interactive\">\n                                                        ${etiquetas}\n                                                    </div>\n                                                </div>\n                                            `,\n                                            activo: index === 0,\n                                            disabled: false\n                                        };\n                                    });\n\n                                $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n                                $('#nivel_educativo_div').hide();\n                                break;\n\n                            case 4:\n                                let etiquetas_libres_case4 = '';\n                                let etiquetas_medio = '';\n                                let etiquetas_alto = '';\n                                let etiquetas_avanzado = '';\n                                resp_factores.data.forEach(factorPrueba => {\n                                    let factorPerfil = response.factores_perfiles.find(fp => fp.factor_id === factorPrueba.factor.id);\n                                    if (factorPerfil && factorPerfil.dimensiones_factores_perfiles.length > 0) {\n                                        let dfp = factorPerfil.dimensiones_factores_perfiles[0];\n                                        let etiquetaHTML = `<div class=\"tag disabled\">${factorPrueba.factor.nombre}</div>`;\n                                        if (dfp.limite_inferior >= 50 && dfp.limite_superior <= 70) etiquetas_medio += etiquetaHTML;\n                                        else if (dfp.limite_inferior >= 71 && dfp.limite_superior <= 90) etiquetas_alto += etiquetaHTML;\n                                        else if (dfp.limite_inferior >= 91 && dfp.limite_superior <= 100) etiquetas_avanzado += etiquetaHTML;\n                                        else etiquetas_libres_case4 += etiquetaHTML;\n                                    } else {\n                                        etiquetas_libres_case4 += `<div class=\"tag disabled\">${factorPrueba.factor.nombre}</div>`;\n                                    }\n                                });\n                                let valor_medio = '50 - 70';\n                                let valor_alto = '71 - 90';\n                                let valor_avanzado = '91 - 100';\n                                let contenido_case4 = `\n                                    <div class=\"row mx-3 mt-4\">\n                                        <div class=\"tags-container\">${etiquetas_libres_case4}</div>\n                                        <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                <div class=\"nivel medio readonly\">\n                                                    <div class=\"zona-tags\" data-nivel=\"medio\">\n                                                        ${etiquetas_medio}\n                                                    </div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                <div class=\"nivel alto readonly\">\n                                                    <div class=\"zona-tags\" data-nivel=\"alto\">\n                                                        ${etiquetas_alto}\n                                                    </div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-4\">\n                                                <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                <div class=\"nivel avanzado readonly\">\n                                                    <div class=\"zona-tags\" data-nivel=\"avanzado\">\n                                                        ${etiquetas_avanzado}    \n                                                    </div>\n                                                    <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                `;\n                                $('#tabs-container').append(contenido_case4);\n                                $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n                                $('#nivel_educativo_div').hide();\n                                break;\n\n                            case 7:\n                                tabs_data = response.factores_perfiles\n                                    .filter(factor_perfil => factor_perfil.factor_id !== 35)\n                                    .map((factor_perfil, index) => {\n                                        let factor_Prueba = resp_factores.data.find(f => f.factor_id === factor_perfil.factor_id);\n                                        let dimensiones_Perfil_Ids = factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id);\n                                        let dimensiones_Prueba = factor_Prueba.factor.dimensiones;\n                                        let etiquetas_libres = '';\n                                        dimensiones_Prueba\n                                            .filter(d => !dimensiones_Perfil_Ids.includes(d.id))\n                                            .forEach(d => {\n                                                etiquetas_libres += `<div class=\"tag disabled\">${d.nombre}</div>`;\n                                            });\n                                        let etiquetas_medio = '';\n                                        let etiquetas_alto = '';\n                                        let etiquetas_avanzado = '';\n                                        factor_perfil.dimensiones_factores_perfiles.forEach(df => {\n                                            let etiquetaHTML = `<div class=\"tag disabled\">${df.dimension.nombre}</div>`;\n                                            if (df.limite_inferior >= 50 && df.limite_superior <= 70) etiquetas_medio += etiquetaHTML;\n                                            else if (df.limite_inferior >= 71 && df.limite_superior <= 90) etiquetas_alto += etiquetaHTML;\n                                            else if (df.limite_inferior >= 91 && df.limite_superior <= 100) etiquetas_avanzado += etiquetaHTML;\n                                        });\n                                        let valor_medio = '50 - 70';\n                                        let valor_alto = '71 - 90';\n                                        let valor_avanzado = '91 - 100';\n                                        return {\n                                            id: 'factor_id_' + index,\n                                            titulo: factor_perfil.factor.nombre,\n                                            tooltip: factor_perfil.factor.descripcion,\n                                            activo: index === 0,\n                                            disabled: false,\n                                            contenido: `\n                                                <div class=\"row mx-3 mt-4\">\n                                                    <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                        <div class=\"col-4\">\n                                                            <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                            <div class=\"nivel medio readonly\">\n                                                                <div class=\"zona-tags\" data-nivel=\"medio\">\n                                                                    ${etiquetas_medio}\n                                                                </div>\n                                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                            </div>\n                                                        </div>\n                                                        <div class=\"col-4\">\n                                                            <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                            <div class=\"nivel alto readonly\">\n                                                                <div class=\"zona-tags\" data-nivel=\"alto\">\n                                                                    ${etiquetas_alto}\n                                                                </div>\n                                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                            </div>\n                                                        </div>\n                                                        <div class=\"col-4\">\n                                                            <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                            <div class=\"nivel avanzado readonly\">\n                                                                <div class=\"zona-tags\" data-nivel=\"avanzado\">\n                                                                    ${etiquetas_avanzado}    \n                                                                </div>\n                                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            `\n                                        };\n                                    });\n                                $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6');\n                                $('#nivel_educativo_div').show();\n                                break;\n\n                            case 12:\n                                tabs_data = response.factores_perfiles\n                                    .filter(factor_perfil => factor_perfil.factor_id !== 78)\n                                    .map((factor_perfil, index) => {\n                                        if (factor_perfil.factor_id == 77) {\n                                            let factor_Prueba = resp_factores.data.find(f => f.factor_id == 77);\n                                            let etiquetas = '';\n                                            factor_Prueba.factor.dimensiones.forEach(element => {\n                                                var icono = '';\n                                                var tooltip = '';\n                                                if (element.factor_id == 77) {\n                                                    icono = '<i class=\"bi bi-flag-fill text-danger me-3\"></i>';\n                                                    tooltip = `${crearTooltip({ placement: `top`, content:  `${element.descripcion}`, toggle: `popover` })}`;\n                                                }\n                                                etiquetas += `\n                                                        ${crearCard({\n                                                            col_tamanio: 'col-md-auto ',\n                                                            nombre_grupo: `etiqueta_${element.factor_id}`,\n                                                            hidden: true,\n                                                            contenido: `<div ${tooltip} class=\"text-center\" data-factor_id=\"${element.factor_id}\" data-dimension=\"${element.id}\">${icono} ${element.nombre}</div>`\n                                                        })}\n                                                    `;\n                                            });\n                                            return {\n                                                id: 'factor_id_riesgos',\n                                                titulo: 'Riesgos laborales',\n                                                activo: false,\n                                                disabled: false,\n                                                contenido: `\n                                                    <div class=\"row mx-3 mt-4\">\n                                                        <div class=\"row justify-content-center gap-3\">${etiquetas}</div>\n                                                    </div>\n                                                `\n                                            };\n                                        }\n                                        let factor_Prueba = resp_factores.data.find(f => f.factor_id === factor_perfil.factor_id);\n                                        let dimensiones_Perfil_Ids = factor_perfil.dimensiones_factores_perfiles.map(df => df.dimension_id);\n                                        let dimensiones_Prueba = factor_Prueba.factor.dimensiones;\n                                        let etiquetas_libres = '';\n                                        dimensiones_Prueba\n                                            .filter(d => !dimensiones_Perfil_Ids.includes(d.id))\n                                            .forEach(d => {\n                                                etiquetas_libres += `<div class=\"tag disabled\">${d.nombre}</div>`;\n                                            });\n                                        let etiquetas_bajo = '';\n                                        let etiquetas_medio = '';\n                                        let etiquetas_alto = '';\n                                        let etiquetas_avanzado = '';\n                                        factor_perfil.dimensiones_factores_perfiles.forEach(df => {\n                                            let etiquetaHTML = `<div class=\"tag disabled\">${df.dimension.nombre}</div>`;\n                                            if (df.limite_inferior >= 10 && df.limite_superior <= 40) etiquetas_bajo += etiquetaHTML;\n                                            else if (df.limite_inferior >= 41 && df.limite_superior <= 70) etiquetas_medio += etiquetaHTML;\n                                            else if ((index == 0 && df.limite_inferior >= 71 && df.limite_superior <= 100) || df.limite_inferior >= 71 && df.limite_superior <= 90) etiquetas_alto += etiquetaHTML;\n                                            else if (df.limite_inferior >= 91 && df.limite_superior <= 100) etiquetas_avanzado += etiquetaHTML;\n                                        });\n                                        let valor_bajo = '10 - 40';\n                                        let valor_medio = (index === 0 ? '41 - 70' : '50 - 70');\n                                        let valor_alto = (index === 0 ? '71 - 100' : '71 - 90');\n                                        let valor_avanzado = '91 - 100';\n                                        let contenido_bajo = '';\n                                        if (index === 0) {\n                                            contenido_bajo = `\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill bajo-color mx-2\"></i><strong>Bajo</strong></p>\n                                                    <div class=\"nivel bajo readonly\">\n                                                        <div class=\"zona-tags\" data-nivel=\"bajo\">${etiquetas_bajo}</div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_bajo} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango\">${valor_bajo}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                            `;\n                                        }\n                                        let contenido_avanzado = '';\n                                        if (factor_perfil.factor_id == 75 || factor_perfil.factor_id == 76) {\n                                            contenido_avanzado = `\n                                                <div class=\"col-4\">\n                                                    <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                                    <div class=\"nivel avanzado readonly\">\n                                                        <div class=\"zona-tags\" data-nivel=\"avanzado\">\n                                                            ${etiquetas_avanzado}    \n                                                        </div>\n                                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                    </div>\n                                                </div>\n                                            `;\n                                        }\n                                        return {\n                                            id: 'factor_id_' + index,\n                                            titulo: factor_perfil.factor.nombre,\n                                            tooltip: factor_perfil.factor.descripcion,\n                                            activo: index === 0,\n                                            disabled: false,\n                                            contenido: `\n                                                <div class=\"row mx-3 mt-4\">\n                                                    <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                        ${contenido_bajo}\n                                                        <div class=\"col-4\">\n                                                            <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                                            <div class=\"nivel medio readonly\">\n                                                                <div class=\"zona-tags\" data-nivel=\"medio\">\n                                                                    ${etiquetas_medio}\n                                                                </div>\n                                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                            </div>\n                                                        </div>\n                                                        <div class=\"col-4\">\n                                                            <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                                            <div class=\"nivel alto readonly\">\n                                                                <div class=\"zona-tags\" data-nivel=\"alto\">\n                                                                    ${etiquetas_alto}\n                                                                </div>\n                                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                                            </div>\n                                                        </div>\n                                                        ${contenido_avanzado}\n                                                    </div>\n                                                </div>\n                                            `\n                                        };\n                                    });\n                                $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6');\n                                $('#nivel_educativo_div').show();\n                                break;\n                        }\n                        let tabs = crearTabsHorizontal({ id: 'factores', tabs: tabs_data });\n                        $('#tabs-container').append(tabs);\n                        inicializarTooltips();\n                    }\n                });\n            },\n            error: function () {\n                mostrarToast('danger', 'Ocurrió un error al visualizar el perfil');\n            }\n        });\n    });\n\n    $(document).on('change', '#filtro_mas_recientes', function () {\n        actualizarDatatables(nombre_tabla);\n    });\n\n    $(document).on('click', '.perfil_selected', function () {\n        $(this).toggleClass('selected');\n        factores_etikos = actualizaFactoresEthikos(0);\n    });\n\n    $(document).on('click', '#btn_ver_perfiles_archivados', function () {\n        es_archivado = !es_archivado;\n        $('#btn_ver_perfiles_archivados').html(`<i class=\"bi ${es_archivado ? 'bi-chevron-left' : 'bi-archive'} me-2\"></i>${es_archivado ? 'Volver a perfiles activos' : 'Ver perfiles archivados'}`);\n        $('#btn_crear_perfil').toggleClass('d-none');\n        $('#filtro-dropdown-filtro_dropdown').toggleClass('d-none');\n        restablecerFiltrosComponente('filtro_dropdown');\n        $('#filtro_mas_recientes').closest('.input-container').toggleClass('d-none');\n        $('#filtro_mas_recientes').val(1).trigger('change');\n        $('#contenedor-texto-cabecera').text(es_archivado ? 'Perfiles archivados' : 'Producto selección');\n        actualizarDatatables(nombre_tabla);\n    });\n\n    $(document).on('mouseenter', '.card-hover-opciones', function () {\n        $(this).find('.opciones-card-hover').show();\n    });\n\n    $(`#${nombre_tabla}`).on('mouseleave', '.card-hover-opciones', function () {\n        $(this).find('.opciones-card-hover').hide();\n    });\n\n    $(document).on('click', '#siguiente_perfil', function () {\n        let tabulador_factor = 1;\n        if ($(this).data('id')) {\n            tabulador_factor = parseInt($(this).data('id'));\n        }\n        let factor_actual = 'factor_id_' + (tabulador_factor - 1);\n        let factor_siguiente = 'factor_id_' + tabulador_factor;\n        let es_crear = $(this).text() == 'Crear perfil';\n        tabs_Completados[factor_actual] = true;\n        if ($(this).text() == 'Crear perfil' || $(this).text() == 'Editar perfil') {\n            if ($(\"#nombre-perfil\").val() == \"\") {\n                mostrarErrorEnInput('#nombre-perfil', 'El nombre del perfil es obligatorio');\n                return;\n            } else {\n                $.ajax({\n                    url: `/perfiles-listado-empresa?prueba_id=${prueba_actual}&nombres[]=${$(\"#nombre-perfil\").val()}`,\n                    method: 'GET',\n                    success: function (respuesta) {\n                        if (es_crear && respuesta.data.length != 0) {\n                            mostrarErrorEnInput('#nombre-perfil', 'Ya hay un perfil creado con este nombre.');\n                            return;\n                        } else {\n                            let factores = {};\n                            if (prueba_actual == 3) {\n                                factores = factores_etikos;\n                                var sinceridad = informacion.find(item => item.id == 16);\n                                factores[16] = {\n                                    peso: 0,\n                                    dimensiones: sinceridad.factor.dimensiones.map(dimension => ({\n                                        dimension_id: dimension.id,\n                                        peso: 100,\n                                        cantidad_preguntas: null,\n                                        limite_inferior: 71,\n                                        limite_superior: 100\n                                    }))\n                                };\n                            } else {\n                                if ($(\"#nivel_educativo\").val() == \"\" && prueba_actual != 4) {\n                                    mostrarErrorEnInput('#nivel_educativo', 'El nivel educativo es obligatorio');\n                                    return;\n                                }\n\n                                if (prueba_actual == 4) {\n                                    factores = actualizaFactoresIQ(0);\n                                } else {\n                                    factores = actualizaFactores();\n                                }\n                                actualizarPesos(factores);\n                            }\n\n                            let payload = {\n                                prueba_id: prueba_actual,\n                                nivel_educativo_id: parseInt($(\"#nivel_educativo\").val()) || null,\n                                compartir_sucursales: $(\"#compartir_perfil\").is(\":checked\"),\n                                nombre: $(\"#nombre-perfil\").val() || \"\",\n                                empresas: [$(\"#empresa_sesion_id\").val()],\n                                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                                factores: JSON.stringify(factores)\n                            };\n\n                            if (!es_crear) {\n                                payload.id = $(\"#id_perfil\").val();\n                            }\n                            $.ajax({\n                                url: '/perfiles',\n                                method: 'POST',\n                                data: payload,\n                                success: function (respuesta) {\n                                    mostrarToast('success', respuesta.message);\n                                    $('#modal-crear-perfil').modal('hide');\n\n                                    if ($('#crear_perfil_proceso').length) {\n                                        // Aplica cuando se crea el perfil desde el proceso\n                                        let nueva_opcion = new Option(payload.nombre, respuesta.id, true, true);\n                                        $('#perfil_id_'+payload.prueba_id).prepend(nueva_opcion).trigger('change');\n                                    } else if ($('#modal-movimiento-6').length) {\n                                        // Aplica cuando se crea el perfil desde vacantes\n                                        let nueva_opcion = new Option(payload.nombre, respuesta.id, true, true);\n                                        $('select[name=\"perfil_id_' + payload.prueba_id + '\"]').prepend(nueva_opcion).trigger('change');\n                                        $('#modal-movimiento-6').removeClass('d-none');\n                                    } else {\n                                        actualizarDatatables(nombre_tabla);\n                                        mostrarEncuestaCreacionPerfiles();\n                                    }\n                                },\n                                error: function (err) {\n                                    console.error(\"Error al guardar\", err);\n                                }\n                            });\n                            return;\n                        }\n                    },\n                    error: function (err) {\n                        console.error(\"Error al guardar\", err);\n                    }\n                });\n            }\n            return;\n        }\n        \n        if (tabulador_factor == 2 && (prueba_actual == 7 || prueba_actual == 3)) {\n            $(this).text(es_editar ? 'Editar perfil' : 'Crear perfil');\n            if (prueba_actual == 7) {\n                $(this).attr('disabled', true);\n            }\n        }\n        \n        if (tabulador_factor == 4 || (tabulador_factor === 3 && prueba_actual !== 12)) {\n            $(this).text(es_editar ? 'Editar perfil' : 'Crear perfil');\n        }\n        $(`#${factor_siguiente}`)\n            .attr('disabled', false)\n            .attr('aria-disabled', 'false')\n            .removeClass('disabled');\n        $(this)\n            .attr('data-id', tabulador_factor + 1)\n            .data('id', tabulador_factor + 1);\n            if (es_editar && factor_siguiente == 'factor_id_3' && prueba_actual == 12) {\n                factor_siguiente = 'factor_id_riesgos';\n            }\n            \n        $(`a.nav-item-horizontal#${factor_siguiente}`).tab('show');\n        if (tabulador_factor < 2 && !es_editar) {\n            $(this).attr('disabled', true);\n        }\n        if (tabulador_factor == 2 && prueba_actual == 7) {\n            $('#siguiente_perfil').attr('disabled', true);\n        }\n    });\n\n    $(document).on('shown.bs.tab', 'a.nav-item-horizontal', function () {\n        let tabulador_id = $(this).attr('id');\n        let total_tabs = $('#tabs-container .nav-item-horizontal').length;\n        let indice_actual = $(this).index();\n\n        // Manejar pestañas especiales como 'factor_id_riesgos'\n        if (tabulador_id === 'factor_id_riesgos') {\n            // La pestaña de riesgos es la última en TenDisc Plus\n            $('#siguiente_perfil').attr('data-id', 4).data('id', 4);\n            $('#siguiente_perfil').text(es_editar ? 'Editar perfil' : 'Crear perfil');\n        } else {\n            // Procesamiento normal para pestañas numéricas\n            let numero_tabulador = parseInt(tabulador_id.replace(/factor_id_(ia_)?/, \"\")) + 1;\n            $('#siguiente_perfil').attr('data-id', numero_tabulador).data('id', numero_tabulador);\n\n            if (indice_actual + 1 < total_tabs) {\n                $('#siguiente_perfil').text('Siguiente');\n            } else {\n                $('#siguiente_perfil').text(es_editar ? 'Editar perfil' : 'Crear perfil');\n            }\n        }\n        if (!es_detalle) {\n            setTimeout(() => {\n                verificarBotonSiguiente();\n            }, 100);\n        }\n        if (es_editar && $('#tipo_prueba').val() == '3') {\n            $('#siguiente_perfil').attr('disabled', false);\n            return;\n        }\n\n        if ($('#tipo_prueba').val() == '3' && !es_editar) {\n            $('#siguiente_perfil').attr('disabled', true);\n            return;\n        }\n\n        if (tabulador_id == 'factor_id_0' || tabulador_id == 'factor_id_1' && !es_editar) {\n            if (tabs_Completados[tabulador_id]) {\n                $('#siguiente_perfil').attr('disabled', false);\n            } else {\n                $('#siguiente_perfil').attr('disabled', true);\n            }\n        } else {\n            $('#siguiente_perfil').attr('disabled', false);\n            return;\n        }\n    });\n\n    $('#modal-crear-perfil').on('hidden.bs.modal', function () {\n        if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\n            $(\"#siguiente_perfil\").text('Siguiente');\n        }\n        if ($('#modal-movimiento-6').length) {\n            // Cerrar todos los Select2 abiertos para evitar que queden \"pegados\"\n            $('#modal-movimiento-6 .select2-hidden-accessible').each(function() {\n                $(this).select2('close');\n            });\n\n            // Remover cualquier dropdown de Select2 que pueda quedar abierto\n            $('.select2-container--open').removeClass('select2-container--open');\n\n            $('#modal-movimiento-6').removeClass('d-none');\n        }\n    });\n\n    $('#modal-resumen-perfil').on('hidden.bs.modal', function () {\n        $('#modal-movimiento-6').removeClass('d-none');\n    });\n});\n\n/**\n * Función para aplicar los filtros avanzados aplicados.\n *\n * @param {String} filtro id del elemento html del filtro\n * @param {Object} filtros filtros aplicados\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction aplicarFiltrosDropdown(filtro, filtros) {\n    filtro_html = filtro;\n    json_filtros = filtros;\n    actualizarDatatables(nombre_tabla);\n}\n\n/**\n * Muestra u oculta tablas según la existencia de datos en los procesos.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction validarDatos() {\n    if (datos_ids[0]?.procesos?.length == 0 && datos_ids[1].procesos?.length == 0 && datos_ids[2].procesos?.length == 0) {\n        $('#tabla_con_datos').addClass('d-none');\n        $('#tabla_sin_datos').removeClass('d-none');\n    } else {\n        $('#tabla_con_datos').removeClass('d-none');\n        $('#tabla_sin_datos').addClass('d-none');\n    }\n}\n\n/**\n * Duplicar perfil.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction duplicarPerfil() {\n    if ($(\"#nombre_perfil_copia\").val() == \"\") {\n        mostrarToast('danger', 'El nombre del perfil es obligatorio');\n        return;\n    } else {\n        $.ajax({\n            url: `/perfiles-listado-empresa?prueba_id=${prueba_actual}&nombres[]=${$(\"#nombre_perfil_copia\").val()}`,\n            method: 'GET',\n            success: function (respuesta) {\n                if (respuesta.data.length != 0) {;\n                    mostrarToast('danger', 'Ya hay un perfil creado con este nombre.');\n                    return;\n                } else {\n                    $.ajax({\n                        url: `/perfiles-clonar`,\n                        type: 'POST',\n                        data: {\n                            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                            perfil_id : $('#id_perfil_duplicar').val(),\n                            nombre: $('#nombre_perfil_copia').val()\n                        },\n                        success: function (response) {\n                            mostrarToast(\"success\", \"Perfil duplicado con éxito\");\n                            actualizarDatatables(nombre_tabla);\n                            $('#modal-duplicar-perfil').modal('hide');\n                        },\n                        error: function () {\n                            mostrarToast('danger', 'Ocurrió un error al clonar el perfil');\n                        }\n                    });\n                }\n            },\n            error: function (error) {\n                console.error(\"Ocurrió un error al clonar el perfil\", error);\n            }\n        });\n    }\n}\n\n/**\n * Descargar el PDF del perfil.\n *\n * @param {number} id ID del perfil.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction descargarPDF(id) {\n    $.ajax({\n        type: 'POST',\n        url : `/perfiles-pdf/${id}`,\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        xhrFields: {\n            responseType: 'blob'\n        },\n        success: function(data, status, xhr) {\n            // Crear una URL para el Blob\n            let url = window.URL.createObjectURL(data);\n            let etiqueta_a   = document.createElement('a');\n            etiqueta_a.href  = url;\n\n            etiqueta_a.download = `perfil${id}.pdf`;\n            document.body.appendChild(etiqueta_a);\n            etiqueta_a.click();\n            window.URL.revokeObjectURL(url);\n            document.body.removeChild(etiqueta_a);\n        }\n    }).then(() => {\n        mostrarToast('success', 'PDF generado correctamente.');\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al descargar el archivo.');\n    });\n}\n\n/**\n * Elimina un perfil específico mediante una solicitud AJAX y actualiza la tabla.\n *\n * @param {number|string} id - ID del perfil que se desea eliminar.\n * @returns {void}\n * @author Andres Morales\n */\nfunction eliminarPerfil(id) {\n    $.ajax({\n        url: `/perfiles/${id}`,\n        type: 'DELETE',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function (response) {\n            mostrarToast(response.tipo, response.mensaje);\n            actualizarDatatables(nombre_tabla);\n        },\n        error: function () {\n            mostrarToast('danger', 'Ocurrió un error al eliminar el perfil');\n        }\n    });\n}\n\n/**\n * Elimina un perfil específico mediante una solicitud AJAX y actualiza la tabla.\n *\n * @param {number|string} id - ID del perfil que se desea archivar.\n * @param {boolean} accion_archivar - Acción para archivar o desarchivar.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction archivarPerfil(id, accion_archivar) {\n    $.ajax({\n        url: `/perfiles-archivar/${id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            archivar: accion_archivar\n        },\n        success: function (response) {            \n            mostrarToast(response.tipo, response.mensaje);\n            actualizarDatatables(nombre_tabla);\n        },\n        error: function () {\n            mostrarToast('danger', 'Ocurrió un error al eliminar el perfil');\n        }\n    });\n}\n\n/**\n * Función para consultar los factores y abrir la modal de creación de perfiles.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction crearPerfil(id_prueba = 0) {\n    var id = 0;\n    if (id_prueba == 0) {\n        id = $(\"#btn_crear_perfil\").data('prueba');\n    } else {\n        id = id_prueba.toString();\n        prueba_actual = id_prueba; \n    }\n\n    $('#tabs-container').removeClass('mx-4');\n\n    if (id != 4) {\n        $('#tabs-container').addClass('mx-4')\n    }\n    $(\"#modal-crear-perfil_label\").text('Crear perfil');\n    $(\"#siguiente_perfil\").text('Siguiente');\n    $('#siguiente_perfil').data('id', 1);\n    $(\"#siguiente_perfil\").attr('disabled', true);\n    var clases_tab = '';\n    var instrucciones = '';\n    var clase_personalizada = '';\n    es_editar = false;\n    factores_etikos = {};\n\n    switch (id) {\n        case '3':\n            es_inteligencia = false;\n            clases_tab = 'col-4 justify-content-center';\n            instrucciones = 'Selecciona los valores que deseas evaluar en este perfil.';\n            clase_personalizada = 'perfil_selected';\n            $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n            $('#nivel_educativo_div').hide();\n\n            break;\n        case '4':\n            clases_tab = 'col-3 justify-content-center';\n            instrucciones = 'Arrastra las habilidades cognitivas de acuerdo al nivel que deseas asignar.';\n            $('#tipo_prueba_div').removeClass('col-md-6').addClass('col-12');\n            $('#nivel_educativo_div').hide();\n\n            break;\n        case '7':\n            clases_tab = 'col-3 justify-content-center';\n            instrucciones = 'Arrastra las etiquetas de acuerdo al nivel que deseas asignar. .';\n            $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6')\n            $('#nivel_educativo_div').show();\n            break;\n        default:\n            clases_tab = 'col-3 justify-content-center';\n            $('#tipo_prueba_div').removeClass('col-12').addClass('col-md-6')\n            $('#nivel_educativo_div').show();\n            break;\n    }\n    let tag_etiquetas = '';\n    $('#tabs-container').empty();\n    restablecerBotones();\n    $.ajax({\n        url: `/pruebas/${id}/factores`,\n        type: 'GET',\n        success: function (response) {\n            informacion = response.data;\n            \n            var tabs = '';\n            if (id != 4) {\n                tabs = `\n                    ${crearTabsHorizontal({\n                    id: 'factores',\n                    tabs: response.data\n                        .filter(element => element.factor_id !== 78 && element.factor_id !== 16 && element.factor_id !== 35)\n                        .map((element, index) => {\n                            let etiquetas = '';\n                            element.factor.dimensiones.forEach(dimension => {\n                                if (element.factor_id == 77 || element.prueba_id == 3) {\n                                    tag_etiquetas = 'row justify-content-center gap-3';\n                                    var icono = '';\n                                    var tooltip = '';\n                                    if (element.factor_id == 77) {\n                                        icono = '<i class=\"bi bi-flag-fill text-danger me-3\"></i>';\n                                        tooltip = `${crearTooltip({ placement: `top`, content:  `${dimension.descripcion}`, toggle: `popover` })}`;\n                                    }\n                                    \n                                    etiquetas += `\n                                            ${crearCard({\n                                                col_tamanio: 'col-md-auto ',\n                                                nombre_grupo: `etiqueta_${element.factor_id}`,\n                                                hidden: true,\n                                                adicional: clase_personalizada,\n                                                contenido: `<div ${tooltip} class=\"text-center ${clase_personalizada}_contenido\" data-factor_id=\"${element.factor_id}\" data-dimension=\"${dimension.id}\">${icono} ${dimension.nombre}</div>`\n                                            })}\n                                        `;\n                                } else {\n                                    etiquetas += `<div class=\"tag\" data-id=\"${dimension.id}\">${dimension.nombre}</div>`;\n                                }\n                            });\n                            if (element.prueba_id == 12) {\n                                instrucciones = `Arrastra las ${element.factor.dimensiones.length} etiquetas de acuerdo al nivel que deseas asignar.`;\n                            }\n                            let minimo_Requerido = '';\n                            if (index == 0) {\n                                $('#siguiente_perfil').attr('data-id', 1);\n                                if (element.prueba_id == 12) {\n                                    minimo_Requerido = 'Completa todas las cajas con mínimo una etiqueta.';\n                                }\n                            }\n\n                            let contenido_bajo = '';\n                            let alerta = '';\n                            let contenido_avanzado = '';\n                            let valor_medio = '50 - 70';\n                            let valor_alto = '71 - 90';\n                            let valor_avanzado = '91 - 100';\n\n                            if (element.factor_id == 74) {\n                                var valor_bajo = '10 - 40';\n                                valor_medio = '41 - 70';\n                                valor_alto = '71 - 100';\n                                contenido_bajo = `\n                                        <div class=\"col-4\">\n                                            <p><i class=\"bi bi-bar-chart-fill bajo-color mx-2\"></i><strong>Bajo</strong></p>\n                                            <div class=\"nivel bajo\">\n                                                <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"bajo\"><label class=\"arrastra_bajo text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_bajo} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango\">${valor_bajo}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                            </div>\n                                        </div>\n                                    `;\n                            }\n                            let contenido = '';\n                            if ((element.factor_id !== 77 && element.prueba_id == 12) || element.prueba_id == 7) {\n                                contenido = `\n                                    <div class=\"col-4\">\n                                        <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                        <div class=\"nivel medio\">\n                                            <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"medio\"><label class=\"arrastra_medio text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                            <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                        </div>\n                                    </div>\n                                    <div class=\"col-4\">\n                                        <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                        <div class=\"nivel alto\">\n                                            <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"alto\"><label class=\"arrastra_alto text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                            <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                        </div>\n                                    </div>\n                                `;\n                            } else {\n                                if (element.prueba_id == 12) {\n                                    instrucciones = `Conoce los riesgos emocionales que evaluamos en Ten DISC Plus. Acerca el cursor para ver la definición`;\n                                }\n                            }\n\n                            if (element.factor_id == 75 || element.factor_id == 76 || element.prueba_id == 7) {\n                                contenido_avanzado = `\n                                        <div class=\"col-4\">\n                                            <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                            <div class=\"nivel avanzado\">\n                                                <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"avanzado\"><label class=\"arrastra_avanzado text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                                <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                            </div>\n                                        </div>\n                                    `;\n                                if (element.factor_id == 76) {\n                                    instrucciones = `Arrastra las etiquetas de acuerdo al nivel que deseas asignar.`;\n                                    alerta = `\n                                            <div class=\"my-4\">\n                                                    ${crearAlerta('info', 'Esta sección es opcional. Puedes completarla si deseas incluir competencias específicas')}\n                                            </div>\n                                        `;\n                                }\n                            }\n\n                            return {\n                                id: 'factor_id_' + index,\n                                titulo: element.factor.nombre,\n                                tooltip: element.factor.descripcion,\n                                clase_nav: clases_tab,\n                                contenido: `\n                                        <div class=\"row mx-3\">\n                                            <input type=\"hidden\" id=\"factor_id_escondido\" name=\"factor_id\" value=\"${element.factor_id}\">\n                                            ${alerta}\n                                            <div class=\"mt-4\">\n                                                <p>${instrucciones} ${minimo_Requerido}</p>\n                                            </div>\n                                            <div class=\"d-flex mb-2\">\n                                                ${crearBoton({\n                                                    type: 'button',\n                                                    clases: 'btn-primary btn-restablecer-etiquetas d-none',\n                                                    texto: '<i class=\"bi bi-bag-x-fill me-3\"></i> Restablecer',\n                                                    data: [{ texto: 'FACTOR-id', value: element.factor_id }]\n                                                })}\n                                                <div class=\"tags-container ${tag_etiquetas} col-10\">\n                                                    ${etiquetas}\n                                                </div>\n                                            </div>\n                                            <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                                ${contenido_bajo}\n                                                ${contenido}\n                                                ${contenido_avanzado}\n                                            </div>\n                                        </div>\n                                    `,\n                                activo: index === 0,\n                                disabled: index !== 0\n                            };\n                        })\n                })}\n                `;\n            } else {\n                let etiquetas = '';\n                let valor_medio = '50 - 70';\n                let valor_alto = '71 - 90';\n                let valor_avanzado = '91 - 100';\n                response.data.forEach(facotres => {\n                    etiquetas += `<div ${crearTooltip({ placement: `top`, content: `${facotres.factor.descripcion}`, toggle: `popover`, })} class=\"tag\" data-id=\"${facotres.factor.id}\">${facotres.factor.nombre}</div>`;\n                });\n\n                tabs = `\n                    <div class=\"row mx-3\">\n                        <div class=\"mt-4\">\n                            <p>${instrucciones}</p>\n                        </div>\n                        <div class=\"d-flex mb-2\">\n                            ${crearBoton({\n                                type: 'button',\n                                clases: 'btn-primary btn-restablecer-etiquetas d-none',\n                                texto: '<i class=\"bi bi-bag-x-fill me-3\"></i> Restablecer',\n                                data: [{ texto: 'FACTOR-id', value: id }]\n                            })}\n                            <div class=\"tags-container col-10\">\n                                ${etiquetas}\n                            </div>\n                        </div>\n                        <div class=\"niveles col-12 row justify-content-center mb-4\">\n                            <div class=\"niveles col-12 row justify-content-center mb-4\">\n                                <div class=\"col-4\">\n                                    <p><i class=\"bi bi-bar-chart-fill medio-color mx-2\"></i><strong>Medio</strong></p>\n                                    <div class=\"nivel medio\">\n                                        <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"medio\"><label class=\"arrastra_medio text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_medio} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango medio-rango\">${valor_medio}<label class=\"mx-2\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                    </div>\n                                </div>\n                                <div class=\"col-4\">\n                                    <p><i class=\"bi bi-bar-chart-fill alto-color mx-2\"></i><strong>Alto</strong></p>\n                                    <div class=\"nivel alto\">\n                                        <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"alto\"><label class=\"arrastra_alto text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_alto} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango text-white\">${valor_alto}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                    </div>\n                                </div>\n                                <div class=\"col-4\">\n                                    <p><i class=\"bi bi-bar-chart-fill avanzado-color mx-2\"></i><strong>Avanzado</strong></p>\n                                    <div class=\"nivel avanzado\">\n                                        <div class=\"zona-tags drop-zone d-flex justify-content-center align-items-center\" data-nivel=\"avanzado\"><label class=\"arrastra_avanzado text-gray-60 text-body-2\">Arrastra aquí</label></div>\n                                        <div ${crearTooltip({ placement: `top`, content: `Tus candidatos deben sacar un puntaje de ${valor_avanzado} para lograr un ajuste con las competencias que elijas`, toggle: `popover`, })} class=\"zona-rango -white\">${valor_avanzado}<label class=\"mx-2 text-white\"><i class=\"bi bi-question-circle-fill\"></i></label></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `;\n                $('#siguiente_perfil').attr('data-id', id);\n                $(\"#siguiente_perfil\").text('Crear perfil');\n            }\n            $('#nombre-perfil').val('');        \n            es_detalle = false;\n            $('#modal-crear-perfil').modal('show');\n            $('#tipo_prueba').val(id).select2().trigger('select2:select');\n            $('#nivel_educativo').val(null).select2().trigger('select2:select');\n            $('#tabs-container').append(tabs);\n            inicializarTooltips();\n        },\n        error: function () {\n            mostrarToast('danger', 'Ocurrió un error');\n        }\n    });\n    activarDrop();\n}\n\n/**\n * Función para calcular el porcentaje.\n *\n * @param {number|string} total - total del porcetaje.\n * @param {number|string} parts - partes del porcentaje.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction porcentajeEvento(total, parts) {\n    if (parts <= 0) return [];\n    const base = Math.floor(total / parts);\n    let remainder = total - base * parts;\n    return Array(parts)\n        .fill(base)\n        .map((v, i) => (i < remainder ? v + 1 : v));\n}\n\n/**\n * Función actualizar el peso en los factores.\n *\n * @param {number|string} data - informacion para actualizar peso.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction actualizarPesos(data) {\n    const pesos = Object.keys(data);\n\n    const peso_con_dimensiones = pesos.filter(\n        (k) =>\n            k !== \"78\" && k !== \"35\" &&\n            Array.isArray(data[k].dimensiones) &&\n            data[k].dimensiones.length > 0\n    );\n\n    const pesos_Factores = porcentajeEvento(100, peso_con_dimensiones.length);\n\n    pesos.forEach((k) => {\n        const FACTOR = data[k];\n        const TIENE_DIMENSIONES =\n            Array.isArray(FACTOR.dimensiones) && FACTOR.dimensiones.length > 0;\n\n        if (!TIENE_DIMENSIONES) {\n            FACTOR.peso = 0;\n            return;\n        }\n        if (k === \"78\" || k === \"35\") {\n            FACTOR.peso = 0;\n            return;\n        }\n\n        const ID_PESO = peso_con_dimensiones.indexOf(k);\n        FACTOR.peso = pesos_Factores[ID_PESO];\n        var reglas = [];\n        var pesosRegla;\n        var suma;\n        var sobrante;\n\n        switch (k) {\n            case '74':\n                reglas = [\n                    { li: 10, ls: 40, porcentaje: 35 },\n                    { li: 41, ls: 70, porcentaje: 25 },\n                    { li: 71, ls: 100, porcentaje: 40 },\n                ];\n                pesosRegla = reglas.map((r) =>\n                    Math.floor((r.porcentaje * 100) / 100)\n                );\n                suma = pesosRegla.reduce((a, b) => a + b, 0);\n                sobrante = FACTOR.peso - suma;\n                for (let i = 0; sobrante > 0; i++, sobrante--) {\n                    pesosRegla[i % pesosRegla.length] += 1;\n                }\n                FACTOR.dimensiones.forEach((dim) => (dim.peso = 0));\n                reglas.forEach((regla, i) => {\n                    const dimensionesDeRegla = FACTOR.dimensiones.filter(\n                        (dim) =>\n                            dim.limite_inferior === regla.li &&\n                            dim.limite_superior === regla.ls\n                    );\n\n                    if (dimensionesDeRegla.length > 0) {\n                        let distribucion = porcentajeEvento(\n                            pesosRegla[i],\n                            dimensionesDeRegla.length\n                        );\n\n                        dimensionesDeRegla.forEach((dim, idx) => {\n                            dim.peso = distribucion[idx];\n                        });\n                    }\n                });\n                break;\n\n            case '32':\n            case '75':\n                reglas = [\n                    { li: 50, ls: 70, porcentaje: 10 },\n                    { li: 71, ls: 90, porcentaje: 30 },\n                    { li: 91, ls: 100, porcentaje: 60 },\n                ];\n\n                const FACTOR_SIN_MEDIO_TRANSVERSAL = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 50 && dim.limite_superior === 70\n                );\n\n                const FACTOR_SIN_ALTO_TRANSVERSAL = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 71 && dim.limite_superior === 90\n                );\n\n                const FACTOR_SIN_AVANZADO_TRANSVERSAL = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 91 && dim.limite_superior === 100\n                );\n\n                const RANGOS_ACTIVOS_TRANSVERSAL = [FACTOR_SIN_MEDIO_TRANSVERSAL, FACTOR_SIN_ALTO_TRANSVERSAL, FACTOR_SIN_AVANZADO_TRANSVERSAL].filter(Boolean).length;\n\n                if (RANGOS_ACTIVOS_TRANSVERSAL === 1) {\n                    if (FACTOR_SIN_MEDIO_TRANSVERSAL) {\n                        reglas = [{ li: 50, ls: 70, porcentaje: 100 }];\n                    } else if (FACTOR_SIN_ALTO_TRANSVERSAL) {\n                        reglas = [{ li: 71, ls: 90, porcentaje: 100 }];\n                    } else if (FACTOR_SIN_AVANZADO_TRANSVERSAL) {\n                        reglas = [{ li: 91, ls: 100, porcentaje: 100 }];\n                    }\n                } else {\n                    if (!FACTOR_SIN_MEDIO_TRANSVERSAL) {\n                        reglas = [\n                            { li: 71, ls: 90, porcentaje: 34 },\n                            { li: 91, ls: 100, porcentaje: 66 },\n                        ];\n                    }\n\n                    if (!FACTOR_SIN_ALTO_TRANSVERSAL) {\n                        reglas = [\n                            { li: 50, ls: 70, porcentaje: 15 },\n                            { li: 91, ls: 100, porcentaje: 85 },\n                        ];\n                    }\n\n                    if (!FACTOR_SIN_AVANZADO_TRANSVERSAL) {\n                        reglas = [\n                            { li: 50, ls: 70, porcentaje: 25 },\n                            { li: 71, ls: 90, porcentaje: 75 },\n                        ];\n                    }\n                }\n\n                pesosRegla = reglas.map((r) =>\n                    Math.floor((r.porcentaje * 100) / 100)\n                );\n                suma = pesosRegla.reduce((a, b) => a + b, 0);\n                sobrante = FACTOR.peso - suma;\n                for (let i = 0; sobrante > 0; i++, sobrante--) {\n                    pesosRegla[i % pesosRegla.length] += 1;\n                }\n                FACTOR.dimensiones.forEach((dim) => (dim.peso = 0));\n                reglas.forEach((regla, i) => {\n                    const dimensionesDeRegla = FACTOR.dimensiones.filter(\n                        (dim) =>\n                            dim.limite_inferior === regla.li &&\n                            dim.limite_superior === regla.ls\n                    );\n\n                    if (dimensionesDeRegla.length > 0) {\n                        let distribucion = porcentajeEvento(\n                            pesosRegla[i],\n                            dimensionesDeRegla.length\n                        );\n\n                        dimensionesDeRegla.forEach((dim, idx) => {\n                            dim.peso = distribucion[idx];\n                        });\n                    }\n                });\n                break;\n\n            case '33':\n            case '34':\n            case '76':\n                reglas = [\n                    { li: 50, ls: 70, porcentaje: 25 },\n                    { li: 71, ls: 90, porcentaje: 10 },\n                    { li: 91, ls: 100, porcentaje: 65 },\n                ];\n\n                const FACTOR_SIN_MEDIO = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 50 && dim.limite_superior === 70\n                );\n\n                const FACTOR_SIN_ALTO = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 71 && dim.limite_superior === 90\n                );\n\n                const FACTOR_SIN_AVANZADO = FACTOR.dimensiones.some(\n                    (dim) => dim.limite_inferior === 91 && dim.limite_superior === 100\n                );\n\n                const rangosActivos = [FACTOR_SIN_MEDIO, FACTOR_SIN_ALTO, FACTOR_SIN_AVANZADO].filter(Boolean).length;\n\n                if (rangosActivos === 1) {\n                    if (FACTOR_SIN_MEDIO) {\n                        reglas = [{ li: 50, ls: 70, porcentaje: 100 }];\n                    } else if (FACTOR_SIN_ALTO) {\n                        reglas = [{ li: 71, ls: 90, porcentaje: 100 }];\n                    } else if (FACTOR_SIN_AVANZADO) {\n                        reglas = [{ li: 91, ls: 100, porcentaje: 100 }];\n                    }\n                } else {\n                    if (!FACTOR_SIN_MEDIO) {\n                        reglas = [\n                            { li: 71, ls: 90, porcentaje: 13 },\n                            { li: 91, ls: 100, porcentaje: 87 },\n                        ];\n                    }\n\n                    if (!FACTOR_SIN_ALTO) {\n                        reglas = [\n                            { li: 50, ls: 70, porcentaje: 28 },\n                            { li: 91, ls: 100, porcentaje: 72 },\n                        ];\n                    }\n\n                    if (!FACTOR_SIN_AVANZADO) {\n                        reglas = [\n                            { li: 50, ls: 70, porcentaje: 71 },\n                            { li: 71, ls: 90, porcentaje: 29 },\n                        ];\n                    }\n                }\n\n                pesosRegla = reglas.map((r) =>\n                    Math.floor((r.porcentaje * 100) / 100)\n                );\n\n                suma = pesosRegla.reduce((a, b) => a + b, 0);\n                sobrante = FACTOR.peso - suma;\n                for (let i = 0; sobrante > 0; i++, sobrante--) {\n                    pesosRegla[i % pesosRegla.length] += 1;\n                }\n\n                FACTOR.dimensiones.forEach((dim) => (dim.peso = 0));\n\n                reglas.forEach((regla, i) => {\n                    const dimensionesDeRegla = FACTOR.dimensiones.filter(\n                        (dim) =>\n                            dim.limite_inferior === regla.li &&\n                            dim.limite_superior === regla.ls\n                    );\n\n                    if (dimensionesDeRegla.length > 0) {\n                        let distribucion = porcentajeEvento(\n                            pesosRegla[i],\n                            dimensionesDeRegla.length\n                        );\n\n                        dimensionesDeRegla.forEach((dim, idx) => {\n                            dim.peso = distribucion[idx];\n                        });\n                    }\n                });\n\n                break;\n\n            case '77':\n                FACTOR.dimensiones.forEach((dim) => {\n                    dim.peso = 20;\n                });\n                break;\n\n            default:\n                const CONTADOR = FACTOR.dimensiones.length;\n                var dimension_peso = [];\n                dimension_peso = porcentajeEvento(100, CONTADOR);\n                FACTOR.dimensiones.forEach((dim, i) => {\n                    dim.peso = dimension_peso[i];\n                });\n                break;\n        }\n\n        if (k === \"34\") {\n            FACTOR.peso = 34;\n            return;\n        }\n        if (k === \"32\" || k === \"33\") {\n            FACTOR.peso = 33;\n            return;\n        }\n    });\n\n    return data;\n}\n\n/**\n * Función para obtener los factores seleccionados.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction actualizaFactores(tiene_factor_id = 0) {\n    var factores = {};\n\n    let modal = (es_inteligencia || tiene_factor_id === 1) ? $('#modal-vista-previa-perfil') : $('#modal-crear-perfil');\n\n    modal.find(\".tab-pane\").each(function () {\n        let tab = $(this);\n        let factor_Id = parseInt(tab.find('input[name=\"factor_id\"]').val());\n        if (isNaN(factor_Id)) {\n            return;\n        }\n        let peso_factor = parseFloat(tab.find('input[name=\"peso_factor\"]').val());\n        if (isNaN(peso_factor)) peso_factor = 0;\n\n        factores[factor_Id] = {\n            peso: peso_factor,\n            dimensiones: []\n        };\n\n        if (tiene_factor_id == 1) {\n            factores[factor_Id][\"factor_id\"] = factor_Id;\n        }\n\n        tab.find(\".niveles .drop-zone\").each(function () {\n            let zona = $(this);\n            let rango_Texto = zona.closest(\".nivel\").find(\".zona-rango\").text().trim();\n            let limites = rango_Texto.match(/(\\d+)\\s*-\\s*(\\d+)/);\n            let limite_Inferior = limites ? parseInt(limites[1]) : 0;\n            let limite_Superior = limites ? parseInt(limites[2]) : 100;\n\n            zona.find(\".tag\").each(function () {\n                let dimension_Id = parseInt($(this).data(\"id\"));\n                if (isNaN(dimension_Id)) return;\n                let pesoDimension = parseFloat($(this).data(\"peso\"));\n                if (isNaN(pesoDimension)) pesoDimension = 1.0;\n\n                factores[factor_Id].dimensiones.push({\n                    dimension_id: dimension_Id,\n                    peso: pesoDimension,\n                    cantidad_preguntas: null,\n                    limite_inferior: limite_Inferior,\n                    limite_superior: limite_Superior\n                });\n            });\n        });\n    });\n\n    const CONFIGURACION = {\n        35: { limite_inferior: 71, limite_superior: 100, porcentaje: 100 },\n        77: { limite_inferior: 10, limite_superior: 40, porcentaje: 20 },\n        78: { limite_inferior: 71, limite_superior: 100, porcentaje: 100 },\n    };\n\n    Object.entries(CONFIGURACION).forEach(([id, limites]) => {\n        const factorData = informacion.find(item => item.id === Number(id));\n        if (!factorData) return;\n\n        factores[id] = {\n            peso: 0,\n            dimensiones: factorData.factor.dimensiones.map(dimension => {\n                let base = {\n                    dimension_id: dimension.id,\n                    peso: limites.porcentaje,\n                    cantidad_preguntas: null\n                };\n                if (tiene_factor_id == 1) {\n                    base.limite_inferior = limites.limite_inferior;\n                    base.limite_superior = limites.limite_superior;\n                } else {\n                    base.limite_inferior = limites.limite_inferior;\n                    base.limite_superior = limites.limite_superior;\n                }\n\n                return base;\n            })\n        };\n\n        if (id == \"78\") {\n            const totalDim = factores[id].dimensiones.length;\n            const pesos = porcentajeEvento(100, totalDim);\n            factores[id].dimensiones.forEach((dim, i) => {\n                dim.peso = pesos[i];\n            });\n        }\n\n        if (tiene_factor_id == 1) {\n            factores[id][\"factor_id\"] = Number(id);\n        }\n    });\n\n    return factores;\n}\n\n/**\n * Función para obtener los factores seleccionados.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction actualizaFactoresIQ(tiene_factor_id = 0) {\n    var factores = {};\n    \n    let modal = (es_inteligencia || tiene_factor_id === 1) ? $('#modal-vista-previa-perfil') : $('#modal-crear-perfil');\n    \n    modal.find(\".niveles .drop-zone\").each(function () {\n        let zona = $(this);\n        let rango_Texto = zona.closest(\".nivel\").find(\".zona-rango\").text().trim();\n\n        let limites = rango_Texto.match(/(\\d+)\\s*-\\s*(\\d+)/);\n        let limite_Inferior = limites ? parseInt(limites[1]) : 0;\n        let limite_Superior = limites ? parseInt(limites[2]) : 100;\n\n        // Ahora cada tag decide si pertenece al factor actual\n        zona.find(\".tag\").each(function () {\n            let id_factor = parseInt($(this).data(\"id\"));\n            let resultado = informacion.find(item => item.id === id_factor);\n            factores[id_factor] = {\n                peso: 0,\n                dimensiones: []\n            };\n            if (tiene_factor_id == 1) {\n                factores[id_factor][\"factor_id\"] = id_factor;\n            }\n            resultado.factor.dimensiones.forEach(dimension => {\n                factores[id_factor].dimensiones.push({\n                    dimension_id: dimension.id,\n                    peso: 25,\n                    cantidad_preguntas: null,\n                    limite_inferior: limite_Inferior,\n                    limite_superior: limite_Superior\n                });\n            });\n        });\n    });\n    return factores;\n}\n\n/**\n * Función activar los drag and Drop de las etiquetas.\n *\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n */\nfunction activarDrop() {\n    const inicializarDragAndDrop = () => {\n        $(\".tag\").each(function () {\n            if ($(this).data(\"uiDraggable\")) {\n                $(this).draggable(\"destroy\");\n            }\n        });\n\n        $(\".drop-zone, .tags-container\").each(function () {\n            if ($(this).data(\"uiDroppable\")) {\n                $(this).droppable(\"destroy\");\n            }\n        });\n\n        var tags_Container = $(\".tags-container\");\n        var max_Caja_Factor = 2;\n        var pares_Prohibidos_Factor = [\n            [261, 263],\n            [262, 264]\n        ];\n\n        const limpiarPosicion = (elemento) => {\n            elemento.css({ top: \"\", left: \"\", position: \"\", transform: \"\" });\n        };\n\n        const inicializarDraggables = () => {\n            $(\".tag\").each(function (index) {\n                let $tag = $(this);\n\n                $tag.draggable({\n                    revert: \"invalid\",\n                    helper: \"clone\",\n                    appendTo: \"body\",\n                    cursor: \"move\",\n                    zIndex: 99999,\n                    opacity: 0.7\n                });\n            });\n        };\n\n        const verificarCambiosYMostrarBoton = () => {\n            let tab_activo = $('.tab-pane.active');\n            let hay_etiquetas_movidas = tab_activo.find('.drop-zone .tag').length > 0;\n            let boton_restablecer = tab_activo.find('.btn-restablecer-etiquetas');\n            if (prueba_actual == '4') {\n                hay_etiquetas_movidas = $('.drop-zone .tag').length > 0;\n                boton_restablecer = $('.btn-restablecer-etiquetas');\n            }\n            if (hay_etiquetas_movidas) {\n                boton_restablecer.removeClass('d-none');\n            } else {\n                boton_restablecer.addClass('d-none');\n            }\n            arrastraAqui();\n        };\n\n        const mostrarErrorEnContenedor = (contenedor, mensaje) => {\n            const nivelContenedor = contenedor.closest('.nivel');\n            nivelContenedor.siblings('.error-message').remove();\n            nivelContenedor.find('.error-message').remove();\n            const errorDiv = $(`<div class=\"error-message text-danger small mt-2\" style=\"font-size: 12px; margin-left: 0;\">${mensaje}</div>`);\n\n            nivelContenedor.after(errorDiv);\n\n            setTimeout(() => {\n                errorDiv.fadeOut(300, function () {\n                    $(this).remove();\n                });\n            }, 4000);\n        };\n\n        const restablecerEtiquetas = (factor_id) => {\n            let tab_activo = $('.tab-pane.active');\n            let tags_container = tab_activo.find('.tags-container');\n            let drop_zones = tab_activo.find('.drop-zone');\n            var prueba_tab = true;\n            if (prueba_actual == '4') {\n                tags_container = $('.tags-container:visible');\n                drop_zones = $('.drop-zone:visible');\n                prueba_tab = false;\n            }\n            drop_zones.find('.tag').each(function () {\n                $(this).appendTo(tags_container);\n                limpiarPosicion($(this));\n            });\n            inicializarDraggables();\n            configurarDropZones();\n            if (prueba_tab) {\n                tab_activo.find('.btn-restablecer-etiquetas').addClass('d-none');\n            } else {\n                $('.btn-restablecer-etiquetas').addClass('d-none');\n            }\n\n            if (prueba_actual != 12 && tab_activo.attr('id') != 'tab-factor_id_2') {\n                $(\"#siguiente_perfil\").attr('disabled', true);\n            }\n            if (prueba_actual == 12  && tab_activo.attr('id') != 'tab-factor_id_2') {\n                $(\"#siguiente_perfil\").attr('disabled', true);\n                $(\"#btn-crear-perfil-final\").attr('disabled', true);\n            }\n            \n            arrastraAqui();\n            mostrarToast('success', 'Etiquetas restablecidas correctamente');\n        };\n\n        const manejarDrop = (destino, ui) => {\n            let original = $(ui.draggable);\n            let tag_id = parseInt(original.data(\"id\"));\n            let nivel_caja = destino.data(\"nivel\");\n            let factor_id_activo = $('.tab-pane.active').attr('id');\n            let maximo_caja_avanzado = 3;\n\n            // Validaciones específicas para el primer factor\n            if (factor_id_activo === 'tab-factor_id_0' || factor_id_activo === 'tab-factor_id_ia_0') {\n                if (prueba_actual == '12') {\n                    if (destino.find(\".tag\").length >= max_Caja_Factor) {\n                        mostrarErrorEnContenedor(destino, 'Solo puedes agregar 2 etiquetas por nivel');\n                        return;\n                    }\n                    if (nivel_caja === 'bajo' || nivel_caja === 'alto') {\n                        let ids_en_caja = destino.find(\".tag\").map(function () {\n                            return parseInt($(this).data(\"id\"));\n                        }).get();\n                        for (let i = 0; i < pares_Prohibidos_Factor.length; i++) {\n                            let [id_a, id_b] = pares_Prohibidos_Factor[i];\n                            if ((tag_id === id_a && ids_en_caja.includes(id_b)) ||\n                                (tag_id === id_b && ids_en_caja.includes(id_a))) {\n                                mostrarErrorEnContenedor(destino, 'Rasgos incompatibles. Elige otro.');\n                                return;\n                            }\n                        }\n                    }\n                }\n            }\n            if (factor_id_activo === 'tab-factor_id_2' || factor_id_activo === 'tab-factor_id_ia_2')\n                maximo_caja_avanzado = 2;\n\n            if (prueba_actual == '7') {\n                if (nivel_caja == 'avanzado') {\n                    if (destino.find(\".tag\").length >= maximo_caja_avanzado) {\n                        mostrarErrorEnContenedor(destino, `Solo puedes agregar ${maximo_caja_avanzado} etiquetas en este nivel`);\n                        return;\n                    }\n                }\n            }\n\n            // Verificar que no esté duplicado\n            if (destino.find(`.tag[data-id=\"${tag_id}\"]`).length === 0) {\n                original.appendTo(destino);\n                limpiarPosicion(original);\n                setTimeout(() => {\n                    inicializarDraggables();\n                    configurarDropZones();\n                    verificarBotonSiguiente();\n                    verificarCambiosYMostrarBoton();\n                }, 50);\n            }\n\n            arrastraAqui();\n        };\n\n        const configurarDropZones = () => {\n            $(\".drop-zone\").droppable({\n                accept: \".tag\",\n                tolerance: \"pointer\",\n                greedy: true,\n                drop: function (event, ui) {\n                    manejarDrop($(this), ui);\n                }\n            });\n\n            tags_Container.droppable({\n                accept: \".tag\",\n                tolerance: \"pointer\",\n                greedy: false,\n                drop: function (event, ui) {\n                    let original = $(ui.draggable);\n                    original.appendTo($(this));\n                    limpiarPosicion(original);\n\n                    setTimeout(() => {\n                        inicializarDraggables();\n                        configurarDropZones();\n                        verificarBotonSiguiente();\n                        verificarCambiosYMostrarBoton();\n                    }, 50);\n                }\n            });\n        };\n\n        $(document).off('click', '.btn-restablecer-etiquetas').on('click', '.btn-restablecer-etiquetas', function () {\n            var factor_id = $(this).data('factor-id');\n            restablecerEtiquetas(factor_id);\n        });\n\n        $(document).off('shown.bs.tab', '.nav-link').on('shown.bs.tab', '.nav-link', function () {\n            setTimeout(function () {\n                verificarCambiosYMostrarBoton();\n            }, 100);\n        });\n\n        // Inicializar todo\n        if ($(\".tag\").length > 0) {\n            inicializarDraggables();\n            configurarDropZones();\n        }\n    };\n\n    // Ejecutar inmediatamente con timeout\n    setTimeout(inicializarDragAndDrop, 200);\n\n    // También configurar para que se ejecute cuando se muestre el modal\n    $('#modal-crear-perfil').off('shown.bs.modal.dragdrop').on('shown.bs.modal.dragdrop', function () {\n        setTimeout(inicializarDragAndDrop, 100);\n        $('#nivel_educativo').select2({\n            dropdownParent: $('#modal-crear-perfil')\n        });\n    });\n}\n\n/**\n * Función para validar si se debe o no activar el botón siguiente y las pestañas.\n * \n * @returns {void}\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n * */\nfunction verificarBotonSiguiente() {\n    let id_activo = $(\".nav-item-horizontal.active\").eq(1).attr(\"id\");\n    let id_prueba = prueba_actual;\n    let todas_dimensiones_asignadas = validarTodasDimensionesAsignadas(id_prueba, id_activo);\n    let todas_cajas_con_uno = validarTodasCajasConUno(id_prueba, id_activo);\n    let cantidad_hijos = $('.tags-container:visible').children().length;\n    let validacion_potencial_comercial = true;\n    let validacion_iq_factorial = true;\n    let validacion_ethikos = true;\n    if (id_prueba == 7) {\n        let contador_general = 0;\n        $(\".drop-zone:visible\").each(function () {\n            const CANTIDAD_TAGS = $(this).find(\".tag\").length;\n            contador_general += CANTIDAD_TAGS;\n            if (id_activo == 'factor_id_2') {\n                if (cantidad_hijos > 3) {\n                    validacion_potencial_comercial = false;\n                }\n            }\n        });\n        if (contador_general < 3) {\n            validacion_potencial_comercial = false;\n        }\n    } else if (id_prueba == 4) {\n        let contador_general = 0;\n        $(\".drop-zone\").each(function () {\n            const CANTIDAD_TAGS = $(this).find(\".tag\").length;\n            contador_general += CANTIDAD_TAGS;\n        });\n        if (contador_general < 2) {\n            validacion_potencial_comercial = false;\n        }\n    } else if (id_prueba == 3) {\n        factores_ethikos = actualizaFactoresEthikos(0);\n        let index_tab = null;\n\n        if ($(\"#tabs-container .nav-item-horizontal.active\").length) {\n            index_tab = $(\"#tabs-container .nav-item-horizontal.active\").index();\n        } else if ($(\"#preview-factores-container .nav-item-horizontal.active\").length) {\n            index_tab = $(\"#preview-factores-container .nav-item-horizontal.active\").index();\n        }\n\n        let key_ethikos = Object.keys(factores_ethikos)[index_tab];        \n        if (key_ethikos == undefined || factores_ethikos[key_ethikos]?.dimensiones.length < 2) {\n            validacion_ethikos = false;\n        } else {\n            validacion_ethikos = true;\n        }        \n    }    \n\n    if (todas_cajas_con_uno && todas_dimensiones_asignadas && validacion_potencial_comercial && validacion_iq_factorial && validacion_ethikos) {\n        $(\"#siguiente_perfil\").attr('disabled', false);\n        $(\"#btn-crear-perfil-final\").attr('disabled', false);\n        $(\"#tabs-container .nav-item-horizontal.active\").next().attr('disabled', false).removeClass('disabled').attr('aria-disabled', 'false');\n        $(\"#preview-factores-container .nav-item-horizontal.active\").next().attr('disabled', false).removeClass('disabled').attr('aria-disabled', 'false');\n    } else {\n        $(\"#siguiente_perfil\").attr('disabled', true);\n        $(\"#btn-crear-perfil-final\").attr('disabled', true);\n        $(\"#tabs-container .nav-item-horizontal\").each(function () {\n            if ($(this).index() > $(\"#tabs-container .nav-item-horizontal.active\").index()) {\n                $(this).attr('disabled', true).addClass('disabled').attr('aria-disabled', 'true');\n            }\n        });\n        $(\"#preview-factores-container .nav-item-horizontal\").each(function () {\n            if ($(this).index() > $(\"#preview-factores-container .nav-item-horizontal.active\").index()) {\n                $(this).attr('disabled', true).addClass('disabled').attr('aria-disabled', 'true');\n            }\n        });\n    }\n};\n\n/**\n * Función para validar si todas las dimensiones han sido asignadas según el tipo de prueba.\n * \n * @param {number} id_prueba - ID de la prueba.\n * @param {string} id_factor - ID del HTML del factor activo.\n * @return {boolean} - Retorna true si todas las dimensiones están asignadas o si no es el caso y false en caso contrario.\n * @author José Manuel Jiménez\n */\nfunction validarTodasDimensionesAsignadas(id_prueba, id_factor) {\n    let todas_dimensiones_asignadas = true;\n    if (id_prueba == 12) { // Validación Ten DISC Plus\n        if (/^factor_id_(ia_)?(0|1)$/.test(id_factor)) { // Personalidad o Transversales\n            let cantidad_hijos = $('.tags-container:visible').children().length;\n            if (cantidad_hijos > 0) {\n                todas_dimensiones_asignadas = false;\n            }\n        }\n    }\n    return todas_dimensiones_asignadas;\n}\n\n/**\n * Función para validar si todas las cajas tienen al menos una dimensión asignada según el tipo de prueba.\n * \n * @param {number} id_prueba - ID de la prueba.\n * @param {string} id_factor - ID del HTML del factor activo.\n * @return {boolean} - Retorna true si todas las cajas tienen al menos una dimensión asignada o si no es el caso y false en caso contrario.\n * @author José Manuel Jiménez\n */\nfunction validarTodasCajasConUno(id_prueba, id_factor) {\n    let todas_cajas_con_uno = true;\n    if (id_prueba == 12) { // Validación Ten DISC Plus\n        if (id_factor == 'factor_id_0' || id_factor == 'factor_id_1') { // Personalidad o Transversales\n            $(\".drop-zone:visible\").each(function () {\n                const CANTIDAD_TAGS = $(this).find(\".tag\").length;        \n                if (CANTIDAD_TAGS == 0) {\n                    todas_cajas_con_uno = false;\n                }\n            });\n        }\n    }\n    return todas_cajas_con_uno;\n}\n\n/**\n * Función para volver a restablecer los botones.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction restablecerBotones() {\n    $(\"#nombre-perfil\").attr('disabled', false);\n    $(\"#nivel_educativo\").attr('disabled', false);\n    $(\".modal-crear-perfil\").removeClass('d-none');\n}\n\n/**\n * Función para activar los textos del arrastre aqui.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction arrastraAqui() {\n    $(\".drop-zone:visible\").each(function () {\n        const CANTIDAD_TAGS = $(this).find(\".tag\").length;        \n        var data_nivel = $(this).data(\"nivel\");\n\n        if (CANTIDAD_TAGS > 0) {\n            $(`.arrastra_${data_nivel}:visible`).text('');\n            $(`.arrastra_${data_nivel}:visible`).parent().removeClass(\"d-flex justify-content-center align-items-center\");\n        } else {\n            $(`.arrastra_${data_nivel}:visible`).text('Arrastra aquí');\n            $(`.arrastra_${data_nivel}:visible`).parent().addClass(\"d-flex justify-content-center align-items-center\");\n        }\n\n        if (CANTIDAD_TAGS == 0) {\n            todas_Con_Uno = false;\n        }\n    });\n}\n\n/**\n * Función para mostrar error en input.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction mostrarErrorEnInput(inputId, mensaje) {\n    var input = $(inputId);\n    input.siblings('.error-message').remove();\n    input.closest('.form-group').find('.error-message').remove();\n\n    const ERRORDIV = $(`<div class=\"error-message text-danger small\" style=\"font-size: 12px; margin-top: -1rem;\">${mensaje}</div>`);\n\n    input.parent().after(ERRORDIV);\n    setTimeout(() => {\n        ERRORDIV.fadeOut(300, function () {\n            $(this).remove();\n        });\n    }, 4000);\n}\n\n/**\n * Función para ver el perfil seleccionado.\n * \n * @param {number} prueba_id - ID de la prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verPerfilSeleccionado(prueba_id) {\n    let perfil_id = $('select[name=\"perfil_id_' + prueba_id + '\"]').val();\n    if (!perfil_id) {\n        mostrarToast('warning', 'Seleccione un perfil para ver su información');\n        return;\n    }\n    $.ajax({\n        url: `/perfiles/${perfil_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function (respuesta) {\n            let fecha_modificacion = respuesta.data.updated_at;\n            if (fecha_modificacion != null) {\n                fecha_modificacion = moment(fecha_modificacion).format('DD/MM/YYYY');\n                $('#fecha-modificacion-perfil').text(fecha_modificacion);\n            } else {\n                $('#fecha-modificacion-perfil').text('');\n            }\n            let factores = respuesta.data.factores_perfiles || [];\n            $('#contenedor-resumen-perfil').empty().append(crearAcordeon({\n                id: 'acordeon-perfil',\n                acordeon: factores.map((factor, indice_factor) => ({\n                    id: `factor-${indice_factor}`,\n                    titulo: factor.factor.nombre,\n                    contenido: `\n                        ${factor.dimensiones_factores_perfiles.map((dimension, indice_dimension) => `\n                            <div class=\"col-12 ${(indice_dimension + 1) !== factor.dimensiones_factores_perfiles.length ? 'border-bottom' : ''}\">\n                                <div class=\"row justify-content-between align-items-center\">\n                                    <div class=\"col-auto text-body-2 text-gray-30\">\n                                        ${dimension.dimension.nombre}\n                                    </div>\n                                    <div class=\"col-auto py-2\">\n                                        ${obtenerTagFactor(dimension)}\n                                    </div>\n                                </div>\n                            </div>\n                        `).join('')}\n                    `\n                }))\n            }));\n            inicializarTooltips();\n            $('#modal-resumen-perfil').modal('show');\n            $('#modal-movimiento-6').addClass('d-none');\n        },\n        error: function () {\n            mostrarToast('danger', 'Ocurrió un error al obtener el perfil');\n        }\n    });\n}\n\n/**\n * Función para obtener el tag de la dimensión segun los límites.\n * \n * @param {Object} dimension - Objeto de la dimensión.\n * @returns {string}\n * @author José Manuel Jiménez\n */\nfunction obtenerTagFactor(dimension) {\n    let tipo_alerta = '';\n    let puntaje = '';\n    if (dimension.limite_superior == 40) {\n        tipo_alerta = 'danger';\n        puntaje = 'Bajo';\n    } else if (dimension.limite_superior == 70) {\n        tipo_alerta = 'warning';\n        puntaje = 'Medio';\n    } else if (dimension.limite_inferior == 71) {\n        tipo_alerta = 'success';\n        puntaje = 'Alto';\n    } else if (dimension.limite_inferior == 91) {\n        tipo_alerta = 'info';\n        puntaje = 'Avanzado';\n    }\n    return `\n        ${crearAlerta(\n            tipo_alerta,\n            `${puntaje}\n            <i class=\"bi bi-info-circle ms-1\"\n                ${crearTooltip({\n                    placement: `top`,\n                    content: `Tus candidatos deben sacar un puntaje de ${dimension.limite_inferior} - ${dimension.limite_superior} para lograr un ajuste con la competencia.`,\n                    toggle: `popover`,\n                })}>\n            </i>`, 'p-2'\n        )}\n    `;\n}","structuredPatch":[{"oldStart":1165,"oldLines":6,"newStart":1165,"newLines":14,"lines":["     });"," ","     $('#modal-resumen-perfil').on('hidden.bs.modal', function () {","+        // Cerrar todos los Select2 abiertos para evitar que queden \"pegados\"","+        $('#modal-movimiento-6 .select2-hidden-accessible').each(function() {","+            $(this).select2('close');","+        });","+","+        // Remover cualquier dropdown de Select2 que pueda quedar abierto","+        $('.select2-container--open').removeClass('select2-container--open');","+","         $('#modal-movimiento-6').removeClass('d-none');","     });"," });"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"145fdcae-99bf-4a49-93ce-21d1ada29ef9"}
{"parentUuid":"3b28a8f5-51a4-4337-b327-c030d4d01936","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01NycF4Tmoj6YMPST4AFKeqc","type":"message","role":"assistant","content":[{"type":"text","text":"Excelente. Ahora también necesito agregar una protección adicional en el evento `change` del select2 de perfiles en el modal de pruebas psicométricas. Voy a revisar y actualizar el archivo JavaScript del modal:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":800,"cache_read_input_tokens":121391,"cache_creation":{"ephemeral_5m_input_tokens":800,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX64eWJ8hVRuFviLktgJA","type":"assistant","uuid":"050d20bf-aa35-4a6f-81ba-1edbbe500582","timestamp":"2026-01-13T21:10:35.422Z"}
{"parentUuid":"050d20bf-aa35-4a6f-81ba-1edbbe500582","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01NycF4Tmoj6YMPST4AFKeqc","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012BbdTSqqTJfWvBhdytGqdw","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-pruebas-psicometricas.js","offset":33,"limit":20}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":800,"cache_read_input_tokens":121391,"cache_creation":{"ephemeral_5m_input_tokens":800,"ephemeral_1h_input_tokens":0},"output_tokens":187,"service_tier":"standard"}},"requestId":"req_011CX64eWJ8hVRuFviLktgJA","type":"assistant","uuid":"fe0ecd54-2b6b-4eb6-b179-8810f0ae1c64","timestamp":"2026-01-13T21:10:36.813Z"}
{"parentUuid":"fe0ecd54-2b6b-4eb6-b179-8810f0ae1c64","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012BbdTSqqTJfWvBhdytGqdw","type":"tool_result","content":"    33→\n    34→    $(document).on('change', '#modal-movimiento-6 .prueba-checkbox', function() {\n    35→        validarFormularioPruebasPsicometricas();\n    36→    });\n    37→\n    38→    $(document).on('change', '#modal-movimiento-6 .perfil-select', function() {\n    39→        let valor = $(this).val();\n    40→        let prueba_id = $(this).data('id');\n    41→        if (valor == 'creacion_perfil') {\n    42→            $(this).val($(this).find('option:first').val()).trigger('change');\n    43→            $('#modal-movimiento-6').addClass('d-none');\n    44→            crearPerfil(prueba_id);\n    45→        } else {\n    46→            validarFormularioPruebasPsicometricas();\n    47→        }\n    48→    });\n    49→\n    50→    $(document).on('blur', '#modal-movimiento-6 .porcentaje-input', function() {\n    51→        validarFormularioPruebasPsicometricas();\n    52→    });\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"2e9ed174-0fbb-4ec8-8d38-d3fcf0f9e05e","timestamp":"2026-01-13T21:10:40.160Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-pruebas-psicometricas.js","content":"\n    $(document).on('change', '#modal-movimiento-6 .prueba-checkbox', function() {\n        validarFormularioPruebasPsicometricas();\n    });\n\n    $(document).on('change', '#modal-movimiento-6 .perfil-select', function() {\n        let valor = $(this).val();\n        let prueba_id = $(this).data('id');\n        if (valor == 'creacion_perfil') {\n            $(this).val($(this).find('option:first').val()).trigger('change');\n            $('#modal-movimiento-6').addClass('d-none');\n            crearPerfil(prueba_id);\n        } else {\n            validarFormularioPruebasPsicometricas();\n        }\n    });\n\n    $(document).on('blur', '#modal-movimiento-6 .porcentaje-input', function() {\n        validarFormularioPruebasPsicometricas();\n    });","numLines":20,"startLine":33,"totalLines":679}},"sourceToolAssistantUUID":"fe0ecd54-2b6b-4eb6-b179-8810f0ae1c64"}
{"parentUuid":"2e9ed174-0fbb-4ec8-8d38-d3fcf0f9e05e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JBJnJDDrrwdLwSFSHo8V7c","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto, veo que en la línea 42 se resetea el select2, pero necesito asegurarme de que se cierre completamente. Voy a mejorar esta parte:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":582,"cache_read_input_tokens":122191,"cache_creation":{"ephemeral_5m_input_tokens":582,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX64fC34K3R6z6Ki166up","type":"assistant","uuid":"72573bec-85ea-420e-a04c-7b3bf9b3aefb","timestamp":"2026-01-13T21:10:44.382Z"}
{"parentUuid":"72573bec-85ea-420e-a04c-7b3bf9b3aefb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JBJnJDDrrwdLwSFSHo8V7c","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017BnzxWH2QejigBGvXAZprL","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-pruebas-psicometricas.js","old_string":"    $(document).on('change', '#modal-movimiento-6 .perfil-select', function() {\n        let valor = $(this).val();\n        let prueba_id = $(this).data('id');\n        if (valor == 'creacion_perfil') {\n            $(this).val($(this).find('option:first').val()).trigger('change');\n            $('#modal-movimiento-6').addClass('d-none');\n            crearPerfil(prueba_id);\n        } else {\n            validarFormularioPruebasPsicometricas();\n        }\n    });","new_string":"    $(document).on('change', '#modal-movimiento-6 .perfil-select', function() {\n        let valor = $(this).val();\n        let prueba_id = $(this).data('id');\n        if (valor == 'creacion_perfil') {\n            let $select = $(this);\n\n            // Cerrar el select2 antes de resetear el valor\n            $select.select2('close');\n\n            // Resetear al primer valor\n            $select.val($select.find('option:first').val()).trigger('change');\n\n            // Ocultar el modal de pruebas\n            $('#modal-movimiento-6').addClass('d-none');\n\n            // Abrir modal de crear perfil\n            crearPerfil(prueba_id);\n        } else {\n            validarFormularioPruebasPsicometricas();\n        }\n    });"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":582,"cache_read_input_tokens":122191,"cache_creation":{"ephemeral_5m_input_tokens":582,"ephemeral_1h_input_tokens":0},"output_tokens":560,"service_tier":"standard"}},"requestId":"req_011CX64fC34K3R6z6Ki166up","type":"assistant","uuid":"42823af9-da7c-4a97-86a3-f45341b3c579","timestamp":"2026-01-13T21:10:49.011Z"}
{"type":"file-history-snapshot","messageId":"42823af9-da7c-4a97-86a3-f45341b3c579","snapshot":{"messageId":"a198ebd8-2c10-4cf8-8131-4e727693cd96","trackedFileBackups":{"public\\js\\seleccion\\perfiles-pruebas\\perfiles-pruebas.js":{"backupFileName":"377b8b3bd26fae44@v1","version":1,"backupTime":"2026-01-13T21:10:12.621Z"},"public\\js\\vacantes\\modals-movimientos\\modal-pruebas-psicometricas.js":{"backupFileName":"24526f7ebc1a3306@v1","version":1,"backupTime":"2026-01-13T21:10:54.276Z"}},"timestamp":"2026-01-13T21:07:23.977Z"},"isSnapshotUpdate":true}
{"parentUuid":"42823af9-da7c-4a97-86a3-f45341b3c579","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017BnzxWH2QejigBGvXAZprL","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-pruebas-psicometricas.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n    34→    $(document).on('change', '#modal-movimiento-6 .prueba-checkbox', function() {\n    35→        validarFormularioPruebasPsicometricas();\n    36→    });\n    37→\n    38→    $(document).on('change', '#modal-movimiento-6 .perfil-select', function() {\n    39→        let valor = $(this).val();\n    40→        let prueba_id = $(this).data('id');\n    41→        if (valor == 'creacion_perfil') {\n    42→            let $select = $(this);\n    43→\n    44→            // Cerrar el select2 antes de resetear el valor\n    45→            $select.select2('close');\n    46→\n    47→            // Resetear al primer valor\n    48→            $select.val($select.find('option:first').val()).trigger('change');\n    49→\n    50→            // Ocultar el modal de pruebas\n    51→            $('#modal-movimiento-6').addClass('d-none');\n    52→\n    53→            // Abrir modal de crear perfil\n    54→            crearPerfil(prueba_id);\n    55→        } else {\n    56→            validarFormularioPruebasPsicometricas();\n    57→        }\n    58→    });\n    59→\n    60→    $(document).on('blur', '#modal-movimiento-6 .porcentaje-input', function() {\n    61→        validarFormularioPruebasPsicometricas();\n    62→    });"}]},"uuid":"12ac37e5-22b6-4fdb-873f-6587ff6d55bd","timestamp":"2026-01-13T21:10:54.482Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\modals-movimientos\\modal-pruebas-psicometricas.js","oldString":"    $(document).on('change', '#modal-movimiento-6 .perfil-select', function() {\n        let valor = $(this).val();\n        let prueba_id = $(this).data('id');\n        if (valor == 'creacion_perfil') {\n            $(this).val($(this).find('option:first').val()).trigger('change');\n            $('#modal-movimiento-6').addClass('d-none');\n            crearPerfil(prueba_id);\n        } else {\n            validarFormularioPruebasPsicometricas();\n        }\n    });","newString":"    $(document).on('change', '#modal-movimiento-6 .perfil-select', function() {\n        let valor = $(this).val();\n        let prueba_id = $(this).data('id');\n        if (valor == 'creacion_perfil') {\n            let $select = $(this);\n\n            // Cerrar el select2 antes de resetear el valor\n            $select.select2('close');\n\n            // Resetear al primer valor\n            $select.val($select.find('option:first').val()).trigger('change');\n\n            // Ocultar el modal de pruebas\n            $('#modal-movimiento-6').addClass('d-none');\n\n            // Abrir modal de crear perfil\n            crearPerfil(prueba_id);\n        } else {\n            validarFormularioPruebasPsicometricas();\n        }\n    });","originalFile":"/**\n * Archivo para manejar la lógica del modal de pruebas psicométricas\n * @author Andres Morales\n */\n\nlet pruebas_empresa_vacantes = [];\nlet configuraciones_pruebas_guardadas = [];\nlet validacion_tiempo = null;\n\nconst MAPA_CONFIGURACIONES_PRUEBAS = {\n    '3': 5,\n    '4': 6,\n    '7': 7,\n    '10': 8,\n    '11': 9,\n    '2': 10,\n    '12': 11,\n    '1': 51,\n};\n\n$(document).ready(function() {\n    $('#modal-movimiento-6').on('hidden.bs.modal', function() {\n        $('#modal-movimiento-6 .perfil-select').each(function() {\n            if ($(this).hasClass('select2-hidden-accessible')) {\n                $(this).select2('destroy');\n            }\n        });\n    });\n    \n    $('#modal-movimiento-6').on('shown.bs.modal', function() {\n        verificarYAplicarConfiguracionesPruebas();\n    });\n\n    $(document).on('change', '#modal-movimiento-6 .prueba-checkbox', function() {\n        validarFormularioPruebasPsicometricas();\n    });\n\n    $(document).on('change', '#modal-movimiento-6 .perfil-select', function() {\n        let valor = $(this).val();\n        let prueba_id = $(this).data('id');\n        if (valor == 'creacion_perfil') {\n            $(this).val($(this).find('option:first').val()).trigger('change');\n            $('#modal-movimiento-6').addClass('d-none');\n            crearPerfil(prueba_id);\n        } else {\n            validarFormularioPruebasPsicometricas();\n        }\n    });\n\n    $(document).on('blur', '#modal-movimiento-6 .porcentaje-input', function() {\n        validarFormularioPruebasPsicometricas();\n    });\n\n    $(document).on('keyup', '.campos-form-movimiento-6', function() {\n        let boton_guardar = $('#form-movimiento-6').closest('.modal').find('[form=\"form-movimiento-6\"][type=\"submit\"]');\n        if ($(this).val() && $(this).val() !== '') {\n            boton_guardar.prop('disabled', false);\n        } else {\n            boton_guardar.prop('disabled', true);\n        }\n    });\n\n    $(document).on('change', 'input[name=\"tipo_caducidad\"]', function() {\n        validarFormularioPruebasPsicometricas();\n    });\n\n    $(document).on('change', '#modal-movimiento-6 #movimiento_vacante_configuracion_id_16', function() {\n        validarFormularioPruebasPsicometricas();\n    });\n\n    $(document).on('change', '#modal-movimiento-6 #movimiento_vacante_configuracion_id_17', function() {\n        validarFormularioPruebasPsicometricas();\n    });\n});\n\n/**\n * Validar el formulario en tiempo real y habilitar/deshabilitar el botón Guardar\n * Utiliza debouncing para evitar múltiples ejecuciones simultáneas\n *\n * @returns {void}\n * @author Andres Morales\n * @author Jair Carvajal\n */\nfunction validarFormularioPruebasPsicometricas() {\n    if (validacion_tiempo) {\n        clearTimeout(validacion_tiempo);\n    }\n    validacion_tiempo = setTimeout(function() {\n        ejecutarValidacionPruebasPsicometricas();\n    }, 50);\n}\n\n/**\n * Ejecutar la validación real del formulario\n *\n * @returns {void}\n * @author Andres Morales\n * @author Jair Carvajal\n */\nfunction ejecutarValidacionPruebasPsicometricas() {\n    let es_valido = true;\n    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n    let boton_guardar = $('#form-movimiento-6').closest('.modal').find('[form=\"form-movimiento-6\"][type=\"submit\"]');\n\n    if (pruebas_seleccionadas.length === 0) {\n        es_valido = false;\n    } else {\n        let porcentaje_total = 0;\n        let todas_tienen_valores = true;\n\n        pruebas_seleccionadas.each(function() {\n            let fila = $(this).closest('tr');\n            let perfil_select = fila.find('.perfil-select').eq(0);\n            let porcentaje_input = fila.find('.porcentaje-input').eq(0);\n            let perfil = perfil_select.val();\n            let porcentaje = porcentaje_input.val();\n            if (!perfil || perfil === '') {\n                todas_tienen_valores = false;\n                es_valido = false;\n            }\n\n            if (!porcentaje || porcentaje === '' || parseInt(porcentaje) <= 0) {\n                todas_tienen_valores = false;\n                es_valido = false;\n            }\n            if (perfil && perfil !== '' && porcentaje && porcentaje !== '' && parseInt(porcentaje) > 0) {\n                porcentaje_total += parseInt(porcentaje);\n            }\n        });\n\n        if (es_valido && todas_tienen_valores) {\n            if (porcentaje_total !== 100) {\n                es_valido = false;\n            }\n        }\n\n        if (es_valido) {\n            let tipo_caducidad = $('input[name=\"tipo_caducidad\"]:checked').val();\n            if (tipo_caducidad === 'dias') {\n                let cantidad_dias = $('#movimiento_vacante_configuracion_id_16').val();\n                if (!cantidad_dias || cantidad_dias === '' || parseInt(cantidad_dias) <= 0) {\n                    es_valido = false;\n                }\n            } else if (tipo_caducidad === 'fecha') {\n                let fecha = $('#movimiento_vacante_configuracion_id_17').val();\n                if (!fecha || fecha === '') {\n                    es_valido = false;\n                }\n            }\n        }\n    }\n\n    if (boton_guardar.length > 0) {\n        boton_guardar.prop('disabled', !es_valido);\n    }\n}\n\n/**\n * Verificar si hay configuraciones guardadas y aplicarlas o limpiar el modal\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction verificarYAplicarConfiguracionesPruebas() {\n    if (!etapa_movimiento_vacante_id_seleccionado) {\n        limpiarModalPruebasPsicometricas();\n        return;\n    }\n    $.ajax({\n        url: `/configuraciones-etapa-movimiento/${etapa_movimiento_vacante_id_seleccionado}`,\n        type: 'GET',\n        success: function(respuesta) {\n            let configuraciones = respuesta.data;\n            if (!configuraciones || configuraciones.length === 0) {\n                limpiarModalPruebasPsicometricas();\n            } else {\n                mostrarConfiguracionesEtapaMovimientos();\n            }\n        },\n        error: function() {\n            limpiarModalPruebasPsicometricas();\n        }\n    });\n}\n\n/**\n * Limpiar el modal de pruebas psicométricas dejándolo sin configuraciones\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction limpiarModalPruebasPsicometricas() {\n    $('#movimiento_vacante_configuracion_id_12').prop('checked', true);\n    $('#movimiento_vacante_configuracion_id_13').prop('checked', false);\n    $('#movimiento_vacante_configuracion_id_14').prop('checked', true);\n    $('#movimiento_vacante_configuracion_id_15').prop('checked', false);\n\n    $('#activar_movimiento_vacante_configuracion_id_16').prop('checked', true);\n    $('#activar_movimiento_vacante_configuracion_id_17').prop('checked', false);\n\n    let campo_fecha = $('#movimiento_vacante_configuracion_id_17')[0];\n    if (campo_fecha && campo_fecha._flatpickr) {\n        campo_fecha._flatpickr.clear();\n    }\n\n    $('#contenedor-cantidad-dias').removeClass('d-none')\n    $('#contenedor-fecha-caducidad').addClass('d-none');\n\n    $('#modal-movimiento-6 #porcentaje-pruebas').text('0%').removeClass('text-green-20 text-danger');\n\n    $('#tabla-pruebas-vacantes tbody tr').each(function() {\n        $(this).find('.prueba-checkbox').prop('disabled', false);\n        $(this).removeClass('opacity-50');\n    });\n\n    let contenedor_alerta = $('#modal-movimiento-6 .alerta-porcentajes');\n    contenedor_alerta.removeClass('alert-warning').addClass('alert-info');\n    contenedor_alerta.find('.text-alerta').text('Los porcentajes de las pruebas deben sumar 100%, ajusta los porcentajes de acuerdo al valor de cada prueba.');\n\n    validarFormularioPruebasPsicometricas();\n}\n\n/**\n * Cargar las pruebas psicométricas disponibles para la empresa\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction cargarPruebasPsicometricasVacantes() {\n    if (typeof empresa === 'undefined' || !empresa || !empresa.id) {\n        mostrarToast('warning', 'No se ha identificado la empresa');\n        return;\n    }\n    $.ajax({\n        url: `/pruebas-empresas/${empresa.id}`,\n        type: 'GET',\n        data: {\n            tipo_prueba_id: 1,\n        },\n        success: function(respuesta) {\n            pruebas_empresa_vacantes = respuesta.data || [];\n            mostrarPruebasPsicometricasVacantes();\n            validarFormularioPruebasPsicometricas();\n        },\n        error: function(error) {\n            mostrarToast('danger', 'Error al cargar las pruebas psicométricas');\n            console.error('Error al cargar pruebas:', error);\n        }\n    });\n}\n\n/**\n * Mostrar las pruebas psicométricas en el modal\n *\n * @returns {void}\n * @author Andres Morales\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n */\nfunction mostrarPruebasPsicometricasVacantes() {\n    let contenedor = $('#modal-movimiento-6 #contenedor-pruebas');\n    contenedor.empty();\n\n    if (pruebas_empresa_vacantes.length === 0) {\n        contenedor.html(`\n            <div class=\"col-12 px-6 py-4\">\n                <div class=\"alert alert-info mb-0\">\n                    No hay pruebas psicométricas disponibles para esta empresa.\n                </div>\n            </div>\n        `);\n        return;\n    }\n    \n    let tabla_html = `\n        <div class=\"col-12 px-6\">\n            <table class=\"table\" id=\"tabla-pruebas-vacantes\">\n                <tbody>\n    `;\n\n    pruebas_empresa_vacantes.forEach(function(prueba) {        \n        let llave = prueba.slug.replace(/-/g, '_');    \n        tabla_html += `\n            <tr class=\"contenedor-prueba\" aria-id=\"${prueba.id}\" aria-name=\"${prueba.nombre}\">\n                <td style=\"width: 50px;\">\n                    ${crearCheckbox({\n                        id: `prueba_${llave}`,\n                        name: 'checkbox',\n                        class: 'input-dinamico prueba-checkbox',\n                        value: prueba.id,\n                        checked: false,\n                        onchange: `seleccionarPruebaVacante(this)`,\n                        adicional: `data-slug=\"${prueba.slug}\"`\n                    })}\n                </td>\n                <td class=\"text-body-2 align-middle text-gray-30\">${prueba.nombre}</td>\n                <td style=\"width: 60px;\">\n                    <img ${crearTooltip({placement: `top`, content: `${prueba.descripcion}`, toggle: `popover` })} src=\"/imagenes/logos/pruebas/${prueba.slug}.png\" width=\"40px\" height=\"40px\" alt=\"Logo ${prueba.nombre}\">\n                </td>\n                <td style=\"width: 250px;\">\n                    <div class=\"d-none contenedor-input-perfiles\">\n                        <input type=\"hidden\" name=\"pruebas[]['id']\" value=\"${prueba.id}\">\n                        ${crearSelect2({\n                            id: `perfil_id_${llave}`,\n                            name: `perfil_id_${prueba.id}`,\n                            class: 'input-dinamico perfil-select',\n                            label: 'Perfil',\n                            required: true,\n                            disabled: true,\n                            opciones: [],\n                            input_container_class: 'mb-0',\n                            adicional: `data-id=\"${prueba.id}\"`\n                        })}\n                    </div>\n                </td>\n                <td style=\"width: 150px;\">\n                    <div class=\"d-none contenedor-input-perfiles\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            class: 'input-dinamico porcentaje-input',\n                            id: `porcentaje_${llave}`,\n                            label: 'Porcentaje',\n                            name: `porcentaje_prueba_${prueba.id}`,\n                            input_container_class: 'mb-0',\n                            maxlength: 3,\n                            required: true,\n                            type: 'number',\n                            disabled: true,\n                            min: 1,\n                            max: 100,\n                            onchange: `actualizarPorcentajePruebaIndividual(this)`,\n                            adicional: `data-prueba_id=\"${prueba.id}\"`\n                        })}\n                    </div>\n                </td>\n                <td>\n                    <div class=\"d-none contenedor-input-perfiles\">\n                        ${crearBoton({\n                            clases: 'btn-state-on-light btn-circle',\n                            texto: '<i class=\"bi bi-eye text-blue-40\"></i>',\n                            onclick: `verPerfilSeleccionado(${prueba.id})`,\n                        })}\n                    </div>\n                </td>\n            </tr>\n        `;\n    });\n\n    tabla_html += `\n                </tbody>\n            </table>\n        </div>\n    `;\n\n    contenedor.append(tabla_html);\n    $(`#modal-movimiento-${modal_movimiento_id_seleccionado}`).modal('show');\n    inicializarTooltips();\n}\n\n/**\n * Seleccionar o deseleccionar una prueba psicométrica\n *\n * @param {HTMLInputElement} checkbox Checkbox de la prueba\n * @returns {void}\n * @author Andres Morales\n */\nfunction seleccionarPruebaVacante(checkbox) {\n    let checked = checkbox.checked;\n    let prueba_id = $(checkbox).val();\n    let slug = $(checkbox).data('slug');\n    let fila = $(checkbox).closest('tr');\n    let contenedores_input = fila.find('.contenedor-input-perfiles');\n    let select_perfil = fila.find('.perfil-select');\n    let input_porcentaje = fila.find('.porcentaje-input');\n\n    if (checked) {\n        contenedores_input.removeClass('d-none');\n        input_porcentaje.prop('disabled', false);\n        cargarPerfilesPrueba(prueba_id, slug);\n        fila.addClass('prueba-seleccionada');\n    } else {\n        if (select_perfil.hasClass('select2-hidden-accessible')) {\n            select_perfil.select2('destroy');\n        }\n        contenedores_input.addClass('d-none');\n        select_perfil.prop('disabled', true).empty().append('<option value=\"\"></option>');\n        input_porcentaje.prop('disabled', true).val('');\n        input_porcentaje.closest('.input-container').removeClass('error');\n        fila.removeClass('prueba-seleccionada');\n    }\n\n    actualizarPorcentajeTotalVacantes();\n    validarFormularioPruebasPsicometricas();\n}\n\n/**\n * Cargar los perfiles disponibles para una prueba\n *\n * @param {number} prueba_id ID de la prueba\n * @param {string} slug Slug de la prueba\n * @param {number|null} perfil_seleccionado_id ID del perfil previamente seleccionado\n * @returns {void}\n * @author Andres Morales\n * @author José Manuel Jiménez\n */\nfunction cargarPerfilesPrueba(prueba_id, slug, perfil_seleccionado_id = null) {\n    let llave = slug.replace(/-/g, '_');\n\n    $.ajax({\n        url: `/perfiles-listado-empresa`,\n        type: 'GET',\n        data: {\n            prueba_id: prueba_id\n        },\n        success: function(respuesta) {\n            let perfiles = respuesta.data || [];\n            let select = $(`#perfil_id_${llave}`);\n\n            if (select.hasClass('select2-hidden-accessible')) {\n                select.select2('destroy');\n            }\n\n            select.empty().append('<option value=\"\"></option>');\n\n            perfiles.forEach(function(perfil) {\n                let selected = perfil_seleccionado_id && perfil.id == perfil_seleccionado_id ? 'selected' : '';\n                select.append(`<option value=\"${perfil.id}\" ${selected}>${perfil.nombre}</option>`);\n            });\n            select.append(`<option class=\"border-top\" value=\"creacion_perfil\">Crear perfil</option>`);\n\n            select.prop('disabled', false);\n            actualizarSelect2(`#perfil_id_${llave}`);\n\n            if (perfil_seleccionado_id) {\n                select.trigger('change');\n            }\n        },\n        error: function(error) {\n            mostrarToast('danger', 'Error al cargar los perfiles de la prueba');\n            console.error('Error al cargar perfiles:', error);\n        }\n    });\n}\n\n/**\n * Actualizar el porcentaje total de las pruebas seleccionadas\n *\n * @returns {void}\n * @author Andres Morales\n * @author Jair Carvajal\n */\nfunction actualizarPorcentajeTotalVacantes() {\n    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n    let cantidad_pruebas = pruebas_seleccionadas.length;\n    let porcentaje_total = 0;\n    let porcentaje_base = cantidad_pruebas > 0 ? Math.floor(100 / cantidad_pruebas) : 0;\n    let residuo = cantidad_pruebas > 0 ? 100 % cantidad_pruebas : 0;\n\n    pruebas_seleccionadas.each(function(index) {\n        let fila = $(this).closest('tr');\n        let input_porcentaje = fila.find('.porcentaje-input');\n        input_porcentaje.closest('.input-container').removeClass('error');\n        let porcentaje_prueba = porcentaje_base + (index === pruebas_seleccionadas.length - 1 ? residuo : 0);\n        input_porcentaje.val(porcentaje_prueba);\n        porcentaje_total += porcentaje_prueba;\n    });\n\n    actualizarVisualizacionPorcentajesTotales(pruebas_seleccionadas, porcentaje_total);\n}\n\n/**\n * Actualizar el porcentaje total cuando se cambia manualmente el valor de una prueba\n * Solo recalcula el total sin reasignar automáticamente los porcentajes\n *\n * @param {HTMLInputElement} input Input del porcentaje\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction actualizarPorcentajePruebaIndividual(input) {\n    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n    let porcentaje_total = 0;\n\n    pruebas_seleccionadas.each(function() {\n        let fila = $(this).closest('tr');\n        let input_porcentaje = fila.find('.porcentaje-input');\n        let valor = parseInt(input_porcentaje.val()) || 0;\n        porcentaje_total += valor;\n    });\n\n    actualizarVisualizacionPorcentajesTotales(pruebas_seleccionadas, porcentaje_total);\n    validarFormularioPruebasPsicometricas();\n}\n\n/**\n * Actualizar la visualización del porcentaje total y estados del modal\n * Maneja la actualización de colores, mensajes de alerta y deshabilitación de checkboxes\n *\n * @param {jQuery} pruebas_seleccionadas Checkboxes de pruebas seleccionadas\n * @param {number} porcentaje_total Total de porcentajes\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarVisualizacionPorcentajesTotales(pruebas_seleccionadas, porcentaje_total) {\n    let elemento_porcentaje = $('#modal-movimiento-6 #porcentaje-pruebas');\n    let contenedor_alerta = $('#modal-movimiento-6 .alerta-porcentajes');\n\n    elemento_porcentaje.text(`${porcentaje_total}%`);\n\n    if (porcentaje_total > 100) {\n        elemento_porcentaje.removeClass('text-green-20').addClass('text-danger');\n        contenedor_alerta.removeClass('alert-info').addClass('alert-warning');\n        contenedor_alerta.find('.text-alerta').text('Has superado el porcentaje permitido, la suma de los porcentajes de las pruebas debe sumar 100%.');\n\n        pruebas_seleccionadas.each(function() {\n            $(this).closest('tr').find('.porcentaje-input').closest('.input-container').addClass('error');\n        });\n    } else if (porcentaje_total === 100) {\n        elemento_porcentaje.removeClass('text-danger').addClass('text-green-20');\n        contenedor_alerta.removeClass('alert-warning').addClass('alert-info');\n        contenedor_alerta.find('.text-alerta').text('Los porcentajes de las pruebas deben sumar 100%, ajusta los porcentajes de acuerdo al valor de cada prueba.');\n    } else {\n        elemento_porcentaje.removeClass('text-green-20').addClass('text-danger');\n        contenedor_alerta.removeClass('alert-warning').addClass('alert-info');\n        contenedor_alerta.find('.text-alerta').text('Los porcentajes de las pruebas deben sumar 100%, ajusta los porcentajes de acuerdo al valor de cada prueba.');\n    }\n}\n\n/**\n * Validar que las pruebas seleccionadas tengan perfil y porcentaje\n *\n * @returns {boolean} True si es válido\n * @author Andres Morales\n */\nfunction validarPruebasPsicometricas() {\n    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n\n    if (pruebas_seleccionadas.length === 0) {\n        mostrarToast('warning', 'Debes seleccionar al menos una prueba psicométrica');\n        return false;\n    }\n\n    let valido = true;\n    let porcentaje_total = 0;\n\n    pruebas_seleccionadas.each(function() {\n        let contenedor = $(this).closest('.contenedor-prueba');\n        let perfil = contenedor.find('.perfil-select').val();\n        let porcentaje = contenedor.find('.porcentaje-input').val();\n\n        if (!perfil || perfil === '') {\n            mostrarToast('warning', 'Debes seleccionar un perfil para todas las pruebas');\n            valido = false;\n            return false;\n        }\n\n        if (!porcentaje || porcentaje === '' || parseInt(porcentaje) <= 0) {\n            mostrarToast('warning', 'Debes ingresar un porcentaje válido para todas las pruebas');\n            valido = false;\n            return false;\n        }\n\n        porcentaje_total += parseInt(porcentaje);\n    });\n\n    if (valido && porcentaje_total !== 100) {\n        mostrarToast('warning', 'La suma de los porcentajes debe ser igual a 100%');\n        return false;\n    }\n    \n    let tipo_caducidad = $('input[name=\"tipo_caducidad\"]:checked').val();\n    if (tipo_caducidad === 'dias') {\n        let cantidad_dias = $('#movimiento_vacante_configuracion_id_16').val();\n        if (!cantidad_dias || cantidad_dias === '' || parseInt(cantidad_dias) <= 0) {\n            mostrarToast('warning', 'Debes ingresar una cantidad de días válida');\n            $('#movimiento_vacante_configuracion_id_16').closest('.input-container').addClass('error');\n            return false;\n        }\n        $('#movimiento_vacante_configuracion_id_16').closest('.input-container').removeClass('error');\n    } else if (tipo_caducidad === 'fecha') {\n        let fecha = $('#movimiento_vacante_configuracion_id_17').val();\n        if (!fecha || fecha === '') {\n            mostrarToast('warning', 'Debes seleccionar una fecha de caducidad');\n            $('#movimiento_vacante_configuracion_id_17').closest('.input-container').addClass('error');\n            return false;\n        }\n        $('#movimiento_vacante_configuracion_id_17').closest('.input-container').removeClass('error');\n    }\n\n    return valido;\n}\n\n/**\n * Recopilar datos de pruebas para enviar al backend\n *\n * @returns {Array} Array de configuraciones de pruebas\n * @author Andres Morales\n */\nfunction recopilarDatosPruebasPsicometricas() {\n    let configuraciones = [];\n    let pruebas_seleccionadas = $('#modal-movimiento-6 .prueba-checkbox:checked');\n\n    pruebas_seleccionadas.each(function() {\n        let contenedor = $(this).closest('.contenedor-prueba');\n        let prueba_id = $(this).val();\n        let perfil_id = contenedor.find('.perfil-select').val();\n        let porcentaje = contenedor.find('.porcentaje-input').val();\n        let configuracion_id = MAPA_CONFIGURACIONES_PRUEBAS[prueba_id];\n\n        if (configuracion_id) {\n            configuraciones.push({\n                etapa_movimiento_vacante_id: etapa_movimiento_vacante_id_seleccionado,\n                movimiento_vacante_configuracion_id: parseInt(configuracion_id),\n                prueba_id: parseInt(prueba_id),\n                perfil_id: parseInt(perfil_id),\n                valor: porcentaje.toString()\n            });\n        }\n    });\n\n    return configuraciones;\n}\n\n/**\n * Cambiar entre tipo de caducidad (días o fecha)\n *\n * @param {HTMLInputElement} radio Radio button seleccionado\n * @returns {void}\n * @author Andres Morales\n */\nfunction cambiarTipoCaducidad(radio) {\n    let valor = $(radio).val();\n    if (valor === 'dias') {\n        $('#contenedor-cantidad-dias').removeClass('d-none');\n        $('#contenedor-fecha-caducidad').addClass('d-none');\n        let elemento = $('#movimiento_vacante_configuracion_id_17');\n        let campo_fecha = elemento[0]._flatpickr;\n        if (campo_fecha) {\n            campo_fecha.clear();\n        }\n    } else if (valor === 'fecha') {\n        $('#contenedor-cantidad-dias').addClass('d-none');\n        $('#contenedor-fecha-caducidad').removeClass('d-none');\n        $('#movimiento_vacante_configuracion_id_16').val('').trigger('change');\n    }\n    validarFormularioPruebasPsicometricas();\n}\n\n/**\n * Manejar el cambio del checkbox de puntuaciones medias\n * Si se marca, automáticamente marca el de puntuaciones bajas\n *\n * @param {HTMLElement} checkbox Elemento checkbox\n * @returns {void}\n * @author Andres Morales\n */\nfunction manejarCheckPuntuacionesMedias(checkbox) {\n    var checkbox_bajas = $('#movimiento_vacante_configuracion_id_14');\n\n    if ($(checkbox).prop('checked')) {\n        checkbox_bajas.prop('checked', true);\n    }\n}\n\n/**\n * Manejar el cambio del checkbox de puntuaciones bajas\n * Si se desmarca, automáticamente desmarca el de puntuaciones medias\n *\n * @param {HTMLElement} checkbox Elemento checkbox\n * @returns {void}\n * @author Andres Morales\n */\nfunction manejarCheckPuntuacionesBajas(checkbox) {\n    var checkbox_medias = $('#movimiento_vacante_configuracion_id_15');\n\n    if (!$(checkbox).prop('checked')) {\n        checkbox_medias.prop('checked', false);\n    }\n}\n","structuredPatch":[{"oldStart":39,"oldLines":8,"newStart":39,"newLines":18,"lines":["         let valor = $(this).val();","         let prueba_id = $(this).data('id');","         if (valor == 'creacion_perfil') {","-            $(this).val($(this).find('option:first').val()).trigger('change');","+            let $select = $(this);","+","+            // Cerrar el select2 antes de resetear el valor","+            $select.select2('close');","+","+            // Resetear al primer valor","+            $select.val($select.find('option:first').val()).trigger('change');","+","+            // Ocultar el modal de pruebas","             $('#modal-movimiento-6').addClass('d-none');","+","+            // Abrir modal de crear perfil","             crearPerfil(prueba_id);","         } else {","             validarFormularioPruebasPsicometricas();"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"42823af9-da7c-4a97-86a3-f45341b3c579"}
{"parentUuid":"12ac37e5-22b6-4fdb-873f-6587ff6d55bd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_014Znb136Rhwadx9BdHuZVY5","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto. Ahora voy a crear un documento resumen con la solución implementada para que puedas probarla:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":1181,"cache_read_input_tokens":122773,"cache_creation":{"ephemeral_5m_input_tokens":1181,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CX64gN2c24cvzwywpE33E","type":"assistant","uuid":"43a58933-f92b-4660-a3ec-a5e084eba859","timestamp":"2026-01-13T21:11:00.061Z"}
{"parentUuid":"43a58933-f92b-4660-a3ec-a5e084eba859","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_014Znb136Rhwadx9BdHuZVY5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Qbedi97mj1PsWpVB599G3F","name":"Write","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\SOLUCION_SELECT2_MODAL_PRUEBAS.md","content":"# Solución: Select2 Pegado en Modal de Pruebas Psicométricas\n\n## Problema Identificado\n\nCuando se selecciona una prueba psicométrica en el modal `modal-movimiento-6`, se despliega un select2 con un listado de perfiles. Al hacer clic en la opción \"Crear perfil\", se abre un modal secundario (`modal-crear-perfil`).\n\n**El problema**: Al cerrar o crear el perfil en el modal secundario, el select2 del modal principal quedaba en un estado \"abierto fantasma\", bloqueando el scroll y la interacción con el modal de pruebas psicométricas.\n\n## Causa Raíz\n\nEste es un problema conocido de **Select2 + Modales anidados de Bootstrap**:\n\n1. Select2 abre su dropdown\n2. Se abre un modal encima (modal-crear-perfil)\n3. Al cerrar el modal secundario, Select2 no se cierra automáticamente\n4. El dropdown de Select2 queda en estado \"abierto\" pero invisible, bloqueando la interacción\n\n## Solución Implementada\n\nSe implementó una solución en **3 puntos críticos**:\n\n### 1. Al Cerrar Modal de Crear Perfil\n**Archivo**: `public/js/seleccion/perfiles-pruebas/perfiles-pruebas.js`\n**Líneas**: 1150-1165\n\n```javascript\n$('#modal-crear-perfil').on('hidden.bs.modal', function () {\n    if ($(\"#siguiente_perfil\").text() !== 'Editar perfil') {\n        $(\"#siguiente_perfil\").text('Siguiente');\n    }\n    if ($('#modal-movimiento-6').length) {\n        // Cerrar todos los Select2 abiertos para evitar que queden \"pegados\"\n        $('#modal-movimiento-6 .select2-hidden-accessible').each(function() {\n            $(this).select2('close');\n        });\n\n        // Remover cualquier dropdown de Select2 que pueda quedar abierto\n        $('.select2-container--open').removeClass('select2-container--open');\n\n        $('#modal-movimiento-6').removeClass('d-none');\n    }\n});\n```\n\n**¿Qué hace?**\n- Cierra todos los Select2 del modal de pruebas psicométricas\n- Remueve la clase CSS que mantiene el dropdown abierto\n- Vuelve a mostrar el modal principal limpio\n\n### 2. Al Cerrar Modal de Resumen de Perfil\n**Archivo**: `public/js/seleccion/perfiles-pruebas/perfiles-pruebas.js`\n**Líneas**: 1167-1177\n\n```javascript\n$('#modal-resumen-perfil').on('hidden.bs.modal', function () {\n    // Cerrar todos los Select2 abiertos para evitar que queden \"pegados\"\n    $('#modal-movimiento-6 .select2-hidden-accessible').each(function() {\n        $(this).select2('close');\n    });\n\n    // Remover cualquier dropdown de Select2 que pueda quedar abierto\n    $('.select2-container--open').removeClass('select2-container--open');\n\n    $('#modal-movimiento-6').removeClass('d-none');\n});\n```\n\n**¿Qué hace?**\n- Aplica la misma lógica de limpieza para el modal de resumen de perfil\n- Garantiza que cualquier Select2 abierto se cierre correctamente\n\n### 3. Al Abrir Modal de Crear Perfil desde Select2\n**Archivo**: `public/js/vacantes/modals-movimientos/modal-pruebas-psicometricas.js`\n**Líneas**: 38-58\n\n```javascript\n$(document).on('change', '#modal-movimiento-6 .perfil-select', function() {\n    let valor = $(this).val();\n    let prueba_id = $(this).data('id');\n    if (valor == 'creacion_perfil') {\n        let $select = $(this);\n\n        // Cerrar el select2 antes de resetear el valor\n        $select.select2('close');\n\n        // Resetear al primer valor\n        $select.val($select.find('option:first').val()).trigger('change');\n\n        // Ocultar el modal de pruebas\n        $('#modal-movimiento-6').addClass('d-none');\n\n        // Abrir modal de crear perfil\n        crearPerfil(prueba_id);\n    } else {\n        validarFormularioPruebasPsicometricas();\n    }\n});\n```\n\n**¿Qué hace?**\n- Cierra explícitamente el Select2 antes de abrir el modal de crear perfil\n- Resetea el valor del select al primer elemento\n- Oculta el modal principal de forma limpia\n\n## Archivos Modificados\n\n1. ✅ `public/js/seleccion/perfiles-pruebas/perfiles-pruebas.js`\n   - Evento `hidden.bs.modal` de `#modal-crear-perfil` (líneas 1150-1165)\n   - Evento `hidden.bs.modal` de `#modal-resumen-perfil` (líneas 1167-1177)\n\n2. ✅ `public/js/vacantes/modals-movimientos/modal-pruebas-psicometricas.js`\n   - Evento `change` de `.perfil-select` (líneas 38-58)\n\n## Cómo Probar la Solución\n\n### Escenario 1: Crear Perfil Nuevo\n1. Ir a **Crear Vacante** → Paso 2 (Etapas)\n2. Activar etapa \"Pruebas psicométricas\"\n3. Seleccionar una prueba (marcar checkbox)\n4. En el select de \"Perfil\", hacer scroll hasta el final y seleccionar **\"Crear perfil\"**\n5. Se abre el modal de crear perfil\n6. **Cancelar** o **Crear** el perfil\n7. ✅ **Verificar**: El modal de pruebas psicométricas debe permitir scroll normalmente\n8. ✅ **Verificar**: El select de perfil debe estar cerrado (no bloqueado)\n\n### Escenario 2: Ver Resumen de Perfil\n1. Desde el modal de pruebas psicométricas\n2. Seleccionar una prueba\n3. Elegir un perfil existente\n4. Hacer clic en el botón de \"Ver perfil\" (ícono de ojo)\n5. Se abre el modal de resumen de perfil\n6. Cerrar el modal\n7. ✅ **Verificar**: El modal de pruebas psicométricas debe funcionar correctamente\n\n### Escenario 3: Múltiples Aperturas y Cierres\n1. Repetir los escenarios 1 y 2 varias veces consecutivas\n2. ✅ **Verificar**: El comportamiento debe ser consistente\n3. ✅ **Verificar**: No debe haber acumulación de dropdowns abiertos\n\n## Explicación Técnica\n\n### ¿Por qué ocurría el problema?\n\nSelect2 crea un contenedor dropdown que se posiciona de forma absoluta en el DOM. Cuando se abre un modal de Bootstrap encima, el dropdown de Select2 queda en un estado inconsistente:\n\n- Bootstrap oculta el modal principal con `display: none` o `d-none`\n- El dropdown de Select2 está en el `<body>`, no dentro del modal\n- Al cerrar el modal secundario, Select2 no detecta que debe cerrarse\n- El dropdown permanece invisible pero \"abierto\", bloqueando eventos\n\n### ¿Cómo lo soluciona el código?\n\n1. **Cierre explícito**: `$(selector).select2('close')` llama al método de Select2 para cerrar programáticamente\n2. **Limpieza de clases**: `$('.select2-container--open').removeClass('select2-container--open')` remueve cualquier estado residual\n3. **Orden de operaciones**: Se cierra Select2 **antes** de manipular los modales\n4. **Defensivo**: Se aplica en todos los puntos de interacción (abrir/cerrar modales)\n\n## Compatibilidad\n\n✅ Bootstrap 5.3.3\n✅ Select2 (versión usada en el proyecto)\n✅ jQuery (versión usada en el proyecto)\n✅ Modales anidados\n✅ Múltiples instancias de Select2 en el mismo modal\n\n## Notas Adicionales\n\n- La solución es **no invasiva**: No afecta el funcionamiento normal de Select2 o los modales\n- Es **defensiva**: Cierra todos los Select2, no solo el problemático\n- Es **reutilizable**: El patrón puede aplicarse a otros modales con Select2 anidados\n- **Sin efectos secundarios**: No interfiere con validaciones ni otros eventos\n\n## Autor\n\n- **Implementado por**: Claude Code (Sonnet 4.5)\n- **Fecha**: 2026-01-13\n- **Contexto**: Corrección de bug en modal de pruebas psicométricas\n"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":1181,"cache_read_input_tokens":122773,"cache_creation":{"ephemeral_5m_input_tokens":1181,"ephemeral_1h_input_tokens":0},"output_tokens":2456,"service_tier":"standard"}},"requestId":"req_011CX64gN2c24cvzwywpE33E","type":"assistant","uuid":"11cb99fa-084b-4293-99af-f32d48a61916","timestamp":"2026-01-13T21:11:38.515Z"}
{"parentUuid":"11cb99fa-084b-4293-99af-f32d48a61916","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). STOP what you are doing and wait for the user to tell you how to proceed.","is_error":true,"tool_use_id":"toolu_01Qbedi97mj1PsWpVB599G3F"}]},"uuid":"ce33beeb-1e2f-4f2a-b4ed-e72381098d5b","timestamp":"2026-01-13T21:11:52.094Z","toolUseResult":"Error: The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). STOP what you are doing and wait for the user to tell you how to proceed.","sourceToolAssistantUUID":"11cb99fa-084b-4293-99af-f32d48a61916"}
{"parentUuid":"ce33beeb-1e2f-4f2a-b4ed-e72381098d5b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"0d24b3e0-61d3-4120-b8f9-6a856b3eec58","version":"2.1.2","gitBranch":"Ajuste-validacion-formato-entrevista","slug":"stateful-wobbling-popcorn","type":"user","message":{"role":"user","content":[{"type":"text","text":"[Request interrupted by user for tool use]"}]},"uuid":"e16773c4-fb40-4ab4-87d0-abc0e07f0af5","timestamp":"2026-01-13T21:11:52.416Z"}
{"type":"summary","summary":"API Error: 500 {\"type\":\"error\",\"error\":{\"type\":\"api_error\",\"message\":\"Internal server error\"},\"request_id\":\"req_011CXmQ9gBcfVi99uM1oLoPk\"}","leafUuid":"e16773c4-fb40-4ab4-87d0-abc0e07f0af5"}
