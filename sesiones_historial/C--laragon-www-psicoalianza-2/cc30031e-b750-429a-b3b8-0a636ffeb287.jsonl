{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-26T13:03:32.102Z","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287"}
{"type":"file-history-snapshot","messageId":"44fe0fe9-61b9-43a2-83db-ded59eced34d","snapshot":{"messageId":"44fe0fe9-61b9-43a2-83db-ded59eced34d","trackedFileBackups":{},"timestamp":"2026-01-26T13:03:32.212Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 225 to 231 from c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php:\n@if ($opcion == 'asignar')\n                <div class=\"row mt-3\">\n                    <div class=\"col-12 mt-5 mb-4\">\n                        <h4 class=\"text-headline-4\"><strong>Valor de venta: <span id=\"valor-venta-mostrar\">0</span></strong></h4>\n                    </div>\n                </div>\n            @endif\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"hola naliza este archivos con sus js resources\\views\\empresas\\paginas\\asignar-plan.blade.php"}]},"uuid":"44fe0fe9-61b9-43a2-83db-ded59eced34d","timestamp":"2026-01-26T13:03:32.205Z","permissionMode":"default"}
{"parentUuid":"44fe0fe9-61b9-43a2-83db-ded59eced34d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","message":{"model":"claude-opus-4-5-20251101","id":"msg_0184179mK4ymTGKsdajr1fPp","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que analice el archivo `resources\\views\\empresas\\paginas\\asignar-plan.blade.php` junto con sus archivos JavaScript asociados. Voy a leer el archivo blade primero y luego buscar los archivos JS relacionados.","signature":"EokDCkYICxgCKkCviJVpGquztoJcwBT+sbp8msv59RhCSHDbP3fDrSoZGGGklWdM9/t1hVsZPeXzhqZ5cbIxptYPyjWYBNhmgZqPEgwgrZ0WEhHHMh16z0kaDBG0mX3eOlS9OyPjmyIwSl5NTWkBnnQ+oqBP9FmMMljuikYZ/3IoRHgjJwdGD9PYbomflqBVVo8LK/yicxPCKvABnNGluREyBm6bZPE1iA70rkJbZq9i0ZmzI0GVia7yN85te8DpoCAwRFRFWX4F/FJrnmVYmel2G/q7Q/0+FWW+jXLTLetj8cpECKPV43vu3EZiuxhf3Ce35/5J1kyRF0qww7/Vm9zAMBjPMEZvW/QnGzH/LhlI8tZlGsOixcfF5lm9BsWSz25LgsxHP6v5sYI2Hg5nvZ1/NkTbPp6PbuhKtWvCZ4A1qV2ksApY+hvMwKwID7A/72n0EHd+VtNTi9nhfJ+vlfC3qXsplE6ncTYT+jich3sOsmM5SXnF0i0bhgZbcSQBlsY5VSrZhXnUXuoiGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":25286,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":25286,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW32WZUxudPXm4ELko3h","type":"assistant","uuid":"714c0d10-b4ca-4eda-9ec4-9dd8655e03a1","timestamp":"2026-01-26T13:03:35.634Z"}
{"parentUuid":"714c0d10-b4ca-4eda-9ec4-9dd8655e03a1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","message":{"model":"claude-opus-4-5-20251101","id":"msg_0184179mK4ymTGKsdajr1fPp","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a analizar el archivo blade y sus archivos JavaScript asociados."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":25286,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":25286,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW32WZUxudPXm4ELko3h","type":"assistant","uuid":"a7e48e70-9668-4a63-b5e2-e0f85e94039d","timestamp":"2026-01-26T13:03:36.090Z"}
{"parentUuid":"a7e48e70-9668-4a63-b5e2-e0f85e94039d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","message":{"model":"claude-opus-4-5-20251101","id":"msg_0184179mK4ymTGKsdajr1fPp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01McU78Q6xquANkxigH4aFms","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":25286,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":25286,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW32WZUxudPXm4ELko3h","type":"assistant","uuid":"dae3d428-4578-4317-a842-fbb94a0ddac8","timestamp":"2026-01-26T13:03:36.805Z"}
{"parentUuid":"dae3d428-4578-4317-a842-fbb94a0ddac8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","message":{"model":"claude-opus-4-5-20251101","id":"msg_0184179mK4ymTGKsdajr1fPp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Jtojf6prvGRQsBBEXGNQgK","name":"Glob","input":{"pattern":"**/asignar-plan*.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":25286,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":25286,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW32WZUxudPXm4ELko3h","type":"assistant","uuid":"9b86449b-dd40-4c7d-8e8b-68ef97b923e0","timestamp":"2026-01-26T13:03:37.492Z"}
{"parentUuid":"dae3d428-4578-4317-a842-fbb94a0ddac8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01McU78Q6xquANkxigH4aFms","type":"tool_result","content":"     1→@extends('layouts.app')\n     2→@php\n     3→    $titulo_pagina = isset($empresa_id) ? 'Asignar plan' : 'Facturar';\n     4→@endphp\n     5→@section('titulo', $titulo_pagina)\n     6→\n     7→@section('estilos')\n     8→    <link href=\"{{ asset('css/empresas/empresas.css') }}\" rel=\"stylesheet\">\n     9→@endsection\n    10→\n    11→@section('contenido')\n    12→    <div class=\"container-fluid mt-4\">\n    13→        <div class=\"text-headline-6 mb-0\">\n    14→            <i class=\"bi bi-chevron-left h4 mb-0 text-primary me-5 pointer\" onclick=\"window.history.back();\"></i>\n    15→            @if ($opcion == 'asignar')\n    16→                Asignar plan\n    17→            @elseif ($opcion == 'facturar')\n    18→                Facturar plan\n    19→            @elseif ($opcion == 'editar')\n    20→                Editar asignación de plan\n    21→            @endif\n    22→        </div>\n    23→    </div>\n    24→    <div class=\"container mt-8\">\n    25→        <form id=\"formulario\" enctype=\"multipart/form-data\">\n    26→            @csrf\n    27→            @isset ($empresa_id)\n    28→                <input type=\"hidden\" id=\"empresa_id\" name=\"empresa_id\" value=\"{{ $empresa_id }}\">\n    29→            @endisset\n    30→            @isset ($empresa_plan)\n    31→                <input type=\"hidden\" id=\"id\" name=\"id\" class=\"input-dinamico\" value=\"{{ $empresa_plan->id }}\">\n    32→            @endisset\n    33→            <input type=\"hidden\" id=\"pruebas\" name=\"pruebas\" value=\"\">\n    34→            <input type=\"hidden\" id=\"vigencia\" name=\"vigencia\">\n    35→            <input type=\"hidden\" id=\"unidades\" name=\"unidades\">\n    36→            <input type=\"hidden\" id=\"cantidad_ofertas_laborales\" name=\"cantidad_ofertas_laborales\">\n    37→            <input type=\"hidden\" id=\"cantidad_usuarios\" name=\"cantidad_usuarios\">\n    38→            <input type=\"hidden\" id=\"cantidad_pruebas\" name=\"cantidad_pruebas\">\n    39→            <input type=\"hidden\" id=\"plan_credito_id\" name=\"plan_credito_id\" value=\"\">\n    40→            <input type=\"hidden\" id=\"creditos\" name=\"creditos\" value=\"\">\n    41→            <input type=\"hidden\" id=\"funcionalidades\" name=\"funcionalidades\" value=\"\">\n    42→            <div class=\"row mt-6\">\n    43→                <div class=\"col-12\">\n    44→                    ${crearMultiselect({\n    45→                        opciones: [\n    46→                            { nombre: 'Planes de selección', id: '1' },\n    47→                            { nombre: 'Planes de créditos (IA)', id: '2' }\n    48→                        ],\n    49→                        id: 'tipo_prueba_id',\n    50→                        name: 'tipo_prueba_id',\n    51→                        class: 'clase-personalizada',\n    52→                        onchange: 'seleccionarTipoPruebaMultiple();',\n    53→                        placeholder: 'Tipo de plan',\n    54→                        icono: '<i class=\"bi bi-check-circle input-icono1\"></i>',\n    55→                        label: 'Tipo de plan',\n    56→                        disabled: {{ $opcion != 'asignar' ? 'true' : 'false' }}\n    57→                    })}\n    58→                </div>\n    59→            </div>\n    60→            <div class=\"row mt-3\">\n    61→                <div class=\"col-12\">\n    62→                    <div id=\"contenedor-plan\">\n    63→                    </div>\n    64→                </div>\n    65→                <div class=\"col-6\">\n    66→                    ${crearInput({\n    67→                        id: 'plan_id',\n    68→                        name: 'plan_id',\n    69→                        adicional: 'style=\"width: 0px; height: 0px;\"',\n    70→                        class: 'p-0 border-0',\n    71→                        required: true,\n    72→                        input_container_class: 'mb-0'\n    73→                    })}\n    74→                </div>\n    75→            </div>\n    76→\n    77→            <div class=\"row mt-7 d-none\" id=\"seccion-pruebas\">\n    78→                <div class=\"col-12 mb-2\">\n    79→                    <h4 class=\"text-headline-4 mb-5\">Pruebas</h4>\n    80→                    <span class=\"text-body-2\">Selecciona las <span class=\"cantidad-pruebas\"></span> prueba(s) que vas a asignar a esta empresa.</span>\n    81→                </div>\n    82→                <div class=\"col-12 col-lg-6\">\n    83→                    <div class=\"row\" id=\"contenedor-pruebas\">\n    84→                    </div>\n    85→                </div>\n    86→            </div>\n    87→\n    88→            <div class=\"row mt-5 d-none\" id=\"alerta-pruebas\">\n    89→                <div class=\"col-12\">\n    90→                    ${crearAlerta(\n    91→                        'warning',\n    92→                        'Recuerda que solo tienes <span class=\"cantidad-pruebas\">{{ $empresa_plan->cantidad_pruebas ?? ''}}</span> prueba(s) disponibles.',\n    93→                        'w-100 mb-0'\n    94→                    )}\n    95→                </div>\n    96→            </div>\n    97→\n    98→            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n    99→                <div class=\"col-6\">\n   100→                    ${crearInput({\n   101→                        id: 'porcentaje_descuento',\n   102→                        name: 'porcentaje_descuento',\n   103→                        type: 'number',\n   104→                        autocomplete: 'off',\n   105→                        max: 100,\n   106→                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n   107→                        label: 'Porcentaje de descuento',\n   108→                        label_class: 'optional'\n   109→                    })}\n   110→                </div>\n   111→                <div class=\"col-6\">\n   112→                    ${crearInput({\n   113→                        id: 'precio_plan',\n   114→                        name: 'precio',\n   115→                        class: 'cleave',\n   116→                        autocomplete: 'off',\n   117→                        minlength: 3,\n   118→                        maxlength: 12,\n   119→                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n   120→                        required: true,\n   121→                        label: 'Valor de venta'\n   122→                    })}\n   123→                </div>\n   124→            </div>\n   125→            \n   126→            <div class=\"row mt-3\">\n   127→                <div class=\"col-12\">\n   128→                    <div id=\"contenedor-creditos\">\n   129→                    </div>\n   130→                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n   131→                        <div class=\"col-6\">\n   132→                            ${crearInput({\n   133→                                id: 'porcentaje_descuento_creditos',\n   134→                                name: 'porcentaje_descuento_creditos',\n   135→                                type: 'number',\n   136→                                autocomplete: 'off',\n   137→                                max: 100,\n   138→                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n   139→                                label: 'Porcentaje de descuento',\n   140→                                label_class: 'optional'\n   141→                            })}\n   142→                        </div>\n   143→                        <div class=\"col-6\">\n   144→                            ${crearInput({\n   145→                                id: 'precio_creditos',\n   146→                                name: 'precio_creditos',\n   147→                                class: 'cleave',\n   148→                                autocomplete: 'off',\n   149→                                minlength: 3,\n   150→                                maxlength: 12,\n   151→                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n   152→                                required: true,\n   153→                                label: 'Valor de venta'\n   154→                            })}\n   155→                        </div>\n   156→                    </div>\n   157→                </div>\n   158→            </div>\n   159→\n   160→            <div class=\"row mt-7\">\n   161→                <div class=\"col-12 mt-5 mb-4\">\n   162→                    <h4 class=\"text-headline-4\">Valor</h4>\n   163→                    <span class=\"text-body-2\">Revisa el precio final y adjunta la factura.</span>\n   164→                </div>\n   165→            </div>\n   166→\n   167→            <div class=\"row mt-3\">\n   168→                <div class=\"col-6\">\n   169→                    ${crearInput({\n   170→                        id: 'numero_factura',\n   171→                        name: 'numero_factura',\n   172→                        type: 'text',\n   173→                        autocomplete: 'off',\n   174→                        maxlength: 12,\n   175→                        value: '{{ isset($empresa_plan) ? $empresa_plan->numero_factura : '' }}',\n   176→                        required: true,\n   177→                        label: 'Número de factura o concepto'\n   178→                    })}\n   179→                </div>\n   180→                <div class=\"col-6\">\n   181→                    @if ($opcion == 'editar' && isset($empresa_plan['archivos'][0]))\n   182→                        <div class=\"card h-auto border-secondary\">\n   183→                            <div class=\"card-body p-2 rounded-4\">\n   184→                                ${crearBoton({\n   185→                                    url: '#',\n   186→                                    clases: 'w-100 d-flex justify-content-between pointer bg-transparent border-0 p-0',\n   187→                                    texto: `\n   188→                                        <div class=\"px-4 text-cta-blue text-decoration-none\">\n   189→                                            {{$empresa_plan['archivos'][0]['nombre']}}\n   190→                                        </div>\n   191→                                        <div class=\"px-4\">\n   192→                                            <i class=\"bi bi-eye-fill text-cta-blue\"></i>\n   193→                                        </div>\n   194→                                    `,\n   195→                                    onclick: `abrirFacturaPlan('{{$empresa_plan['archivos'][0]['id']}}')`\n   196→                                })}\n   197→                            </div>\n   198→                        </div>\n   199→                    @else\n   200→                        ${crearInputFile({\n   201→                            id: 'factura',\n   202→                            name: 'factura',\n   203→                            class: 'input-form',\n   204→                            placeholder: '',\n   205→                            required: false,\n   206→                            accept: 'application/pdf',\n   207→                        })}\n   208→                    @endif\n   209→                </div>\n   210→            </div>\n   211→\n   212→            <div class=\"row mt-3\">\n   213→                <div class=\"col-12\">\n   214→                    ${crearTextarea({\n   215→                        id: 'comentario',\n   216→                        name: 'comentario',\n   217→                        maxlength: 255,\n   218→                        value: '{{ isset($empresa_plan) ? $empresa_plan->comentario : '' }}',\n   219→                        label: 'Comentario o detalle de uso',\n   220→                        label_class: 'optional'\n   221→                    })}\n   222→                </div>\n   223→            </div>\n   224→\n   225→            @if ($opcion == 'asignar')\n   226→                <div class=\"row mt-3\">\n   227→                    <div class=\"col-12 mt-5 mb-4\">\n   228→                        <h4 class=\"text-headline-4\"><strong>Valor de venta: <span id=\"valor-venta-mostrar\">0</span></strong></h4>\n   229→                    </div>\n   230→                </div>\n   231→            @endif\n   232→\n   233→            <div class=\"row mt-3 pb-4\">\n   234→                <div class=\"col-12 text-center\">\n   235→                    ${crearBoton({\n   236→                        type: 'button',\n   237→                        clases: 'btn-outline-primary me-2 px-14 text-blue-40',\n   238→                        texto: 'Cancelar',\n   239→                        url: `/empresas-gestionar/{{ isset($empresa_id) ? $empresa_id : '' }}`\n   240→                    })}\n   241→                    ${crearBoton({\n   242→                        id: `boton-asignar`,\n   243→                        type: `submit`,\n   244→                        clases: `btn-primary px-12`,\n   245→                        texto: `@if ($opcion == \"asignar\") Asignar plan @elseif ($opcion == \"facturar\") Guardar @elseif ($opcion == \"editar\") Guardar @endif`\n   246→                    })}\n   247→                </div>\n   248→            </div>\n   249→        </form>\n   250→    </div>\n   251→@section('modals')\n   252→    ${crearModal({\n   253→        id: 'modal-planes',\n   254→        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planesLabel\" aria-hidden=\"true\"',\n   255→        dialog_class: 'modal-lg',\n   256→        titulo_header: 'Elegir plan',\n   257→        modal_body: `\n   258→            <div class=\"col-12\">\n   259→                <div class=\"row m-0 w-100\">\n   260→                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n   261→                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda\">\n   262→                            <i class=\"bi bi-search\"></i>\n   263→                        </div>\n   264→                    </div>\n   265→                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n   266→                        ${crearSelect2({\n   267→                            id: 'filtro-plan',\n   268→                            name: 'filtro-plan',\n   269→                            class: 'select2-filtro',\n   270→                            onchange: 'mostrarPlanes();',\n   271→                            opciones: [\n   272→                                { nombre: 'Todos', id: 'Todos' },\n   273→                                { nombre: 'Por vacantes', id: 'Ofertas' },\n   274→                                { nombre: 'Por unidades', id: 'Unidades' },\n   275→                                { nombre: 'Por tiempo', id: 'Tiempo' }\n   276→                            ],\n   277→                            input_container_class: 'mb-0',\n   278→                            opcion_vacia: false\n   279→                        })}\n   280→                    </div>\n   281→                </div>\n   282→                <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n   283→                    <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n   284→                        <thead class=\"d-none\">\n   285→                            <tr>\n   286→                                <th></th>\n   287→                            </tr>\n   288→                        </thead>\n   289→                        <tbody id=\"tbody-planes\">\n   290→                        </tbody>\n   291→                    </table>\n   292→                </div>\n   293→            </div>\n   294→        `\n   295→    })}\n   296→    ${crearModal({\n   297→        id: 'modal-modificar-planes',\n   298→        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-modificar-planesLabel\" aria-hidden=\"true\"',\n   299→        dialog_class: 'modal-md',\n   300→        titulo_header: 'Modificar plan - <span id=\"nombre-plan-modal\">{{ isset($empresa_plan) && $empresa_plan->plan ? \" \" . $empresa_plan->plan->nombre : (isset($empresa_plan) && $empresa_plan->planCredito ? \" \" . $empresa_plan->planCredito->nombre : \"\") }}</span>',\n   301→        modal_body_class: 'pt-0',\n   302→        modal_body: `\n   303→            <div class=\"col-12 px-4 mb-5\">\n   304→                <span class=\"text-body-2\">Personaliza tu plan para esta empresa.</span>\n   305→            </div>\n   306→            <div class=\"row m-0 w-100\">\n   307→                <div class=\"col-12\" id=\"input-container-pruebas\">\n   308→                    ${crearSelect2({\n   309→                        id: 'cantidad_pruebas_modal',\n   310→                        name: 'cantidad_pruebas_modal',\n   311→                        class: 'select2-filtro',\n   312→                        onchange: 'habilitarBotonGuardar();',\n   313→                        opciones: [\n   314→                            { nombre: '', id: '' },\n   315→                            @if (isset($empresa_plan))\n   316→                                @for ($i = 1; $i <= 8; $i++)\n   317→                                    { nombre: '{{ $i }} Pruebas', id: '{{ $i }}', selected: {{ $empresa_plan->cantidad_pruebas == $i ? 'true' : 'false' }} },\n   318→                                @endfor\n   319→                            @endif\n   320→                        ],\n   321→                        label: 'Pruebas disponibles'\n   322→                    })}\n   323→                </div>\n   324→                <div class=\"col-12 col-md-6\" id=\"input-container-tiempo\">\n   325→                    ${crearSelect2({\n   326→                        id: 'tiempo_modal',\n   327→                        name: 'tiempo_modal',\n   328→                        class: 'select2-filtro',\n   329→                        onchange: 'habilitarBotonGuardar(); seleccionarTiempo(this.value);',\n   330→                        opciones: [\n   331→                            { nombre: 'Seleccione', id: '' },\n   332→                            { nombre: '3 Meses', id: '90', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 90 ? 'true' : 'false' }} },\n   333→                            { nombre: '6 Meses', id: '180', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 180 ? 'true' : 'false' }} },\n   334→                            { nombre: '1 Año', id: '365', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 365 ? 'true' : 'false' }} },\n   335→                            { nombre: 'Personalizado', id: 'personalizado' }\n   336→                        ],\n   337→                        label: 'Tiempo'\n   338→                    })}\n   339→                </div>\n   340→                <div class=\"col-12 col-md-6 d-none\" id=\"input-container-vigencia\">\n   341→                    ${crearInput({\n   342→                        id: 'vigencia_modal',\n   343→                        name: 'vigencia_modal',\n   344→                        class: 'solo-numeros',\n   345→                        autocomplete: 'off',\n   346→                        max: 1000000,\n   347→                        onkeyup: 'habilitarBotonGuardar();',\n   348→                        label: 'Días'\n   349→                    })}\n   350→                </div>\n   351→                <div class=\"col-12 col-md-6\">\n   352→                    ${crearInput({\n   353→                        id: 'unidades_modal',\n   354→                        name: 'unidades_modal',\n   355→                        class: 'solo-numeros',\n   356→                        autocomplete: 'off',\n   357→                        max: 1000000,\n   358→                        value: '{{ isset($empresa_plan) ? $empresa_plan->unidades : '' }}',\n   359→                        onkeyup: 'habilitarBotonGuardar();',\n   360→                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n   361→                        label: 'Unidades <span class=\"texto-label-tiempo\"></span>'\n   362→                    })}\n   363→                </div>\n   364→                <div class=\"col-12 col-md-6\">\n   365→                    ${crearInput({\n   366→                        id: 'cantidad_ofertas_laborales_modal',\n   367→                        name: 'cantidad_ofertas_laborales_modal',\n   368→                        class: 'solo-numeros',\n   369→                        autocomplete: 'off',\n   370→                        max: 1000000,\n   371→                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_ofertas_laborales : '' }}',\n   372→                        onkeyup: 'habilitarBotonGuardar();',\n   373→                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n   374→                        label: 'Vacantes <span class=\"texto-label-tiempo\"></span>'\n   375→                    })}\n   376→                </div>\n   377→                <div class=\"col-12 mb-2\">\n   378→                    <h4 class=\"text-headline-4\">Beneficios</h4>\n   379→                </div>\n   380→                <div class=\"col-12 col-md-6\">\n   381→                    <div class=\"input-container\">\n   382→                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"adicionales_modal\" name=\"adicionales_modal[]\" data-placeholder=\"Adicionales\" onchange=\"habilitarBotonGuardar();\"></select>\n   383→                    </div>\n   384→                </div>\n   385→                <div class=\"col-12 col-md-6\">\n   386→                    <div class=\"input-container\">\n   387→                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"predefinidos_modal\" name=\"predefinidos_modal[]\" data-placeholder=\"Predefinidos\" onchange=\"habilitarBotonGuardar();\"></select>\n   388→                    </div>\n   389→                </div>\n   390→                <div class=\"col-12\">\n   391→                    ${crearInput({\n   392→                        id: 'cantidad_usuarios_modal',\n   393→                        name: 'cantidad_usuarios_modal',\n   394→                        type: 'number',\n   395→                        autocomplete: 'off',\n   396→                        max: 1000000,\n   397→                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_usuarios : '' }}',\n   398→                        onkeyup: 'habilitarBotonGuardar();',\n   399→                        label: 'Usuarios'\n   400→                    })}\n   401→                </div>\n   402→                <div class=\"col-12\">\n   403→                    <div class=\"alert badge-estado-renovado fw-bold\">\n   404→                        Recuerda que no es posible cambiar entre planes con cantidades fijas a ilimitados o viceversa.\n   405→                    </div>\n   406→                </div>\n   407→                <div class=\"col-12\">\n   408→                    <div class=\"row m-0 w-100\">\n   409→                        ${crearBoton({\n   410→                            type: 'button',\n   411→                            clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n   412→                            texto: 'Cancelar',\n   413→                            onclick: 'cancelarEdicion();',\n   414→                            adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n   415→                        })}\n   416→                        ${crearBoton({\n   417→                            id: 'boton-guardar-modificaciones',\n   418→                            type: 'button',\n   419→                            clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n   420→                            texto: 'Guardar modificaciones',\n   421→                            onclick: 'abrirModalEstasSeguro();',\n   422→                            disabled: true\n   423→                        })}\n   424→                    </div>\n   425→                </div>\n   426→            </div>\n   427→            <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n   428→                <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n   429→                    <thead class=\"d-none\">\n   430→                        <tr>\n   431→                            <th></th>\n   432→                        </tr>\n   433→                    </thead>\n   434→                    <tbody id=\"tbody-planes\">\n   435→                    </tbody>\n   436→                </table>\n   437→            </div>\n   438→        `\n   439→    })}\n   440→    ${crearModal({\n   441→        id: 'modal-estas-seguro',\n   442→        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-estas-seguroLabel\" aria-hidden=\"true\"',\n   443→        dialog_class: 'modal-md',\n   444→        titulo_header: '¿Estás seguro?',\n   445→        modal_body_class: 'pt-0',\n   446→        modal_body: `\n   447→            <div class=\"col-12 px-4 mb-5\">\n   448→                <span class=\"text-body-2\">\n   449→                    se modificará el plan actual para la empresa, ten en cuenta que la información de consumo puede variar entre este plan modificado y los que no lo están pero tienen el mismo nombre.\n   450→                    <br>\n   451→                    <br>\n   452→                    Personaliza tu plan para esta empresa.\n   453→                </span>\n   454→            </div>\n   455→            <div class=\"col-12 px-4 mb-4 mt-3\">\n   456→                <div class=\"row m-0 w-100\">\n   457→                    ${crearBoton({\n   458→                        type: 'button',\n   459→                        clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n   460→                        texto: 'Cancelar',\n   461→                        onclick: 'cancelarEdicion();',\n   462→                        adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n   463→                    })}\n   464→                    ${crearBoton({\n   465→                        id: 'boton-estoy-seguro',\n   466→                        type: 'button',\n   467→                        clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n   468→                        texto: 'Si, estoy seguro',\n   469→                        onclick: 'confirmarEdicion();'\n   470→                    })}\n   471→                </div>\n   472→            </div>\n   473→        `\n   474→    })}\n   475→    ${crearModal({\n   476→        id: 'modal-planes-creditos',\n   477→        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planes-creditosLabel\" aria-hidden=\"true\"',\n   478→        dialog_class: 'modal-lg',\n   479→        titulo_header: 'Elegir Plan de Créditos IA',\n   480→        modal_body: `\n   481→            <div class=\"col-12\">\n   482→                <div class=\"row m-0 w-100 mb-3\">\n   483→                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n   484→                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda-credito\">\n   485→                            <i class=\"bi bi-search\"></i>\n   486→                            <input type=\"text\" id=\"buscador-plan-credito\" class=\"rounded-2 text-body-2\" placeholder=\"Buscar\">\n   487→                        </div>\n   488→                    </div>\n   489→                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n   490→                        ${crearSelect2({\n   491→                            id: 'filtro-plan-credito',\n   492→                            name: 'filtro-plan-credito',\n   493→                            class: 'select2-filtro',\n   494→                            onchange: 'mostrarPlanesCreditos();',\n   495→                            opciones: [\n   496→                                { nombre: 'Mayor a menor', id: 'Mayor' },\n   497→                                { nombre: 'Menor a mayor', id: 'Menor' },\n   498→                            ],\n   499→                            input_container_class: 'mb-0',\n   500→                            opcion_vacia: false\n   501→                        })}\n   502→                    </div>\n   503→                </div>\n   504→                <div id=\"contenedor-planes-creditos\">\n   505→                    <!-- Los planes se cargarán dinámicamente aquí -->\n   506→                </div>\n   507→            </div>\n   508→        `\n   509→    })}\n   510→@endsection\n   511→@endsection\n   512→\n   513→@section('scripts')\n   514→    <script src=\"{{ asset('js/empresas/asignar-plan.js') }}\" type=\"text/javascript\"></script>\n   515→    <script type=\"text/javascript\">\n   516→        @if ($opcion == 'asignar')\n   517→            opcion = 'asignar';\n   518→            empresa = @json($empresa);\n   519→            resource_url = '/empresas-planes';\n   520→            plan_seleccionado = null;\n   521→        @elseif ($opcion == 'facturar')\n   522→            opcion = 'facturar';\n   523→            empresa = @json($empresa);\n   524→            resource_url = '/facturar-plan';\n   525→            empresa_plan = @json($empresa_plan);\n   526→            plan_seleccionado = @json($empresa_plan->plan);\n   527→            plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n   528→            plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n   529→            plan_seleccionado.unidades = empresa_plan.unidades\n   530→            plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n   531→            plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n   532→            plan_seleccionado.precio = empresa_plan.precio;\n   533→            pruebas_empresa_plan = @json($empresa_plan->pruebas);\n   534→\n   535→            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n   536→                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n   537→            @endif\n   538→\n   539→            // Determinar los tipos de prueba a seleccionar\n   540→            let tipos_a_seleccionar_facturar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n   541→            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n   542→                tipos_a_seleccionar_facturar.push('2');\n   543→            @endif\n   544→\n   545→            // Establecer los tipos de prueba en el select\n   546→            $('#tipo_prueba_id').val(tipos_a_seleccionar_facturar).trigger('change');\n   547→\n   548→            seleccionarTipoPruebaMultiple();\n   549→            buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n   550→\n   551→            // Esperar a que el DOM esté listo para establecer valores\n   552→            $(document).ready(function() {\n   553→                @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n   554→                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n   555→                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n   556→\n   557→                    // Dar tiempo para que se cargue seleccionarTipoPruebaMultiple() y sus AJAX\n   558→                    setTimeout(function() {\n   559→                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n   560→                            mostrarPlanCreditosSeleccionado();\n   561→                        }\n   562→                    }, 1000);\n   563→                @endif\n   564→            });\n   565→        @elseif ($opcion == 'editar')\n   566→            opcion = 'editar';\n   567→            empresa = @json($empresa);\n   568→            resource_url = '/empresas-planes';\n   569→            empresa_plan = @json($empresa_plan);\n   570→\n   571→            // Obtener el tipo de edición desde la URL\n   572→            let tipo_edicion = '{{ request()->get(\"tipo\", \"seleccion\") }}';\n   573→\n   574→            @if(request()->get('tipo') == 'creditos' && isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n   575→                // Editar plan de créditos\n   576→                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n   577→                plan_creditos_seleccionado.creditos = empresa_plan.creditos;\n   578→                plan_seleccionado = null;\n   579→                pruebas_empresa_plan = []; \n   580→                $('#seccion-pruebas').hide();\n   581→\n   582→                // Establecer tipo 2 (créditos) en el select\n   583→                $('#tipo_prueba_id').val(['2']).trigger('change');\n   584→\n   585→                $(document).ready(function() {\n   586→                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n   587→                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n   588→\n   589→                    setTimeout(function() {\n   590→                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n   591→                            mostrarPlanCreditosSeleccionado();\n   592→                        }\n   593→                    }, 500);\n   594→                });\n   595→            @else\n   596→                // Editar plan de selección\n   597→                plan_seleccionado = @json($empresa_plan->plan);\n   598→                plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n   599→                plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n   600→                plan_seleccionado.unidades = empresa_plan.unidades\n   601→                plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n   602→                plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n   603→                plan_seleccionado.precio = empresa_plan.precio;\n   604→                pruebas_empresa_plan = @json($empresa_plan->pruebas);\n   605→\n   606→                // Establecer tipo de selección en el select\n   607→                let tipos_a_seleccionar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n   608→                $('#tipo_prueba_id').val(tipos_a_seleccionar).trigger('change');\n   609→\n   610→                seleccionarTipoPruebaMultiple();\n   611→                buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n   612→            @endif\n   613→        @endif\n   614→    </script>\n   615→@endsection\n   616→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1ae8f924-f72b-450f-af1c-1407ce2a0b58","timestamp":"2026-01-26T13:03:48.872Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","content":"@extends('layouts.app')\n@php\n    $titulo_pagina = isset($empresa_id) ? 'Asignar plan' : 'Facturar';\n@endphp\n@section('titulo', $titulo_pagina)\n\n@section('estilos')\n    <link href=\"{{ asset('css/empresas/empresas.css') }}\" rel=\"stylesheet\">\n@endsection\n\n@section('contenido')\n    <div class=\"container-fluid mt-4\">\n        <div class=\"text-headline-6 mb-0\">\n            <i class=\"bi bi-chevron-left h4 mb-0 text-primary me-5 pointer\" onclick=\"window.history.back();\"></i>\n            @if ($opcion == 'asignar')\n                Asignar plan\n            @elseif ($opcion == 'facturar')\n                Facturar plan\n            @elseif ($opcion == 'editar')\n                Editar asignación de plan\n            @endif\n        </div>\n    </div>\n    <div class=\"container mt-8\">\n        <form id=\"formulario\" enctype=\"multipart/form-data\">\n            @csrf\n            @isset ($empresa_id)\n                <input type=\"hidden\" id=\"empresa_id\" name=\"empresa_id\" value=\"{{ $empresa_id }}\">\n            @endisset\n            @isset ($empresa_plan)\n                <input type=\"hidden\" id=\"id\" name=\"id\" class=\"input-dinamico\" value=\"{{ $empresa_plan->id }}\">\n            @endisset\n            <input type=\"hidden\" id=\"pruebas\" name=\"pruebas\" value=\"\">\n            <input type=\"hidden\" id=\"vigencia\" name=\"vigencia\">\n            <input type=\"hidden\" id=\"unidades\" name=\"unidades\">\n            <input type=\"hidden\" id=\"cantidad_ofertas_laborales\" name=\"cantidad_ofertas_laborales\">\n            <input type=\"hidden\" id=\"cantidad_usuarios\" name=\"cantidad_usuarios\">\n            <input type=\"hidden\" id=\"cantidad_pruebas\" name=\"cantidad_pruebas\">\n            <input type=\"hidden\" id=\"plan_credito_id\" name=\"plan_credito_id\" value=\"\">\n            <input type=\"hidden\" id=\"creditos\" name=\"creditos\" value=\"\">\n            <input type=\"hidden\" id=\"funcionalidades\" name=\"funcionalidades\" value=\"\">\n            <div class=\"row mt-6\">\n                <div class=\"col-12\">\n                    ${crearMultiselect({\n                        opciones: [\n                            { nombre: 'Planes de selección', id: '1' },\n                            { nombre: 'Planes de créditos (IA)', id: '2' }\n                        ],\n                        id: 'tipo_prueba_id',\n                        name: 'tipo_prueba_id',\n                        class: 'clase-personalizada',\n                        onchange: 'seleccionarTipoPruebaMultiple();',\n                        placeholder: 'Tipo de plan',\n                        icono: '<i class=\"bi bi-check-circle input-icono1\"></i>',\n                        label: 'Tipo de plan',\n                        disabled: {{ $opcion != 'asignar' ? 'true' : 'false' }}\n                    })}\n                </div>\n            </div>\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-plan\">\n                    </div>\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'plan_id',\n                        name: 'plan_id',\n                        adicional: 'style=\"width: 0px; height: 0px;\"',\n                        class: 'p-0 border-0',\n                        required: true,\n                        input_container_class: 'mb-0'\n                    })}\n                </div>\n            </div>\n\n            <div class=\"row mt-7 d-none\" id=\"seccion-pruebas\">\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4 mb-5\">Pruebas</h4>\n                    <span class=\"text-body-2\">Selecciona las <span class=\"cantidad-pruebas\"></span> prueba(s) que vas a asignar a esta empresa.</span>\n                </div>\n                <div class=\"col-12 col-lg-6\">\n                    <div class=\"row\" id=\"contenedor-pruebas\">\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-5 d-none\" id=\"alerta-pruebas\">\n                <div class=\"col-12\">\n                    ${crearAlerta(\n                        'warning',\n                        'Recuerda que solo tienes <span class=\"cantidad-pruebas\">{{ $empresa_plan->cantidad_pruebas ?? ''}}</span> prueba(s) disponibles.',\n                        'w-100 mb-0'\n                    )}\n                </div>\n            </div>\n\n            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan',\n                        name: 'precio',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>\n            \n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos',\n                                name: 'precio_creditos',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-7\">\n                <div class=\"col-12 mt-5 mb-4\">\n                    <h4 class=\"text-headline-4\">Valor</h4>\n                    <span class=\"text-body-2\">Revisa el precio final y adjunta la factura.</span>\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'numero_factura',\n                        name: 'numero_factura',\n                        type: 'text',\n                        autocomplete: 'off',\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->numero_factura : '' }}',\n                        required: true,\n                        label: 'Número de factura o concepto'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    @if ($opcion == 'editar' && isset($empresa_plan['archivos'][0]))\n                        <div class=\"card h-auto border-secondary\">\n                            <div class=\"card-body p-2 rounded-4\">\n                                ${crearBoton({\n                                    url: '#',\n                                    clases: 'w-100 d-flex justify-content-between pointer bg-transparent border-0 p-0',\n                                    texto: `\n                                        <div class=\"px-4 text-cta-blue text-decoration-none\">\n                                            {{$empresa_plan['archivos'][0]['nombre']}}\n                                        </div>\n                                        <div class=\"px-4\">\n                                            <i class=\"bi bi-eye-fill text-cta-blue\"></i>\n                                        </div>\n                                    `,\n                                    onclick: `abrirFacturaPlan('{{$empresa_plan['archivos'][0]['id']}}')`\n                                })}\n                            </div>\n                        </div>\n                    @else\n                        ${crearInputFile({\n                            id: 'factura',\n                            name: 'factura',\n                            class: 'input-form',\n                            placeholder: '',\n                            required: false,\n                            accept: 'application/pdf',\n                        })}\n                    @endif\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    ${crearTextarea({\n                        id: 'comentario',\n                        name: 'comentario',\n                        maxlength: 255,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->comentario : '' }}',\n                        label: 'Comentario o detalle de uso',\n                        label_class: 'optional'\n                    })}\n                </div>\n            </div>\n\n            @if ($opcion == 'asignar')\n                <div class=\"row mt-3\">\n                    <div class=\"col-12 mt-5 mb-4\">\n                        <h4 class=\"text-headline-4\"><strong>Valor de venta: <span id=\"valor-venta-mostrar\">0</span></strong></h4>\n                    </div>\n                </div>\n            @endif\n\n            <div class=\"row mt-3 pb-4\">\n                <div class=\"col-12 text-center\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'btn-outline-primary me-2 px-14 text-blue-40',\n                        texto: 'Cancelar',\n                        url: `/empresas-gestionar/{{ isset($empresa_id) ? $empresa_id : '' }}`\n                    })}\n                    ${crearBoton({\n                        id: `boton-asignar`,\n                        type: `submit`,\n                        clases: `btn-primary px-12`,\n                        texto: `@if ($opcion == \"asignar\") Asignar plan @elseif ($opcion == \"facturar\") Guardar @elseif ($opcion == \"editar\") Guardar @endif`\n                    })}\n                </div>\n            </div>\n        </form>\n    </div>\n@section('modals')\n    ${crearModal({\n        id: 'modal-planes',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir plan',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda\">\n                            <i class=\"bi bi-search\"></i>\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan',\n                            name: 'filtro-plan',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanes();',\n                            opciones: [\n                                { nombre: 'Todos', id: 'Todos' },\n                                { nombre: 'Por vacantes', id: 'Ofertas' },\n                                { nombre: 'Por unidades', id: 'Unidades' },\n                                { nombre: 'Por tiempo', id: 'Tiempo' }\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                    <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                        <thead class=\"d-none\">\n                            <tr>\n                                <th></th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tbody-planes\">\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-modificar-planes',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-modificar-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: 'Modificar plan - <span id=\"nombre-plan-modal\">{{ isset($empresa_plan) && $empresa_plan->plan ? \" \" . $empresa_plan->plan->nombre : (isset($empresa_plan) && $empresa_plan->planCredito ? \" \" . $empresa_plan->planCredito->nombre : \"\") }}</span>',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">Personaliza tu plan para esta empresa.</span>\n            </div>\n            <div class=\"row m-0 w-100\">\n                <div class=\"col-12\" id=\"input-container-pruebas\">\n                    ${crearSelect2({\n                        id: 'cantidad_pruebas_modal',\n                        name: 'cantidad_pruebas_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar();',\n                        opciones: [\n                            { nombre: '', id: '' },\n                            @if (isset($empresa_plan))\n                                @for ($i = 1; $i <= 8; $i++)\n                                    { nombre: '{{ $i }} Pruebas', id: '{{ $i }}', selected: {{ $empresa_plan->cantidad_pruebas == $i ? 'true' : 'false' }} },\n                                @endfor\n                            @endif\n                        ],\n                        label: 'Pruebas disponibles'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\" id=\"input-container-tiempo\">\n                    ${crearSelect2({\n                        id: 'tiempo_modal',\n                        name: 'tiempo_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar(); seleccionarTiempo(this.value);',\n                        opciones: [\n                            { nombre: 'Seleccione', id: '' },\n                            { nombre: '3 Meses', id: '90', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 90 ? 'true' : 'false' }} },\n                            { nombre: '6 Meses', id: '180', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 180 ? 'true' : 'false' }} },\n                            { nombre: '1 Año', id: '365', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 365 ? 'true' : 'false' }} },\n                            { nombre: 'Personalizado', id: 'personalizado' }\n                        ],\n                        label: 'Tiempo'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6 d-none\" id=\"input-container-vigencia\">\n                    ${crearInput({\n                        id: 'vigencia_modal',\n                        name: 'vigencia_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Días'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'unidades_modal',\n                        name: 'unidades_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->unidades : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Unidades <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'cantidad_ofertas_laborales_modal',\n                        name: 'cantidad_ofertas_laborales_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_ofertas_laborales : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Vacantes <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4\">Beneficios</h4>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"adicionales_modal\" name=\"adicionales_modal[]\" data-placeholder=\"Adicionales\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"predefinidos_modal\" name=\"predefinidos_modal[]\" data-placeholder=\"Predefinidos\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    ${crearInput({\n                        id: 'cantidad_usuarios_modal',\n                        name: 'cantidad_usuarios_modal',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_usuarios : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Usuarios'\n                    })}\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"alert badge-estado-renovado fw-bold\">\n                        Recuerda que no es posible cambiar entre planes con cantidades fijas a ilimitados o viceversa.\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row m-0 w-100\">\n                        ${crearBoton({\n                            type: 'button',\n                            clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                            texto: 'Cancelar',\n                            onclick: 'cancelarEdicion();',\n                            adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                        })}\n                        ${crearBoton({\n                            id: 'boton-guardar-modificaciones',\n                            type: 'button',\n                            clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                            texto: 'Guardar modificaciones',\n                            onclick: 'abrirModalEstasSeguro();',\n                            disabled: true\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                    <thead class=\"d-none\">\n                        <tr>\n                            <th></th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"tbody-planes\">\n                    </tbody>\n                </table>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-estas-seguro',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-estas-seguroLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: '¿Estás seguro?',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">\n                    se modificará el plan actual para la empresa, ten en cuenta que la información de consumo puede variar entre este plan modificado y los que no lo están pero tienen el mismo nombre.\n                    <br>\n                    <br>\n                    Personaliza tu plan para esta empresa.\n                </span>\n            </div>\n            <div class=\"col-12 px-4 mb-4 mt-3\">\n                <div class=\"row m-0 w-100\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                        texto: 'Cancelar',\n                        onclick: 'cancelarEdicion();',\n                        adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                    })}\n                    ${crearBoton({\n                        id: 'boton-estoy-seguro',\n                        type: 'button',\n                        clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                        texto: 'Si, estoy seguro',\n                        onclick: 'confirmarEdicion();'\n                    })}\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-planes-creditos',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planes-creditosLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir Plan de Créditos IA',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100 mb-3\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda-credito\">\n                            <i class=\"bi bi-search\"></i>\n                            <input type=\"text\" id=\"buscador-plan-credito\" class=\"rounded-2 text-body-2\" placeholder=\"Buscar\">\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan-credito',\n                            name: 'filtro-plan-credito',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanesCreditos();',\n                            opciones: [\n                                { nombre: 'Mayor a menor', id: 'Mayor' },\n                                { nombre: 'Menor a mayor', id: 'Menor' },\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div id=\"contenedor-planes-creditos\">\n                    <!-- Los planes se cargarán dinámicamente aquí -->\n                </div>\n            </div>\n        `\n    })}\n@endsection\n@endsection\n\n@section('scripts')\n    <script src=\"{{ asset('js/empresas/asignar-plan.js') }}\" type=\"text/javascript\"></script>\n    <script type=\"text/javascript\">\n        @if ($opcion == 'asignar')\n            opcion = 'asignar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            plan_seleccionado = null;\n        @elseif ($opcion == 'facturar')\n            opcion = 'facturar';\n            empresa = @json($empresa);\n            resource_url = '/facturar-plan';\n            empresa_plan = @json($empresa_plan);\n            plan_seleccionado = @json($empresa_plan->plan);\n            plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n            plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n            plan_seleccionado.unidades = empresa_plan.unidades\n            plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n            plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n            plan_seleccionado.precio = empresa_plan.precio;\n            pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n            @endif\n\n            // Determinar los tipos de prueba a seleccionar\n            let tipos_a_seleccionar_facturar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                tipos_a_seleccionar_facturar.push('2');\n            @endif\n\n            // Establecer los tipos de prueba en el select\n            $('#tipo_prueba_id').val(tipos_a_seleccionar_facturar).trigger('change');\n\n            seleccionarTipoPruebaMultiple();\n            buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n\n            // Esperar a que el DOM esté listo para establecer valores\n            $(document).ready(function() {\n                @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    // Dar tiempo para que se cargue seleccionarTipoPruebaMultiple() y sus AJAX\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 1000);\n                @endif\n            });\n        @elseif ($opcion == 'editar')\n            opcion = 'editar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            empresa_plan = @json($empresa_plan);\n\n            // Obtener el tipo de edición desde la URL\n            let tipo_edicion = '{{ request()->get(\"tipo\", \"seleccion\") }}';\n\n            @if(request()->get('tipo') == 'creditos' && isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                // Editar plan de créditos\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n                plan_creditos_seleccionado.creditos = empresa_plan.creditos;\n                plan_seleccionado = null;\n                pruebas_empresa_plan = []; \n                $('#seccion-pruebas').hide();\n\n                // Establecer tipo 2 (créditos) en el select\n                $('#tipo_prueba_id').val(['2']).trigger('change');\n\n                $(document).ready(function() {\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 500);\n                });\n            @else\n                // Editar plan de selección\n                plan_seleccionado = @json($empresa_plan->plan);\n                plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n                plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n                plan_seleccionado.unidades = empresa_plan.unidades\n                plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n                plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n                plan_seleccionado.precio = empresa_plan.precio;\n                pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n                // Establecer tipo de selección en el select\n                let tipos_a_seleccionar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n                $('#tipo_prueba_id').val(tipos_a_seleccionar).trigger('change');\n\n                seleccionarTipoPruebaMultiple();\n                buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n            @endif\n        @endif\n    </script>\n@endsection\n","numLines":616,"startLine":1,"totalLines":616}},"sourceToolAssistantUUID":"dae3d428-4578-4317-a842-fbb94a0ddac8"}
{"parentUuid":"9b86449b-dd40-4c7d-8e8b-68ef97b923e0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Jtojf6prvGRQsBBEXGNQgK","type":"tool_result","content":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js"}]},"uuid":"260c0a23-07ce-426e-8e01-9e9f9f39e785","timestamp":"2026-01-26T13:03:50.200Z","toolUseResult":{"filenames":["c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js"],"durationMs":7278,"numFiles":1,"truncated":false},"sourceToolAssistantUUID":"9b86449b-dd40-4c7d-8e8b-68ef97b923e0"}
{"parentUuid":"260c0a23-07ce-426e-8e01-9e9f9f39e785","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Eb6bF7EFNvMjHgjBNMKzQ4","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Encontré el archivo JavaScript principal. Voy a leerlo para completar el análisis.","signature":"EvwBCkYICxgCKkCdU0FVMD5lANdEqWpXnL3Llmmk4ycqvTOU3nnf+aYZKgyquZLN6OVGGIOEXuDRk+t9Ef1Z/e1lbsuUteAq96aKEgxEcLMvQ3HmxtR8XBYaDMYfqWdBIru6Hu3hOiIwzv195KpaA/j9Lk0U/0pt8TJfBI/Znu0yNHTTlsvCNUnWkJOrCPww0ZdavuNPCTqKKmRUuH47ueNPJjCfJpz9b6GAf4PqVaBuJmhqetCM2shJl1j+oL57V+zUJ0pmIjd10TgkKFpZkQQYv5WkKyzoOypPznIKAGkJ94N/v5iMaCIdmsUZBpr5PjGKWkr9CDrAsGrtDUdIGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":10453,"cache_read_input_tokens":25286,"cache_creation":{"ephemeral_5m_input_tokens":10453,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW33qnQXHu8Dz56pBzNi","type":"assistant","uuid":"8449f81a-b162-421d-a085-337151e686b9","timestamp":"2026-01-26T13:03:53.259Z"}
{"parentUuid":"8449f81a-b162-421d-a085-337151e686b9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Eb6bF7EFNvMjHgjBNMKzQ4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MMpUvtLK2kmcXaj2BV37HF","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":10453,"cache_read_input_tokens":25286,"cache_creation":{"ephemeral_5m_input_tokens":10453,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW33qnQXHu8Dz56pBzNi","type":"assistant","uuid":"0abeccc8-391c-41c7-8e6d-56d86f426ccb","timestamp":"2026-01-26T13:03:53.736Z"}
{"parentUuid":"0abeccc8-391c-41c7-8e6d-56d86f426ccb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MMpUvtLK2kmcXaj2BV37HF","type":"tool_result","content":"     1→table = null;\n     2→planes = [];\n     3→pruebas = [];\n     4→modificado = false;\n     5→funcionalidades_predefinidos = [];\n     6→plan_creditos_seleccionado = null;\n     7→\n     8→$(document).ready(function() {\n     9→    $(document).on('input', '#precio_plan, #precio_creditos', function() {\n    10→        actualizarValorDesdeInput();\n    11→    });\n    12→});\n    13→\n    14→/**\n    15→ * Establecer el tipo de prueba en el selector del formulario.\n    16→ * @param {number} tipo_prueba_id ID del tipo de prueba.\n    17→ * @returns {void}\n    18→ * @author José Manuel Jiménez\n    19→ * @author Daniel Beltrán\n    20→ * @author Andres Morales\n    21→ */\n    22→function seleccionarTipoPrueba(tipo_prueba_id) {\n    23→    $('#contenedor-plan').empty();\n    24→    $('#contenedor-plan').append(`\n    25→        <div class=\"card-body text-center\">\n    26→            <button type=\"button\" id=\"elegir-plan\" class=\"btn btn-outline-primary\" disabled onclick=\"modalElegirPlan();\">Elegir plan</button>\n    27→        </div>\n    28→    `);\n    29→    $('#seccion-pruebas').addClass('d-none');\n    30→    $('#plan_id').val('');\n    31→    pruebas = [];\n    32→    // Convertir tipo_prueba_id a array si no lo es\n    33→    let tipos_prueba = Array.isArray(tipo_prueba_id) ? tipo_prueba_id : [tipo_prueba_id];\n    34→    // Crear los botones según los tipos de prueba seleccionados\n    35→    let botones_html = '<div class=\"card-body text-center\">';\n    36→    tipos_prueba.forEach(function(tipo_id) {\n    37→        let texto_boton = 'Elegir plan';\n    38→        let clase_boton = 'btn-outline-primary';\n    39→        if (tipo_id == 1) {\n    40→            texto_boton = 'Elegir Plan de Selección';\n    41→            clase_boton = 'btn-outline-primary';\n    42→        } else if (tipo_id == 2) {\n    43→            texto_boton = 'Elegir Plan de Créditos IA';\n    44→            clase_boton = 'btn-outline-info';\n    45→        }\n    46→        botones_html += `\n    47→            <button type=\"button\" id=\"elegir-plan-${tipo_id}\" class=\"btn ${clase_boton} mx-1 my-1\" disabled onclick=\"modalElegirPlan(${tipo_id});\">\n    48→                ${texto_boton}\n    49→            </button>\n    50→        `;\n    51→    });\n    52→    botones_html += '</div>';\n    53→    $('#contenedor-plan').append(botones_html);\n    54→    $('#tipo_prueba_id').val(tipo_prueba_id).trigger('select2');\n    55→    if (tipo_prueba_id && (Array.isArray(tipo_prueba_id) ? tipo_prueba_id.length > 0 : tipo_prueba_id)) {\n    56→        // Habilitar todos los botones creados\n    57→        tipos_prueba.forEach(function(tipo_id) {\n    58→            $(`#elegir-plan-${tipo_id}`).prop('disabled', false);\n    59→        });\n    60→        $.ajax({\n    61→            type: 'GET',\n    62→            url : `/pruebas-listado`,\n    63→            data: {\n    64→                tipo_prueba_id: tipo_prueba_id,\n    65→                activo: 1\n    66→            }\n    67→        }).then((respuesta) => {\n    68→            limpiarAdicional();\n    69→            $('#contenedor-pruebas').empty();\n    70→            pruebas = respuesta.data;\n    71→            for (let i = 0; i < pruebas.length; i++) {\n    72→                $('#contenedor-pruebas').append(`\n    73→                    <div class=\"col-12 col-md-6\">\n    74→                        <div class=\"d-flex align-items-center\">\n    75→                            <div class=\"check-container my-1 me-1\">\n    76→                                <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n    77→                            </div>\n    78→                            <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n    79→                        </div>\n    80→                    </div>\n    81→                `);\n    82→            }\n    83→            if (opcion == 'facturar' || opcion == 'editar') {\n    84→                for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n    85→                    $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n    86→                }\n    87→                $('#seccion-pruebas').removeClass('d-none');\n    88→                mostrarPlanSeleccionado();\n    89→            }\n    90→            if (opcion == 'editar') {\n    91→                $('#tipo_prueba_id').prop('disabled', true);\n    92→            }\n    93→        }).catch((error) => {\n    94→            console.error(error);\n    95→        });\n    96→    } else {\n    97→        $('#elegir-plan').prop('disabled', true);\n    98→    }\n    99→}\n   100→/**\n   101→ * Establecer el tipo de prueba en el selector del formulario.\n   102→ * @param {number} tipo_prueba_id ID del tipo de prueba.\n   103→ * @returns {void}\n   104→ * @author Jair Carvajal\n   105→ */\n   106→function seleccionarTipoPruebaMultiple() {\n   107→    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n   108→    tipos_prueba = tipos_prueba.filter(function(tipo_id) {\n   109→        return tipo_id !== null && tipo_id !== '' && tipo_id !== undefined;\n   110→    });\n   111→    if (tipos_prueba.length === 0) {\n   112→        // Si no hay tipos seleccionados, limpiar todo\n   113→        $('#contenedor-plan').empty();\n   114→        $('#contenedor-creditos').empty();\n   115→        $('#seccion-pruebas').addClass('d-none');\n   116→        $('#plan_id').val('');\n   117→        $('#plan_id').prop('required', false);\n   118→        $('#plan_id').prop('disabled', true);\n   119→        $('#plan_credito_id').val('');\n   120→        $('#creditos').val('');\n   121→        plan_seleccionado = null;\n   122→        plan_creditos_seleccionado = null;\n   123→        pruebas = [];\n   124→        return;\n   125→    }\n   126→    let tiene_seleccion = tipos_prueba.includes('1') || tipos_prueba.includes(1);\n   127→    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n   128→    $('#plan_id').prop('required', tiene_seleccion);\n   129→    $('#plan_id').prop('disabled', !tiene_seleccion);\n   130→    // Manejo del plan de selección\n   131→    if (tiene_seleccion) {\n   132→        // Si hay un plan seleccionado, mantenerlo; si no, mostrar el botón\n   133→        if (plan_seleccionado === null && $('#contenedor-plan').children().length === 0) {\n   134→            let seccion_seleccion = `\n   135→                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Selección</p>\n   136→                <div class=\"card rounded rounded-3\">\n   137→                    <div class=\"card-body text-center\">\n   138→                        <button type=\"button\" id=\"elegir-plan-1\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(1);\">\n   139→                            Elegir Plan de Selección\n   140→                        </button>\n   141→                    </div>\n   142→                </div>\n   143→            `;\n   144→            $('#contenedor-plan').html(seccion_seleccion);\n   145→        }\n   146→    } else {\n   147→        // Si se deseleccionó el tipo de selección, limpiar el plan\n   148→        $('#contenedor-plan').empty();\n   149→        plan_seleccionado = null;\n   150→        $('#plan_id').val('');\n   151→    }\n   152→    // Manejo del plan de créditos\n   153→    if (tiene_creditos) {\n   154→        // Si hay un plan de créditos seleccionado, mantenerlo; si no, mostrar el botón\n   155→        if (plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n   156→            let seccion_creditos = `\n   157→                <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n   158→                    <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n   159→                    <div class=\"card rounded rounded-3\">\n   160→                        <div class=\"card-body text-center\">\n   161→                            <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n   162→                                Elegir Plan de Créditos IA\n   163→                            </button>\n   164→                        </div>\n   165→                    </div>\n   166→                </div>\n   167→            `;\n   168→            $('#contenedor-creditos').html(seccion_creditos);\n   169→        }\n   170→    } else {\n   171→        // Si se deseleccionó el tipo de créditos, limpiar el plan de créditos\n   172→        $('#contenedor-creditos').empty();\n   173→        $('#contenedor-plan-creditos').remove();\n   174→        plan_creditos_seleccionado = null;\n   175→        $('#plan_credito_id').val('');\n   176→        $('#creditos').val('');\n   177→    }\n   178→    $.ajax({\n   179→        type: 'GET',\n   180→        url : `/pruebas-listado`,\n   181→        data: {\n   182→            tipo_prueba_id: tipos_prueba,\n   183→            activo: 1\n   184→        }\n   185→    }).then((respuesta) => {\n   186→        limpiarAdicional();\n   187→        $('#contenedor-pruebas').empty();\n   188→        pruebas = respuesta.data;\n   189→        for (let i = 0; i < pruebas.length; i++) {\n   190→            $('#contenedor-pruebas').append(`\n   191→                <div class=\"col-12 col-md-6\">\n   192→                    <div class=\"d-flex align-items-center\">\n   193→                        <div class=\"check-container my-1 me-1\">\n   194→                            <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n   195→                        </div>\n   196→                        <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n   197→                    </div>\n   198→                </div>\n   199→            `);\n   200→        }\n   201→        if (opcion == 'facturar' || opcion == 'editar') {\n   202→            for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n   203→                $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n   204→            }\n   205→            $('#seccion-pruebas').removeClass('d-none');\n   206→            mostrarPlanSeleccionado();\n   207→        }\n   208→        if (opcion == 'editar') {\n   209→            $('#tipo_prueba_id').prop('disabled', true);\n   210→        }\n   211→    }).catch((error) => {\n   212→        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n   213→    });\n   214→}\n   215→/**\n   216→ * Obtener el listado de planes según el tipo_prueba_id seleccionado anteriormente.\n   217→ * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n   218→ * @returns {void}\n   219→ * @author José Manuel Jiménez\n   220→ */\n   221→function modalElegirPlan(tipo_especifico = null) {\n   222→    let tipo_prueba_para_consulta = tipo_especifico !== null ? tipo_especifico : $('#tipo_prueba_id').val();\n   223→    // Si es tipo 2 (Créditos IA), cargar planes de créditos\n   224→    if (tipo_prueba_para_consulta == 2 || tipo_prueba_para_consulta == '2') {\n   225→        $.ajax({\n   226→            type: 'GET',\n   227→            url: '/planes-creditos',\n   228→            data: {\n   229→                activo: true\n   230→            }\n   231→        }).then((respuesta) => {\n   232→            planes_creditos = respuesta.data.planes;\n   233→            mostrarPlanesCreditos();\n   234→        }).catch((error) => {\n   235→            mostrarToast('danger', 'Ocurrió un error');\n   236→        });\n   237→        return;\n   238→    }\n   239→    $.ajax({\n   240→        type: 'GET',\n   241→        url : `/planes-listado`,\n   242→        data: {\n   243→            tipo_prueba_id: $('#tipo_prueba_id').val()\n   244→        }\n   245→    }).then((respuesta) => {\n   246→        planes = respuesta.data;\n   247→        mostrarPlanes();\n   248→    }).catch((error) => {\n   249→        console.error(error);\n   250→    });\n   251→}\n   252→/**\n   253→ * Mostrar los planes de créditos en el modal.\n   254→ * @returns {void}\n   255→ * @author Jair Carvajal\n   256→ */\n   257→function mostrarPlanesCreditos() {\n   258→    let filtro_orden = $('#filtro-plan-credito').val();\n   259→    let buscar = $('#buscador-plan-credito').val() || '';\n   260→    // Ordenar planes según el filtro\n   261→    let planes_ordenados = [...planes_creditos];\n   262→    if (filtro_orden === 'Mayor') {\n   263→        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n   264→    } else if (filtro_orden === 'Menor') {\n   265→        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n   266→    }\n   267→    if (buscar !== '') {\n   268→        planes_ordenados = planes_ordenados.filter(plan =>\n   269→            plan.nombre.toLowerCase().includes(buscar.toLowerCase())\n   270→        );\n   271→    }\n   272→    $('#contenedor-planes-creditos').empty();\n   273→    if (planes_ordenados.length === 0) {\n   274→        $('#contenedor-planes-creditos').append(`\n   275→            <div class=\"text-center py-5\">\n   276→                <p class=\"text-muted\">No se encontraron planes</p>\n   277→            </div>\n   278→        `);\n   279→    }\n   280→    for (let i = 0; i < planes_ordenados.length; i++) {\n   281→        let plan = planes_ordenados[i];\n   282→        let creditos_disponibles = plan.creditos_disponibles || plan.creditos || 0;\n   283→        let creditos_promedio = plan.creditos_promedio_accion || 0;\n   284→        let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n   285→            ? Math.floor(creditos_disponibles / creditos_promedio)\n   286→            : 0;\n   287→        $('#contenedor-planes-creditos').append(`\n   288→            <div class=\"card rounded rounded-3 border-hover pointer mb-3\" onclick=\"elegirPlanCreditos(${i}, ${filtro_orden === 'Mayor' ? 'true' : 'false'});\">\n   289→                <div class=\"row align-items-center m-0 w-100 px-3 py-4\">\n   290→                    <div class=\"col\">\n   291→                        <div class=\"text-headline-6 text-gray-10\">${plan.nombre}</div>\n   292→                    </div>\n   293→                    <div class=\"col-auto\">\n   294→                        ${crearTag({\n   295→                            texto: 'Créditos disponibles: ' + plan.creditos.toLocaleString('es-CO'),\n   296→                            class: 'tag-tonal-yellow',\n   297→                        })}\n   298→                    </div>\n   299→                    <div class=\"col-auto text-primary fw-bold\">\n   300→                        ${crearTag({\n   301→                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n   302→                            class: 'tag-tonal-yellow',\n   303→                        })}\n   304→                    </div>\n   305→                </div>\n   306→            </div>\n   307→        `);\n   308→    }\n   309→    if (typeof $.fn.modal !== 'undefined') {\n   310→        $('#modal-planes-creditos').modal('show');\n   311→    }\n   312→    $('#buscador-plan-credito').off('input').on('input', function() {\n   313→        mostrarPlanesCreditos();\n   314→    });\n   315→}\n   316→/**\n   317→ * Elegir un plan de créditos IA.\n   318→ * @param {number} indice Índice del plan en el array.\n   319→ * @param {boolean} orden_mayor Si está ordenado de mayor a menor.\n   320→ * @returns {void}\n   321→ * @author Jair Carvajal\n   322→ */\n   323→function elegirPlanCreditos(indice, orden_mayor = false) {\n   324→    // Aplicar el mismo ordenamiento que en mostrarPlanesCreditos\n   325→    let planes_ordenados = [...planes_creditos];\n   326→    if (orden_mayor) {\n   327→        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n   328→    } else {\n   329→        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n   330→    }\n   331→    plan_creditos_seleccionado = planes_ordenados[indice];\n   332→    // Establecer los valores en los campos hidden\n   333→    $('#plan_credito_id').val(plan_creditos_seleccionado.id);\n   334→    $('#creditos').val(plan_creditos_seleccionado.creditos);\n   335→    mostrarPlanCreditosSeleccionado();\n   336→    if (typeof $.fn.modal !== 'undefined') {\n   337→        $('#modal-planes-creditos').modal('hide');\n   338→    }\n   339→}\n   340→/**\n   341→ * Mostrar el plan de créditos seleccionado en el contenedor.\n   342→ * @returns {void}\n   343→ * @author Jair Carvajal\n   344→ * @author Andres Gonzalez\n   345→ */\n   346→function mostrarPlanCreditosSeleccionado() {\n   347→    if (!plan_creditos_seleccionado || !plan_creditos_seleccionado.creditos) {\n   348→        mostrarToast('danger', 'Ocurrió un error'+plan_creditos_seleccionado);\n   349→        return;\n   350→    }\n   351→    let creditos_disponibles = plan_creditos_seleccionado.creditos_disponibles || plan_creditos_seleccionado.creditos || 0;\n   352→    let creditos_promedio = plan_creditos_seleccionado.creditos_promedio_accion || 0;\n   353→    let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n   354→        ? Math.floor(creditos_disponibles / creditos_promedio)\n   355→        : 0;\n   356→    let seccion_creditos = `\n   357→        <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n   358→            <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n   359→            <div class=\"card rounded rounded-3\">\n   360→                <div class=\"row align-items-center m-0 w-100 px-3 py-4 pointer\" onclick=\"modalElegirPlan(2);\">\n   361→                    <div class=\"col\">\n   362→                        <div class=\"text-headline-6\">${plan_creditos_seleccionado.nombre || 'Plan de Créditos'}</div>\n   363→                    </div>\n   364→                    <div class=\"col-auto\">\n   365→                        ${crearTag({\n   366→                            texto: 'Créditos disponibles: ' + plan_creditos_seleccionado.creditos.toLocaleString('es-CO'),\n   367→                            class: 'tag-tonal-yellow',\n   368→                        })}\n   369→                    </div>\n   370→                    <div class=\"col-auto text-primary fw-bold\">\n   371→                        ${crearTag({\n   372→                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n   373→                            class: 'tag-tonal-yellow',\n   374→                        })}\n   375→                    </div>\n   376→                </div>\n   377→            </div>\n   378→        </div>\n   379→    `;\n   380→    // Remover el contenedor anterior si existe\n   381→    $('#contenedor-plan-creditos').remove();\n   382→    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n   383→    if ($('#contenedor-creditos').length) {\n   384→        $('#contenedor-creditos').html(seccion_creditos);\n   385→    } else {\n   386→        $('#contenedor-plan').after(seccion_creditos);\n   387→    }\n   388→    // Mostrar campos de precio para plan de créditos\n   389→    $('#contenedor-precio-creditos').removeClass('d-none');\n   390→    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n   391→        $('#precio_creditos').val(plan_creditos_seleccionado.precio).trigger('input');\n   392→    }\n   393→    actualizarValorVentaTotal();\n   394→}\n   395→\n   396→/**\n   397→ * Mostrar en el modal los planes obtenidos en el listado.\n   398→ * \n   399→ * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n   400→ * @returns {void}\n   401→ * @author José Manuel Jiménez\n   402→ * @author Daniel Beltrán\n   403→ */\n   404→function mostrarPlanes() {\n   405→    let buscar = $('#buscador-plan').val();\n   406→    let filtro_plan = $('#filtro-plan').val();\n   407→    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n   408→        table.destroy();\n   409→    }\n   410→    $('#buscador-plan').remove();\n   411→    $('#tbody-planes').empty();\n   412→    for (let i = 0; i < planes.length; i++) {\n   413→        if (\n   414→            (filtro_plan == 'Todos') ||\n   415→            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n   416→            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n   417→            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n   418→        ) {\n   419→            let cantidad_usuarios = '';\n   420→            if (planes[i].cantidad_usuarios != null) {\n   421→                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n   422→            }\n   423→            let cantidad_ofertas_laborales = '';\n   424→            if (planes[i].cantidad_ofertas_laborales != null) {\n   425→                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n   426→            }\n   427→            let cantidad_pruebas = '';\n   428→            if (planes[i].cantidad_pruebas != null) {\n   429→                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;\n   430→            }\n   431→            let unidades = '';\n   432→            if (planes[i].unidades != null) {\n   433→                unidades = `<div class=\"col-auto w-90px\"><i class=\"bi bi-box\"></i> ${planes[i].unidades}</div>`;\n   434→            }\n   435→            let vigencia = '';\n   436→            if (planes[i].vigencia == 90) {\n   437→                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n   438→            } else if (planes[i].vigencia == 180) {\n   439→                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n   440→            }  else if (planes[i].vigencia == 365) {\n   441→                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n   442→            } else if (planes[i].vigencia == null || planes[i].vigencia == 0) {\n   443→                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n   444→            } else {\n   445→                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${planes[i].vigencia} días</div>`;\n   446→            }\n   447→            $('#tbody-planes').append(`\n   448→                <tr>\n   449→                    <td style=\"border-bottom: 0px!important;\">\n   450→                        <div class=\"border border-1 rounded rounded-2 pointer border-hover\" onclick=\"elegirPlan(${i});\">\n   451→                            <div class=\"row m-0 w-100 px-3 py-5 text-headline-6\">\n   452→                                <div class=\"col\">${planes[i].nombre !== null ? planes[i].nombre : ''}</div>\n   453→                                ${cantidad_ofertas_laborales}\n   454→                                ${unidades}\n   455→                                ${cantidad_usuarios}\n   456→                                ${cantidad_pruebas}\n   457→                                ${vigencia}\n   458→                            </div>\n   459→                        </div>\n   460→                    </td>\n   461→                </tr>\n   462→            `);\n   463→        }\n   464→    }\n   465→    // Verificar si Bootstrap modal está disponible antes de usar\n   466→    if (typeof $.fn.modal !== 'undefined') {\n   467→        $('#modal-planes').modal('show');\n   468→    }\n   469→    table = $('#tabla-planes').DataTable({\n   470→        \"paging\": false,\n   471→        \"searching\": true,\n   472→        \"ordering\": false,\n   473→        \"info\": false\n   474→    });\n   475→    let buscador = $('#tabla-planes_wrapper input');\n   476→    $(buscador).addClass('rounded-2 text-body-2');\n   477→    $(buscador).prop('placeholder', 'Buscar');\n   478→    $(buscador).prop('id', 'buscador-plan');\n   479→    $('#input-busqueda').append(buscador);\n   480→    $(buscador).val(buscar).trigger('input');\n   481→}\n   482→/**\n   483→ * Elegir un plan del listado.\n   484→ * @returns {void}\n   485→ * @author José Manuel Jiménez\n   486→ */\n   487→function elegirPlan(i) {\n   488→    plan_seleccionado = planes[i];\n   489→    mostrarPlanSeleccionado();\n   490→}\n   491→/**\n   492→ * Mostrar el plan seleccionado en el contenedor y en las opciones del modificar.\n   493→ * @returns {void}\n   494→ * @author José Manuel Jiménez\n   495→ * @author Daniel Beltrán\n   496→ * @author Andres Gonzalez\n   497→ */\n   498→function mostrarPlanSeleccionado() {\n   499→    let cantidad_usuarios = '';\n   500→    let cantidad_usuarios_modal = $('#cantidad_usuarios_modal').val();\n   501→    if (cantidad_usuarios_modal != '') {\n   502→        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${cantidad_usuarios_modal}</div>`;\n   503→    } else if (plan_seleccionado.cantidad_usuarios != null) {\n   504→        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${plan_seleccionado.cantidad_usuarios}</div>`;\n   505→    }\n   506→    let cantidad_ofertas_laborales = '';\n   507→    let cantidad_ofertas_laborales_modal = $('#cantidad_ofertas_laborales_modal').val();\n   508→    if (cantidad_ofertas_laborales_modal != '') {\n   509→        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${cantidad_ofertas_laborales_modal}</div>`;\n   510→    } else if (plan_seleccionado.cantidad_ofertas_laborales != null) {\n   511→        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${plan_seleccionado.cantidad_ofertas_laborales}</div>`;\n   512→    }\n   513→    let cantidad_pruebas = '';\n   514→    let cantidad_pruebas_modal = $('#cantidad_pruebas_modal').val();\n   515→    if (cantidad_pruebas_modal != '') {\n   516→        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${cantidad_pruebas_modal}</div>`;\n   517→        $('.cantidad-pruebas').text(cantidad_pruebas_modal);\n   518→    } else if (plan_seleccionado.cantidad_pruebas != null) {\n   519→        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${plan_seleccionado.cantidad_pruebas}</div>`;\n   520→        $('.cantidad-pruebas').text(plan_seleccionado.cantidad_pruebas);\n   521→    }\n   522→    let unidades = '';\n   523→    let unidades_modal = $('#unidades_modal').val();\n   524→    if (unidades_modal != '') {\n   525→        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${unidades_modal}</div>`;\n   526→    } else if (plan_seleccionado.unidades != null) {\n   527→        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${plan_seleccionado.unidades}</div>`;\n   528→    }\n   529→    let vigencia = '';\n   530→    let vigencia_modal = $('#vigencia_modal').val();\n   531→    if (plan_seleccionado.vigencia == 90 || vigencia_modal == '90') {\n   532→        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n   533→    } else if (plan_seleccionado.vigencia == 180 || vigencia_modal == '180') {\n   534→        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n   535→    }  else if (plan_seleccionado.vigencia == 365 || vigencia_modal == '365') {\n   536→        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n   537→    } else if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n   538→        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n   539→    } else if (vigencia_modal != '') {\n   540→        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${vigencia_modal} días</div>`;\n   541→    } else {\n   542→        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${plan_seleccionado.vigencia} días</div>`;\n   543→    }\n   544→    let abrir_modal_elegir_plan = '';\n   545→    let icono_editar = `\n   546→        <div class=\"col-auto w-90px\">\n   547→            <button type=\"button\" class=\"btn btn-text-primary text-white btn-circle\" onclick=\"abrirModalModificar(event);\" title=\"Modificar plan\">\n   548→                <i class=\"bi bi-wrench\"></i>\n   549→            </button>\n   550→        </div>\n   551→    `;\n   552→    if (opcion == 'asignar') {\n   553→        abrir_modal_elegir_plan = `onclick=\"modalElegirPlan();\"`;\n   554→        icono_editar = '';\n   555→    }\n   556→    $('#contenedor-plan').empty();\n   557→    $('#contenedor-plan').append(`\n   558→        <div class=\"row border rounded rounded-3 m-0 w-100 px-3 py-5 text-headline-6 pointer\" ${abrir_modal_elegir_plan}>\n   559→            <div class=\"col\">${plan_seleccionado.nombre !== null ? plan_seleccionado.nombre : ''} <span id=\"plan-modificado\"></span></div>\n   560→            ${cantidad_ofertas_laborales}\n   561→            ${unidades}\n   562→            ${cantidad_usuarios}\n   563→            ${cantidad_pruebas}\n   564→            ${vigencia}\n   565→            ${icono_editar}\n   566→        </div>\n   567→    `);\n   568→    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n   569→    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n   570→    // Solo agregar el botón de elegir plan de créditos si no hay uno seleccionado y se requiere\n   571→    if (tiene_creditos && plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n   572→        let seccion_creditos = `\n   573→            <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n   574→                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n   575→                <div class=\"card rounded rounded-3\">\n   576→                    <div class=\"card-body text-center\">\n   577→                        <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n   578→                            Elegir Plan de Créditos IA\n   579→                        </button>\n   580→                    </div>\n   581→                </div>\n   582→            </div>\n   583→        `;\n   584→        $('#contenedor-creditos').append(seccion_creditos);\n   585→    }\n   586→    $('#plan_id').val(plan_seleccionado.id);\n   587→    $('#seccion-pruebas').removeClass('d-none');\n   588→    \n   589→    // Mostrar campos de precio para plan de selección\n   590→    $('#contenedor-precio-plan').removeClass('d-none');\n   591→    $('#precio_plan').val(plan_seleccionado.precio).trigger('input');\n   592→\n   593→    // Verificar si Bootstrap modal está disponible antes de usar\n   594→    if (typeof $.fn.modal !== 'undefined') {\n   595→        $('#modal-planes').modal('hide');\n   596→    }\n   597→    ValidarPruebas();\n   598→    $('#boton-guardar-modificaciones').prop('disabled', true);\n   599→    actualizarValorVentaTotal();\n   600→}\n   601→\n   602→/**\n   603→ * Actualizar el valor de venta total sumando plan de selección y créditos.\n   604→ * \n   605→ * @returns {void}\n   606→ * @author Andres Gonzalez\n   607→ */\n   608→function actualizarValorVentaTotal() {\n   609→    let valor_plan = 0;\n   610→    let valor_creditos = 0;\n   611→\n   612→    if (plan_seleccionado && plan_seleccionado.precio) {\n   613→        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n   614→    }\n   615→\n   616→    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n   617→        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n   618→    }\n   619→\n   620→    let valor_total = valor_plan + valor_creditos;\n   621→\n   622→    // Formatear el valor con separador de miles\n   623→    let valor_formateado = valor_total.toLocaleString('es-CO');\n   624→\n   625→    $('#valor-venta-mostrar').text(valor_formateado);\n   626→}\n   627→\n   628→/**\n   629→ * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n   630→ * \n   631→ * @returns {void}\n   632→ * @author Andres Gonzalez\n   633→ */\n   634→function actualizarValorDesdeInput() {\n   635→    let valor_plan = 0;\n   636→    let valor_creditos = 0;\n   637→\n   638→    let valor_plan_input = $('#precio_plan').val();\n   639→    if (valor_plan_input) {\n   640→        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n   641→    }\n   642→\n   643→    let valor_creditos_input = $('#precio_creditos').val();\n   644→    if (valor_creditos_input) {\n   645→        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n   646→    }\n   647→\n   648→    let valor_total = valor_plan + valor_creditos;\n   649→\n   650→    // Formatear el valor con separador de miles\n   651→    let valor_formateado = valor_total.toLocaleString('es-CO');\n   652→\n   653→    $('#valor-venta-mostrar').text(valor_formateado);\n   654→}\n   655→\n   656→/**\n   657→ * Abrir la factura del plan en una nueva pestaña del navegador.\n   658→ * \n   659→ * @param {number} factura_id Id de la factura.\n   660→ * @returns {void}\n   661→ * @author Andres Morales\n   662→ */\n   663→async function abrirFacturaPlan(factura_id) {\n   664→    if (!factura_id) {\n   665→        mostrarToast('danger', 'No se encontró la factura');\n   666→        return;\n   667→    }\n   668→    try {\n   669→        const respuesta = await $.ajax({\n   670→            type: 'GET',\n   671→            url: `/archivos-abrir/${factura_id}`,\n   672→            xhrFields: { responseType: 'blob' }\n   673→        });\n   674→        const blobUrl = window.URL.createObjectURL(respuesta);\n   675→        window.open(blobUrl, '_blank');\n   676→    } catch (error) {\n   677→        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n   678→    }\n   679→}\n   680→/**\n   681→ * Buscar las funcionalidades por tipo de prueba.\n   682→ * @param {number} tipo_prueba_id ID del tipo de prueba.\n   683→ * @returns {void}\n   684→ * @author José Manuel Jiménez\n   685→ * @author Daniel Beltrán\n   686→ */\n   687→function buscarfuncionalidades(tipo_prueba_id) {\n   688→    $.ajax({\n   689→        type : 'GET',\n   690→        url : `/funcionalidades-listado`,\n   691→        data : {\n   692→            tipo_prueba_id: tipo_prueba_id,\n   693→            incluir_tipo_prueba_null: true\n   694→        },\n   695→        success: function(respuesta) {\n   696→            let beneficios = respuesta.data;\n   697→            const ADICIONALES = beneficios\n   698→                .filter(item => item.predeterminado === 0)\n   699→                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n   700→                .sort((a, b) => b.id - a.id);\n   701→            const PREDEFINIDOS = beneficios\n   702→                .filter(item => item.predeterminado === 1)\n   703→                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n   704→                .sort((a, b) => b.id - a.id);\n   705→            funcionalidades_predefinidos = PREDEFINIDOS;\n   706→            // Verificar si el multiselect está inicializado antes de destruir\n   707→            if ($('#adicionales_modal').data('multiselect')) {\n   708→                $('#adicionales_modal').multiselect('destroy');\n   709→            }\n   710→            if ($('#predefinidos_modal').data('multiselect')) {\n   711→                $('#predefinidos_modal').multiselect('destroy');\n   712→            }\n   713→            ADICIONALES.forEach((item) => {\n   714→                $('#adicionales_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n   715→            });\n   716→            PREDEFINIDOS.forEach((item) => {\n   717→                $('#predefinidos_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n   718→            });\n   719→            inizializarMultiselect();\n   720→            if (opcion == 'facturar' || opcion == 'editar') {\n   721→                buscarfuncionalidadesPlanEmpresa($('#id').val());\n   722→            }\n   723→        },\n   724→        error: function(error) {\n   725→            console.log(error);\n   726→        }\n   727→    });\n   728→}\n   729→/**\n   730→ * Buscar las funcionalidades del plan de la empresa.\n   731→ * @param {number} empresa_plan_id ID del plan de empresa.\n   732→ * @returns {void}\n   733→ * @author José Manuel Jiménez\n   734→ * @author Daniel Beltrán\n   735→ */\n   736→function buscarfuncionalidadesPlanEmpresa(empresa_plan_id) {\n   737→    $.ajax({\n   738→        type : 'GET',\n   739→        url : `/empresas-planes-funcionalidades-listado`,\n   740→        data : {\n   741→            empresa_plan_id: empresa_plan_id,\n   742→            incluir_tipo_prueba_null: true\n   743→        },\n   744→        success: function(respuesta) {\n   745→            let funcionalidades = respuesta.data.map(item => item.funcionalidad_id);\n   746→            $('#adicionales_modal').val(funcionalidades);\n   747→            // Verificar si el multiselect está inicializado antes de refrescar\n   748→            if ($('#adicionales_modal').data('multiselect')) {\n   749→                $('#adicionales_modal').multiselect(\"refresh\");\n   750→            }\n   751→            $('#predefinidos_modal').val(funcionalidades);\n   752→            if ($('#predefinidos_modal').data('multiselect')) {\n   753→                $('#predefinidos_modal').multiselect(\"refresh\");\n   754→            }\n   755→        },\n   756→        error: function(error) {\n   757→            console.log(error);\n   758→        }\n   759→    });\n   760→}\n   761→/**\n   762→ * Función para agregar validaciones adicionales y data adicional en el envío del form.\n   763→ * @returns {void}\n   764→ * @author José Manuel Jiménez\n   765→ */\n   766→function validacionAdicional() {\n   767→    let valido = true;\n   768→    let es_solo_creditos = plan_seleccionado === null && plan_creditos_seleccionado !== null;\n   769→    $('#vigencia').val($('#vigencia_modal').val());\n   770→    if ($('#unidades_modal').val() == 'Ilimitadas') {\n   771→        $('#unidades').val('');\n   772→    } else {\n   773→        $('#unidades').val($('#unidades_modal').val());\n   774→    }\n   775→    if ($('#cantidad_ofertas_laborales_modal').val() == 'Ilimitadas') {\n   776→        $('#cantidad_ofertas_laborales').val('');\n   777→    } else {\n   778→        $('#cantidad_ofertas_laborales').val($('#cantidad_ofertas_laborales_modal').val());\n   779→    }\n   780→    $('#cantidad_usuarios').val($('#cantidad_usuarios_modal').val());\n   781→    $('#cantidad_pruebas').val($('#cantidad_pruebas_modal').val());\n   782→    if (opcion == 'facturar' || opcion == 'editar') {\n   783→        let adicionales = $('#adicionales_modal').val();\n   784→        let predefinidos = $('#predefinidos_modal').val();\n   785→        let funcionalidades = adicionales.concat(predefinidos);\n   786→        $('#funcionalidades').val(JSON.stringify(funcionalidades));\n   787→        if (!es_solo_creditos && funcionalidades.length == 0) {\n   788→            valido = false;\n   789→            mostrarToast('danger', 'Seleccione al menos una funcionalidad.');\n   790→        }\n   791→    } else {\n   792→        let ids = [];\n   793→        if (plan_seleccionado && Array.isArray(plan_seleccionado.funcionalidades)) {\n   794→            ids = plan_seleccionado.funcionalidades.map(objeto => objeto.id);\n   795→        }\n   796→        $('#funcionalidades').val(JSON.stringify(ids));\n   797→    }\n   798→    var pruebas_seleccionadas = $('.pruebas:checked').map(function() {\n   799→        return this.value;\n   800→    }).get();\n   801→    $('#pruebas').val('');\n   802→    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n   803→    if (maximo_pruebas == '') {\n   804→        maximo_pruebas = plan_seleccionado ? plan_seleccionado.cantidad_pruebas : 0;\n   805→    }\n   806→    if (!es_solo_creditos) {\n   807→        if (pruebas_seleccionadas.length == 0) {\n   808→            valido = false;\n   809→            mostrarToast('danger', 'Seleccione al menos una prueba.');\n   810→        } else if (pruebas_seleccionadas.length > maximo_pruebas) {\n   811→            valido = false;\n   812→            mostrarToast('danger', 'Seleccione maximo ' + maximo_pruebas + ' pruebas.');\n   813→        }\n   814→    }\n   815→    if (valido) {\n   816→        $('#pruebas').val(JSON.stringify(pruebas_seleccionadas));\n   817→    }\n   818→    return valido;\n   819→}\n   820→/**\n   821→ * Función para validar que no se exceda al seleccionar limite de pruebas.\n   822→ * @returns {void}\n   823→ * @author José Manuel Jiménez\n   824→ */\n   825→function ValidarPruebas() {\n   826→    let cantidad_seleccionadas = $('.pruebas:checked').length;\n   827→    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n   828→    if (maximo_pruebas == '') {\n   829→        maximo_pruebas = plan_seleccionado.cantidad_pruebas;\n   830→    }\n   831→    if (cantidad_seleccionadas > maximo_pruebas) {\n   832→        $('#alerta-pruebas').removeClass('d-none');\n   833→    } else {\n   834→        $('#alerta-pruebas').addClass('d-none');\n   835→    }\n   836→}\n   837→/**\n   838→ * Abrir el modal con los campos para modificar plan.\n   839→ * @param {Event} evento Evento desencadenado.\n   840→ * @returns {void}\n   841→ * @author José Manuel Jiménez\n   842→ * @author Daniel Beltrán\n   843→ */\n   844→function abrirModalModificar(evento) {\n   845→    evento.stopPropagation();\n   846→    if (modificado == false) {\n   847→        $('#nombre-plan-modal').text(plan_seleccionado.nombre);\n   848→        $('#cantidad_pruebas_modal').empty();\n   849→        $('#cantidad_pruebas_modal').append(`\n   850→            <option value=\"\">Seleccione</option>\n   851→        `);\n   852→        for (let j = 1; j <= pruebas.length; j++) {\n   853→            $('#cantidad_pruebas_modal').append(`\n   854→                <option value=\"${j}\">${j} Pruebas</option>\n   855→            `);\n   856→        }\n   857→        $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n   858→        if ([90, 180, 365].includes(plan_seleccionado.vigencia)) {\n   859→            $('#tiempo_modal').prop('disabled', false);\n   860→            $('#tiempo_modal').val(plan_seleccionado.vigencia).trigger('change').trigger('select2:select');\n   861→            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n   862→        } else if (plan_seleccionado.vigencia != null && plan_seleccionado.vigencia != 0) {\n   863→            $('#tiempo_modal').prop('disabled', false);\n   864→            $('#tiempo_modal').val('personalizado').trigger('change').trigger('select2:select');\n   865→            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n   866→        } else {\n   867→            $('#tiempo_modal').prop('disabled', true);\n   868→            $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n   869→            $('#vigencia_modal').val('');\n   870→        }\n   871→        if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n   872→            $('#unidades_modal').val(plan_seleccionado.unidades);\n   873→            $('#unidades_modal').prop('disabled', false);\n   874→            if (opcion == 'asignar') {\n   875→                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n   876→            } else {\n   877→                $('#cantidad_ofertas_laborales_modal').val(empresa_plan.cantidad_ofertas_laborales);\n   878→            }\n   879→            $('#cantidad_ofertas_laborales_modal').prop('disabled', false);\n   880→        } else {\n   881→            $('#unidades_modal').val(empresa.procesos_estimados_mensuales);\n   882→            $('#unidades_modal').prop('disabled', true);\n   883→            if (opcion == 'facturar' || opcion == 'editar') {\n   884→                $('#unidades_modal').val(plan_seleccionado.unidades);\n   885→                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n   886→            } else {\n   887→                $('#cantidad_ofertas_laborales_modal').val(empresa.pruebas_estimadas_mensuales);\n   888→            }\n   889→            $('#cantidad_ofertas_laborales_modal').prop('disabled', true);\n   890→        }\n   891→        $('#cantidad_usuarios_modal').val(plan_seleccionado.cantidad_usuarios);\n   892→        if (opcion == 'facturar' || opcion == 'editar') {\n   893→            $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n   894→            buscarfuncionalidadesPlanEmpresa($('#id').val());\n   895→        }\n   896→        $('#boton-guardar-modificaciones').prop('disabled', true);\n   897→    }\n   898→    // Verificar si Bootstrap modal está disponible antes de usar\n   899→    if (typeof $.fn.modal !== 'undefined') {\n   900→        $('#modal-modificar-planes').modal('show');\n   901→    }\n   902→}\n   903→/**\n   904→ * Función que habilita el boton de guardar un plan modificado.\n   905→ * @returns {void}\n   906→ * @author José Manuel Jiménez\n   907→ */\n   908→function habilitarBotonGuardar() {\n   909→    $('#boton-guardar-modificaciones').prop('disabled', false);\n   910→}\n   911→/**\n   912→ * Función que controla los campos de vigencia en el modal de editar.\n   913→ * @returns {void}\n   914→ * @author José Manuel Jiménez\n   915→ */\n   916→function seleccionarTiempo(vigencia) {\n   917→    $('.texto-label-tiempo').text('máximas permitidas');\n   918→    $('#input-container-tiempo').removeClass('d-none');\n   919→    $('#input-container-tiempo').addClass('col-md-6');\n   920→    if (vigencia == 'personalizado') {\n   921→        $('#input-container-vigencia').removeClass('d-none');\n   922→        $('#vigencia_modal').val('');\n   923→    } else if ((vigencia == '' || vigencia == null || vigencia == 0) && plan_seleccionado != null && (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0)) {\n   924→        $('.texto-label-tiempo').text('');\n   925→        $('#input-container-tiempo').addClass('d-none');\n   926→        $('#input-container-vigencia').addClass('d-none');\n   927→        $('#vigencia_modal').val('');\n   928→        $('#input-container-tiempo').removeClass('col-md-6');\n   929→    } else if (['90', '180', '365'].includes(vigencia)) {\n   930→        $('#input-container-tiempo').removeClass('col-md-6');\n   931→        $('#input-container-vigencia').addClass('d-none');\n   932→        $('#vigencia_modal').val(vigencia);\n   933→    } else {\n   934→        $('#vigencia_modal').val(vigencia);\n   935→        $('#input-container-vigencia').addClass('d-none');\n   936→        $('#input-container-tiempo').removeClass('col-md-6');\n   937→    }\n   938→}\n   939→/**\n   940→ * Abrir el modal de confirmación.\n   941→ * @returns {void}\n   942→ * @author José Manuel Jiménez\n   943→ * @author Daniel Beltrán\n   944→ */\n   945→function abrirModalEstasSeguro() {\n   946→    // Verificar si Bootstrap modal está disponible antes de usar\n   947→    if (typeof $.fn.modal !== 'undefined') {\n   948→        $('#modal-modificar-planes').modal('hide');\n   949→        $('#modal-estas-seguro').modal('show');\n   950→    }\n   951→}\n   952→/**\n   953→ * Cancelar la edición de un plan.\n   954→ * @returns {void}\n   955→ * @author José Manuel Jiménez\n   956→ * @author Daniel Beltrán\n   957→ */\n   958→function cancelarEdicion() {\n   959→    modificado = false;\n   960→    // Verificar si Bootstrap modal está disponible antes de usar\n   961→    if (typeof $.fn.modal !== 'undefined') {\n   962→        $('#modal-estas-seguro').modal('hide');\n   963→    }\n   964→    limpiarAdicional();\n   965→    mostrarPlanSeleccionado();\n   966→}\n   967→/**\n   968→ * Confirmar los datos editados.\n   969→ * @returns {void}\n   970→ * @author José Manuel Jiménez\n   971→ * @author Daniel Beltrán\n   972→ */\n   973→function confirmarEdicion() {\n   974→    modificado = true;\n   975→    // Verificar si Bootstrap modal está disponible antes de usar\n   976→    if (typeof $.fn.modal !== 'undefined') {\n   977→        $('#modal-estas-seguro').modal('hide');\n   978→    }\n   979→    $('#plan-modificado').text('(modificado)');\n   980→    mostrarPlanSeleccionado();\n   981→}\n   982→/**\n   983→ * Limpiar los campos del modal.\n   984→ * @returns {void}\n   985→ * @author José Manuel Jiménez\n   986→ * @author Daniel Beltrán\n   987→ */\n   988→function limpiarAdicional() {\n   989→    $('#cantidad_pruebas_modal').val('').trigger('change').trigger('select2:select');\n   990→    $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n   991→    $('#unidades_modal').val('');\n   992→    $('#cantidad_ofertas_laborales_modal').val('');\n   993→    $('#cantidad_usuarios_modal').val('');\n   994→    // Verificar si el multiselect está inicializado antes de llamar uncheckAll\n   995→    if ($('#adicionales_modal').data('multiselect')) {\n   996→        $('#adicionales_modal').multiselect(\"uncheckAll\");\n   997→    }\n   998→    if ($('#predefinidos_modal').data('multiselect')) {\n   999→        $('#predefinidos_modal').multiselect(\"uncheckAll\");\n  1000→    }\n  1001→}\n  1002→/**\n  1003→ * Función para ejecutar acciones luego de guardar.\n  1004→ * @returns {void}\n  1005→ * @author José Manuel Jiménez\n  1006→ */\n  1007→function postSuccess(respuesta) {\n  1008→    limpiarFormulario(respuesta.formulario);\n  1009→    if (opcion == 'asignar') {\n  1010→        localStorage.setItem('notificacionToast', JSON.stringify({\n  1011→            tipo_alerta: 'success',\n  1012→            texto_1: `El plan se asignó con éxito a la empresa`,\n  1013→        }));\n  1014→    } else if (opcion == 'facturar') {\n  1015→        localStorage.setItem('notificacionToast', JSON.stringify({\n  1016→            tipo_alerta: 'success',\n  1017→            texto_1: `El plan se facturó con éxito`,\n  1018→        }));\n  1019→    } else if (opcion == 'editar') {\n  1020→        localStorage.setItem('notificacionToast', JSON.stringify({\n  1021→            tipo_alerta: 'success',\n  1022→            texto_1: `El plan se actualizó con éxito`,\n  1023→        }));\n  1024→    }\n  1025→    window.location.href='/empresas-gestionar/' + empresa.id;\n  1026→}\n  1027→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"d3eecb9e-2dc9-44d3-8917-e7d319d59711","timestamp":"2026-01-26T13:03:56.960Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","content":"table = null;\nplanes = [];\npruebas = [];\nmodificado = false;\nfuncionalidades_predefinidos = [];\nplan_creditos_seleccionado = null;\n\n$(document).ready(function() {\n    $(document).on('input', '#precio_plan, #precio_creditos', function() {\n        actualizarValorDesdeInput();\n    });\n});\n\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales\n */\nfunction seleccionarTipoPrueba(tipo_prueba_id) {\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"card-body text-center\">\n            <button type=\"button\" id=\"elegir-plan\" class=\"btn btn-outline-primary\" disabled onclick=\"modalElegirPlan();\">Elegir plan</button>\n        </div>\n    `);\n    $('#seccion-pruebas').addClass('d-none');\n    $('#plan_id').val('');\n    pruebas = [];\n    // Convertir tipo_prueba_id a array si no lo es\n    let tipos_prueba = Array.isArray(tipo_prueba_id) ? tipo_prueba_id : [tipo_prueba_id];\n    // Crear los botones según los tipos de prueba seleccionados\n    let botones_html = '<div class=\"card-body text-center\">';\n    tipos_prueba.forEach(function(tipo_id) {\n        let texto_boton = 'Elegir plan';\n        let clase_boton = 'btn-outline-primary';\n        if (tipo_id == 1) {\n            texto_boton = 'Elegir Plan de Selección';\n            clase_boton = 'btn-outline-primary';\n        } else if (tipo_id == 2) {\n            texto_boton = 'Elegir Plan de Créditos IA';\n            clase_boton = 'btn-outline-info';\n        }\n        botones_html += `\n            <button type=\"button\" id=\"elegir-plan-${tipo_id}\" class=\"btn ${clase_boton} mx-1 my-1\" disabled onclick=\"modalElegirPlan(${tipo_id});\">\n                ${texto_boton}\n            </button>\n        `;\n    });\n    botones_html += '</div>';\n    $('#contenedor-plan').append(botones_html);\n    $('#tipo_prueba_id').val(tipo_prueba_id).trigger('select2');\n    if (tipo_prueba_id && (Array.isArray(tipo_prueba_id) ? tipo_prueba_id.length > 0 : tipo_prueba_id)) {\n        // Habilitar todos los botones creados\n        tipos_prueba.forEach(function(tipo_id) {\n            $(`#elegir-plan-${tipo_id}`).prop('disabled', false);\n        });\n        $.ajax({\n            type: 'GET',\n            url : `/pruebas-listado`,\n            data: {\n                tipo_prueba_id: tipo_prueba_id,\n                activo: 1\n            }\n        }).then((respuesta) => {\n            limpiarAdicional();\n            $('#contenedor-pruebas').empty();\n            pruebas = respuesta.data;\n            for (let i = 0; i < pruebas.length; i++) {\n                $('#contenedor-pruebas').append(`\n                    <div class=\"col-12 col-md-6\">\n                        <div class=\"d-flex align-items-center\">\n                            <div class=\"check-container my-1 me-1\">\n                                <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                            </div>\n                            <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                        </div>\n                    </div>\n                `);\n            }\n            if (opcion == 'facturar' || opcion == 'editar') {\n                for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                    $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n                }\n                $('#seccion-pruebas').removeClass('d-none');\n                mostrarPlanSeleccionado();\n            }\n            if (opcion == 'editar') {\n                $('#tipo_prueba_id').prop('disabled', true);\n            }\n        }).catch((error) => {\n            console.error(error);\n        });\n    } else {\n        $('#elegir-plan').prop('disabled', true);\n    }\n}\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction seleccionarTipoPruebaMultiple() {\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    tipos_prueba = tipos_prueba.filter(function(tipo_id) {\n        return tipo_id !== null && tipo_id !== '' && tipo_id !== undefined;\n    });\n    if (tipos_prueba.length === 0) {\n        // Si no hay tipos seleccionados, limpiar todo\n        $('#contenedor-plan').empty();\n        $('#contenedor-creditos').empty();\n        $('#seccion-pruebas').addClass('d-none');\n        $('#plan_id').val('');\n        $('#plan_id').prop('required', false);\n        $('#plan_id').prop('disabled', true);\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n        plan_seleccionado = null;\n        plan_creditos_seleccionado = null;\n        pruebas = [];\n        return;\n    }\n    let tiene_seleccion = tipos_prueba.includes('1') || tipos_prueba.includes(1);\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    $('#plan_id').prop('required', tiene_seleccion);\n    $('#plan_id').prop('disabled', !tiene_seleccion);\n    // Manejo del plan de selección\n    if (tiene_seleccion) {\n        // Si hay un plan seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_seleccionado === null && $('#contenedor-plan').children().length === 0) {\n            let seccion_seleccion = `\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Selección</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-1\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(1);\">\n                            Elegir Plan de Selección\n                        </button>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-plan').html(seccion_seleccion);\n        }\n    } else {\n        // Si se deseleccionó el tipo de selección, limpiar el plan\n        $('#contenedor-plan').empty();\n        plan_seleccionado = null;\n        $('#plan_id').val('');\n    }\n    // Manejo del plan de créditos\n    if (tiene_creditos) {\n        // Si hay un plan de créditos seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n            let seccion_creditos = `\n                <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                    <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                    <div class=\"card rounded rounded-3\">\n                        <div class=\"card-body text-center\">\n                            <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                                Elegir Plan de Créditos IA\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-creditos').html(seccion_creditos);\n        }\n    } else {\n        // Si se deseleccionó el tipo de créditos, limpiar el plan de créditos\n        $('#contenedor-creditos').empty();\n        $('#contenedor-plan-creditos').remove();\n        plan_creditos_seleccionado = null;\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/pruebas-listado`,\n        data: {\n            tipo_prueba_id: tipos_prueba,\n            activo: 1\n        }\n    }).then((respuesta) => {\n        limpiarAdicional();\n        $('#contenedor-pruebas').empty();\n        pruebas = respuesta.data;\n        for (let i = 0; i < pruebas.length; i++) {\n            $('#contenedor-pruebas').append(`\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"d-flex align-items-center\">\n                        <div class=\"check-container my-1 me-1\">\n                            <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                        </div>\n                        <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                    </div>\n                </div>\n            `);\n        }\n        if (opcion == 'facturar' || opcion == 'editar') {\n            for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n            }\n            $('#seccion-pruebas').removeClass('d-none');\n            mostrarPlanSeleccionado();\n        }\n        if (opcion == 'editar') {\n            $('#tipo_prueba_id').prop('disabled', true);\n        }\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    });\n}\n/**\n * Obtener el listado de planes según el tipo_prueba_id seleccionado anteriormente.\n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalElegirPlan(tipo_especifico = null) {\n    let tipo_prueba_para_consulta = tipo_especifico !== null ? tipo_especifico : $('#tipo_prueba_id').val();\n    // Si es tipo 2 (Créditos IA), cargar planes de créditos\n    if (tipo_prueba_para_consulta == 2 || tipo_prueba_para_consulta == '2') {\n        $.ajax({\n            type: 'GET',\n            url: '/planes-creditos',\n            data: {\n                activo: true\n            }\n        }).then((respuesta) => {\n            planes_creditos = respuesta.data.planes;\n            mostrarPlanesCreditos();\n        }).catch((error) => {\n            mostrarToast('danger', 'Ocurrió un error');\n        });\n        return;\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/planes-listado`,\n        data: {\n            tipo_prueba_id: $('#tipo_prueba_id').val()\n        }\n    }).then((respuesta) => {\n        planes = respuesta.data;\n        mostrarPlanes();\n    }).catch((error) => {\n        console.error(error);\n    });\n}\n/**\n * Mostrar los planes de créditos en el modal.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction mostrarPlanesCreditos() {\n    let filtro_orden = $('#filtro-plan-credito').val();\n    let buscar = $('#buscador-plan-credito').val() || '';\n    // Ordenar planes según el filtro\n    let planes_ordenados = [...planes_creditos];\n    if (filtro_orden === 'Mayor') {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else if (filtro_orden === 'Menor') {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    if (buscar !== '') {\n        planes_ordenados = planes_ordenados.filter(plan =>\n            plan.nombre.toLowerCase().includes(buscar.toLowerCase())\n        );\n    }\n    $('#contenedor-planes-creditos').empty();\n    if (planes_ordenados.length === 0) {\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"text-center py-5\">\n                <p class=\"text-muted\">No se encontraron planes</p>\n            </div>\n        `);\n    }\n    for (let i = 0; i < planes_ordenados.length; i++) {\n        let plan = planes_ordenados[i];\n        let creditos_disponibles = plan.creditos_disponibles || plan.creditos || 0;\n        let creditos_promedio = plan.creditos_promedio_accion || 0;\n        let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n            ? Math.floor(creditos_disponibles / creditos_promedio)\n            : 0;\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"card rounded rounded-3 border-hover pointer mb-3\" onclick=\"elegirPlanCreditos(${i}, ${filtro_orden === 'Mayor' ? 'true' : 'false'});\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6 text-gray-10\">${plan.nombre}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        `);\n    }\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('show');\n    }\n    $('#buscador-plan-credito').off('input').on('input', function() {\n        mostrarPlanesCreditos();\n    });\n}\n/**\n * Elegir un plan de créditos IA.\n * @param {number} indice Índice del plan en el array.\n * @param {boolean} orden_mayor Si está ordenado de mayor a menor.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction elegirPlanCreditos(indice, orden_mayor = false) {\n    // Aplicar el mismo ordenamiento que en mostrarPlanesCreditos\n    let planes_ordenados = [...planes_creditos];\n    if (orden_mayor) {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    plan_creditos_seleccionado = planes_ordenados[indice];\n    // Establecer los valores en los campos hidden\n    $('#plan_credito_id').val(plan_creditos_seleccionado.id);\n    $('#creditos').val(plan_creditos_seleccionado.creditos);\n    mostrarPlanCreditosSeleccionado();\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('hide');\n    }\n}\n/**\n * Mostrar el plan de créditos seleccionado en el contenedor.\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarPlanCreditosSeleccionado() {\n    if (!plan_creditos_seleccionado || !plan_creditos_seleccionado.creditos) {\n        mostrarToast('danger', 'Ocurrió un error'+plan_creditos_seleccionado);\n        return;\n    }\n    let creditos_disponibles = plan_creditos_seleccionado.creditos_disponibles || plan_creditos_seleccionado.creditos || 0;\n    let creditos_promedio = plan_creditos_seleccionado.creditos_promedio_accion || 0;\n    let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n        ? Math.floor(creditos_disponibles / creditos_promedio)\n        : 0;\n    let seccion_creditos = `\n        <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n            <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n            <div class=\"card rounded rounded-3\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4 pointer\" onclick=\"modalElegirPlan(2);\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6\">${plan_creditos_seleccionado.nombre || 'Plan de Créditos'}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan_creditos_seleccionado.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    // Remover el contenedor anterior si existe\n    $('#contenedor-plan-creditos').remove();\n    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n    if ($('#contenedor-creditos').length) {\n        $('#contenedor-creditos').html(seccion_creditos);\n    } else {\n        $('#contenedor-plan').after(seccion_creditos);\n    }\n    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        $('#precio_creditos').val(plan_creditos_seleccionado.precio).trigger('input');\n    }\n    actualizarValorVentaTotal();\n}\n\n/**\n * Mostrar en el modal los planes obtenidos en el listado.\n * \n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPlanes() {\n    let buscar = $('#buscador-plan').val();\n    let filtro_plan = $('#filtro-plan').val();\n    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n        table.destroy();\n    }\n    $('#buscador-plan').remove();\n    $('#tbody-planes').empty();\n    for (let i = 0; i < planes.length; i++) {\n        if (\n            (filtro_plan == 'Todos') ||\n            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n        ) {\n            let cantidad_usuarios = '';\n            if (planes[i].cantidad_usuarios != null) {\n                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n            }\n            let cantidad_ofertas_laborales = '';\n            if (planes[i].cantidad_ofertas_laborales != null) {\n                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n            }\n            let cantidad_pruebas = '';\n            if (planes[i].cantidad_pruebas != null) {\n                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;\n            }\n            let unidades = '';\n            if (planes[i].unidades != null) {\n                unidades = `<div class=\"col-auto w-90px\"><i class=\"bi bi-box\"></i> ${planes[i].unidades}</div>`;\n            }\n            let vigencia = '';\n            if (planes[i].vigencia == 90) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n            } else if (planes[i].vigencia == 180) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n            }  else if (planes[i].vigencia == 365) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n            } else if (planes[i].vigencia == null || planes[i].vigencia == 0) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n            } else {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${planes[i].vigencia} días</div>`;\n            }\n            $('#tbody-planes').append(`\n                <tr>\n                    <td style=\"border-bottom: 0px!important;\">\n                        <div class=\"border border-1 rounded rounded-2 pointer border-hover\" onclick=\"elegirPlan(${i});\">\n                            <div class=\"row m-0 w-100 px-3 py-5 text-headline-6\">\n                                <div class=\"col\">${planes[i].nombre !== null ? planes[i].nombre : ''}</div>\n                                ${cantidad_ofertas_laborales}\n                                ${unidades}\n                                ${cantidad_usuarios}\n                                ${cantidad_pruebas}\n                                ${vigencia}\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            `);\n        }\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('show');\n    }\n    table = $('#tabla-planes').DataTable({\n        \"paging\": false,\n        \"searching\": true,\n        \"ordering\": false,\n        \"info\": false\n    });\n    let buscador = $('#tabla-planes_wrapper input');\n    $(buscador).addClass('rounded-2 text-body-2');\n    $(buscador).prop('placeholder', 'Buscar');\n    $(buscador).prop('id', 'buscador-plan');\n    $('#input-busqueda').append(buscador);\n    $(buscador).val(buscar).trigger('input');\n}\n/**\n * Elegir un plan del listado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction elegirPlan(i) {\n    plan_seleccionado = planes[i];\n    mostrarPlanSeleccionado();\n}\n/**\n * Mostrar el plan seleccionado en el contenedor y en las opciones del modificar.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction mostrarPlanSeleccionado() {\n    let cantidad_usuarios = '';\n    let cantidad_usuarios_modal = $('#cantidad_usuarios_modal').val();\n    if (cantidad_usuarios_modal != '') {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${cantidad_usuarios_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_usuarios != null) {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${plan_seleccionado.cantidad_usuarios}</div>`;\n    }\n    let cantidad_ofertas_laborales = '';\n    let cantidad_ofertas_laborales_modal = $('#cantidad_ofertas_laborales_modal').val();\n    if (cantidad_ofertas_laborales_modal != '') {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${cantidad_ofertas_laborales_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_ofertas_laborales != null) {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${plan_seleccionado.cantidad_ofertas_laborales}</div>`;\n    }\n    let cantidad_pruebas = '';\n    let cantidad_pruebas_modal = $('#cantidad_pruebas_modal').val();\n    if (cantidad_pruebas_modal != '') {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${cantidad_pruebas_modal}</div>`;\n        $('.cantidad-pruebas').text(cantidad_pruebas_modal);\n    } else if (plan_seleccionado.cantidad_pruebas != null) {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${plan_seleccionado.cantidad_pruebas}</div>`;\n        $('.cantidad-pruebas').text(plan_seleccionado.cantidad_pruebas);\n    }\n    let unidades = '';\n    let unidades_modal = $('#unidades_modal').val();\n    if (unidades_modal != '') {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${unidades_modal}</div>`;\n    } else if (plan_seleccionado.unidades != null) {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${plan_seleccionado.unidades}</div>`;\n    }\n    let vigencia = '';\n    let vigencia_modal = $('#vigencia_modal').val();\n    if (plan_seleccionado.vigencia == 90 || vigencia_modal == '90') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n    } else if (plan_seleccionado.vigencia == 180 || vigencia_modal == '180') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n    }  else if (plan_seleccionado.vigencia == 365 || vigencia_modal == '365') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n    } else if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n    } else if (vigencia_modal != '') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${vigencia_modal} días</div>`;\n    } else {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${plan_seleccionado.vigencia} días</div>`;\n    }\n    let abrir_modal_elegir_plan = '';\n    let icono_editar = `\n        <div class=\"col-auto w-90px\">\n            <button type=\"button\" class=\"btn btn-text-primary text-white btn-circle\" onclick=\"abrirModalModificar(event);\" title=\"Modificar plan\">\n                <i class=\"bi bi-wrench\"></i>\n            </button>\n        </div>\n    `;\n    if (opcion == 'asignar') {\n        abrir_modal_elegir_plan = `onclick=\"modalElegirPlan();\"`;\n        icono_editar = '';\n    }\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"row border rounded rounded-3 m-0 w-100 px-3 py-5 text-headline-6 pointer\" ${abrir_modal_elegir_plan}>\n            <div class=\"col\">${plan_seleccionado.nombre !== null ? plan_seleccionado.nombre : ''} <span id=\"plan-modificado\"></span></div>\n            ${cantidad_ofertas_laborales}\n            ${unidades}\n            ${cantidad_usuarios}\n            ${cantidad_pruebas}\n            ${vigencia}\n            ${icono_editar}\n        </div>\n    `);\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    // Solo agregar el botón de elegir plan de créditos si no hay uno seleccionado y se requiere\n    if (tiene_creditos && plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n        let seccion_creditos = `\n            <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                            Elegir Plan de Créditos IA\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n        $('#contenedor-creditos').append(seccion_creditos);\n    }\n    $('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n    \n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    $('#precio_plan').val(plan_seleccionado.precio).trigger('input');\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}\n\n/**\n * Actualizar el valor de venta total sumando plan de selección y créditos.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorVentaTotal() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n    }\n\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    let valor_plan_input = $('#precio_plan').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Abrir la factura del plan en una nueva pestaña del navegador.\n * \n * @param {number} factura_id Id de la factura.\n * @returns {void}\n * @author Andres Morales\n */\nasync function abrirFacturaPlan(factura_id) {\n    if (!factura_id) {\n        mostrarToast('danger', 'No se encontró la factura');\n        return;\n    }\n    try {\n        const respuesta = await $.ajax({\n            type: 'GET',\n            url: `/archivos-abrir/${factura_id}`,\n            xhrFields: { responseType: 'blob' }\n        });\n        const blobUrl = window.URL.createObjectURL(respuesta);\n        window.open(blobUrl, '_blank');\n    } catch (error) {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    }\n}\n/**\n * Buscar las funcionalidades por tipo de prueba.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidades(tipo_prueba_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/funcionalidades-listado`,\n        data : {\n            tipo_prueba_id: tipo_prueba_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let beneficios = respuesta.data;\n            const ADICIONALES = beneficios\n                .filter(item => item.predeterminado === 0)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            const PREDEFINIDOS = beneficios\n                .filter(item => item.predeterminado === 1)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            funcionalidades_predefinidos = PREDEFINIDOS;\n            // Verificar si el multiselect está inicializado antes de destruir\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect('destroy');\n            }\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect('destroy');\n            }\n            ADICIONALES.forEach((item) => {\n                $('#adicionales_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            PREDEFINIDOS.forEach((item) => {\n                $('#predefinidos_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            inizializarMultiselect();\n            if (opcion == 'facturar' || opcion == 'editar') {\n                buscarfuncionalidadesPlanEmpresa($('#id').val());\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Buscar las funcionalidades del plan de la empresa.\n * @param {number} empresa_plan_id ID del plan de empresa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidadesPlanEmpresa(empresa_plan_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/empresas-planes-funcionalidades-listado`,\n        data : {\n            empresa_plan_id: empresa_plan_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let funcionalidades = respuesta.data.map(item => item.funcionalidad_id);\n            $('#adicionales_modal').val(funcionalidades);\n            // Verificar si el multiselect está inicializado antes de refrescar\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect(\"refresh\");\n            }\n            $('#predefinidos_modal').val(funcionalidades);\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect(\"refresh\");\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Función para agregar validaciones adicionales y data adicional en el envío del form.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction validacionAdicional() {\n    let valido = true;\n    let es_solo_creditos = plan_seleccionado === null && plan_creditos_seleccionado !== null;\n    $('#vigencia').val($('#vigencia_modal').val());\n    if ($('#unidades_modal').val() == 'Ilimitadas') {\n        $('#unidades').val('');\n    } else {\n        $('#unidades').val($('#unidades_modal').val());\n    }\n    if ($('#cantidad_ofertas_laborales_modal').val() == 'Ilimitadas') {\n        $('#cantidad_ofertas_laborales').val('');\n    } else {\n        $('#cantidad_ofertas_laborales').val($('#cantidad_ofertas_laborales_modal').val());\n    }\n    $('#cantidad_usuarios').val($('#cantidad_usuarios_modal').val());\n    $('#cantidad_pruebas').val($('#cantidad_pruebas_modal').val());\n    if (opcion == 'facturar' || opcion == 'editar') {\n        let adicionales = $('#adicionales_modal').val();\n        let predefinidos = $('#predefinidos_modal').val();\n        let funcionalidades = adicionales.concat(predefinidos);\n        $('#funcionalidades').val(JSON.stringify(funcionalidades));\n        if (!es_solo_creditos && funcionalidades.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una funcionalidad.');\n        }\n    } else {\n        let ids = [];\n        if (plan_seleccionado && Array.isArray(plan_seleccionado.funcionalidades)) {\n            ids = plan_seleccionado.funcionalidades.map(objeto => objeto.id);\n        }\n        $('#funcionalidades').val(JSON.stringify(ids));\n    }\n    var pruebas_seleccionadas = $('.pruebas:checked').map(function() {\n        return this.value;\n    }).get();\n    $('#pruebas').val('');\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado ? plan_seleccionado.cantidad_pruebas : 0;\n    }\n    if (!es_solo_creditos) {\n        if (pruebas_seleccionadas.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una prueba.');\n        } else if (pruebas_seleccionadas.length > maximo_pruebas) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione maximo ' + maximo_pruebas + ' pruebas.');\n        }\n    }\n    if (valido) {\n        $('#pruebas').val(JSON.stringify(pruebas_seleccionadas));\n    }\n    return valido;\n}\n/**\n * Función para validar que no se exceda al seleccionar limite de pruebas.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction ValidarPruebas() {\n    let cantidad_seleccionadas = $('.pruebas:checked').length;\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado.cantidad_pruebas;\n    }\n    if (cantidad_seleccionadas > maximo_pruebas) {\n        $('#alerta-pruebas').removeClass('d-none');\n    } else {\n        $('#alerta-pruebas').addClass('d-none');\n    }\n}\n/**\n * Abrir el modal con los campos para modificar plan.\n * @param {Event} evento Evento desencadenado.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalModificar(evento) {\n    evento.stopPropagation();\n    if (modificado == false) {\n        $('#nombre-plan-modal').text(plan_seleccionado.nombre);\n        $('#cantidad_pruebas_modal').empty();\n        $('#cantidad_pruebas_modal').append(`\n            <option value=\"\">Seleccione</option>\n        `);\n        for (let j = 1; j <= pruebas.length; j++) {\n            $('#cantidad_pruebas_modal').append(`\n                <option value=\"${j}\">${j} Pruebas</option>\n            `);\n        }\n        $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n        if ([90, 180, 365].includes(plan_seleccionado.vigencia)) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val(plan_seleccionado.vigencia).trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else if (plan_seleccionado.vigencia != null && plan_seleccionado.vigencia != 0) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val('personalizado').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else {\n            $('#tiempo_modal').prop('disabled', true);\n            $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val('');\n        }\n        if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n            $('#unidades_modal').val(plan_seleccionado.unidades);\n            $('#unidades_modal').prop('disabled', false);\n            if (opcion == 'asignar') {\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa_plan.cantidad_ofertas_laborales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', false);\n        } else {\n            $('#unidades_modal').val(empresa.procesos_estimados_mensuales);\n            $('#unidades_modal').prop('disabled', true);\n            if (opcion == 'facturar' || opcion == 'editar') {\n                $('#unidades_modal').val(plan_seleccionado.unidades);\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa.pruebas_estimadas_mensuales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', true);\n        }\n        $('#cantidad_usuarios_modal').val(plan_seleccionado.cantidad_usuarios);\n        if (opcion == 'facturar' || opcion == 'editar') {\n            $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n            buscarfuncionalidadesPlanEmpresa($('#id').val());\n        }\n        $('#boton-guardar-modificaciones').prop('disabled', true);\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('show');\n    }\n}\n/**\n * Función que habilita el boton de guardar un plan modificado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction habilitarBotonGuardar() {\n    $('#boton-guardar-modificaciones').prop('disabled', false);\n}\n/**\n * Función que controla los campos de vigencia en el modal de editar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarTiempo(vigencia) {\n    $('.texto-label-tiempo').text('máximas permitidas');\n    $('#input-container-tiempo').removeClass('d-none');\n    $('#input-container-tiempo').addClass('col-md-6');\n    if (vigencia == 'personalizado') {\n        $('#input-container-vigencia').removeClass('d-none');\n        $('#vigencia_modal').val('');\n    } else if ((vigencia == '' || vigencia == null || vigencia == 0) && plan_seleccionado != null && (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0)) {\n        $('.texto-label-tiempo').text('');\n        $('#input-container-tiempo').addClass('d-none');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val('');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    } else if (['90', '180', '365'].includes(vigencia)) {\n        $('#input-container-tiempo').removeClass('col-md-6');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val(vigencia);\n    } else {\n        $('#vigencia_modal').val(vigencia);\n        $('#input-container-vigencia').addClass('d-none');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    }\n}\n/**\n * Abrir el modal de confirmación.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalEstasSeguro() {\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('hide');\n        $('#modal-estas-seguro').modal('show');\n    }\n}\n/**\n * Cancelar la edición de un plan.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction cancelarEdicion() {\n    modificado = false;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    limpiarAdicional();\n    mostrarPlanSeleccionado();\n}\n/**\n * Confirmar los datos editados.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction confirmarEdicion() {\n    modificado = true;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    $('#plan-modificado').text('(modificado)');\n    mostrarPlanSeleccionado();\n}\n/**\n * Limpiar los campos del modal.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction limpiarAdicional() {\n    $('#cantidad_pruebas_modal').val('').trigger('change').trigger('select2:select');\n    $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n    $('#unidades_modal').val('');\n    $('#cantidad_ofertas_laborales_modal').val('');\n    $('#cantidad_usuarios_modal').val('');\n    // Verificar si el multiselect está inicializado antes de llamar uncheckAll\n    if ($('#adicionales_modal').data('multiselect')) {\n        $('#adicionales_modal').multiselect(\"uncheckAll\");\n    }\n    if ($('#predefinidos_modal').data('multiselect')) {\n        $('#predefinidos_modal').multiselect(\"uncheckAll\");\n    }\n}\n/**\n * Función para ejecutar acciones luego de guardar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction postSuccess(respuesta) {\n    limpiarFormulario(respuesta.formulario);\n    if (opcion == 'asignar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se asignó con éxito a la empresa`,\n        }));\n    } else if (opcion == 'facturar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se facturó con éxito`,\n        }));\n    } else if (opcion == 'editar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se actualizó con éxito`,\n        }));\n    }\n    window.location.href='/empresas-gestionar/' + empresa.id;\n}\n","numLines":1027,"startLine":1,"totalLines":1027}},"sourceToolAssistantUUID":"0abeccc8-391c-41c7-8e6d-56d86f426ccb"}
{"parentUuid":"d3eecb9e-2dc9-44d3-8917-e7d319d59711","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_019WjUf12rtaQJdpGXRdb9nR","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que analice el archivo Blade junto con su JavaScript. Ahora tengo ambos archivos leídos. Voy a proporcionar un análisis detallado.","signature":"Er8CCkYICxgCKkDZ8sfafbymBdtJfDOfJCkpJQLZOaxFd1uT2WweLHIiWPR/7KMQWtcZrnYMjrMV+QqyPQoi/5wX/Okv9lAL0dlAEgz8o8WTq1dlr8i/OqoaDA5SkcYnplC5KtPFRiIw85aUirXhMQhHufqSuUno0XBlHQB8ZxzCUKJuYxx3yqmMUCbVU6LJdSVNQTyKH0p4KqYB5uEJXWXsf7RWUqux0vOt4px2KssppnKIETXRuM+VGhytOJWuzEds4C+P9o4xg5r9rsSUZ1A5S7KSDnFwWsBd9nEGsfK7ZgHVQuQUD1S8/mou+SAL2wN7VCfyoY9Icr1M0eG2DRwFtQ/ncdp7udO369HTStQvDfJkEp5sx6f9sbY+31rNqcXbKECDLr8rSLqX4Z6g2HROLbAmAEdN7Q1609yA8UNfUBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":16888,"cache_read_input_tokens":35739,"cache_creation":{"ephemeral_5m_input_tokens":16888,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW34Lr8p11MHQ7Atz62w","type":"assistant","uuid":"c329877e-c2c1-4a6b-95b2-513d510f62ef","timestamp":"2026-01-26T13:04:00.054Z"}
{"parentUuid":"c329877e-c2c1-4a6b-95b2-513d510f62ef","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_019WjUf12rtaQJdpGXRdb9nR","type":"message","role":"assistant","content":[{"type":"text","text":"## Análisis de [asignar-plan.blade.php](resources/views/empresas/paginas/asignar-plan.blade.php) y [asignar-plan.js](public/js/empresas/asignar-plan.js)\n\n### Resumen General\n\nEsta vista permite **asignar, facturar o editar planes** para empresas. Soporta dos tipos de planes:\n1. **Planes de Selección** (pruebas psicométricas)\n2. **Planes de Créditos IA** (funcionalidades de inteligencia artificial)\n\n---\n\n### Estructura del Archivo Blade\n\n| Sección | Descripción |\n|---------|-------------|\n| **Líneas 1-23** | Encabezado dinámico según `$opcion` (asignar/facturar/editar) |\n| **Líneas 25-59** | Formulario principal con campos hidden y selector de tipo de plan (multiselect) |\n| **Líneas 60-96** | Contenedores dinámicos para planes y sección de pruebas |\n| **Líneas 98-158** | Campos de precio y descuento para ambos tipos de plan |\n| **Líneas 160-231** | Sección de facturación (número factura, archivo, comentario, valor total) |\n| **Líneas 251-509** | Modales: elegir plan, modificar plan, confirmación, planes de créditos |\n| **Líneas 513-615** | Scripts con inicialización según `$opcion` |\n\n---\n\n### Variables Globales JavaScript\n\n```javascript\ntable = null;           // DataTable de planes\nplanes = [];            // Lista de planes de selección\npruebas = [];           // Lista de pruebas disponibles\nmodificado = false;     // Flag de modificación de plan\nfuncionalidades_predefinidos = [];  // Funcionalidades predefinidas\nplan_creditos_seleccionado = null;  // Plan de créditos elegido\n```\n\n---\n\n### Funciones Principales del JS\n\n| Función | Línea | Descripción |\n|---------|-------|-------------|\n| `seleccionarTipoPruebaMultiple()` | 106-214 | Maneja la selección múltiple de tipos de plan |\n| `modalElegirPlan(tipo)` | 221-251 | Abre modal según tipo (selección o créditos) |\n| `mostrarPlanes()` | 404-481 | Renderiza lista de planes en DataTable |\n| `mostrarPlanesCreditos()` | 257-315 | Renderiza planes de créditos con filtro |\n| `elegirPlan(i)` | 487-490 | Selecciona un plan de la lista |\n| `elegirPlanCreditos(indice)` | 323-339 | Selecciona un plan de créditos |\n| `mostrarPlanSeleccionado()` | 498-600 | Muestra el plan elegido en el formulario |\n| `mostrarPlanCreditosSeleccionado()` | 346-394 | Muestra el plan de créditos elegido |\n| `actualizarValorVentaTotal()` | 608-626 | Calcula y muestra la suma de ambos planes |\n| `actualizarValorDesdeInput()` | 634-654 | Actualiza valor cuando se editan inputs manualmente |\n| `validacionAdicional()` | 766-819 | Validaciones antes de enviar el formulario |\n| `abrirModalModificar()` | 844-902 | Abre modal para personalizar plan |\n\n---\n\n### Flujo de Datos\n\n```\n1. Usuario selecciona tipo(s) de plan → seleccionarTipoPruebaMultiple()\n                ↓\n2. Clic en \"Elegir Plan\" → modalElegirPlan(tipo)\n                ↓\n3. AJAX a /planes-listado o /planes-creditos\n                ↓\n4. Selección del plan → elegirPlan() o elegirPlanCreditos()\n                ↓\n5. Mostrar resumen → mostrarPlanSeleccionado() / mostrarPlanCreditosSeleccionado()\n                ↓\n6. Actualizar total → actualizarValorVentaTotal()\n                ↓\n7. Submit → validacionAdicional() → postSuccess()\n```\n\n---\n\n### Componentes UI Utilizados\n\n- `crearMultiselect()` - Selector de tipo de plan\n- `crearInput()` - Campos de texto/número (precio, factura, etc.)\n- `crearSelect2()` - Selectores con búsqueda\n- `crearTextarea()` - Comentarios\n- `crearInputFile()` - Carga de factura PDF\n- `crearBoton()` - Botones de acción\n- `crearModal()` - 4 modales (planes, modificar, confirmación, créditos)\n- `crearAlerta()` - Alerta de límite de pruebas\n- `crearTag()` - Tags de información en planes\n\n---\n\n### Sección Seleccionada (Líneas 225-231)\n\n```blade\n@if ($opcion == 'asignar')\n    <div class=\"row mt-3\">\n        <div class=\"col-12 mt-5 mb-4\">\n            <h4 class=\"text-headline-4\"><strong>Valor de venta: <span id=\"valor-venta-mostrar\">0</span></strong></h4>\n        </div>\n    </div>\n@endif\n```\n\nEsta sección muestra el **valor total de venta** solo cuando se está asignando un nuevo plan. El span `#valor-venta-mostrar` se actualiza dinámicamente mediante:\n- `actualizarValorVentaTotal()` (línea 608) - Suma precios de plan_seleccionado y plan_creditos_seleccionado\n- `actualizarValorDesdeInput()` (línea 634) - Se dispara con el evento `input` en los campos de precio\n\n---\n\n### Observaciones\n\n1. **Buena práctica**: El código usa variables en español (snake_case) conforme a las convenciones del proyecto\n2. **Modularidad**: Separación clara entre lógica de planes de selección y créditos\n3. **UX**: Actualización en tiempo real del valor total al modificar precios\n4. **Posible mejora**: La función `mostrarPlanCreditosSeleccionado()` (línea 348) tiene un error en el mensaje de toast que concatena el objeto directamente: `'Ocurrió un error'+plan_creditos_seleccionado`"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":16888,"cache_read_input_tokens":35739,"cache_creation":{"ephemeral_5m_input_tokens":16888,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW34Lr8p11MHQ7Atz62w","type":"assistant","uuid":"af4e16a9-1293-4407-a56a-6da28892811c","timestamp":"2026-01-26T13:04:27.044Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-26T13:09:51.252Z","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287"}
{"type":"file-history-snapshot","messageId":"fa4c0a9d-6561-4e6f-9b25-b4737971b00b","snapshot":{"messageId":"fa4c0a9d-6561-4e6f-9b25-b4737971b00b","trackedFileBackups":{},"timestamp":"2026-01-26T13:09:51.458Z"},"isSnapshotUpdate":false}
{"parentUuid":"9b86449b-dd40-4c7d-8e8b-68ef97b923e0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01McU78Q6xquANkxigH4aFms","parentToolUseID":"toolu_01McU78Q6xquANkxigH4aFms","uuid":"5750f64f-f9a7-4828-b092-b250b96cf0bb","timestamp":"2026-01-26T13:03:42.910Z"}
{"parentUuid":"0abeccc8-391c-41c7-8e6d-56d86f426ccb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01MMpUvtLK2kmcXaj2BV37HF","parentToolUseID":"toolu_01MMpUvtLK2kmcXaj2BV37HF","uuid":"5baa2dc1-0f25-4426-b09c-3a42b4ba941f","timestamp":"2026-01-26T13:03:53.993Z"}
{"parentUuid":"af4e16a9-1293-4407-a56a-6da28892811c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 126 to 157 from c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php:\n<div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos',\n                                name: 'precio_creditos',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"mira este esa seccion <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos',\n                                name: 'precio_creditos',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div> para en de credito y el moal en doinde se coloca un porcentage de descuento esntonces toca ambiar ese conmpprtamiento apenas se escriba un por centage de desciento el campo del valor se tine que colocar disable y el valor de ese campo tiene que disminuir al porcentage colocado pero penas se gurde si se tiene que enviar el vlaor horiginal y solo la reccuion del valor sea viasula"}]},"uuid":"fa4c0a9d-6561-4e6f-9b25-b4737971b00b","timestamp":"2026-01-26T13:09:51.455Z","permissionMode":"default"}
{"parentUuid":"fa4c0a9d-6561-4e6f-9b25-b4737971b00b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_016PQiXicKpVyFTuUwzjeYoF","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere modificar el comportamiento del campo de porcentaje de descuento para los créditos. El requerimiento es:\n\n1. Cuando se escriba un porcentaje de descuento, el campo \"Valor de venta\" (`precio_creditos`) debe:\n   - Deshabilitarse (disabled)\n   - Mostrar visualmente el valor con el descuento aplicado\n\n2. Pero al guardar:\n   - Se debe enviar el valor original (sin descuento)\n   - La reducción del valor solo debe ser visual\n\nEsto significa que necesito:\n1. Guardar el valor original del precio en una variable o campo hidden\n2. Cuando se cambie el porcentaje de descuento, calcular el nuevo valor y mostrarlo\n3. Deshabilitar el campo de precio para que no se pueda editar manualmente\n4. Al enviar el formulario, asegurar que se envíe el valor original\n\nVoy a revisar el código JS para ver cómo implementar esto correctamente.","signature":"EuoHCkYICxgCKkA2jvzPoEfH2SPQ/V6LiJ5Vmv2nuu87zQlYSOM+v4Jyb+PuAKQrDQmyt3dJlVljdxhrx4DVSCvSnItz76Bxnh9jEgzlGysLoCasK4UZkgUaDP1jVfcHnhyY0K6VKCIwNE8mGm8+bc8/3qxuwSCYnFUa/C90iEzxyushfOLFADMS0L43yPXS30lcRpA/MMaSKtEGWYpEYVxXZCUA1ljSrFdUBjMjFnMfu9uig0EgFDcpO7y/rDI+FPJOz23XPCa2+OAVhqUUpf4O1ov5p23nBUVZy6Xse/1Zt//oMtD8lsAfRYF4apDbIIevq1RiPXdfwCBMnONF/Q4JKxBBy5HfczL09Oqe/UFiL8FFnd3uKfQ/9qZP+aVd7CO3tk7lGQbDZ1bQR9VlT2qY+QV/QyRlCyf+SfDHCvukPp0AwmxqKV9dow8aaX1j9tysFCkypo0XbEYu0vu1muQmYQjt8Y+SL3ZPSD/8LuAJLXTQhKpweiUUDka/suV/nrI1Csu4WpR6KNIzKSwvKvTNbRjyo2bGXrqKQ/B2hPZMVxAUaJquuww0QwbnJSbwTnjkss+YMSo6AKZoNuM2+stmIZcIgev+Ga85nZGdxcr+YDHTScxboNJ3mPiO780Z3u5nvFNcvhRqe/ZKFOOR7n15yqDlm5C7X1WwZ7aJgz2B0xDHXcWtCHCWDlznxhQ5gTZ0HeJD0L96IizjhveR4YPmUeYL1+F7F/fKvWKXFuosVAmIb0AuET7Dsz4Y1H06rtFPry5Jsnmyyd/aukINAbqcFBOlUbW583XGFPiegs+7fCJRs+1+nJIYOkdOuhRD2yrAen0z8os0sEZ+Df/7u3JGxAWLPq7kH8YY0u13jJi1jiLhmHu0FV0x9VTfR6ptkAUdgbFmtYVNDlqFxVSwK4CDiBTPUumd7+dsUvX6sph9CoQg4skwKep6xPXGkemzGRSkmqw1yoZmJWQEb6xP+VCFN8wIVBsPJ/fuwzEjRkDda6LCzKMXBg8XSjjUqlJHt+wSniNWO3rguP9yuIq6AiCIgaXow6gJ2Wsd95jiG2AaSamhrnWrT5HUTcSTbC7Rzw+35c9NSWRc1NQfy+zuWMtRNnYNYxhHmaH6so14187JnrxLSixKd1YIxcerMN89aiz8W88ZIvsySpgYeEvdyaLQUaAdOvXe7upivgI9vKZLAFgPOTqYXi6nDKBYY+SILJ3eHabsbG/M7ApEvrwA4QpJ9xNZ9AlNxjEW1jst6KxkVX4pFGgeJio8x++zU9+m+det9szoIKlIeCwZ8/JWOVeNH/1FQPSuZayAdKsUIn2FFUjAWB3/VvvlApI5GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":55275,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":55275,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW3WW4k5kLeoC2DSGcyr","type":"assistant","uuid":"9e71587f-00d5-4b10-8b0f-019190588e41","timestamp":"2026-01-26T13:09:58.492Z"}
{"parentUuid":"9e71587f-00d5-4b10-8b0f-019190588e41","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_016PQiXicKpVyFTuUwzjeYoF","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo. Necesitas que:\n\n1. Al escribir un porcentaje de descuento → el campo \"Valor de venta\" se deshabilite y muestre el valor con descuento aplicado (visual)\n2. Al guardar → se envíe el valor **original** (sin descuento)\n\nVoy a implementar esto para la sección de créditos."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":55275,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":55275,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW3WW4k5kLeoC2DSGcyr","type":"assistant","uuid":"9aa472c4-26f9-4b9d-9eff-0570be3821d1","timestamp":"2026-01-26T13:09:59.981Z"}
{"parentUuid":"9aa472c4-26f9-4b9d-9eff-0570be3821d1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_016PQiXicKpVyFTuUwzjeYoF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Q1F6yFs5Q6NJvwmwZQUVWQ","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","old_string":"<div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos',\n                                name: 'precio_creditos',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>","new_string":"<div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <input type=\"hidden\" id=\"precio_creditos_original\" name=\"precio_creditos\" value=\"\">\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                min: 0,\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional',\n                                onkeyup: 'aplicarDescuentoCreditos();',\n                                onchange: 'aplicarDescuentoCreditos();'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos_visual',\n                                name: 'precio_creditos_visual',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":55275,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":55275,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW3WW4k5kLeoC2DSGcyr","type":"assistant","uuid":"de31b9e0-375c-48cb-b85f-bef581af4393","timestamp":"2026-01-26T13:10:06.729Z"}
{"type":"file-history-snapshot","messageId":"de31b9e0-375c-48cb-b85f-bef581af4393","snapshot":{"messageId":"fa4c0a9d-6561-4e6f-9b25-b4737971b00b","trackedFileBackups":{"resources\\views\\empresas\\paginas\\asignar-plan.blade.php":{"backupFileName":"23a0b404d58f48f6@v1","version":1,"backupTime":"2026-01-26T13:10:30.604Z"}},"timestamp":"2026-01-26T13:09:51.458Z"},"isSnapshotUpdate":true}
{"parentUuid":"de31b9e0-375c-48cb-b85f-bef581af4393","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Q1F6yFs5Q6NJvwmwZQUVWQ","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   122→                    })}\n   123→                </div>\n   124→            </div>\n   125→            \n   126→            <div class=\"row mt-3\">\n   127→                <div class=\"col-12\">\n   128→                    <div id=\"contenedor-creditos\">\n   129→                    </div>\n   130→                    <input type=\"hidden\" id=\"precio_creditos_original\" name=\"precio_creditos\" value=\"\">\n   131→                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n   132→                        <div class=\"col-6\">\n   133→                            ${crearInput({\n   134→                                id: 'porcentaje_descuento_creditos',\n   135→                                name: 'porcentaje_descuento_creditos',\n   136→                                type: 'number',\n   137→                                autocomplete: 'off',\n   138→                                min: 0,\n   139→                                max: 100,\n   140→                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n   141→                                label: 'Porcentaje de descuento',\n   142→                                label_class: 'optional',\n   143→                                onkeyup: 'aplicarDescuentoCreditos();',\n   144→                                onchange: 'aplicarDescuentoCreditos();'\n   145→                            })}\n   146→                        </div>\n   147→                        <div class=\"col-6\">\n   148→                            ${crearInput({\n   149→                                id: 'precio_creditos_visual',\n   150→                                name: 'precio_creditos_visual',\n   151→                                class: 'cleave',\n   152→                                autocomplete: 'off',\n   153→                                minlength: 3,\n   154→                                maxlength: 12,\n   155→                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n   156→                                required: true,\n   157→                                label: 'Valor de venta'\n   158→                            })}\n   159→                        </div>\n   160→                    </div>\n   161→                </div>\n   162→            </div>\n   163→\n   164→            <div class=\"row mt-7\">\n   165→                <div class=\"col-12 mt-5 mb-4\">"}]},"uuid":"e2eebba2-145e-4304-bd11-9fc98ede93cc","timestamp":"2026-01-26T13:10:30.631Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","oldString":"<div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos',\n                                name: 'precio_creditos',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>","newString":"<div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <input type=\"hidden\" id=\"precio_creditos_original\" name=\"precio_creditos\" value=\"\">\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                min: 0,\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional',\n                                onkeyup: 'aplicarDescuentoCreditos();',\n                                onchange: 'aplicarDescuentoCreditos();'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos_visual',\n                                name: 'precio_creditos_visual',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>","originalFile":"@extends('layouts.app')\n@php\n    $titulo_pagina = isset($empresa_id) ? 'Asignar plan' : 'Facturar';\n@endphp\n@section('titulo', $titulo_pagina)\n\n@section('estilos')\n    <link href=\"{{ asset('css/empresas/empresas.css') }}\" rel=\"stylesheet\">\n@endsection\n\n@section('contenido')\n    <div class=\"container-fluid mt-4\">\n        <div class=\"text-headline-6 mb-0\">\n            <i class=\"bi bi-chevron-left h4 mb-0 text-primary me-5 pointer\" onclick=\"window.history.back();\"></i>\n            @if ($opcion == 'asignar')\n                Asignar plan\n            @elseif ($opcion == 'facturar')\n                Facturar plan\n            @elseif ($opcion == 'editar')\n                Editar asignación de plan\n            @endif\n        </div>\n    </div>\n    <div class=\"container mt-8\">\n        <form id=\"formulario\" enctype=\"multipart/form-data\">\n            @csrf\n            @isset ($empresa_id)\n                <input type=\"hidden\" id=\"empresa_id\" name=\"empresa_id\" value=\"{{ $empresa_id }}\">\n            @endisset\n            @isset ($empresa_plan)\n                <input type=\"hidden\" id=\"id\" name=\"id\" class=\"input-dinamico\" value=\"{{ $empresa_plan->id }}\">\n            @endisset\n            <input type=\"hidden\" id=\"pruebas\" name=\"pruebas\" value=\"\">\n            <input type=\"hidden\" id=\"vigencia\" name=\"vigencia\">\n            <input type=\"hidden\" id=\"unidades\" name=\"unidades\">\n            <input type=\"hidden\" id=\"cantidad_ofertas_laborales\" name=\"cantidad_ofertas_laborales\">\n            <input type=\"hidden\" id=\"cantidad_usuarios\" name=\"cantidad_usuarios\">\n            <input type=\"hidden\" id=\"cantidad_pruebas\" name=\"cantidad_pruebas\">\n            <input type=\"hidden\" id=\"plan_credito_id\" name=\"plan_credito_id\" value=\"\">\n            <input type=\"hidden\" id=\"creditos\" name=\"creditos\" value=\"\">\n            <input type=\"hidden\" id=\"funcionalidades\" name=\"funcionalidades\" value=\"\">\n            <div class=\"row mt-6\">\n                <div class=\"col-12\">\n                    ${crearMultiselect({\n                        opciones: [\n                            { nombre: 'Planes de selección', id: '1' },\n                            { nombre: 'Planes de créditos (IA)', id: '2' }\n                        ],\n                        id: 'tipo_prueba_id',\n                        name: 'tipo_prueba_id',\n                        class: 'clase-personalizada',\n                        onchange: 'seleccionarTipoPruebaMultiple();',\n                        placeholder: 'Tipo de plan',\n                        icono: '<i class=\"bi bi-check-circle input-icono1\"></i>',\n                        label: 'Tipo de plan',\n                        disabled: {{ $opcion != 'asignar' ? 'true' : 'false' }}\n                    })}\n                </div>\n            </div>\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-plan\">\n                    </div>\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'plan_id',\n                        name: 'plan_id',\n                        adicional: 'style=\"width: 0px; height: 0px;\"',\n                        class: 'p-0 border-0',\n                        required: true,\n                        input_container_class: 'mb-0'\n                    })}\n                </div>\n            </div>\n\n            <div class=\"row mt-7 d-none\" id=\"seccion-pruebas\">\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4 mb-5\">Pruebas</h4>\n                    <span class=\"text-body-2\">Selecciona las <span class=\"cantidad-pruebas\"></span> prueba(s) que vas a asignar a esta empresa.</span>\n                </div>\n                <div class=\"col-12 col-lg-6\">\n                    <div class=\"row\" id=\"contenedor-pruebas\">\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-5 d-none\" id=\"alerta-pruebas\">\n                <div class=\"col-12\">\n                    ${crearAlerta(\n                        'warning',\n                        'Recuerda que solo tienes <span class=\"cantidad-pruebas\">{{ $empresa_plan->cantidad_pruebas ?? ''}}</span> prueba(s) disponibles.',\n                        'w-100 mb-0'\n                    )}\n                </div>\n            </div>\n\n            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan',\n                        name: 'precio',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>\n            \n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos',\n                                name: 'precio_creditos',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-7\">\n                <div class=\"col-12 mt-5 mb-4\">\n                    <h4 class=\"text-headline-4\">Valor</h4>\n                    <span class=\"text-body-2\">Revisa el precio final y adjunta la factura.</span>\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'numero_factura',\n                        name: 'numero_factura',\n                        type: 'text',\n                        autocomplete: 'off',\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->numero_factura : '' }}',\n                        required: true,\n                        label: 'Número de factura o concepto'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    @if ($opcion == 'editar' && isset($empresa_plan['archivos'][0]))\n                        <div class=\"card h-auto border-secondary\">\n                            <div class=\"card-body p-2 rounded-4\">\n                                ${crearBoton({\n                                    url: '#',\n                                    clases: 'w-100 d-flex justify-content-between pointer bg-transparent border-0 p-0',\n                                    texto: `\n                                        <div class=\"px-4 text-cta-blue text-decoration-none\">\n                                            {{$empresa_plan['archivos'][0]['nombre']}}\n                                        </div>\n                                        <div class=\"px-4\">\n                                            <i class=\"bi bi-eye-fill text-cta-blue\"></i>\n                                        </div>\n                                    `,\n                                    onclick: `abrirFacturaPlan('{{$empresa_plan['archivos'][0]['id']}}')`\n                                })}\n                            </div>\n                        </div>\n                    @else\n                        ${crearInputFile({\n                            id: 'factura',\n                            name: 'factura',\n                            class: 'input-form',\n                            placeholder: '',\n                            required: false,\n                            accept: 'application/pdf',\n                        })}\n                    @endif\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    ${crearTextarea({\n                        id: 'comentario',\n                        name: 'comentario',\n                        maxlength: 255,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->comentario : '' }}',\n                        label: 'Comentario o detalle de uso',\n                        label_class: 'optional'\n                    })}\n                </div>\n            </div>\n\n            @if ($opcion == 'asignar')\n                <div class=\"row mt-3\">\n                    <div class=\"col-12 mt-5 mb-4\">\n                        <h4 class=\"text-headline-4\"><strong>Valor de venta: <span id=\"valor-venta-mostrar\">0</span></strong></h4>\n                    </div>\n                </div>\n            @endif\n\n            <div class=\"row mt-3 pb-4\">\n                <div class=\"col-12 text-center\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'btn-outline-primary me-2 px-14 text-blue-40',\n                        texto: 'Cancelar',\n                        url: `/empresas-gestionar/{{ isset($empresa_id) ? $empresa_id : '' }}`\n                    })}\n                    ${crearBoton({\n                        id: `boton-asignar`,\n                        type: `submit`,\n                        clases: `btn-primary px-12`,\n                        texto: `@if ($opcion == \"asignar\") Asignar plan @elseif ($opcion == \"facturar\") Guardar @elseif ($opcion == \"editar\") Guardar @endif`\n                    })}\n                </div>\n            </div>\n        </form>\n    </div>\n@section('modals')\n    ${crearModal({\n        id: 'modal-planes',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir plan',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda\">\n                            <i class=\"bi bi-search\"></i>\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan',\n                            name: 'filtro-plan',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanes();',\n                            opciones: [\n                                { nombre: 'Todos', id: 'Todos' },\n                                { nombre: 'Por vacantes', id: 'Ofertas' },\n                                { nombre: 'Por unidades', id: 'Unidades' },\n                                { nombre: 'Por tiempo', id: 'Tiempo' }\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                    <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                        <thead class=\"d-none\">\n                            <tr>\n                                <th></th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tbody-planes\">\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-modificar-planes',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-modificar-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: 'Modificar plan - <span id=\"nombre-plan-modal\">{{ isset($empresa_plan) && $empresa_plan->plan ? \" \" . $empresa_plan->plan->nombre : (isset($empresa_plan) && $empresa_plan->planCredito ? \" \" . $empresa_plan->planCredito->nombre : \"\") }}</span>',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">Personaliza tu plan para esta empresa.</span>\n            </div>\n            <div class=\"row m-0 w-100\">\n                <div class=\"col-12\" id=\"input-container-pruebas\">\n                    ${crearSelect2({\n                        id: 'cantidad_pruebas_modal',\n                        name: 'cantidad_pruebas_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar();',\n                        opciones: [\n                            { nombre: '', id: '' },\n                            @if (isset($empresa_plan))\n                                @for ($i = 1; $i <= 8; $i++)\n                                    { nombre: '{{ $i }} Pruebas', id: '{{ $i }}', selected: {{ $empresa_plan->cantidad_pruebas == $i ? 'true' : 'false' }} },\n                                @endfor\n                            @endif\n                        ],\n                        label: 'Pruebas disponibles'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\" id=\"input-container-tiempo\">\n                    ${crearSelect2({\n                        id: 'tiempo_modal',\n                        name: 'tiempo_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar(); seleccionarTiempo(this.value);',\n                        opciones: [\n                            { nombre: 'Seleccione', id: '' },\n                            { nombre: '3 Meses', id: '90', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 90 ? 'true' : 'false' }} },\n                            { nombre: '6 Meses', id: '180', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 180 ? 'true' : 'false' }} },\n                            { nombre: '1 Año', id: '365', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 365 ? 'true' : 'false' }} },\n                            { nombre: 'Personalizado', id: 'personalizado' }\n                        ],\n                        label: 'Tiempo'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6 d-none\" id=\"input-container-vigencia\">\n                    ${crearInput({\n                        id: 'vigencia_modal',\n                        name: 'vigencia_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Días'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'unidades_modal',\n                        name: 'unidades_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->unidades : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Unidades <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'cantidad_ofertas_laborales_modal',\n                        name: 'cantidad_ofertas_laborales_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_ofertas_laborales : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Vacantes <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4\">Beneficios</h4>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"adicionales_modal\" name=\"adicionales_modal[]\" data-placeholder=\"Adicionales\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"predefinidos_modal\" name=\"predefinidos_modal[]\" data-placeholder=\"Predefinidos\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    ${crearInput({\n                        id: 'cantidad_usuarios_modal',\n                        name: 'cantidad_usuarios_modal',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_usuarios : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Usuarios'\n                    })}\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"alert badge-estado-renovado fw-bold\">\n                        Recuerda que no es posible cambiar entre planes con cantidades fijas a ilimitados o viceversa.\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row m-0 w-100\">\n                        ${crearBoton({\n                            type: 'button',\n                            clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                            texto: 'Cancelar',\n                            onclick: 'cancelarEdicion();',\n                            adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                        })}\n                        ${crearBoton({\n                            id: 'boton-guardar-modificaciones',\n                            type: 'button',\n                            clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                            texto: 'Guardar modificaciones',\n                            onclick: 'abrirModalEstasSeguro();',\n                            disabled: true\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                    <thead class=\"d-none\">\n                        <tr>\n                            <th></th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"tbody-planes\">\n                    </tbody>\n                </table>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-estas-seguro',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-estas-seguroLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: '¿Estás seguro?',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">\n                    se modificará el plan actual para la empresa, ten en cuenta que la información de consumo puede variar entre este plan modificado y los que no lo están pero tienen el mismo nombre.\n                    <br>\n                    <br>\n                    Personaliza tu plan para esta empresa.\n                </span>\n            </div>\n            <div class=\"col-12 px-4 mb-4 mt-3\">\n                <div class=\"row m-0 w-100\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                        texto: 'Cancelar',\n                        onclick: 'cancelarEdicion();',\n                        adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                    })}\n                    ${crearBoton({\n                        id: 'boton-estoy-seguro',\n                        type: 'button',\n                        clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                        texto: 'Si, estoy seguro',\n                        onclick: 'confirmarEdicion();'\n                    })}\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-planes-creditos',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planes-creditosLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir Plan de Créditos IA',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100 mb-3\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda-credito\">\n                            <i class=\"bi bi-search\"></i>\n                            <input type=\"text\" id=\"buscador-plan-credito\" class=\"rounded-2 text-body-2\" placeholder=\"Buscar\">\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan-credito',\n                            name: 'filtro-plan-credito',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanesCreditos();',\n                            opciones: [\n                                { nombre: 'Mayor a menor', id: 'Mayor' },\n                                { nombre: 'Menor a mayor', id: 'Menor' },\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div id=\"contenedor-planes-creditos\">\n                    <!-- Los planes se cargarán dinámicamente aquí -->\n                </div>\n            </div>\n        `\n    })}\n@endsection\n@endsection\n\n@section('scripts')\n    <script src=\"{{ asset('js/empresas/asignar-plan.js') }}\" type=\"text/javascript\"></script>\n    <script type=\"text/javascript\">\n        @if ($opcion == 'asignar')\n            opcion = 'asignar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            plan_seleccionado = null;\n        @elseif ($opcion == 'facturar')\n            opcion = 'facturar';\n            empresa = @json($empresa);\n            resource_url = '/facturar-plan';\n            empresa_plan = @json($empresa_plan);\n            plan_seleccionado = @json($empresa_plan->plan);\n            plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n            plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n            plan_seleccionado.unidades = empresa_plan.unidades\n            plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n            plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n            plan_seleccionado.precio = empresa_plan.precio;\n            pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n            @endif\n\n            // Determinar los tipos de prueba a seleccionar\n            let tipos_a_seleccionar_facturar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                tipos_a_seleccionar_facturar.push('2');\n            @endif\n\n            // Establecer los tipos de prueba en el select\n            $('#tipo_prueba_id').val(tipos_a_seleccionar_facturar).trigger('change');\n\n            seleccionarTipoPruebaMultiple();\n            buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n\n            // Esperar a que el DOM esté listo para establecer valores\n            $(document).ready(function() {\n                @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    // Dar tiempo para que se cargue seleccionarTipoPruebaMultiple() y sus AJAX\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 1000);\n                @endif\n            });\n        @elseif ($opcion == 'editar')\n            opcion = 'editar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            empresa_plan = @json($empresa_plan);\n\n            // Obtener el tipo de edición desde la URL\n            let tipo_edicion = '{{ request()->get(\"tipo\", \"seleccion\") }}';\n\n            @if(request()->get('tipo') == 'creditos' && isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                // Editar plan de créditos\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n                plan_creditos_seleccionado.creditos = empresa_plan.creditos;\n                plan_seleccionado = null;\n                pruebas_empresa_plan = []; \n                $('#seccion-pruebas').hide();\n\n                // Establecer tipo 2 (créditos) en el select\n                $('#tipo_prueba_id').val(['2']).trigger('change');\n\n                $(document).ready(function() {\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 500);\n                });\n            @else\n                // Editar plan de selección\n                plan_seleccionado = @json($empresa_plan->plan);\n                plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n                plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n                plan_seleccionado.unidades = empresa_plan.unidades\n                plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n                plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n                plan_seleccionado.precio = empresa_plan.precio;\n                pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n                // Establecer tipo de selección en el select\n                let tipos_a_seleccionar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n                $('#tipo_prueba_id').val(tipos_a_seleccionar).trigger('change');\n\n                seleccionarTipoPruebaMultiple();\n                buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n            @endif\n        @endif\n    </script>\n@endsection\n","structuredPatch":[{"oldStart":127,"oldLines":6,"newStart":127,"newLines":7,"lines":["                 <div class=\"col-12\">","                     <div id=\"contenedor-creditos\">","                     </div>","+                    <input type=\"hidden\" id=\"precio_creditos_original\" name=\"precio_creditos\" value=\"\">","                     <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">","                         <div class=\"col-6\">","                             ${crearInput({"]},{"oldStart":134,"oldLines":16,"newStart":135,"newLines":19,"lines":["                                 name: 'porcentaje_descuento_creditos',","                                 type: 'number',","                                 autocomplete: 'off',","+                                min: 0,","                                 max: 100,","                                 value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',","                                 label: 'Porcentaje de descuento',","-                                label_class: 'optional'","+                                label_class: 'optional',","+                                onkeyup: 'aplicarDescuentoCreditos();',","+                                onchange: 'aplicarDescuentoCreditos();'","                             })}","                         </div>","                         <div class=\"col-6\">","                             ${crearInput({","-                                id: 'precio_creditos',","-                                name: 'precio_creditos',","+                                id: 'precio_creditos_visual',","+                                name: 'precio_creditos_visual',","                                 class: 'cleave',","                                 autocomplete: 'off',","                                 minlength: 3,"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"de31b9e0-375c-48cb-b85f-bef581af4393"}
{"parentUuid":"e2eebba2-145e-4304-bd11-9fc98ede93cc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TAAZmjgvsRxkWYhd8Um9fM","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora necesito agregar la función `aplicarDescuentoCreditos()` en el archivo JavaScript y también modificar las funciones existentes para que trabajen con el nuevo campo hidden y el campo visual.\n\nDebo:\n1. Agregar la función `aplicarDescuentoCreditos()` que:\n   - Tome el valor original del precio\n   - Calcule el descuento\n   - Muestre el valor con descuento en el campo visual\n   - Deshabilite el campo visual si hay descuento\n   - Guarde el valor original en el campo hidden\n\n2. Modificar `mostrarPlanCreditosSeleccionado()` para que guarde el precio original en el campo hidden\n\n3. Modificar `actualizarValorDesdeInput()` para que use el valor visual para la visualización pero el original para el envío\n\n4. Modificar `actualizarValorVentaTotal()` si es necesario\n\nVoy a agregar la función al final del archivo JS y modificar las funciones relacionadas.","signature":"EoIICkYICxgCKkAH8uNLVrpYTawlX6oLv9gR9dof+54umZSIhI28bD6aV8ryojul7IUoM0ifE5x1L2u7GN3J5uOTy8tZkpyP0dBaEgwq9k7i/5Cx+90RerIaDEgzbJkHUYLh5I7U3iIwh24+e9RYxkQ2T9NyPfO17TPl67QtOXGGjAJXk61RKNdI6DVLwxAOcRMSVItucJXaKukGB9pQruAc9WiOnot+hgJD+OH8m6AEeE/2i88BuqLy1nywfI+EYP0V+o7vkUAxUHmjqopL0RWo5uH+G/33f4DaKyYYFU+HtoHvfmgizAiAvDHL8HyR5xO+733VxKcyElzPhw1thVnMg93UCT9wPUdvW9OGCN/oMx3qD22diIoGYrD4YFnyBWs+gDdolqkcscUYDlucq1lVQ+j7c+kNdDVw8hXdB6RqqGuqOa3jqnhhwG/SvTqWQq6x3mIvlX/ZaR4tVxXApQOVn+EwsDMdOFsUkRJJ7gTq6AOC5BlzcDNKmuSfzH09E121AhfvkUT9F4GhsCWL10386WmeKJDrji8JMblwPGwK975IStLe2YYJqI/X1GTd1CxZnuyKndrGMV2M8rqGHMRU1tIavulwThQOz3eDVEIPTRYThLeDYZr72jqo04fppDuLYww2Yo7TbpZZTD0ubd8rLf0D08RQTei+M9wEtt/jUCsnhuDLxUdOAEOFWr+HU1tridLI6Yhih0ZFwNo0UMh9crjU1QW5/FzhZTGvTxKaXx76kluQzRMq7UiygIU1JByQOohoUx279P4YT9HBDilRIOp7LD9fOEjaiQOehLcMnPPjVcfkr0cWFsOl6218EVXjfHV/mBRnlSzYYryqLrPa9E3o93dD4KFIuq1lXc8mFlSHikh9MZLxXM6B0z/SKUUiDkAVmxSHuz9Kn1h8TxODBeqLJQKhjftVCGUjsxOLTK/6VshUcYLiCwmaRwgDyaLn7UPmO+t+YWvJCAbk+hYD1576SURmZ4AnPk3FGThZ36ZMBP8C1cPvfxOb3qI0ApZ4QLdewunqs+48LJhPrgc3uvvqhan8WHWkhHd26BFppxCSPrHZGMIMRvEytdYtzH0cu7PMLpFtRpGK+7ulXQKfdPnwXbBZvYwlT7jT5oC3kmdw8NK5z9yg0ry4JhflJKiGZ12I6vGe+x27i+v3OvkhCxVXl3qzM8fJXY5PF+jcobDm+Hr7ze5qeXZBiqwlbZxL287S93+68T9Wfj9CpQslG4+gx5exCyhzLnW1o5f6UPmj7NqcyrbLaa2cdJsbyA+SlbJIDhBPBHH5wa9hDBn5t1rsxtibIi4HRl/C7fyl9YreyWdflQe4TzHStIYOV/X08yV8oRNzCbtNuH+jRCVvZAFeGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1976,"cache_read_input_tokens":55275,"cache_creation":{"ephemeral_5m_input_tokens":1976,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3ZV4JroZZDSQTS2EsL","type":"assistant","uuid":"ce448705-063a-45fa-8468-86771848eeb9","timestamp":"2026-01-26T13:10:37.604Z"}
{"parentUuid":"ce448705-063a-45fa-8468-86771848eeb9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TAAZmjgvsRxkWYhd8Um9fM","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora necesito agregar la función `aplicarDescuentoCreditos()` en el archivo JavaScript y modificar las funciones relacionadas."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1976,"cache_read_input_tokens":55275,"cache_creation":{"ephemeral_5m_input_tokens":1976,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3ZV4JroZZDSQTS2EsL","type":"assistant","uuid":"b66e88a5-5e37-4710-9340-41b8bd85fdf7","timestamp":"2026-01-26T13:10:38.136Z"}
{"parentUuid":"b66e88a5-5e37-4710-9340-41b8bd85fdf7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TAAZmjgvsRxkWYhd8Um9fM","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KF8GjSg7e2yXgTMkKxgtPH","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","offset":380,"limit":50}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1976,"cache_read_input_tokens":55275,"cache_creation":{"ephemeral_5m_input_tokens":1976,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3ZV4JroZZDSQTS2EsL","type":"assistant","uuid":"5690bcb6-145b-403a-b2b8-6b688ff0f881","timestamp":"2026-01-26T13:10:38.963Z"}
{"parentUuid":"5690bcb6-145b-403a-b2b8-6b688ff0f881","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KF8GjSg7e2yXgTMkKxgtPH","type":"tool_result","content":"   380→    // Remover el contenedor anterior si existe\n   381→    $('#contenedor-plan-creditos').remove();\n   382→    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n   383→    if ($('#contenedor-creditos').length) {\n   384→        $('#contenedor-creditos').html(seccion_creditos);\n   385→    } else {\n   386→        $('#contenedor-plan').after(seccion_creditos);\n   387→    }\n   388→    // Mostrar campos de precio para plan de créditos\n   389→    $('#contenedor-precio-creditos').removeClass('d-none');\n   390→    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n   391→        $('#precio_creditos').val(plan_creditos_seleccionado.precio).trigger('input');\n   392→    }\n   393→    actualizarValorVentaTotal();\n   394→}\n   395→\n   396→/**\n   397→ * Mostrar en el modal los planes obtenidos en el listado.\n   398→ * \n   399→ * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n   400→ * @returns {void}\n   401→ * @author José Manuel Jiménez\n   402→ * @author Daniel Beltrán\n   403→ */\n   404→function mostrarPlanes() {\n   405→    let buscar = $('#buscador-plan').val();\n   406→    let filtro_plan = $('#filtro-plan').val();\n   407→    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n   408→        table.destroy();\n   409→    }\n   410→    $('#buscador-plan').remove();\n   411→    $('#tbody-planes').empty();\n   412→    for (let i = 0; i < planes.length; i++) {\n   413→        if (\n   414→            (filtro_plan == 'Todos') ||\n   415→            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n   416→            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n   417→            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n   418→        ) {\n   419→            let cantidad_usuarios = '';\n   420→            if (planes[i].cantidad_usuarios != null) {\n   421→                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n   422→            }\n   423→            let cantidad_ofertas_laborales = '';\n   424→            if (planes[i].cantidad_ofertas_laborales != null) {\n   425→                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n   426→            }\n   427→            let cantidad_pruebas = '';\n   428→            if (planes[i].cantidad_pruebas != null) {\n   429→                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"e432d37e-c49d-4244-a35c-f66d89026c45","timestamp":"2026-01-26T13:10:40.227Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","content":"    // Remover el contenedor anterior si existe\n    $('#contenedor-plan-creditos').remove();\n    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n    if ($('#contenedor-creditos').length) {\n        $('#contenedor-creditos').html(seccion_creditos);\n    } else {\n        $('#contenedor-plan').after(seccion_creditos);\n    }\n    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        $('#precio_creditos').val(plan_creditos_seleccionado.precio).trigger('input');\n    }\n    actualizarValorVentaTotal();\n}\n\n/**\n * Mostrar en el modal los planes obtenidos en el listado.\n * \n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPlanes() {\n    let buscar = $('#buscador-plan').val();\n    let filtro_plan = $('#filtro-plan').val();\n    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n        table.destroy();\n    }\n    $('#buscador-plan').remove();\n    $('#tbody-planes').empty();\n    for (let i = 0; i < planes.length; i++) {\n        if (\n            (filtro_plan == 'Todos') ||\n            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n        ) {\n            let cantidad_usuarios = '';\n            if (planes[i].cantidad_usuarios != null) {\n                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n            }\n            let cantidad_ofertas_laborales = '';\n            if (planes[i].cantidad_ofertas_laborales != null) {\n                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n            }\n            let cantidad_pruebas = '';\n            if (planes[i].cantidad_pruebas != null) {\n                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;","numLines":50,"startLine":380,"totalLines":1027}},"sourceToolAssistantUUID":"5690bcb6-145b-403a-b2b8-6b688ff0f881"}
{"parentUuid":"e432d37e-c49d-4244-a35c-f66d89026c45","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Dfkxko86E996Af1vhrfLfV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Veo que en la línea 391 se usa `$('#precio_creditos')` pero ahora el campo se llama `precio_creditos_visual` y el hidden es `precio_creditos_original`. Necesito:\n\n1. Modificar la función `mostrarPlanCreditosSeleccionado()` para usar los nuevos nombres de campos\n2. Agregar la función `aplicarDescuentoCreditos()`\n3. Modificar `actualizarValorDesdeInput()` y `actualizarValorVentaTotal()` para usar el campo correcto\n\nVoy a hacer las ediciones necesarias.","signature":"Eu4ECkYICxgCKkBOjTYZcxiKDYT60YqVnCmPRMVDMG2Hdt442QImLNRE0U2LqBYfWekWIkqL4kBamvcOUfzy5ewsZjbJoa/EvdbdEgz3ZBnE4OXuftO2y5UaDDq5jAhL8jvEY68B/iIwJNP0y3RjQNQuE1vqZGbz+je0NESWF3hg8/kTKbvAwMSWKEXMGfNEayV8ZUr0t8VdKtUDjgk9O4IOSbcEXQZLyA0aDl+d2Fi2R63mJpw0XU7tYHT24XVAt6q7xJm05ee4ZmS1Ib/nc8T+4ihRBG579Mv+15hgS6rOVYueZ9PK4nDwtrrKlfJzzFu4zLzJFvuS7MyQWYcjPpL2AZw1JPMPS4llVfKJl8S0HK83kexsOxnrDXeEGJet8ElWxZjSSFylnksXWsJQRJ39SncxfAsGt77qn31hXawHq0RIUfYURcShJ/3h9Ch3N3g09z2sDivRiwPblQpJnWGTIfAp6aUmoaZfAfc1fmQbGYRQ2me7HJlpNgLgIMNDpHlRaAKAyvPvw85ISyq5q9gN1IPanF8FGI/nnAGdgOTDJGArro45Y8xReWXg2DaW0F2MVzwE9qZ/n7Tt+wAoz803+BeYs2rs+rQsZfaAg+Bn2PvwPiiR5m4dTWMvBJDn6DZKXDNcG138ua6I26pI0XIFdnrhT40oLu3EwmGYKdXvapxXH4OVF9O6cZzYovV039vOg16XwKG4K4k+Nv9F8VE6NyyC/JtmxDDuwhuRRdsxdtWkNcScyxPCUfbz4UPeHzHG/vqhKxMupC8KPhGpi1gHeP5hUibCX4OmIbrKDr0CC3Njn0YTnXScEe5uZmpHhhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1363,"cache_read_input_tokens":57251,"cache_creation":{"ephemeral_5m_input_tokens":1363,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW3a5A9zoZSjSaBaGSeH","type":"assistant","uuid":"47872b7b-eb55-4a0f-9337-56dc9c88a82e","timestamp":"2026-01-26T13:10:44.594Z"}
{"parentUuid":"47872b7b-eb55-4a0f-9337-56dc9c88a82e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Dfkxko86E996Af1vhrfLfV","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a modificar la función `mostrarPlanCreditosSeleccionado()` para usar los nuevos campos y agregar la función de descuento."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1363,"cache_read_input_tokens":57251,"cache_creation":{"ephemeral_5m_input_tokens":1363,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW3a5A9zoZSjSaBaGSeH","type":"assistant","uuid":"4973015b-e902-430c-a075-956dc23a09b4","timestamp":"2026-01-26T13:10:45.128Z"}
{"parentUuid":"4973015b-e902-430c-a075-956dc23a09b4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Dfkxko86E996Af1vhrfLfV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016DWW39isyXYEVc59NUggdj","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        $('#precio_creditos').val(plan_creditos_seleccionado.precio).trigger('input');\n    }\n    actualizarValorVentaTotal();\n}","new_string":"    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }\n    actualizarValorVentaTotal();\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1363,"cache_read_input_tokens":57251,"cache_creation":{"ephemeral_5m_input_tokens":1363,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW3a5A9zoZSjSaBaGSeH","type":"assistant","uuid":"444c9ff0-dec4-43bb-9ebf-1a9098014afc","timestamp":"2026-01-26T13:10:48.359Z"}
{"type":"file-history-snapshot","messageId":"444c9ff0-dec4-43bb-9ebf-1a9098014afc","snapshot":{"messageId":"fa4c0a9d-6561-4e6f-9b25-b4737971b00b","trackedFileBackups":{"resources\\views\\empresas\\paginas\\asignar-plan.blade.php":{"backupFileName":"23a0b404d58f48f6@v1","version":1,"backupTime":"2026-01-26T13:10:30.604Z"},"public\\js\\empresas\\asignar-plan.js":{"backupFileName":"25fa1d462d51e622@v1","version":1,"backupTime":"2026-01-26T13:11:16.906Z"}},"timestamp":"2026-01-26T13:09:51.458Z"},"isSnapshotUpdate":true}
{"parentUuid":"444c9ff0-dec4-43bb-9ebf-1a9098014afc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016DWW39isyXYEVc59NUggdj","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   384→        $('#contenedor-creditos').html(seccion_creditos);\n   385→    } else {\n   386→        $('#contenedor-plan').after(seccion_creditos);\n   387→    }\n   388→    // Mostrar campos de precio para plan de créditos\n   389→    $('#contenedor-precio-creditos').removeClass('d-none');\n   390→    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n   391→        // Guardar el valor original en el campo hidden\n   392→        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n   393→        // Mostrar el valor en el campo visual\n   394→        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n   395→        // Habilitar el campo visual inicialmente\n   396→        $('#precio_creditos_visual').prop('disabled', false);\n   397→        // Limpiar el porcentaje de descuento\n   398→        $('#porcentaje_descuento_creditos').val('');\n   399→    }\n   400→    actualizarValorVentaTotal();\n   401→}\n   402→\n   403→/**\n   404→ * Mostrar en el modal los planes obtenidos en el listado.\n   405→ * "}]},"uuid":"86dd0b24-8377-42b9-8d6e-156c8240e6d3","timestamp":"2026-01-26T13:11:16.929Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","oldString":"    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        $('#precio_creditos').val(plan_creditos_seleccionado.precio).trigger('input');\n    }\n    actualizarValorVentaTotal();\n}","newString":"    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }\n    actualizarValorVentaTotal();\n}","originalFile":"table = null;\nplanes = [];\npruebas = [];\nmodificado = false;\nfuncionalidades_predefinidos = [];\nplan_creditos_seleccionado = null;\n\n$(document).ready(function() {\n    $(document).on('input', '#precio_plan, #precio_creditos', function() {\n        actualizarValorDesdeInput();\n    });\n});\n\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales\n */\nfunction seleccionarTipoPrueba(tipo_prueba_id) {\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"card-body text-center\">\n            <button type=\"button\" id=\"elegir-plan\" class=\"btn btn-outline-primary\" disabled onclick=\"modalElegirPlan();\">Elegir plan</button>\n        </div>\n    `);\n    $('#seccion-pruebas').addClass('d-none');\n    $('#plan_id').val('');\n    pruebas = [];\n    // Convertir tipo_prueba_id a array si no lo es\n    let tipos_prueba = Array.isArray(tipo_prueba_id) ? tipo_prueba_id : [tipo_prueba_id];\n    // Crear los botones según los tipos de prueba seleccionados\n    let botones_html = '<div class=\"card-body text-center\">';\n    tipos_prueba.forEach(function(tipo_id) {\n        let texto_boton = 'Elegir plan';\n        let clase_boton = 'btn-outline-primary';\n        if (tipo_id == 1) {\n            texto_boton = 'Elegir Plan de Selección';\n            clase_boton = 'btn-outline-primary';\n        } else if (tipo_id == 2) {\n            texto_boton = 'Elegir Plan de Créditos IA';\n            clase_boton = 'btn-outline-info';\n        }\n        botones_html += `\n            <button type=\"button\" id=\"elegir-plan-${tipo_id}\" class=\"btn ${clase_boton} mx-1 my-1\" disabled onclick=\"modalElegirPlan(${tipo_id});\">\n                ${texto_boton}\n            </button>\n        `;\n    });\n    botones_html += '</div>';\n    $('#contenedor-plan').append(botones_html);\n    $('#tipo_prueba_id').val(tipo_prueba_id).trigger('select2');\n    if (tipo_prueba_id && (Array.isArray(tipo_prueba_id) ? tipo_prueba_id.length > 0 : tipo_prueba_id)) {\n        // Habilitar todos los botones creados\n        tipos_prueba.forEach(function(tipo_id) {\n            $(`#elegir-plan-${tipo_id}`).prop('disabled', false);\n        });\n        $.ajax({\n            type: 'GET',\n            url : `/pruebas-listado`,\n            data: {\n                tipo_prueba_id: tipo_prueba_id,\n                activo: 1\n            }\n        }).then((respuesta) => {\n            limpiarAdicional();\n            $('#contenedor-pruebas').empty();\n            pruebas = respuesta.data;\n            for (let i = 0; i < pruebas.length; i++) {\n                $('#contenedor-pruebas').append(`\n                    <div class=\"col-12 col-md-6\">\n                        <div class=\"d-flex align-items-center\">\n                            <div class=\"check-container my-1 me-1\">\n                                <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                            </div>\n                            <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                        </div>\n                    </div>\n                `);\n            }\n            if (opcion == 'facturar' || opcion == 'editar') {\n                for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                    $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n                }\n                $('#seccion-pruebas').removeClass('d-none');\n                mostrarPlanSeleccionado();\n            }\n            if (opcion == 'editar') {\n                $('#tipo_prueba_id').prop('disabled', true);\n            }\n        }).catch((error) => {\n            console.error(error);\n        });\n    } else {\n        $('#elegir-plan').prop('disabled', true);\n    }\n}\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction seleccionarTipoPruebaMultiple() {\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    tipos_prueba = tipos_prueba.filter(function(tipo_id) {\n        return tipo_id !== null && tipo_id !== '' && tipo_id !== undefined;\n    });\n    if (tipos_prueba.length === 0) {\n        // Si no hay tipos seleccionados, limpiar todo\n        $('#contenedor-plan').empty();\n        $('#contenedor-creditos').empty();\n        $('#seccion-pruebas').addClass('d-none');\n        $('#plan_id').val('');\n        $('#plan_id').prop('required', false);\n        $('#plan_id').prop('disabled', true);\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n        plan_seleccionado = null;\n        plan_creditos_seleccionado = null;\n        pruebas = [];\n        return;\n    }\n    let tiene_seleccion = tipos_prueba.includes('1') || tipos_prueba.includes(1);\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    $('#plan_id').prop('required', tiene_seleccion);\n    $('#plan_id').prop('disabled', !tiene_seleccion);\n    // Manejo del plan de selección\n    if (tiene_seleccion) {\n        // Si hay un plan seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_seleccionado === null && $('#contenedor-plan').children().length === 0) {\n            let seccion_seleccion = `\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Selección</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-1\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(1);\">\n                            Elegir Plan de Selección\n                        </button>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-plan').html(seccion_seleccion);\n        }\n    } else {\n        // Si se deseleccionó el tipo de selección, limpiar el plan\n        $('#contenedor-plan').empty();\n        plan_seleccionado = null;\n        $('#plan_id').val('');\n    }\n    // Manejo del plan de créditos\n    if (tiene_creditos) {\n        // Si hay un plan de créditos seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n            let seccion_creditos = `\n                <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                    <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                    <div class=\"card rounded rounded-3\">\n                        <div class=\"card-body text-center\">\n                            <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                                Elegir Plan de Créditos IA\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-creditos').html(seccion_creditos);\n        }\n    } else {\n        // Si se deseleccionó el tipo de créditos, limpiar el plan de créditos\n        $('#contenedor-creditos').empty();\n        $('#contenedor-plan-creditos').remove();\n        plan_creditos_seleccionado = null;\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/pruebas-listado`,\n        data: {\n            tipo_prueba_id: tipos_prueba,\n            activo: 1\n        }\n    }).then((respuesta) => {\n        limpiarAdicional();\n        $('#contenedor-pruebas').empty();\n        pruebas = respuesta.data;\n        for (let i = 0; i < pruebas.length; i++) {\n            $('#contenedor-pruebas').append(`\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"d-flex align-items-center\">\n                        <div class=\"check-container my-1 me-1\">\n                            <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                        </div>\n                        <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                    </div>\n                </div>\n            `);\n        }\n        if (opcion == 'facturar' || opcion == 'editar') {\n            for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n            }\n            $('#seccion-pruebas').removeClass('d-none');\n            mostrarPlanSeleccionado();\n        }\n        if (opcion == 'editar') {\n            $('#tipo_prueba_id').prop('disabled', true);\n        }\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    });\n}\n/**\n * Obtener el listado de planes según el tipo_prueba_id seleccionado anteriormente.\n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalElegirPlan(tipo_especifico = null) {\n    let tipo_prueba_para_consulta = tipo_especifico !== null ? tipo_especifico : $('#tipo_prueba_id').val();\n    // Si es tipo 2 (Créditos IA), cargar planes de créditos\n    if (tipo_prueba_para_consulta == 2 || tipo_prueba_para_consulta == '2') {\n        $.ajax({\n            type: 'GET',\n            url: '/planes-creditos',\n            data: {\n                activo: true\n            }\n        }).then((respuesta) => {\n            planes_creditos = respuesta.data.planes;\n            mostrarPlanesCreditos();\n        }).catch((error) => {\n            mostrarToast('danger', 'Ocurrió un error');\n        });\n        return;\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/planes-listado`,\n        data: {\n            tipo_prueba_id: $('#tipo_prueba_id').val()\n        }\n    }).then((respuesta) => {\n        planes = respuesta.data;\n        mostrarPlanes();\n    }).catch((error) => {\n        console.error(error);\n    });\n}\n/**\n * Mostrar los planes de créditos en el modal.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction mostrarPlanesCreditos() {\n    let filtro_orden = $('#filtro-plan-credito').val();\n    let buscar = $('#buscador-plan-credito').val() || '';\n    // Ordenar planes según el filtro\n    let planes_ordenados = [...planes_creditos];\n    if (filtro_orden === 'Mayor') {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else if (filtro_orden === 'Menor') {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    if (buscar !== '') {\n        planes_ordenados = planes_ordenados.filter(plan =>\n            plan.nombre.toLowerCase().includes(buscar.toLowerCase())\n        );\n    }\n    $('#contenedor-planes-creditos').empty();\n    if (planes_ordenados.length === 0) {\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"text-center py-5\">\n                <p class=\"text-muted\">No se encontraron planes</p>\n            </div>\n        `);\n    }\n    for (let i = 0; i < planes_ordenados.length; i++) {\n        let plan = planes_ordenados[i];\n        let creditos_disponibles = plan.creditos_disponibles || plan.creditos || 0;\n        let creditos_promedio = plan.creditos_promedio_accion || 0;\n        let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n            ? Math.floor(creditos_disponibles / creditos_promedio)\n            : 0;\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"card rounded rounded-3 border-hover pointer mb-3\" onclick=\"elegirPlanCreditos(${i}, ${filtro_orden === 'Mayor' ? 'true' : 'false'});\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6 text-gray-10\">${plan.nombre}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        `);\n    }\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('show');\n    }\n    $('#buscador-plan-credito').off('input').on('input', function() {\n        mostrarPlanesCreditos();\n    });\n}\n/**\n * Elegir un plan de créditos IA.\n * @param {number} indice Índice del plan en el array.\n * @param {boolean} orden_mayor Si está ordenado de mayor a menor.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction elegirPlanCreditos(indice, orden_mayor = false) {\n    // Aplicar el mismo ordenamiento que en mostrarPlanesCreditos\n    let planes_ordenados = [...planes_creditos];\n    if (orden_mayor) {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    plan_creditos_seleccionado = planes_ordenados[indice];\n    // Establecer los valores en los campos hidden\n    $('#plan_credito_id').val(plan_creditos_seleccionado.id);\n    $('#creditos').val(plan_creditos_seleccionado.creditos);\n    mostrarPlanCreditosSeleccionado();\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('hide');\n    }\n}\n/**\n * Mostrar el plan de créditos seleccionado en el contenedor.\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarPlanCreditosSeleccionado() {\n    if (!plan_creditos_seleccionado || !plan_creditos_seleccionado.creditos) {\n        mostrarToast('danger', 'Ocurrió un error'+plan_creditos_seleccionado);\n        return;\n    }\n    let creditos_disponibles = plan_creditos_seleccionado.creditos_disponibles || plan_creditos_seleccionado.creditos || 0;\n    let creditos_promedio = plan_creditos_seleccionado.creditos_promedio_accion || 0;\n    let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n        ? Math.floor(creditos_disponibles / creditos_promedio)\n        : 0;\n    let seccion_creditos = `\n        <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n            <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n            <div class=\"card rounded rounded-3\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4 pointer\" onclick=\"modalElegirPlan(2);\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6\">${plan_creditos_seleccionado.nombre || 'Plan de Créditos'}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan_creditos_seleccionado.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    // Remover el contenedor anterior si existe\n    $('#contenedor-plan-creditos').remove();\n    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n    if ($('#contenedor-creditos').length) {\n        $('#contenedor-creditos').html(seccion_creditos);\n    } else {\n        $('#contenedor-plan').after(seccion_creditos);\n    }\n    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        $('#precio_creditos').val(plan_creditos_seleccionado.precio).trigger('input');\n    }\n    actualizarValorVentaTotal();\n}\n\n/**\n * Mostrar en el modal los planes obtenidos en el listado.\n * \n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPlanes() {\n    let buscar = $('#buscador-plan').val();\n    let filtro_plan = $('#filtro-plan').val();\n    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n        table.destroy();\n    }\n    $('#buscador-plan').remove();\n    $('#tbody-planes').empty();\n    for (let i = 0; i < planes.length; i++) {\n        if (\n            (filtro_plan == 'Todos') ||\n            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n        ) {\n            let cantidad_usuarios = '';\n            if (planes[i].cantidad_usuarios != null) {\n                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n            }\n            let cantidad_ofertas_laborales = '';\n            if (planes[i].cantidad_ofertas_laborales != null) {\n                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n            }\n            let cantidad_pruebas = '';\n            if (planes[i].cantidad_pruebas != null) {\n                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;\n            }\n            let unidades = '';\n            if (planes[i].unidades != null) {\n                unidades = `<div class=\"col-auto w-90px\"><i class=\"bi bi-box\"></i> ${planes[i].unidades}</div>`;\n            }\n            let vigencia = '';\n            if (planes[i].vigencia == 90) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n            } else if (planes[i].vigencia == 180) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n            }  else if (planes[i].vigencia == 365) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n            } else if (planes[i].vigencia == null || planes[i].vigencia == 0) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n            } else {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${planes[i].vigencia} días</div>`;\n            }\n            $('#tbody-planes').append(`\n                <tr>\n                    <td style=\"border-bottom: 0px!important;\">\n                        <div class=\"border border-1 rounded rounded-2 pointer border-hover\" onclick=\"elegirPlan(${i});\">\n                            <div class=\"row m-0 w-100 px-3 py-5 text-headline-6\">\n                                <div class=\"col\">${planes[i].nombre !== null ? planes[i].nombre : ''}</div>\n                                ${cantidad_ofertas_laborales}\n                                ${unidades}\n                                ${cantidad_usuarios}\n                                ${cantidad_pruebas}\n                                ${vigencia}\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            `);\n        }\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('show');\n    }\n    table = $('#tabla-planes').DataTable({\n        \"paging\": false,\n        \"searching\": true,\n        \"ordering\": false,\n        \"info\": false\n    });\n    let buscador = $('#tabla-planes_wrapper input');\n    $(buscador).addClass('rounded-2 text-body-2');\n    $(buscador).prop('placeholder', 'Buscar');\n    $(buscador).prop('id', 'buscador-plan');\n    $('#input-busqueda').append(buscador);\n    $(buscador).val(buscar).trigger('input');\n}\n/**\n * Elegir un plan del listado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction elegirPlan(i) {\n    plan_seleccionado = planes[i];\n    mostrarPlanSeleccionado();\n}\n/**\n * Mostrar el plan seleccionado en el contenedor y en las opciones del modificar.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction mostrarPlanSeleccionado() {\n    let cantidad_usuarios = '';\n    let cantidad_usuarios_modal = $('#cantidad_usuarios_modal').val();\n    if (cantidad_usuarios_modal != '') {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${cantidad_usuarios_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_usuarios != null) {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${plan_seleccionado.cantidad_usuarios}</div>`;\n    }\n    let cantidad_ofertas_laborales = '';\n    let cantidad_ofertas_laborales_modal = $('#cantidad_ofertas_laborales_modal').val();\n    if (cantidad_ofertas_laborales_modal != '') {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${cantidad_ofertas_laborales_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_ofertas_laborales != null) {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${plan_seleccionado.cantidad_ofertas_laborales}</div>`;\n    }\n    let cantidad_pruebas = '';\n    let cantidad_pruebas_modal = $('#cantidad_pruebas_modal').val();\n    if (cantidad_pruebas_modal != '') {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${cantidad_pruebas_modal}</div>`;\n        $('.cantidad-pruebas').text(cantidad_pruebas_modal);\n    } else if (plan_seleccionado.cantidad_pruebas != null) {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${plan_seleccionado.cantidad_pruebas}</div>`;\n        $('.cantidad-pruebas').text(plan_seleccionado.cantidad_pruebas);\n    }\n    let unidades = '';\n    let unidades_modal = $('#unidades_modal').val();\n    if (unidades_modal != '') {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${unidades_modal}</div>`;\n    } else if (plan_seleccionado.unidades != null) {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${plan_seleccionado.unidades}</div>`;\n    }\n    let vigencia = '';\n    let vigencia_modal = $('#vigencia_modal').val();\n    if (plan_seleccionado.vigencia == 90 || vigencia_modal == '90') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n    } else if (plan_seleccionado.vigencia == 180 || vigencia_modal == '180') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n    }  else if (plan_seleccionado.vigencia == 365 || vigencia_modal == '365') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n    } else if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n    } else if (vigencia_modal != '') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${vigencia_modal} días</div>`;\n    } else {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${plan_seleccionado.vigencia} días</div>`;\n    }\n    let abrir_modal_elegir_plan = '';\n    let icono_editar = `\n        <div class=\"col-auto w-90px\">\n            <button type=\"button\" class=\"btn btn-text-primary text-white btn-circle\" onclick=\"abrirModalModificar(event);\" title=\"Modificar plan\">\n                <i class=\"bi bi-wrench\"></i>\n            </button>\n        </div>\n    `;\n    if (opcion == 'asignar') {\n        abrir_modal_elegir_plan = `onclick=\"modalElegirPlan();\"`;\n        icono_editar = '';\n    }\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"row border rounded rounded-3 m-0 w-100 px-3 py-5 text-headline-6 pointer\" ${abrir_modal_elegir_plan}>\n            <div class=\"col\">${plan_seleccionado.nombre !== null ? plan_seleccionado.nombre : ''} <span id=\"plan-modificado\"></span></div>\n            ${cantidad_ofertas_laborales}\n            ${unidades}\n            ${cantidad_usuarios}\n            ${cantidad_pruebas}\n            ${vigencia}\n            ${icono_editar}\n        </div>\n    `);\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    // Solo agregar el botón de elegir plan de créditos si no hay uno seleccionado y se requiere\n    if (tiene_creditos && plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n        let seccion_creditos = `\n            <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                            Elegir Plan de Créditos IA\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n        $('#contenedor-creditos').append(seccion_creditos);\n    }\n    $('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n    \n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    $('#precio_plan').val(plan_seleccionado.precio).trigger('input');\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}\n\n/**\n * Actualizar el valor de venta total sumando plan de selección y créditos.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorVentaTotal() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n    }\n\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    let valor_plan_input = $('#precio_plan').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Abrir la factura del plan en una nueva pestaña del navegador.\n * \n * @param {number} factura_id Id de la factura.\n * @returns {void}\n * @author Andres Morales\n */\nasync function abrirFacturaPlan(factura_id) {\n    if (!factura_id) {\n        mostrarToast('danger', 'No se encontró la factura');\n        return;\n    }\n    try {\n        const respuesta = await $.ajax({\n            type: 'GET',\n            url: `/archivos-abrir/${factura_id}`,\n            xhrFields: { responseType: 'blob' }\n        });\n        const blobUrl = window.URL.createObjectURL(respuesta);\n        window.open(blobUrl, '_blank');\n    } catch (error) {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    }\n}\n/**\n * Buscar las funcionalidades por tipo de prueba.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidades(tipo_prueba_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/funcionalidades-listado`,\n        data : {\n            tipo_prueba_id: tipo_prueba_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let beneficios = respuesta.data;\n            const ADICIONALES = beneficios\n                .filter(item => item.predeterminado === 0)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            const PREDEFINIDOS = beneficios\n                .filter(item => item.predeterminado === 1)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            funcionalidades_predefinidos = PREDEFINIDOS;\n            // Verificar si el multiselect está inicializado antes de destruir\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect('destroy');\n            }\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect('destroy');\n            }\n            ADICIONALES.forEach((item) => {\n                $('#adicionales_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            PREDEFINIDOS.forEach((item) => {\n                $('#predefinidos_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            inizializarMultiselect();\n            if (opcion == 'facturar' || opcion == 'editar') {\n                buscarfuncionalidadesPlanEmpresa($('#id').val());\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Buscar las funcionalidades del plan de la empresa.\n * @param {number} empresa_plan_id ID del plan de empresa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidadesPlanEmpresa(empresa_plan_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/empresas-planes-funcionalidades-listado`,\n        data : {\n            empresa_plan_id: empresa_plan_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let funcionalidades = respuesta.data.map(item => item.funcionalidad_id);\n            $('#adicionales_modal').val(funcionalidades);\n            // Verificar si el multiselect está inicializado antes de refrescar\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect(\"refresh\");\n            }\n            $('#predefinidos_modal').val(funcionalidades);\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect(\"refresh\");\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Función para agregar validaciones adicionales y data adicional en el envío del form.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction validacionAdicional() {\n    let valido = true;\n    let es_solo_creditos = plan_seleccionado === null && plan_creditos_seleccionado !== null;\n    $('#vigencia').val($('#vigencia_modal').val());\n    if ($('#unidades_modal').val() == 'Ilimitadas') {\n        $('#unidades').val('');\n    } else {\n        $('#unidades').val($('#unidades_modal').val());\n    }\n    if ($('#cantidad_ofertas_laborales_modal').val() == 'Ilimitadas') {\n        $('#cantidad_ofertas_laborales').val('');\n    } else {\n        $('#cantidad_ofertas_laborales').val($('#cantidad_ofertas_laborales_modal').val());\n    }\n    $('#cantidad_usuarios').val($('#cantidad_usuarios_modal').val());\n    $('#cantidad_pruebas').val($('#cantidad_pruebas_modal').val());\n    if (opcion == 'facturar' || opcion == 'editar') {\n        let adicionales = $('#adicionales_modal').val();\n        let predefinidos = $('#predefinidos_modal').val();\n        let funcionalidades = adicionales.concat(predefinidos);\n        $('#funcionalidades').val(JSON.stringify(funcionalidades));\n        if (!es_solo_creditos && funcionalidades.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una funcionalidad.');\n        }\n    } else {\n        let ids = [];\n        if (plan_seleccionado && Array.isArray(plan_seleccionado.funcionalidades)) {\n            ids = plan_seleccionado.funcionalidades.map(objeto => objeto.id);\n        }\n        $('#funcionalidades').val(JSON.stringify(ids));\n    }\n    var pruebas_seleccionadas = $('.pruebas:checked').map(function() {\n        return this.value;\n    }).get();\n    $('#pruebas').val('');\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado ? plan_seleccionado.cantidad_pruebas : 0;\n    }\n    if (!es_solo_creditos) {\n        if (pruebas_seleccionadas.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una prueba.');\n        } else if (pruebas_seleccionadas.length > maximo_pruebas) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione maximo ' + maximo_pruebas + ' pruebas.');\n        }\n    }\n    if (valido) {\n        $('#pruebas').val(JSON.stringify(pruebas_seleccionadas));\n    }\n    return valido;\n}\n/**\n * Función para validar que no se exceda al seleccionar limite de pruebas.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction ValidarPruebas() {\n    let cantidad_seleccionadas = $('.pruebas:checked').length;\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado.cantidad_pruebas;\n    }\n    if (cantidad_seleccionadas > maximo_pruebas) {\n        $('#alerta-pruebas').removeClass('d-none');\n    } else {\n        $('#alerta-pruebas').addClass('d-none');\n    }\n}\n/**\n * Abrir el modal con los campos para modificar plan.\n * @param {Event} evento Evento desencadenado.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalModificar(evento) {\n    evento.stopPropagation();\n    if (modificado == false) {\n        $('#nombre-plan-modal').text(plan_seleccionado.nombre);\n        $('#cantidad_pruebas_modal').empty();\n        $('#cantidad_pruebas_modal').append(`\n            <option value=\"\">Seleccione</option>\n        `);\n        for (let j = 1; j <= pruebas.length; j++) {\n            $('#cantidad_pruebas_modal').append(`\n                <option value=\"${j}\">${j} Pruebas</option>\n            `);\n        }\n        $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n        if ([90, 180, 365].includes(plan_seleccionado.vigencia)) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val(plan_seleccionado.vigencia).trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else if (plan_seleccionado.vigencia != null && plan_seleccionado.vigencia != 0) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val('personalizado').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else {\n            $('#tiempo_modal').prop('disabled', true);\n            $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val('');\n        }\n        if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n            $('#unidades_modal').val(plan_seleccionado.unidades);\n            $('#unidades_modal').prop('disabled', false);\n            if (opcion == 'asignar') {\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa_plan.cantidad_ofertas_laborales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', false);\n        } else {\n            $('#unidades_modal').val(empresa.procesos_estimados_mensuales);\n            $('#unidades_modal').prop('disabled', true);\n            if (opcion == 'facturar' || opcion == 'editar') {\n                $('#unidades_modal').val(plan_seleccionado.unidades);\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa.pruebas_estimadas_mensuales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', true);\n        }\n        $('#cantidad_usuarios_modal').val(plan_seleccionado.cantidad_usuarios);\n        if (opcion == 'facturar' || opcion == 'editar') {\n            $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n            buscarfuncionalidadesPlanEmpresa($('#id').val());\n        }\n        $('#boton-guardar-modificaciones').prop('disabled', true);\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('show');\n    }\n}\n/**\n * Función que habilita el boton de guardar un plan modificado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction habilitarBotonGuardar() {\n    $('#boton-guardar-modificaciones').prop('disabled', false);\n}\n/**\n * Función que controla los campos de vigencia en el modal de editar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarTiempo(vigencia) {\n    $('.texto-label-tiempo').text('máximas permitidas');\n    $('#input-container-tiempo').removeClass('d-none');\n    $('#input-container-tiempo').addClass('col-md-6');\n    if (vigencia == 'personalizado') {\n        $('#input-container-vigencia').removeClass('d-none');\n        $('#vigencia_modal').val('');\n    } else if ((vigencia == '' || vigencia == null || vigencia == 0) && plan_seleccionado != null && (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0)) {\n        $('.texto-label-tiempo').text('');\n        $('#input-container-tiempo').addClass('d-none');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val('');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    } else if (['90', '180', '365'].includes(vigencia)) {\n        $('#input-container-tiempo').removeClass('col-md-6');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val(vigencia);\n    } else {\n        $('#vigencia_modal').val(vigencia);\n        $('#input-container-vigencia').addClass('d-none');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    }\n}\n/**\n * Abrir el modal de confirmación.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalEstasSeguro() {\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('hide');\n        $('#modal-estas-seguro').modal('show');\n    }\n}\n/**\n * Cancelar la edición de un plan.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction cancelarEdicion() {\n    modificado = false;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    limpiarAdicional();\n    mostrarPlanSeleccionado();\n}\n/**\n * Confirmar los datos editados.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction confirmarEdicion() {\n    modificado = true;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    $('#plan-modificado').text('(modificado)');\n    mostrarPlanSeleccionado();\n}\n/**\n * Limpiar los campos del modal.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction limpiarAdicional() {\n    $('#cantidad_pruebas_modal').val('').trigger('change').trigger('select2:select');\n    $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n    $('#unidades_modal').val('');\n    $('#cantidad_ofertas_laborales_modal').val('');\n    $('#cantidad_usuarios_modal').val('');\n    // Verificar si el multiselect está inicializado antes de llamar uncheckAll\n    if ($('#adicionales_modal').data('multiselect')) {\n        $('#adicionales_modal').multiselect(\"uncheckAll\");\n    }\n    if ($('#predefinidos_modal').data('multiselect')) {\n        $('#predefinidos_modal').multiselect(\"uncheckAll\");\n    }\n}\n/**\n * Función para ejecutar acciones luego de guardar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction postSuccess(respuesta) {\n    limpiarFormulario(respuesta.formulario);\n    if (opcion == 'asignar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se asignó con éxito a la empresa`,\n        }));\n    } else if (opcion == 'facturar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se facturó con éxito`,\n        }));\n    } else if (opcion == 'editar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se actualizó con éxito`,\n        }));\n    }\n    window.location.href='/empresas-gestionar/' + empresa.id;\n}\n","structuredPatch":[{"oldStart":388,"oldLines":7,"newStart":388,"newLines":14,"lines":["     // Mostrar campos de precio para plan de créditos","     $('#contenedor-precio-creditos').removeClass('d-none');","     if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {","-        $('#precio_creditos').val(plan_creditos_seleccionado.precio).trigger('input');","+        // Guardar el valor original en el campo hidden","+        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);","+        // Mostrar el valor en el campo visual","+        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');","+        // Habilitar el campo visual inicialmente","+        $('#precio_creditos_visual').prop('disabled', false);","+        // Limpiar el porcentaje de descuento","+        $('#porcentaje_descuento_creditos').val('');","     }","     actualizarValorVentaTotal();"," }"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"444c9ff0-dec4-43bb-9ebf-1a9098014afc"}
{"parentUuid":"86dd0b24-8377-42b9-8d6e-156c8240e6d3","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01W64b9fW7aDZHHQa4hP785k","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora necesito modificar la función `actualizarValorDesdeInput()` para que use el campo visual correcto. También necesito agregar la función `aplicarDescuentoCreditos()`.\n\nPrimero veamos la función `actualizarValorDesdeInput()`:","signature":"Eo8DCkYICxgCKkCt0eqd7W5pfNbXPCVoKKYjet5/3KZvGoIjyqsuCdqSOfT9hDlhY/niA1J1quHuVdGnj2cPJLqeH4DpxlhyhsycEgy0DoawGdnFYl8XEVAaDC1ku/IDBQlOEncUryIwL7KCYXkHjUOKn7qzBFFmPyiFvlcxuR6xQkdOHKUnc+DpaHnCoHOJA0aAKfazkAyNKvYBUvSuG7YmzAjQTfTENRGpALP97zIoAUOwaCgB66JrBLKSvuEZO42Amg+D1pEGAGuGcgLKjO7DSpbYJzMI0ZucOPptsnf9xtfeW4hybaHkorS7vWsOeC1y8nj7a79R9c5I1ECi2HQkXzLxvPUo/vUCnz1RkjBWJOwuVmGtA/MZYJk/tDFR+FAvHtADoEsCRy3c1ijOjnVDeTyYU2ffhlGNL6zA93p12QhM1vvuHmldD9BCY8hoKjEaPv7zzgxQpyYhQZL92+t3EnrUYEJqMholAlPxLG59421uaI0AZAnMrApcDH+zW6RMinGYRfM4eGcvGeirxbA0GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1164,"cache_read_input_tokens":58614,"cache_creation":{"ephemeral_5m_input_tokens":1164,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXW3crfQK6qJ4cpXpSs8R","type":"assistant","uuid":"0bf572a4-10f9-4ff8-b5b2-76df1a8c72a0","timestamp":"2026-01-26T13:11:20.637Z"}
{"parentUuid":"0bf572a4-10f9-4ff8-b5b2-76df1a8c72a0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01W64b9fW7aDZHHQa4hP785k","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora modifico la función `actualizarValorDesdeInput()` para usar el campo visual."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1164,"cache_read_input_tokens":58614,"cache_creation":{"ephemeral_5m_input_tokens":1164,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXW3crfQK6qJ4cpXpSs8R","type":"assistant","uuid":"c91504d4-7b60-48d3-bf88-cb42960e50a8","timestamp":"2026-01-26T13:11:21.061Z"}
{"parentUuid":"c91504d4-7b60-48d3-bf88-cb42960e50a8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01W64b9fW7aDZHHQa4hP785k","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EnyaYgqzXz3Ht1DJVT9Vws","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    let valor_plan_input = $('#precio_plan').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}","new_string":"/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    let valor_plan_input = $('#precio_plan').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Usar el campo visual para mostrar el total con descuento aplicado\n    let valor_creditos_input = $('#precio_creditos_visual').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Aplicar el porcentaje de descuento al valor de créditos.\n * El valor original se mantiene en el campo hidden para el envío.\n * El campo visual muestra el valor con descuento y se deshabilita.\n *\n * @returns {void}\n * @author Claude\n */\nfunction aplicarDescuentoCreditos() {\n    let porcentaje = parseFloat($('#porcentaje_descuento_creditos').val()) || 0;\n    let valor_original = parseFloat($('#precio_creditos_original').val().replace(/[^\\d]/g, '')) || 0;\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $('#precio_creditos_visual').val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.replace(/[^\\d]/g, '')) || 0;\n            $('#precio_creditos_original').val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $('#precio_creditos_visual').val(valor_con_descuento.toLocaleString('es-CO')).trigger('input');\n\n        // Deshabilitar el campo visual\n        $('#precio_creditos_visual').prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        $('#precio_creditos_visual').val(valor_original > 0 ? valor_original.toLocaleString('es-CO') : '').trigger('input');\n        $('#precio_creditos_visual').prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1164,"cache_read_input_tokens":58614,"cache_creation":{"ephemeral_5m_input_tokens":1164,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXW3crfQK6qJ4cpXpSs8R","type":"assistant","uuid":"bfd4822a-2f95-4734-9827-d1c8f494b26b","timestamp":"2026-01-26T13:11:32.534Z"}
{"parentUuid":"bfd4822a-2f95-4734-9827-d1c8f494b26b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). The user provided the following reason for the rejection:  pero que sa funcion funcione para crerditos y em plan nbormal","is_error":true,"tool_use_id":"toolu_01EnyaYgqzXz3Ht1DJVT9Vws"}]},"uuid":"fa788897-11a1-4de5-905f-45e3cddfbf2b","timestamp":"2026-01-26T13:12:20.679Z","toolUseResult":"Error: The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). The user provided the following reason for the rejection:  pero que sa funcion funcione para crerditos y em plan nbormal","sourceToolAssistantUUID":"bfd4822a-2f95-4734-9827-d1c8f494b26b"}
{"parentUuid":"fa788897-11a1-4de5-905f-45e3cddfbf2b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_017FfCzTaHwWYd2nC9ip7Po5","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que la función de descuento funcione tanto para créditos como para el plan normal (plan de selección). Necesito:\n\n1. Modificar también la sección del plan normal en el blade para agregar el campo hidden y los eventos\n2. Crear una función genérica que funcione para ambos tipos o crear dos funciones separadas\n\nVoy a ver primero la sección del plan normal en el blade (líneas 98-124 aproximadamente).","signature":"EtAECkYICxgCKkDbp7FrM4FKUS44RahH+TttbcaS4hVy9cONswtqfs7/RyNWbnzvGqEH7ArGTB+bxgNPvK/pm3327CP0dLvvbW2aEgyKojw+H+zwLPxw710aDMA62RbqfvrtBxHZayIwwywV4K8oVpbXFQ3yI46GbNKR7ocP6FFjX8OiyI4okH66z3PHI4/cE3BskrlPkF32KrcDhX7KsZIp4QhLJr6W2Y1mNXugvtiuH8Tb56nb8DLrUl+JU6tOkQ2ar5vLG7jMy6o2S6knBJVLJD9GB3tsYnbQeQMc6lTWiyB9hKKK6x3ChiuuJ54i9PslZXpICT2Pv875iXGC6f6u3DmeWZLgmsA65DrMJxXO6CvsMbHD9NCzZW/m2VUzLYWcwDtXLK+iVNXdkasdkI9rRAMELyrQLTjsT+2WfE6qzzo0s3Ho7RBI+O9+tEWf0oXJb/e+K1oimpHEJV4xVcbc2Z4Hl8AZN7PtdvXWscyFaYVcvgV5NMSHu/AqWUvSSpprjwVa7afsJ9y3QE9DSFVnnMMj1dzIX7P9uMDyWaUgX63jeiWOB423ClCoeL7fo3UQQKKUr5GwNyCu4nI9LxN5hrRFByikpE7XuMRe0bzagXRqc11YlT2vmX1roBuIMxWZ7EeT8hLBrfCddQJ1Tzn0BbUDPnVlx12M7iBUnk2k5/4yWXy8DaS/IrF4no+0FmaGVVBEfW2WI7OZTTIvKTu2Rv2SPsh8zc+iiXokWH9BgyVL6ugzXshv5FWByTEqNu9Ukk7gOdzQhdFXdCIffPqkWxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1417,"cache_read_input_tokens":59778,"cache_creation":{"ephemeral_5m_input_tokens":1417,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW3hV9yqzYYtAf9dEfy4","type":"assistant","uuid":"86f09bb0-443b-4b35-b261-9cb9c20de44d","timestamp":"2026-01-26T13:12:24.738Z"}
{"parentUuid":"86f09bb0-443b-4b35-b261-9cb9c20de44d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_017FfCzTaHwWYd2nC9ip7Po5","type":"message","role":"assistant","content":[{"type":"text","text":"Entendido. Voy a crear la funcionalidad de descuento para ambos: plan de selección y plan de créditos.\n\nPrimero, modifico la sección del plan de selección en el Blade."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1417,"cache_read_input_tokens":59778,"cache_creation":{"ephemeral_5m_input_tokens":1417,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW3hV9yqzYYtAf9dEfy4","type":"assistant","uuid":"38eb6230-745d-4252-baf8-5ab3e64fbced","timestamp":"2026-01-26T13:12:25.635Z"}
{"parentUuid":"38eb6230-745d-4252-baf8-5ab3e64fbced","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_017FfCzTaHwWYd2nC9ip7Po5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KThL66YmRLuXHbF7NVLaU4","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","offset":95,"limit":35}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1417,"cache_read_input_tokens":59778,"cache_creation":{"ephemeral_5m_input_tokens":1417,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW3hV9yqzYYtAf9dEfy4","type":"assistant","uuid":"9f2589e8-c32b-4904-9e54-faff51c3fb6a","timestamp":"2026-01-26T13:12:26.420Z"}
{"parentUuid":"9f2589e8-c32b-4904-9e54-faff51c3fb6a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KThL66YmRLuXHbF7NVLaU4","type":"tool_result","content":"    95→                </div>\n    96→            </div>\n    97→\n    98→            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n    99→                <div class=\"col-6\">\n   100→                    ${crearInput({\n   101→                        id: 'porcentaje_descuento',\n   102→                        name: 'porcentaje_descuento',\n   103→                        type: 'number',\n   104→                        autocomplete: 'off',\n   105→                        max: 100,\n   106→                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n   107→                        label: 'Porcentaje de descuento',\n   108→                        label_class: 'optional'\n   109→                    })}\n   110→                </div>\n   111→                <div class=\"col-6\">\n   112→                    ${crearInput({\n   113→                        id: 'precio_plan',\n   114→                        name: 'precio',\n   115→                        class: 'cleave',\n   116→                        autocomplete: 'off',\n   117→                        minlength: 3,\n   118→                        maxlength: 12,\n   119→                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n   120→                        required: true,\n   121→                        label: 'Valor de venta'\n   122→                    })}\n   123→                </div>\n   124→            </div>\n   125→            \n   126→            <div class=\"row mt-3\">\n   127→                <div class=\"col-12\">\n   128→                    <div id=\"contenedor-creditos\">\n   129→                    </div>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"8fbeb70a-35ec-467a-8ed3-97d989856471","timestamp":"2026-01-26T13:12:27.591Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","content":"                </div>\n            </div>\n\n            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan',\n                        name: 'precio',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>\n            \n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>","numLines":35,"startLine":95,"totalLines":620}},"sourceToolAssistantUUID":"9f2589e8-c32b-4904-9e54-faff51c3fb6a"}
{"parentUuid":"8fbeb70a-35ec-467a-8ed3-97d989856471","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MKt3tJ48dAji8B3aaqPtYR","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora voy a modificar ambas secciones para que funcionen con el descuento:\n\n1. Para el plan de selección:\n   - Agregar campo hidden `precio_plan_original`\n   - Cambiar el id del input visible a `precio_plan_visual`\n   - Agregar eventos onkeyup y onchange para aplicar el descuento\n\n2. Para el plan de créditos (ya lo tengo parcialmente hecho):   - Mantener el campo hidden `precio_creditos_original`\n   - El campo visual ya es `precio_creditos_visual`\n\n3. Crear una función genérica `aplicarDescuento(tipo)` que funcione para ambos","signature":"ErkFCkYICxgCKkC21mGfGH3Zf5APyNxbnHQF8wqEakq+tiY6b9aLiuokc0dH58ZzGUE+78a6gKcyNdRtFbXH1if9A/MsXPogzS+bEgxetB+f1CVz2PpbOlgaDDoXvz3Od9MSSqhE8yIwp2pCZejVInDa7Z2TFR8Xo86UfW1zLb+prXw1gsbLMYK25lH8gvkAyr7q0wd/MLTYKqAEFchQcDfdgyw4BBSAdnrSBRDb4DyAZ3Pl6xvZI99+erO2GMXZAU44kAaafOFXXV9GCeapwwaSLcMuyrUhk6wSUidejSXZr3qGbmMndlHYdFPtNq5R0xwW1AEhWomWB3OOvHfXvozeFq8CSdUNd4cPoJp6tMHyCWFb6RkcbgJYpiJjz4TEJi7nHsSx7Io9nzwk7PoEupVrcMGFgIHgNGb+fk4i6xWHF4TC4pjgheeP9+fTaU2QwJr240TsKgUFqFQ0LaYrbA7pN9GRgTjiYeFqG2Q67wcVu958PDH2Hs+FEG4etqiVhJErMqGGBneAuk8mMeOYmviuxG8JxsANoQmzheGHNLR4/wQspyIECIlykdfzxwx7nj2/cAw23oYhy1vGPPn3OZUoeB8xDsq0WLlJJl0LFPw+XaU5g1ZvOMUGcrEWCXHp2kfGJZ0mVuZhn8PsKZRxuXzMBfhZZouOtaJ3AUtkn9D6LEtGdNHTF5y+sXk4whOysLVb/LaAvFOcvKoEhIzz/yhsLm7kB8J5JBGZdQSnHjOcys75ZRjNCButN2Xd+ofwMqqMsWIt9q748WDG2S5T9UjzDEKMf65IEyEk9m/jbvai8zkQvxq8ZQP9mjpnopl4HNb37mkoB0PmJoxuTZSoz27dhmjgZu0c8q9wGtk5KGAT3f34UpKkUdNDPO7V1Mqupynwtdggy0qY6az0Nf0fpjbgWOCJX6LQA/Jp7xgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":849,"cache_read_input_tokens":61195,"cache_creation":{"ephemeral_5m_input_tokens":849,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CXW3hzGwcX6mH3WA1DrSX","type":"assistant","uuid":"c1e8cfd4-79a4-4965-be51-d088e5554eef","timestamp":"2026-01-26T13:12:32.696Z"}
{"parentUuid":"c1e8cfd4-79a4-4965-be51-d088e5554eef","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MKt3tJ48dAji8B3aaqPtYR","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017xNHb5wbPAAungdmRrjJUq","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","old_string":"<div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan',\n                        name: 'precio',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>","new_string":"<input type=\"hidden\" id=\"precio_plan_original\" name=\"precio\" value=\"\">\n            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        min: 0,\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional',\n                        onkeyup: 'aplicarDescuento(\"plan\");',\n                        onchange: 'aplicarDescuento(\"plan\");'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan_visual',\n                        name: 'precio_plan_visual',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":849,"cache_read_input_tokens":61195,"cache_creation":{"ephemeral_5m_input_tokens":849,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CXW3hzGwcX6mH3WA1DrSX","type":"assistant","uuid":"a8540604-c753-440f-a875-68815a449a1f","timestamp":"2026-01-26T13:12:38.631Z"}
{"parentUuid":"a8540604-c753-440f-a875-68815a449a1f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). STOP what you are doing and wait for the user to tell you how to proceed.","is_error":true,"tool_use_id":"toolu_017xNHb5wbPAAungdmRrjJUq"}]},"uuid":"1066a7e0-984b-422b-93fe-74906f6abd38","timestamp":"2026-01-26T13:12:41.910Z","toolUseResult":"Error: The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). STOP what you are doing and wait for the user to tell you how to proceed.","sourceToolAssistantUUID":"a8540604-c753-440f-a875-68815a449a1f"}
{"parentUuid":"1066a7e0-984b-422b-93fe-74906f6abd38","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"text","text":"[Request interrupted by user for tool use]"}]},"uuid":"f1aa9bee-a870-4b26-a04f-86a8910228df","timestamp":"2026-01-26T13:12:41.998Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-26T13:12:57.676Z","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287"}
{"type":"file-history-snapshot","messageId":"77e97f6b-1aef-405a-a6bb-c1f664d77b7f","snapshot":{"messageId":"77e97f6b-1aef-405a-a6bb-c1f664d77b7f","trackedFileBackups":{"resources\\views\\empresas\\paginas\\asignar-plan.blade.php":{"backupFileName":"23a0b404d58f48f6@v2","version":2,"backupTime":"2026-01-26T13:12:58.344Z"},"public\\js\\empresas\\asignar-plan.js":{"backupFileName":"25fa1d462d51e622@v2","version":2,"backupTime":"2026-01-26T13:12:58.346Z"}},"timestamp":"2026-01-26T13:12:58.342Z"},"isSnapshotUpdate":false}
{"parentUuid":"de31b9e0-375c-48cb-b85f-bef581af4393","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01Q1F6yFs5Q6NJvwmwZQUVWQ","parentToolUseID":"toolu_01Q1F6yFs5Q6NJvwmwZQUVWQ","uuid":"9e984a09-10b8-44f7-8104-ccc171a28844","timestamp":"2026-01-26T13:10:06.865Z"}
{"parentUuid":"9e984a09-10b8-44f7-8104-ccc171a28844","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01Q1F6yFs5Q6NJvwmwZQUVWQ","parentToolUseID":"toolu_01Q1F6yFs5Q6NJvwmwZQUVWQ","uuid":"3ef17684-b1dd-44b2-b10e-ad70042500d1","timestamp":"2026-01-26T13:10:06.866Z"}
{"parentUuid":"e2eebba2-145e-4304-bd11-9fc98ede93cc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01Q1F6yFs5Q6NJvwmwZQUVWQ","toolUseID":"toolu_01Q1F6yFs5Q6NJvwmwZQUVWQ","timestamp":"2026-01-26T13:10:30.634Z","uuid":"05b133ce-4b1b-4b91-a343-4418489e30f6"}
{"parentUuid":"5690bcb6-145b-403a-b2b8-6b688ff0f881","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01KF8GjSg7e2yXgTMkKxgtPH","parentToolUseID":"toolu_01KF8GjSg7e2yXgTMkKxgtPH","uuid":"894f18c3-782d-4a28-8fb0-831624287748","timestamp":"2026-01-26T13:10:39.102Z"}
{"parentUuid":"444c9ff0-dec4-43bb-9ebf-1a9098014afc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_016DWW39isyXYEVc59NUggdj","parentToolUseID":"toolu_016DWW39isyXYEVc59NUggdj","uuid":"4f6bdd13-def3-4d86-8cae-2debf7c35d88","timestamp":"2026-01-26T13:10:48.665Z"}
{"parentUuid":"4f6bdd13-def3-4d86-8cae-2debf7c35d88","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_016DWW39isyXYEVc59NUggdj","parentToolUseID":"toolu_016DWW39isyXYEVc59NUggdj","uuid":"49eb0dbd-fa7a-40fa-b6d3-b8df29869b3e","timestamp":"2026-01-26T13:10:48.667Z"}
{"parentUuid":"86dd0b24-8377-42b9-8d6e-156c8240e6d3","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_016DWW39isyXYEVc59NUggdj","toolUseID":"toolu_016DWW39isyXYEVc59NUggdj","timestamp":"2026-01-26T13:11:16.930Z","uuid":"ea13b11f-b3bf-4d3c-8ead-4e850ebdc42f"}
{"parentUuid":"bfd4822a-2f95-4734-9827-d1c8f494b26b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01EnyaYgqzXz3Ht1DJVT9Vws","parentToolUseID":"toolu_01EnyaYgqzXz3Ht1DJVT9Vws","uuid":"e1d9de71-09d6-46f6-b51a-6eb9702c39fa","timestamp":"2026-01-26T13:11:32.683Z"}
{"parentUuid":"e1d9de71-09d6-46f6-b51a-6eb9702c39fa","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01EnyaYgqzXz3Ht1DJVT9Vws","parentToolUseID":"toolu_01EnyaYgqzXz3Ht1DJVT9Vws","uuid":"96278ffb-96d9-4cf8-8808-60d23e3e0280","timestamp":"2026-01-26T13:11:32.683Z"}
{"parentUuid":"9f2589e8-c32b-4904-9e54-faff51c3fb6a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01KThL66YmRLuXHbF7NVLaU4","parentToolUseID":"toolu_01KThL66YmRLuXHbF7NVLaU4","uuid":"88717ce2-0098-442b-b7dd-9c7f1aa7256a","timestamp":"2026-01-26T13:12:26.549Z"}
{"parentUuid":"a8540604-c753-440f-a875-68815a449a1f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_017xNHb5wbPAAungdmRrjJUq","parentToolUseID":"toolu_017xNHb5wbPAAungdmRrjJUq","uuid":"7af1e250-6b63-4019-aa4b-68638d5b5938","timestamp":"2026-01-26T13:12:38.749Z"}
{"parentUuid":"7af1e250-6b63-4019-aa4b-68638d5b5938","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_017xNHb5wbPAAungdmRrjJUq","parentToolUseID":"toolu_017xNHb5wbPAAungdmRrjJUq","uuid":"3ca10a4b-c17d-4aee-8e02-f5ca6d83c633","timestamp":"2026-01-26T13:12:38.750Z"}
{"parentUuid":"f1aa9bee-a870-4b26-a04f-86a8910228df","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"aslo de nuevo"}]},"uuid":"77e97f6b-1aef-405a-a6bb-c1f664d77b7f","timestamp":"2026-01-26T13:12:58.337Z","permissionMode":"default"}
{"parentUuid":"77e97f6b-1aef-405a-a6bb-c1f664d77b7f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GYsJ7Dj4KYzVynmxZXgkfH","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que haga de nuevo la modificación para el plan de selección. Voy a leer primero el archivo actual para ver el estado actual y luego hacer la modificación.","signature":"EtgCCkYICxgCKkA6Ug0qbuj2WEi0gDf3+zMoy2fHE5HknIRWn7Yr/R3PYVSxk6fzS5TfabvVsMGQAl3RS3XQPkcogjM5KrBOX+gDEgx2xdxVRzU6j5EU8agaDI4jpOfR5+qsZnFtIiIw4T2NJx7m9v63gnyTLqawV4xn+4o+rNdaVVjk1mypuQwh7I1kN7C8P/cl/+ywLGLNKr8Bx6HbEgRXepq2hyH+B5DP6b9CFIiVqWn1iSbnAKy0e2kGbUly79VSkCDbzbiaQEKBizmqBunxZDUm74xFEibYqKl7jtZxnevkpKpjsrP7ME1d4XmyUsbhHOVxA3omKehXzPtEJUGNdIQCPC2RcQRf1gMDfF6MD2t5oeDezJ1R/9OQUVKu1GaYT/gBuHgCh8hvgGg3Z48GiINeav08akTOLNE9dL3qnQPAfbcfjTvI48uK2rYVEwv9sLf4/ypsaZAYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2592,"cache_read_input_tokens":62044,"cache_creation":{"ephemeral_5m_input_tokens":2592,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW3kFr86Bc8YGeiorLh4","type":"assistant","uuid":"cc0c7bb2-1617-4278-9193-fc338f64d21b","timestamp":"2026-01-26T13:13:01.231Z"}
{"parentUuid":"cc0c7bb2-1617-4278-9193-fc338f64d21b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GYsJ7Dj4KYzVynmxZXgkfH","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Rh3WAr2VnGNuCYtQ5mpkRx","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","offset":95,"limit":70}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2592,"cache_read_input_tokens":62044,"cache_creation":{"ephemeral_5m_input_tokens":2592,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW3kFr86Bc8YGeiorLh4","type":"assistant","uuid":"f7ecbaec-d6b2-4c8c-b47c-5b4ec8192d35","timestamp":"2026-01-26T13:13:01.965Z"}
{"parentUuid":"f7ecbaec-d6b2-4c8c-b47c-5b4ec8192d35","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Rh3WAr2VnGNuCYtQ5mpkRx","type":"tool_result","content":"    95→                </div>\n    96→            </div>\n    97→\n    98→            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n    99→                <div class=\"col-6\">\n   100→                    ${crearInput({\n   101→                        id: 'porcentaje_descuento',\n   102→                        name: 'porcentaje_descuento',\n   103→                        type: 'number',\n   104→                        autocomplete: 'off',\n   105→                        max: 100,\n   106→                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n   107→                        label: 'Porcentaje de descuento',\n   108→                        label_class: 'optional'\n   109→                    })}\n   110→                </div>\n   111→                <div class=\"col-6\">\n   112→                    ${crearInput({\n   113→                        id: 'precio_plan',\n   114→                        name: 'precio',\n   115→                        class: 'cleave',\n   116→                        autocomplete: 'off',\n   117→                        minlength: 3,\n   118→                        maxlength: 12,\n   119→                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n   120→                        required: true,\n   121→                        label: 'Valor de venta'\n   122→                    })}\n   123→                </div>\n   124→            </div>\n   125→            \n   126→            <div class=\"row mt-3\">\n   127→                <div class=\"col-12\">\n   128→                    <div id=\"contenedor-creditos\">\n   129→                    </div>\n   130→                    <input type=\"hidden\" id=\"precio_creditos_original\" name=\"precio_creditos\" value=\"\">\n   131→                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n   132→                        <div class=\"col-6\">\n   133→                            ${crearInput({\n   134→                                id: 'porcentaje_descuento_creditos',\n   135→                                name: 'porcentaje_descuento_creditos',\n   136→                                type: 'number',\n   137→                                autocomplete: 'off',\n   138→                                min: 0,\n   139→                                max: 100,\n   140→                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n   141→                                label: 'Porcentaje de descuento',\n   142→                                label_class: 'optional',\n   143→                                onkeyup: 'aplicarDescuentoCreditos();',\n   144→                                onchange: 'aplicarDescuentoCreditos();'\n   145→                            })}\n   146→                        </div>\n   147→                        <div class=\"col-6\">\n   148→                            ${crearInput({\n   149→                                id: 'precio_creditos_visual',\n   150→                                name: 'precio_creditos_visual',\n   151→                                class: 'cleave',\n   152→                                autocomplete: 'off',\n   153→                                minlength: 3,\n   154→                                maxlength: 12,\n   155→                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n   156→                                required: true,\n   157→                                label: 'Valor de venta'\n   158→                            })}\n   159→                        </div>\n   160→                    </div>\n   161→                </div>\n   162→            </div>\n   163→\n   164→            <div class=\"row mt-7\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"48205f30-0515-4389-82bf-ef19c097a9ba","timestamp":"2026-01-26T13:13:03.155Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","content":"                </div>\n            </div>\n\n            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan',\n                        name: 'precio',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>\n            \n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <input type=\"hidden\" id=\"precio_creditos_original\" name=\"precio_creditos\" value=\"\">\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                min: 0,\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional',\n                                onkeyup: 'aplicarDescuentoCreditos();',\n                                onchange: 'aplicarDescuentoCreditos();'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos_visual',\n                                name: 'precio_creditos_visual',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-7\">","numLines":70,"startLine":95,"totalLines":620}},"sourceToolAssistantUUID":"f7ecbaec-d6b2-4c8c-b47c-5b4ec8192d35"}
{"parentUuid":"48205f30-0515-4389-82bf-ef19c097a9ba","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Kq1vZ8PmGWdRD6MorfrkXi","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora voy a modificar la sección del plan de selección (líneas 98-124) para agregar el campo hidden y los eventos de descuento.","signature":"EqsCCkYICxgCKkAxvM14QurvSdVVgxZxgPaRm7sFVVXLQ4745r4XeHO62FRylc7ln3ToFHZLTmDs/WNkU4XTogMAn/dr/x0DGIJuEgyEGlZK/T60Sf+7TRQaDBpmRlReDfLwyC+jJSIwlNKyz02xhcbK+4OFSZckgh+d5+gC5vYozWKojSz//eI3PTG3rnbEbE7A2ZdOm8mHKpIB2cy4GB98fmxUixJDNSW52bLm0lSZs3uratxRHcT0wUg3o2QZyJVWcezx1EY3w4p9nS2eUzc5j1EjOineFrDdw4VwGg1MLym6YORalQFpYGHk9ul3OxWDYTEOcV7FlIMLYSpHDZ8CzWfzsMs0t+ZFu385fGUBWSBq1cFFh9XswXO79hFpcdr78OgwwmVZbWVjDIQYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1254,"cache_read_input_tokens":64636,"cache_creation":{"ephemeral_5m_input_tokens":1254,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CXW3kc8ktViuWWrY8RHFc","type":"assistant","uuid":"101024f9-e183-487a-bbf3-a98becbdec52","timestamp":"2026-01-26T13:13:05.971Z"}
{"parentUuid":"101024f9-e183-487a-bbf3-a98becbdec52","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Kq1vZ8PmGWdRD6MorfrkXi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YE5nw2ptFqfJiRT3kSPgHC","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","old_string":"<div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan',\n                        name: 'precio',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>","new_string":"<input type=\"hidden\" id=\"precio_plan_original\" name=\"precio\" value=\"\">\n            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        min: 0,\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional',\n                        onkeyup: 'aplicarDescuento(\"plan\");',\n                        onchange: 'aplicarDescuento(\"plan\");'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan_visual',\n                        name: 'precio_plan_visual',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1254,"cache_read_input_tokens":64636,"cache_creation":{"ephemeral_5m_input_tokens":1254,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CXW3kc8ktViuWWrY8RHFc","type":"assistant","uuid":"ffcc99ff-e130-4716-8bb9-3b22a8f5121b","timestamp":"2026-01-26T13:13:11.341Z"}
{"parentUuid":"ffcc99ff-e130-4716-8bb9-3b22a8f5121b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YE5nw2ptFqfJiRT3kSPgHC","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n    94→                    )}\n    95→                </div>\n    96→            </div>\n    97→\n    98→            <input type=\"hidden\" id=\"precio_plan_original\" name=\"precio\" value=\"\">\n    99→            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n   100→                <div class=\"col-6\">\n   101→                    ${crearInput({\n   102→                        id: 'porcentaje_descuento',\n   103→                        name: 'porcentaje_descuento',\n   104→                        type: 'number',\n   105→                        autocomplete: 'off',\n   106→                        min: 0,\n   107→                        max: 100,\n   108→                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n   109→                        label: 'Porcentaje de descuento',\n   110→                        label_class: 'optional',\n   111→                        onkeyup: 'aplicarDescuento(\"plan\");',\n   112→                        onchange: 'aplicarDescuento(\"plan\");'\n   113→                    })}\n   114→                </div>\n   115→                <div class=\"col-6\">\n   116→                    ${crearInput({\n   117→                        id: 'precio_plan_visual',\n   118→                        name: 'precio_plan_visual',\n   119→                        class: 'cleave',\n   120→                        autocomplete: 'off',\n   121→                        minlength: 3,\n   122→                        maxlength: 12,\n   123→                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n   124→                        required: true,\n   125→                        label: 'Valor de venta'\n   126→                    })}\n   127→                </div>\n   128→            </div>\n   129→            \n   130→            <div class=\"row mt-3\">\n   131→                <div class=\"col-12\">\n   132→                    <div id=\"contenedor-creditos\">"}]},"uuid":"4c191de5-9d81-4601-af23-861523bf08f5","timestamp":"2026-01-26T13:13:20.180Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","oldString":"<div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan',\n                        name: 'precio',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>","newString":"<input type=\"hidden\" id=\"precio_plan_original\" name=\"precio\" value=\"\">\n            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        min: 0,\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional',\n                        onkeyup: 'aplicarDescuento(\"plan\");',\n                        onchange: 'aplicarDescuento(\"plan\");'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan_visual',\n                        name: 'precio_plan_visual',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>","originalFile":"@extends('layouts.app')\n@php\n    $titulo_pagina = isset($empresa_id) ? 'Asignar plan' : 'Facturar';\n@endphp\n@section('titulo', $titulo_pagina)\n\n@section('estilos')\n    <link href=\"{{ asset('css/empresas/empresas.css') }}\" rel=\"stylesheet\">\n@endsection\n\n@section('contenido')\n    <div class=\"container-fluid mt-4\">\n        <div class=\"text-headline-6 mb-0\">\n            <i class=\"bi bi-chevron-left h4 mb-0 text-primary me-5 pointer\" onclick=\"window.history.back();\"></i>\n            @if ($opcion == 'asignar')\n                Asignar plan\n            @elseif ($opcion == 'facturar')\n                Facturar plan\n            @elseif ($opcion == 'editar')\n                Editar asignación de plan\n            @endif\n        </div>\n    </div>\n    <div class=\"container mt-8\">\n        <form id=\"formulario\" enctype=\"multipart/form-data\">\n            @csrf\n            @isset ($empresa_id)\n                <input type=\"hidden\" id=\"empresa_id\" name=\"empresa_id\" value=\"{{ $empresa_id }}\">\n            @endisset\n            @isset ($empresa_plan)\n                <input type=\"hidden\" id=\"id\" name=\"id\" class=\"input-dinamico\" value=\"{{ $empresa_plan->id }}\">\n            @endisset\n            <input type=\"hidden\" id=\"pruebas\" name=\"pruebas\" value=\"\">\n            <input type=\"hidden\" id=\"vigencia\" name=\"vigencia\">\n            <input type=\"hidden\" id=\"unidades\" name=\"unidades\">\n            <input type=\"hidden\" id=\"cantidad_ofertas_laborales\" name=\"cantidad_ofertas_laborales\">\n            <input type=\"hidden\" id=\"cantidad_usuarios\" name=\"cantidad_usuarios\">\n            <input type=\"hidden\" id=\"cantidad_pruebas\" name=\"cantidad_pruebas\">\n            <input type=\"hidden\" id=\"plan_credito_id\" name=\"plan_credito_id\" value=\"\">\n            <input type=\"hidden\" id=\"creditos\" name=\"creditos\" value=\"\">\n            <input type=\"hidden\" id=\"funcionalidades\" name=\"funcionalidades\" value=\"\">\n            <div class=\"row mt-6\">\n                <div class=\"col-12\">\n                    ${crearMultiselect({\n                        opciones: [\n                            { nombre: 'Planes de selección', id: '1' },\n                            { nombre: 'Planes de créditos (IA)', id: '2' }\n                        ],\n                        id: 'tipo_prueba_id',\n                        name: 'tipo_prueba_id',\n                        class: 'clase-personalizada',\n                        onchange: 'seleccionarTipoPruebaMultiple();',\n                        placeholder: 'Tipo de plan',\n                        icono: '<i class=\"bi bi-check-circle input-icono1\"></i>',\n                        label: 'Tipo de plan',\n                        disabled: {{ $opcion != 'asignar' ? 'true' : 'false' }}\n                    })}\n                </div>\n            </div>\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-plan\">\n                    </div>\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'plan_id',\n                        name: 'plan_id',\n                        adicional: 'style=\"width: 0px; height: 0px;\"',\n                        class: 'p-0 border-0',\n                        required: true,\n                        input_container_class: 'mb-0'\n                    })}\n                </div>\n            </div>\n\n            <div class=\"row mt-7 d-none\" id=\"seccion-pruebas\">\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4 mb-5\">Pruebas</h4>\n                    <span class=\"text-body-2\">Selecciona las <span class=\"cantidad-pruebas\"></span> prueba(s) que vas a asignar a esta empresa.</span>\n                </div>\n                <div class=\"col-12 col-lg-6\">\n                    <div class=\"row\" id=\"contenedor-pruebas\">\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-5 d-none\" id=\"alerta-pruebas\">\n                <div class=\"col-12\">\n                    ${crearAlerta(\n                        'warning',\n                        'Recuerda que solo tienes <span class=\"cantidad-pruebas\">{{ $empresa_plan->cantidad_pruebas ?? ''}}</span> prueba(s) disponibles.',\n                        'w-100 mb-0'\n                    )}\n                </div>\n            </div>\n\n            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan',\n                        name: 'precio',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>\n            \n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <input type=\"hidden\" id=\"precio_creditos_original\" name=\"precio_creditos\" value=\"\">\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                min: 0,\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional',\n                                onkeyup: 'aplicarDescuentoCreditos();',\n                                onchange: 'aplicarDescuentoCreditos();'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos_visual',\n                                name: 'precio_creditos_visual',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-7\">\n                <div class=\"col-12 mt-5 mb-4\">\n                    <h4 class=\"text-headline-4\">Valor</h4>\n                    <span class=\"text-body-2\">Revisa el precio final y adjunta la factura.</span>\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'numero_factura',\n                        name: 'numero_factura',\n                        type: 'text',\n                        autocomplete: 'off',\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->numero_factura : '' }}',\n                        required: true,\n                        label: 'Número de factura o concepto'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    @if ($opcion == 'editar' && isset($empresa_plan['archivos'][0]))\n                        <div class=\"card h-auto border-secondary\">\n                            <div class=\"card-body p-2 rounded-4\">\n                                ${crearBoton({\n                                    url: '#',\n                                    clases: 'w-100 d-flex justify-content-between pointer bg-transparent border-0 p-0',\n                                    texto: `\n                                        <div class=\"px-4 text-cta-blue text-decoration-none\">\n                                            {{$empresa_plan['archivos'][0]['nombre']}}\n                                        </div>\n                                        <div class=\"px-4\">\n                                            <i class=\"bi bi-eye-fill text-cta-blue\"></i>\n                                        </div>\n                                    `,\n                                    onclick: `abrirFacturaPlan('{{$empresa_plan['archivos'][0]['id']}}')`\n                                })}\n                            </div>\n                        </div>\n                    @else\n                        ${crearInputFile({\n                            id: 'factura',\n                            name: 'factura',\n                            class: 'input-form',\n                            placeholder: '',\n                            required: false,\n                            accept: 'application/pdf',\n                        })}\n                    @endif\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    ${crearTextarea({\n                        id: 'comentario',\n                        name: 'comentario',\n                        maxlength: 255,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->comentario : '' }}',\n                        label: 'Comentario o detalle de uso',\n                        label_class: 'optional'\n                    })}\n                </div>\n            </div>\n\n            @if ($opcion == 'asignar')\n                <div class=\"row mt-3\">\n                    <div class=\"col-12 mt-5 mb-4\">\n                        <h4 class=\"text-headline-4\"><strong>Valor de venta: <span id=\"valor-venta-mostrar\">0</span></strong></h4>\n                    </div>\n                </div>\n            @endif\n\n            <div class=\"row mt-3 pb-4\">\n                <div class=\"col-12 text-center\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'btn-outline-primary me-2 px-14 text-blue-40',\n                        texto: 'Cancelar',\n                        url: `/empresas-gestionar/{{ isset($empresa_id) ? $empresa_id : '' }}`\n                    })}\n                    ${crearBoton({\n                        id: `boton-asignar`,\n                        type: `submit`,\n                        clases: `btn-primary px-12`,\n                        texto: `@if ($opcion == \"asignar\") Asignar plan @elseif ($opcion == \"facturar\") Guardar @elseif ($opcion == \"editar\") Guardar @endif`\n                    })}\n                </div>\n            </div>\n        </form>\n    </div>\n@section('modals')\n    ${crearModal({\n        id: 'modal-planes',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir plan',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda\">\n                            <i class=\"bi bi-search\"></i>\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan',\n                            name: 'filtro-plan',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanes();',\n                            opciones: [\n                                { nombre: 'Todos', id: 'Todos' },\n                                { nombre: 'Por vacantes', id: 'Ofertas' },\n                                { nombre: 'Por unidades', id: 'Unidades' },\n                                { nombre: 'Por tiempo', id: 'Tiempo' }\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                    <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                        <thead class=\"d-none\">\n                            <tr>\n                                <th></th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tbody-planes\">\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-modificar-planes',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-modificar-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: 'Modificar plan - <span id=\"nombre-plan-modal\">{{ isset($empresa_plan) && $empresa_plan->plan ? \" \" . $empresa_plan->plan->nombre : (isset($empresa_plan) && $empresa_plan->planCredito ? \" \" . $empresa_plan->planCredito->nombre : \"\") }}</span>',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">Personaliza tu plan para esta empresa.</span>\n            </div>\n            <div class=\"row m-0 w-100\">\n                <div class=\"col-12\" id=\"input-container-pruebas\">\n                    ${crearSelect2({\n                        id: 'cantidad_pruebas_modal',\n                        name: 'cantidad_pruebas_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar();',\n                        opciones: [\n                            { nombre: '', id: '' },\n                            @if (isset($empresa_plan))\n                                @for ($i = 1; $i <= 8; $i++)\n                                    { nombre: '{{ $i }} Pruebas', id: '{{ $i }}', selected: {{ $empresa_plan->cantidad_pruebas == $i ? 'true' : 'false' }} },\n                                @endfor\n                            @endif\n                        ],\n                        label: 'Pruebas disponibles'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\" id=\"input-container-tiempo\">\n                    ${crearSelect2({\n                        id: 'tiempo_modal',\n                        name: 'tiempo_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar(); seleccionarTiempo(this.value);',\n                        opciones: [\n                            { nombre: 'Seleccione', id: '' },\n                            { nombre: '3 Meses', id: '90', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 90 ? 'true' : 'false' }} },\n                            { nombre: '6 Meses', id: '180', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 180 ? 'true' : 'false' }} },\n                            { nombre: '1 Año', id: '365', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 365 ? 'true' : 'false' }} },\n                            { nombre: 'Personalizado', id: 'personalizado' }\n                        ],\n                        label: 'Tiempo'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6 d-none\" id=\"input-container-vigencia\">\n                    ${crearInput({\n                        id: 'vigencia_modal',\n                        name: 'vigencia_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Días'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'unidades_modal',\n                        name: 'unidades_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->unidades : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Unidades <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'cantidad_ofertas_laborales_modal',\n                        name: 'cantidad_ofertas_laborales_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_ofertas_laborales : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Vacantes <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4\">Beneficios</h4>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"adicionales_modal\" name=\"adicionales_modal[]\" data-placeholder=\"Adicionales\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"predefinidos_modal\" name=\"predefinidos_modal[]\" data-placeholder=\"Predefinidos\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    ${crearInput({\n                        id: 'cantidad_usuarios_modal',\n                        name: 'cantidad_usuarios_modal',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_usuarios : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Usuarios'\n                    })}\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"alert badge-estado-renovado fw-bold\">\n                        Recuerda que no es posible cambiar entre planes con cantidades fijas a ilimitados o viceversa.\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row m-0 w-100\">\n                        ${crearBoton({\n                            type: 'button',\n                            clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                            texto: 'Cancelar',\n                            onclick: 'cancelarEdicion();',\n                            adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                        })}\n                        ${crearBoton({\n                            id: 'boton-guardar-modificaciones',\n                            type: 'button',\n                            clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                            texto: 'Guardar modificaciones',\n                            onclick: 'abrirModalEstasSeguro();',\n                            disabled: true\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                    <thead class=\"d-none\">\n                        <tr>\n                            <th></th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"tbody-planes\">\n                    </tbody>\n                </table>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-estas-seguro',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-estas-seguroLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: '¿Estás seguro?',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">\n                    se modificará el plan actual para la empresa, ten en cuenta que la información de consumo puede variar entre este plan modificado y los que no lo están pero tienen el mismo nombre.\n                    <br>\n                    <br>\n                    Personaliza tu plan para esta empresa.\n                </span>\n            </div>\n            <div class=\"col-12 px-4 mb-4 mt-3\">\n                <div class=\"row m-0 w-100\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                        texto: 'Cancelar',\n                        onclick: 'cancelarEdicion();',\n                        adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                    })}\n                    ${crearBoton({\n                        id: 'boton-estoy-seguro',\n                        type: 'button',\n                        clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                        texto: 'Si, estoy seguro',\n                        onclick: 'confirmarEdicion();'\n                    })}\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-planes-creditos',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planes-creditosLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir Plan de Créditos IA',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100 mb-3\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda-credito\">\n                            <i class=\"bi bi-search\"></i>\n                            <input type=\"text\" id=\"buscador-plan-credito\" class=\"rounded-2 text-body-2\" placeholder=\"Buscar\">\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan-credito',\n                            name: 'filtro-plan-credito',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanesCreditos();',\n                            opciones: [\n                                { nombre: 'Mayor a menor', id: 'Mayor' },\n                                { nombre: 'Menor a mayor', id: 'Menor' },\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div id=\"contenedor-planes-creditos\">\n                    <!-- Los planes se cargarán dinámicamente aquí -->\n                </div>\n            </div>\n        `\n    })}\n@endsection\n@endsection\n\n@section('scripts')\n    <script src=\"{{ asset('js/empresas/asignar-plan.js') }}\" type=\"text/javascript\"></script>\n    <script type=\"text/javascript\">\n        @if ($opcion == 'asignar')\n            opcion = 'asignar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            plan_seleccionado = null;\n        @elseif ($opcion == 'facturar')\n            opcion = 'facturar';\n            empresa = @json($empresa);\n            resource_url = '/facturar-plan';\n            empresa_plan = @json($empresa_plan);\n            plan_seleccionado = @json($empresa_plan->plan);\n            plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n            plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n            plan_seleccionado.unidades = empresa_plan.unidades\n            plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n            plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n            plan_seleccionado.precio = empresa_plan.precio;\n            pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n            @endif\n\n            // Determinar los tipos de prueba a seleccionar\n            let tipos_a_seleccionar_facturar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                tipos_a_seleccionar_facturar.push('2');\n            @endif\n\n            // Establecer los tipos de prueba en el select\n            $('#tipo_prueba_id').val(tipos_a_seleccionar_facturar).trigger('change');\n\n            seleccionarTipoPruebaMultiple();\n            buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n\n            // Esperar a que el DOM esté listo para establecer valores\n            $(document).ready(function() {\n                @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    // Dar tiempo para que se cargue seleccionarTipoPruebaMultiple() y sus AJAX\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 1000);\n                @endif\n            });\n        @elseif ($opcion == 'editar')\n            opcion = 'editar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            empresa_plan = @json($empresa_plan);\n\n            // Obtener el tipo de edición desde la URL\n            let tipo_edicion = '{{ request()->get(\"tipo\", \"seleccion\") }}';\n\n            @if(request()->get('tipo') == 'creditos' && isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                // Editar plan de créditos\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n                plan_creditos_seleccionado.creditos = empresa_plan.creditos;\n                plan_seleccionado = null;\n                pruebas_empresa_plan = []; \n                $('#seccion-pruebas').hide();\n\n                // Establecer tipo 2 (créditos) en el select\n                $('#tipo_prueba_id').val(['2']).trigger('change');\n\n                $(document).ready(function() {\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 500);\n                });\n            @else\n                // Editar plan de selección\n                plan_seleccionado = @json($empresa_plan->plan);\n                plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n                plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n                plan_seleccionado.unidades = empresa_plan.unidades\n                plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n                plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n                plan_seleccionado.precio = empresa_plan.precio;\n                pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n                // Establecer tipo de selección en el select\n                let tipos_a_seleccionar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n                $('#tipo_prueba_id').val(tipos_a_seleccionar).trigger('change');\n\n                seleccionarTipoPruebaMultiple();\n                buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n            @endif\n        @endif\n    </script>\n@endsection\n","structuredPatch":[{"oldStart":95,"oldLines":6,"newStart":95,"newLines":7,"lines":["                 </div>","             </div>"," ","+            <input type=\"hidden\" id=\"precio_plan_original\" name=\"precio\" value=\"\">","             <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">","                 <div class=\"col-6\">","                     ${crearInput({"]},{"oldStart":102,"oldLines":16,"newStart":103,"newLines":19,"lines":["                         name: 'porcentaje_descuento',","                         type: 'number',","                         autocomplete: 'off',","+                        min: 0,","                         max: 100,","                         value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',","                         label: 'Porcentaje de descuento',","-                        label_class: 'optional'","+                        label_class: 'optional',","+                        onkeyup: 'aplicarDescuento(\"plan\");',","+                        onchange: 'aplicarDescuento(\"plan\");'","                     })}","                 </div>","                 <div class=\"col-6\">","                     ${crearInput({","-                        id: 'precio_plan',","-                        name: 'precio',","+                        id: 'precio_plan_visual',","+                        name: 'precio_plan_visual',","                         class: 'cleave',","                         autocomplete: 'off',","                         minlength: 3,"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"ffcc99ff-e130-4716-8bb9-3b22a8f5121b"}
{"parentUuid":"4c191de5-9d81-4601-af23-861523bf08f5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01XV2DQSrzgdguUnonAvyYia","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora también debo cambiar la sección de créditos para usar la función genérica `aplicarDescuento(\"creditos\")` en lugar de `aplicarDescuentoCreditos()`.","signature":"EsYCCkYICxgCKkDy+UkDgigGvrRYXNRZU5EysthgM0rdPTi/T53skCDdpjaUAgkjc/2VQwVusRT/obAJxwLP0CFc0P6fZ4JVQaWUEgxRbGW5guf/tV9LnBAaDOCfS94Siv6J05XZbyIw5qCBkgrx0FdnuiFDqAYLqWgU5A6t3Gj5k85uA8eOnJk83qdxyorheUg/G/tDwcmEKq0Bc57UcNC+mtAApc1cQfH8rAFkyeVfoijnqix0MkdemvuQzqXISC1WyVj+qicmKLJ2JPM3FLIet0DDGjm7kZXSdlQdcqKTUbMoNZueNgizJ9//2puRJSBbEjXLY/lg3s/F8DoEGWgsVXkGB3/JBDMYgTb4MXLTyDvEmCKW8Eb3w3wptlvY5Dk/LDD4j7eVE725crAyfluzo+aHOaCt2SFHOQd+5w0O5jbk3u+1fMgYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1477,"cache_read_input_tokens":65890,"cache_creation":{"ephemeral_5m_input_tokens":1477,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3mwrCgmeHTVfY9tnsR","type":"assistant","uuid":"e8d4f82a-8b83-47df-a649-b0999cd413a7","timestamp":"2026-01-26T13:13:24.210Z"}
{"parentUuid":"e8d4f82a-8b83-47df-a649-b0999cd413a7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01XV2DQSrzgdguUnonAvyYia","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora modifico la sección de créditos para usar la misma función genérica."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1477,"cache_read_input_tokens":65890,"cache_creation":{"ephemeral_5m_input_tokens":1477,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3mwrCgmeHTVfY9tnsR","type":"assistant","uuid":"b34b5666-0ae4-46c9-9e2f-14ce81629f2c","timestamp":"2026-01-26T13:13:24.616Z"}
{"parentUuid":"b34b5666-0ae4-46c9-9e2f-14ce81629f2c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01XV2DQSrzgdguUnonAvyYia","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BYmDRaNHC3s1iJfyJgbFTp","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","old_string":"onkeyup: 'aplicarDescuentoCreditos();',\n                                onchange: 'aplicarDescuentoCreditos();'","new_string":"onkeyup: 'aplicarDescuento(\"creditos\");',\n                                onchange: 'aplicarDescuento(\"creditos\");'"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1477,"cache_read_input_tokens":65890,"cache_creation":{"ephemeral_5m_input_tokens":1477,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3mwrCgmeHTVfY9tnsR","type":"assistant","uuid":"0e3a5f9a-f9ef-4d6a-9479-390208ed83fb","timestamp":"2026-01-26T13:13:25.987Z"}
{"parentUuid":"0e3a5f9a-f9ef-4d6a-9479-390208ed83fb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BYmDRaNHC3s1iJfyJgbFTp","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   143→                                max: 100,\n   144→                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n   145→                                label: 'Porcentaje de descuento',\n   146→                                label_class: 'optional',\n   147→                                onkeyup: 'aplicarDescuento(\"creditos\");',\n   148→                                onchange: 'aplicarDescuento(\"creditos\");'\n   149→                            })}\n   150→                        </div>\n   151→                        <div class=\"col-6\">\n   152→                            ${crearInput({"}]},"uuid":"e996bada-c283-4791-b0d9-88926899f455","timestamp":"2026-01-26T13:13:53.806Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","oldString":"onkeyup: 'aplicarDescuentoCreditos();',\n                                onchange: 'aplicarDescuentoCreditos();'","newString":"onkeyup: 'aplicarDescuento(\"creditos\");',\n                                onchange: 'aplicarDescuento(\"creditos\");'","originalFile":"@extends('layouts.app')\n@php\n    $titulo_pagina = isset($empresa_id) ? 'Asignar plan' : 'Facturar';\n@endphp\n@section('titulo', $titulo_pagina)\n\n@section('estilos')\n    <link href=\"{{ asset('css/empresas/empresas.css') }}\" rel=\"stylesheet\">\n@endsection\n\n@section('contenido')\n    <div class=\"container-fluid mt-4\">\n        <div class=\"text-headline-6 mb-0\">\n            <i class=\"bi bi-chevron-left h4 mb-0 text-primary me-5 pointer\" onclick=\"window.history.back();\"></i>\n            @if ($opcion == 'asignar')\n                Asignar plan\n            @elseif ($opcion == 'facturar')\n                Facturar plan\n            @elseif ($opcion == 'editar')\n                Editar asignación de plan\n            @endif\n        </div>\n    </div>\n    <div class=\"container mt-8\">\n        <form id=\"formulario\" enctype=\"multipart/form-data\">\n            @csrf\n            @isset ($empresa_id)\n                <input type=\"hidden\" id=\"empresa_id\" name=\"empresa_id\" value=\"{{ $empresa_id }}\">\n            @endisset\n            @isset ($empresa_plan)\n                <input type=\"hidden\" id=\"id\" name=\"id\" class=\"input-dinamico\" value=\"{{ $empresa_plan->id }}\">\n            @endisset\n            <input type=\"hidden\" id=\"pruebas\" name=\"pruebas\" value=\"\">\n            <input type=\"hidden\" id=\"vigencia\" name=\"vigencia\">\n            <input type=\"hidden\" id=\"unidades\" name=\"unidades\">\n            <input type=\"hidden\" id=\"cantidad_ofertas_laborales\" name=\"cantidad_ofertas_laborales\">\n            <input type=\"hidden\" id=\"cantidad_usuarios\" name=\"cantidad_usuarios\">\n            <input type=\"hidden\" id=\"cantidad_pruebas\" name=\"cantidad_pruebas\">\n            <input type=\"hidden\" id=\"plan_credito_id\" name=\"plan_credito_id\" value=\"\">\n            <input type=\"hidden\" id=\"creditos\" name=\"creditos\" value=\"\">\n            <input type=\"hidden\" id=\"funcionalidades\" name=\"funcionalidades\" value=\"\">\n            <div class=\"row mt-6\">\n                <div class=\"col-12\">\n                    ${crearMultiselect({\n                        opciones: [\n                            { nombre: 'Planes de selección', id: '1' },\n                            { nombre: 'Planes de créditos (IA)', id: '2' }\n                        ],\n                        id: 'tipo_prueba_id',\n                        name: 'tipo_prueba_id',\n                        class: 'clase-personalizada',\n                        onchange: 'seleccionarTipoPruebaMultiple();',\n                        placeholder: 'Tipo de plan',\n                        icono: '<i class=\"bi bi-check-circle input-icono1\"></i>',\n                        label: 'Tipo de plan',\n                        disabled: {{ $opcion != 'asignar' ? 'true' : 'false' }}\n                    })}\n                </div>\n            </div>\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-plan\">\n                    </div>\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'plan_id',\n                        name: 'plan_id',\n                        adicional: 'style=\"width: 0px; height: 0px;\"',\n                        class: 'p-0 border-0',\n                        required: true,\n                        input_container_class: 'mb-0'\n                    })}\n                </div>\n            </div>\n\n            <div class=\"row mt-7 d-none\" id=\"seccion-pruebas\">\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4 mb-5\">Pruebas</h4>\n                    <span class=\"text-body-2\">Selecciona las <span class=\"cantidad-pruebas\"></span> prueba(s) que vas a asignar a esta empresa.</span>\n                </div>\n                <div class=\"col-12 col-lg-6\">\n                    <div class=\"row\" id=\"contenedor-pruebas\">\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-5 d-none\" id=\"alerta-pruebas\">\n                <div class=\"col-12\">\n                    ${crearAlerta(\n                        'warning',\n                        'Recuerda que solo tienes <span class=\"cantidad-pruebas\">{{ $empresa_plan->cantidad_pruebas ?? ''}}</span> prueba(s) disponibles.',\n                        'w-100 mb-0'\n                    )}\n                </div>\n            </div>\n\n            <input type=\"hidden\" id=\"precio_plan_original\" name=\"precio\" value=\"\">\n            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        min: 0,\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional',\n                        onkeyup: 'aplicarDescuento(\"plan\");',\n                        onchange: 'aplicarDescuento(\"plan\");'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan_visual',\n                        name: 'precio_plan_visual',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>\n            \n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <input type=\"hidden\" id=\"precio_creditos_original\" name=\"precio_creditos\" value=\"\">\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                min: 0,\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional',\n                                onkeyup: 'aplicarDescuentoCreditos();',\n                                onchange: 'aplicarDescuentoCreditos();'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos_visual',\n                                name: 'precio_creditos_visual',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-7\">\n                <div class=\"col-12 mt-5 mb-4\">\n                    <h4 class=\"text-headline-4\">Valor</h4>\n                    <span class=\"text-body-2\">Revisa el precio final y adjunta la factura.</span>\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'numero_factura',\n                        name: 'numero_factura',\n                        type: 'text',\n                        autocomplete: 'off',\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->numero_factura : '' }}',\n                        required: true,\n                        label: 'Número de factura o concepto'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    @if ($opcion == 'editar' && isset($empresa_plan['archivos'][0]))\n                        <div class=\"card h-auto border-secondary\">\n                            <div class=\"card-body p-2 rounded-4\">\n                                ${crearBoton({\n                                    url: '#',\n                                    clases: 'w-100 d-flex justify-content-between pointer bg-transparent border-0 p-0',\n                                    texto: `\n                                        <div class=\"px-4 text-cta-blue text-decoration-none\">\n                                            {{$empresa_plan['archivos'][0]['nombre']}}\n                                        </div>\n                                        <div class=\"px-4\">\n                                            <i class=\"bi bi-eye-fill text-cta-blue\"></i>\n                                        </div>\n                                    `,\n                                    onclick: `abrirFacturaPlan('{{$empresa_plan['archivos'][0]['id']}}')`\n                                })}\n                            </div>\n                        </div>\n                    @else\n                        ${crearInputFile({\n                            id: 'factura',\n                            name: 'factura',\n                            class: 'input-form',\n                            placeholder: '',\n                            required: false,\n                            accept: 'application/pdf',\n                        })}\n                    @endif\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    ${crearTextarea({\n                        id: 'comentario',\n                        name: 'comentario',\n                        maxlength: 255,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->comentario : '' }}',\n                        label: 'Comentario o detalle de uso',\n                        label_class: 'optional'\n                    })}\n                </div>\n            </div>\n\n            @if ($opcion == 'asignar')\n                <div class=\"row mt-3\">\n                    <div class=\"col-12 mt-5 mb-4\">\n                        <h4 class=\"text-headline-4\"><strong>Valor de venta: <span id=\"valor-venta-mostrar\">0</span></strong></h4>\n                    </div>\n                </div>\n            @endif\n\n            <div class=\"row mt-3 pb-4\">\n                <div class=\"col-12 text-center\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'btn-outline-primary me-2 px-14 text-blue-40',\n                        texto: 'Cancelar',\n                        url: `/empresas-gestionar/{{ isset($empresa_id) ? $empresa_id : '' }}`\n                    })}\n                    ${crearBoton({\n                        id: `boton-asignar`,\n                        type: `submit`,\n                        clases: `btn-primary px-12`,\n                        texto: `@if ($opcion == \"asignar\") Asignar plan @elseif ($opcion == \"facturar\") Guardar @elseif ($opcion == \"editar\") Guardar @endif`\n                    })}\n                </div>\n            </div>\n        </form>\n    </div>\n@section('modals')\n    ${crearModal({\n        id: 'modal-planes',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir plan',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda\">\n                            <i class=\"bi bi-search\"></i>\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan',\n                            name: 'filtro-plan',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanes();',\n                            opciones: [\n                                { nombre: 'Todos', id: 'Todos' },\n                                { nombre: 'Por vacantes', id: 'Ofertas' },\n                                { nombre: 'Por unidades', id: 'Unidades' },\n                                { nombre: 'Por tiempo', id: 'Tiempo' }\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                    <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                        <thead class=\"d-none\">\n                            <tr>\n                                <th></th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tbody-planes\">\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-modificar-planes',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-modificar-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: 'Modificar plan - <span id=\"nombre-plan-modal\">{{ isset($empresa_plan) && $empresa_plan->plan ? \" \" . $empresa_plan->plan->nombre : (isset($empresa_plan) && $empresa_plan->planCredito ? \" \" . $empresa_plan->planCredito->nombre : \"\") }}</span>',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">Personaliza tu plan para esta empresa.</span>\n            </div>\n            <div class=\"row m-0 w-100\">\n                <div class=\"col-12\" id=\"input-container-pruebas\">\n                    ${crearSelect2({\n                        id: 'cantidad_pruebas_modal',\n                        name: 'cantidad_pruebas_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar();',\n                        opciones: [\n                            { nombre: '', id: '' },\n                            @if (isset($empresa_plan))\n                                @for ($i = 1; $i <= 8; $i++)\n                                    { nombre: '{{ $i }} Pruebas', id: '{{ $i }}', selected: {{ $empresa_plan->cantidad_pruebas == $i ? 'true' : 'false' }} },\n                                @endfor\n                            @endif\n                        ],\n                        label: 'Pruebas disponibles'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\" id=\"input-container-tiempo\">\n                    ${crearSelect2({\n                        id: 'tiempo_modal',\n                        name: 'tiempo_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar(); seleccionarTiempo(this.value);',\n                        opciones: [\n                            { nombre: 'Seleccione', id: '' },\n                            { nombre: '3 Meses', id: '90', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 90 ? 'true' : 'false' }} },\n                            { nombre: '6 Meses', id: '180', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 180 ? 'true' : 'false' }} },\n                            { nombre: '1 Año', id: '365', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 365 ? 'true' : 'false' }} },\n                            { nombre: 'Personalizado', id: 'personalizado' }\n                        ],\n                        label: 'Tiempo'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6 d-none\" id=\"input-container-vigencia\">\n                    ${crearInput({\n                        id: 'vigencia_modal',\n                        name: 'vigencia_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Días'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'unidades_modal',\n                        name: 'unidades_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->unidades : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Unidades <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'cantidad_ofertas_laborales_modal',\n                        name: 'cantidad_ofertas_laborales_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_ofertas_laborales : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Vacantes <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4\">Beneficios</h4>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"adicionales_modal\" name=\"adicionales_modal[]\" data-placeholder=\"Adicionales\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"predefinidos_modal\" name=\"predefinidos_modal[]\" data-placeholder=\"Predefinidos\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    ${crearInput({\n                        id: 'cantidad_usuarios_modal',\n                        name: 'cantidad_usuarios_modal',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_usuarios : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Usuarios'\n                    })}\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"alert badge-estado-renovado fw-bold\">\n                        Recuerda que no es posible cambiar entre planes con cantidades fijas a ilimitados o viceversa.\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row m-0 w-100\">\n                        ${crearBoton({\n                            type: 'button',\n                            clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                            texto: 'Cancelar',\n                            onclick: 'cancelarEdicion();',\n                            adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                        })}\n                        ${crearBoton({\n                            id: 'boton-guardar-modificaciones',\n                            type: 'button',\n                            clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                            texto: 'Guardar modificaciones',\n                            onclick: 'abrirModalEstasSeguro();',\n                            disabled: true\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                    <thead class=\"d-none\">\n                        <tr>\n                            <th></th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"tbody-planes\">\n                    </tbody>\n                </table>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-estas-seguro',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-estas-seguroLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: '¿Estás seguro?',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">\n                    se modificará el plan actual para la empresa, ten en cuenta que la información de consumo puede variar entre este plan modificado y los que no lo están pero tienen el mismo nombre.\n                    <br>\n                    <br>\n                    Personaliza tu plan para esta empresa.\n                </span>\n            </div>\n            <div class=\"col-12 px-4 mb-4 mt-3\">\n                <div class=\"row m-0 w-100\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                        texto: 'Cancelar',\n                        onclick: 'cancelarEdicion();',\n                        adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                    })}\n                    ${crearBoton({\n                        id: 'boton-estoy-seguro',\n                        type: 'button',\n                        clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                        texto: 'Si, estoy seguro',\n                        onclick: 'confirmarEdicion();'\n                    })}\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-planes-creditos',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planes-creditosLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir Plan de Créditos IA',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100 mb-3\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda-credito\">\n                            <i class=\"bi bi-search\"></i>\n                            <input type=\"text\" id=\"buscador-plan-credito\" class=\"rounded-2 text-body-2\" placeholder=\"Buscar\">\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan-credito',\n                            name: 'filtro-plan-credito',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanesCreditos();',\n                            opciones: [\n                                { nombre: 'Mayor a menor', id: 'Mayor' },\n                                { nombre: 'Menor a mayor', id: 'Menor' },\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div id=\"contenedor-planes-creditos\">\n                    <!-- Los planes se cargarán dinámicamente aquí -->\n                </div>\n            </div>\n        `\n    })}\n@endsection\n@endsection\n\n@section('scripts')\n    <script src=\"{{ asset('js/empresas/asignar-plan.js') }}\" type=\"text/javascript\"></script>\n    <script type=\"text/javascript\">\n        @if ($opcion == 'asignar')\n            opcion = 'asignar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            plan_seleccionado = null;\n        @elseif ($opcion == 'facturar')\n            opcion = 'facturar';\n            empresa = @json($empresa);\n            resource_url = '/facturar-plan';\n            empresa_plan = @json($empresa_plan);\n            plan_seleccionado = @json($empresa_plan->plan);\n            plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n            plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n            plan_seleccionado.unidades = empresa_plan.unidades\n            plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n            plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n            plan_seleccionado.precio = empresa_plan.precio;\n            pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n            @endif\n\n            // Determinar los tipos de prueba a seleccionar\n            let tipos_a_seleccionar_facturar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                tipos_a_seleccionar_facturar.push('2');\n            @endif\n\n            // Establecer los tipos de prueba en el select\n            $('#tipo_prueba_id').val(tipos_a_seleccionar_facturar).trigger('change');\n\n            seleccionarTipoPruebaMultiple();\n            buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n\n            // Esperar a que el DOM esté listo para establecer valores\n            $(document).ready(function() {\n                @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    // Dar tiempo para que se cargue seleccionarTipoPruebaMultiple() y sus AJAX\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 1000);\n                @endif\n            });\n        @elseif ($opcion == 'editar')\n            opcion = 'editar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            empresa_plan = @json($empresa_plan);\n\n            // Obtener el tipo de edición desde la URL\n            let tipo_edicion = '{{ request()->get(\"tipo\", \"seleccion\") }}';\n\n            @if(request()->get('tipo') == 'creditos' && isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                // Editar plan de créditos\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n                plan_creditos_seleccionado.creditos = empresa_plan.creditos;\n                plan_seleccionado = null;\n                pruebas_empresa_plan = []; \n                $('#seccion-pruebas').hide();\n\n                // Establecer tipo 2 (créditos) en el select\n                $('#tipo_prueba_id').val(['2']).trigger('change');\n\n                $(document).ready(function() {\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 500);\n                });\n            @else\n                // Editar plan de selección\n                plan_seleccionado = @json($empresa_plan->plan);\n                plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n                plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n                plan_seleccionado.unidades = empresa_plan.unidades\n                plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n                plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n                plan_seleccionado.precio = empresa_plan.precio;\n                pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n                // Establecer tipo de selección en el select\n                let tipos_a_seleccionar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n                $('#tipo_prueba_id').val(tipos_a_seleccionar).trigger('change');\n\n                seleccionarTipoPruebaMultiple();\n                buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n            @endif\n        @endif\n    </script>\n@endsection\n","structuredPatch":[{"oldStart":144,"oldLines":8,"newStart":144,"newLines":8,"lines":["                                 value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',","                                 label: 'Porcentaje de descuento',","                                 label_class: 'optional',","-                                onkeyup: 'aplicarDescuentoCreditos();',","-                                onchange: 'aplicarDescuentoCreditos();'","+                                onkeyup: 'aplicarDescuento(\"creditos\");',","+                                onchange: 'aplicarDescuento(\"creditos\");'","                             })}","                         </div>","                         <div class=\"col-6\">"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"0e3a5f9a-f9ef-4d6a-9479-390208ed83fb"}
{"parentUuid":"e996bada-c283-4791-b0d9-88926899f455","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01H8SjCrCaRuQsp7Di8CYDtj","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora necesito modificar el archivo JavaScript para:1. Actualizar la función `mostrarPlanSeleccionado()` para usar los nuevos campos (`precio_plan_original` y `precio_plan_visual`)2. Modificar `actualizarValorDesdeInput()` para usar los campos visuales3. Agregar la función genérica `aplicarDescuento(tipo)` que funcione para ambos tipos\n\nVoy a leer el archivo JS actual para ver su estado y hacer las modificaciones necesarias.","signature":"EtYECkYICxgCKkCNCy9lfBp6liAkSm6ykePUxG7qQ2fnfm+yxeTla7a19B8FCuOYlMV0wc5iMvCq2QMkyslMrj+M2qQUVsb0IZNcEgyieH9SnPY5p2lZq6IaDA290euQK7CLUM0nNSIwvFrGALuQZyD8dr87h8+QSA4weeZVGE7NCdn1Oj4zgaoY3ecgQVpvpJXeGy3sTnQ4Kr0D7MPaIBWgBtoUsFmuUfTxezBWInu/GbFdBcFm7uWM+wmMZ6LnR7BcHckL3BSFeMGxnKnFicr9nqTm3prOPx1fTi992QKuIFEB0dx6oQwbQhJATh06dPgRvxB7E6QsOXFZnj5lFFezdp72NQjZPf5jnojD8HG6s52Z0JtTMvq5/uH8HL63BRbgtuMfNL/Ja93xfy/O0vkdMd1lOAQ0iuH9G94JnnU18+yqvzOmY3vSz0mqi/04/L7n4n9dKpto4IELCFZshQ3qMad3/tLjwvB9/pDOQUvIC5+iltC2/rieJ1er3iSGfv7DbTPh+b71A2MRqn4yHr52xsT4JeUBojB7hnsLgovggXNGy1Voqi0C77DEGi+yf6nYmIt8wtEpwtG72d2kOVW5cXMeOg4HMEEOZlCiWHS7K6sbiC69PlnMV2jG8agyVBTWNFxIo9+V0ByOheqeQeMJvMN1rNChZXa4uzzB9icR0mEN1Bt8SCY7EgYOJ54zH76rjk4zARjTlW2/FGGn4k200/yNd2CDFEL0EnPo1ZGUGgPhyMjXGWpo2XsPApBgOVMpZzYP3jyq5Pz+diBx3tyVZnL+DYkotBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":527,"cache_read_input_tokens":67367,"cache_creation":{"ephemeral_5m_input_tokens":527,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3pRXeRZUTRFvq9zsjg","type":"assistant","uuid":"f94ec4f1-05f6-438e-852d-4e03c70a3f53","timestamp":"2026-01-26T13:13:59.386Z"}
{"parentUuid":"f94ec4f1-05f6-438e-852d-4e03c70a3f53","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01H8SjCrCaRuQsp7Di8CYDtj","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora modifico el archivo JavaScript. Primero actualizo la función `mostrarPlanSeleccionado()` para usar los nuevos campos."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":527,"cache_read_input_tokens":67367,"cache_creation":{"ephemeral_5m_input_tokens":527,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3pRXeRZUTRFvq9zsjg","type":"assistant","uuid":"8352fbce-347c-4dbc-9cc4-823d2c8b58c9","timestamp":"2026-01-26T13:13:59.865Z"}
{"parentUuid":"8352fbce-347c-4dbc-9cc4-823d2c8b58c9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01H8SjCrCaRuQsp7Di8CYDtj","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0112J1s6CUSyh4Np96g3hdBk","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","offset":585,"limit":50}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":527,"cache_read_input_tokens":67367,"cache_creation":{"ephemeral_5m_input_tokens":527,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3pRXeRZUTRFvq9zsjg","type":"assistant","uuid":"32ba22f9-0754-420a-a98b-f0d984050ae9","timestamp":"2026-01-26T13:14:00.608Z"}
{"parentUuid":"32ba22f9-0754-420a-a98b-f0d984050ae9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0112J1s6CUSyh4Np96g3hdBk","type":"tool_result","content":"   585→                            Elegir Plan de Créditos IA\n   586→                        </button>\n   587→                    </div>\n   588→                </div>\n   589→            </div>\n   590→        `;\n   591→        $('#contenedor-creditos').append(seccion_creditos);\n   592→    }\n   593→    $('#plan_id').val(plan_seleccionado.id);\n   594→    $('#seccion-pruebas').removeClass('d-none');\n   595→    \n   596→    // Mostrar campos de precio para plan de selección\n   597→    $('#contenedor-precio-plan').removeClass('d-none');\n   598→    $('#precio_plan').val(plan_seleccionado.precio).trigger('input');\n   599→\n   600→    // Verificar si Bootstrap modal está disponible antes de usar\n   601→    if (typeof $.fn.modal !== 'undefined') {\n   602→        $('#modal-planes').modal('hide');\n   603→    }\n   604→    ValidarPruebas();\n   605→    $('#boton-guardar-modificaciones').prop('disabled', true);\n   606→    actualizarValorVentaTotal();\n   607→}\n   608→\n   609→/**\n   610→ * Actualizar el valor de venta total sumando plan de selección y créditos.\n   611→ * \n   612→ * @returns {void}\n   613→ * @author Andres Gonzalez\n   614→ */\n   615→function actualizarValorVentaTotal() {\n   616→    let valor_plan = 0;\n   617→    let valor_creditos = 0;\n   618→\n   619→    if (plan_seleccionado && plan_seleccionado.precio) {\n   620→        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n   621→    }\n   622→\n   623→    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n   624→        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n   625→    }\n   626→\n   627→    let valor_total = valor_plan + valor_creditos;\n   628→\n   629→    // Formatear el valor con separador de miles\n   630→    let valor_formateado = valor_total.toLocaleString('es-CO');\n   631→\n   632→    $('#valor-venta-mostrar').text(valor_formateado);\n   633→}\n   634→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"d4ca6215-7a04-4559-8d87-1b89d6f500f6","timestamp":"2026-01-26T13:14:01.881Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","content":"                            Elegir Plan de Créditos IA\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n        $('#contenedor-creditos').append(seccion_creditos);\n    }\n    $('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n    \n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    $('#precio_plan').val(plan_seleccionado.precio).trigger('input');\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}\n\n/**\n * Actualizar el valor de venta total sumando plan de selección y créditos.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorVentaTotal() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n    }\n\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n","numLines":50,"startLine":585,"totalLines":1034}},"sourceToolAssistantUUID":"32ba22f9-0754-420a-a98b-f0d984050ae9"}
{"parentUuid":"d4ca6215-7a04-4559-8d87-1b89d6f500f6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01JiMjfM2X2VZMazPS6dRbPN","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora veo la sección donde se establece el precio del plan. Necesito modificar la línea 598 para usar los nuevos campos. Vamos a hacer las modificaciones en el JS.","signature":"Es4CCkYICxgCKkAMID5INFG6i1WvmoQRcDkPYDUVQbJzzy0VkxHcHnrqPom5aTxh/nKCWe2TWKWlOC4gj++2i5JgUOUT9GS7MLRGEgzv2RphiyGhI8cJ6PYaDKqe5FFpzDiwlKMvnCIweftC88joJEPXBOepRf+tNdCCNoZjdEJ12CoTwyiIeEL3yzd/Ost+hLcjNctmAq6KKrUBZTAWG7Yb9pz36KPSF3un0VcfpKqGo4ch8dm+CI0h2vKWOKojqFeJqooJLUm1edfHuWaX4rbxsT/3yZ2ZXkMqtu9bNegFYic/QWQE5at4j/snOGY+zU3IkV73GkdQolXF7daheIwnNEd2UhQOtVYyukr/1IDOqt6soooI2NyFrZbr7Gx4XyFPrlO5Qvck9PLyV+B+1oRi1le+BsCDaOUDNMo3lDJ7j0w04nmRv9P9B4plHYR67hgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1130,"cache_read_input_tokens":67894,"cache_creation":{"ephemeral_5m_input_tokens":1130,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXW3pwaAXQtRAvX3QjaFv","type":"assistant","uuid":"a71d3ec4-7a50-464e-bd15-a12c3b337c8a","timestamp":"2026-01-26T13:14:04.735Z"}
{"parentUuid":"a71d3ec4-7a50-464e-bd15-a12c3b337c8a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01JiMjfM2X2VZMazPS6dRbPN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Aig6px1erMLV2jVzTMXnfK","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"$('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n    \n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    $('#precio_plan').val(plan_seleccionado.precio).trigger('input');\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}","new_string":"$('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n\n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_plan_original').val(plan_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_plan_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento').val('');\n    }\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1130,"cache_read_input_tokens":67894,"cache_creation":{"ephemeral_5m_input_tokens":1130,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXW3pwaAXQtRAvX3QjaFv","type":"assistant","uuid":"4464f347-f2f5-4c8e-ade1-303143858caf","timestamp":"2026-01-26T13:14:09.307Z"}
{"parentUuid":"4464f347-f2f5-4c8e-ade1-303143858caf","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Aig6px1erMLV2jVzTMXnfK","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   589→            </div>\n   590→        `;\n   591→        $('#contenedor-creditos').append(seccion_creditos);\n   592→    }\n   593→    $('#plan_id').val(plan_seleccionado.id);\n   594→    $('#seccion-pruebas').removeClass('d-none');\n   595→\n   596→    // Mostrar campos de precio para plan de selección\n   597→    $('#contenedor-precio-plan').removeClass('d-none');\n   598→    if (plan_seleccionado && plan_seleccionado.precio) {\n   599→        // Guardar el valor original en el campo hidden\n   600→        $('#precio_plan_original').val(plan_seleccionado.precio);\n   601→        // Mostrar el valor en el campo visual\n   602→        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n   603→        // Habilitar el campo visual inicialmente\n   604→        $('#precio_plan_visual').prop('disabled', false);\n   605→        // Limpiar el porcentaje de descuento\n   606→        $('#porcentaje_descuento').val('');\n   607→    }\n   608→\n   609→    // Verificar si Bootstrap modal está disponible antes de usar\n   610→    if (typeof $.fn.modal !== 'undefined') {\n   611→        $('#modal-planes').modal('hide');\n   612→    }\n   613→    ValidarPruebas();\n   614→    $('#boton-guardar-modificaciones').prop('disabled', true);\n   615→    actualizarValorVentaTotal();\n   616→}\n   617→\n   618→/**\n   619→ * Actualizar el valor de venta total sumando plan de selección y créditos.\n   620→ * "}]},"uuid":"df11995f-ad39-43b3-94b8-3b46a68853bd","timestamp":"2026-01-26T13:14:37.085Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","oldString":"$('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n    \n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    $('#precio_plan').val(plan_seleccionado.precio).trigger('input');\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}","newString":"$('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n\n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_plan_original').val(plan_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_plan_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento').val('');\n    }\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}","originalFile":"table = null;\nplanes = [];\npruebas = [];\nmodificado = false;\nfuncionalidades_predefinidos = [];\nplan_creditos_seleccionado = null;\n\n$(document).ready(function() {\n    $(document).on('input', '#precio_plan, #precio_creditos', function() {\n        actualizarValorDesdeInput();\n    });\n});\n\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales\n */\nfunction seleccionarTipoPrueba(tipo_prueba_id) {\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"card-body text-center\">\n            <button type=\"button\" id=\"elegir-plan\" class=\"btn btn-outline-primary\" disabled onclick=\"modalElegirPlan();\">Elegir plan</button>\n        </div>\n    `);\n    $('#seccion-pruebas').addClass('d-none');\n    $('#plan_id').val('');\n    pruebas = [];\n    // Convertir tipo_prueba_id a array si no lo es\n    let tipos_prueba = Array.isArray(tipo_prueba_id) ? tipo_prueba_id : [tipo_prueba_id];\n    // Crear los botones según los tipos de prueba seleccionados\n    let botones_html = '<div class=\"card-body text-center\">';\n    tipos_prueba.forEach(function(tipo_id) {\n        let texto_boton = 'Elegir plan';\n        let clase_boton = 'btn-outline-primary';\n        if (tipo_id == 1) {\n            texto_boton = 'Elegir Plan de Selección';\n            clase_boton = 'btn-outline-primary';\n        } else if (tipo_id == 2) {\n            texto_boton = 'Elegir Plan de Créditos IA';\n            clase_boton = 'btn-outline-info';\n        }\n        botones_html += `\n            <button type=\"button\" id=\"elegir-plan-${tipo_id}\" class=\"btn ${clase_boton} mx-1 my-1\" disabled onclick=\"modalElegirPlan(${tipo_id});\">\n                ${texto_boton}\n            </button>\n        `;\n    });\n    botones_html += '</div>';\n    $('#contenedor-plan').append(botones_html);\n    $('#tipo_prueba_id').val(tipo_prueba_id).trigger('select2');\n    if (tipo_prueba_id && (Array.isArray(tipo_prueba_id) ? tipo_prueba_id.length > 0 : tipo_prueba_id)) {\n        // Habilitar todos los botones creados\n        tipos_prueba.forEach(function(tipo_id) {\n            $(`#elegir-plan-${tipo_id}`).prop('disabled', false);\n        });\n        $.ajax({\n            type: 'GET',\n            url : `/pruebas-listado`,\n            data: {\n                tipo_prueba_id: tipo_prueba_id,\n                activo: 1\n            }\n        }).then((respuesta) => {\n            limpiarAdicional();\n            $('#contenedor-pruebas').empty();\n            pruebas = respuesta.data;\n            for (let i = 0; i < pruebas.length; i++) {\n                $('#contenedor-pruebas').append(`\n                    <div class=\"col-12 col-md-6\">\n                        <div class=\"d-flex align-items-center\">\n                            <div class=\"check-container my-1 me-1\">\n                                <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                            </div>\n                            <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                        </div>\n                    </div>\n                `);\n            }\n            if (opcion == 'facturar' || opcion == 'editar') {\n                for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                    $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n                }\n                $('#seccion-pruebas').removeClass('d-none');\n                mostrarPlanSeleccionado();\n            }\n            if (opcion == 'editar') {\n                $('#tipo_prueba_id').prop('disabled', true);\n            }\n        }).catch((error) => {\n            console.error(error);\n        });\n    } else {\n        $('#elegir-plan').prop('disabled', true);\n    }\n}\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction seleccionarTipoPruebaMultiple() {\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    tipos_prueba = tipos_prueba.filter(function(tipo_id) {\n        return tipo_id !== null && tipo_id !== '' && tipo_id !== undefined;\n    });\n    if (tipos_prueba.length === 0) {\n        // Si no hay tipos seleccionados, limpiar todo\n        $('#contenedor-plan').empty();\n        $('#contenedor-creditos').empty();\n        $('#seccion-pruebas').addClass('d-none');\n        $('#plan_id').val('');\n        $('#plan_id').prop('required', false);\n        $('#plan_id').prop('disabled', true);\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n        plan_seleccionado = null;\n        plan_creditos_seleccionado = null;\n        pruebas = [];\n        return;\n    }\n    let tiene_seleccion = tipos_prueba.includes('1') || tipos_prueba.includes(1);\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    $('#plan_id').prop('required', tiene_seleccion);\n    $('#plan_id').prop('disabled', !tiene_seleccion);\n    // Manejo del plan de selección\n    if (tiene_seleccion) {\n        // Si hay un plan seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_seleccionado === null && $('#contenedor-plan').children().length === 0) {\n            let seccion_seleccion = `\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Selección</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-1\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(1);\">\n                            Elegir Plan de Selección\n                        </button>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-plan').html(seccion_seleccion);\n        }\n    } else {\n        // Si se deseleccionó el tipo de selección, limpiar el plan\n        $('#contenedor-plan').empty();\n        plan_seleccionado = null;\n        $('#plan_id').val('');\n    }\n    // Manejo del plan de créditos\n    if (tiene_creditos) {\n        // Si hay un plan de créditos seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n            let seccion_creditos = `\n                <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                    <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                    <div class=\"card rounded rounded-3\">\n                        <div class=\"card-body text-center\">\n                            <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                                Elegir Plan de Créditos IA\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-creditos').html(seccion_creditos);\n        }\n    } else {\n        // Si se deseleccionó el tipo de créditos, limpiar el plan de créditos\n        $('#contenedor-creditos').empty();\n        $('#contenedor-plan-creditos').remove();\n        plan_creditos_seleccionado = null;\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/pruebas-listado`,\n        data: {\n            tipo_prueba_id: tipos_prueba,\n            activo: 1\n        }\n    }).then((respuesta) => {\n        limpiarAdicional();\n        $('#contenedor-pruebas').empty();\n        pruebas = respuesta.data;\n        for (let i = 0; i < pruebas.length; i++) {\n            $('#contenedor-pruebas').append(`\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"d-flex align-items-center\">\n                        <div class=\"check-container my-1 me-1\">\n                            <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                        </div>\n                        <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                    </div>\n                </div>\n            `);\n        }\n        if (opcion == 'facturar' || opcion == 'editar') {\n            for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n            }\n            $('#seccion-pruebas').removeClass('d-none');\n            mostrarPlanSeleccionado();\n        }\n        if (opcion == 'editar') {\n            $('#tipo_prueba_id').prop('disabled', true);\n        }\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    });\n}\n/**\n * Obtener el listado de planes según el tipo_prueba_id seleccionado anteriormente.\n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalElegirPlan(tipo_especifico = null) {\n    let tipo_prueba_para_consulta = tipo_especifico !== null ? tipo_especifico : $('#tipo_prueba_id').val();\n    // Si es tipo 2 (Créditos IA), cargar planes de créditos\n    if (tipo_prueba_para_consulta == 2 || tipo_prueba_para_consulta == '2') {\n        $.ajax({\n            type: 'GET',\n            url: '/planes-creditos',\n            data: {\n                activo: true\n            }\n        }).then((respuesta) => {\n            planes_creditos = respuesta.data.planes;\n            mostrarPlanesCreditos();\n        }).catch((error) => {\n            mostrarToast('danger', 'Ocurrió un error');\n        });\n        return;\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/planes-listado`,\n        data: {\n            tipo_prueba_id: $('#tipo_prueba_id').val()\n        }\n    }).then((respuesta) => {\n        planes = respuesta.data;\n        mostrarPlanes();\n    }).catch((error) => {\n        console.error(error);\n    });\n}\n/**\n * Mostrar los planes de créditos en el modal.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction mostrarPlanesCreditos() {\n    let filtro_orden = $('#filtro-plan-credito').val();\n    let buscar = $('#buscador-plan-credito').val() || '';\n    // Ordenar planes según el filtro\n    let planes_ordenados = [...planes_creditos];\n    if (filtro_orden === 'Mayor') {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else if (filtro_orden === 'Menor') {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    if (buscar !== '') {\n        planes_ordenados = planes_ordenados.filter(plan =>\n            plan.nombre.toLowerCase().includes(buscar.toLowerCase())\n        );\n    }\n    $('#contenedor-planes-creditos').empty();\n    if (planes_ordenados.length === 0) {\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"text-center py-5\">\n                <p class=\"text-muted\">No se encontraron planes</p>\n            </div>\n        `);\n    }\n    for (let i = 0; i < planes_ordenados.length; i++) {\n        let plan = planes_ordenados[i];\n        let creditos_disponibles = plan.creditos_disponibles || plan.creditos || 0;\n        let creditos_promedio = plan.creditos_promedio_accion || 0;\n        let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n            ? Math.floor(creditos_disponibles / creditos_promedio)\n            : 0;\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"card rounded rounded-3 border-hover pointer mb-3\" onclick=\"elegirPlanCreditos(${i}, ${filtro_orden === 'Mayor' ? 'true' : 'false'});\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6 text-gray-10\">${plan.nombre}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        `);\n    }\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('show');\n    }\n    $('#buscador-plan-credito').off('input').on('input', function() {\n        mostrarPlanesCreditos();\n    });\n}\n/**\n * Elegir un plan de créditos IA.\n * @param {number} indice Índice del plan en el array.\n * @param {boolean} orden_mayor Si está ordenado de mayor a menor.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction elegirPlanCreditos(indice, orden_mayor = false) {\n    // Aplicar el mismo ordenamiento que en mostrarPlanesCreditos\n    let planes_ordenados = [...planes_creditos];\n    if (orden_mayor) {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    plan_creditos_seleccionado = planes_ordenados[indice];\n    // Establecer los valores en los campos hidden\n    $('#plan_credito_id').val(plan_creditos_seleccionado.id);\n    $('#creditos').val(plan_creditos_seleccionado.creditos);\n    mostrarPlanCreditosSeleccionado();\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('hide');\n    }\n}\n/**\n * Mostrar el plan de créditos seleccionado en el contenedor.\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarPlanCreditosSeleccionado() {\n    if (!plan_creditos_seleccionado || !plan_creditos_seleccionado.creditos) {\n        mostrarToast('danger', 'Ocurrió un error'+plan_creditos_seleccionado);\n        return;\n    }\n    let creditos_disponibles = plan_creditos_seleccionado.creditos_disponibles || plan_creditos_seleccionado.creditos || 0;\n    let creditos_promedio = plan_creditos_seleccionado.creditos_promedio_accion || 0;\n    let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n        ? Math.floor(creditos_disponibles / creditos_promedio)\n        : 0;\n    let seccion_creditos = `\n        <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n            <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n            <div class=\"card rounded rounded-3\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4 pointer\" onclick=\"modalElegirPlan(2);\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6\">${plan_creditos_seleccionado.nombre || 'Plan de Créditos'}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan_creditos_seleccionado.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    // Remover el contenedor anterior si existe\n    $('#contenedor-plan-creditos').remove();\n    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n    if ($('#contenedor-creditos').length) {\n        $('#contenedor-creditos').html(seccion_creditos);\n    } else {\n        $('#contenedor-plan').after(seccion_creditos);\n    }\n    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }\n    actualizarValorVentaTotal();\n}\n\n/**\n * Mostrar en el modal los planes obtenidos en el listado.\n * \n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPlanes() {\n    let buscar = $('#buscador-plan').val();\n    let filtro_plan = $('#filtro-plan').val();\n    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n        table.destroy();\n    }\n    $('#buscador-plan').remove();\n    $('#tbody-planes').empty();\n    for (let i = 0; i < planes.length; i++) {\n        if (\n            (filtro_plan == 'Todos') ||\n            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n        ) {\n            let cantidad_usuarios = '';\n            if (planes[i].cantidad_usuarios != null) {\n                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n            }\n            let cantidad_ofertas_laborales = '';\n            if (planes[i].cantidad_ofertas_laborales != null) {\n                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n            }\n            let cantidad_pruebas = '';\n            if (planes[i].cantidad_pruebas != null) {\n                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;\n            }\n            let unidades = '';\n            if (planes[i].unidades != null) {\n                unidades = `<div class=\"col-auto w-90px\"><i class=\"bi bi-box\"></i> ${planes[i].unidades}</div>`;\n            }\n            let vigencia = '';\n            if (planes[i].vigencia == 90) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n            } else if (planes[i].vigencia == 180) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n            }  else if (planes[i].vigencia == 365) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n            } else if (planes[i].vigencia == null || planes[i].vigencia == 0) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n            } else {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${planes[i].vigencia} días</div>`;\n            }\n            $('#tbody-planes').append(`\n                <tr>\n                    <td style=\"border-bottom: 0px!important;\">\n                        <div class=\"border border-1 rounded rounded-2 pointer border-hover\" onclick=\"elegirPlan(${i});\">\n                            <div class=\"row m-0 w-100 px-3 py-5 text-headline-6\">\n                                <div class=\"col\">${planes[i].nombre !== null ? planes[i].nombre : ''}</div>\n                                ${cantidad_ofertas_laborales}\n                                ${unidades}\n                                ${cantidad_usuarios}\n                                ${cantidad_pruebas}\n                                ${vigencia}\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            `);\n        }\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('show');\n    }\n    table = $('#tabla-planes').DataTable({\n        \"paging\": false,\n        \"searching\": true,\n        \"ordering\": false,\n        \"info\": false\n    });\n    let buscador = $('#tabla-planes_wrapper input');\n    $(buscador).addClass('rounded-2 text-body-2');\n    $(buscador).prop('placeholder', 'Buscar');\n    $(buscador).prop('id', 'buscador-plan');\n    $('#input-busqueda').append(buscador);\n    $(buscador).val(buscar).trigger('input');\n}\n/**\n * Elegir un plan del listado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction elegirPlan(i) {\n    plan_seleccionado = planes[i];\n    mostrarPlanSeleccionado();\n}\n/**\n * Mostrar el plan seleccionado en el contenedor y en las opciones del modificar.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction mostrarPlanSeleccionado() {\n    let cantidad_usuarios = '';\n    let cantidad_usuarios_modal = $('#cantidad_usuarios_modal').val();\n    if (cantidad_usuarios_modal != '') {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${cantidad_usuarios_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_usuarios != null) {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${plan_seleccionado.cantidad_usuarios}</div>`;\n    }\n    let cantidad_ofertas_laborales = '';\n    let cantidad_ofertas_laborales_modal = $('#cantidad_ofertas_laborales_modal').val();\n    if (cantidad_ofertas_laborales_modal != '') {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${cantidad_ofertas_laborales_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_ofertas_laborales != null) {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${plan_seleccionado.cantidad_ofertas_laborales}</div>`;\n    }\n    let cantidad_pruebas = '';\n    let cantidad_pruebas_modal = $('#cantidad_pruebas_modal').val();\n    if (cantidad_pruebas_modal != '') {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${cantidad_pruebas_modal}</div>`;\n        $('.cantidad-pruebas').text(cantidad_pruebas_modal);\n    } else if (plan_seleccionado.cantidad_pruebas != null) {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${plan_seleccionado.cantidad_pruebas}</div>`;\n        $('.cantidad-pruebas').text(plan_seleccionado.cantidad_pruebas);\n    }\n    let unidades = '';\n    let unidades_modal = $('#unidades_modal').val();\n    if (unidades_modal != '') {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${unidades_modal}</div>`;\n    } else if (plan_seleccionado.unidades != null) {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${plan_seleccionado.unidades}</div>`;\n    }\n    let vigencia = '';\n    let vigencia_modal = $('#vigencia_modal').val();\n    if (plan_seleccionado.vigencia == 90 || vigencia_modal == '90') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n    } else if (plan_seleccionado.vigencia == 180 || vigencia_modal == '180') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n    }  else if (plan_seleccionado.vigencia == 365 || vigencia_modal == '365') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n    } else if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n    } else if (vigencia_modal != '') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${vigencia_modal} días</div>`;\n    } else {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${plan_seleccionado.vigencia} días</div>`;\n    }\n    let abrir_modal_elegir_plan = '';\n    let icono_editar = `\n        <div class=\"col-auto w-90px\">\n            <button type=\"button\" class=\"btn btn-text-primary text-white btn-circle\" onclick=\"abrirModalModificar(event);\" title=\"Modificar plan\">\n                <i class=\"bi bi-wrench\"></i>\n            </button>\n        </div>\n    `;\n    if (opcion == 'asignar') {\n        abrir_modal_elegir_plan = `onclick=\"modalElegirPlan();\"`;\n        icono_editar = '';\n    }\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"row border rounded rounded-3 m-0 w-100 px-3 py-5 text-headline-6 pointer\" ${abrir_modal_elegir_plan}>\n            <div class=\"col\">${plan_seleccionado.nombre !== null ? plan_seleccionado.nombre : ''} <span id=\"plan-modificado\"></span></div>\n            ${cantidad_ofertas_laborales}\n            ${unidades}\n            ${cantidad_usuarios}\n            ${cantidad_pruebas}\n            ${vigencia}\n            ${icono_editar}\n        </div>\n    `);\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    // Solo agregar el botón de elegir plan de créditos si no hay uno seleccionado y se requiere\n    if (tiene_creditos && plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n        let seccion_creditos = `\n            <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                            Elegir Plan de Créditos IA\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n        $('#contenedor-creditos').append(seccion_creditos);\n    }\n    $('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n    \n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    $('#precio_plan').val(plan_seleccionado.precio).trigger('input');\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}\n\n/**\n * Actualizar el valor de venta total sumando plan de selección y créditos.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorVentaTotal() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n    }\n\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    let valor_plan_input = $('#precio_plan').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Abrir la factura del plan en una nueva pestaña del navegador.\n * \n * @param {number} factura_id Id de la factura.\n * @returns {void}\n * @author Andres Morales\n */\nasync function abrirFacturaPlan(factura_id) {\n    if (!factura_id) {\n        mostrarToast('danger', 'No se encontró la factura');\n        return;\n    }\n    try {\n        const respuesta = await $.ajax({\n            type: 'GET',\n            url: `/archivos-abrir/${factura_id}`,\n            xhrFields: { responseType: 'blob' }\n        });\n        const blobUrl = window.URL.createObjectURL(respuesta);\n        window.open(blobUrl, '_blank');\n    } catch (error) {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    }\n}\n/**\n * Buscar las funcionalidades por tipo de prueba.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidades(tipo_prueba_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/funcionalidades-listado`,\n        data : {\n            tipo_prueba_id: tipo_prueba_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let beneficios = respuesta.data;\n            const ADICIONALES = beneficios\n                .filter(item => item.predeterminado === 0)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            const PREDEFINIDOS = beneficios\n                .filter(item => item.predeterminado === 1)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            funcionalidades_predefinidos = PREDEFINIDOS;\n            // Verificar si el multiselect está inicializado antes de destruir\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect('destroy');\n            }\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect('destroy');\n            }\n            ADICIONALES.forEach((item) => {\n                $('#adicionales_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            PREDEFINIDOS.forEach((item) => {\n                $('#predefinidos_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            inizializarMultiselect();\n            if (opcion == 'facturar' || opcion == 'editar') {\n                buscarfuncionalidadesPlanEmpresa($('#id').val());\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Buscar las funcionalidades del plan de la empresa.\n * @param {number} empresa_plan_id ID del plan de empresa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidadesPlanEmpresa(empresa_plan_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/empresas-planes-funcionalidades-listado`,\n        data : {\n            empresa_plan_id: empresa_plan_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let funcionalidades = respuesta.data.map(item => item.funcionalidad_id);\n            $('#adicionales_modal').val(funcionalidades);\n            // Verificar si el multiselect está inicializado antes de refrescar\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect(\"refresh\");\n            }\n            $('#predefinidos_modal').val(funcionalidades);\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect(\"refresh\");\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Función para agregar validaciones adicionales y data adicional en el envío del form.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction validacionAdicional() {\n    let valido = true;\n    let es_solo_creditos = plan_seleccionado === null && plan_creditos_seleccionado !== null;\n    $('#vigencia').val($('#vigencia_modal').val());\n    if ($('#unidades_modal').val() == 'Ilimitadas') {\n        $('#unidades').val('');\n    } else {\n        $('#unidades').val($('#unidades_modal').val());\n    }\n    if ($('#cantidad_ofertas_laborales_modal').val() == 'Ilimitadas') {\n        $('#cantidad_ofertas_laborales').val('');\n    } else {\n        $('#cantidad_ofertas_laborales').val($('#cantidad_ofertas_laborales_modal').val());\n    }\n    $('#cantidad_usuarios').val($('#cantidad_usuarios_modal').val());\n    $('#cantidad_pruebas').val($('#cantidad_pruebas_modal').val());\n    if (opcion == 'facturar' || opcion == 'editar') {\n        let adicionales = $('#adicionales_modal').val();\n        let predefinidos = $('#predefinidos_modal').val();\n        let funcionalidades = adicionales.concat(predefinidos);\n        $('#funcionalidades').val(JSON.stringify(funcionalidades));\n        if (!es_solo_creditos && funcionalidades.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una funcionalidad.');\n        }\n    } else {\n        let ids = [];\n        if (plan_seleccionado && Array.isArray(plan_seleccionado.funcionalidades)) {\n            ids = plan_seleccionado.funcionalidades.map(objeto => objeto.id);\n        }\n        $('#funcionalidades').val(JSON.stringify(ids));\n    }\n    var pruebas_seleccionadas = $('.pruebas:checked').map(function() {\n        return this.value;\n    }).get();\n    $('#pruebas').val('');\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado ? plan_seleccionado.cantidad_pruebas : 0;\n    }\n    if (!es_solo_creditos) {\n        if (pruebas_seleccionadas.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una prueba.');\n        } else if (pruebas_seleccionadas.length > maximo_pruebas) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione maximo ' + maximo_pruebas + ' pruebas.');\n        }\n    }\n    if (valido) {\n        $('#pruebas').val(JSON.stringify(pruebas_seleccionadas));\n    }\n    return valido;\n}\n/**\n * Función para validar que no se exceda al seleccionar limite de pruebas.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction ValidarPruebas() {\n    let cantidad_seleccionadas = $('.pruebas:checked').length;\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado.cantidad_pruebas;\n    }\n    if (cantidad_seleccionadas > maximo_pruebas) {\n        $('#alerta-pruebas').removeClass('d-none');\n    } else {\n        $('#alerta-pruebas').addClass('d-none');\n    }\n}\n/**\n * Abrir el modal con los campos para modificar plan.\n * @param {Event} evento Evento desencadenado.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalModificar(evento) {\n    evento.stopPropagation();\n    if (modificado == false) {\n        $('#nombre-plan-modal').text(plan_seleccionado.nombre);\n        $('#cantidad_pruebas_modal').empty();\n        $('#cantidad_pruebas_modal').append(`\n            <option value=\"\">Seleccione</option>\n        `);\n        for (let j = 1; j <= pruebas.length; j++) {\n            $('#cantidad_pruebas_modal').append(`\n                <option value=\"${j}\">${j} Pruebas</option>\n            `);\n        }\n        $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n        if ([90, 180, 365].includes(plan_seleccionado.vigencia)) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val(plan_seleccionado.vigencia).trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else if (plan_seleccionado.vigencia != null && plan_seleccionado.vigencia != 0) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val('personalizado').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else {\n            $('#tiempo_modal').prop('disabled', true);\n            $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val('');\n        }\n        if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n            $('#unidades_modal').val(plan_seleccionado.unidades);\n            $('#unidades_modal').prop('disabled', false);\n            if (opcion == 'asignar') {\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa_plan.cantidad_ofertas_laborales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', false);\n        } else {\n            $('#unidades_modal').val(empresa.procesos_estimados_mensuales);\n            $('#unidades_modal').prop('disabled', true);\n            if (opcion == 'facturar' || opcion == 'editar') {\n                $('#unidades_modal').val(plan_seleccionado.unidades);\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa.pruebas_estimadas_mensuales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', true);\n        }\n        $('#cantidad_usuarios_modal').val(plan_seleccionado.cantidad_usuarios);\n        if (opcion == 'facturar' || opcion == 'editar') {\n            $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n            buscarfuncionalidadesPlanEmpresa($('#id').val());\n        }\n        $('#boton-guardar-modificaciones').prop('disabled', true);\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('show');\n    }\n}\n/**\n * Función que habilita el boton de guardar un plan modificado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction habilitarBotonGuardar() {\n    $('#boton-guardar-modificaciones').prop('disabled', false);\n}\n/**\n * Función que controla los campos de vigencia en el modal de editar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarTiempo(vigencia) {\n    $('.texto-label-tiempo').text('máximas permitidas');\n    $('#input-container-tiempo').removeClass('d-none');\n    $('#input-container-tiempo').addClass('col-md-6');\n    if (vigencia == 'personalizado') {\n        $('#input-container-vigencia').removeClass('d-none');\n        $('#vigencia_modal').val('');\n    } else if ((vigencia == '' || vigencia == null || vigencia == 0) && plan_seleccionado != null && (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0)) {\n        $('.texto-label-tiempo').text('');\n        $('#input-container-tiempo').addClass('d-none');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val('');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    } else if (['90', '180', '365'].includes(vigencia)) {\n        $('#input-container-tiempo').removeClass('col-md-6');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val(vigencia);\n    } else {\n        $('#vigencia_modal').val(vigencia);\n        $('#input-container-vigencia').addClass('d-none');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    }\n}\n/**\n * Abrir el modal de confirmación.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalEstasSeguro() {\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('hide');\n        $('#modal-estas-seguro').modal('show');\n    }\n}\n/**\n * Cancelar la edición de un plan.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction cancelarEdicion() {\n    modificado = false;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    limpiarAdicional();\n    mostrarPlanSeleccionado();\n}\n/**\n * Confirmar los datos editados.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction confirmarEdicion() {\n    modificado = true;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    $('#plan-modificado').text('(modificado)');\n    mostrarPlanSeleccionado();\n}\n/**\n * Limpiar los campos del modal.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction limpiarAdicional() {\n    $('#cantidad_pruebas_modal').val('').trigger('change').trigger('select2:select');\n    $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n    $('#unidades_modal').val('');\n    $('#cantidad_ofertas_laborales_modal').val('');\n    $('#cantidad_usuarios_modal').val('');\n    // Verificar si el multiselect está inicializado antes de llamar uncheckAll\n    if ($('#adicionales_modal').data('multiselect')) {\n        $('#adicionales_modal').multiselect(\"uncheckAll\");\n    }\n    if ($('#predefinidos_modal').data('multiselect')) {\n        $('#predefinidos_modal').multiselect(\"uncheckAll\");\n    }\n}\n/**\n * Función para ejecutar acciones luego de guardar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction postSuccess(respuesta) {\n    limpiarFormulario(respuesta.formulario);\n    if (opcion == 'asignar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se asignó con éxito a la empresa`,\n        }));\n    } else if (opcion == 'facturar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se facturó con éxito`,\n        }));\n    } else if (opcion == 'editar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se actualizó con éxito`,\n        }));\n    }\n    window.location.href='/empresas-gestionar/' + empresa.id;\n}\n","structuredPatch":[{"oldStart":592,"oldLines":10,"newStart":592,"newLines":19,"lines":["     }","     $('#plan_id').val(plan_seleccionado.id);","     $('#seccion-pruebas').removeClass('d-none');","-    ","+","     // Mostrar campos de precio para plan de selección","     $('#contenedor-precio-plan').removeClass('d-none');","-    $('#precio_plan').val(plan_seleccionado.precio).trigger('input');","+    if (plan_seleccionado && plan_seleccionado.precio) {","+        // Guardar el valor original en el campo hidden","+        $('#precio_plan_original').val(plan_seleccionado.precio);","+        // Mostrar el valor en el campo visual","+        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');","+        // Habilitar el campo visual inicialmente","+        $('#precio_plan_visual').prop('disabled', false);","+        // Limpiar el porcentaje de descuento","+        $('#porcentaje_descuento').val('');","+    }"," ","     // Verificar si Bootstrap modal está disponible antes de usar","     if (typeof $.fn.modal !== 'undefined') {"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"4464f347-f2f5-4c8e-ade1-303143858caf"}
{"parentUuid":"df11995f-ad39-43b3-94b8-3b46a68853bd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TxAjcZfhJeT3TKhk375f1B","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Los diagnósticos del IDE son solo \"Hints\" (sugerencias) y no errores reales. La variable `plan_creditos_seleccionado` está declarada al inicio del archivo como variable global, así que no hay problema real.\n\nAhora necesito continuar con las modificaciones:\n1. Modificar la función `actualizarValorDesdeInput()` para usar los campos visuales\n2. Agregar la función genérica `aplicarDescuento(tipo)`\n\nVoy a buscar la función `actualizarValorDesdeInput()` y modificarla.","signature":"Ev0ECkYICxgCKkD6KtRT5FLo+mIsHR76IHtymMWeNff5NgIWwhno+Un99gO2/gtqhym+chioFA/drlHY0okkw1DehFwUdFBuc7bCEgyP8twezZ8nI9KDlXgaDPB/JTQXhOHLw3zeeSIwxV7a7oPfFi0if6ft45EIBGxYwDbkxjJ+NKjKkEfVKFT71DotEsw/+SRXRleaaQhJKuQD1p5JHM77jxUKlxfl6AvsniqHtU2q6gdnrCqTWZXSlwjodeSb9ZSrychwsyCBtskTzZJ/GtfDYPe5PmoUk71abzxVaO4pE7z1cbu60MJ9CENGg810jykuYdlIZIUg3n53BKOtHItuCoeWaawlm+Ui8nlLmCGzlUOauK/ZStOxU/SYQ7B2OGT9oaG6LeAFzGLz5JSKfx/X/2ma5D7J9luHJdrXNROcaBiGVcdhe1KAOMLTxilXQvyq9Cy2ZcA5zGY5Io7laMhpgS43iQi4tDIjr5dtLKrJotsOuOr/TDVSm2U8ICHQBxhH9ykacFicGk9penow5wzboNXk0qhjzGVwBuQkXLO8RhvkYoNv9DJP67QZMUuTuUPbrkgczYVvrfGma4vGMvkt0O1qnwIVORd+rEWFv9RxdNxUtwysBbN7lu1o3+o6nYhy3z88ILfq0cWoj6yQ9bUrh1kjte5rQwB63cuEd5UB+ozqs+qarJfW+vg3IXAo/uXQPkR8Ub7py4VmN3Vw0RRmoJnTocEsXqa7Bo34NUMh6YMlIVk9Lj8PXp/2c31iN9Sgg+KzKq8UKbCLOaKRgt06mUPvXzUQKKAUT7hyhTgcTtvC3O6fUVgp1YlT01bt8NmWOglbGZuOxkFJ0lsUdhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2050,"cache_read_input_tokens":69024,"cache_creation":{"ephemeral_5m_input_tokens":2050,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW3sbmswTMehmxog315r","type":"assistant","uuid":"6587a82e-f0b2-4888-8619-f44141a71364","timestamp":"2026-01-26T13:14:42.695Z"}
{"parentUuid":"6587a82e-f0b2-4888-8619-f44141a71364","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TxAjcZfhJeT3TKhk375f1B","type":"message","role":"assistant","content":[{"type":"text","text":"Los diagnósticos son solo sugerencias del IDE, no errores reales (la variable está declarada globalmente). \n\nAhora modifico `actualizarValorDesdeInput()` y agrego la función `aplicarDescuento()`."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2050,"cache_read_input_tokens":69024,"cache_creation":{"ephemeral_5m_input_tokens":2050,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW3sbmswTMehmxog315r","type":"assistant","uuid":"79282094-673b-41ca-ad99-89d56f454a12","timestamp":"2026-01-26T13:14:43.674Z"}
{"parentUuid":"79282094-673b-41ca-ad99-89d56f454a12","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01TxAjcZfhJeT3TKhk375f1B","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EDegW7BsotDPjhfGHtd2W4","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","offset":635,"limit":60}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2050,"cache_read_input_tokens":69024,"cache_creation":{"ephemeral_5m_input_tokens":2050,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW3sbmswTMehmxog315r","type":"assistant","uuid":"649e5736-e52c-4103-b05f-6589aaeed3d5","timestamp":"2026-01-26T13:14:44.338Z"}
{"parentUuid":"649e5736-e52c-4103-b05f-6589aaeed3d5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01EDegW7BsotDPjhfGHtd2W4","type":"tool_result","content":"   635→\n   636→    let valor_total = valor_plan + valor_creditos;\n   637→\n   638→    // Formatear el valor con separador de miles\n   639→    let valor_formateado = valor_total.toLocaleString('es-CO');\n   640→\n   641→    $('#valor-venta-mostrar').text(valor_formateado);\n   642→}\n   643→\n   644→/**\n   645→ * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n   646→ * \n   647→ * @returns {void}\n   648→ * @author Andres Gonzalez\n   649→ */\n   650→function actualizarValorDesdeInput() {\n   651→    let valor_plan = 0;\n   652→    let valor_creditos = 0;\n   653→\n   654→    let valor_plan_input = $('#precio_plan').val();\n   655→    if (valor_plan_input) {\n   656→        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n   657→    }\n   658→\n   659→    let valor_creditos_input = $('#precio_creditos').val();\n   660→    if (valor_creditos_input) {\n   661→        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n   662→    }\n   663→\n   664→    let valor_total = valor_plan + valor_creditos;\n   665→\n   666→    // Formatear el valor con separador de miles\n   667→    let valor_formateado = valor_total.toLocaleString('es-CO');\n   668→\n   669→    $('#valor-venta-mostrar').text(valor_formateado);\n   670→}\n   671→\n   672→/**\n   673→ * Abrir la factura del plan en una nueva pestaña del navegador.\n   674→ * \n   675→ * @param {number} factura_id Id de la factura.\n   676→ * @returns {void}\n   677→ * @author Andres Morales\n   678→ */\n   679→async function abrirFacturaPlan(factura_id) {\n   680→    if (!factura_id) {\n   681→        mostrarToast('danger', 'No se encontró la factura');\n   682→        return;\n   683→    }\n   684→    try {\n   685→        const respuesta = await $.ajax({\n   686→            type: 'GET',\n   687→            url: `/archivos-abrir/${factura_id}`,\n   688→            xhrFields: { responseType: 'blob' }\n   689→        });\n   690→        const blobUrl = window.URL.createObjectURL(respuesta);\n   691→        window.open(blobUrl, '_blank');\n   692→    } catch (error) {\n   693→        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n   694→    }\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a325103e-80dc-4278-8320-4c0b509a63af","timestamp":"2026-01-26T13:14:45.748Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","content":"\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    let valor_plan_input = $('#precio_plan').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Abrir la factura del plan en una nueva pestaña del navegador.\n * \n * @param {number} factura_id Id de la factura.\n * @returns {void}\n * @author Andres Morales\n */\nasync function abrirFacturaPlan(factura_id) {\n    if (!factura_id) {\n        mostrarToast('danger', 'No se encontró la factura');\n        return;\n    }\n    try {\n        const respuesta = await $.ajax({\n            type: 'GET',\n            url: `/archivos-abrir/${factura_id}`,\n            xhrFields: { responseType: 'blob' }\n        });\n        const blobUrl = window.URL.createObjectURL(respuesta);\n        window.open(blobUrl, '_blank');\n    } catch (error) {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    }","numLines":60,"startLine":635,"totalLines":1043}},"sourceToolAssistantUUID":"649e5736-e52c-4103-b05f-6589aaeed3d5"}
{"parentUuid":"a325103e-80dc-4278-8320-4c0b509a63af","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_014nUXDS56C7xftPFd7q2iD7","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora voy a modificar la función `actualizarValorDesdeInput()` para usar los campos visuales y agregar la función `aplicarDescuento(tipo)`.","signature":"ErYCCkYICxgCKkAl2KpbHMjzEOn6q71VUNIbexBN1P9rn4wrS5w3v2Wfr4iF5y2RATEDcmyY/MOseT+1gGyA9iMQWLAZzIcBmz7tEgy9zM7d+NJJJBac54waDAd3j9yy431Ew8LaTSIw/p5AeU88f4U1OWOuh6j3dkBaNVS/ia0GOnub+VQfpBdq+Zc+uu66dr8xR9iJXI5wKp0BOkvOtbn86772YsCBTMw9YKDMZB42Dtq+TMnbGgWLasK3EYXmraqoMzrbtC/hnv0xDZDQ0cWKBzYeuyrFEm4TghJgLp8bWUbmvBGoeVVirT0PlEgHiI19qSkv9KAdmXYo2mpBOfIAxiwyCGI4nhdKLt7hc2vyF9J5Ip+cKvV7K5ChcLlUNaoujXY/5VADJmzU+tMjzUuYyqbPQaAythgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1202,"cache_read_input_tokens":71074,"cache_creation":{"ephemeral_5m_input_tokens":1202,"ephemeral_1h_input_tokens":0},"output_tokens":8,"service_tier":"standard"}},"requestId":"req_011CXW3tB9KUtYZKyFxXTSgu","type":"assistant","uuid":"1f435cca-80df-417f-ab2f-cc30abc70b68","timestamp":"2026-01-26T13:14:48.290Z"}
{"parentUuid":"1f435cca-80df-417f-ab2f-cc30abc70b68","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_014nUXDS56C7xftPFd7q2iD7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Qo1QvEeXLcDCAAmL9SMupE","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    let valor_plan_input = $('#precio_plan').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}","new_string":"/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    // Usar los campos visuales para mostrar el total\n    let valor_plan_input = $('#precio_plan_visual').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos_visual').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Aplicar el porcentaje de descuento al valor del plan o créditos.\n * El valor original se mantiene en el campo hidden para el envío.\n * El campo visual muestra el valor con descuento y se deshabilita.\n *\n * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n * @returns {void}\n */\nfunction aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1202,"cache_read_input_tokens":71074,"cache_creation":{"ephemeral_5m_input_tokens":1202,"ephemeral_1h_input_tokens":0},"output_tokens":8,"service_tier":"standard"}},"requestId":"req_011CXW3tB9KUtYZKyFxXTSgu","type":"assistant","uuid":"80e549e4-80b4-4a84-bc65-4389441056bf","timestamp":"2026-01-26T13:15:00.133Z"}
{"parentUuid":"80e549e4-80b4-4a84-bc65-4389441056bf","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Qo1QvEeXLcDCAAmL9SMupE","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   640→\n   641→    $('#valor-venta-mostrar').text(valor_formateado);\n   642→}\n   643→\n   644→/**\n   645→ * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n   646→ *\n   647→ * @returns {void}\n   648→ * @author Andres Gonzalez\n   649→ */\n   650→function actualizarValorDesdeInput() {\n   651→    let valor_plan = 0;\n   652→    let valor_creditos = 0;\n   653→\n   654→    // Usar los campos visuales para mostrar el total\n   655→    let valor_plan_input = $('#precio_plan_visual').val();\n   656→    if (valor_plan_input) {\n   657→        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n   658→    }\n   659→\n   660→    let valor_creditos_input = $('#precio_creditos_visual').val();\n   661→    if (valor_creditos_input) {\n   662→        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n   663→    }\n   664→\n   665→    let valor_total = valor_plan + valor_creditos;\n   666→\n   667→    // Formatear el valor con separador de miles\n   668→    let valor_formateado = valor_total.toLocaleString('es-CO');\n   669→\n   670→    $('#valor-venta-mostrar').text(valor_formateado);\n   671→}\n   672→\n   673→/**\n   674→ * Aplicar el porcentaje de descuento al valor del plan o créditos.\n   675→ * El valor original se mantiene en el campo hidden para el envío.\n   676→ * El campo visual muestra el valor con descuento y se deshabilita.\n   677→ *\n   678→ * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n   679→ * @returns {void}\n   680→ */\n   681→function aplicarDescuento(tipo) {\n   682→    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n   683→    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n   684→    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n   685→\n   686→    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n   687→    let valor_original_str = $(campo_original).val();\n   688→    let valor_original = 0;\n   689→\n   690→    if (valor_original_str) {\n   691→        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n   692→    }\n   693→\n   694→    // Si no hay valor original guardado, tomarlo del campo visual\n   695→    if (valor_original === 0) {\n   696→        let valor_visual = $(campo_visual).val();\n   697→        if (valor_visual) {\n   698→            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n   699→            $(campo_original).val(valor_original);\n   700→        }\n   701→    }\n   702→\n   703→    if (porcentaje > 0 && porcentaje <= 100) {\n   704→        // Calcular el valor con descuento\n   705→        let descuento = valor_original * (porcentaje / 100);\n   706→        let valor_con_descuento = Math.round(valor_original - descuento);\n   707→\n   708→        // Mostrar el valor con descuento en el campo visual\n   709→        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n   710→\n   711→        // Deshabilitar el campo visual\n   712→        $(campo_visual).prop('disabled', true);\n   713→    } else {\n   714→        // Si no hay descuento, mostrar el valor original y habilitar el campo\n   715→        if (valor_original > 0) {\n   716→            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n   717→        }\n   718→        $(campo_visual).prop('disabled', false);\n   719→    }\n   720→\n   721→    // Actualizar el valor total mostrado\n   722→    actualizarValorDesdeInput();\n   723→}\n   724→\n   725→/**\n   726→ * Abrir la factura del plan en una nueva pestaña del navegador.\n   727→ * "}]},"uuid":"dc4be5a8-782f-480d-a2b3-94f097dc84b8","timestamp":"2026-01-26T13:15:11.418Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","oldString":"/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    let valor_plan_input = $('#precio_plan').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}","newString":"/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    // Usar los campos visuales para mostrar el total\n    let valor_plan_input = $('#precio_plan_visual').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos_visual').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Aplicar el porcentaje de descuento al valor del plan o créditos.\n * El valor original se mantiene en el campo hidden para el envío.\n * El campo visual muestra el valor con descuento y se deshabilita.\n *\n * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n * @returns {void}\n */\nfunction aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}","originalFile":"table = null;\nplanes = [];\npruebas = [];\nmodificado = false;\nfuncionalidades_predefinidos = [];\nplan_creditos_seleccionado = null;\n\n$(document).ready(function() {\n    $(document).on('input', '#precio_plan, #precio_creditos', function() {\n        actualizarValorDesdeInput();\n    });\n});\n\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales\n */\nfunction seleccionarTipoPrueba(tipo_prueba_id) {\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"card-body text-center\">\n            <button type=\"button\" id=\"elegir-plan\" class=\"btn btn-outline-primary\" disabled onclick=\"modalElegirPlan();\">Elegir plan</button>\n        </div>\n    `);\n    $('#seccion-pruebas').addClass('d-none');\n    $('#plan_id').val('');\n    pruebas = [];\n    // Convertir tipo_prueba_id a array si no lo es\n    let tipos_prueba = Array.isArray(tipo_prueba_id) ? tipo_prueba_id : [tipo_prueba_id];\n    // Crear los botones según los tipos de prueba seleccionados\n    let botones_html = '<div class=\"card-body text-center\">';\n    tipos_prueba.forEach(function(tipo_id) {\n        let texto_boton = 'Elegir plan';\n        let clase_boton = 'btn-outline-primary';\n        if (tipo_id == 1) {\n            texto_boton = 'Elegir Plan de Selección';\n            clase_boton = 'btn-outline-primary';\n        } else if (tipo_id == 2) {\n            texto_boton = 'Elegir Plan de Créditos IA';\n            clase_boton = 'btn-outline-info';\n        }\n        botones_html += `\n            <button type=\"button\" id=\"elegir-plan-${tipo_id}\" class=\"btn ${clase_boton} mx-1 my-1\" disabled onclick=\"modalElegirPlan(${tipo_id});\">\n                ${texto_boton}\n            </button>\n        `;\n    });\n    botones_html += '</div>';\n    $('#contenedor-plan').append(botones_html);\n    $('#tipo_prueba_id').val(tipo_prueba_id).trigger('select2');\n    if (tipo_prueba_id && (Array.isArray(tipo_prueba_id) ? tipo_prueba_id.length > 0 : tipo_prueba_id)) {\n        // Habilitar todos los botones creados\n        tipos_prueba.forEach(function(tipo_id) {\n            $(`#elegir-plan-${tipo_id}`).prop('disabled', false);\n        });\n        $.ajax({\n            type: 'GET',\n            url : `/pruebas-listado`,\n            data: {\n                tipo_prueba_id: tipo_prueba_id,\n                activo: 1\n            }\n        }).then((respuesta) => {\n            limpiarAdicional();\n            $('#contenedor-pruebas').empty();\n            pruebas = respuesta.data;\n            for (let i = 0; i < pruebas.length; i++) {\n                $('#contenedor-pruebas').append(`\n                    <div class=\"col-12 col-md-6\">\n                        <div class=\"d-flex align-items-center\">\n                            <div class=\"check-container my-1 me-1\">\n                                <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                            </div>\n                            <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                        </div>\n                    </div>\n                `);\n            }\n            if (opcion == 'facturar' || opcion == 'editar') {\n                for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                    $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n                }\n                $('#seccion-pruebas').removeClass('d-none');\n                mostrarPlanSeleccionado();\n            }\n            if (opcion == 'editar') {\n                $('#tipo_prueba_id').prop('disabled', true);\n            }\n        }).catch((error) => {\n            console.error(error);\n        });\n    } else {\n        $('#elegir-plan').prop('disabled', true);\n    }\n}\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction seleccionarTipoPruebaMultiple() {\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    tipos_prueba = tipos_prueba.filter(function(tipo_id) {\n        return tipo_id !== null && tipo_id !== '' && tipo_id !== undefined;\n    });\n    if (tipos_prueba.length === 0) {\n        // Si no hay tipos seleccionados, limpiar todo\n        $('#contenedor-plan').empty();\n        $('#contenedor-creditos').empty();\n        $('#seccion-pruebas').addClass('d-none');\n        $('#plan_id').val('');\n        $('#plan_id').prop('required', false);\n        $('#plan_id').prop('disabled', true);\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n        plan_seleccionado = null;\n        plan_creditos_seleccionado = null;\n        pruebas = [];\n        return;\n    }\n    let tiene_seleccion = tipos_prueba.includes('1') || tipos_prueba.includes(1);\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    $('#plan_id').prop('required', tiene_seleccion);\n    $('#plan_id').prop('disabled', !tiene_seleccion);\n    // Manejo del plan de selección\n    if (tiene_seleccion) {\n        // Si hay un plan seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_seleccionado === null && $('#contenedor-plan').children().length === 0) {\n            let seccion_seleccion = `\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Selección</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-1\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(1);\">\n                            Elegir Plan de Selección\n                        </button>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-plan').html(seccion_seleccion);\n        }\n    } else {\n        // Si se deseleccionó el tipo de selección, limpiar el plan\n        $('#contenedor-plan').empty();\n        plan_seleccionado = null;\n        $('#plan_id').val('');\n    }\n    // Manejo del plan de créditos\n    if (tiene_creditos) {\n        // Si hay un plan de créditos seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n            let seccion_creditos = `\n                <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                    <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                    <div class=\"card rounded rounded-3\">\n                        <div class=\"card-body text-center\">\n                            <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                                Elegir Plan de Créditos IA\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-creditos').html(seccion_creditos);\n        }\n    } else {\n        // Si se deseleccionó el tipo de créditos, limpiar el plan de créditos\n        $('#contenedor-creditos').empty();\n        $('#contenedor-plan-creditos').remove();\n        plan_creditos_seleccionado = null;\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/pruebas-listado`,\n        data: {\n            tipo_prueba_id: tipos_prueba,\n            activo: 1\n        }\n    }).then((respuesta) => {\n        limpiarAdicional();\n        $('#contenedor-pruebas').empty();\n        pruebas = respuesta.data;\n        for (let i = 0; i < pruebas.length; i++) {\n            $('#contenedor-pruebas').append(`\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"d-flex align-items-center\">\n                        <div class=\"check-container my-1 me-1\">\n                            <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                        </div>\n                        <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                    </div>\n                </div>\n            `);\n        }\n        if (opcion == 'facturar' || opcion == 'editar') {\n            for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n            }\n            $('#seccion-pruebas').removeClass('d-none');\n            mostrarPlanSeleccionado();\n        }\n        if (opcion == 'editar') {\n            $('#tipo_prueba_id').prop('disabled', true);\n        }\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    });\n}\n/**\n * Obtener el listado de planes según el tipo_prueba_id seleccionado anteriormente.\n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalElegirPlan(tipo_especifico = null) {\n    let tipo_prueba_para_consulta = tipo_especifico !== null ? tipo_especifico : $('#tipo_prueba_id').val();\n    // Si es tipo 2 (Créditos IA), cargar planes de créditos\n    if (tipo_prueba_para_consulta == 2 || tipo_prueba_para_consulta == '2') {\n        $.ajax({\n            type: 'GET',\n            url: '/planes-creditos',\n            data: {\n                activo: true\n            }\n        }).then((respuesta) => {\n            planes_creditos = respuesta.data.planes;\n            mostrarPlanesCreditos();\n        }).catch((error) => {\n            mostrarToast('danger', 'Ocurrió un error');\n        });\n        return;\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/planes-listado`,\n        data: {\n            tipo_prueba_id: $('#tipo_prueba_id').val()\n        }\n    }).then((respuesta) => {\n        planes = respuesta.data;\n        mostrarPlanes();\n    }).catch((error) => {\n        console.error(error);\n    });\n}\n/**\n * Mostrar los planes de créditos en el modal.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction mostrarPlanesCreditos() {\n    let filtro_orden = $('#filtro-plan-credito').val();\n    let buscar = $('#buscador-plan-credito').val() || '';\n    // Ordenar planes según el filtro\n    let planes_ordenados = [...planes_creditos];\n    if (filtro_orden === 'Mayor') {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else if (filtro_orden === 'Menor') {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    if (buscar !== '') {\n        planes_ordenados = planes_ordenados.filter(plan =>\n            plan.nombre.toLowerCase().includes(buscar.toLowerCase())\n        );\n    }\n    $('#contenedor-planes-creditos').empty();\n    if (planes_ordenados.length === 0) {\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"text-center py-5\">\n                <p class=\"text-muted\">No se encontraron planes</p>\n            </div>\n        `);\n    }\n    for (let i = 0; i < planes_ordenados.length; i++) {\n        let plan = planes_ordenados[i];\n        let creditos_disponibles = plan.creditos_disponibles || plan.creditos || 0;\n        let creditos_promedio = plan.creditos_promedio_accion || 0;\n        let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n            ? Math.floor(creditos_disponibles / creditos_promedio)\n            : 0;\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"card rounded rounded-3 border-hover pointer mb-3\" onclick=\"elegirPlanCreditos(${i}, ${filtro_orden === 'Mayor' ? 'true' : 'false'});\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6 text-gray-10\">${plan.nombre}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        `);\n    }\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('show');\n    }\n    $('#buscador-plan-credito').off('input').on('input', function() {\n        mostrarPlanesCreditos();\n    });\n}\n/**\n * Elegir un plan de créditos IA.\n * @param {number} indice Índice del plan en el array.\n * @param {boolean} orden_mayor Si está ordenado de mayor a menor.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction elegirPlanCreditos(indice, orden_mayor = false) {\n    // Aplicar el mismo ordenamiento que en mostrarPlanesCreditos\n    let planes_ordenados = [...planes_creditos];\n    if (orden_mayor) {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    plan_creditos_seleccionado = planes_ordenados[indice];\n    // Establecer los valores en los campos hidden\n    $('#plan_credito_id').val(plan_creditos_seleccionado.id);\n    $('#creditos').val(plan_creditos_seleccionado.creditos);\n    mostrarPlanCreditosSeleccionado();\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('hide');\n    }\n}\n/**\n * Mostrar el plan de créditos seleccionado en el contenedor.\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarPlanCreditosSeleccionado() {\n    if (!plan_creditos_seleccionado || !plan_creditos_seleccionado.creditos) {\n        mostrarToast('danger', 'Ocurrió un error'+plan_creditos_seleccionado);\n        return;\n    }\n    let creditos_disponibles = plan_creditos_seleccionado.creditos_disponibles || plan_creditos_seleccionado.creditos || 0;\n    let creditos_promedio = plan_creditos_seleccionado.creditos_promedio_accion || 0;\n    let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n        ? Math.floor(creditos_disponibles / creditos_promedio)\n        : 0;\n    let seccion_creditos = `\n        <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n            <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n            <div class=\"card rounded rounded-3\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4 pointer\" onclick=\"modalElegirPlan(2);\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6\">${plan_creditos_seleccionado.nombre || 'Plan de Créditos'}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan_creditos_seleccionado.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    // Remover el contenedor anterior si existe\n    $('#contenedor-plan-creditos').remove();\n    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n    if ($('#contenedor-creditos').length) {\n        $('#contenedor-creditos').html(seccion_creditos);\n    } else {\n        $('#contenedor-plan').after(seccion_creditos);\n    }\n    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }\n    actualizarValorVentaTotal();\n}\n\n/**\n * Mostrar en el modal los planes obtenidos en el listado.\n * \n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPlanes() {\n    let buscar = $('#buscador-plan').val();\n    let filtro_plan = $('#filtro-plan').val();\n    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n        table.destroy();\n    }\n    $('#buscador-plan').remove();\n    $('#tbody-planes').empty();\n    for (let i = 0; i < planes.length; i++) {\n        if (\n            (filtro_plan == 'Todos') ||\n            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n        ) {\n            let cantidad_usuarios = '';\n            if (planes[i].cantidad_usuarios != null) {\n                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n            }\n            let cantidad_ofertas_laborales = '';\n            if (planes[i].cantidad_ofertas_laborales != null) {\n                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n            }\n            let cantidad_pruebas = '';\n            if (planes[i].cantidad_pruebas != null) {\n                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;\n            }\n            let unidades = '';\n            if (planes[i].unidades != null) {\n                unidades = `<div class=\"col-auto w-90px\"><i class=\"bi bi-box\"></i> ${planes[i].unidades}</div>`;\n            }\n            let vigencia = '';\n            if (planes[i].vigencia == 90) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n            } else if (planes[i].vigencia == 180) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n            }  else if (planes[i].vigencia == 365) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n            } else if (planes[i].vigencia == null || planes[i].vigencia == 0) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n            } else {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${planes[i].vigencia} días</div>`;\n            }\n            $('#tbody-planes').append(`\n                <tr>\n                    <td style=\"border-bottom: 0px!important;\">\n                        <div class=\"border border-1 rounded rounded-2 pointer border-hover\" onclick=\"elegirPlan(${i});\">\n                            <div class=\"row m-0 w-100 px-3 py-5 text-headline-6\">\n                                <div class=\"col\">${planes[i].nombre !== null ? planes[i].nombre : ''}</div>\n                                ${cantidad_ofertas_laborales}\n                                ${unidades}\n                                ${cantidad_usuarios}\n                                ${cantidad_pruebas}\n                                ${vigencia}\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            `);\n        }\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('show');\n    }\n    table = $('#tabla-planes').DataTable({\n        \"paging\": false,\n        \"searching\": true,\n        \"ordering\": false,\n        \"info\": false\n    });\n    let buscador = $('#tabla-planes_wrapper input');\n    $(buscador).addClass('rounded-2 text-body-2');\n    $(buscador).prop('placeholder', 'Buscar');\n    $(buscador).prop('id', 'buscador-plan');\n    $('#input-busqueda').append(buscador);\n    $(buscador).val(buscar).trigger('input');\n}\n/**\n * Elegir un plan del listado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction elegirPlan(i) {\n    plan_seleccionado = planes[i];\n    mostrarPlanSeleccionado();\n}\n/**\n * Mostrar el plan seleccionado en el contenedor y en las opciones del modificar.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction mostrarPlanSeleccionado() {\n    let cantidad_usuarios = '';\n    let cantidad_usuarios_modal = $('#cantidad_usuarios_modal').val();\n    if (cantidad_usuarios_modal != '') {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${cantidad_usuarios_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_usuarios != null) {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${plan_seleccionado.cantidad_usuarios}</div>`;\n    }\n    let cantidad_ofertas_laborales = '';\n    let cantidad_ofertas_laborales_modal = $('#cantidad_ofertas_laborales_modal').val();\n    if (cantidad_ofertas_laborales_modal != '') {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${cantidad_ofertas_laborales_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_ofertas_laborales != null) {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${plan_seleccionado.cantidad_ofertas_laborales}</div>`;\n    }\n    let cantidad_pruebas = '';\n    let cantidad_pruebas_modal = $('#cantidad_pruebas_modal').val();\n    if (cantidad_pruebas_modal != '') {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${cantidad_pruebas_modal}</div>`;\n        $('.cantidad-pruebas').text(cantidad_pruebas_modal);\n    } else if (plan_seleccionado.cantidad_pruebas != null) {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${plan_seleccionado.cantidad_pruebas}</div>`;\n        $('.cantidad-pruebas').text(plan_seleccionado.cantidad_pruebas);\n    }\n    let unidades = '';\n    let unidades_modal = $('#unidades_modal').val();\n    if (unidades_modal != '') {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${unidades_modal}</div>`;\n    } else if (plan_seleccionado.unidades != null) {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${plan_seleccionado.unidades}</div>`;\n    }\n    let vigencia = '';\n    let vigencia_modal = $('#vigencia_modal').val();\n    if (plan_seleccionado.vigencia == 90 || vigencia_modal == '90') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n    } else if (plan_seleccionado.vigencia == 180 || vigencia_modal == '180') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n    }  else if (plan_seleccionado.vigencia == 365 || vigencia_modal == '365') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n    } else if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n    } else if (vigencia_modal != '') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${vigencia_modal} días</div>`;\n    } else {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${plan_seleccionado.vigencia} días</div>`;\n    }\n    let abrir_modal_elegir_plan = '';\n    let icono_editar = `\n        <div class=\"col-auto w-90px\">\n            <button type=\"button\" class=\"btn btn-text-primary text-white btn-circle\" onclick=\"abrirModalModificar(event);\" title=\"Modificar plan\">\n                <i class=\"bi bi-wrench\"></i>\n            </button>\n        </div>\n    `;\n    if (opcion == 'asignar') {\n        abrir_modal_elegir_plan = `onclick=\"modalElegirPlan();\"`;\n        icono_editar = '';\n    }\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"row border rounded rounded-3 m-0 w-100 px-3 py-5 text-headline-6 pointer\" ${abrir_modal_elegir_plan}>\n            <div class=\"col\">${plan_seleccionado.nombre !== null ? plan_seleccionado.nombre : ''} <span id=\"plan-modificado\"></span></div>\n            ${cantidad_ofertas_laborales}\n            ${unidades}\n            ${cantidad_usuarios}\n            ${cantidad_pruebas}\n            ${vigencia}\n            ${icono_editar}\n        </div>\n    `);\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    // Solo agregar el botón de elegir plan de créditos si no hay uno seleccionado y se requiere\n    if (tiene_creditos && plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n        let seccion_creditos = `\n            <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                            Elegir Plan de Créditos IA\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n        $('#contenedor-creditos').append(seccion_creditos);\n    }\n    $('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n\n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_plan_original').val(plan_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_plan_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento').val('');\n    }\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}\n\n/**\n * Actualizar el valor de venta total sumando plan de selección y créditos.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorVentaTotal() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n    }\n\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    let valor_plan_input = $('#precio_plan').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Abrir la factura del plan en una nueva pestaña del navegador.\n * \n * @param {number} factura_id Id de la factura.\n * @returns {void}\n * @author Andres Morales\n */\nasync function abrirFacturaPlan(factura_id) {\n    if (!factura_id) {\n        mostrarToast('danger', 'No se encontró la factura');\n        return;\n    }\n    try {\n        const respuesta = await $.ajax({\n            type: 'GET',\n            url: `/archivos-abrir/${factura_id}`,\n            xhrFields: { responseType: 'blob' }\n        });\n        const blobUrl = window.URL.createObjectURL(respuesta);\n        window.open(blobUrl, '_blank');\n    } catch (error) {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    }\n}\n/**\n * Buscar las funcionalidades por tipo de prueba.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidades(tipo_prueba_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/funcionalidades-listado`,\n        data : {\n            tipo_prueba_id: tipo_prueba_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let beneficios = respuesta.data;\n            const ADICIONALES = beneficios\n                .filter(item => item.predeterminado === 0)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            const PREDEFINIDOS = beneficios\n                .filter(item => item.predeterminado === 1)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            funcionalidades_predefinidos = PREDEFINIDOS;\n            // Verificar si el multiselect está inicializado antes de destruir\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect('destroy');\n            }\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect('destroy');\n            }\n            ADICIONALES.forEach((item) => {\n                $('#adicionales_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            PREDEFINIDOS.forEach((item) => {\n                $('#predefinidos_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            inizializarMultiselect();\n            if (opcion == 'facturar' || opcion == 'editar') {\n                buscarfuncionalidadesPlanEmpresa($('#id').val());\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Buscar las funcionalidades del plan de la empresa.\n * @param {number} empresa_plan_id ID del plan de empresa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidadesPlanEmpresa(empresa_plan_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/empresas-planes-funcionalidades-listado`,\n        data : {\n            empresa_plan_id: empresa_plan_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let funcionalidades = respuesta.data.map(item => item.funcionalidad_id);\n            $('#adicionales_modal').val(funcionalidades);\n            // Verificar si el multiselect está inicializado antes de refrescar\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect(\"refresh\");\n            }\n            $('#predefinidos_modal').val(funcionalidades);\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect(\"refresh\");\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Función para agregar validaciones adicionales y data adicional en el envío del form.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction validacionAdicional() {\n    let valido = true;\n    let es_solo_creditos = plan_seleccionado === null && plan_creditos_seleccionado !== null;\n    $('#vigencia').val($('#vigencia_modal').val());\n    if ($('#unidades_modal').val() == 'Ilimitadas') {\n        $('#unidades').val('');\n    } else {\n        $('#unidades').val($('#unidades_modal').val());\n    }\n    if ($('#cantidad_ofertas_laborales_modal').val() == 'Ilimitadas') {\n        $('#cantidad_ofertas_laborales').val('');\n    } else {\n        $('#cantidad_ofertas_laborales').val($('#cantidad_ofertas_laborales_modal').val());\n    }\n    $('#cantidad_usuarios').val($('#cantidad_usuarios_modal').val());\n    $('#cantidad_pruebas').val($('#cantidad_pruebas_modal').val());\n    if (opcion == 'facturar' || opcion == 'editar') {\n        let adicionales = $('#adicionales_modal').val();\n        let predefinidos = $('#predefinidos_modal').val();\n        let funcionalidades = adicionales.concat(predefinidos);\n        $('#funcionalidades').val(JSON.stringify(funcionalidades));\n        if (!es_solo_creditos && funcionalidades.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una funcionalidad.');\n        }\n    } else {\n        let ids = [];\n        if (plan_seleccionado && Array.isArray(plan_seleccionado.funcionalidades)) {\n            ids = plan_seleccionado.funcionalidades.map(objeto => objeto.id);\n        }\n        $('#funcionalidades').val(JSON.stringify(ids));\n    }\n    var pruebas_seleccionadas = $('.pruebas:checked').map(function() {\n        return this.value;\n    }).get();\n    $('#pruebas').val('');\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado ? plan_seleccionado.cantidad_pruebas : 0;\n    }\n    if (!es_solo_creditos) {\n        if (pruebas_seleccionadas.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una prueba.');\n        } else if (pruebas_seleccionadas.length > maximo_pruebas) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione maximo ' + maximo_pruebas + ' pruebas.');\n        }\n    }\n    if (valido) {\n        $('#pruebas').val(JSON.stringify(pruebas_seleccionadas));\n    }\n    return valido;\n}\n/**\n * Función para validar que no se exceda al seleccionar limite de pruebas.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction ValidarPruebas() {\n    let cantidad_seleccionadas = $('.pruebas:checked').length;\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado.cantidad_pruebas;\n    }\n    if (cantidad_seleccionadas > maximo_pruebas) {\n        $('#alerta-pruebas').removeClass('d-none');\n    } else {\n        $('#alerta-pruebas').addClass('d-none');\n    }\n}\n/**\n * Abrir el modal con los campos para modificar plan.\n * @param {Event} evento Evento desencadenado.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalModificar(evento) {\n    evento.stopPropagation();\n    if (modificado == false) {\n        $('#nombre-plan-modal').text(plan_seleccionado.nombre);\n        $('#cantidad_pruebas_modal').empty();\n        $('#cantidad_pruebas_modal').append(`\n            <option value=\"\">Seleccione</option>\n        `);\n        for (let j = 1; j <= pruebas.length; j++) {\n            $('#cantidad_pruebas_modal').append(`\n                <option value=\"${j}\">${j} Pruebas</option>\n            `);\n        }\n        $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n        if ([90, 180, 365].includes(plan_seleccionado.vigencia)) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val(plan_seleccionado.vigencia).trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else if (plan_seleccionado.vigencia != null && plan_seleccionado.vigencia != 0) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val('personalizado').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else {\n            $('#tiempo_modal').prop('disabled', true);\n            $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val('');\n        }\n        if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n            $('#unidades_modal').val(plan_seleccionado.unidades);\n            $('#unidades_modal').prop('disabled', false);\n            if (opcion == 'asignar') {\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa_plan.cantidad_ofertas_laborales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', false);\n        } else {\n            $('#unidades_modal').val(empresa.procesos_estimados_mensuales);\n            $('#unidades_modal').prop('disabled', true);\n            if (opcion == 'facturar' || opcion == 'editar') {\n                $('#unidades_modal').val(plan_seleccionado.unidades);\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa.pruebas_estimadas_mensuales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', true);\n        }\n        $('#cantidad_usuarios_modal').val(plan_seleccionado.cantidad_usuarios);\n        if (opcion == 'facturar' || opcion == 'editar') {\n            $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n            buscarfuncionalidadesPlanEmpresa($('#id').val());\n        }\n        $('#boton-guardar-modificaciones').prop('disabled', true);\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('show');\n    }\n}\n/**\n * Función que habilita el boton de guardar un plan modificado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction habilitarBotonGuardar() {\n    $('#boton-guardar-modificaciones').prop('disabled', false);\n}\n/**\n * Función que controla los campos de vigencia en el modal de editar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarTiempo(vigencia) {\n    $('.texto-label-tiempo').text('máximas permitidas');\n    $('#input-container-tiempo').removeClass('d-none');\n    $('#input-container-tiempo').addClass('col-md-6');\n    if (vigencia == 'personalizado') {\n        $('#input-container-vigencia').removeClass('d-none');\n        $('#vigencia_modal').val('');\n    } else if ((vigencia == '' || vigencia == null || vigencia == 0) && plan_seleccionado != null && (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0)) {\n        $('.texto-label-tiempo').text('');\n        $('#input-container-tiempo').addClass('d-none');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val('');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    } else if (['90', '180', '365'].includes(vigencia)) {\n        $('#input-container-tiempo').removeClass('col-md-6');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val(vigencia);\n    } else {\n        $('#vigencia_modal').val(vigencia);\n        $('#input-container-vigencia').addClass('d-none');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    }\n}\n/**\n * Abrir el modal de confirmación.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalEstasSeguro() {\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('hide');\n        $('#modal-estas-seguro').modal('show');\n    }\n}\n/**\n * Cancelar la edición de un plan.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction cancelarEdicion() {\n    modificado = false;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    limpiarAdicional();\n    mostrarPlanSeleccionado();\n}\n/**\n * Confirmar los datos editados.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction confirmarEdicion() {\n    modificado = true;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    $('#plan-modificado').text('(modificado)');\n    mostrarPlanSeleccionado();\n}\n/**\n * Limpiar los campos del modal.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction limpiarAdicional() {\n    $('#cantidad_pruebas_modal').val('').trigger('change').trigger('select2:select');\n    $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n    $('#unidades_modal').val('');\n    $('#cantidad_ofertas_laborales_modal').val('');\n    $('#cantidad_usuarios_modal').val('');\n    // Verificar si el multiselect está inicializado antes de llamar uncheckAll\n    if ($('#adicionales_modal').data('multiselect')) {\n        $('#adicionales_modal').multiselect(\"uncheckAll\");\n    }\n    if ($('#predefinidos_modal').data('multiselect')) {\n        $('#predefinidos_modal').multiselect(\"uncheckAll\");\n    }\n}\n/**\n * Función para ejecutar acciones luego de guardar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction postSuccess(respuesta) {\n    limpiarFormulario(respuesta.formulario);\n    if (opcion == 'asignar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se asignó con éxito a la empresa`,\n        }));\n    } else if (opcion == 'facturar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se facturó con éxito`,\n        }));\n    } else if (opcion == 'editar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se actualizó con éxito`,\n        }));\n    }\n    window.location.href='/empresas-gestionar/' + empresa.id;\n}\n","structuredPatch":[{"oldStart":643,"oldLines":7,"newStart":643,"newLines":7,"lines":[" "," /**","  * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.","- * ","+ *","  * @returns {void}","  * @author Andres Gonzalez","  */"]},{"oldStart":651,"oldLines":12,"newStart":651,"newLines":13,"lines":["     let valor_plan = 0;","     let valor_creditos = 0;"," ","-    let valor_plan_input = $('#precio_plan').val();","+    // Usar los campos visuales para mostrar el total","+    let valor_plan_input = $('#precio_plan_visual').val();","     if (valor_plan_input) {","         valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;","     }"," ","-    let valor_creditos_input = $('#precio_creditos').val();","+    let valor_creditos_input = $('#precio_creditos_visual').val();","     if (valor_creditos_input) {","         valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;","     }"]},{"oldStart":670,"oldLines":6,"newStart":671,"newLines":58,"lines":[" }"," "," /**","+ * Aplicar el porcentaje de descuento al valor del plan o créditos.","+ * El valor original se mantiene en el campo hidden para el envío.","+ * El campo visual muestra el valor con descuento y se deshabilita.","+ *","+ * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"","+ * @returns {void}","+ */","+function aplicarDescuento(tipo) {","+    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';","+    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';","+    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';","+","+    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;","+    let valor_original_str = $(campo_original).val();","+    let valor_original = 0;","+","+    if (valor_original_str) {","+        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;","+    }","+","+    // Si no hay valor original guardado, tomarlo del campo visual","+    if (valor_original === 0) {","+        let valor_visual = $(campo_visual).val();","+        if (valor_visual) {","+            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;","+            $(campo_original).val(valor_original);","+        }","+    }","+","+    if (porcentaje > 0 && porcentaje <= 100) {","+        // Calcular el valor con descuento","+        let descuento = valor_original * (porcentaje / 100);","+        let valor_con_descuento = Math.round(valor_original - descuento);","+","+        // Mostrar el valor con descuento en el campo visual","+        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));","+","+        // Deshabilitar el campo visual","+        $(campo_visual).prop('disabled', true);","+    } else {","+        // Si no hay descuento, mostrar el valor original y habilitar el campo","+        if (valor_original > 0) {","+            $(campo_visual).val(valor_original.toLocaleString('es-CO'));","+        }","+        $(campo_visual).prop('disabled', false);","+    }","+","+    // Actualizar el valor total mostrado","+    actualizarValorDesdeInput();","+}","+","+/**","  * Abrir la factura del plan en una nueva pestaña del navegador.","  * ","  * @param {number} factura_id Id de la factura."]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"80e549e4-80b4-4a84-bc65-4389441056bf"}
{"parentUuid":"dc4be5a8-782f-480d-a2b3-94f097dc84b8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NN4CRHiDDYc2kq4Qad7myV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora también necesito actualizar el evento en el $(document).ready para escuchar los inputs correctos (los campos visuales).","signature":"EqcCCkYICxgCKkAqEcV9Vphb00wwH/56C7l9HRPgQpHYNnY6PzBDnYehj4EiBTHVIiPRmWVlOQ7oVIA5+wV8wB0EVz3zSr8xH8zrEgyK+J30AHLwCS1MWm0aDHGIq8qu7QzPcSA3VCIwY5A5kP7y/QOqE/u5n9uYBRInziSr4+omN7rXLM7tV1gCEKWuQRPmpyGM/T0Jtp7NKo4B0MYmQFG3E2ttn92Pcjhyhw9v2YHRcIGwlSBHOroKBLt9qMVWfQtYINyP337M17BB2P8MmL8MCNjPaH86VdK/+jJsgp0Sm7NLCUCnd/eHuxUzG/paJc6DlSzKiSmOhiYNE/pmK4xscGZLxCGnbYVFK1s8w6uvc1G6Im8UOrrFs5gm2Ku71xrZTz8FJ6k55xgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2745,"cache_read_input_tokens":72276,"cache_creation":{"ephemeral_5m_input_tokens":2745,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3vCy1fptey7jLYRZJ6","type":"assistant","uuid":"d479dccc-c945-4015-a83c-ec1d5489209a","timestamp":"2026-01-26T13:15:16.025Z"}
{"parentUuid":"d479dccc-c945-4015-a83c-ec1d5489209a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NN4CRHiDDYc2kq4Qad7myV","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora actualizo el evento `$(document).ready` para escuchar los campos visuales."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2745,"cache_read_input_tokens":72276,"cache_creation":{"ephemeral_5m_input_tokens":2745,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3vCy1fptey7jLYRZJ6","type":"assistant","uuid":"608c153c-6c4f-4333-98f0-1488d43fba3a","timestamp":"2026-01-26T13:15:16.394Z"}
{"parentUuid":"608c153c-6c4f-4333-98f0-1488d43fba3a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NN4CRHiDDYc2kq4Qad7myV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01788M15yS5LVBu9a4eHnVvg","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","offset":1,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2745,"cache_read_input_tokens":72276,"cache_creation":{"ephemeral_5m_input_tokens":2745,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3vCy1fptey7jLYRZJ6","type":"assistant","uuid":"a256478d-ac42-4c25-a68b-41843e2d4069","timestamp":"2026-01-26T13:15:17.077Z"}
{"parentUuid":"a256478d-ac42-4c25-a68b-41843e2d4069","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01788M15yS5LVBu9a4eHnVvg","type":"tool_result","content":"     1→table = null;\n     2→planes = [];\n     3→pruebas = [];\n     4→modificado = false;\n     5→funcionalidades_predefinidos = [];\n     6→plan_creditos_seleccionado = null;\n     7→\n     8→$(document).ready(function() {\n     9→    $(document).on('input', '#precio_plan, #precio_creditos', function() {\n    10→        actualizarValorDesdeInput();\n    11→    });\n    12→});\n    13→\n    14→/**\n    15→ * Establecer el tipo de prueba en el selector del formulario.\n    16→ * @param {number} tipo_prueba_id ID del tipo de prueba.\n    17→ * @returns {void}\n    18→ * @author José Manuel Jiménez\n    19→ * @author Daniel Beltrán\n    20→ * @author Andres Morales\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"e40491ed-1b06-499e-ade4-59f1a084200d","timestamp":"2026-01-26T13:15:19.593Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","content":"table = null;\nplanes = [];\npruebas = [];\nmodificado = false;\nfuncionalidades_predefinidos = [];\nplan_creditos_seleccionado = null;\n\n$(document).ready(function() {\n    $(document).on('input', '#precio_plan, #precio_creditos', function() {\n        actualizarValorDesdeInput();\n    });\n});\n\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales","numLines":20,"startLine":1,"totalLines":1096}},"sourceToolAssistantUUID":"a256478d-ac42-4c25-a68b-41843e2d4069"}
{"parentUuid":"e40491ed-1b06-499e-ade4-59f1a084200d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01M4sepcQKz89NwgX7CQe5qY","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Necesito actualizar el selector de eventos para usar los campos visuales.","signature":"EvEBCkYICxgCKkD0zZva1WG62eokZIxrLIAInab6TrY8wbixT46RvHtc20UELlG02wOaKyIHOHytQ5e7nxY9b4du6/jW3ZiEWjmVEgyg2zRMNAhefof9UUQaDLmY0YufwEgQBA8MUCIw0GRgwm9n4yuWq99/Sh9ymUZ5kDFGtRPZbzm7XFjIQG59b4UvqLe7Q884HUckVyxpKllEBNqFfM9o0qUjnZ1dLWXK0sUGIeKIs+VD9E4xr2GPs/SKAph0x5HFf8AiBPyUnTVl403xcVyeHg6EBIXvpPKS/TgFnO6LWniP3ZRjhy4D/vqY4uezGvEEpBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":509,"cache_read_input_tokens":75021,"cache_creation":{"ephemeral_5m_input_tokens":509,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW3vgVyPUTZSwimtCSyz","type":"assistant","uuid":"93e401e0-aced-4f2b-870a-39a6548b4e44","timestamp":"2026-01-26T13:15:22.373Z"}
{"parentUuid":"93e401e0-aced-4f2b-870a-39a6548b4e44","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01M4sepcQKz89NwgX7CQe5qY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011n4u18XzygTjK9oCFA9jAF","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"$(document).ready(function() {\n    $(document).on('input', '#precio_plan, #precio_creditos', function() {\n        actualizarValorDesdeInput();\n    });\n});","new_string":"$(document).ready(function() {\n    $(document).on('input', '#precio_plan_visual, #precio_creditos_visual', function() {\n        actualizarValorDesdeInput();\n    });\n});"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":509,"cache_read_input_tokens":75021,"cache_creation":{"ephemeral_5m_input_tokens":509,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW3vgVyPUTZSwimtCSyz","type":"assistant","uuid":"fe3e066e-cad0-4186-8f46-584466f87072","timestamp":"2026-01-26T13:15:23.878Z"}
{"parentUuid":"fe3e066e-cad0-4186-8f46-584466f87072","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011n4u18XzygTjK9oCFA9jAF","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     4→modificado = false;\n     5→funcionalidades_predefinidos = [];\n     6→plan_creditos_seleccionado = null;\n     7→\n     8→$(document).ready(function() {\n     9→    $(document).on('input', '#precio_plan_visual, #precio_creditos_visual', function() {\n    10→        actualizarValorDesdeInput();\n    11→    });\n    12→});\n    13→\n    14→/**\n    15→ * Establecer el tipo de prueba en el selector del formulario.\n    16→ * @param {number} tipo_prueba_id ID del tipo de prueba."}]},"uuid":"6d0b6153-dfe4-4601-9abe-066aa31efc97","timestamp":"2026-01-26T13:16:10.805Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","oldString":"$(document).ready(function() {\n    $(document).on('input', '#precio_plan, #precio_creditos', function() {\n        actualizarValorDesdeInput();\n    });\n});","newString":"$(document).ready(function() {\n    $(document).on('input', '#precio_plan_visual, #precio_creditos_visual', function() {\n        actualizarValorDesdeInput();\n    });\n});","originalFile":"table = null;\nplanes = [];\npruebas = [];\nmodificado = false;\nfuncionalidades_predefinidos = [];\nplan_creditos_seleccionado = null;\n\n$(document).ready(function() {\n    $(document).on('input', '#precio_plan, #precio_creditos', function() {\n        actualizarValorDesdeInput();\n    });\n});\n\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales\n */\nfunction seleccionarTipoPrueba(tipo_prueba_id) {\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"card-body text-center\">\n            <button type=\"button\" id=\"elegir-plan\" class=\"btn btn-outline-primary\" disabled onclick=\"modalElegirPlan();\">Elegir plan</button>\n        </div>\n    `);\n    $('#seccion-pruebas').addClass('d-none');\n    $('#plan_id').val('');\n    pruebas = [];\n    // Convertir tipo_prueba_id a array si no lo es\n    let tipos_prueba = Array.isArray(tipo_prueba_id) ? tipo_prueba_id : [tipo_prueba_id];\n    // Crear los botones según los tipos de prueba seleccionados\n    let botones_html = '<div class=\"card-body text-center\">';\n    tipos_prueba.forEach(function(tipo_id) {\n        let texto_boton = 'Elegir plan';\n        let clase_boton = 'btn-outline-primary';\n        if (tipo_id == 1) {\n            texto_boton = 'Elegir Plan de Selección';\n            clase_boton = 'btn-outline-primary';\n        } else if (tipo_id == 2) {\n            texto_boton = 'Elegir Plan de Créditos IA';\n            clase_boton = 'btn-outline-info';\n        }\n        botones_html += `\n            <button type=\"button\" id=\"elegir-plan-${tipo_id}\" class=\"btn ${clase_boton} mx-1 my-1\" disabled onclick=\"modalElegirPlan(${tipo_id});\">\n                ${texto_boton}\n            </button>\n        `;\n    });\n    botones_html += '</div>';\n    $('#contenedor-plan').append(botones_html);\n    $('#tipo_prueba_id').val(tipo_prueba_id).trigger('select2');\n    if (tipo_prueba_id && (Array.isArray(tipo_prueba_id) ? tipo_prueba_id.length > 0 : tipo_prueba_id)) {\n        // Habilitar todos los botones creados\n        tipos_prueba.forEach(function(tipo_id) {\n            $(`#elegir-plan-${tipo_id}`).prop('disabled', false);\n        });\n        $.ajax({\n            type: 'GET',\n            url : `/pruebas-listado`,\n            data: {\n                tipo_prueba_id: tipo_prueba_id,\n                activo: 1\n            }\n        }).then((respuesta) => {\n            limpiarAdicional();\n            $('#contenedor-pruebas').empty();\n            pruebas = respuesta.data;\n            for (let i = 0; i < pruebas.length; i++) {\n                $('#contenedor-pruebas').append(`\n                    <div class=\"col-12 col-md-6\">\n                        <div class=\"d-flex align-items-center\">\n                            <div class=\"check-container my-1 me-1\">\n                                <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                            </div>\n                            <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                        </div>\n                    </div>\n                `);\n            }\n            if (opcion == 'facturar' || opcion == 'editar') {\n                for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                    $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n                }\n                $('#seccion-pruebas').removeClass('d-none');\n                mostrarPlanSeleccionado();\n            }\n            if (opcion == 'editar') {\n                $('#tipo_prueba_id').prop('disabled', true);\n            }\n        }).catch((error) => {\n            console.error(error);\n        });\n    } else {\n        $('#elegir-plan').prop('disabled', true);\n    }\n}\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction seleccionarTipoPruebaMultiple() {\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    tipos_prueba = tipos_prueba.filter(function(tipo_id) {\n        return tipo_id !== null && tipo_id !== '' && tipo_id !== undefined;\n    });\n    if (tipos_prueba.length === 0) {\n        // Si no hay tipos seleccionados, limpiar todo\n        $('#contenedor-plan').empty();\n        $('#contenedor-creditos').empty();\n        $('#seccion-pruebas').addClass('d-none');\n        $('#plan_id').val('');\n        $('#plan_id').prop('required', false);\n        $('#plan_id').prop('disabled', true);\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n        plan_seleccionado = null;\n        plan_creditos_seleccionado = null;\n        pruebas = [];\n        return;\n    }\n    let tiene_seleccion = tipos_prueba.includes('1') || tipos_prueba.includes(1);\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    $('#plan_id').prop('required', tiene_seleccion);\n    $('#plan_id').prop('disabled', !tiene_seleccion);\n    // Manejo del plan de selección\n    if (tiene_seleccion) {\n        // Si hay un plan seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_seleccionado === null && $('#contenedor-plan').children().length === 0) {\n            let seccion_seleccion = `\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Selección</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-1\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(1);\">\n                            Elegir Plan de Selección\n                        </button>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-plan').html(seccion_seleccion);\n        }\n    } else {\n        // Si se deseleccionó el tipo de selección, limpiar el plan\n        $('#contenedor-plan').empty();\n        plan_seleccionado = null;\n        $('#plan_id').val('');\n    }\n    // Manejo del plan de créditos\n    if (tiene_creditos) {\n        // Si hay un plan de créditos seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n            let seccion_creditos = `\n                <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                    <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                    <div class=\"card rounded rounded-3\">\n                        <div class=\"card-body text-center\">\n                            <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                                Elegir Plan de Créditos IA\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-creditos').html(seccion_creditos);\n        }\n    } else {\n        // Si se deseleccionó el tipo de créditos, limpiar el plan de créditos\n        $('#contenedor-creditos').empty();\n        $('#contenedor-plan-creditos').remove();\n        plan_creditos_seleccionado = null;\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/pruebas-listado`,\n        data: {\n            tipo_prueba_id: tipos_prueba,\n            activo: 1\n        }\n    }).then((respuesta) => {\n        limpiarAdicional();\n        $('#contenedor-pruebas').empty();\n        pruebas = respuesta.data;\n        for (let i = 0; i < pruebas.length; i++) {\n            $('#contenedor-pruebas').append(`\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"d-flex align-items-center\">\n                        <div class=\"check-container my-1 me-1\">\n                            <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                        </div>\n                        <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                    </div>\n                </div>\n            `);\n        }\n        if (opcion == 'facturar' || opcion == 'editar') {\n            for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n            }\n            $('#seccion-pruebas').removeClass('d-none');\n            mostrarPlanSeleccionado();\n        }\n        if (opcion == 'editar') {\n            $('#tipo_prueba_id').prop('disabled', true);\n        }\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    });\n}\n/**\n * Obtener el listado de planes según el tipo_prueba_id seleccionado anteriormente.\n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalElegirPlan(tipo_especifico = null) {\n    let tipo_prueba_para_consulta = tipo_especifico !== null ? tipo_especifico : $('#tipo_prueba_id').val();\n    // Si es tipo 2 (Créditos IA), cargar planes de créditos\n    if (tipo_prueba_para_consulta == 2 || tipo_prueba_para_consulta == '2') {\n        $.ajax({\n            type: 'GET',\n            url: '/planes-creditos',\n            data: {\n                activo: true\n            }\n        }).then((respuesta) => {\n            planes_creditos = respuesta.data.planes;\n            mostrarPlanesCreditos();\n        }).catch((error) => {\n            mostrarToast('danger', 'Ocurrió un error');\n        });\n        return;\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/planes-listado`,\n        data: {\n            tipo_prueba_id: $('#tipo_prueba_id').val()\n        }\n    }).then((respuesta) => {\n        planes = respuesta.data;\n        mostrarPlanes();\n    }).catch((error) => {\n        console.error(error);\n    });\n}\n/**\n * Mostrar los planes de créditos en el modal.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction mostrarPlanesCreditos() {\n    let filtro_orden = $('#filtro-plan-credito').val();\n    let buscar = $('#buscador-plan-credito').val() || '';\n    // Ordenar planes según el filtro\n    let planes_ordenados = [...planes_creditos];\n    if (filtro_orden === 'Mayor') {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else if (filtro_orden === 'Menor') {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    if (buscar !== '') {\n        planes_ordenados = planes_ordenados.filter(plan =>\n            plan.nombre.toLowerCase().includes(buscar.toLowerCase())\n        );\n    }\n    $('#contenedor-planes-creditos').empty();\n    if (planes_ordenados.length === 0) {\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"text-center py-5\">\n                <p class=\"text-muted\">No se encontraron planes</p>\n            </div>\n        `);\n    }\n    for (let i = 0; i < planes_ordenados.length; i++) {\n        let plan = planes_ordenados[i];\n        let creditos_disponibles = plan.creditos_disponibles || plan.creditos || 0;\n        let creditos_promedio = plan.creditos_promedio_accion || 0;\n        let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n            ? Math.floor(creditos_disponibles / creditos_promedio)\n            : 0;\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"card rounded rounded-3 border-hover pointer mb-3\" onclick=\"elegirPlanCreditos(${i}, ${filtro_orden === 'Mayor' ? 'true' : 'false'});\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6 text-gray-10\">${plan.nombre}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        `);\n    }\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('show');\n    }\n    $('#buscador-plan-credito').off('input').on('input', function() {\n        mostrarPlanesCreditos();\n    });\n}\n/**\n * Elegir un plan de créditos IA.\n * @param {number} indice Índice del plan en el array.\n * @param {boolean} orden_mayor Si está ordenado de mayor a menor.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction elegirPlanCreditos(indice, orden_mayor = false) {\n    // Aplicar el mismo ordenamiento que en mostrarPlanesCreditos\n    let planes_ordenados = [...planes_creditos];\n    if (orden_mayor) {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    plan_creditos_seleccionado = planes_ordenados[indice];\n    // Establecer los valores en los campos hidden\n    $('#plan_credito_id').val(plan_creditos_seleccionado.id);\n    $('#creditos').val(plan_creditos_seleccionado.creditos);\n    mostrarPlanCreditosSeleccionado();\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('hide');\n    }\n}\n/**\n * Mostrar el plan de créditos seleccionado en el contenedor.\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarPlanCreditosSeleccionado() {\n    if (!plan_creditos_seleccionado || !plan_creditos_seleccionado.creditos) {\n        mostrarToast('danger', 'Ocurrió un error'+plan_creditos_seleccionado);\n        return;\n    }\n    let creditos_disponibles = plan_creditos_seleccionado.creditos_disponibles || plan_creditos_seleccionado.creditos || 0;\n    let creditos_promedio = plan_creditos_seleccionado.creditos_promedio_accion || 0;\n    let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n        ? Math.floor(creditos_disponibles / creditos_promedio)\n        : 0;\n    let seccion_creditos = `\n        <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n            <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n            <div class=\"card rounded rounded-3\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4 pointer\" onclick=\"modalElegirPlan(2);\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6\">${plan_creditos_seleccionado.nombre || 'Plan de Créditos'}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan_creditos_seleccionado.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    // Remover el contenedor anterior si existe\n    $('#contenedor-plan-creditos').remove();\n    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n    if ($('#contenedor-creditos').length) {\n        $('#contenedor-creditos').html(seccion_creditos);\n    } else {\n        $('#contenedor-plan').after(seccion_creditos);\n    }\n    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }\n    actualizarValorVentaTotal();\n}\n\n/**\n * Mostrar en el modal los planes obtenidos en el listado.\n * \n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPlanes() {\n    let buscar = $('#buscador-plan').val();\n    let filtro_plan = $('#filtro-plan').val();\n    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n        table.destroy();\n    }\n    $('#buscador-plan').remove();\n    $('#tbody-planes').empty();\n    for (let i = 0; i < planes.length; i++) {\n        if (\n            (filtro_plan == 'Todos') ||\n            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n        ) {\n            let cantidad_usuarios = '';\n            if (planes[i].cantidad_usuarios != null) {\n                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n            }\n            let cantidad_ofertas_laborales = '';\n            if (planes[i].cantidad_ofertas_laborales != null) {\n                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n            }\n            let cantidad_pruebas = '';\n            if (planes[i].cantidad_pruebas != null) {\n                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;\n            }\n            let unidades = '';\n            if (planes[i].unidades != null) {\n                unidades = `<div class=\"col-auto w-90px\"><i class=\"bi bi-box\"></i> ${planes[i].unidades}</div>`;\n            }\n            let vigencia = '';\n            if (planes[i].vigencia == 90) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n            } else if (planes[i].vigencia == 180) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n            }  else if (planes[i].vigencia == 365) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n            } else if (planes[i].vigencia == null || planes[i].vigencia == 0) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n            } else {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${planes[i].vigencia} días</div>`;\n            }\n            $('#tbody-planes').append(`\n                <tr>\n                    <td style=\"border-bottom: 0px!important;\">\n                        <div class=\"border border-1 rounded rounded-2 pointer border-hover\" onclick=\"elegirPlan(${i});\">\n                            <div class=\"row m-0 w-100 px-3 py-5 text-headline-6\">\n                                <div class=\"col\">${planes[i].nombre !== null ? planes[i].nombre : ''}</div>\n                                ${cantidad_ofertas_laborales}\n                                ${unidades}\n                                ${cantidad_usuarios}\n                                ${cantidad_pruebas}\n                                ${vigencia}\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            `);\n        }\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('show');\n    }\n    table = $('#tabla-planes').DataTable({\n        \"paging\": false,\n        \"searching\": true,\n        \"ordering\": false,\n        \"info\": false\n    });\n    let buscador = $('#tabla-planes_wrapper input');\n    $(buscador).addClass('rounded-2 text-body-2');\n    $(buscador).prop('placeholder', 'Buscar');\n    $(buscador).prop('id', 'buscador-plan');\n    $('#input-busqueda').append(buscador);\n    $(buscador).val(buscar).trigger('input');\n}\n/**\n * Elegir un plan del listado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction elegirPlan(i) {\n    plan_seleccionado = planes[i];\n    mostrarPlanSeleccionado();\n}\n/**\n * Mostrar el plan seleccionado en el contenedor y en las opciones del modificar.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction mostrarPlanSeleccionado() {\n    let cantidad_usuarios = '';\n    let cantidad_usuarios_modal = $('#cantidad_usuarios_modal').val();\n    if (cantidad_usuarios_modal != '') {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${cantidad_usuarios_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_usuarios != null) {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${plan_seleccionado.cantidad_usuarios}</div>`;\n    }\n    let cantidad_ofertas_laborales = '';\n    let cantidad_ofertas_laborales_modal = $('#cantidad_ofertas_laborales_modal').val();\n    if (cantidad_ofertas_laborales_modal != '') {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${cantidad_ofertas_laborales_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_ofertas_laborales != null) {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${plan_seleccionado.cantidad_ofertas_laborales}</div>`;\n    }\n    let cantidad_pruebas = '';\n    let cantidad_pruebas_modal = $('#cantidad_pruebas_modal').val();\n    if (cantidad_pruebas_modal != '') {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${cantidad_pruebas_modal}</div>`;\n        $('.cantidad-pruebas').text(cantidad_pruebas_modal);\n    } else if (plan_seleccionado.cantidad_pruebas != null) {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${plan_seleccionado.cantidad_pruebas}</div>`;\n        $('.cantidad-pruebas').text(plan_seleccionado.cantidad_pruebas);\n    }\n    let unidades = '';\n    let unidades_modal = $('#unidades_modal').val();\n    if (unidades_modal != '') {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${unidades_modal}</div>`;\n    } else if (plan_seleccionado.unidades != null) {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${plan_seleccionado.unidades}</div>`;\n    }\n    let vigencia = '';\n    let vigencia_modal = $('#vigencia_modal').val();\n    if (plan_seleccionado.vigencia == 90 || vigencia_modal == '90') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n    } else if (plan_seleccionado.vigencia == 180 || vigencia_modal == '180') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n    }  else if (plan_seleccionado.vigencia == 365 || vigencia_modal == '365') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n    } else if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n    } else if (vigencia_modal != '') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${vigencia_modal} días</div>`;\n    } else {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${plan_seleccionado.vigencia} días</div>`;\n    }\n    let abrir_modal_elegir_plan = '';\n    let icono_editar = `\n        <div class=\"col-auto w-90px\">\n            <button type=\"button\" class=\"btn btn-text-primary text-white btn-circle\" onclick=\"abrirModalModificar(event);\" title=\"Modificar plan\">\n                <i class=\"bi bi-wrench\"></i>\n            </button>\n        </div>\n    `;\n    if (opcion == 'asignar') {\n        abrir_modal_elegir_plan = `onclick=\"modalElegirPlan();\"`;\n        icono_editar = '';\n    }\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"row border rounded rounded-3 m-0 w-100 px-3 py-5 text-headline-6 pointer\" ${abrir_modal_elegir_plan}>\n            <div class=\"col\">${plan_seleccionado.nombre !== null ? plan_seleccionado.nombre : ''} <span id=\"plan-modificado\"></span></div>\n            ${cantidad_ofertas_laborales}\n            ${unidades}\n            ${cantidad_usuarios}\n            ${cantidad_pruebas}\n            ${vigencia}\n            ${icono_editar}\n        </div>\n    `);\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    // Solo agregar el botón de elegir plan de créditos si no hay uno seleccionado y se requiere\n    if (tiene_creditos && plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n        let seccion_creditos = `\n            <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                            Elegir Plan de Créditos IA\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n        $('#contenedor-creditos').append(seccion_creditos);\n    }\n    $('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n\n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_plan_original').val(plan_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_plan_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento').val('');\n    }\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}\n\n/**\n * Actualizar el valor de venta total sumando plan de selección y créditos.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorVentaTotal() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n    }\n\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    // Usar los campos visuales para mostrar el total\n    let valor_plan_input = $('#precio_plan_visual').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos_visual').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Aplicar el porcentaje de descuento al valor del plan o créditos.\n * El valor original se mantiene en el campo hidden para el envío.\n * El campo visual muestra el valor con descuento y se deshabilita.\n *\n * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n * @returns {void}\n */\nfunction aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}\n\n/**\n * Abrir la factura del plan en una nueva pestaña del navegador.\n * \n * @param {number} factura_id Id de la factura.\n * @returns {void}\n * @author Andres Morales\n */\nasync function abrirFacturaPlan(factura_id) {\n    if (!factura_id) {\n        mostrarToast('danger', 'No se encontró la factura');\n        return;\n    }\n    try {\n        const respuesta = await $.ajax({\n            type: 'GET',\n            url: `/archivos-abrir/${factura_id}`,\n            xhrFields: { responseType: 'blob' }\n        });\n        const blobUrl = window.URL.createObjectURL(respuesta);\n        window.open(blobUrl, '_blank');\n    } catch (error) {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    }\n}\n/**\n * Buscar las funcionalidades por tipo de prueba.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidades(tipo_prueba_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/funcionalidades-listado`,\n        data : {\n            tipo_prueba_id: tipo_prueba_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let beneficios = respuesta.data;\n            const ADICIONALES = beneficios\n                .filter(item => item.predeterminado === 0)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            const PREDEFINIDOS = beneficios\n                .filter(item => item.predeterminado === 1)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            funcionalidades_predefinidos = PREDEFINIDOS;\n            // Verificar si el multiselect está inicializado antes de destruir\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect('destroy');\n            }\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect('destroy');\n            }\n            ADICIONALES.forEach((item) => {\n                $('#adicionales_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            PREDEFINIDOS.forEach((item) => {\n                $('#predefinidos_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            inizializarMultiselect();\n            if (opcion == 'facturar' || opcion == 'editar') {\n                buscarfuncionalidadesPlanEmpresa($('#id').val());\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Buscar las funcionalidades del plan de la empresa.\n * @param {number} empresa_plan_id ID del plan de empresa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidadesPlanEmpresa(empresa_plan_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/empresas-planes-funcionalidades-listado`,\n        data : {\n            empresa_plan_id: empresa_plan_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let funcionalidades = respuesta.data.map(item => item.funcionalidad_id);\n            $('#adicionales_modal').val(funcionalidades);\n            // Verificar si el multiselect está inicializado antes de refrescar\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect(\"refresh\");\n            }\n            $('#predefinidos_modal').val(funcionalidades);\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect(\"refresh\");\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Función para agregar validaciones adicionales y data adicional en el envío del form.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction validacionAdicional() {\n    let valido = true;\n    let es_solo_creditos = plan_seleccionado === null && plan_creditos_seleccionado !== null;\n    $('#vigencia').val($('#vigencia_modal').val());\n    if ($('#unidades_modal').val() == 'Ilimitadas') {\n        $('#unidades').val('');\n    } else {\n        $('#unidades').val($('#unidades_modal').val());\n    }\n    if ($('#cantidad_ofertas_laborales_modal').val() == 'Ilimitadas') {\n        $('#cantidad_ofertas_laborales').val('');\n    } else {\n        $('#cantidad_ofertas_laborales').val($('#cantidad_ofertas_laborales_modal').val());\n    }\n    $('#cantidad_usuarios').val($('#cantidad_usuarios_modal').val());\n    $('#cantidad_pruebas').val($('#cantidad_pruebas_modal').val());\n    if (opcion == 'facturar' || opcion == 'editar') {\n        let adicionales = $('#adicionales_modal').val();\n        let predefinidos = $('#predefinidos_modal').val();\n        let funcionalidades = adicionales.concat(predefinidos);\n        $('#funcionalidades').val(JSON.stringify(funcionalidades));\n        if (!es_solo_creditos && funcionalidades.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una funcionalidad.');\n        }\n    } else {\n        let ids = [];\n        if (plan_seleccionado && Array.isArray(plan_seleccionado.funcionalidades)) {\n            ids = plan_seleccionado.funcionalidades.map(objeto => objeto.id);\n        }\n        $('#funcionalidades').val(JSON.stringify(ids));\n    }\n    var pruebas_seleccionadas = $('.pruebas:checked').map(function() {\n        return this.value;\n    }).get();\n    $('#pruebas').val('');\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado ? plan_seleccionado.cantidad_pruebas : 0;\n    }\n    if (!es_solo_creditos) {\n        if (pruebas_seleccionadas.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una prueba.');\n        } else if (pruebas_seleccionadas.length > maximo_pruebas) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione maximo ' + maximo_pruebas + ' pruebas.');\n        }\n    }\n    if (valido) {\n        $('#pruebas').val(JSON.stringify(pruebas_seleccionadas));\n    }\n    return valido;\n}\n/**\n * Función para validar que no se exceda al seleccionar limite de pruebas.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction ValidarPruebas() {\n    let cantidad_seleccionadas = $('.pruebas:checked').length;\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado.cantidad_pruebas;\n    }\n    if (cantidad_seleccionadas > maximo_pruebas) {\n        $('#alerta-pruebas').removeClass('d-none');\n    } else {\n        $('#alerta-pruebas').addClass('d-none');\n    }\n}\n/**\n * Abrir el modal con los campos para modificar plan.\n * @param {Event} evento Evento desencadenado.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalModificar(evento) {\n    evento.stopPropagation();\n    if (modificado == false) {\n        $('#nombre-plan-modal').text(plan_seleccionado.nombre);\n        $('#cantidad_pruebas_modal').empty();\n        $('#cantidad_pruebas_modal').append(`\n            <option value=\"\">Seleccione</option>\n        `);\n        for (let j = 1; j <= pruebas.length; j++) {\n            $('#cantidad_pruebas_modal').append(`\n                <option value=\"${j}\">${j} Pruebas</option>\n            `);\n        }\n        $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n        if ([90, 180, 365].includes(plan_seleccionado.vigencia)) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val(plan_seleccionado.vigencia).trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else if (plan_seleccionado.vigencia != null && plan_seleccionado.vigencia != 0) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val('personalizado').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else {\n            $('#tiempo_modal').prop('disabled', true);\n            $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val('');\n        }\n        if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n            $('#unidades_modal').val(plan_seleccionado.unidades);\n            $('#unidades_modal').prop('disabled', false);\n            if (opcion == 'asignar') {\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa_plan.cantidad_ofertas_laborales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', false);\n        } else {\n            $('#unidades_modal').val(empresa.procesos_estimados_mensuales);\n            $('#unidades_modal').prop('disabled', true);\n            if (opcion == 'facturar' || opcion == 'editar') {\n                $('#unidades_modal').val(plan_seleccionado.unidades);\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa.pruebas_estimadas_mensuales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', true);\n        }\n        $('#cantidad_usuarios_modal').val(plan_seleccionado.cantidad_usuarios);\n        if (opcion == 'facturar' || opcion == 'editar') {\n            $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n            buscarfuncionalidadesPlanEmpresa($('#id').val());\n        }\n        $('#boton-guardar-modificaciones').prop('disabled', true);\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('show');\n    }\n}\n/**\n * Función que habilita el boton de guardar un plan modificado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction habilitarBotonGuardar() {\n    $('#boton-guardar-modificaciones').prop('disabled', false);\n}\n/**\n * Función que controla los campos de vigencia en el modal de editar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarTiempo(vigencia) {\n    $('.texto-label-tiempo').text('máximas permitidas');\n    $('#input-container-tiempo').removeClass('d-none');\n    $('#input-container-tiempo').addClass('col-md-6');\n    if (vigencia == 'personalizado') {\n        $('#input-container-vigencia').removeClass('d-none');\n        $('#vigencia_modal').val('');\n    } else if ((vigencia == '' || vigencia == null || vigencia == 0) && plan_seleccionado != null && (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0)) {\n        $('.texto-label-tiempo').text('');\n        $('#input-container-tiempo').addClass('d-none');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val('');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    } else if (['90', '180', '365'].includes(vigencia)) {\n        $('#input-container-tiempo').removeClass('col-md-6');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val(vigencia);\n    } else {\n        $('#vigencia_modal').val(vigencia);\n        $('#input-container-vigencia').addClass('d-none');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    }\n}\n/**\n * Abrir el modal de confirmación.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalEstasSeguro() {\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('hide');\n        $('#modal-estas-seguro').modal('show');\n    }\n}\n/**\n * Cancelar la edición de un plan.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction cancelarEdicion() {\n    modificado = false;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    limpiarAdicional();\n    mostrarPlanSeleccionado();\n}\n/**\n * Confirmar los datos editados.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction confirmarEdicion() {\n    modificado = true;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    $('#plan-modificado').text('(modificado)');\n    mostrarPlanSeleccionado();\n}\n/**\n * Limpiar los campos del modal.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction limpiarAdicional() {\n    $('#cantidad_pruebas_modal').val('').trigger('change').trigger('select2:select');\n    $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n    $('#unidades_modal').val('');\n    $('#cantidad_ofertas_laborales_modal').val('');\n    $('#cantidad_usuarios_modal').val('');\n    // Verificar si el multiselect está inicializado antes de llamar uncheckAll\n    if ($('#adicionales_modal').data('multiselect')) {\n        $('#adicionales_modal').multiselect(\"uncheckAll\");\n    }\n    if ($('#predefinidos_modal').data('multiselect')) {\n        $('#predefinidos_modal').multiselect(\"uncheckAll\");\n    }\n}\n/**\n * Función para ejecutar acciones luego de guardar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction postSuccess(respuesta) {\n    limpiarFormulario(respuesta.formulario);\n    if (opcion == 'asignar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se asignó con éxito a la empresa`,\n        }));\n    } else if (opcion == 'facturar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se facturó con éxito`,\n        }));\n    } else if (opcion == 'editar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se actualizó con éxito`,\n        }));\n    }\n    window.location.href='/empresas-gestionar/' + empresa.id;\n}\n","structuredPatch":[{"oldStart":6,"oldLines":7,"newStart":6,"newLines":7,"lines":[" plan_creditos_seleccionado = null;"," "," $(document).ready(function() {","-    $(document).on('input', '#precio_plan, #precio_creditos', function() {","+    $(document).on('input', '#precio_plan_visual, #precio_creditos_visual', function() {","         actualizarValorDesdeInput();","     });"," });"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"fe3e066e-cad0-4186-8f46-584466f87072"}
{"parentUuid":"6d0b6153-dfe4-4601-9abe-066aa31efc97","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BR8pCJY4ntHriyWV4ZWKQo","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora todo está configurado. Los cambios realizados son:\n\n**Blade (asignar-plan.blade.php):**\n1. Plan de selección:\n   - Agregado campo hidden `precio_plan_original` con name=\"precio\" (el valor que se envía al servidor)\n   - Cambiado el campo visible a `precio_plan_visual` con name=\"precio_plan_visual\" (solo visual)\n   - Agregados eventos onkeyup/onchange en porcentaje_descuento que llaman a `aplicarDescuento(\"plan\")`\n\n2. Plan de créditos:\n   - Ya tenía el campo hidden `precio_creditos_original` con name=\"precio_creditos\"\n   - El campo visible es `precio_creditos_visual`\n   - Actualizado eventos para llamar a `aplicarDescuento(\"creditos\")`\n\n**JavaScript (asignar-plan.js):**\n1. Actualizado `$(document).ready` para escuchar los campos visuales\n2. Actualizado `mostrarPlanSeleccionado()` para usar los nuevos campos\n3. Ya estaba actualizado `mostrarPlanCreditosSeleccionado()` para los nuevos campos\n4. Actualizado `actualizarValorDesdeInput()` para usar los campos visuales\n5. Agregada función `aplicarDescuento(tipo)` que funciona para ambos tipos\n\nEl flujo es:\n1. Al seleccionar un plan → se guarda el precio original en el hidden y se muestra en el visual\n2. Al escribir un porcentaje de descuento → se calcula el valor con descuento, se muestra en el visual (disabled)\n3. Al enviar el formulario → se envía el valor original (hidden) y el porcentaje de descuento\n\nVoy a informar al usuario sobre los cambios realizados.","signature":"EsIMCkYICxgCKkCfynD1lS8QZCEEtIrgGIn7CDjRGVVsbJ4+EI2vm8GC3GQdISep2J/dXhcTHLy9a5hwniKOJXQ/k446KSJDKIipEgwhSQFaluld6m3k3HYaDIvAuf3NWLchhIqNGSIwcmHAJDtCCEAcgid0ckyW1mGoObI9sbBzT1eaQs0tZGjmphc0w7mR2Fkelarib3OYKqkLqv2EAR6VOFglgxnwBCO8MrmV3IyPqaeWjAc5GuD8cVqOgCQ1oo62jZdQ67kQl1kscmPOUF0HuZ0mLk78XaJBCRMHgpCKWmZEKlXzHfn8KUD6ew1I5QIs4rlHAbJTBWJUovhNmTVWtA+Y7SeH+b9bQ1lyxeOk7OyMrdL3o3gO3p/YHRPVI5Jknc5hl2LMQfAkPnLK9RqWwAuO2LJHVLyMbDmDyX2U62Zj+8p7hdu0PnYwdwETZ3Bdo+HENqd/5Lxw0z0Uivl+h4iPQiMHYYnLkihVP8ZGF3ToraWoFySptvntE51rr7b3ECN7KvoWCS3xAuhLIU+ScktNf9cURk0pq2Ou4GENA3vmgkUOJB82s0mezumSWRMC1BP6VGHCXmD/bjmEvz7H7EWpeMcCEJUw/G/mX4/FjeqEBHyeviZ8IK9QEmthPfmY4oDY+YuoqDpM9QFjHC5k56yzH6L2HUKaRo/lweAGICxVFBZP4hIxVv2P5JBy3WUVVzfkSJrjHLxowhK6jPn8yDBnE6uQdPcug+TLJQKiZeMd5nATSLLNM3HaavYcHGQspQlTZLTgbwhplipZkhJSLv9jhwmYrKCMKLX/kNRQr1REIz/Q4eE2gOhtNB0bWyoihbWuzO5ug6ch0CSd1ocZtgWdm7tIyUUEjAGwCGvUDTkbwbTgBLKf80o8eOx1SwWp1n8KY7ON/OMjoraV9L41iUUzNDTE/WJFiPHYoTg9IacDc6DJ3/kkMr8AE3pZbeeCaK1I0NVEdqgFFgJ0USP/yAVQOdZtb7m0M/uAKFQdUdemqCzjRnnlRoZ1xHYKr0jgiQ/nxAv81MftASgr0usQIhFZKpRH4rAPpKaxxvYDLoIbZJVZVVjRq5S5jG5wNdQFsBP4UjWqNQVPQELzMxDfSXE615x2NXY7SyAaZDNK29nHm0ksBCEYEXrFGR07Hj0VkBKS7GtEueOHUL4J1Dk6okyVs1KWYpQ7BL+ar0shv/XbRd/itNXkx+5X3Llj1Jz4pp5LJIIJ/TuFFNrWvUDpAzYLZvz2BsEBFQmYzeHgiTvlasoplGAW7/6dlyGwJsPHUgO/rEpNtvf7XWszenxXsSe2NJcKDZfJZN4dn7bOW/WNk16ETS3IrTRiaLHhgF/YtkUaso5c7a0DOw8WMcEWornDsamoNNJUxr1sR5+AMZE9UMA6Yes9zmOb9a6MQD6JpcbuI7RirDg4KpvYYdxB3GUry67Gb0sRdgHVazp9e/9Nc+Oza62mITTZZ9O8hwh8OlbOwllM0PGVMNnFrwhkLX18fc4MPZud0wtYd51so9AVdBHjK4HXapo0b98IMdizgORnZxi9+oiAH2L21JZ3LC9EzMht7sciPL2bkQ4S0MI139tkOAJ8PhKZlwtAubN2FMq/zD5mJVcGuu/O9+KZZ0Q4roA3OY8+7CNlltf3z6i3JNhWeTVZACfDG1xS/prpLrKKqyNe2KOc/n2tVk0kBIO/YMjUE62q7D12u1mv+vxI8zcTwivWHRTrzx0JuPy6qlLtx03GkaowEZ3JFVuBq3zMuaySa4o+3Bw30fsRFWVHVi4e2lfmxJqIENB7WZaj/5yja97W5O/wHw3xpRuqPSZoRAkYjwe7nuZ12bZLcdLtAMSlbkkgUXpPTCK1iLHWo4oqa5OVDcVUIVpRYtwFG7PHDJKcfUaNYtPEtMC16PHFy5ToE0Gy0tsEKBN11890ht5batbSh0n7DDphXPofOf+iWhIGVTn+K0bAKqv8/eaytWcQKd5SGYAFgr5YfLIYeH9k/nxVR1LHGcV/RwzKICtb76W4xFcToYI5TfiBJCD+uI2DGVCXQVTDcs2HsUJNbA9QCuxGWFK8IawwUoy5maTJgdSqwj/w7cuiVRhwxgzVSNjeZvvnsOAG9nwLZzP6t2D/bFvpq2oBTBl8k6/kOPYcGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":493,"cache_read_input_tokens":75530,"cache_creation":{"ephemeral_5m_input_tokens":493,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3zZkH6KEr8Pmx8rSdJ","type":"assistant","uuid":"9305166d-4d4c-4f35-9360-38dfa0b3070c","timestamp":"2026-01-26T13:16:21.449Z"}
{"parentUuid":"9305166d-4d4c-4f35-9360-38dfa0b3070c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BR8pCJY4ntHriyWV4ZWKQo","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. He implementado la funcionalidad de descuento para ambos tipos de plan. Aquí está el resumen de los cambios:\n\n## Cambios Realizados\n\n### [asignar-plan.blade.php](resources/views/empresas/paginas/asignar-plan.blade.php)\n\n**Plan de Selección (líneas 98-128):**\n- Campo hidden `precio_plan_original` (name=\"precio\") → valor que se envía al servidor\n- Campo visible `precio_plan_visual` → solo muestra el valor con descuento\n- Eventos `onkeyup/onchange` en `porcentaje_descuento` → llaman a `aplicarDescuento(\"plan\")`\n\n**Plan de Créditos (líneas 130-162):**\n- Campo hidden `precio_creditos_original` (name=\"precio_creditos\") → valor que se envía\n- Campo visible `precio_creditos_visual` → muestra el valor con descuento\n- Eventos `onkeyup/onchange` → llaman a `aplicarDescuento(\"creditos\")`\n\n### [asignar-plan.js](public/js/empresas/asignar-plan.js)\n\n**Nueva función `aplicarDescuento(tipo)` (líneas 681-723):**\n- Recibe `\"plan\"` o `\"creditos\"` como parámetro\n- Calcula el descuento sobre el valor original\n- Deshabilita el campo visual cuando hay descuento\n- Mantiene el valor original en el campo hidden para el envío\n\n## Comportamiento\n\n| Acción | Resultado |\n|--------|-----------|\n| Escribir porcentaje > 0 | Campo \"Valor de venta\" se deshabilita y muestra el valor con descuento |\n| Borrar porcentaje (o poner 0) | Campo \"Valor de venta\" se habilita y vuelve al valor original |\n| Guardar formulario | Se envía el **valor original** + el **porcentaje de descuento** |"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":493,"cache_read_input_tokens":75530,"cache_creation":{"ephemeral_5m_input_tokens":493,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXW3zZkH6KEr8Pmx8rSdJ","type":"assistant","uuid":"cbd97399-6134-4f7f-a643-fbd45666c0bc","timestamp":"2026-01-26T13:16:27.607Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-26T13:18:03.758Z","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287"}
{"type":"file-history-snapshot","messageId":"a466e8e4-bda3-4314-9011-67c32467f288","snapshot":{"messageId":"a466e8e4-bda3-4314-9011-67c32467f288","trackedFileBackups":{"resources\\views\\empresas\\paginas\\asignar-plan.blade.php":{"backupFileName":"23a0b404d58f48f6@v3","version":3,"backupTime":"2026-01-26T13:18:04.334Z"},"public\\js\\empresas\\asignar-plan.js":{"backupFileName":"25fa1d462d51e622@v3","version":3,"backupTime":"2026-01-26T13:18:04.336Z"}},"timestamp":"2026-01-26T13:18:04.326Z"},"isSnapshotUpdate":false}
{"parentUuid":"f7ecbaec-d6b2-4c8c-b47c-5b4ec8192d35","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01Rh3WAr2VnGNuCYtQ5mpkRx","parentToolUseID":"toolu_01Rh3WAr2VnGNuCYtQ5mpkRx","uuid":"d56b94dd-4330-4dd2-a3e6-e18d6dd84f0c","timestamp":"2026-01-26T13:13:02.102Z"}
{"parentUuid":"ffcc99ff-e130-4716-8bb9-3b22a8f5121b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01YE5nw2ptFqfJiRT3kSPgHC","parentToolUseID":"toolu_01YE5nw2ptFqfJiRT3kSPgHC","uuid":"f16bef79-77c3-4340-a9c0-2703e166bafe","timestamp":"2026-01-26T13:13:11.467Z"}
{"parentUuid":"f16bef79-77c3-4340-a9c0-2703e166bafe","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01YE5nw2ptFqfJiRT3kSPgHC","parentToolUseID":"toolu_01YE5nw2ptFqfJiRT3kSPgHC","uuid":"c9503dca-69aa-4287-b2e8-b9f86a34dff3","timestamp":"2026-01-26T13:13:11.467Z"}
{"parentUuid":"4c191de5-9d81-4601-af23-861523bf08f5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01YE5nw2ptFqfJiRT3kSPgHC","toolUseID":"toolu_01YE5nw2ptFqfJiRT3kSPgHC","timestamp":"2026-01-26T13:13:20.181Z","uuid":"ee971297-70c8-4569-851e-2fbbe03bc30c"}
{"parentUuid":"0e3a5f9a-f9ef-4d6a-9479-390208ed83fb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01BYmDRaNHC3s1iJfyJgbFTp","parentToolUseID":"toolu_01BYmDRaNHC3s1iJfyJgbFTp","uuid":"b246beb1-2f79-41a8-95d4-f79be7cc3794","timestamp":"2026-01-26T13:13:26.311Z"}
{"parentUuid":"b246beb1-2f79-41a8-95d4-f79be7cc3794","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01BYmDRaNHC3s1iJfyJgbFTp","parentToolUseID":"toolu_01BYmDRaNHC3s1iJfyJgbFTp","uuid":"39db2525-33b8-4a24-a5cd-e7ddff160769","timestamp":"2026-01-26T13:13:26.313Z"}
{"parentUuid":"e996bada-c283-4791-b0d9-88926899f455","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01BYmDRaNHC3s1iJfyJgbFTp","toolUseID":"toolu_01BYmDRaNHC3s1iJfyJgbFTp","timestamp":"2026-01-26T13:13:53.807Z","uuid":"0b5e3448-500e-45e9-acb6-808ec0e15a7b"}
{"parentUuid":"32ba22f9-0754-420a-a98b-f0d984050ae9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_0112J1s6CUSyh4Np96g3hdBk","parentToolUseID":"toolu_0112J1s6CUSyh4Np96g3hdBk","uuid":"a508e532-b73a-4f57-940a-b661c088b907","timestamp":"2026-01-26T13:14:00.759Z"}
{"parentUuid":"4464f347-f2f5-4c8e-ade1-303143858caf","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01Aig6px1erMLV2jVzTMXnfK","parentToolUseID":"toolu_01Aig6px1erMLV2jVzTMXnfK","uuid":"84fe3490-0409-4526-abde-b0f138ef7ea6","timestamp":"2026-01-26T13:14:09.619Z"}
{"parentUuid":"84fe3490-0409-4526-abde-b0f138ef7ea6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01Aig6px1erMLV2jVzTMXnfK","parentToolUseID":"toolu_01Aig6px1erMLV2jVzTMXnfK","uuid":"09bca923-6591-43af-abb4-3d8fa2a6ae3b","timestamp":"2026-01-26T13:14:09.620Z"}
{"parentUuid":"df11995f-ad39-43b3-94b8-3b46a68853bd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01Aig6px1erMLV2jVzTMXnfK","toolUseID":"toolu_01Aig6px1erMLV2jVzTMXnfK","timestamp":"2026-01-26T13:14:37.086Z","uuid":"c062a244-48c2-44c1-9a24-da4a83848ac7"}
{"parentUuid":"649e5736-e52c-4103-b05f-6589aaeed3d5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01EDegW7BsotDPjhfGHtd2W4","parentToolUseID":"toolu_01EDegW7BsotDPjhfGHtd2W4","uuid":"93d5b345-a590-4332-a854-5af0e9ca2296","timestamp":"2026-01-26T13:14:44.491Z"}
{"parentUuid":"80e549e4-80b4-4a84-bc65-4389441056bf","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01Qo1QvEeXLcDCAAmL9SMupE","parentToolUseID":"toolu_01Qo1QvEeXLcDCAAmL9SMupE","uuid":"3ef54805-a3af-4fd2-8eb7-8d877afb4a67","timestamp":"2026-01-26T13:15:00.321Z"}
{"parentUuid":"3ef54805-a3af-4fd2-8eb7-8d877afb4a67","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01Qo1QvEeXLcDCAAmL9SMupE","parentToolUseID":"toolu_01Qo1QvEeXLcDCAAmL9SMupE","uuid":"19cc09c7-f033-4240-ab52-ffd91f47f780","timestamp":"2026-01-26T13:15:00.322Z"}
{"parentUuid":"dc4be5a8-782f-480d-a2b3-94f097dc84b8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01Qo1QvEeXLcDCAAmL9SMupE","toolUseID":"toolu_01Qo1QvEeXLcDCAAmL9SMupE","timestamp":"2026-01-26T13:15:11.419Z","uuid":"a9378bd6-5fe2-478d-8e87-091f1c75e4e0"}
{"parentUuid":"a256478d-ac42-4c25-a68b-41843e2d4069","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01788M15yS5LVBu9a4eHnVvg","parentToolUseID":"toolu_01788M15yS5LVBu9a4eHnVvg","uuid":"c4c8bd76-60c0-4662-86cd-9e9113060e4f","timestamp":"2026-01-26T13:15:17.305Z"}
{"parentUuid":"fe3e066e-cad0-4186-8f46-584466f87072","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_011n4u18XzygTjK9oCFA9jAF","parentToolUseID":"toolu_011n4u18XzygTjK9oCFA9jAF","uuid":"bf789b71-99b5-40c5-847a-c15bc11c467e","timestamp":"2026-01-26T13:15:24.174Z"}
{"parentUuid":"bf789b71-99b5-40c5-847a-c15bc11c467e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_011n4u18XzygTjK9oCFA9jAF","parentToolUseID":"toolu_011n4u18XzygTjK9oCFA9jAF","uuid":"cf3d6845-9140-48af-b73b-6512f543a786","timestamp":"2026-01-26T13:15:24.175Z"}
{"parentUuid":"6d0b6153-dfe4-4601-9abe-066aa31efc97","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_011n4u18XzygTjK9oCFA9jAF","toolUseID":"toolu_011n4u18XzygTjK9oCFA9jAF","timestamp":"2026-01-26T13:16:10.807Z","uuid":"967eb700-5310-4c0f-a5a1-41a1c0f1a51a"}
{"parentUuid":"cbd97399-6134-4f7f-a643-fbd45666c0bc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"no funcino escribo sopre los inputs dep descuento y no se seloca disabel el input del valor del plan y tambopo camvia el varo de descuento"}]},"uuid":"a466e8e4-bda3-4314-9011-67c32467f288","timestamp":"2026-01-26T13:18:04.324Z","permissionMode":"default"}
{"parentUuid":"a466e8e4-bda3-4314-9011-67c32467f288","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Ri4FKNvkuqGRhbkMC3Hnuw","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario dice que no funciona - al escribir en los inputs de descuento:\n1. No se deshabilita el input del valor del plan\n2. No cambia el valor con el descuento aplicado\n\nVoy a revisar el código para ver qué puede estar fallando. Posibles problemas:\n\n1. Los eventos onkeyup/onchange pueden no estar ejecutándose correctamente\n2. El valor original puede no estar guardándose correctamente en el campo hidden\n3. Puede haber un problema con el formato del valor (separadores de miles)\n\nDéjame revisar el flujo:\n1. Cuando se selecciona un plan, `mostrarPlanSeleccionado()` guarda el precio en `#precio_plan_original` y lo muestra en `#precio_plan_visual`\n2. Cuando se escribe en `#porcentaje_descuento`, se llama a `aplicarDescuento(\"plan\")`\n3. La función `aplicarDescuento()` debería leer el valor original, calcular el descuento y mostrar el resultado\n\nEl problema puede ser que:\n1. El evento no se está ejecutando (verificar con console.log)\n2. El valor original no está en el campo hidden cuando se escribe el descuento\n3. El formato del valor puede tener problemas con los separadores de miles\n\nVoy a agregar algunos console.log para depurar y también verificar que el flujo esté correcto.\n\nTambién noto que en el blade, los eventos están definidos como:\n```\nonkeyup: 'aplicarDescuento(\"plan\");',\nonchange: 'aplicarDescuento(\"plan\");'\n```\n\nPero estos están dentro del template literal de `crearInput()`. Necesito verificar cómo el componente `crearInput()` maneja estos eventos.\n\nVoy a revisar la documentación de componentes o el archivo del componente crearInput para entender cómo se pasan los eventos.","signature":"EvQNCkYICxgCKkAwWLjFZN3ALf5/Oxc9J6JVirmjoNJEBbqvjPArrEA4sT22BS6LvZ803ioD/CsYZKH1JmT31+dachDZzdZ76NmaEgw5TiPq22ctvhpJOF8aDKwY++lc/Ce4jxN53yIwKg+1lPTJ/OM/7XvuF3GU/Mj3l0+J3MePTqObUG3V6vvntuS4N8igY2pRZkyCe7hCKtsMKCe1lXUkBbStiocOSsy8Fr6zv1BPz9XhUsZmqspGhGgVES2+6xSTL9J+Jd0yzqnGxAYUIFND/0Wz2sh51hfwmE8pMy3SKMTqAmn76t/zco2YLvRwMVmKRxx6lL91gDgiBVa9kc60ysKa/JyjVaXotNC+/Z+GnEifngDHBAcJuM55IxiUy0J69rhyvhxH8Q5OfbnoRMzi/JUqIQ20xsDxwgymxOoINze6feyNHGyDn77n0YPMmRKq9YuS5lYFXSgQ57sb0/o0oT2j1Mt6t90jUUVf3e38xyHDE0ZSSsLXtPb+t+6HHFUIG/bGfey6Q2vqE1jvuVNUZLWddmpWILb4QpaSg++fBHLHk440eponLCY+mEFAcfLChnx6dO3s3mf3zBGOZW1EnwFH9TyyyU5pkeOt1q2joH89IkdsIxPKPD741OUQmX4W6KsQLUzavSUZR09JvJwl2263EYLfzC5/mRxGULvV7BADSy0HTtgQQwZQd6eC/XejbVdqcPW6byZPk3NKev1FYBtLbQ2E63cIL8lzo7diENqxcICtoK0w4c0YZsyDv2Rw7c9DVEKA8j3Ztj1y8oKud3Fub9ebjCbCvbWfMuIU+WfspFHF85hOd+0nn5rQuccf0i/ooAJzdWeHrA48ArZs/SYsGrMawk7Gkac9KEehlgpglHd551XU3xjP9AgUFxEUElTFwm2goJs2ACUQnIDQ3/FV1dlP/eVESGQ2S4l+iJd0zu5eBk1pupVszekqohA0BV9QKWgMVxi6xzpA8HVXmHOA0hEpJ+2LX0Z94liBusPvGdLemAOsBUEFrbPLn8sm0J+KNkDXW7nWVWRiYZW1XSfpbhmiM6pIAH9+HGb6TmCALj35kp7V9RN1KfyRsut/si/nFLQBH1dX8XNqlu+RrioDwQLRi6Q0g3qxWHuECQ+DZf9g3mZRcAjvwCe8k0SJCV248C2Y63bQ4Qx7Q6fc/0dHD6ZGM9xp7kxs93Jz9CAKG9Fm6+cVRwIP5EO7zzhdxmKRJN7pX7gDCd43ds3T5X+XbO4YcFRe6AH8GSE+h5ntqZ3d1X1TtttE/N1M+5ygkn0mWSP9H30ATygdTT0Uh1CxsOBu2+Y44iR55nYfb+s50IgUZcq3hKUCGns/6vwwBlgUd/itq05zeZx5RON2rThsjyOx89U2Bc0wg+EtSTQLqIOuseuJnTw1yM2eEYHeBWgHBJK8tX4JDxAoy5Zi7HVUuPpgM8cNZEnj5Jjr2fkzV/WQnwyv8QP3XNjDrxNNelQaVu7NaOb6Xd2yTXDn+VHK6BTVFfTDS/Mi1J7t9sgGR3ZA0lEiBABhrvFWwMtSQd6AXME8Q+lMgKyzhBD1ri4hbu2kSUXvpSZgHZqjcfN8pgV2S+yVPx17W+E+dCRlmj/K6gMn6G3ScQrEX/Co3Uahzxkenqj24RDcujn7Ru7GMLYCmrHciNQnE4CkT2d0t756iRLEOUGn7EHELJX42gTpJxKGdoRzzmTAOIc5qBu/TnrZ8vmiglWX2hnDdi8GINikF1WzZehWeZdxHsYlZwKVP5ZpR07Qnwa35ffEioMkeBmQSvHKjmCCRoU38Ee4BDiCZvc3DoCF4aTx5Hi0ytd6fN+66bJe6un90qxI1PdpTM9QPOngpXgJmTgkgu7T24Pb3DhNPRwnDpoGsOdTAZG7Du36PNXEXhiBGYtbkzadUUn8XAIjbGoDiXhbuIXMl4IkzWOf+S0DT9tGRPYWDG1KyLhdpzAz5ccynke8NfQZ/sTmQ3J/SWaP3PWQd2e+QA6EFEqqOEOkW2Ao38IkeptfeogETWi59aZMxJiScVdhiyJ/Zp2Lq0NE7Vs8snTvoTq7TfB0QiJd/EhVnnfoqKV+bfrEDWUYU4YP1UqOU4Abc7wYxda7EsXYpJl+3rc4AZRThN2yC7DoeTj9mwu1XGQmNWhQhDHRKQZn43+lOzS5yyqYqKjHVlLpYnrlbl6pjcispSSopVx0S0wi78KJwLsL71qF2Q73PuAxyAZ8/ot9d/ljEZn10wBsTYTt85fVN0E9uMs5ExMpjdepZAZRXNCNiJp3H56/gi8DS8dxCNMEsFJxzwSpGmdsvZ37MrLKx+Zd88BwyOexwdRT73G+zc9oI2E01gBJ11ob0pIDkjzXjVWKOBZw0QSwwQi9UNYXVN6ZoxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":11412,"cache_read_input_tokens":69690,"cache_creation":{"ephemeral_5m_input_tokens":11412,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW48p1VnCPeUDMkN8R9M","type":"assistant","uuid":"a75463d1-d6b6-43aa-b19e-194e000e9f79","timestamp":"2026-01-26T13:18:14.400Z"}
{"parentUuid":"a75463d1-d6b6-43aa-b19e-194e000e9f79","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Ri4FKNvkuqGRhbkMC3Hnuw","type":"message","role":"assistant","content":[{"type":"text","text":"Déjame verificar cómo funciona el componente `crearInput()` para los eventos y agregar depuración."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":11412,"cache_read_input_tokens":69690,"cache_creation":{"ephemeral_5m_input_tokens":11412,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW48p1VnCPeUDMkN8R9M","type":"assistant","uuid":"5339352d-433e-4366-980a-79064b5b0510","timestamp":"2026-01-26T13:18:15.192Z"}
{"parentUuid":"5339352d-433e-4366-980a-79064b5b0510","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Ri4FKNvkuqGRhbkMC3Hnuw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SoSU54KCbJXL7pckX4WEdq","name":"Grep","input":{"pattern":"function crearInput","path":"c:\\laragon\\www\\psicoalianza-2\\public\\componentes"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":11412,"cache_read_input_tokens":69690,"cache_creation":{"ephemeral_5m_input_tokens":11412,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW48p1VnCPeUDMkN8R9M","type":"assistant","uuid":"fdd4f115-ba0c-47c5-b5f4-0a706943a6e8","timestamp":"2026-01-26T13:18:15.883Z"}
{"parentUuid":"fdd4f115-ba0c-47c5-b5f4-0a706943a6e8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SoSU54KCbJXL7pckX4WEdq","type":"tool_result","content":"Found 2 files\npublic\\componentes\\componentes\\adicionales.js\npublic\\componentes\\componentes\\inputs.js"}]},"uuid":"b11b8419-e0f4-42c8-8abb-5881566dcd79","timestamp":"2026-01-26T13:18:18.860Z","toolUseResult":{"mode":"files_with_matches","filenames":["public\\componentes\\componentes\\adicionales.js","public\\componentes\\componentes\\inputs.js"],"numFiles":2},"sourceToolAssistantUUID":"fdd4f115-ba0c-47c5-b5f4-0a706943a6e8"}
{"parentUuid":"b11b8419-e0f4-42c8-8abb-5881566dcd79","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_015n43NzoxP595uz2EhgVC7w","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Voy a revisar el archivo inputs.js para ver cómo se manejan los eventos onkeyup y onchange en el componente crearInput.","signature":"EqECCkYICxgCKkDApbUgaqaYclTHL8UFWfWTulpLvE0xdqC4MrBfPykndT+fJZyEuYgyg87eCM50sOP0HkgoPbKzMjEhwIuLKK7CEgw9gblEphjz66GrFxAaDPoLB631Ig5InlJpDSIwFd0Qla3vks0zMi5SGVAlPhSnqyxzDKqIyVGchdZCYFQVLJz1tEQ7vRbB85Vk5ajMKogBrR86lugzwf87fLaxsULNIClMg5Laq9dmDCOLX1PN/cdmmhujgZ79wTetUlAmukTV8C7fcSgYK/gLaEIqzXHhfzjNQFZ1gTjn7/2oAAo1CGg6cD8dcFVVHlEPr3hBVbYLI/rw7ruBLzhBCY9BInKyRjx4XvHDbwmDXUyjxlE0loA1ddkpUv3o8RgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":747,"cache_read_input_tokens":81102,"cache_creation":{"ephemeral_5m_input_tokens":747,"ephemeral_1h_input_tokens":0},"output_tokens":8,"service_tier":"standard"}},"requestId":"req_011CXW49t6qgmMFU9mMsCjUh","type":"assistant","uuid":"65741faa-ddaf-4b9a-94e5-081f702bbdb5","timestamp":"2026-01-26T13:18:21.464Z"}
{"parentUuid":"65741faa-ddaf-4b9a-94e5-081f702bbdb5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_015n43NzoxP595uz2EhgVC7w","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UR8UGFrYsgQ4cN5hLQjS8p","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\componentes\\componentes\\inputs.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":747,"cache_read_input_tokens":81102,"cache_creation":{"ephemeral_5m_input_tokens":747,"ephemeral_1h_input_tokens":0},"output_tokens":8,"service_tier":"standard"}},"requestId":"req_011CXW49t6qgmMFU9mMsCjUh","type":"assistant","uuid":"e301de34-0af8-4151-934c-c6eb382ab594","timestamp":"2026-01-26T13:18:22.029Z"}
{"parentUuid":"e301de34-0af8-4151-934c-c6eb382ab594","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"File content (25164 tokens) exceeds maximum allowed tokens (25000). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content.","is_error":true,"tool_use_id":"toolu_01UR8UGFrYsgQ4cN5hLQjS8p"}]},"uuid":"08237e70-2e0b-4216-b3fd-30a9b90b5630","timestamp":"2026-01-26T13:18:23.644Z","toolUseResult":"Error: File content (25164 tokens) exceeds maximum allowed tokens (25000). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content.","sourceToolAssistantUUID":"e301de34-0af8-4151-934c-c6eb382ab594"}
{"parentUuid":"08237e70-2e0b-4216-b3fd-30a9b90b5630","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_018HKGXyQuHuwYYyBX6pQ9zT","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El archivo es muy grande. Voy a buscar específicamente cómo se manejan los eventos onkeyup y onchange.","signature":"EpACCkYICxgCKkCkv3x67JqL7B/PQ9jpo9S5XVT6O5ur0tT0Pi6kYByN82x5cRvBED6lWHF5GRwlretNdqPKSWhRzOpwjJapQTuAEgyPfP4y0QbTGmEj4gMaDGNVOZZfccTl7ldmtyIwxcVfGSN3LrNCmooLg9gvzxZD5WiexxTDRgS6O8OvgxvfF/+dSvoK9GNxaKVjEzrgKni58wVG7NXW6AR+ktGRUTvNXG6IDuEoD2Sm2ygEuQDof2V3eNJ9yao2JSzOjfrgsOylmK4gM4VRhWmkF/CXpESnrLBbC3tZ4n9G3OxbdnXy6tIwsCluxWIXv0Cp2fudXoGft3P/cK36k+IE3uBdAPhNHMe/BJj4G4IYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":193,"cache_read_input_tokens":81849,"cache_creation":{"ephemeral_5m_input_tokens":193,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW4AEWAupWsNVM8X3yyB","type":"assistant","uuid":"17d99cec-ee5f-4711-88cb-8af819722212","timestamp":"2026-01-26T13:18:26.323Z"}
{"parentUuid":"17d99cec-ee5f-4711-88cb-8af819722212","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_018HKGXyQuHuwYYyBX6pQ9zT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Y5PwgrTQsHjLm2jkU7ZYPP","name":"Grep","input":{"pattern":"onkeyup|onchange","path":"c:\\laragon\\www\\psicoalianza-2\\public\\componentes\\componentes\\inputs.js","output_mode":"content","-n":true}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":193,"cache_read_input_tokens":81849,"cache_creation":{"ephemeral_5m_input_tokens":193,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW4AEWAupWsNVM8X3yyB","type":"assistant","uuid":"b4da985c-34ab-4a75-8442-849bf3425696","timestamp":"2026-01-26T13:18:27.320Z"}
{"parentUuid":"b4da985c-34ab-4a75-8442-849bf3425696","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Y5PwgrTQsHjLm2jkU7ZYPP","type":"tool_result","content":"25:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n29:                ${componente.onkeyup ? `onkeyup=\"${componente.onkeyup}\"` : ''}\n80:                ${componente.onkeyup ? `onkeyup=\"${componente.onkeyup}\"` : ''}\n147:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n211:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n301:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n359:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n393:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n427:                ${componente.onkeyup ? `onkeyup=\"${componente.onkeyup}\"` : ''}\n585:                    ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n614:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n648:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n705:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n986:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n1979:                    onchange=\"manejarCambioInputImagenFlexible(this)${componente.onchange ? '; ' + componente.onchange : ''}\""}]},"uuid":"8c7d65a9-1177-49cd-ab8d-6e8f76d6ff11","timestamp":"2026-01-26T13:18:29.978Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"25:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n29:                ${componente.onkeyup ? `onkeyup=\"${componente.onkeyup}\"` : ''}\n80:                ${componente.onkeyup ? `onkeyup=\"${componente.onkeyup}\"` : ''}\n147:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n211:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n301:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n359:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n393:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n427:                ${componente.onkeyup ? `onkeyup=\"${componente.onkeyup}\"` : ''}\n585:                    ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n614:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n648:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n705:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n986:                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n1979:                    onchange=\"manejarCambioInputImagenFlexible(this)${componente.onchange ? '; ' + componente.onchange : ''}\"","numLines":15},"sourceToolAssistantUUID":"b4da985c-34ab-4a75-8442-849bf3425696"}
{"parentUuid":"8c7d65a9-1177-49cd-ab8d-6e8f76d6ff11","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CqmAgi5Rewwxi8pEWSngxx","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Los eventos onkeyup y onchange sí se incluyen en el componente crearInput. Voy a leer las primeras líneas del archivo para ver exactamente cómo se genera el HTML del input.","signature":"EtgCCkYICxgCKkCen/CkM6qva/B8SjKt5CXLeaTVeibHaw0rK/VDwSiiEEltmSdYtHn/wXW7M13T9W1NMNnNqn8GQ8RpCU4ZnNenEgzI20WpI0ZL5lPHPaMaDP6LTLlY1Who26weDCIw3c/Vc+vtoV7mHlmgEzRSYOgGp2+sEsqMSqRghs4Fba/2+7Vywj6gHMo7SQXHaCbEKr8BWBiB1dDNzFqqfZH7BeapaVTxlLr8uMwGxsivVKSav1LqLCOjrhU7qqkKdkXLM2H7eXKZmKBXy0cpgRy7tAdvlzDq+4saNIrNt58HBw27hs6ECmlbc8mnya4JCxSvqtAYRNYypqgEVWLh8TtJtC90a46SB6Y8KQDM17gUIjLSGJOMDTTmHuZ4Cuvmzo6FFqYB2Qf529NXlCpg+3BTpSarhsPRpTJ/H8ApQHT2GjS5feq0XG3/ZYmLFvLjaXfDyRkYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":606,"cache_read_input_tokens":82042,"cache_creation":{"ephemeral_5m_input_tokens":606,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW4Ahfoc9tbFhvrJRJWt","type":"assistant","uuid":"f8ee28ae-a8c7-46de-999f-d0a15009e5ce","timestamp":"2026-01-26T13:18:33.061Z"}
{"parentUuid":"f8ee28ae-a8c7-46de-999f-d0a15009e5ce","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CqmAgi5Rewwxi8pEWSngxx","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013BhMeqc4X9zcSp5pVq6Z65","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\componentes\\componentes\\inputs.js","offset":1,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":606,"cache_read_input_tokens":82042,"cache_creation":{"ephemeral_5m_input_tokens":606,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW4Ahfoc9tbFhvrJRJWt","type":"assistant","uuid":"bd98af2b-0750-4f6c-8f54-08cbd6a92510","timestamp":"2026-01-26T13:18:33.759Z"}
{"parentUuid":"bd98af2b-0750-4f6c-8f54-08cbd6a92510","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013BhMeqc4X9zcSp5pVq6Z65","type":"tool_result","content":"     1→/**\n     2→ * Crear un componente de input.\n     3→ *\n     4→ * @param {object} componente Datos del componente.\n     5→ * @returns {string} Componente del input.\n     6→ * @author José Manuel Jiménez\n     7→ * @author Andres Morales\n     8→ */\n     9→function crearInput(componente) {\n    10→    var input = `\n    11→        <div class=\"input-container  dropend ${componente.icono || componente.icono2 || componente.icono3 ? 'input-icon' : ''} ${componente.input_container_class ? componente.input_container_class : ''}\">\n    12→            ${componente.icono ? `${componente.icono}` : ''}\n    13→            ${componente.icono2 ? `${componente.icono2}` : ''}\n    14→            <input\n    15→                ${componente.type ? `type=\"${componente.type}\"` : ''}\n    16→                ${componente.id ? `id=\"${componente.id}\"` : ''}\n    17→                ${componente.name ? `name=\"${componente.name}\"` : ''}\n    18→                class=\"rounded-2 text-body-2 input-filtro ${componente.class ? componente.class : ''} ${componente.cleave ? 'cleave' : ''}\"\n    19→                placeholder=\"${componente.placeholder ? `${componente.placeholder}` : ''}\"\n    20→                ${componente.disabled == true ? `disabled` : ''}\n    21→                ${componente.required == true ? `required` : ''}\n    22→                ${componente.value ? `value=\"${componente.value}\"` : ''}\n    23→                ${componente.autocomplete ? `autocomplete=\"${componente.autocomplete}\"` : ''}\n    24→                ${componente.maxlength ? `maxlength=\"${componente.maxlength}\"` : ''}\n    25→                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n    26→                ${componente.min ? `min=\"${componente.min}\"` : ''}\n    27→                ${componente.max ? `max=\"${componente.max}\"` : ''}\n    28→                ${componente.minlength ? `minlength=\"${componente.minlength}\"` : ''}\n    29→                ${componente.onkeyup ? `onkeyup=\"${componente.onkeyup}\"` : ''}\n    30→                ${componente.onblur ? `onblur=\"${componente.onblur}\"` : ''}\n    31→                ${componente.onkeypress ? `onkeypress=\"${componente.onkeypress}\"` : ''}\n    32→                ${componente.adicional ? componente.adicional : ''}\n    33→\n    34→                `;\n    35→                if (componente.data) {\n    36→                    componente.data.forEach(val => {\n    37→                        input += ` data-${val.texto}=\"${val.value}\" `;\n    38→                    });\n    39→                }\n    40→    input += `\n    41→            >\n    42→            ${componente.label ? `<label ${componente.id ? `for=\"${componente.id}\"` : ''} class=\"label-flotante text-body-2\">${componente.label} ${componente.required === undefined ? '' : componente.required ? '*' : '(Opcional)'}</label>` : ''}\n    43→                ${componente.counter ? `<div class=\"resize-grip\"></div><div class=\"contador-caracteres  text-label-2\">0/${componente.counter}</div>` : ''}\n    44→        </div>\n    45→        ${componente.icono3 ? `${componente.icono3}` : ''}\n    46→    `;\n    47→    return input;\n    48→}\n    49→\n    50→/**\n    51→ * Crear un input de número de telefono celular con selector de código de país.\n    52→ *\n    53→ * Este componente debe usarse en conjunto con las funciones del archivo `public/js/globales.js`:\n    54→ *\n    55→ * - `definirInputTipoCelular` que se usa para deifinir el comportamiento inicial del input, debe\n    56→ * llamarse en el ready state del documento html.\n    57→ *\n    58→ * - `rellenarInputCelular` que se usa para establecer el valor de input, recibe el número de\n    59→ * celular y el código del país (indicativo).\n    60→ *\n    61→ * - `validacionAdicionalInputTipoCelular` que se usa para adjuntar el valor del input en el\n    62→ * formulario al que pertenece, esta función debe llamarse dentro de la función\n    63→ * `validacionAdicional` del formulario.\n    64→ *\n    65→ * @param {Object} componente Datos del componente con atributos HTML básicos.\n    66→ * @returns {string}\n    67→ * @author Fahibram Cárcamo\n    68→ * @author Daniel Beltrán\n    69→ */\n    70→function crearInputCelular(componente) {\n    71→    return `\n    72→        <div class=\"input-container input-icon d-flex justify-content-end column-gap-0 ${componente.input_container_class || ''}\">\n    73→            <input\n    74→                type=\"tel\"\n    75→                class=\"rounded-2 text-body-2 input-filtro pe-8 ${componente.class ? componente.class : ''}\"\n    76→                ${componente.id ? `id=\"${componente.id}\"` : ''}\n    77→                ${componente.name ? `name=\"${componente.name}\"` : ''}\n    78→                ${componente.value ? `value=\"${componente.value}\"` : ''}\n    79→                ${componente.disabled === true ? 'disabled' : ''}\n    80→                ${componente.onkeyup ? `onkeyup=\"${componente.onkeyup}\"` : ''}\n    81→                oninput=\"this.value = this.value.replace(/[^0-9]/g, '')\"\n    82→            >\n    83→            <i class=\"bi bi-telephone text-primary text-body-2 position-absolute top-50 bg-white\" style=\"right: 10px; left: auto;\"></i>\n    84→        </div>\n    85→        ${crearInput({\n    86→            id: componente.id ? `indicativo_${componente.id}` : '',\n    87→            name: componente.name ? `indicativo_${componente.name}` : '',\n    88→            type: 'hidden',\n    89→            input_container_class: 'd-none'\n    90→        })}\n    91→        ${crearInput({\n    92→            id: componente.id ? `codigo_iso2_pais_${componente.id}` : '',\n    93→            name: componente.name ? `codigo_iso2_pais_${componente.name}` : '',\n    94→            type: 'hidden',\n    95→            input_container_class: 'd-none'\n    96→        })}\n    97→    `;\n    98→}\n    99→\n   100→/**\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"dc8dd8cc-5a0b-45d7-914b-6fbca7af3c54","timestamp":"2026-01-26T13:18:34.999Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\componentes\\componentes\\inputs.js","content":"/**\n * Crear un componente de input.\n *\n * @param {object} componente Datos del componente.\n * @returns {string} Componente del input.\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction crearInput(componente) {\n    var input = `\n        <div class=\"input-container  dropend ${componente.icono || componente.icono2 || componente.icono3 ? 'input-icon' : ''} ${componente.input_container_class ? componente.input_container_class : ''}\">\n            ${componente.icono ? `${componente.icono}` : ''}\n            ${componente.icono2 ? `${componente.icono2}` : ''}\n            <input\n                ${componente.type ? `type=\"${componente.type}\"` : ''}\n                ${componente.id ? `id=\"${componente.id}\"` : ''}\n                ${componente.name ? `name=\"${componente.name}\"` : ''}\n                class=\"rounded-2 text-body-2 input-filtro ${componente.class ? componente.class : ''} ${componente.cleave ? 'cleave' : ''}\"\n                placeholder=\"${componente.placeholder ? `${componente.placeholder}` : ''}\"\n                ${componente.disabled == true ? `disabled` : ''}\n                ${componente.required == true ? `required` : ''}\n                ${componente.value ? `value=\"${componente.value}\"` : ''}\n                ${componente.autocomplete ? `autocomplete=\"${componente.autocomplete}\"` : ''}\n                ${componente.maxlength ? `maxlength=\"${componente.maxlength}\"` : ''}\n                ${componente.onchange ? `onchange=\"${componente.onchange}\"` : ''}\n                ${componente.min ? `min=\"${componente.min}\"` : ''}\n                ${componente.max ? `max=\"${componente.max}\"` : ''}\n                ${componente.minlength ? `minlength=\"${componente.minlength}\"` : ''}\n                ${componente.onkeyup ? `onkeyup=\"${componente.onkeyup}\"` : ''}\n                ${componente.onblur ? `onblur=\"${componente.onblur}\"` : ''}\n                ${componente.onkeypress ? `onkeypress=\"${componente.onkeypress}\"` : ''}\n                ${componente.adicional ? componente.adicional : ''}\n\n                `;\n                if (componente.data) {\n                    componente.data.forEach(val => {\n                        input += ` data-${val.texto}=\"${val.value}\" `;\n                    });\n                }\n    input += `\n            >\n            ${componente.label ? `<label ${componente.id ? `for=\"${componente.id}\"` : ''} class=\"label-flotante text-body-2\">${componente.label} ${componente.required === undefined ? '' : componente.required ? '*' : '(Opcional)'}</label>` : ''}\n                ${componente.counter ? `<div class=\"resize-grip\"></div><div class=\"contador-caracteres  text-label-2\">0/${componente.counter}</div>` : ''}\n        </div>\n        ${componente.icono3 ? `${componente.icono3}` : ''}\n    `;\n    return input;\n}\n\n/**\n * Crear un input de número de telefono celular con selector de código de país.\n *\n * Este componente debe usarse en conjunto con las funciones del archivo `public/js/globales.js`:\n *\n * - `definirInputTipoCelular` que se usa para deifinir el comportamiento inicial del input, debe\n * llamarse en el ready state del documento html.\n *\n * - `rellenarInputCelular` que se usa para establecer el valor de input, recibe el número de\n * celular y el código del país (indicativo).\n *\n * - `validacionAdicionalInputTipoCelular` que se usa para adjuntar el valor del input en el\n * formulario al que pertenece, esta función debe llamarse dentro de la función\n * `validacionAdicional` del formulario.\n *\n * @param {Object} componente Datos del componente con atributos HTML básicos.\n * @returns {string}\n * @author Fahibram Cárcamo\n * @author Daniel Beltrán\n */\nfunction crearInputCelular(componente) {\n    return `\n        <div class=\"input-container input-icon d-flex justify-content-end column-gap-0 ${componente.input_container_class || ''}\">\n            <input\n                type=\"tel\"\n                class=\"rounded-2 text-body-2 input-filtro pe-8 ${componente.class ? componente.class : ''}\"\n                ${componente.id ? `id=\"${componente.id}\"` : ''}\n                ${componente.name ? `name=\"${componente.name}\"` : ''}\n                ${componente.value ? `value=\"${componente.value}\"` : ''}\n                ${componente.disabled === true ? 'disabled' : ''}\n                ${componente.onkeyup ? `onkeyup=\"${componente.onkeyup}\"` : ''}\n                oninput=\"this.value = this.value.replace(/[^0-9]/g, '')\"\n            >\n            <i class=\"bi bi-telephone text-primary text-body-2 position-absolute top-50 bg-white\" style=\"right: 10px; left: auto;\"></i>\n        </div>\n        ${crearInput({\n            id: componente.id ? `indicativo_${componente.id}` : '',\n            name: componente.name ? `indicativo_${componente.name}` : '',\n            type: 'hidden',\n            input_container_class: 'd-none'\n        })}\n        ${crearInput({\n            id: componente.id ? `codigo_iso2_pais_${componente.id}` : '',\n            name: componente.name ? `codigo_iso2_pais_${componente.name}` : '',\n            type: 'hidden',\n            input_container_class: 'd-none'\n        })}\n    `;\n}\n\n/**","numLines":100,"startLine":1,"totalLines":2054}},"sourceToolAssistantUUID":"bd98af2b-0750-4f6c-8f54-08cbd6a92510"}
{"parentUuid":"dc8dd8cc-5a0b-45d7-914b-6fbca7af3c54","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RVRiq7Fe86uuiQMqYsU46Z","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Veo que el componente `crearInput` sí incluye los atributos `onkeyup` y `onchange` en las líneas 25 y 29. Entonces el problema puede ser:\n\n1. El valor original no está guardado en el campo hidden cuando se ejecuta `aplicarDescuento()`\n2. Hay un problema con el formato de números (separadores de miles)\n3. La función no se está ejecutando (hay que verificar con console.log)\n\nVoy a agregar algunos console.log para depurar y también voy a verificar que el valor original se guarde correctamente.\n\nCreo que el problema es que cuando el usuario escribe en el campo de descuento, el valor original aún no está guardado en el campo hidden porque el usuario todavía no ha seleccionado un plan. El valor original se guarda en `mostrarPlanSeleccionado()` pero solo cuando hay un plan seleccionado.\n\nVoy a modificar la función `aplicarDescuento()` para agregar más logs y también para manejar el caso donde el valor original no existe.\n\nTambién veo un posible problema: cuando se carga la página en modo editar/facturar, el valor se precarga desde PHP pero el campo hidden `precio_plan_original` no se inicializa con ese valor.\n\nVoy a:\n1. Agregar console.log para depurar\n2. Asegurar que el valor original se tome correctamente del campo visual si no está en el hidden","signature":"EpYLCkYICxgCKkAGXNJfmWu82UB1KAbtOwinC3cLYkUthKDuXi5Va0RUpByEZRs6QP2R+9OnImLhtHeNsAKZOp8BnRfl8p3IpY+BEgyEXGk0cMarg8NXE0kaDDcRm1bs8I7Z0hCf7iIwH3Wqgso1ie5iAS7vxb1m6zsQLSA1ih3BwHPQeo1RgjhX3FAutPBbTGh1kILdsO//Kv0JLyPDBA+WkXKFN/nycd0UZ5tNqG8aWnlC4fQqCrv/luRrt4u47onMdbaHceR8HRyohxZ9RAOma7YEXgSLX0PwiVi2V05xG+zUws/8999FvsqZucRNkzGPmksm8R8Qj3aMud1k8MBajOvyuDbGZTv5MRQrd+v1+mDlDI+dMmf5NDvWn8EvCyGvYzW+ufR7wXpNplCoQ7oi8gkhuCW8dzgE25ip1HhyJY1Z4mTa6PfHKVAH4H0B+ijtyGADkE8lv163Y+qAxgzDtd4T0gDgW1IVOV+Fj/qP0kTQ2mUEFXqKmhBPI6arBjX/Syh8xl1zfuRZUlGCdFL8mGsXco8WIgpIKAplltzdOc2VTYyV1hqP/tZqpFR1vuTr7G1XrJmclcMnDbn4hfz/ap/oEytL/32sojUZquD3W6Iu13YYE6heYO8P1FX/A/UYu0RRw+7HAPjX6al5noYDo/BaSN+e06VgSnUGk6djrljf8kZJBMdbo7Y/E9zIqWaC1tHlS1kXhFb0q5gE/LqzCqxRyuYAFYrycdXMUYImprj7MhxY1mFhlfEohWX2viQl5gqZfhh1A6woraHNtKd+cmvmySfZ7ieJ6vNC7fF0mp9r7Bl/Ms9kuSRIbYFDAiME/yi3Ib1u6LZkgLRklrU19sbSzT9+HpCJ7B76k39UfuaDYQ7AWqQga+XgglNdCHqRze8NvLQsKqmMTV9VpYwYPERf9Vr6AizFcY1/tcBiypTJKunPUcHWm5b146v1Yhw5m6wTccRII12k84PKgajO4+irs+JjUxOFNawaYBBdad8u02XzM0u9cUODgNvz3IeygA10e/EAY7nne6tayyS36mejHEbF2hC6hXL4sJdTFsYt+zIeyOyk7jq7m0hEVcAbIGU8gUYwc9z6BwoWEfRUFkBJeYjkntCUuCTpqAkt/gl+eJg5xZywqbYrTGlKZPeQj85zl2B2s8J9RCq/aBhbvfCJv+ZNTa99zLRUW875+RPkrc8qZTyudw0TmsDUwvjhpbJGqL5rXVoCDWQTdCj1xQQXG9+yR/F8Wa5ukH/WSNgXP3AGyJqZiMnmP8L2MPWq0cKdc6p7i1Kk8Rt8ITU/e75eQQX8JL+NNsN1oH69BPTwj1hAZcyhzMhogxk4ij3dLcVHVhbz9td4cCwDQhVxlleR+YuUziDXxopbYAerbdqzO7CCb4q0dW/WpQvXuAmbho/d5BKrBW4CKGFolYyKDzDXKEhfzH5OL8VgxsY9F0Ag9jkGRsKu8jiuEAjKhziQgRnUiqNdsR//6CymXflPVBbij2zA1t+4ficZFhgG62ShZPuimXvijUf9EP4cv5l20+sW4R3ve//UdgnPT12u78N9g9C1eIRYUBvFsJbmmpbpqtOYNYUty+7cK8gVwAxIfgXT/Mt21K5NGSYVNCIQcInnKlnJv/BVutu+AQ57idA7vBeNvXellUy2TzJSxkDUCbj/0/pyDSD60VvFqyy6VXBSsc1nBSVsjXsBx+aw2nEtFR2jyT/udr/oG9fXD2lhp5SPWXevAWZt+qj3O/WtQbejBwBajMWc00N/qFx8RuqRxCtn56mCXplXKoqNhTxE7QbC78nZg0tKyB7RcId84nMnwz8u1FunbDnPnJUj05L78+ilyY7PxGlgr3gR/cC5Mt8eGBs1dHy5O1DpqOeWhlH4KM/mH+hTeuL0UDsnYUt8WpCSDUQYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2144,"cache_read_input_tokens":82648,"cache_creation":{"ephemeral_5m_input_tokens":2144,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW4B54B8nZw1zvs65CHk","type":"assistant","uuid":"c29efc55-6bb4-4561-97fe-ab9b57524298","timestamp":"2026-01-26T13:18:43.323Z"}
{"parentUuid":"c29efc55-6bb4-4561-97fe-ab9b57524298","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RVRiq7Fe86uuiQMqYsU46Z","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a agregar depuración a la función `aplicarDescuento()` para identificar el problema."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2144,"cache_read_input_tokens":82648,"cache_creation":{"ephemeral_5m_input_tokens":2144,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW4B54B8nZw1zvs65CHk","type":"assistant","uuid":"26a2e5ce-58b9-4e59-8589-20b12449cfbf","timestamp":"2026-01-26T13:18:43.799Z"}
{"parentUuid":"26a2e5ce-58b9-4e59-8589-20b12449cfbf","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RVRiq7Fe86uuiQMqYsU46Z","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QJvPHA7qA4N3otnYg2NYZ8","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"function aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}","new_string":"function aplicarDescuento(tipo) {\n    console.log('aplicarDescuento llamada con tipo:', tipo);\n\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    console.log('Campo porcentaje:', campo_porcentaje, 'Valor:', $(campo_porcentaje).val());\n    console.log('Campo original:', campo_original, 'Valor:', $(campo_original).val());\n    console.log('Campo visual:', campo_visual, 'Valor:', $(campo_visual).val());\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    console.log('Porcentaje:', porcentaje);\n    console.log('Valor original inicial:', valor_original);\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        console.log('Valor visual para extraer original:', valor_visual);\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n            console.log('Valor original extraído del visual:', valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        console.log('Descuento calculado:', descuento);\n        console.log('Valor con descuento:', valor_con_descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n        console.log('Campo visual deshabilitado');\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n        console.log('Campo visual habilitado');\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2144,"cache_read_input_tokens":82648,"cache_creation":{"ephemeral_5m_input_tokens":2144,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW4B54B8nZw1zvs65CHk","type":"assistant","uuid":"fd5de069-6040-49d6-93fe-5fa817fc7206","timestamp":"2026-01-26T13:18:56.722Z"}
{"parentUuid":"fd5de069-6040-49d6-93fe-5fa817fc7206","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QJvPHA7qA4N3otnYg2NYZ8","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   677→ *\n   678→ * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n   679→ * @returns {void}\n   680→ */\n   681→function aplicarDescuento(tipo) {\n   682→    console.log('aplicarDescuento llamada con tipo:', tipo);\n   683→\n   684→    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n   685→    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n   686→    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n   687→\n   688→    console.log('Campo porcentaje:', campo_porcentaje, 'Valor:', $(campo_porcentaje).val());\n   689→    console.log('Campo original:', campo_original, 'Valor:', $(campo_original).val());\n   690→    console.log('Campo visual:', campo_visual, 'Valor:', $(campo_visual).val());\n   691→\n   692→    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n   693→    let valor_original_str = $(campo_original).val();\n   694→    let valor_original = 0;\n   695→\n   696→    if (valor_original_str) {\n   697→        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n   698→    }\n   699→\n   700→    console.log('Porcentaje:', porcentaje);\n   701→    console.log('Valor original inicial:', valor_original);\n   702→\n   703→    // Si no hay valor original guardado, tomarlo del campo visual\n   704→    if (valor_original === 0) {\n   705→        let valor_visual = $(campo_visual).val();\n   706→        console.log('Valor visual para extraer original:', valor_visual);\n   707→        if (valor_visual) {\n   708→            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n   709→            $(campo_original).val(valor_original);\n   710→            console.log('Valor original extraído del visual:', valor_original);\n   711→        }\n   712→    }\n   713→\n   714→    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n   715→        // Calcular el valor con descuento\n   716→        let descuento = valor_original * (porcentaje / 100);\n   717→        let valor_con_descuento = Math.round(valor_original - descuento);\n   718→\n   719→        console.log('Descuento calculado:', descuento);\n   720→        console.log('Valor con descuento:', valor_con_descuento);\n   721→\n   722→        // Mostrar el valor con descuento en el campo visual\n   723→        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n   724→\n   725→        // Deshabilitar el campo visual\n   726→        $(campo_visual).prop('disabled', true);\n   727→        console.log('Campo visual deshabilitado');\n   728→    } else {\n   729→        // Si no hay descuento, mostrar el valor original y habilitar el campo\n   730→        if (valor_original > 0) {\n   731→            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n   732→        }\n   733→        $(campo_visual).prop('disabled', false);\n   734→        console.log('Campo visual habilitado');\n   735→    }\n   736→\n   737→    // Actualizar el valor total mostrado\n   738→    actualizarValorDesdeInput();\n   739→}\n   740→\n   741→/**\n   742→ * Abrir la factura del plan en una nueva pestaña del navegador.\n   743→ * "}]},"uuid":"06dab712-386e-4924-8950-2c841ef10bec","timestamp":"2026-01-26T13:19:12.977Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","oldString":"function aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}","newString":"function aplicarDescuento(tipo) {\n    console.log('aplicarDescuento llamada con tipo:', tipo);\n\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    console.log('Campo porcentaje:', campo_porcentaje, 'Valor:', $(campo_porcentaje).val());\n    console.log('Campo original:', campo_original, 'Valor:', $(campo_original).val());\n    console.log('Campo visual:', campo_visual, 'Valor:', $(campo_visual).val());\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    console.log('Porcentaje:', porcentaje);\n    console.log('Valor original inicial:', valor_original);\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        console.log('Valor visual para extraer original:', valor_visual);\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n            console.log('Valor original extraído del visual:', valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        console.log('Descuento calculado:', descuento);\n        console.log('Valor con descuento:', valor_con_descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n        console.log('Campo visual deshabilitado');\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n        console.log('Campo visual habilitado');\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}","originalFile":"table = null;\nplanes = [];\npruebas = [];\nmodificado = false;\nfuncionalidades_predefinidos = [];\nplan_creditos_seleccionado = null;\n\n$(document).ready(function() {\n    $(document).on('input', '#precio_plan_visual, #precio_creditos_visual', function() {\n        actualizarValorDesdeInput();\n    });\n});\n\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales\n */\nfunction seleccionarTipoPrueba(tipo_prueba_id) {\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"card-body text-center\">\n            <button type=\"button\" id=\"elegir-plan\" class=\"btn btn-outline-primary\" disabled onclick=\"modalElegirPlan();\">Elegir plan</button>\n        </div>\n    `);\n    $('#seccion-pruebas').addClass('d-none');\n    $('#plan_id').val('');\n    pruebas = [];\n    // Convertir tipo_prueba_id a array si no lo es\n    let tipos_prueba = Array.isArray(tipo_prueba_id) ? tipo_prueba_id : [tipo_prueba_id];\n    // Crear los botones según los tipos de prueba seleccionados\n    let botones_html = '<div class=\"card-body text-center\">';\n    tipos_prueba.forEach(function(tipo_id) {\n        let texto_boton = 'Elegir plan';\n        let clase_boton = 'btn-outline-primary';\n        if (tipo_id == 1) {\n            texto_boton = 'Elegir Plan de Selección';\n            clase_boton = 'btn-outline-primary';\n        } else if (tipo_id == 2) {\n            texto_boton = 'Elegir Plan de Créditos IA';\n            clase_boton = 'btn-outline-info';\n        }\n        botones_html += `\n            <button type=\"button\" id=\"elegir-plan-${tipo_id}\" class=\"btn ${clase_boton} mx-1 my-1\" disabled onclick=\"modalElegirPlan(${tipo_id});\">\n                ${texto_boton}\n            </button>\n        `;\n    });\n    botones_html += '</div>';\n    $('#contenedor-plan').append(botones_html);\n    $('#tipo_prueba_id').val(tipo_prueba_id).trigger('select2');\n    if (tipo_prueba_id && (Array.isArray(tipo_prueba_id) ? tipo_prueba_id.length > 0 : tipo_prueba_id)) {\n        // Habilitar todos los botones creados\n        tipos_prueba.forEach(function(tipo_id) {\n            $(`#elegir-plan-${tipo_id}`).prop('disabled', false);\n        });\n        $.ajax({\n            type: 'GET',\n            url : `/pruebas-listado`,\n            data: {\n                tipo_prueba_id: tipo_prueba_id,\n                activo: 1\n            }\n        }).then((respuesta) => {\n            limpiarAdicional();\n            $('#contenedor-pruebas').empty();\n            pruebas = respuesta.data;\n            for (let i = 0; i < pruebas.length; i++) {\n                $('#contenedor-pruebas').append(`\n                    <div class=\"col-12 col-md-6\">\n                        <div class=\"d-flex align-items-center\">\n                            <div class=\"check-container my-1 me-1\">\n                                <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                            </div>\n                            <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                        </div>\n                    </div>\n                `);\n            }\n            if (opcion == 'facturar' || opcion == 'editar') {\n                for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                    $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n                }\n                $('#seccion-pruebas').removeClass('d-none');\n                mostrarPlanSeleccionado();\n            }\n            if (opcion == 'editar') {\n                $('#tipo_prueba_id').prop('disabled', true);\n            }\n        }).catch((error) => {\n            console.error(error);\n        });\n    } else {\n        $('#elegir-plan').prop('disabled', true);\n    }\n}\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction seleccionarTipoPruebaMultiple() {\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    tipos_prueba = tipos_prueba.filter(function(tipo_id) {\n        return tipo_id !== null && tipo_id !== '' && tipo_id !== undefined;\n    });\n    if (tipos_prueba.length === 0) {\n        // Si no hay tipos seleccionados, limpiar todo\n        $('#contenedor-plan').empty();\n        $('#contenedor-creditos').empty();\n        $('#seccion-pruebas').addClass('d-none');\n        $('#plan_id').val('');\n        $('#plan_id').prop('required', false);\n        $('#plan_id').prop('disabled', true);\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n        plan_seleccionado = null;\n        plan_creditos_seleccionado = null;\n        pruebas = [];\n        return;\n    }\n    let tiene_seleccion = tipos_prueba.includes('1') || tipos_prueba.includes(1);\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    $('#plan_id').prop('required', tiene_seleccion);\n    $('#plan_id').prop('disabled', !tiene_seleccion);\n    // Manejo del plan de selección\n    if (tiene_seleccion) {\n        // Si hay un plan seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_seleccionado === null && $('#contenedor-plan').children().length === 0) {\n            let seccion_seleccion = `\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Selección</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-1\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(1);\">\n                            Elegir Plan de Selección\n                        </button>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-plan').html(seccion_seleccion);\n        }\n    } else {\n        // Si se deseleccionó el tipo de selección, limpiar el plan\n        $('#contenedor-plan').empty();\n        plan_seleccionado = null;\n        $('#plan_id').val('');\n    }\n    // Manejo del plan de créditos\n    if (tiene_creditos) {\n        // Si hay un plan de créditos seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n            let seccion_creditos = `\n                <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                    <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                    <div class=\"card rounded rounded-3\">\n                        <div class=\"card-body text-center\">\n                            <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                                Elegir Plan de Créditos IA\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-creditos').html(seccion_creditos);\n        }\n    } else {\n        // Si se deseleccionó el tipo de créditos, limpiar el plan de créditos\n        $('#contenedor-creditos').empty();\n        $('#contenedor-plan-creditos').remove();\n        plan_creditos_seleccionado = null;\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/pruebas-listado`,\n        data: {\n            tipo_prueba_id: tipos_prueba,\n            activo: 1\n        }\n    }).then((respuesta) => {\n        limpiarAdicional();\n        $('#contenedor-pruebas').empty();\n        pruebas = respuesta.data;\n        for (let i = 0; i < pruebas.length; i++) {\n            $('#contenedor-pruebas').append(`\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"d-flex align-items-center\">\n                        <div class=\"check-container my-1 me-1\">\n                            <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                        </div>\n                        <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                    </div>\n                </div>\n            `);\n        }\n        if (opcion == 'facturar' || opcion == 'editar') {\n            for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n            }\n            $('#seccion-pruebas').removeClass('d-none');\n            mostrarPlanSeleccionado();\n        }\n        if (opcion == 'editar') {\n            $('#tipo_prueba_id').prop('disabled', true);\n        }\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    });\n}\n/**\n * Obtener el listado de planes según el tipo_prueba_id seleccionado anteriormente.\n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalElegirPlan(tipo_especifico = null) {\n    let tipo_prueba_para_consulta = tipo_especifico !== null ? tipo_especifico : $('#tipo_prueba_id').val();\n    // Si es tipo 2 (Créditos IA), cargar planes de créditos\n    if (tipo_prueba_para_consulta == 2 || tipo_prueba_para_consulta == '2') {\n        $.ajax({\n            type: 'GET',\n            url: '/planes-creditos',\n            data: {\n                activo: true\n            }\n        }).then((respuesta) => {\n            planes_creditos = respuesta.data.planes;\n            mostrarPlanesCreditos();\n        }).catch((error) => {\n            mostrarToast('danger', 'Ocurrió un error');\n        });\n        return;\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/planes-listado`,\n        data: {\n            tipo_prueba_id: $('#tipo_prueba_id').val()\n        }\n    }).then((respuesta) => {\n        planes = respuesta.data;\n        mostrarPlanes();\n    }).catch((error) => {\n        console.error(error);\n    });\n}\n/**\n * Mostrar los planes de créditos en el modal.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction mostrarPlanesCreditos() {\n    let filtro_orden = $('#filtro-plan-credito').val();\n    let buscar = $('#buscador-plan-credito').val() || '';\n    // Ordenar planes según el filtro\n    let planes_ordenados = [...planes_creditos];\n    if (filtro_orden === 'Mayor') {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else if (filtro_orden === 'Menor') {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    if (buscar !== '') {\n        planes_ordenados = planes_ordenados.filter(plan =>\n            plan.nombre.toLowerCase().includes(buscar.toLowerCase())\n        );\n    }\n    $('#contenedor-planes-creditos').empty();\n    if (planes_ordenados.length === 0) {\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"text-center py-5\">\n                <p class=\"text-muted\">No se encontraron planes</p>\n            </div>\n        `);\n    }\n    for (let i = 0; i < planes_ordenados.length; i++) {\n        let plan = planes_ordenados[i];\n        let creditos_disponibles = plan.creditos_disponibles || plan.creditos || 0;\n        let creditos_promedio = plan.creditos_promedio_accion || 0;\n        let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n            ? Math.floor(creditos_disponibles / creditos_promedio)\n            : 0;\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"card rounded rounded-3 border-hover pointer mb-3\" onclick=\"elegirPlanCreditos(${i}, ${filtro_orden === 'Mayor' ? 'true' : 'false'});\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6 text-gray-10\">${plan.nombre}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        `);\n    }\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('show');\n    }\n    $('#buscador-plan-credito').off('input').on('input', function() {\n        mostrarPlanesCreditos();\n    });\n}\n/**\n * Elegir un plan de créditos IA.\n * @param {number} indice Índice del plan en el array.\n * @param {boolean} orden_mayor Si está ordenado de mayor a menor.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction elegirPlanCreditos(indice, orden_mayor = false) {\n    // Aplicar el mismo ordenamiento que en mostrarPlanesCreditos\n    let planes_ordenados = [...planes_creditos];\n    if (orden_mayor) {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    plan_creditos_seleccionado = planes_ordenados[indice];\n    // Establecer los valores en los campos hidden\n    $('#plan_credito_id').val(plan_creditos_seleccionado.id);\n    $('#creditos').val(plan_creditos_seleccionado.creditos);\n    mostrarPlanCreditosSeleccionado();\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('hide');\n    }\n}\n/**\n * Mostrar el plan de créditos seleccionado en el contenedor.\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarPlanCreditosSeleccionado() {\n    if (!plan_creditos_seleccionado || !plan_creditos_seleccionado.creditos) {\n        mostrarToast('danger', 'Ocurrió un error'+plan_creditos_seleccionado);\n        return;\n    }\n    let creditos_disponibles = plan_creditos_seleccionado.creditos_disponibles || plan_creditos_seleccionado.creditos || 0;\n    let creditos_promedio = plan_creditos_seleccionado.creditos_promedio_accion || 0;\n    let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n        ? Math.floor(creditos_disponibles / creditos_promedio)\n        : 0;\n    let seccion_creditos = `\n        <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n            <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n            <div class=\"card rounded rounded-3\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4 pointer\" onclick=\"modalElegirPlan(2);\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6\">${plan_creditos_seleccionado.nombre || 'Plan de Créditos'}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan_creditos_seleccionado.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    // Remover el contenedor anterior si existe\n    $('#contenedor-plan-creditos').remove();\n    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n    if ($('#contenedor-creditos').length) {\n        $('#contenedor-creditos').html(seccion_creditos);\n    } else {\n        $('#contenedor-plan').after(seccion_creditos);\n    }\n    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }\n    actualizarValorVentaTotal();\n}\n\n/**\n * Mostrar en el modal los planes obtenidos en el listado.\n * \n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPlanes() {\n    let buscar = $('#buscador-plan').val();\n    let filtro_plan = $('#filtro-plan').val();\n    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n        table.destroy();\n    }\n    $('#buscador-plan').remove();\n    $('#tbody-planes').empty();\n    for (let i = 0; i < planes.length; i++) {\n        if (\n            (filtro_plan == 'Todos') ||\n            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n        ) {\n            let cantidad_usuarios = '';\n            if (planes[i].cantidad_usuarios != null) {\n                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n            }\n            let cantidad_ofertas_laborales = '';\n            if (planes[i].cantidad_ofertas_laborales != null) {\n                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n            }\n            let cantidad_pruebas = '';\n            if (planes[i].cantidad_pruebas != null) {\n                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;\n            }\n            let unidades = '';\n            if (planes[i].unidades != null) {\n                unidades = `<div class=\"col-auto w-90px\"><i class=\"bi bi-box\"></i> ${planes[i].unidades}</div>`;\n            }\n            let vigencia = '';\n            if (planes[i].vigencia == 90) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n            } else if (planes[i].vigencia == 180) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n            }  else if (planes[i].vigencia == 365) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n            } else if (planes[i].vigencia == null || planes[i].vigencia == 0) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n            } else {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${planes[i].vigencia} días</div>`;\n            }\n            $('#tbody-planes').append(`\n                <tr>\n                    <td style=\"border-bottom: 0px!important;\">\n                        <div class=\"border border-1 rounded rounded-2 pointer border-hover\" onclick=\"elegirPlan(${i});\">\n                            <div class=\"row m-0 w-100 px-3 py-5 text-headline-6\">\n                                <div class=\"col\">${planes[i].nombre !== null ? planes[i].nombre : ''}</div>\n                                ${cantidad_ofertas_laborales}\n                                ${unidades}\n                                ${cantidad_usuarios}\n                                ${cantidad_pruebas}\n                                ${vigencia}\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            `);\n        }\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('show');\n    }\n    table = $('#tabla-planes').DataTable({\n        \"paging\": false,\n        \"searching\": true,\n        \"ordering\": false,\n        \"info\": false\n    });\n    let buscador = $('#tabla-planes_wrapper input');\n    $(buscador).addClass('rounded-2 text-body-2');\n    $(buscador).prop('placeholder', 'Buscar');\n    $(buscador).prop('id', 'buscador-plan');\n    $('#input-busqueda').append(buscador);\n    $(buscador).val(buscar).trigger('input');\n}\n/**\n * Elegir un plan del listado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction elegirPlan(i) {\n    plan_seleccionado = planes[i];\n    mostrarPlanSeleccionado();\n}\n/**\n * Mostrar el plan seleccionado en el contenedor y en las opciones del modificar.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction mostrarPlanSeleccionado() {\n    let cantidad_usuarios = '';\n    let cantidad_usuarios_modal = $('#cantidad_usuarios_modal').val();\n    if (cantidad_usuarios_modal != '') {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${cantidad_usuarios_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_usuarios != null) {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${plan_seleccionado.cantidad_usuarios}</div>`;\n    }\n    let cantidad_ofertas_laborales = '';\n    let cantidad_ofertas_laborales_modal = $('#cantidad_ofertas_laborales_modal').val();\n    if (cantidad_ofertas_laborales_modal != '') {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${cantidad_ofertas_laborales_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_ofertas_laborales != null) {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${plan_seleccionado.cantidad_ofertas_laborales}</div>`;\n    }\n    let cantidad_pruebas = '';\n    let cantidad_pruebas_modal = $('#cantidad_pruebas_modal').val();\n    if (cantidad_pruebas_modal != '') {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${cantidad_pruebas_modal}</div>`;\n        $('.cantidad-pruebas').text(cantidad_pruebas_modal);\n    } else if (plan_seleccionado.cantidad_pruebas != null) {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${plan_seleccionado.cantidad_pruebas}</div>`;\n        $('.cantidad-pruebas').text(plan_seleccionado.cantidad_pruebas);\n    }\n    let unidades = '';\n    let unidades_modal = $('#unidades_modal').val();\n    if (unidades_modal != '') {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${unidades_modal}</div>`;\n    } else if (plan_seleccionado.unidades != null) {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${plan_seleccionado.unidades}</div>`;\n    }\n    let vigencia = '';\n    let vigencia_modal = $('#vigencia_modal').val();\n    if (plan_seleccionado.vigencia == 90 || vigencia_modal == '90') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n    } else if (plan_seleccionado.vigencia == 180 || vigencia_modal == '180') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n    }  else if (plan_seleccionado.vigencia == 365 || vigencia_modal == '365') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n    } else if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n    } else if (vigencia_modal != '') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${vigencia_modal} días</div>`;\n    } else {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${plan_seleccionado.vigencia} días</div>`;\n    }\n    let abrir_modal_elegir_plan = '';\n    let icono_editar = `\n        <div class=\"col-auto w-90px\">\n            <button type=\"button\" class=\"btn btn-text-primary text-white btn-circle\" onclick=\"abrirModalModificar(event);\" title=\"Modificar plan\">\n                <i class=\"bi bi-wrench\"></i>\n            </button>\n        </div>\n    `;\n    if (opcion == 'asignar') {\n        abrir_modal_elegir_plan = `onclick=\"modalElegirPlan();\"`;\n        icono_editar = '';\n    }\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"row border rounded rounded-3 m-0 w-100 px-3 py-5 text-headline-6 pointer\" ${abrir_modal_elegir_plan}>\n            <div class=\"col\">${plan_seleccionado.nombre !== null ? plan_seleccionado.nombre : ''} <span id=\"plan-modificado\"></span></div>\n            ${cantidad_ofertas_laborales}\n            ${unidades}\n            ${cantidad_usuarios}\n            ${cantidad_pruebas}\n            ${vigencia}\n            ${icono_editar}\n        </div>\n    `);\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    // Solo agregar el botón de elegir plan de créditos si no hay uno seleccionado y se requiere\n    if (tiene_creditos && plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n        let seccion_creditos = `\n            <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                            Elegir Plan de Créditos IA\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n        $('#contenedor-creditos').append(seccion_creditos);\n    }\n    $('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n\n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_plan_original').val(plan_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_plan_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento').val('');\n    }\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}\n\n/**\n * Actualizar el valor de venta total sumando plan de selección y créditos.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorVentaTotal() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n    }\n\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    // Usar los campos visuales para mostrar el total\n    let valor_plan_input = $('#precio_plan_visual').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos_visual').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Aplicar el porcentaje de descuento al valor del plan o créditos.\n * El valor original se mantiene en el campo hidden para el envío.\n * El campo visual muestra el valor con descuento y se deshabilita.\n *\n * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n * @returns {void}\n */\nfunction aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}\n\n/**\n * Abrir la factura del plan en una nueva pestaña del navegador.\n * \n * @param {number} factura_id Id de la factura.\n * @returns {void}\n * @author Andres Morales\n */\nasync function abrirFacturaPlan(factura_id) {\n    if (!factura_id) {\n        mostrarToast('danger', 'No se encontró la factura');\n        return;\n    }\n    try {\n        const respuesta = await $.ajax({\n            type: 'GET',\n            url: `/archivos-abrir/${factura_id}`,\n            xhrFields: { responseType: 'blob' }\n        });\n        const blobUrl = window.URL.createObjectURL(respuesta);\n        window.open(blobUrl, '_blank');\n    } catch (error) {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    }\n}\n/**\n * Buscar las funcionalidades por tipo de prueba.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidades(tipo_prueba_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/funcionalidades-listado`,\n        data : {\n            tipo_prueba_id: tipo_prueba_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let beneficios = respuesta.data;\n            const ADICIONALES = beneficios\n                .filter(item => item.predeterminado === 0)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            const PREDEFINIDOS = beneficios\n                .filter(item => item.predeterminado === 1)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            funcionalidades_predefinidos = PREDEFINIDOS;\n            // Verificar si el multiselect está inicializado antes de destruir\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect('destroy');\n            }\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect('destroy');\n            }\n            ADICIONALES.forEach((item) => {\n                $('#adicionales_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            PREDEFINIDOS.forEach((item) => {\n                $('#predefinidos_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            inizializarMultiselect();\n            if (opcion == 'facturar' || opcion == 'editar') {\n                buscarfuncionalidadesPlanEmpresa($('#id').val());\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Buscar las funcionalidades del plan de la empresa.\n * @param {number} empresa_plan_id ID del plan de empresa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidadesPlanEmpresa(empresa_plan_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/empresas-planes-funcionalidades-listado`,\n        data : {\n            empresa_plan_id: empresa_plan_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let funcionalidades = respuesta.data.map(item => item.funcionalidad_id);\n            $('#adicionales_modal').val(funcionalidades);\n            // Verificar si el multiselect está inicializado antes de refrescar\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect(\"refresh\");\n            }\n            $('#predefinidos_modal').val(funcionalidades);\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect(\"refresh\");\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Función para agregar validaciones adicionales y data adicional en el envío del form.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction validacionAdicional() {\n    let valido = true;\n    let es_solo_creditos = plan_seleccionado === null && plan_creditos_seleccionado !== null;\n    $('#vigencia').val($('#vigencia_modal').val());\n    if ($('#unidades_modal').val() == 'Ilimitadas') {\n        $('#unidades').val('');\n    } else {\n        $('#unidades').val($('#unidades_modal').val());\n    }\n    if ($('#cantidad_ofertas_laborales_modal').val() == 'Ilimitadas') {\n        $('#cantidad_ofertas_laborales').val('');\n    } else {\n        $('#cantidad_ofertas_laborales').val($('#cantidad_ofertas_laborales_modal').val());\n    }\n    $('#cantidad_usuarios').val($('#cantidad_usuarios_modal').val());\n    $('#cantidad_pruebas').val($('#cantidad_pruebas_modal').val());\n    if (opcion == 'facturar' || opcion == 'editar') {\n        let adicionales = $('#adicionales_modal').val();\n        let predefinidos = $('#predefinidos_modal').val();\n        let funcionalidades = adicionales.concat(predefinidos);\n        $('#funcionalidades').val(JSON.stringify(funcionalidades));\n        if (!es_solo_creditos && funcionalidades.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una funcionalidad.');\n        }\n    } else {\n        let ids = [];\n        if (plan_seleccionado && Array.isArray(plan_seleccionado.funcionalidades)) {\n            ids = plan_seleccionado.funcionalidades.map(objeto => objeto.id);\n        }\n        $('#funcionalidades').val(JSON.stringify(ids));\n    }\n    var pruebas_seleccionadas = $('.pruebas:checked').map(function() {\n        return this.value;\n    }).get();\n    $('#pruebas').val('');\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado ? plan_seleccionado.cantidad_pruebas : 0;\n    }\n    if (!es_solo_creditos) {\n        if (pruebas_seleccionadas.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una prueba.');\n        } else if (pruebas_seleccionadas.length > maximo_pruebas) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione maximo ' + maximo_pruebas + ' pruebas.');\n        }\n    }\n    if (valido) {\n        $('#pruebas').val(JSON.stringify(pruebas_seleccionadas));\n    }\n    return valido;\n}\n/**\n * Función para validar que no se exceda al seleccionar limite de pruebas.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction ValidarPruebas() {\n    let cantidad_seleccionadas = $('.pruebas:checked').length;\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado.cantidad_pruebas;\n    }\n    if (cantidad_seleccionadas > maximo_pruebas) {\n        $('#alerta-pruebas').removeClass('d-none');\n    } else {\n        $('#alerta-pruebas').addClass('d-none');\n    }\n}\n/**\n * Abrir el modal con los campos para modificar plan.\n * @param {Event} evento Evento desencadenado.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalModificar(evento) {\n    evento.stopPropagation();\n    if (modificado == false) {\n        $('#nombre-plan-modal').text(plan_seleccionado.nombre);\n        $('#cantidad_pruebas_modal').empty();\n        $('#cantidad_pruebas_modal').append(`\n            <option value=\"\">Seleccione</option>\n        `);\n        for (let j = 1; j <= pruebas.length; j++) {\n            $('#cantidad_pruebas_modal').append(`\n                <option value=\"${j}\">${j} Pruebas</option>\n            `);\n        }\n        $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n        if ([90, 180, 365].includes(plan_seleccionado.vigencia)) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val(plan_seleccionado.vigencia).trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else if (plan_seleccionado.vigencia != null && plan_seleccionado.vigencia != 0) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val('personalizado').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else {\n            $('#tiempo_modal').prop('disabled', true);\n            $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val('');\n        }\n        if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n            $('#unidades_modal').val(plan_seleccionado.unidades);\n            $('#unidades_modal').prop('disabled', false);\n            if (opcion == 'asignar') {\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa_plan.cantidad_ofertas_laborales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', false);\n        } else {\n            $('#unidades_modal').val(empresa.procesos_estimados_mensuales);\n            $('#unidades_modal').prop('disabled', true);\n            if (opcion == 'facturar' || opcion == 'editar') {\n                $('#unidades_modal').val(plan_seleccionado.unidades);\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa.pruebas_estimadas_mensuales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', true);\n        }\n        $('#cantidad_usuarios_modal').val(plan_seleccionado.cantidad_usuarios);\n        if (opcion == 'facturar' || opcion == 'editar') {\n            $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n            buscarfuncionalidadesPlanEmpresa($('#id').val());\n        }\n        $('#boton-guardar-modificaciones').prop('disabled', true);\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('show');\n    }\n}\n/**\n * Función que habilita el boton de guardar un plan modificado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction habilitarBotonGuardar() {\n    $('#boton-guardar-modificaciones').prop('disabled', false);\n}\n/**\n * Función que controla los campos de vigencia en el modal de editar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarTiempo(vigencia) {\n    $('.texto-label-tiempo').text('máximas permitidas');\n    $('#input-container-tiempo').removeClass('d-none');\n    $('#input-container-tiempo').addClass('col-md-6');\n    if (vigencia == 'personalizado') {\n        $('#input-container-vigencia').removeClass('d-none');\n        $('#vigencia_modal').val('');\n    } else if ((vigencia == '' || vigencia == null || vigencia == 0) && plan_seleccionado != null && (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0)) {\n        $('.texto-label-tiempo').text('');\n        $('#input-container-tiempo').addClass('d-none');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val('');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    } else if (['90', '180', '365'].includes(vigencia)) {\n        $('#input-container-tiempo').removeClass('col-md-6');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val(vigencia);\n    } else {\n        $('#vigencia_modal').val(vigencia);\n        $('#input-container-vigencia').addClass('d-none');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    }\n}\n/**\n * Abrir el modal de confirmación.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalEstasSeguro() {\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('hide');\n        $('#modal-estas-seguro').modal('show');\n    }\n}\n/**\n * Cancelar la edición de un plan.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction cancelarEdicion() {\n    modificado = false;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    limpiarAdicional();\n    mostrarPlanSeleccionado();\n}\n/**\n * Confirmar los datos editados.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction confirmarEdicion() {\n    modificado = true;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    $('#plan-modificado').text('(modificado)');\n    mostrarPlanSeleccionado();\n}\n/**\n * Limpiar los campos del modal.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction limpiarAdicional() {\n    $('#cantidad_pruebas_modal').val('').trigger('change').trigger('select2:select');\n    $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n    $('#unidades_modal').val('');\n    $('#cantidad_ofertas_laborales_modal').val('');\n    $('#cantidad_usuarios_modal').val('');\n    // Verificar si el multiselect está inicializado antes de llamar uncheckAll\n    if ($('#adicionales_modal').data('multiselect')) {\n        $('#adicionales_modal').multiselect(\"uncheckAll\");\n    }\n    if ($('#predefinidos_modal').data('multiselect')) {\n        $('#predefinidos_modal').multiselect(\"uncheckAll\");\n    }\n}\n/**\n * Función para ejecutar acciones luego de guardar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction postSuccess(respuesta) {\n    limpiarFormulario(respuesta.formulario);\n    if (opcion == 'asignar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se asignó con éxito a la empresa`,\n        }));\n    } else if (opcion == 'facturar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se facturó con éxito`,\n        }));\n    } else if (opcion == 'editar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se actualizó con éxito`,\n        }));\n    }\n    window.location.href='/empresas-gestionar/' + empresa.id;\n}\n","structuredPatch":[{"oldStart":679,"oldLines":10,"newStart":679,"newLines":16,"lines":["  * @returns {void}","  */"," function aplicarDescuento(tipo) {","+    console.log('aplicarDescuento llamada con tipo:', tipo);","+","     let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';","     let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';","     let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';"," ","+    console.log('Campo porcentaje:', campo_porcentaje, 'Valor:', $(campo_porcentaje).val());","+    console.log('Campo original:', campo_original, 'Valor:', $(campo_original).val());","+    console.log('Campo visual:', campo_visual, 'Valor:', $(campo_visual).val());","+","     let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;","     let valor_original_str = $(campo_original).val();","     let valor_original = 0;"]},{"oldStart":691,"oldLines":31,"newStart":697,"newLines":41,"lines":["         valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;","     }"," ","+    console.log('Porcentaje:', porcentaje);","+    console.log('Valor original inicial:', valor_original);","+","     // Si no hay valor original guardado, tomarlo del campo visual","     if (valor_original === 0) {","         let valor_visual = $(campo_visual).val();","+        console.log('Valor visual para extraer original:', valor_visual);","         if (valor_visual) {","             valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;","             $(campo_original).val(valor_original);","+            console.log('Valor original extraído del visual:', valor_original);","         }","     }"," ","-    if (porcentaje > 0 && porcentaje <= 100) {","+    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {","         // Calcular el valor con descuento","         let descuento = valor_original * (porcentaje / 100);","         let valor_con_descuento = Math.round(valor_original - descuento);"," ","+        console.log('Descuento calculado:', descuento);","+        console.log('Valor con descuento:', valor_con_descuento);","+","         // Mostrar el valor con descuento en el campo visual","         $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));"," ","         // Deshabilitar el campo visual","         $(campo_visual).prop('disabled', true);","+        console.log('Campo visual deshabilitado');","     } else {","         // Si no hay descuento, mostrar el valor original y habilitar el campo","         if (valor_original > 0) {","             $(campo_visual).val(valor_original.toLocaleString('es-CO'));","         }","         $(campo_visual).prop('disabled', false);","+        console.log('Campo visual habilitado');","     }"," ","     // Actualizar el valor total mostrado"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"fd5de069-6040-49d6-93fe-5fa817fc7206"}
{"parentUuid":"06dab712-386e-4924-8950-2c841ef10bec","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VjU9ojDBWNaAoRphCcjTig","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El diagnóstico es solo un \"Hint\" del IDE, no un error real. La variable está declarada globalmente en la línea 6.\n\nAhora el usuario necesita probar la funcionalidad. Le voy a indicar que abra la consola del navegador (F12) y pruebe escribir en el campo de descuento para ver los logs y entender qué está pasando.","signature":"EuQDCkYICxgCKkBYvg3wZ12h4y9FXUVTMvCSBJ5dpX6qBjAaCIkfK28+JgS3zcjLBgF+J383m5DWhmzFtXf8mozYGDgMGMlmDObtEgzMVL/t55Kws91JSxMaDL4ZD76zXa9LHs6zOiIwHBV/J1GYIUGdxF+Ys75eyDV/tPO1cbUufPzTlo2IYpvBXdn3rH4GDpaK0g045AnpKssCSFdmXTZQ8qRuTyn8UktqoQvmKsGaEB6QrXaHer8UOPrEtcqullHU5XWP1FdkZbdf9aFvtM5csj/C8U8zSlQ6BVgW99LPJHqG3qdJILgcqI3fkK+NPDnu0RIkRlTEt3Ki67gg5enFsIdWFHQUQeOjgfZvMX+ef1XXugLYy5jRaHqPCJ1uU8I6SPk43FYI8QOs7LTK0M1ooLvHIzbtzGLLi1xJhYc8Rb4FhwoN4e1sQsm4XWRiZzbrMOmaYPc5KbMGOrwSKxqwM7ikgJ7DqQZI9EYFmG5A+GVL4iu0U5eEuGkaQiKY+bEzK+TD1Hizj02CYRH8VyH0axsk16XmOOMQkgI/m5v6sQ5UkfMLHV33koEQ3Il/MsaQ8+OBHxgnikiRJVN+TZY8j9VHmBjNcktGwiUn50TLDBedcExJC1kP7U8xMvfp0c0KXfUFKxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":3126,"cache_read_input_tokens":84792,"cache_creation":{"ephemeral_5m_input_tokens":3126,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW4DxJD8iVyxuq4oxEag","type":"assistant","uuid":"cd1e0181-d448-46c8-899e-bce2da31dfa4","timestamp":"2026-01-26T13:19:18.653Z"}
{"parentUuid":"cd1e0181-d448-46c8-899e-bce2da31dfa4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VjU9ojDBWNaAoRphCcjTig","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora prueba la funcionalidad y abre la **consola del navegador** (F12 → Console) para ver los logs de depuración. \n\nEscribe un número en el campo de descuento y dime qué mensajes aparecen en la consola. Esto me ayudará a identificar exactamente dónde está el problema:\n\n1. ¿Aparece el mensaje \"aplicarDescuento llamada con tipo: plan\"?\n2. ¿Qué valores muestran los campos?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":3126,"cache_read_input_tokens":84792,"cache_creation":{"ephemeral_5m_input_tokens":3126,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW4DxJD8iVyxuq4oxEag","type":"assistant","uuid":"efdca5a1-d982-4b14-ab03-5fc375080061","timestamp":"2026-01-26T13:19:20.890Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-26T13:20:43.229Z","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287"}
{"type":"file-history-snapshot","messageId":"32a24e29-8cee-411b-9a18-fd7998a6229b","snapshot":{"messageId":"32a24e29-8cee-411b-9a18-fd7998a6229b","trackedFileBackups":{"resources\\views\\empresas\\paginas\\asignar-plan.blade.php":{"backupFileName":"23a0b404d58f48f6@v3","version":3,"backupTime":"2026-01-26T13:18:04.334Z"},"public\\js\\empresas\\asignar-plan.js":{"backupFileName":"25fa1d462d51e622@v4","version":4,"backupTime":"2026-01-26T13:20:43.829Z"}},"timestamp":"2026-01-26T13:20:43.826Z"},"isSnapshotUpdate":false}
{"parentUuid":"e301de34-0af8-4151-934c-c6eb382ab594","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01UR8UGFrYsgQ4cN5hLQjS8p","parentToolUseID":"toolu_01UR8UGFrYsgQ4cN5hLQjS8p","uuid":"e86acf5e-07cb-48fb-acb9-f719c9f628db","timestamp":"2026-01-26T13:18:22.209Z"}
{"parentUuid":"bd98af2b-0750-4f6c-8f54-08cbd6a92510","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_013BhMeqc4X9zcSp5pVq6Z65","parentToolUseID":"toolu_013BhMeqc4X9zcSp5pVq6Z65","uuid":"5e485c7f-5ecd-440b-bae4-30159c094b34","timestamp":"2026-01-26T13:18:33.900Z"}
{"parentUuid":"fd5de069-6040-49d6-93fe-5fa817fc7206","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01QJvPHA7qA4N3otnYg2NYZ8","parentToolUseID":"toolu_01QJvPHA7qA4N3otnYg2NYZ8","uuid":"32861457-34b0-4654-af46-3981c05c337e","timestamp":"2026-01-26T13:18:56.877Z"}
{"parentUuid":"32861457-34b0-4654-af46-3981c05c337e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01QJvPHA7qA4N3otnYg2NYZ8","parentToolUseID":"toolu_01QJvPHA7qA4N3otnYg2NYZ8","uuid":"dc7f4df5-d986-4bb2-bd86-d70a44728ada","timestamp":"2026-01-26T13:18:56.877Z"}
{"parentUuid":"06dab712-386e-4924-8950-2c841ef10bec","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01QJvPHA7qA4N3otnYg2NYZ8","toolUseID":"toolu_01QJvPHA7qA4N3otnYg2NYZ8","timestamp":"2026-01-26T13:19:12.978Z","uuid":"90dd4d17-55a6-400b-90ed-68cf762c72d5"}
{"parentUuid":"efdca5a1-d982-4b14-ab03-5fc375080061","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"en consola me sale este rro Uncaught SyntaxError: Unexpected end of input (at 7:847:35)"}]},"uuid":"32a24e29-8cee-411b-9a18-fd7998a6229b","timestamp":"2026-01-26T13:20:43.824Z","permissionMode":"default"}
{"parentUuid":"32a24e29-8cee-411b-9a18-fd7998a6229b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WLfgeLEbXQMbU3118cYuph","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario tiene un error de sintaxis \"Unexpected end of input\". Esto significa que hay un problema con el HTML generado, probablemente las comillas en el atributo onkeyup/onchange están causando problemas porque uso comillas dobles dentro de comillas dobles.\n\nEn el blade tengo:\n```\nonkeyup: 'aplicarDescuento(\"plan\");',\n```\n\nPero esto se renderiza dentro de un template literal que ya usa comillas. Puede haber un problema con el escapado.\n\nDéjame verificar cómo se está renderizando. El problema es que `crearInput` genera:\n```html\nonkeyup=\"aplicarDescuento(\"plan\");\"\n```\n\nLas comillas dobles dentro de las comillas dobles del atributo HTML están rompiendo la sintaxis. Necesito usar comillas simples o escapar las comillas.\n\nDebería cambiar a:\n```\nonkeyup: \"aplicarDescuento('plan');\",\n```\n\nO usar entidades HTML:\n```\nonkeyup: 'aplicarDescuento(&quot;plan&quot;);',\n```\n\nVoy a cambiar a usar comillas simples dentro de la llamada a la función.","signature":"EtkICkYICxgCKkAt3EnjdR0QgfoEfb3+OzSGcoZKldYBNH59bZlkWZ69fgyhgmYEbIY3mR8y5wkUXY5aJ4omKTuKe8nElT3ItCwaEgwrmLMKkgq6RZUFpAYaDOzIkUSESHgjNZ99WSIw4iWKSG/aTBNLCnRavFSuGF5kgdU7+sdh6QKR8J/jDtnT+gd1BAUtwoOZlw2guSbWKsAH6XoIuSVnmdSs1tR0u5+7fLk+DoRU0ATBYvQxUn/MZ7si6n0AqrAkdbMGPxYvuFII98vqyOpTqX1eZ+fBsvd8zDPkvMYx1upLE8tsXy3FHHMPhCI7EghEfL++m7ig6wG76ZlONBOelrTfio2+KstH9vvWqiibgvO/wto4WkigyHfVNFzqz33a2CV1yYOjyRyby3U07laGZynkW58iSVMezFZoz7EC95lQn9KlWjR7gLNfgIGsYRJgz9Nhd8u9WMXi4PwPa3ro2kujRODFdrfHSqIV+FfCwm36bBp53rIx23la8i+p/0zJuG97jaGwmjUU8v/ac5fNWNkDgghKSXXaOOA9RV34h56GmAlI2FwQrtx226khWTcKsdKA8562MS6MBftzpmyOykjqqlzi404yC29w9v89DW2aLdq4CvCHveAUXdOvBdD9ktJCdsWpaRkl4ipFpJQCFZLCrxkEh/CVIiTcOPq4UbJYnBDScoQcIj303weaZE5iK1mwzJTDfIJWLoY5eZYWSNF9Q7Bqbrgi/EHSYMC+y1yYNFLyusIJ4cXPEf0fiXnRxxGE5nwKeHs+WcmEZmc/TOdMGXLHmn7mzMxF79pJLe9tP7rqC438go/BIwpeUoampqDPcld8Yo+LE0libhOguLJqGZLrDzU0/g1+4kYFIpVNDaLHrBI/ErX56Oi8oobpeQoUTbJLM34a7BELaI83J+rtF/5RJjH0ulWwOueONCyapI3OhScRMV5li7U+z2qgbiY8jpUjZbGcLs9VkxK/l892ps8uu2XGikF55byI2wdtykiW0qUZhJU7UtKh3wcP2ovZ7wZxqVaylTRA8rjc86rdL5fVM48bo1d+5KL3cnmf+JDdFMg4nHsvUvsY1RwnU5jSqVE/CMKJCZOeXlCIQ8Lnh17eC1/sbR+sBM5m/OJnjY6ubNOkcbZxyObJq0qehIft7om5uLFrgiPE6K4rqslFL+XZe0TCEmNj9JvzF13FicjvSd4Eeht4A2qbQ2sUGm1TzbjSzrUMAoBrP2QPsWDRBCbKPvaxHNoU909TVt0xCFNDwfBpVZISk3Bbl5T/WE5wR8qWkFSksaNRjd0AbdlQQ8GyrBwPg3zFag7bF7cwxJMcpy+Uj/xpno8jNv8vJWd5XnZD/vk4RWJsgwiBI9Z5OhAtQjRJo8m/l2NzvStepgii0lP5odAgxyTtO4ji+Jm8ATLrVBs1If8iqbrAR08r/0q3AyEFFeDMtRlAus+KM8k3Ch1X/oMplaXYfi7g5VIbS5sHDJXWGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5917,"cache_read_input_tokens":86639,"cache_creation":{"ephemeral_5m_input_tokens":5917,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW4LZwk93kaUXuGifr7s","type":"assistant","uuid":"6d9d5df0-9dfa-4ba6-8355-f4d295d8c9a1","timestamp":"2026-01-26T13:20:51.245Z"}
{"parentUuid":"6d9d5df0-9dfa-4ba6-8355-f4d295d8c9a1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WLfgeLEbXQMbU3118cYuph","type":"message","role":"assistant","content":[{"type":"text","text":"El error es porque las comillas dobles dentro del atributo `onkeyup` están rompiendo el HTML. Necesito usar comillas simples en la llamada a la función."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5917,"cache_read_input_tokens":86639,"cache_creation":{"ephemeral_5m_input_tokens":5917,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW4LZwk93kaUXuGifr7s","type":"assistant","uuid":"87942291-42d1-4c16-99c8-7fa007b650ae","timestamp":"2026-01-26T13:20:52.041Z"}
{"parentUuid":"87942291-42d1-4c16-99c8-7fa007b650ae","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WLfgeLEbXQMbU3118cYuph","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015ASjV5UkDHmriPRdTTBseK","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","old_string":"onkeyup: 'aplicarDescuento(\"plan\");',\n                        onchange: 'aplicarDescuento(\"plan\");'","new_string":"onkeyup: \"aplicarDescuento('plan');\",\n                        onchange: \"aplicarDescuento('plan');\""}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5917,"cache_read_input_tokens":86639,"cache_creation":{"ephemeral_5m_input_tokens":5917,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW4LZwk93kaUXuGifr7s","type":"assistant","uuid":"99a88a7b-3c43-43fb-9c99-f8954892cf5d","timestamp":"2026-01-26T13:20:53.793Z"}
{"parentUuid":"99a88a7b-3c43-43fb-9c99-f8954892cf5d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015ASjV5UkDHmriPRdTTBseK","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   107→                        max: 100,\n   108→                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n   109→                        label: 'Porcentaje de descuento',\n   110→                        label_class: 'optional',\n   111→                        onkeyup: \"aplicarDescuento('plan');\",\n   112→                        onchange: \"aplicarDescuento('plan');\"\n   113→                    })}\n   114→                </div>\n   115→                <div class=\"col-6\">\n   116→                    ${crearInput({"}]},"uuid":"9c87bf0d-c596-4655-a657-5b7870d3d55b","timestamp":"2026-01-26T13:20:57.253Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","oldString":"onkeyup: 'aplicarDescuento(\"plan\");',\n                        onchange: 'aplicarDescuento(\"plan\");'","newString":"onkeyup: \"aplicarDescuento('plan');\",\n                        onchange: \"aplicarDescuento('plan');\"","originalFile":"@extends('layouts.app')\n@php\n    $titulo_pagina = isset($empresa_id) ? 'Asignar plan' : 'Facturar';\n@endphp\n@section('titulo', $titulo_pagina)\n\n@section('estilos')\n    <link href=\"{{ asset('css/empresas/empresas.css') }}\" rel=\"stylesheet\">\n@endsection\n\n@section('contenido')\n    <div class=\"container-fluid mt-4\">\n        <div class=\"text-headline-6 mb-0\">\n            <i class=\"bi bi-chevron-left h4 mb-0 text-primary me-5 pointer\" onclick=\"window.history.back();\"></i>\n            @if ($opcion == 'asignar')\n                Asignar plan\n            @elseif ($opcion == 'facturar')\n                Facturar plan\n            @elseif ($opcion == 'editar')\n                Editar asignación de plan\n            @endif\n        </div>\n    </div>\n    <div class=\"container mt-8\">\n        <form id=\"formulario\" enctype=\"multipart/form-data\">\n            @csrf\n            @isset ($empresa_id)\n                <input type=\"hidden\" id=\"empresa_id\" name=\"empresa_id\" value=\"{{ $empresa_id }}\">\n            @endisset\n            @isset ($empresa_plan)\n                <input type=\"hidden\" id=\"id\" name=\"id\" class=\"input-dinamico\" value=\"{{ $empresa_plan->id }}\">\n            @endisset\n            <input type=\"hidden\" id=\"pruebas\" name=\"pruebas\" value=\"\">\n            <input type=\"hidden\" id=\"vigencia\" name=\"vigencia\">\n            <input type=\"hidden\" id=\"unidades\" name=\"unidades\">\n            <input type=\"hidden\" id=\"cantidad_ofertas_laborales\" name=\"cantidad_ofertas_laborales\">\n            <input type=\"hidden\" id=\"cantidad_usuarios\" name=\"cantidad_usuarios\">\n            <input type=\"hidden\" id=\"cantidad_pruebas\" name=\"cantidad_pruebas\">\n            <input type=\"hidden\" id=\"plan_credito_id\" name=\"plan_credito_id\" value=\"\">\n            <input type=\"hidden\" id=\"creditos\" name=\"creditos\" value=\"\">\n            <input type=\"hidden\" id=\"funcionalidades\" name=\"funcionalidades\" value=\"\">\n            <div class=\"row mt-6\">\n                <div class=\"col-12\">\n                    ${crearMultiselect({\n                        opciones: [\n                            { nombre: 'Planes de selección', id: '1' },\n                            { nombre: 'Planes de créditos (IA)', id: '2' }\n                        ],\n                        id: 'tipo_prueba_id',\n                        name: 'tipo_prueba_id',\n                        class: 'clase-personalizada',\n                        onchange: 'seleccionarTipoPruebaMultiple();',\n                        placeholder: 'Tipo de plan',\n                        icono: '<i class=\"bi bi-check-circle input-icono1\"></i>',\n                        label: 'Tipo de plan',\n                        disabled: {{ $opcion != 'asignar' ? 'true' : 'false' }}\n                    })}\n                </div>\n            </div>\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-plan\">\n                    </div>\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'plan_id',\n                        name: 'plan_id',\n                        adicional: 'style=\"width: 0px; height: 0px;\"',\n                        class: 'p-0 border-0',\n                        required: true,\n                        input_container_class: 'mb-0'\n                    })}\n                </div>\n            </div>\n\n            <div class=\"row mt-7 d-none\" id=\"seccion-pruebas\">\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4 mb-5\">Pruebas</h4>\n                    <span class=\"text-body-2\">Selecciona las <span class=\"cantidad-pruebas\"></span> prueba(s) que vas a asignar a esta empresa.</span>\n                </div>\n                <div class=\"col-12 col-lg-6\">\n                    <div class=\"row\" id=\"contenedor-pruebas\">\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-5 d-none\" id=\"alerta-pruebas\">\n                <div class=\"col-12\">\n                    ${crearAlerta(\n                        'warning',\n                        'Recuerda que solo tienes <span class=\"cantidad-pruebas\">{{ $empresa_plan->cantidad_pruebas ?? ''}}</span> prueba(s) disponibles.',\n                        'w-100 mb-0'\n                    )}\n                </div>\n            </div>\n\n            <input type=\"hidden\" id=\"precio_plan_original\" name=\"precio\" value=\"\">\n            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        min: 0,\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional',\n                        onkeyup: 'aplicarDescuento(\"plan\");',\n                        onchange: 'aplicarDescuento(\"plan\");'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan_visual',\n                        name: 'precio_plan_visual',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>\n            \n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <input type=\"hidden\" id=\"precio_creditos_original\" name=\"precio_creditos\" value=\"\">\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                min: 0,\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional',\n                                onkeyup: 'aplicarDescuento(\"creditos\");',\n                                onchange: 'aplicarDescuento(\"creditos\");'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos_visual',\n                                name: 'precio_creditos_visual',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-7\">\n                <div class=\"col-12 mt-5 mb-4\">\n                    <h4 class=\"text-headline-4\">Valor</h4>\n                    <span class=\"text-body-2\">Revisa el precio final y adjunta la factura.</span>\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'numero_factura',\n                        name: 'numero_factura',\n                        type: 'text',\n                        autocomplete: 'off',\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->numero_factura : '' }}',\n                        required: true,\n                        label: 'Número de factura o concepto'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    @if ($opcion == 'editar' && isset($empresa_plan['archivos'][0]))\n                        <div class=\"card h-auto border-secondary\">\n                            <div class=\"card-body p-2 rounded-4\">\n                                ${crearBoton({\n                                    url: '#',\n                                    clases: 'w-100 d-flex justify-content-between pointer bg-transparent border-0 p-0',\n                                    texto: `\n                                        <div class=\"px-4 text-cta-blue text-decoration-none\">\n                                            {{$empresa_plan['archivos'][0]['nombre']}}\n                                        </div>\n                                        <div class=\"px-4\">\n                                            <i class=\"bi bi-eye-fill text-cta-blue\"></i>\n                                        </div>\n                                    `,\n                                    onclick: `abrirFacturaPlan('{{$empresa_plan['archivos'][0]['id']}}')`\n                                })}\n                            </div>\n                        </div>\n                    @else\n                        ${crearInputFile({\n                            id: 'factura',\n                            name: 'factura',\n                            class: 'input-form',\n                            placeholder: '',\n                            required: false,\n                            accept: 'application/pdf',\n                        })}\n                    @endif\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    ${crearTextarea({\n                        id: 'comentario',\n                        name: 'comentario',\n                        maxlength: 255,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->comentario : '' }}',\n                        label: 'Comentario o detalle de uso',\n                        label_class: 'optional'\n                    })}\n                </div>\n            </div>\n\n            @if ($opcion == 'asignar')\n                <div class=\"row mt-3\">\n                    <div class=\"col-12 mt-5 mb-4\">\n                        <h4 class=\"text-headline-4\"><strong>Valor de venta: <span id=\"valor-venta-mostrar\">0</span></strong></h4>\n                    </div>\n                </div>\n            @endif\n\n            <div class=\"row mt-3 pb-4\">\n                <div class=\"col-12 text-center\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'btn-outline-primary me-2 px-14 text-blue-40',\n                        texto: 'Cancelar',\n                        url: `/empresas-gestionar/{{ isset($empresa_id) ? $empresa_id : '' }}`\n                    })}\n                    ${crearBoton({\n                        id: `boton-asignar`,\n                        type: `submit`,\n                        clases: `btn-primary px-12`,\n                        texto: `@if ($opcion == \"asignar\") Asignar plan @elseif ($opcion == \"facturar\") Guardar @elseif ($opcion == \"editar\") Guardar @endif`\n                    })}\n                </div>\n            </div>\n        </form>\n    </div>\n@section('modals')\n    ${crearModal({\n        id: 'modal-planes',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir plan',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda\">\n                            <i class=\"bi bi-search\"></i>\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan',\n                            name: 'filtro-plan',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanes();',\n                            opciones: [\n                                { nombre: 'Todos', id: 'Todos' },\n                                { nombre: 'Por vacantes', id: 'Ofertas' },\n                                { nombre: 'Por unidades', id: 'Unidades' },\n                                { nombre: 'Por tiempo', id: 'Tiempo' }\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                    <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                        <thead class=\"d-none\">\n                            <tr>\n                                <th></th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tbody-planes\">\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-modificar-planes',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-modificar-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: 'Modificar plan - <span id=\"nombre-plan-modal\">{{ isset($empresa_plan) && $empresa_plan->plan ? \" \" . $empresa_plan->plan->nombre : (isset($empresa_plan) && $empresa_plan->planCredito ? \" \" . $empresa_plan->planCredito->nombre : \"\") }}</span>',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">Personaliza tu plan para esta empresa.</span>\n            </div>\n            <div class=\"row m-0 w-100\">\n                <div class=\"col-12\" id=\"input-container-pruebas\">\n                    ${crearSelect2({\n                        id: 'cantidad_pruebas_modal',\n                        name: 'cantidad_pruebas_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar();',\n                        opciones: [\n                            { nombre: '', id: '' },\n                            @if (isset($empresa_plan))\n                                @for ($i = 1; $i <= 8; $i++)\n                                    { nombre: '{{ $i }} Pruebas', id: '{{ $i }}', selected: {{ $empresa_plan->cantidad_pruebas == $i ? 'true' : 'false' }} },\n                                @endfor\n                            @endif\n                        ],\n                        label: 'Pruebas disponibles'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\" id=\"input-container-tiempo\">\n                    ${crearSelect2({\n                        id: 'tiempo_modal',\n                        name: 'tiempo_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar(); seleccionarTiempo(this.value);',\n                        opciones: [\n                            { nombre: 'Seleccione', id: '' },\n                            { nombre: '3 Meses', id: '90', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 90 ? 'true' : 'false' }} },\n                            { nombre: '6 Meses', id: '180', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 180 ? 'true' : 'false' }} },\n                            { nombre: '1 Año', id: '365', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 365 ? 'true' : 'false' }} },\n                            { nombre: 'Personalizado', id: 'personalizado' }\n                        ],\n                        label: 'Tiempo'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6 d-none\" id=\"input-container-vigencia\">\n                    ${crearInput({\n                        id: 'vigencia_modal',\n                        name: 'vigencia_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Días'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'unidades_modal',\n                        name: 'unidades_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->unidades : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Unidades <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'cantidad_ofertas_laborales_modal',\n                        name: 'cantidad_ofertas_laborales_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_ofertas_laborales : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Vacantes <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4\">Beneficios</h4>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"adicionales_modal\" name=\"adicionales_modal[]\" data-placeholder=\"Adicionales\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"predefinidos_modal\" name=\"predefinidos_modal[]\" data-placeholder=\"Predefinidos\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    ${crearInput({\n                        id: 'cantidad_usuarios_modal',\n                        name: 'cantidad_usuarios_modal',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_usuarios : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Usuarios'\n                    })}\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"alert badge-estado-renovado fw-bold\">\n                        Recuerda que no es posible cambiar entre planes con cantidades fijas a ilimitados o viceversa.\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row m-0 w-100\">\n                        ${crearBoton({\n                            type: 'button',\n                            clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                            texto: 'Cancelar',\n                            onclick: 'cancelarEdicion();',\n                            adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                        })}\n                        ${crearBoton({\n                            id: 'boton-guardar-modificaciones',\n                            type: 'button',\n                            clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                            texto: 'Guardar modificaciones',\n                            onclick: 'abrirModalEstasSeguro();',\n                            disabled: true\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                    <thead class=\"d-none\">\n                        <tr>\n                            <th></th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"tbody-planes\">\n                    </tbody>\n                </table>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-estas-seguro',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-estas-seguroLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: '¿Estás seguro?',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">\n                    se modificará el plan actual para la empresa, ten en cuenta que la información de consumo puede variar entre este plan modificado y los que no lo están pero tienen el mismo nombre.\n                    <br>\n                    <br>\n                    Personaliza tu plan para esta empresa.\n                </span>\n            </div>\n            <div class=\"col-12 px-4 mb-4 mt-3\">\n                <div class=\"row m-0 w-100\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                        texto: 'Cancelar',\n                        onclick: 'cancelarEdicion();',\n                        adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                    })}\n                    ${crearBoton({\n                        id: 'boton-estoy-seguro',\n                        type: 'button',\n                        clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                        texto: 'Si, estoy seguro',\n                        onclick: 'confirmarEdicion();'\n                    })}\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-planes-creditos',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planes-creditosLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir Plan de Créditos IA',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100 mb-3\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda-credito\">\n                            <i class=\"bi bi-search\"></i>\n                            <input type=\"text\" id=\"buscador-plan-credito\" class=\"rounded-2 text-body-2\" placeholder=\"Buscar\">\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan-credito',\n                            name: 'filtro-plan-credito',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanesCreditos();',\n                            opciones: [\n                                { nombre: 'Mayor a menor', id: 'Mayor' },\n                                { nombre: 'Menor a mayor', id: 'Menor' },\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div id=\"contenedor-planes-creditos\">\n                    <!-- Los planes se cargarán dinámicamente aquí -->\n                </div>\n            </div>\n        `\n    })}\n@endsection\n@endsection\n\n@section('scripts')\n    <script src=\"{{ asset('js/empresas/asignar-plan.js') }}\" type=\"text/javascript\"></script>\n    <script type=\"text/javascript\">\n        @if ($opcion == 'asignar')\n            opcion = 'asignar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            plan_seleccionado = null;\n        @elseif ($opcion == 'facturar')\n            opcion = 'facturar';\n            empresa = @json($empresa);\n            resource_url = '/facturar-plan';\n            empresa_plan = @json($empresa_plan);\n            plan_seleccionado = @json($empresa_plan->plan);\n            plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n            plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n            plan_seleccionado.unidades = empresa_plan.unidades\n            plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n            plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n            plan_seleccionado.precio = empresa_plan.precio;\n            pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n            @endif\n\n            // Determinar los tipos de prueba a seleccionar\n            let tipos_a_seleccionar_facturar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                tipos_a_seleccionar_facturar.push('2');\n            @endif\n\n            // Establecer los tipos de prueba en el select\n            $('#tipo_prueba_id').val(tipos_a_seleccionar_facturar).trigger('change');\n\n            seleccionarTipoPruebaMultiple();\n            buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n\n            // Esperar a que el DOM esté listo para establecer valores\n            $(document).ready(function() {\n                @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    // Dar tiempo para que se cargue seleccionarTipoPruebaMultiple() y sus AJAX\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 1000);\n                @endif\n            });\n        @elseif ($opcion == 'editar')\n            opcion = 'editar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            empresa_plan = @json($empresa_plan);\n\n            // Obtener el tipo de edición desde la URL\n            let tipo_edicion = '{{ request()->get(\"tipo\", \"seleccion\") }}';\n\n            @if(request()->get('tipo') == 'creditos' && isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                // Editar plan de créditos\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n                plan_creditos_seleccionado.creditos = empresa_plan.creditos;\n                plan_seleccionado = null;\n                pruebas_empresa_plan = []; \n                $('#seccion-pruebas').hide();\n\n                // Establecer tipo 2 (créditos) en el select\n                $('#tipo_prueba_id').val(['2']).trigger('change');\n\n                $(document).ready(function() {\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 500);\n                });\n            @else\n                // Editar plan de selección\n                plan_seleccionado = @json($empresa_plan->plan);\n                plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n                plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n                plan_seleccionado.unidades = empresa_plan.unidades\n                plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n                plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n                plan_seleccionado.precio = empresa_plan.precio;\n                pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n                // Establecer tipo de selección en el select\n                let tipos_a_seleccionar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n                $('#tipo_prueba_id').val(tipos_a_seleccionar).trigger('change');\n\n                seleccionarTipoPruebaMultiple();\n                buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n            @endif\n        @endif\n    </script>\n@endsection\n","structuredPatch":[{"oldStart":108,"oldLines":8,"newStart":108,"newLines":8,"lines":["                         value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',","                         label: 'Porcentaje de descuento',","                         label_class: 'optional',","-                        onkeyup: 'aplicarDescuento(\"plan\");',","-                        onchange: 'aplicarDescuento(\"plan\");'","+                        onkeyup: \"aplicarDescuento('plan');\",","+                        onchange: \"aplicarDescuento('plan');\"","                     })}","                 </div>","                 <div class=\"col-6\">"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"99a88a7b-3c43-43fb-9c99-f8954892cf5d"}
{"parentUuid":"9c87bf0d-c596-4655-a657-5b7870d3d55b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01S15Ct1NNphnh5x98FtsYP2","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora debo hacer lo mismo para el de créditos.","signature":"EtcBCkYICxgCKkBB8rPFjSuYzXyZ/JM5rA2QHaxUuMwiAReHWvnIFkefoNwSKGh0EUBRPFo4wQ2PCWzalyb+SFsIGlnRHpfoJNCwEgwBvIPIvTny+SzMOMkaDGXnAzVldnJ5/bQN5iIwV+zexz78nS5cjapLkAop8RcWEHzEMg6RsCwedv/gDsp0EpfrNPu8hyZqdxMryAIaKj/llr10eDCAxuvVah43nYftBdZ4ThBIb9SYdNUCwQkTsy8Z9O3Z7tzhxCVh4XYaDuWkg7NPJs42lxfYYgzcOjsYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":779,"cache_read_input_tokens":92556,"cache_creation":{"ephemeral_5m_input_tokens":779,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW4MgTwBbcX5xuWzvkgz","type":"assistant","uuid":"ea7517be-cf33-4d1e-b7f9-d7b06b8d80d3","timestamp":"2026-01-26T13:21:02.248Z"}
{"parentUuid":"ea7517be-cf33-4d1e-b7f9-d7b06b8d80d3","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01S15Ct1NNphnh5x98FtsYP2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YY59xaGRvSqiN5RzH3uV8e","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","old_string":"onkeyup: 'aplicarDescuento(\"creditos\");',\n                                onchange: 'aplicarDescuento(\"creditos\");'","new_string":"onkeyup: \"aplicarDescuento('creditos');\",\n                                onchange: \"aplicarDescuento('creditos');\""}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":779,"cache_read_input_tokens":92556,"cache_creation":{"ephemeral_5m_input_tokens":779,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW4MgTwBbcX5xuWzvkgz","type":"assistant","uuid":"2bc07841-7ea4-4fda-bc87-bacfc21b3b9a","timestamp":"2026-01-26T13:21:03.971Z"}
{"parentUuid":"2bc07841-7ea4-4fda-bc87-bacfc21b3b9a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YY59xaGRvSqiN5RzH3uV8e","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   143→                                max: 100,\n   144→                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n   145→                                label: 'Porcentaje de descuento',\n   146→                                label_class: 'optional',\n   147→                                onkeyup: \"aplicarDescuento('creditos');\",\n   148→                                onchange: \"aplicarDescuento('creditos');\"\n   149→                            })}\n   150→                        </div>\n   151→                        <div class=\"col-6\">\n   152→                            ${crearInput({"}]},"uuid":"f0cdbaff-fb10-4d2b-8e7c-fa9c813c2d81","timestamp":"2026-01-26T13:21:07.510Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php","oldString":"onkeyup: 'aplicarDescuento(\"creditos\");',\n                                onchange: 'aplicarDescuento(\"creditos\");'","newString":"onkeyup: \"aplicarDescuento('creditos');\",\n                                onchange: \"aplicarDescuento('creditos');\"","originalFile":"@extends('layouts.app')\n@php\n    $titulo_pagina = isset($empresa_id) ? 'Asignar plan' : 'Facturar';\n@endphp\n@section('titulo', $titulo_pagina)\n\n@section('estilos')\n    <link href=\"{{ asset('css/empresas/empresas.css') }}\" rel=\"stylesheet\">\n@endsection\n\n@section('contenido')\n    <div class=\"container-fluid mt-4\">\n        <div class=\"text-headline-6 mb-0\">\n            <i class=\"bi bi-chevron-left h4 mb-0 text-primary me-5 pointer\" onclick=\"window.history.back();\"></i>\n            @if ($opcion == 'asignar')\n                Asignar plan\n            @elseif ($opcion == 'facturar')\n                Facturar plan\n            @elseif ($opcion == 'editar')\n                Editar asignación de plan\n            @endif\n        </div>\n    </div>\n    <div class=\"container mt-8\">\n        <form id=\"formulario\" enctype=\"multipart/form-data\">\n            @csrf\n            @isset ($empresa_id)\n                <input type=\"hidden\" id=\"empresa_id\" name=\"empresa_id\" value=\"{{ $empresa_id }}\">\n            @endisset\n            @isset ($empresa_plan)\n                <input type=\"hidden\" id=\"id\" name=\"id\" class=\"input-dinamico\" value=\"{{ $empresa_plan->id }}\">\n            @endisset\n            <input type=\"hidden\" id=\"pruebas\" name=\"pruebas\" value=\"\">\n            <input type=\"hidden\" id=\"vigencia\" name=\"vigencia\">\n            <input type=\"hidden\" id=\"unidades\" name=\"unidades\">\n            <input type=\"hidden\" id=\"cantidad_ofertas_laborales\" name=\"cantidad_ofertas_laborales\">\n            <input type=\"hidden\" id=\"cantidad_usuarios\" name=\"cantidad_usuarios\">\n            <input type=\"hidden\" id=\"cantidad_pruebas\" name=\"cantidad_pruebas\">\n            <input type=\"hidden\" id=\"plan_credito_id\" name=\"plan_credito_id\" value=\"\">\n            <input type=\"hidden\" id=\"creditos\" name=\"creditos\" value=\"\">\n            <input type=\"hidden\" id=\"funcionalidades\" name=\"funcionalidades\" value=\"\">\n            <div class=\"row mt-6\">\n                <div class=\"col-12\">\n                    ${crearMultiselect({\n                        opciones: [\n                            { nombre: 'Planes de selección', id: '1' },\n                            { nombre: 'Planes de créditos (IA)', id: '2' }\n                        ],\n                        id: 'tipo_prueba_id',\n                        name: 'tipo_prueba_id',\n                        class: 'clase-personalizada',\n                        onchange: 'seleccionarTipoPruebaMultiple();',\n                        placeholder: 'Tipo de plan',\n                        icono: '<i class=\"bi bi-check-circle input-icono1\"></i>',\n                        label: 'Tipo de plan',\n                        disabled: {{ $opcion != 'asignar' ? 'true' : 'false' }}\n                    })}\n                </div>\n            </div>\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-plan\">\n                    </div>\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'plan_id',\n                        name: 'plan_id',\n                        adicional: 'style=\"width: 0px; height: 0px;\"',\n                        class: 'p-0 border-0',\n                        required: true,\n                        input_container_class: 'mb-0'\n                    })}\n                </div>\n            </div>\n\n            <div class=\"row mt-7 d-none\" id=\"seccion-pruebas\">\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4 mb-5\">Pruebas</h4>\n                    <span class=\"text-body-2\">Selecciona las <span class=\"cantidad-pruebas\"></span> prueba(s) que vas a asignar a esta empresa.</span>\n                </div>\n                <div class=\"col-12 col-lg-6\">\n                    <div class=\"row\" id=\"contenedor-pruebas\">\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-5 d-none\" id=\"alerta-pruebas\">\n                <div class=\"col-12\">\n                    ${crearAlerta(\n                        'warning',\n                        'Recuerda que solo tienes <span class=\"cantidad-pruebas\">{{ $empresa_plan->cantidad_pruebas ?? ''}}</span> prueba(s) disponibles.',\n                        'w-100 mb-0'\n                    )}\n                </div>\n            </div>\n\n            <input type=\"hidden\" id=\"precio_plan_original\" name=\"precio\" value=\"\">\n            <div id=\"contenedor-precio-plan\" class=\"row mt-5 d-none\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'porcentaje_descuento',\n                        name: 'porcentaje_descuento',\n                        type: 'number',\n                        autocomplete: 'off',\n                        min: 0,\n                        max: 100,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                        label: 'Porcentaje de descuento',\n                        label_class: 'optional',\n                        onkeyup: \"aplicarDescuento('plan');\",\n                        onchange: \"aplicarDescuento('plan');\"\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'precio_plan_visual',\n                        name: 'precio_plan_visual',\n                        class: 'cleave',\n                        autocomplete: 'off',\n                        minlength: 3,\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                        required: true,\n                        label: 'Valor de venta'\n                    })}\n                </div>\n            </div>\n            \n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    <div id=\"contenedor-creditos\">\n                    </div>\n                    <input type=\"hidden\" id=\"precio_creditos_original\" name=\"precio_creditos\" value=\"\">\n                    <div id=\"contenedor-precio-creditos\" class=\"row mt-7 d-none\">\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'porcentaje_descuento_creditos',\n                                name: 'porcentaje_descuento_creditos',\n                                type: 'number',\n                                autocomplete: 'off',\n                                min: 0,\n                                max: 100,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',\n                                label: 'Porcentaje de descuento',\n                                label_class: 'optional',\n                                onkeyup: 'aplicarDescuento(\"creditos\");',\n                                onchange: 'aplicarDescuento(\"creditos\");'\n                            })}\n                        </div>\n                        <div class=\"col-6\">\n                            ${crearInput({\n                                id: 'precio_creditos_visual',\n                                name: 'precio_creditos_visual',\n                                class: 'cleave',\n                                autocomplete: 'off',\n                                minlength: 3,\n                                maxlength: 12,\n                                value: '{{ isset($empresa_plan) ? $empresa_plan->precio : '' }}',\n                                required: true,\n                                label: 'Valor de venta'\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"row mt-7\">\n                <div class=\"col-12 mt-5 mb-4\">\n                    <h4 class=\"text-headline-4\">Valor</h4>\n                    <span class=\"text-body-2\">Revisa el precio final y adjunta la factura.</span>\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-6\">\n                    ${crearInput({\n                        id: 'numero_factura',\n                        name: 'numero_factura',\n                        type: 'text',\n                        autocomplete: 'off',\n                        maxlength: 12,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->numero_factura : '' }}',\n                        required: true,\n                        label: 'Número de factura o concepto'\n                    })}\n                </div>\n                <div class=\"col-6\">\n                    @if ($opcion == 'editar' && isset($empresa_plan['archivos'][0]))\n                        <div class=\"card h-auto border-secondary\">\n                            <div class=\"card-body p-2 rounded-4\">\n                                ${crearBoton({\n                                    url: '#',\n                                    clases: 'w-100 d-flex justify-content-between pointer bg-transparent border-0 p-0',\n                                    texto: `\n                                        <div class=\"px-4 text-cta-blue text-decoration-none\">\n                                            {{$empresa_plan['archivos'][0]['nombre']}}\n                                        </div>\n                                        <div class=\"px-4\">\n                                            <i class=\"bi bi-eye-fill text-cta-blue\"></i>\n                                        </div>\n                                    `,\n                                    onclick: `abrirFacturaPlan('{{$empresa_plan['archivos'][0]['id']}}')`\n                                })}\n                            </div>\n                        </div>\n                    @else\n                        ${crearInputFile({\n                            id: 'factura',\n                            name: 'factura',\n                            class: 'input-form',\n                            placeholder: '',\n                            required: false,\n                            accept: 'application/pdf',\n                        })}\n                    @endif\n                </div>\n            </div>\n\n            <div class=\"row mt-3\">\n                <div class=\"col-12\">\n                    ${crearTextarea({\n                        id: 'comentario',\n                        name: 'comentario',\n                        maxlength: 255,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->comentario : '' }}',\n                        label: 'Comentario o detalle de uso',\n                        label_class: 'optional'\n                    })}\n                </div>\n            </div>\n\n            @if ($opcion == 'asignar')\n                <div class=\"row mt-3\">\n                    <div class=\"col-12 mt-5 mb-4\">\n                        <h4 class=\"text-headline-4\"><strong>Valor de venta: <span id=\"valor-venta-mostrar\">0</span></strong></h4>\n                    </div>\n                </div>\n            @endif\n\n            <div class=\"row mt-3 pb-4\">\n                <div class=\"col-12 text-center\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'btn-outline-primary me-2 px-14 text-blue-40',\n                        texto: 'Cancelar',\n                        url: `/empresas-gestionar/{{ isset($empresa_id) ? $empresa_id : '' }}`\n                    })}\n                    ${crearBoton({\n                        id: `boton-asignar`,\n                        type: `submit`,\n                        clases: `btn-primary px-12`,\n                        texto: `@if ($opcion == \"asignar\") Asignar plan @elseif ($opcion == \"facturar\") Guardar @elseif ($opcion == \"editar\") Guardar @endif`\n                    })}\n                </div>\n            </div>\n        </form>\n    </div>\n@section('modals')\n    ${crearModal({\n        id: 'modal-planes',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir plan',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda\">\n                            <i class=\"bi bi-search\"></i>\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan',\n                            name: 'filtro-plan',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanes();',\n                            opciones: [\n                                { nombre: 'Todos', id: 'Todos' },\n                                { nombre: 'Por vacantes', id: 'Ofertas' },\n                                { nombre: 'Por unidades', id: 'Unidades' },\n                                { nombre: 'Por tiempo', id: 'Tiempo' }\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                    <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                        <thead class=\"d-none\">\n                            <tr>\n                                <th></th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tbody-planes\">\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-modificar-planes',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-modificar-planesLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: 'Modificar plan - <span id=\"nombre-plan-modal\">{{ isset($empresa_plan) && $empresa_plan->plan ? \" \" . $empresa_plan->plan->nombre : (isset($empresa_plan) && $empresa_plan->planCredito ? \" \" . $empresa_plan->planCredito->nombre : \"\") }}</span>',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">Personaliza tu plan para esta empresa.</span>\n            </div>\n            <div class=\"row m-0 w-100\">\n                <div class=\"col-12\" id=\"input-container-pruebas\">\n                    ${crearSelect2({\n                        id: 'cantidad_pruebas_modal',\n                        name: 'cantidad_pruebas_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar();',\n                        opciones: [\n                            { nombre: '', id: '' },\n                            @if (isset($empresa_plan))\n                                @for ($i = 1; $i <= 8; $i++)\n                                    { nombre: '{{ $i }} Pruebas', id: '{{ $i }}', selected: {{ $empresa_plan->cantidad_pruebas == $i ? 'true' : 'false' }} },\n                                @endfor\n                            @endif\n                        ],\n                        label: 'Pruebas disponibles'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\" id=\"input-container-tiempo\">\n                    ${crearSelect2({\n                        id: 'tiempo_modal',\n                        name: 'tiempo_modal',\n                        class: 'select2-filtro',\n                        onchange: 'habilitarBotonGuardar(); seleccionarTiempo(this.value);',\n                        opciones: [\n                            { nombre: 'Seleccione', id: '' },\n                            { nombre: '3 Meses', id: '90', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 90 ? 'true' : 'false' }} },\n                            { nombre: '6 Meses', id: '180', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 180 ? 'true' : 'false' }} },\n                            { nombre: '1 Año', id: '365', selected: {{ isset($empresa_plan) && $empresa_plan->plan && $empresa_plan->plan->vigencia == 365 ? 'true' : 'false' }} },\n                            { nombre: 'Personalizado', id: 'personalizado' }\n                        ],\n                        label: 'Tiempo'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6 d-none\" id=\"input-container-vigencia\">\n                    ${crearInput({\n                        id: 'vigencia_modal',\n                        name: 'vigencia_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Días'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'unidades_modal',\n                        name: 'unidades_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->unidades : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Unidades <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    ${crearInput({\n                        id: 'cantidad_ofertas_laborales_modal',\n                        name: 'cantidad_ofertas_laborales_modal',\n                        class: 'solo-numeros',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_ofertas_laborales : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        disabled: {{ !(isset($empresa_plan) && ($empresa_plan->unidades != null || $empresa_plan->cantidad_ofertas_laborales != null)) ? 'true' : 'false' }},\n                        label: 'Vacantes <span class=\"texto-label-tiempo\"></span>'\n                    })}\n                </div>\n                <div class=\"col-12 mb-2\">\n                    <h4 class=\"text-headline-4\">Beneficios</h4>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"adicionales_modal\" name=\"adicionales_modal[]\" data-placeholder=\"Adicionales\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"input-container\">\n                        <select class=\"multiselect rounded-2 text-body-2\" multiple=\"multiple\" id=\"predefinidos_modal\" name=\"predefinidos_modal[]\" data-placeholder=\"Predefinidos\" onchange=\"habilitarBotonGuardar();\"></select>\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    ${crearInput({\n                        id: 'cantidad_usuarios_modal',\n                        name: 'cantidad_usuarios_modal',\n                        type: 'number',\n                        autocomplete: 'off',\n                        max: 1000000,\n                        value: '{{ isset($empresa_plan) ? $empresa_plan->cantidad_usuarios : '' }}',\n                        onkeyup: 'habilitarBotonGuardar();',\n                        label: 'Usuarios'\n                    })}\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"alert badge-estado-renovado fw-bold\">\n                        Recuerda que no es posible cambiar entre planes con cantidades fijas a ilimitados o viceversa.\n                    </div>\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row m-0 w-100\">\n                        ${crearBoton({\n                            type: 'button',\n                            clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                            texto: 'Cancelar',\n                            onclick: 'cancelarEdicion();',\n                            adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                        })}\n                        ${crearBoton({\n                            id: 'boton-guardar-modificaciones',\n                            type: 'button',\n                            clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                            texto: 'Guardar modificaciones',\n                            onclick: 'abrirModalEstasSeguro();',\n                            disabled: true\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"table-responsive w-100\" id=\"tabla-responsive-planes\">\n                <table class=\"table table-borderless w-100\" id=\"tabla-planes\">\n                    <thead class=\"d-none\">\n                        <tr>\n                            <th></th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"tbody-planes\">\n                    </tbody>\n                </table>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-estas-seguro',\n        adiconales_modals_header: 'data-bs-backdrop=\"static\" tabindex=\"-1\" aria-labelledby=\"modal-estas-seguroLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-md',\n        titulo_header: '¿Estás seguro?',\n        modal_body_class: 'pt-0',\n        modal_body: `\n            <div class=\"col-12 px-4 mb-5\">\n                <span class=\"text-body-2\">\n                    se modificará el plan actual para la empresa, ten en cuenta que la información de consumo puede variar entre este plan modificado y los que no lo están pero tienen el mismo nombre.\n                    <br>\n                    <br>\n                    Personaliza tu plan para esta empresa.\n                </span>\n            </div>\n            <div class=\"col-12 px-4 mb-4 mt-3\">\n                <div class=\"row m-0 w-100\">\n                    ${crearBoton({\n                        type: 'button',\n                        clases: 'col btn-outline-primary me-1 pt-2 text-center d-block',\n                        texto: 'Cancelar',\n                        onclick: 'cancelarEdicion();',\n                        adicional: 'data-bs-dismiss=\"modal\" aria-label=\"Close\"'\n                    })}\n                    ${crearBoton({\n                        id: 'boton-estoy-seguro',\n                        type: 'button',\n                        clases: 'col btn-primary ms-1 pt-2 text-center d-block',\n                        texto: 'Si, estoy seguro',\n                        onclick: 'confirmarEdicion();'\n                    })}\n                </div>\n            </div>\n        `\n    })}\n    ${crearModal({\n        id: 'modal-planes-creditos',\n        adiconales_modals_header: 'tabindex=\"-1\" aria-labelledby=\"modal-planes-creditosLabel\" aria-hidden=\"true\"',\n        dialog_class: 'modal-lg',\n        titulo_header: 'Elegir Plan de Créditos IA',\n        modal_body: `\n            <div class=\"col-12\">\n                <div class=\"row m-0 w-100 mb-3\">\n                    <div class=\"col-12 col-md-6 col-lg-4 px-3\">\n                        <div class=\"input-container input-icon mb-0\" id=\"input-busqueda-credito\">\n                            <i class=\"bi bi-search\"></i>\n                            <input type=\"text\" id=\"buscador-plan-credito\" class=\"rounded-2 text-body-2\" placeholder=\"Buscar\">\n                        </div>\n                    </div>\n                    <div class=\"col-12 col-md-6 col-lg-4 col-xl-3\">\n                        ${crearSelect2({\n                            id: 'filtro-plan-credito',\n                            name: 'filtro-plan-credito',\n                            class: 'select2-filtro',\n                            onchange: 'mostrarPlanesCreditos();',\n                            opciones: [\n                                { nombre: 'Mayor a menor', id: 'Mayor' },\n                                { nombre: 'Menor a mayor', id: 'Menor' },\n                            ],\n                            input_container_class: 'mb-0',\n                            opcion_vacia: false\n                        })}\n                    </div>\n                </div>\n                <div id=\"contenedor-planes-creditos\">\n                    <!-- Los planes se cargarán dinámicamente aquí -->\n                </div>\n            </div>\n        `\n    })}\n@endsection\n@endsection\n\n@section('scripts')\n    <script src=\"{{ asset('js/empresas/asignar-plan.js') }}\" type=\"text/javascript\"></script>\n    <script type=\"text/javascript\">\n        @if ($opcion == 'asignar')\n            opcion = 'asignar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            plan_seleccionado = null;\n        @elseif ($opcion == 'facturar')\n            opcion = 'facturar';\n            empresa = @json($empresa);\n            resource_url = '/facturar-plan';\n            empresa_plan = @json($empresa_plan);\n            plan_seleccionado = @json($empresa_plan->plan);\n            plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n            plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n            plan_seleccionado.unidades = empresa_plan.unidades\n            plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n            plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n            plan_seleccionado.precio = empresa_plan.precio;\n            pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n            @endif\n\n            // Determinar los tipos de prueba a seleccionar\n            let tipos_a_seleccionar_facturar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n            @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                tipos_a_seleccionar_facturar.push('2');\n            @endif\n\n            // Establecer los tipos de prueba en el select\n            $('#tipo_prueba_id').val(tipos_a_seleccionar_facturar).trigger('change');\n\n            seleccionarTipoPruebaMultiple();\n            buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n\n            // Esperar a que el DOM esté listo para establecer valores\n            $(document).ready(function() {\n                @if(isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    // Dar tiempo para que se cargue seleccionarTipoPruebaMultiple() y sus AJAX\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 1000);\n                @endif\n            });\n        @elseif ($opcion == 'editar')\n            opcion = 'editar';\n            empresa = @json($empresa);\n            resource_url = '/empresas-planes';\n            empresa_plan = @json($empresa_plan);\n\n            // Obtener el tipo de edición desde la URL\n            let tipo_edicion = '{{ request()->get(\"tipo\", \"seleccion\") }}';\n\n            @if(request()->get('tipo') == 'creditos' && isset($empresa_plan->plan_credito_id) && $empresa_plan->plan_credito_id)\n                // Editar plan de créditos\n                plan_creditos_seleccionado = @json($empresa_plan->planCredito);\n                plan_creditos_seleccionado.creditos = empresa_plan.creditos;\n                plan_seleccionado = null;\n                pruebas_empresa_plan = []; \n                $('#seccion-pruebas').hide();\n\n                // Establecer tipo 2 (créditos) en el select\n                $('#tipo_prueba_id').val(['2']).trigger('change');\n\n                $(document).ready(function() {\n                    $('#plan_credito_id').val('{{ $empresa_plan->plan_credito_id }}');\n                    $('#creditos').val('{{ $empresa_plan->creditos }}');\n\n                    setTimeout(function() {\n                        if (plan_creditos_seleccionado && plan_creditos_seleccionado.id) {\n                            mostrarPlanCreditosSeleccionado();\n                        }\n                    }, 500);\n                });\n            @else\n                // Editar plan de selección\n                plan_seleccionado = @json($empresa_plan->plan);\n                plan_seleccionado.cantidad_pruebas = empresa_plan.cantidad_pruebas;\n                plan_seleccionado.cantidad_usuarios = empresa_plan.cantidad_usuarios;\n                plan_seleccionado.unidades = empresa_plan.unidades\n                plan_seleccionado.cantidad_ofertas_laborales = empresa_plan.cantidad_ofertas_laborales;\n                plan_seleccionado.vigencia = empresa_plan.vigencia_dias;\n                plan_seleccionado.precio = empresa_plan.precio;\n                pruebas_empresa_plan = @json($empresa_plan->pruebas);\n\n                // Establecer tipo de selección en el select\n                let tipos_a_seleccionar = ['{{$empresa_plan->plan->tipoPrueba->id}}'];\n                $('#tipo_prueba_id').val(tipos_a_seleccionar).trigger('change');\n\n                seleccionarTipoPruebaMultiple();\n                buscarfuncionalidades('{{$empresa_plan->plan->tipoPrueba->id}}');\n            @endif\n        @endif\n    </script>\n@endsection\n","structuredPatch":[{"oldStart":144,"oldLines":8,"newStart":144,"newLines":8,"lines":["                                 value: '{{ isset($empresa_plan) ? $empresa_plan->porcentaje_descuento : '' }}',","                                 label: 'Porcentaje de descuento',","                                 label_class: 'optional',","-                                onkeyup: 'aplicarDescuento(\"creditos\");',","-                                onchange: 'aplicarDescuento(\"creditos\");'","+                                onkeyup: \"aplicarDescuento('creditos');\",","+                                onchange: \"aplicarDescuento('creditos');\"","                             })}","                         </div>","                         <div class=\"col-6\">"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"2bc07841-7ea4-4fda-bc87-bacfc21b3b9a"}
{"parentUuid":"f0cdbaff-fb10-4d2b-8e7c-fa9c813c2d81","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MeMms6YBXaTRSaLHwWGwrj","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto. Ahora el problema de sintaxis debería estar resuelto. El usuario debería poder probar de nuevo.","signature":"EpMCCkYICxgCKkC/4ovgqpIzlwHtQK7cI738LMGNgTGAA5EI73DFDmAlEcEhndq+B/PIwKHLfdE6iPSz46Oy9AgrTVKL9jKyfZOVEgwbdEn4+5Kt6sWJOkIaDJONB1C+EamDyZn3syIw4/5n9oJBfJMX6PCKAoeJruuzRKY1JlVHC9R2Yomv4EWqzuVsWX2woYK6iLrE8StzKnt4fia+sbu7/AYl/oC7bHdsdm5XCJX4zvb6T227KMcrCJOjJaGMdjJtb/syZEbNL/4jSq3gtqDRGPS7E04pF8+oRi1VkYYfjjukUzKv+fZxXh5nzfOwPEqpoGwSe+ichpAYaj3cwAuDLEdZv8QyLB+cY6j/9mlB75Vq3z4YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":471,"cache_read_input_tokens":93335,"cache_creation":{"ephemeral_5m_input_tokens":471,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW4NTeHWuTowbSkaBzxD","type":"assistant","uuid":"c99f5dc9-f250-483d-811a-916735e8df16","timestamp":"2026-01-26T13:21:12.098Z"}
{"parentUuid":"c99f5dc9-f250-483d-811a-916735e8df16","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MeMms6YBXaTRSaLHwWGwrj","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. El problema era que las comillas dobles `\"plan\"` dentro del atributo HTML `onkeyup=\"...\"` rompían la sintaxis. \n\nAhora usa comillas simples: `aplicarDescuento('plan')` y `aplicarDescuento('creditos')`.\n\nPrueba de nuevo y revisa la consola."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":471,"cache_read_input_tokens":93335,"cache_creation":{"ephemeral_5m_input_tokens":471,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXW4NTeHWuTowbSkaBzxD","type":"assistant","uuid":"1a69e022-7282-4e42-9a8e-d77533d0f2dc","timestamp":"2026-01-26T13:21:13.559Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-26T13:23:09.145Z","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287"}
{"type":"file-history-snapshot","messageId":"212a74fc-64fa-4ea6-8533-7103f34133df","snapshot":{"messageId":"212a74fc-64fa-4ea6-8533-7103f34133df","trackedFileBackups":{"resources\\views\\empresas\\paginas\\asignar-plan.blade.php":{"backupFileName":"23a0b404d58f48f6@v4","version":4,"backupTime":"2026-01-26T13:23:09.804Z"},"public\\js\\empresas\\asignar-plan.js":{"backupFileName":"25fa1d462d51e622@v4","version":4,"backupTime":"2026-01-26T13:20:43.829Z"}},"timestamp":"2026-01-26T13:23:09.801Z"},"isSnapshotUpdate":false}
{"parentUuid":"99a88a7b-3c43-43fb-9c99-f8954892cf5d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_015ASjV5UkDHmriPRdTTBseK","parentToolUseID":"toolu_015ASjV5UkDHmriPRdTTBseK","uuid":"45b90df2-1a4a-4194-bf3c-5b42c08e46e0","timestamp":"2026-01-26T13:20:53.930Z"}
{"parentUuid":"45b90df2-1a4a-4194-bf3c-5b42c08e46e0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_015ASjV5UkDHmriPRdTTBseK","parentToolUseID":"toolu_015ASjV5UkDHmriPRdTTBseK","uuid":"d760fb3f-6f70-4dd0-8b9b-c67e331024e9","timestamp":"2026-01-26T13:20:53.931Z"}
{"parentUuid":"9c87bf0d-c596-4655-a657-5b7870d3d55b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_015ASjV5UkDHmriPRdTTBseK","toolUseID":"toolu_015ASjV5UkDHmriPRdTTBseK","timestamp":"2026-01-26T13:20:57.254Z","uuid":"42a78637-8b14-4085-b054-9fc865cb94ac"}
{"parentUuid":"2bc07841-7ea4-4fda-bc87-bacfc21b3b9a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01YY59xaGRvSqiN5RzH3uV8e","parentToolUseID":"toolu_01YY59xaGRvSqiN5RzH3uV8e","uuid":"8e2231ab-2c4e-43d1-ad2f-22d4c8a91a80","timestamp":"2026-01-26T13:21:04.244Z"}
{"parentUuid":"8e2231ab-2c4e-43d1-ad2f-22d4c8a91a80","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01YY59xaGRvSqiN5RzH3uV8e","parentToolUseID":"toolu_01YY59xaGRvSqiN5RzH3uV8e","uuid":"4ceeb495-7941-4d1f-80ab-cf03bae7177c","timestamp":"2026-01-26T13:21:04.245Z"}
{"parentUuid":"f0cdbaff-fb10-4d2b-8e7c-fa9c813c2d81","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01YY59xaGRvSqiN5RzH3uV8e","toolUseID":"toolu_01YY59xaGRvSqiN5RzH3uV8e","timestamp":"2026-01-26T13:21:07.511Z","uuid":"de94ab32-4fdb-4bd9-a62d-db7e3e52dfa2"}
{"parentUuid":"1a69e022-7282-4e42-9a8e-d77533d0f2dc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\resources\\views\\empresas\\paginas\\asignar-plan.blade.php in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"ya funciono eliminame esoso console.lo"}]},"uuid":"212a74fc-64fa-4ea6-8533-7103f34133df","timestamp":"2026-01-26T13:23:09.798Z","permissionMode":"default"}
{"parentUuid":"212a74fc-64fa-4ea6-8533-7103f34133df","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KTiyHWoXWNQZXmWQYnQXvX","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario confirma que ya funciona y quiere que elimine los console.log de depuración.","signature":"EoACCkYICxgCKkAt6bIHaHeKENrcWwq+iY33B8NrnOWIbn21TpvHD6urCrIlKlgmnLHfsBBmI8Jq32K4j6Xkz78B4jI6s1x27hphEgyTZVH3IKVT/tB7xTYaDJqh+JOj6EmFqg+UFiIw705+Ml+IXmzfdZLt7d2zhryiyE8o/rbtD/+5PLBQTLL+7tr3pCeYa9pmkDOkHMOqKmi/5/DvbAtcuhT4YKrWt4iIhdNaHgY8RduOURd4/ShZl1+e8FHrGhZVcDDVplZM9xBTt2Fi0Q5c2t7wrUAhAg1lwnmuwT44enX2+UbYW2wiAexj0js/q8fy0iQGV0ijBbX5Hi8TjFCwzBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4622,"cache_read_input_tokens":93806,"cache_creation":{"ephemeral_5m_input_tokens":4622,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW4XL1tua3F8zPRkR9Gj","type":"assistant","uuid":"4e49c2c5-9c44-4a85-b41a-dd70cfbdd4ed","timestamp":"2026-01-26T13:23:12.778Z"}
{"parentUuid":"4e49c2c5-9c44-4a85-b41a-dd70cfbdd4ed","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KTiyHWoXWNQZXmWQYnQXvX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019FAXYhtFFcRrwk8wx4Kp7x","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"function aplicarDescuento(tipo) {\n    console.log('aplicarDescuento llamada con tipo:', tipo);\n\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    console.log('Campo porcentaje:', campo_porcentaje, 'Valor:', $(campo_porcentaje).val());\n    console.log('Campo original:', campo_original, 'Valor:', $(campo_original).val());\n    console.log('Campo visual:', campo_visual, 'Valor:', $(campo_visual).val());\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    console.log('Porcentaje:', porcentaje);\n    console.log('Valor original inicial:', valor_original);\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        console.log('Valor visual para extraer original:', valor_visual);\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n            console.log('Valor original extraído del visual:', valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        console.log('Descuento calculado:', descuento);\n        console.log('Valor con descuento:', valor_con_descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n        console.log('Campo visual deshabilitado');\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n        console.log('Campo visual habilitado');\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}","new_string":"function aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4622,"cache_read_input_tokens":93806,"cache_creation":{"ephemeral_5m_input_tokens":4622,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW4XL1tua3F8zPRkR9Gj","type":"assistant","uuid":"1dfd58e8-9fb5-40d0-bed8-29730f87f6b8","timestamp":"2026-01-26T13:23:22.764Z"}
{"parentUuid":"1dfd58e8-9fb5-40d0-bed8-29730f87f6b8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019FAXYhtFFcRrwk8wx4Kp7x","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   677→ *\n   678→ * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n   679→ * @returns {void}\n   680→ */\n   681→function aplicarDescuento(tipo) {\n   682→    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n   683→    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n   684→    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n   685→\n   686→    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n   687→    let valor_original_str = $(campo_original).val();\n   688→    let valor_original = 0;\n   689→\n   690→    if (valor_original_str) {\n   691→        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n   692→    }\n   693→\n   694→    // Si no hay valor original guardado, tomarlo del campo visual\n   695→    if (valor_original === 0) {\n   696→        let valor_visual = $(campo_visual).val();\n   697→        if (valor_visual) {\n   698→            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n   699→            $(campo_original).val(valor_original);\n   700→        }\n   701→    }\n   702→\n   703→    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n   704→        // Calcular el valor con descuento\n   705→        let descuento = valor_original * (porcentaje / 100);\n   706→        let valor_con_descuento = Math.round(valor_original - descuento);\n   707→\n   708→        // Mostrar el valor con descuento en el campo visual\n   709→        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n   710→\n   711→        // Deshabilitar el campo visual\n   712→        $(campo_visual).prop('disabled', true);\n   713→    } else {\n   714→        // Si no hay descuento, mostrar el valor original y habilitar el campo\n   715→        if (valor_original > 0) {\n   716→            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n   717→        }\n   718→        $(campo_visual).prop('disabled', false);\n   719→    }\n   720→\n   721→    // Actualizar el valor total mostrado\n   722→    actualizarValorDesdeInput();\n   723→}\n   724→\n   725→/**\n   726→ * Abrir la factura del plan en una nueva pestaña del navegador.\n   727→ * "}]},"uuid":"4cba932e-66ed-4a69-a9af-4910fe5fb2ff","timestamp":"2026-01-26T13:23:35.907Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","oldString":"function aplicarDescuento(tipo) {\n    console.log('aplicarDescuento llamada con tipo:', tipo);\n\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    console.log('Campo porcentaje:', campo_porcentaje, 'Valor:', $(campo_porcentaje).val());\n    console.log('Campo original:', campo_original, 'Valor:', $(campo_original).val());\n    console.log('Campo visual:', campo_visual, 'Valor:', $(campo_visual).val());\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    console.log('Porcentaje:', porcentaje);\n    console.log('Valor original inicial:', valor_original);\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        console.log('Valor visual para extraer original:', valor_visual);\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n            console.log('Valor original extraído del visual:', valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        console.log('Descuento calculado:', descuento);\n        console.log('Valor con descuento:', valor_con_descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n        console.log('Campo visual deshabilitado');\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n        console.log('Campo visual habilitado');\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}","newString":"function aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}","originalFile":"table = null;\nplanes = [];\npruebas = [];\nmodificado = false;\nfuncionalidades_predefinidos = [];\nplan_creditos_seleccionado = null;\n\n$(document).ready(function() {\n    $(document).on('input', '#precio_plan_visual, #precio_creditos_visual', function() {\n        actualizarValorDesdeInput();\n    });\n});\n\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales\n */\nfunction seleccionarTipoPrueba(tipo_prueba_id) {\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"card-body text-center\">\n            <button type=\"button\" id=\"elegir-plan\" class=\"btn btn-outline-primary\" disabled onclick=\"modalElegirPlan();\">Elegir plan</button>\n        </div>\n    `);\n    $('#seccion-pruebas').addClass('d-none');\n    $('#plan_id').val('');\n    pruebas = [];\n    // Convertir tipo_prueba_id a array si no lo es\n    let tipos_prueba = Array.isArray(tipo_prueba_id) ? tipo_prueba_id : [tipo_prueba_id];\n    // Crear los botones según los tipos de prueba seleccionados\n    let botones_html = '<div class=\"card-body text-center\">';\n    tipos_prueba.forEach(function(tipo_id) {\n        let texto_boton = 'Elegir plan';\n        let clase_boton = 'btn-outline-primary';\n        if (tipo_id == 1) {\n            texto_boton = 'Elegir Plan de Selección';\n            clase_boton = 'btn-outline-primary';\n        } else if (tipo_id == 2) {\n            texto_boton = 'Elegir Plan de Créditos IA';\n            clase_boton = 'btn-outline-info';\n        }\n        botones_html += `\n            <button type=\"button\" id=\"elegir-plan-${tipo_id}\" class=\"btn ${clase_boton} mx-1 my-1\" disabled onclick=\"modalElegirPlan(${tipo_id});\">\n                ${texto_boton}\n            </button>\n        `;\n    });\n    botones_html += '</div>';\n    $('#contenedor-plan').append(botones_html);\n    $('#tipo_prueba_id').val(tipo_prueba_id).trigger('select2');\n    if (tipo_prueba_id && (Array.isArray(tipo_prueba_id) ? tipo_prueba_id.length > 0 : tipo_prueba_id)) {\n        // Habilitar todos los botones creados\n        tipos_prueba.forEach(function(tipo_id) {\n            $(`#elegir-plan-${tipo_id}`).prop('disabled', false);\n        });\n        $.ajax({\n            type: 'GET',\n            url : `/pruebas-listado`,\n            data: {\n                tipo_prueba_id: tipo_prueba_id,\n                activo: 1\n            }\n        }).then((respuesta) => {\n            limpiarAdicional();\n            $('#contenedor-pruebas').empty();\n            pruebas = respuesta.data;\n            for (let i = 0; i < pruebas.length; i++) {\n                $('#contenedor-pruebas').append(`\n                    <div class=\"col-12 col-md-6\">\n                        <div class=\"d-flex align-items-center\">\n                            <div class=\"check-container my-1 me-1\">\n                                <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                            </div>\n                            <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                        </div>\n                    </div>\n                `);\n            }\n            if (opcion == 'facturar' || opcion == 'editar') {\n                for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                    $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n                }\n                $('#seccion-pruebas').removeClass('d-none');\n                mostrarPlanSeleccionado();\n            }\n            if (opcion == 'editar') {\n                $('#tipo_prueba_id').prop('disabled', true);\n            }\n        }).catch((error) => {\n            console.error(error);\n        });\n    } else {\n        $('#elegir-plan').prop('disabled', true);\n    }\n}\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction seleccionarTipoPruebaMultiple() {\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    tipos_prueba = tipos_prueba.filter(function(tipo_id) {\n        return tipo_id !== null && tipo_id !== '' && tipo_id !== undefined;\n    });\n    if (tipos_prueba.length === 0) {\n        // Si no hay tipos seleccionados, limpiar todo\n        $('#contenedor-plan').empty();\n        $('#contenedor-creditos').empty();\n        $('#seccion-pruebas').addClass('d-none');\n        $('#plan_id').val('');\n        $('#plan_id').prop('required', false);\n        $('#plan_id').prop('disabled', true);\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n        plan_seleccionado = null;\n        plan_creditos_seleccionado = null;\n        pruebas = [];\n        return;\n    }\n    let tiene_seleccion = tipos_prueba.includes('1') || tipos_prueba.includes(1);\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    $('#plan_id').prop('required', tiene_seleccion);\n    $('#plan_id').prop('disabled', !tiene_seleccion);\n    // Manejo del plan de selección\n    if (tiene_seleccion) {\n        // Si hay un plan seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_seleccionado === null && $('#contenedor-plan').children().length === 0) {\n            let seccion_seleccion = `\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Selección</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-1\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(1);\">\n                            Elegir Plan de Selección\n                        </button>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-plan').html(seccion_seleccion);\n        }\n    } else {\n        // Si se deseleccionó el tipo de selección, limpiar el plan\n        $('#contenedor-plan').empty();\n        plan_seleccionado = null;\n        $('#plan_id').val('');\n    }\n    // Manejo del plan de créditos\n    if (tiene_creditos) {\n        // Si hay un plan de créditos seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n            let seccion_creditos = `\n                <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                    <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                    <div class=\"card rounded rounded-3\">\n                        <div class=\"card-body text-center\">\n                            <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                                Elegir Plan de Créditos IA\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-creditos').html(seccion_creditos);\n        }\n    } else {\n        // Si se deseleccionó el tipo de créditos, limpiar el plan de créditos\n        $('#contenedor-creditos').empty();\n        $('#contenedor-plan-creditos').remove();\n        plan_creditos_seleccionado = null;\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/pruebas-listado`,\n        data: {\n            tipo_prueba_id: tipos_prueba,\n            activo: 1\n        }\n    }).then((respuesta) => {\n        limpiarAdicional();\n        $('#contenedor-pruebas').empty();\n        pruebas = respuesta.data;\n        for (let i = 0; i < pruebas.length; i++) {\n            $('#contenedor-pruebas').append(`\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"d-flex align-items-center\">\n                        <div class=\"check-container my-1 me-1\">\n                            <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                        </div>\n                        <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                    </div>\n                </div>\n            `);\n        }\n        if (opcion == 'facturar' || opcion == 'editar') {\n            for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n            }\n            $('#seccion-pruebas').removeClass('d-none');\n            mostrarPlanSeleccionado();\n        }\n        if (opcion == 'editar') {\n            $('#tipo_prueba_id').prop('disabled', true);\n        }\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    });\n}\n/**\n * Obtener el listado de planes según el tipo_prueba_id seleccionado anteriormente.\n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalElegirPlan(tipo_especifico = null) {\n    let tipo_prueba_para_consulta = tipo_especifico !== null ? tipo_especifico : $('#tipo_prueba_id').val();\n    // Si es tipo 2 (Créditos IA), cargar planes de créditos\n    if (tipo_prueba_para_consulta == 2 || tipo_prueba_para_consulta == '2') {\n        $.ajax({\n            type: 'GET',\n            url: '/planes-creditos',\n            data: {\n                activo: true\n            }\n        }).then((respuesta) => {\n            planes_creditos = respuesta.data.planes;\n            mostrarPlanesCreditos();\n        }).catch((error) => {\n            mostrarToast('danger', 'Ocurrió un error');\n        });\n        return;\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/planes-listado`,\n        data: {\n            tipo_prueba_id: $('#tipo_prueba_id').val()\n        }\n    }).then((respuesta) => {\n        planes = respuesta.data;\n        mostrarPlanes();\n    }).catch((error) => {\n        console.error(error);\n    });\n}\n/**\n * Mostrar los planes de créditos en el modal.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction mostrarPlanesCreditos() {\n    let filtro_orden = $('#filtro-plan-credito').val();\n    let buscar = $('#buscador-plan-credito').val() || '';\n    // Ordenar planes según el filtro\n    let planes_ordenados = [...planes_creditos];\n    if (filtro_orden === 'Mayor') {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else if (filtro_orden === 'Menor') {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    if (buscar !== '') {\n        planes_ordenados = planes_ordenados.filter(plan =>\n            plan.nombre.toLowerCase().includes(buscar.toLowerCase())\n        );\n    }\n    $('#contenedor-planes-creditos').empty();\n    if (planes_ordenados.length === 0) {\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"text-center py-5\">\n                <p class=\"text-muted\">No se encontraron planes</p>\n            </div>\n        `);\n    }\n    for (let i = 0; i < planes_ordenados.length; i++) {\n        let plan = planes_ordenados[i];\n        let creditos_disponibles = plan.creditos_disponibles || plan.creditos || 0;\n        let creditos_promedio = plan.creditos_promedio_accion || 0;\n        let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n            ? Math.floor(creditos_disponibles / creditos_promedio)\n            : 0;\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"card rounded rounded-3 border-hover pointer mb-3\" onclick=\"elegirPlanCreditos(${i}, ${filtro_orden === 'Mayor' ? 'true' : 'false'});\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6 text-gray-10\">${plan.nombre}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        `);\n    }\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('show');\n    }\n    $('#buscador-plan-credito').off('input').on('input', function() {\n        mostrarPlanesCreditos();\n    });\n}\n/**\n * Elegir un plan de créditos IA.\n * @param {number} indice Índice del plan en el array.\n * @param {boolean} orden_mayor Si está ordenado de mayor a menor.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction elegirPlanCreditos(indice, orden_mayor = false) {\n    // Aplicar el mismo ordenamiento que en mostrarPlanesCreditos\n    let planes_ordenados = [...planes_creditos];\n    if (orden_mayor) {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    plan_creditos_seleccionado = planes_ordenados[indice];\n    // Establecer los valores en los campos hidden\n    $('#plan_credito_id').val(plan_creditos_seleccionado.id);\n    $('#creditos').val(plan_creditos_seleccionado.creditos);\n    mostrarPlanCreditosSeleccionado();\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('hide');\n    }\n}\n/**\n * Mostrar el plan de créditos seleccionado en el contenedor.\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarPlanCreditosSeleccionado() {\n    if (!plan_creditos_seleccionado || !plan_creditos_seleccionado.creditos) {\n        mostrarToast('danger', 'Ocurrió un error'+plan_creditos_seleccionado);\n        return;\n    }\n    let creditos_disponibles = plan_creditos_seleccionado.creditos_disponibles || plan_creditos_seleccionado.creditos || 0;\n    let creditos_promedio = plan_creditos_seleccionado.creditos_promedio_accion || 0;\n    let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n        ? Math.floor(creditos_disponibles / creditos_promedio)\n        : 0;\n    let seccion_creditos = `\n        <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n            <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n            <div class=\"card rounded rounded-3\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4 pointer\" onclick=\"modalElegirPlan(2);\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6\">${plan_creditos_seleccionado.nombre || 'Plan de Créditos'}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan_creditos_seleccionado.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    // Remover el contenedor anterior si existe\n    $('#contenedor-plan-creditos').remove();\n    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n    if ($('#contenedor-creditos').length) {\n        $('#contenedor-creditos').html(seccion_creditos);\n    } else {\n        $('#contenedor-plan').after(seccion_creditos);\n    }\n    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }\n    actualizarValorVentaTotal();\n}\n\n/**\n * Mostrar en el modal los planes obtenidos en el listado.\n * \n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPlanes() {\n    let buscar = $('#buscador-plan').val();\n    let filtro_plan = $('#filtro-plan').val();\n    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n        table.destroy();\n    }\n    $('#buscador-plan').remove();\n    $('#tbody-planes').empty();\n    for (let i = 0; i < planes.length; i++) {\n        if (\n            (filtro_plan == 'Todos') ||\n            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n        ) {\n            let cantidad_usuarios = '';\n            if (planes[i].cantidad_usuarios != null) {\n                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n            }\n            let cantidad_ofertas_laborales = '';\n            if (planes[i].cantidad_ofertas_laborales != null) {\n                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n            }\n            let cantidad_pruebas = '';\n            if (planes[i].cantidad_pruebas != null) {\n                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;\n            }\n            let unidades = '';\n            if (planes[i].unidades != null) {\n                unidades = `<div class=\"col-auto w-90px\"><i class=\"bi bi-box\"></i> ${planes[i].unidades}</div>`;\n            }\n            let vigencia = '';\n            if (planes[i].vigencia == 90) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n            } else if (planes[i].vigencia == 180) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n            }  else if (planes[i].vigencia == 365) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n            } else if (planes[i].vigencia == null || planes[i].vigencia == 0) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n            } else {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${planes[i].vigencia} días</div>`;\n            }\n            $('#tbody-planes').append(`\n                <tr>\n                    <td style=\"border-bottom: 0px!important;\">\n                        <div class=\"border border-1 rounded rounded-2 pointer border-hover\" onclick=\"elegirPlan(${i});\">\n                            <div class=\"row m-0 w-100 px-3 py-5 text-headline-6\">\n                                <div class=\"col\">${planes[i].nombre !== null ? planes[i].nombre : ''}</div>\n                                ${cantidad_ofertas_laborales}\n                                ${unidades}\n                                ${cantidad_usuarios}\n                                ${cantidad_pruebas}\n                                ${vigencia}\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            `);\n        }\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('show');\n    }\n    table = $('#tabla-planes').DataTable({\n        \"paging\": false,\n        \"searching\": true,\n        \"ordering\": false,\n        \"info\": false\n    });\n    let buscador = $('#tabla-planes_wrapper input');\n    $(buscador).addClass('rounded-2 text-body-2');\n    $(buscador).prop('placeholder', 'Buscar');\n    $(buscador).prop('id', 'buscador-plan');\n    $('#input-busqueda').append(buscador);\n    $(buscador).val(buscar).trigger('input');\n}\n/**\n * Elegir un plan del listado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction elegirPlan(i) {\n    plan_seleccionado = planes[i];\n    mostrarPlanSeleccionado();\n}\n/**\n * Mostrar el plan seleccionado en el contenedor y en las opciones del modificar.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction mostrarPlanSeleccionado() {\n    let cantidad_usuarios = '';\n    let cantidad_usuarios_modal = $('#cantidad_usuarios_modal').val();\n    if (cantidad_usuarios_modal != '') {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${cantidad_usuarios_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_usuarios != null) {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${plan_seleccionado.cantidad_usuarios}</div>`;\n    }\n    let cantidad_ofertas_laborales = '';\n    let cantidad_ofertas_laborales_modal = $('#cantidad_ofertas_laborales_modal').val();\n    if (cantidad_ofertas_laborales_modal != '') {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${cantidad_ofertas_laborales_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_ofertas_laborales != null) {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${plan_seleccionado.cantidad_ofertas_laborales}</div>`;\n    }\n    let cantidad_pruebas = '';\n    let cantidad_pruebas_modal = $('#cantidad_pruebas_modal').val();\n    if (cantidad_pruebas_modal != '') {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${cantidad_pruebas_modal}</div>`;\n        $('.cantidad-pruebas').text(cantidad_pruebas_modal);\n    } else if (plan_seleccionado.cantidad_pruebas != null) {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${plan_seleccionado.cantidad_pruebas}</div>`;\n        $('.cantidad-pruebas').text(plan_seleccionado.cantidad_pruebas);\n    }\n    let unidades = '';\n    let unidades_modal = $('#unidades_modal').val();\n    if (unidades_modal != '') {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${unidades_modal}</div>`;\n    } else if (plan_seleccionado.unidades != null) {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${plan_seleccionado.unidades}</div>`;\n    }\n    let vigencia = '';\n    let vigencia_modal = $('#vigencia_modal').val();\n    if (plan_seleccionado.vigencia == 90 || vigencia_modal == '90') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n    } else if (plan_seleccionado.vigencia == 180 || vigencia_modal == '180') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n    }  else if (plan_seleccionado.vigencia == 365 || vigencia_modal == '365') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n    } else if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n    } else if (vigencia_modal != '') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${vigencia_modal} días</div>`;\n    } else {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${plan_seleccionado.vigencia} días</div>`;\n    }\n    let abrir_modal_elegir_plan = '';\n    let icono_editar = `\n        <div class=\"col-auto w-90px\">\n            <button type=\"button\" class=\"btn btn-text-primary text-white btn-circle\" onclick=\"abrirModalModificar(event);\" title=\"Modificar plan\">\n                <i class=\"bi bi-wrench\"></i>\n            </button>\n        </div>\n    `;\n    if (opcion == 'asignar') {\n        abrir_modal_elegir_plan = `onclick=\"modalElegirPlan();\"`;\n        icono_editar = '';\n    }\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"row border rounded rounded-3 m-0 w-100 px-3 py-5 text-headline-6 pointer\" ${abrir_modal_elegir_plan}>\n            <div class=\"col\">${plan_seleccionado.nombre !== null ? plan_seleccionado.nombre : ''} <span id=\"plan-modificado\"></span></div>\n            ${cantidad_ofertas_laborales}\n            ${unidades}\n            ${cantidad_usuarios}\n            ${cantidad_pruebas}\n            ${vigencia}\n            ${icono_editar}\n        </div>\n    `);\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    // Solo agregar el botón de elegir plan de créditos si no hay uno seleccionado y se requiere\n    if (tiene_creditos && plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n        let seccion_creditos = `\n            <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                            Elegir Plan de Créditos IA\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n        $('#contenedor-creditos').append(seccion_creditos);\n    }\n    $('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n\n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_plan_original').val(plan_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_plan_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento').val('');\n    }\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}\n\n/**\n * Actualizar el valor de venta total sumando plan de selección y créditos.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorVentaTotal() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n    }\n\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    // Usar los campos visuales para mostrar el total\n    let valor_plan_input = $('#precio_plan_visual').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos_visual').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Aplicar el porcentaje de descuento al valor del plan o créditos.\n * El valor original se mantiene en el campo hidden para el envío.\n * El campo visual muestra el valor con descuento y se deshabilita.\n *\n * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n * @returns {void}\n */\nfunction aplicarDescuento(tipo) {\n    console.log('aplicarDescuento llamada con tipo:', tipo);\n\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    console.log('Campo porcentaje:', campo_porcentaje, 'Valor:', $(campo_porcentaje).val());\n    console.log('Campo original:', campo_original, 'Valor:', $(campo_original).val());\n    console.log('Campo visual:', campo_visual, 'Valor:', $(campo_visual).val());\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    console.log('Porcentaje:', porcentaje);\n    console.log('Valor original inicial:', valor_original);\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        console.log('Valor visual para extraer original:', valor_visual);\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n            console.log('Valor original extraído del visual:', valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        console.log('Descuento calculado:', descuento);\n        console.log('Valor con descuento:', valor_con_descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n        console.log('Campo visual deshabilitado');\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n        console.log('Campo visual habilitado');\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}\n\n/**\n * Abrir la factura del plan en una nueva pestaña del navegador.\n * \n * @param {number} factura_id Id de la factura.\n * @returns {void}\n * @author Andres Morales\n */\nasync function abrirFacturaPlan(factura_id) {\n    if (!factura_id) {\n        mostrarToast('danger', 'No se encontró la factura');\n        return;\n    }\n    try {\n        const respuesta = await $.ajax({\n            type: 'GET',\n            url: `/archivos-abrir/${factura_id}`,\n            xhrFields: { responseType: 'blob' }\n        });\n        const blobUrl = window.URL.createObjectURL(respuesta);\n        window.open(blobUrl, '_blank');\n    } catch (error) {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    }\n}\n/**\n * Buscar las funcionalidades por tipo de prueba.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidades(tipo_prueba_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/funcionalidades-listado`,\n        data : {\n            tipo_prueba_id: tipo_prueba_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let beneficios = respuesta.data;\n            const ADICIONALES = beneficios\n                .filter(item => item.predeterminado === 0)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            const PREDEFINIDOS = beneficios\n                .filter(item => item.predeterminado === 1)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            funcionalidades_predefinidos = PREDEFINIDOS;\n            // Verificar si el multiselect está inicializado antes de destruir\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect('destroy');\n            }\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect('destroy');\n            }\n            ADICIONALES.forEach((item) => {\n                $('#adicionales_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            PREDEFINIDOS.forEach((item) => {\n                $('#predefinidos_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            inizializarMultiselect();\n            if (opcion == 'facturar' || opcion == 'editar') {\n                buscarfuncionalidadesPlanEmpresa($('#id').val());\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Buscar las funcionalidades del plan de la empresa.\n * @param {number} empresa_plan_id ID del plan de empresa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidadesPlanEmpresa(empresa_plan_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/empresas-planes-funcionalidades-listado`,\n        data : {\n            empresa_plan_id: empresa_plan_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let funcionalidades = respuesta.data.map(item => item.funcionalidad_id);\n            $('#adicionales_modal').val(funcionalidades);\n            // Verificar si el multiselect está inicializado antes de refrescar\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect(\"refresh\");\n            }\n            $('#predefinidos_modal').val(funcionalidades);\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect(\"refresh\");\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Función para agregar validaciones adicionales y data adicional en el envío del form.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction validacionAdicional() {\n    let valido = true;\n    let es_solo_creditos = plan_seleccionado === null && plan_creditos_seleccionado !== null;\n    $('#vigencia').val($('#vigencia_modal').val());\n    if ($('#unidades_modal').val() == 'Ilimitadas') {\n        $('#unidades').val('');\n    } else {\n        $('#unidades').val($('#unidades_modal').val());\n    }\n    if ($('#cantidad_ofertas_laborales_modal').val() == 'Ilimitadas') {\n        $('#cantidad_ofertas_laborales').val('');\n    } else {\n        $('#cantidad_ofertas_laborales').val($('#cantidad_ofertas_laborales_modal').val());\n    }\n    $('#cantidad_usuarios').val($('#cantidad_usuarios_modal').val());\n    $('#cantidad_pruebas').val($('#cantidad_pruebas_modal').val());\n    if (opcion == 'facturar' || opcion == 'editar') {\n        let adicionales = $('#adicionales_modal').val();\n        let predefinidos = $('#predefinidos_modal').val();\n        let funcionalidades = adicionales.concat(predefinidos);\n        $('#funcionalidades').val(JSON.stringify(funcionalidades));\n        if (!es_solo_creditos && funcionalidades.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una funcionalidad.');\n        }\n    } else {\n        let ids = [];\n        if (plan_seleccionado && Array.isArray(plan_seleccionado.funcionalidades)) {\n            ids = plan_seleccionado.funcionalidades.map(objeto => objeto.id);\n        }\n        $('#funcionalidades').val(JSON.stringify(ids));\n    }\n    var pruebas_seleccionadas = $('.pruebas:checked').map(function() {\n        return this.value;\n    }).get();\n    $('#pruebas').val('');\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado ? plan_seleccionado.cantidad_pruebas : 0;\n    }\n    if (!es_solo_creditos) {\n        if (pruebas_seleccionadas.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una prueba.');\n        } else if (pruebas_seleccionadas.length > maximo_pruebas) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione maximo ' + maximo_pruebas + ' pruebas.');\n        }\n    }\n    if (valido) {\n        $('#pruebas').val(JSON.stringify(pruebas_seleccionadas));\n    }\n    return valido;\n}\n/**\n * Función para validar que no se exceda al seleccionar limite de pruebas.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction ValidarPruebas() {\n    let cantidad_seleccionadas = $('.pruebas:checked').length;\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado.cantidad_pruebas;\n    }\n    if (cantidad_seleccionadas > maximo_pruebas) {\n        $('#alerta-pruebas').removeClass('d-none');\n    } else {\n        $('#alerta-pruebas').addClass('d-none');\n    }\n}\n/**\n * Abrir el modal con los campos para modificar plan.\n * @param {Event} evento Evento desencadenado.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalModificar(evento) {\n    evento.stopPropagation();\n    if (modificado == false) {\n        $('#nombre-plan-modal').text(plan_seleccionado.nombre);\n        $('#cantidad_pruebas_modal').empty();\n        $('#cantidad_pruebas_modal').append(`\n            <option value=\"\">Seleccione</option>\n        `);\n        for (let j = 1; j <= pruebas.length; j++) {\n            $('#cantidad_pruebas_modal').append(`\n                <option value=\"${j}\">${j} Pruebas</option>\n            `);\n        }\n        $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n        if ([90, 180, 365].includes(plan_seleccionado.vigencia)) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val(plan_seleccionado.vigencia).trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else if (plan_seleccionado.vigencia != null && plan_seleccionado.vigencia != 0) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val('personalizado').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else {\n            $('#tiempo_modal').prop('disabled', true);\n            $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val('');\n        }\n        if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n            $('#unidades_modal').val(plan_seleccionado.unidades);\n            $('#unidades_modal').prop('disabled', false);\n            if (opcion == 'asignar') {\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa_plan.cantidad_ofertas_laborales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', false);\n        } else {\n            $('#unidades_modal').val(empresa.procesos_estimados_mensuales);\n            $('#unidades_modal').prop('disabled', true);\n            if (opcion == 'facturar' || opcion == 'editar') {\n                $('#unidades_modal').val(plan_seleccionado.unidades);\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa.pruebas_estimadas_mensuales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', true);\n        }\n        $('#cantidad_usuarios_modal').val(plan_seleccionado.cantidad_usuarios);\n        if (opcion == 'facturar' || opcion == 'editar') {\n            $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n            buscarfuncionalidadesPlanEmpresa($('#id').val());\n        }\n        $('#boton-guardar-modificaciones').prop('disabled', true);\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('show');\n    }\n}\n/**\n * Función que habilita el boton de guardar un plan modificado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction habilitarBotonGuardar() {\n    $('#boton-guardar-modificaciones').prop('disabled', false);\n}\n/**\n * Función que controla los campos de vigencia en el modal de editar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarTiempo(vigencia) {\n    $('.texto-label-tiempo').text('máximas permitidas');\n    $('#input-container-tiempo').removeClass('d-none');\n    $('#input-container-tiempo').addClass('col-md-6');\n    if (vigencia == 'personalizado') {\n        $('#input-container-vigencia').removeClass('d-none');\n        $('#vigencia_modal').val('');\n    } else if ((vigencia == '' || vigencia == null || vigencia == 0) && plan_seleccionado != null && (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0)) {\n        $('.texto-label-tiempo').text('');\n        $('#input-container-tiempo').addClass('d-none');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val('');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    } else if (['90', '180', '365'].includes(vigencia)) {\n        $('#input-container-tiempo').removeClass('col-md-6');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val(vigencia);\n    } else {\n        $('#vigencia_modal').val(vigencia);\n        $('#input-container-vigencia').addClass('d-none');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    }\n}\n/**\n * Abrir el modal de confirmación.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalEstasSeguro() {\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('hide');\n        $('#modal-estas-seguro').modal('show');\n    }\n}\n/**\n * Cancelar la edición de un plan.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction cancelarEdicion() {\n    modificado = false;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    limpiarAdicional();\n    mostrarPlanSeleccionado();\n}\n/**\n * Confirmar los datos editados.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction confirmarEdicion() {\n    modificado = true;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    $('#plan-modificado').text('(modificado)');\n    mostrarPlanSeleccionado();\n}\n/**\n * Limpiar los campos del modal.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction limpiarAdicional() {\n    $('#cantidad_pruebas_modal').val('').trigger('change').trigger('select2:select');\n    $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n    $('#unidades_modal').val('');\n    $('#cantidad_ofertas_laborales_modal').val('');\n    $('#cantidad_usuarios_modal').val('');\n    // Verificar si el multiselect está inicializado antes de llamar uncheckAll\n    if ($('#adicionales_modal').data('multiselect')) {\n        $('#adicionales_modal').multiselect(\"uncheckAll\");\n    }\n    if ($('#predefinidos_modal').data('multiselect')) {\n        $('#predefinidos_modal').multiselect(\"uncheckAll\");\n    }\n}\n/**\n * Función para ejecutar acciones luego de guardar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction postSuccess(respuesta) {\n    limpiarFormulario(respuesta.formulario);\n    if (opcion == 'asignar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se asignó con éxito a la empresa`,\n        }));\n    } else if (opcion == 'facturar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se facturó con éxito`,\n        }));\n    } else if (opcion == 'editar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se actualizó con éxito`,\n        }));\n    }\n    window.location.href='/empresas-gestionar/' + empresa.id;\n}\n","structuredPatch":[{"oldStart":679,"oldLines":16,"newStart":679,"newLines":10,"lines":["  * @returns {void}","  */"," function aplicarDescuento(tipo) {","-    console.log('aplicarDescuento llamada con tipo:', tipo);","-","     let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';","     let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';","     let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';"," ","-    console.log('Campo porcentaje:', campo_porcentaje, 'Valor:', $(campo_porcentaje).val());","-    console.log('Campo original:', campo_original, 'Valor:', $(campo_original).val());","-    console.log('Campo visual:', campo_visual, 'Valor:', $(campo_visual).val());","-","     let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;","     let valor_original_str = $(campo_original).val();","     let valor_original = 0;"]},{"oldStart":697,"oldLines":17,"newStart":691,"newLines":12,"lines":["         valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;","     }"," ","-    console.log('Porcentaje:', porcentaje);","-    console.log('Valor original inicial:', valor_original);","-","     // Si no hay valor original guardado, tomarlo del campo visual","     if (valor_original === 0) {","         let valor_visual = $(campo_visual).val();","-        console.log('Valor visual para extraer original:', valor_visual);","         if (valor_visual) {","             valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;","             $(campo_original).val(valor_original);","-            console.log('Valor original extraído del visual:', valor_original);","         }","     }"," "]},{"oldStart":716,"oldLines":22,"newStart":705,"newLines":17,"lines":["         let descuento = valor_original * (porcentaje / 100);","         let valor_con_descuento = Math.round(valor_original - descuento);"," ","-        console.log('Descuento calculado:', descuento);","-        console.log('Valor con descuento:', valor_con_descuento);","-","         // Mostrar el valor con descuento en el campo visual","         $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));"," ","         // Deshabilitar el campo visual","         $(campo_visual).prop('disabled', true);","-        console.log('Campo visual deshabilitado');","     } else {","         // Si no hay descuento, mostrar el valor original y habilitar el campo","         if (valor_original > 0) {","             $(campo_visual).val(valor_original.toLocaleString('es-CO'));","         }","         $(campo_visual).prop('disabled', false);","-        console.log('Campo visual habilitado');","     }"," ","     // Actualizar el valor total mostrado"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"1dfd58e8-9fb5-40d0-bed8-29730f87f6b8"}
{"parentUuid":"4cba932e-66ed-4a69-a9af-4910fe5fb2ff","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01PNCcpTAY8LgfDhCY8dZHaJ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Los console.log han sido eliminados. La función ahora está limpia y funcional.","signature":"EvgBCkYICxgCKkDMaWP88h2bWEUcvjRs8MZy3mjAY3yPlP/ZSUn9TjFpKNbylnQf7Zo/5AlVqv226fAJHzVa9B4QrUvVchb2ZF+eEgzh898YQp4XT8tyxCUaDLRXfC9QpOwIEBL+xyIwOZ+lw0NkV8C6eQlvfpH67+fDrbYkIOr0DggrYrQM3vR+4a5n1IBdaYFdXFY2qzk3KmCKj+f7kXAWBNz2QcxnOpvCIpm945J4dZhS1QuiDM2xgv8WciSUY6MQW2RF/S/Tpy3RJZcazPxEfUtK/KcJYF2/WRDlwYFQMXx8nLcyNC3TjuvymJ5dnpqpA1r3dVDWWCMYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2349,"cache_read_input_tokens":98428,"cache_creation":{"ephemeral_5m_input_tokens":2349,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW4ZLg9LDiDDhdVcmXtc","type":"assistant","uuid":"84a311fa-f2ae-4180-9c87-d69d2344246c","timestamp":"2026-01-26T13:23:39.811Z"}
{"parentUuid":"84a311fa-f2ae-4180-9c87-d69d2344246c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01PNCcpTAY8LgfDhCY8dZHaJ","type":"message","role":"assistant","content":[{"type":"text","text":"Listo, eliminados todos los `console.log`. La función queda limpia y funcional."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2349,"cache_read_input_tokens":98428,"cache_creation":{"ephemeral_5m_input_tokens":2349,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXW4ZLg9LDiDDhdVcmXtc","type":"assistant","uuid":"5e2abb26-f946-4f6a-ba30-fdf53ef90b0b","timestamp":"2026-01-26T13:23:40.353Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-26T13:28:24.932Z","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287"}
{"type":"file-history-snapshot","messageId":"5f5e1975-8ef0-473f-8adc-3617e2e94c6b","snapshot":{"messageId":"5f5e1975-8ef0-473f-8adc-3617e2e94c6b","trackedFileBackups":{"resources\\views\\empresas\\paginas\\asignar-plan.blade.php":{"backupFileName":"23a0b404d58f48f6@v4","version":4,"backupTime":"2026-01-26T13:23:09.804Z"},"public\\js\\empresas\\asignar-plan.js":{"backupFileName":"25fa1d462d51e622@v5","version":5,"backupTime":"2026-01-26T13:28:25.626Z"}},"timestamp":"2026-01-26T13:28:25.624Z"},"isSnapshotUpdate":false}
{"parentUuid":"1dfd58e8-9fb5-40d0-bed8-29730f87f6b8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_019FAXYhtFFcRrwk8wx4Kp7x","parentToolUseID":"toolu_019FAXYhtFFcRrwk8wx4Kp7x","uuid":"6eb36d32-8c95-49b6-9956-1396139a9a8c","timestamp":"2026-01-26T13:23:23.087Z"}
{"parentUuid":"6eb36d32-8c95-49b6-9956-1396139a9a8c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_019FAXYhtFFcRrwk8wx4Kp7x","parentToolUseID":"toolu_019FAXYhtFFcRrwk8wx4Kp7x","uuid":"825d0eab-8371-4eb1-b516-c21b3a66cf1a","timestamp":"2026-01-26T13:23:23.091Z"}
{"parentUuid":"4cba932e-66ed-4a69-a9af-4910fe5fb2ff","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_019FAXYhtFFcRrwk8wx4Kp7x","toolUseID":"toolu_019FAXYhtFFcRrwk8wx4Kp7x","timestamp":"2026-01-26T13:23:35.908Z","uuid":"8442d161-83da-407c-8096-8406d3cc164c"}
{"parentUuid":"5e2abb26-f946-4f6a-ba30-fdf53ef90b0b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"listo hay que cer un ajute y es cuando seleciono"}]},"uuid":"5f5e1975-8ef0-473f-8adc-3617e2e94c6b","timestamp":"2026-01-26T13:28:25.621Z","permissionMode":"default"}
{"parentUuid":"5f5e1975-8ef0-473f-8adc-3617e2e94c6b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01JT1dHfBAem2xmgDn4f2uno","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario está escribiendo algo sobre un ajuste cuando selecciona algo. Parece que no terminó de escribir su mensaje. Voy a esperar a que complete lo que quiere decir.","signature":"EtMCCkYICxgCKkBLF6xhYLWIx1EXqurt4d6o73iHTBIBpcWU1BRjWVpdK69g2QKQdTz3tRltGSuE2lpj8m2sgLJjcE5QlmBFpfj7EgwdEQtA0kozfdf9b0oaDIPbIudyxGYlwNyCLCIwX+jlg5FpJKIvcqyHt3DBIU92YrnoeKnEB6BeMKXAQySLGRGyAUGj77JopeneLAfbKroBgj2J5rC8XRygkibVpFIZa/f1m/tDUaezQ/8LuTzG95PHmuTkYYSykkIw84WPH5kPF+1UrIZGKlB8qi3jp/1dkwcSGQInOx6RT/Ol/2F+vnH7W27+ZC1ZbUVCqhykxR0rNfdeTSDVfz5dLEheVeq86bFKLAQU7P04VOcpS3WnEkD9nDeVR6rjE0wlX/wsXCDy2jJAsPWlb50UrvITkvjXH+YnE94DxELIoUI59Xuzug7k9Ecxtnwxh/izGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4169,"cache_read_input_tokens":100777,"cache_creation":{"ephemeral_5m_input_tokens":4169,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW4vcQGxWFzgSGZuJHiY","type":"assistant","uuid":"a8a0b80c-d756-4ec2-b69e-91bd77e7e0dd","timestamp":"2026-01-26T13:28:29.268Z"}
{"parentUuid":"a8a0b80c-d756-4ec2-b69e-91bd77e7e0dd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01JT1dHfBAem2xmgDn4f2uno","type":"message","role":"assistant","content":[{"type":"text","text":"¿Qué ajuste necesitas hacer? Parece que el mensaje quedó incompleto. ¿Qué pasa cuando seleccionas?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4169,"cache_read_input_tokens":100777,"cache_creation":{"ephemeral_5m_input_tokens":4169,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXW4vcQGxWFzgSGZuJHiY","type":"assistant","uuid":"9a691004-cf63-4f89-a4b7-222aa6e9774f","timestamp":"2026-01-26T13:28:29.764Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-26T14:38:33.419Z","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287"}
{"type":"file-history-snapshot","messageId":"262ec82e-1581-4bcf-abd1-76965d380af6","snapshot":{"messageId":"262ec82e-1581-4bcf-abd1-76965d380af6","trackedFileBackups":{"resources\\views\\empresas\\paginas\\asignar-plan.blade.php":{"backupFileName":"23a0b404d58f48f6@v5","version":5,"backupTime":"2026-01-26T14:38:34.296Z"},"public\\js\\empresas\\asignar-plan.js":{"backupFileName":"25fa1d462d51e622@v6","version":6,"backupTime":"2026-01-26T14:38:34.299Z"}},"timestamp":"2026-01-26T14:38:34.278Z"},"isSnapshotUpdate":false}
{"parentUuid":"9a691004-cf63-4f89-a4b7-222aa6e9774f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"mira aqui function aplicarDescuento(tipo) { cogel el valor que llege y asle el descuento sion trasfomarlo el valor cooca el valor directo decxontado el descuento sin el pase float el valor directo"}]},"uuid":"262ec82e-1581-4bcf-abd1-76965d380af6","timestamp":"2026-01-26T14:38:34.275Z","permissionMode":"default"}
{"parentUuid":"262ec82e-1581-4bcf-abd1-76965d380af6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_017X7c2HKDy6KHNs1TBjweSj","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que la función `aplicarDescuento()` tome el valor que llega directamente y le aplique el descuento sin transformarlo con parseFloat. Quiere que use el valor directo que viene del campo original.\n\nMirando el código actual, veo que en la línea 681 hay un comentario que indica que alguien comentó esa línea:\n```javascript\n//valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n```\n\nEl usuario quiere simplificar: tomar el valor original directamente y aplicar el descuento sin hacer conversiones innecesarias.\n\nVoy a modificar la función para que:\n1. Tome el valor del campo original directamente\n2. Aplique el descuento de forma simple\n3. Muestre el resultado sin transformaciones complejas","signature":"EosHCkYICxgCKkDaXJKG6tyzHGJVI1PYHi1+DwgUD/EEpZmtxg/2e9a2gCz8Kg4hE+t3uSOblBN/jFsiFQHde4YVkI+/LuFUhf9VEgypOJgkYcm73aNAm9waDFSerc4/R/7qB+GktiIwuNB2uaA4VLwQ9/dY2eAy8IGzjNEicT8rkiIHG3CqQN3gsnOiRcrkhu1IaQ9AZe+VKvIF9GqMGAtAPpF8yD1b7a9RzvrgyhvLxm5WbAOhT8LVpKpef+VQ3F2jT3CyuTBWN/4G61g9vXRoQG7X6Atuh7jN9Y5imq9HCzsv+pE69vLulZqoP1P+kjg3ohNu+Xou7gJX54A/sXOb76fMj9pzS+zCpKPxDilizBxX37fP6TC2Nkhc6JSA7C2bcEUg0Vzi9hNl2+yQuyWz2KRygLm2qHXnYst3vyeDhEe+8V7PvdtmNUjhbjNliZpYgB0P8LzbIWSSP7hj7PQYB8pes7UiHLel4eRGwgJryIkwpiGbF97HnDJayztH8P8W9EmUPQP0hZfFHs1bpX7tdlEfSX3f3k7mlivJVb7FE0mmnlUFA/k9M4ekXniBp1Cxd3qOSp4nJ+r8ji3YCIubtL6cs0kYWRyyOyoLQPI7C154LRwc4D405k+GH3pyb3WHDulH5WCaFzrMbiQXo5IiCTJ/IQBi4GGamURupzclqttmucI3LJWz4m9bc8V/xaAK1PLS+xOSTpKiYwRoEgEUCs7OZ65aoT52gOs0liOfNYJ6vkkOYp7UkVqhk7O6+GdJ1uk8/dhAZQb+eUX32UAs4SNt6/RWIz+xWaQg0VdvAoHPOzfg2Njg6Uh0+b1zJ8eP5PmnFVlxedcVMteBhFHknSbK1v/dSQoqiV2FQPwoJSsZR8UnaNuBf1NC9DfYcfL9vDVpefoHYZ5sDrY2SraaP/WdNqtVjVwdCHmPwUgWnuRipL8F/6lZwRWiGIX0WIjlnGq7odBxmkQomMd9sonWnSQFuHAjZGU4GCwI1XhvXpvzdJHpL5TUSEYKFDa7XTTJFa3C6m/izPY9TH2lPNFk7HZRpv3qVY1ZQI5OEYhE5HwVXtqTZXWumrItmVzgKe+MoHK5Fp/WpjvMZ0NtaKxrXpd/cUp6RXMmmlwjdFNn5Y7Nf3n/byMbjcv1/gut/Ttq4teHxzVbVxAkYIR/DE+SQP/SrlwZflb01+/43ZgrsWoqoG30tG4Wydb8LRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":109286,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":109286,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXWAGs4UjPefFWUFmkpWC","type":"assistant","uuid":"7563b82c-a074-4d15-849b-8cb3a94da23b","timestamp":"2026-01-26T14:38:41.843Z"}
{"parentUuid":"7563b82c-a074-4d15-849b-8cb3a94da23b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_017X7c2HKDy6KHNs1TBjweSj","type":"message","role":"assistant","content":[{"type":"text","text":"Entiendo, quieres simplificar la función para que tome el valor directamente y aplique el descuento sin tantas conversiones."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":109286,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":109286,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXWAGs4UjPefFWUFmkpWC","type":"assistant","uuid":"1cd291d4-3503-48d6-bc7b-e50ec47f84e9","timestamp":"2026-01-26T14:38:42.473Z"}
{"parentUuid":"1cd291d4-3503-48d6-bc7b-e50ec47f84e9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_017X7c2HKDy6KHNs1TBjweSj","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UwgRhVBEYZEa2s7W4xyUwc","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"function aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            //valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}","new_string":"function aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original = $(campo_original).val();\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento directo\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento);\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original);\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":109286,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":109286,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXWAGs4UjPefFWUFmkpWC","type":"assistant","uuid":"671012eb-a5e4-4f62-aca9-f8637757e9a5","timestamp":"2026-01-26T14:38:50.025Z"}
{"parentUuid":"671012eb-a5e4-4f62-aca9-f8637757e9a5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"File has been unexpectedly modified. Read it again before attempting to write it.","is_error":true,"tool_use_id":"toolu_01UwgRhVBEYZEa2s7W4xyUwc"}]},"uuid":"c08122ca-d9f5-42ce-a40f-e282faf2e511","timestamp":"2026-01-26T14:38:59.201Z","toolUseResult":"Error: File has been unexpectedly modified. Read it again before attempting to write it.","sourceToolAssistantUUID":"671012eb-a5e4-4f62-aca9-f8637757e9a5"}
{"parentUuid":"c08122ca-d9f5-42ce-a40f-e282faf2e511","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MF4xzSa51QfoL7xDZL9yye","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El archivo fue modificado. Voy a leerlo de nuevo para ver el estado actual.","signature":"EvMBCkYICxgCKkC7TRe/l0d3c3G9zm67C9wmiuPfdBLvnWyrOI2wsktVFugHxStg9u1dqmLzYk+YsWUPsnM1URyyXECRxEoIMSp6Egy7LDF6OA4nGxjSYrkaDBMBH8Jowg2t/sV3nSIw328mpCn5brgzZE+zIkSkJUVCkScxS4CieM7gs4zFW1c6HQ86ZTiHINFYKJVTthSsKlsW2rgVxN6qEWzw2yduK/slf+y9lFdm+VLVMqPr89nQOl1/HmHixQt/T+vp1Whw+mlZFYTc5ObdJm1RPktsymbYzlxRMsVhdRVTEh2Ud4ZfX7SKvEfkn7gkGngNGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1356,"cache_read_input_tokens":109286,"cache_creation":{"ephemeral_5m_input_tokens":1356,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXWAJhUKsEzt13mLx2C91","type":"assistant","uuid":"1c795899-643c-41c0-b308-aba0f5a1176f","timestamp":"2026-01-26T14:39:02.213Z"}
{"parentUuid":"1c795899-643c-41c0-b308-aba0f5a1176f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MF4xzSa51QfoL7xDZL9yye","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FESLspykzHpyHs3YjaLWLY","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","offset":660,"limit":60}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1356,"cache_read_input_tokens":109286,"cache_creation":{"ephemeral_5m_input_tokens":1356,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXWAJhUKsEzt13mLx2C91","type":"assistant","uuid":"c099e4fc-eb0d-4404-98c9-fee74a90c5d7","timestamp":"2026-01-26T14:39:03.000Z"}
{"parentUuid":"c099e4fc-eb0d-4404-98c9-fee74a90c5d7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FESLspykzHpyHs3YjaLWLY","type":"tool_result","content":"   660→    let valor_creditos_input = $('#precio_creditos_visual').val();\n   661→    if (valor_creditos_input) {\n   662→        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n   663→    }\n   664→\n   665→    let valor_total = valor_plan + valor_creditos;\n   666→\n   667→    // Formatear el valor con separador de miles\n   668→    let valor_formateado = valor_total.toLocaleString('es-CO');\n   669→\n   670→    $('#valor-venta-mostrar').text(valor_formateado);\n   671→}\n   672→\n   673→/**\n   674→ * Aplicar el porcentaje de descuento al valor del plan o créditos.\n   675→ *\n   676→ * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n   677→ * @returns {void}\n   678→ * @author Andres Gonzalez\n   679→ */\n   680→function aplicarDescuento(tipo) {\n   681→    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n   682→    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n   683→    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n   684→\n   685→    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n   686→    let valor_original_str = $(campo_original).val();\n   687→    let valor_original = 0;\n   688→\n   689→    if (valor_original_str) {\n   690→        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n   691→    }\n   692→\n   693→    // Si no hay valor original guardado, tomarlo del campo visual\n   694→    if (valor_original === 0) {\n   695→        let valor_visual = $(campo_visual).val();\n   696→        if (valor_visual) {\n   697→            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n   698→            $(campo_original).val(valor_original);\n   699→        }\n   700→    }\n   701→\n   702→    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n   703→        // Calcular el valor con descuento\n   704→        let descuento = valor_original * (porcentaje / 100);\n   705→        let valor_con_descuento = Math.round(valor_original - descuento);\n   706→\n   707→        // Mostrar el valor con descuento en el campo visual\n   708→        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n   709→\n   710→        // Deshabilitar el campo visual\n   711→        $(campo_visual).prop('disabled', true);\n   712→    } else {\n   713→        // Si no hay descuento, mostrar el valor original y habilitar el campo\n   714→        if (valor_original > 0) {\n   715→            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n   716→        }\n   717→        $(campo_visual).prop('disabled', false);\n   718→    }\n   719→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"da155895-87d3-487e-bf3c-a54c81ae2dc8","timestamp":"2026-01-26T14:39:04.169Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","content":"    let valor_creditos_input = $('#precio_creditos_visual').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Aplicar el porcentaje de descuento al valor del plan o créditos.\n *\n * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n","numLines":60,"startLine":660,"totalLines":1107}},"sourceToolAssistantUUID":"c099e4fc-eb0d-4404-98c9-fee74a90c5d7"}
{"parentUuid":"da155895-87d3-487e-bf3c-a54c81ae2dc8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_014Y11TDD15eFbNQ7SwQU3TX","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Veo que el archivo fue actualizado y ahora tiene la línea 697 descomentada. Ahora voy a modificar la función para simplificarla como el usuario quiere.","signature":"EsICCkYICxgCKkAju8NAfIDpbo90+8cwEaW3Nh5gOB4l4T0sxzD+zVJonsyRmLXaE/EgyqSyxSVyk/3zIwRO8RuZzSX5azhEO1G5EgwixFGTtmCoKn7zItsaDPirugyC9n0lTQs+UiIwUdnqzC2m0QtMO9zsOrib6tBtQMOZzgSwlvJexnGGRJLcKxNBSrl9EXoJbDLaj0lAKqkB8RzXymm1HjyUBYhA/1kYB9AdQnRZKoTeJxTnojIVxtI60HvnH12xZIe4AKZ50kH2TGy/nnDaBASvvKSZWpz8k+IE4C1Z6LsQtcfpyCL31bJEoixDffzaElDkccX0g84Gje28McD9v8ClVkdYWz9lo5c8qsMg2S+BuNz6dD5/Lt1YkOw1BIm7vi5Uh8OwUTgBGKZCx4hopRWSLt2bwWZZAXpx2j1NDc7i2RgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1174,"cache_read_input_tokens":110642,"cache_creation":{"ephemeral_5m_input_tokens":1174,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXWAK47JDCzmF3bNAeZcv","type":"assistant","uuid":"3c0599d3-d582-4b68-ad7b-2b23c2fb4f3d","timestamp":"2026-01-26T14:39:07.467Z"}
{"parentUuid":"3c0599d3-d582-4b68-ad7b-2b23c2fb4f3d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_014Y11TDD15eFbNQ7SwQU3TX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AyEbt76sf44ZKL1SPiZVfb","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"function aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }","new_string":"function aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original = $(campo_original).val();\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento directo\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento);\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original);\n        }\n        $(campo_visual).prop('disabled', false);\n    }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1174,"cache_read_input_tokens":110642,"cache_creation":{"ephemeral_5m_input_tokens":1174,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXWAK47JDCzmF3bNAeZcv","type":"assistant","uuid":"293b30ad-ceee-43f9-abd5-518062c1fc50","timestamp":"2026-01-26T14:39:14.109Z"}
{"parentUuid":"293b30ad-ceee-43f9-abd5-518062c1fc50","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AyEbt76sf44ZKL1SPiZVfb","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   676→ * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n   677→ * @returns {void}\n   678→ * @author Andres Gonzalez\n   679→ */\n   680→function aplicarDescuento(tipo) {\n   681→    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n   682→    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n   683→    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n   684→\n   685→    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n   686→    let valor_original = $(campo_original).val();\n   687→\n   688→    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n   689→        // Calcular el valor con descuento directo\n   690→        let descuento = valor_original * (porcentaje / 100);\n   691→        let valor_con_descuento = Math.round(valor_original - descuento);\n   692→\n   693→        // Mostrar el valor con descuento en el campo visual\n   694→        $(campo_visual).val(valor_con_descuento);\n   695→\n   696→        // Deshabilitar el campo visual\n   697→        $(campo_visual).prop('disabled', true);\n   698→    } else {\n   699→        // Si no hay descuento, mostrar el valor original y habilitar el campo\n   700→        if (valor_original > 0) {\n   701→            $(campo_visual).val(valor_original);\n   702→        }\n   703→        $(campo_visual).prop('disabled', false);\n   704→    }\n   705→\n   706→    // Actualizar el valor total mostrado\n   707→    actualizarValorDesdeInput();\n   708→}"}]},"uuid":"bd791de5-536d-4598-b95d-0ae39807df03","timestamp":"2026-01-26T14:39:21.391Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","oldString":"function aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }","newString":"function aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original = $(campo_original).val();\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento directo\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento);\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original);\n        }\n        $(campo_visual).prop('disabled', false);\n    }","originalFile":"table = null;\nplanes = [];\npruebas = [];\nmodificado = false;\nfuncionalidades_predefinidos = [];\nplan_creditos_seleccionado = null;\n\n$(document).ready(function() {\n    $(document).on('input', '#precio_plan_visual, #precio_creditos_visual', function() {\n        actualizarValorDesdeInput();\n    });\n});\n\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales\n */\nfunction seleccionarTipoPrueba(tipo_prueba_id) {\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"card-body text-center\">\n            <button type=\"button\" id=\"elegir-plan\" class=\"btn btn-outline-primary\" disabled onclick=\"modalElegirPlan();\">Elegir plan</button>\n        </div>\n    `);\n    $('#seccion-pruebas').addClass('d-none');\n    $('#plan_id').val('');\n    pruebas = [];\n    // Convertir tipo_prueba_id a array si no lo es\n    let tipos_prueba = Array.isArray(tipo_prueba_id) ? tipo_prueba_id : [tipo_prueba_id];\n    // Crear los botones según los tipos de prueba seleccionados\n    let botones_html = '<div class=\"card-body text-center\">';\n    tipos_prueba.forEach(function(tipo_id) {\n        let texto_boton = 'Elegir plan';\n        let clase_boton = 'btn-outline-primary';\n        if (tipo_id == 1) {\n            texto_boton = 'Elegir Plan de Selección';\n            clase_boton = 'btn-outline-primary';\n        } else if (tipo_id == 2) {\n            texto_boton = 'Elegir Plan de Créditos IA';\n            clase_boton = 'btn-outline-info';\n        }\n        botones_html += `\n            <button type=\"button\" id=\"elegir-plan-${tipo_id}\" class=\"btn ${clase_boton} mx-1 my-1\" disabled onclick=\"modalElegirPlan(${tipo_id});\">\n                ${texto_boton}\n            </button>\n        `;\n    });\n    botones_html += '</div>';\n    $('#contenedor-plan').append(botones_html);\n    $('#tipo_prueba_id').val(tipo_prueba_id).trigger('select2');\n    if (tipo_prueba_id && (Array.isArray(tipo_prueba_id) ? tipo_prueba_id.length > 0 : tipo_prueba_id)) {\n        // Habilitar todos los botones creados\n        tipos_prueba.forEach(function(tipo_id) {\n            $(`#elegir-plan-${tipo_id}`).prop('disabled', false);\n        });\n        $.ajax({\n            type: 'GET',\n            url : `/pruebas-listado`,\n            data: {\n                tipo_prueba_id: tipo_prueba_id,\n                activo: 1\n            }\n        }).then((respuesta) => {\n            limpiarAdicional();\n            $('#contenedor-pruebas').empty();\n            pruebas = respuesta.data;\n            for (let i = 0; i < pruebas.length; i++) {\n                $('#contenedor-pruebas').append(`\n                    <div class=\"col-12 col-md-6\">\n                        <div class=\"d-flex align-items-center\">\n                            <div class=\"check-container my-1 me-1\">\n                                <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                            </div>\n                            <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                        </div>\n                    </div>\n                `);\n            }\n            if (opcion == 'facturar' || opcion == 'editar') {\n                for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                    $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n                }\n                $('#seccion-pruebas').removeClass('d-none');\n                mostrarPlanSeleccionado();\n            }\n            if (opcion == 'editar') {\n                $('#tipo_prueba_id').prop('disabled', true);\n            }\n        }).catch((error) => {\n            console.error(error);\n        });\n    } else {\n        $('#elegir-plan').prop('disabled', true);\n    }\n}\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction seleccionarTipoPruebaMultiple() {\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    tipos_prueba = tipos_prueba.filter(function(tipo_id) {\n        return tipo_id !== null && tipo_id !== '' && tipo_id !== undefined;\n    });\n    if (tipos_prueba.length === 0) {\n        // Si no hay tipos seleccionados, limpiar todo\n        $('#contenedor-plan').empty();\n        $('#contenedor-creditos').empty();\n        $('#seccion-pruebas').addClass('d-none');\n        $('#plan_id').val('');\n        $('#plan_id').prop('required', false);\n        $('#plan_id').prop('disabled', true);\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n        plan_seleccionado = null;\n        plan_creditos_seleccionado = null;\n        pruebas = [];\n        return;\n    }\n    let tiene_seleccion = tipos_prueba.includes('1') || tipos_prueba.includes(1);\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    $('#plan_id').prop('required', tiene_seleccion);\n    $('#plan_id').prop('disabled', !tiene_seleccion);\n    // Manejo del plan de selección\n    if (tiene_seleccion) {\n        // Si hay un plan seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_seleccionado === null && $('#contenedor-plan').children().length === 0) {\n            let seccion_seleccion = `\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Selección</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-1\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(1);\">\n                            Elegir Plan de Selección\n                        </button>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-plan').html(seccion_seleccion);\n        }\n    } else {\n        // Si se deseleccionó el tipo de selección, limpiar el plan\n        $('#contenedor-plan').empty();\n        plan_seleccionado = null;\n        $('#plan_id').val('');\n    }\n    // Manejo del plan de créditos\n    if (tiene_creditos) {\n        // Si hay un plan de créditos seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n            let seccion_creditos = `\n                <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                    <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                    <div class=\"card rounded rounded-3\">\n                        <div class=\"card-body text-center\">\n                            <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                                Elegir Plan de Créditos IA\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-creditos').html(seccion_creditos);\n        }\n    } else {\n        // Si se deseleccionó el tipo de créditos, limpiar el plan de créditos\n        $('#contenedor-creditos').empty();\n        $('#contenedor-plan-creditos').remove();\n        plan_creditos_seleccionado = null;\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/pruebas-listado`,\n        data: {\n            tipo_prueba_id: tipos_prueba,\n            activo: 1\n        }\n    }).then((respuesta) => {\n        limpiarAdicional();\n        $('#contenedor-pruebas').empty();\n        pruebas = respuesta.data;\n        for (let i = 0; i < pruebas.length; i++) {\n            $('#contenedor-pruebas').append(`\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"d-flex align-items-center\">\n                        <div class=\"check-container my-1 me-1\">\n                            <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                        </div>\n                        <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                    </div>\n                </div>\n            `);\n        }\n        if (opcion == 'facturar' || opcion == 'editar') {\n            for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n            }\n            $('#seccion-pruebas').removeClass('d-none');\n            mostrarPlanSeleccionado();\n        }\n        if (opcion == 'editar') {\n            $('#tipo_prueba_id').prop('disabled', true);\n        }\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    });\n}\n/**\n * Obtener el listado de planes según el tipo_prueba_id seleccionado anteriormente.\n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalElegirPlan(tipo_especifico = null) {\n    let tipo_prueba_para_consulta = tipo_especifico !== null ? tipo_especifico : $('#tipo_prueba_id').val();\n    // Si es tipo 2 (Créditos IA), cargar planes de créditos\n    if (tipo_prueba_para_consulta == 2 || tipo_prueba_para_consulta == '2') {\n        $.ajax({\n            type: 'GET',\n            url: '/planes-creditos',\n            data: {\n                activo: true\n            }\n        }).then((respuesta) => {\n            planes_creditos = respuesta.data.planes;\n            mostrarPlanesCreditos();\n        }).catch((error) => {\n            mostrarToast('danger', 'Ocurrió un error');\n        });\n        return;\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/planes-listado`,\n        data: {\n            tipo_prueba_id: $('#tipo_prueba_id').val()\n        }\n    }).then((respuesta) => {\n        planes = respuesta.data;\n        mostrarPlanes();\n    }).catch((error) => {\n        console.error(error);\n    });\n}\n/**\n * Mostrar los planes de créditos en el modal.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction mostrarPlanesCreditos() {\n    let filtro_orden = $('#filtro-plan-credito').val();\n    let buscar = $('#buscador-plan-credito').val() || '';\n    // Ordenar planes según el filtro\n    let planes_ordenados = [...planes_creditos];\n    if (filtro_orden === 'Mayor') {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else if (filtro_orden === 'Menor') {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    if (buscar !== '') {\n        planes_ordenados = planes_ordenados.filter(plan =>\n            plan.nombre.toLowerCase().includes(buscar.toLowerCase())\n        );\n    }\n    $('#contenedor-planes-creditos').empty();\n    if (planes_ordenados.length === 0) {\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"text-center py-5\">\n                <p class=\"text-muted\">No se encontraron planes</p>\n            </div>\n        `);\n    }\n    for (let i = 0; i < planes_ordenados.length; i++) {\n        let plan = planes_ordenados[i];\n        let creditos_disponibles = plan.creditos_disponibles || plan.creditos || 0;\n        let creditos_promedio = plan.creditos_promedio_accion || 0;\n        let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n            ? Math.floor(creditos_disponibles / creditos_promedio)\n            : 0;\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"card rounded rounded-3 border-hover pointer mb-3\" onclick=\"elegirPlanCreditos(${i}, ${filtro_orden === 'Mayor' ? 'true' : 'false'});\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6 text-gray-10\">${plan.nombre}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        `);\n    }\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('show');\n    }\n    $('#buscador-plan-credito').off('input').on('input', function() {\n        mostrarPlanesCreditos();\n    });\n}\n/**\n * Elegir un plan de créditos IA.\n * @param {number} indice Índice del plan en el array.\n * @param {boolean} orden_mayor Si está ordenado de mayor a menor.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction elegirPlanCreditos(indice, orden_mayor = false) {\n    // Aplicar el mismo ordenamiento que en mostrarPlanesCreditos\n    let planes_ordenados = [...planes_creditos];\n    if (orden_mayor) {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    plan_creditos_seleccionado = planes_ordenados[indice];\n    // Establecer los valores en los campos hidden\n    $('#plan_credito_id').val(plan_creditos_seleccionado.id);\n    $('#creditos').val(plan_creditos_seleccionado.creditos);\n    mostrarPlanCreditosSeleccionado();\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('hide');\n    }\n}\n/**\n * Mostrar el plan de créditos seleccionado en el contenedor.\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarPlanCreditosSeleccionado() {\n    if (!plan_creditos_seleccionado || !plan_creditos_seleccionado.creditos) {\n        mostrarToast('danger', 'Ocurrió un error'+plan_creditos_seleccionado);\n        return;\n    }\n    let creditos_disponibles = plan_creditos_seleccionado.creditos_disponibles || plan_creditos_seleccionado.creditos || 0;\n    let creditos_promedio = plan_creditos_seleccionado.creditos_promedio_accion || 0;\n    let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n        ? Math.floor(creditos_disponibles / creditos_promedio)\n        : 0;\n    let seccion_creditos = `\n        <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n            <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n            <div class=\"card rounded rounded-3\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4 pointer\" onclick=\"modalElegirPlan(2);\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6\">${plan_creditos_seleccionado.nombre || 'Plan de Créditos'}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan_creditos_seleccionado.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    // Remover el contenedor anterior si existe\n    $('#contenedor-plan-creditos').remove();\n    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n    if ($('#contenedor-creditos').length) {\n        $('#contenedor-creditos').html(seccion_creditos);\n    } else {\n        $('#contenedor-plan').after(seccion_creditos);\n    }\n    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }\n    actualizarValorVentaTotal();\n}\n\n/**\n * Mostrar en el modal los planes obtenidos en el listado.\n * \n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPlanes() {\n    let buscar = $('#buscador-plan').val();\n    let filtro_plan = $('#filtro-plan').val();\n    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n        table.destroy();\n    }\n    $('#buscador-plan').remove();\n    $('#tbody-planes').empty();\n    for (let i = 0; i < planes.length; i++) {\n        if (\n            (filtro_plan == 'Todos') ||\n            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n        ) {\n            let cantidad_usuarios = '';\n            if (planes[i].cantidad_usuarios != null) {\n                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n            }\n            let cantidad_ofertas_laborales = '';\n            if (planes[i].cantidad_ofertas_laborales != null) {\n                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n            }\n            let cantidad_pruebas = '';\n            if (planes[i].cantidad_pruebas != null) {\n                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;\n            }\n            let unidades = '';\n            if (planes[i].unidades != null) {\n                unidades = `<div class=\"col-auto w-90px\"><i class=\"bi bi-box\"></i> ${planes[i].unidades}</div>`;\n            }\n            let vigencia = '';\n            if (planes[i].vigencia == 90) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n            } else if (planes[i].vigencia == 180) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n            }  else if (planes[i].vigencia == 365) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n            } else if (planes[i].vigencia == null || planes[i].vigencia == 0) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n            } else {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${planes[i].vigencia} días</div>`;\n            }\n            $('#tbody-planes').append(`\n                <tr>\n                    <td style=\"border-bottom: 0px!important;\">\n                        <div class=\"border border-1 rounded rounded-2 pointer border-hover\" onclick=\"elegirPlan(${i});\">\n                            <div class=\"row m-0 w-100 px-3 py-5 text-headline-6\">\n                                <div class=\"col\">${planes[i].nombre !== null ? planes[i].nombre : ''}</div>\n                                ${cantidad_ofertas_laborales}\n                                ${unidades}\n                                ${cantidad_usuarios}\n                                ${cantidad_pruebas}\n                                ${vigencia}\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            `);\n        }\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('show');\n    }\n    table = $('#tabla-planes').DataTable({\n        \"paging\": false,\n        \"searching\": true,\n        \"ordering\": false,\n        \"info\": false\n    });\n    let buscador = $('#tabla-planes_wrapper input');\n    $(buscador).addClass('rounded-2 text-body-2');\n    $(buscador).prop('placeholder', 'Buscar');\n    $(buscador).prop('id', 'buscador-plan');\n    $('#input-busqueda').append(buscador);\n    $(buscador).val(buscar).trigger('input');\n}\n/**\n * Elegir un plan del listado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction elegirPlan(i) {\n    plan_seleccionado = planes[i];\n    mostrarPlanSeleccionado();\n}\n/**\n * Mostrar el plan seleccionado en el contenedor y en las opciones del modificar.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction mostrarPlanSeleccionado() {\n    let cantidad_usuarios = '';\n    let cantidad_usuarios_modal = $('#cantidad_usuarios_modal').val();\n    if (cantidad_usuarios_modal != '') {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${cantidad_usuarios_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_usuarios != null) {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${plan_seleccionado.cantidad_usuarios}</div>`;\n    }\n    let cantidad_ofertas_laborales = '';\n    let cantidad_ofertas_laborales_modal = $('#cantidad_ofertas_laborales_modal').val();\n    if (cantidad_ofertas_laborales_modal != '') {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${cantidad_ofertas_laborales_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_ofertas_laborales != null) {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${plan_seleccionado.cantidad_ofertas_laborales}</div>`;\n    }\n    let cantidad_pruebas = '';\n    let cantidad_pruebas_modal = $('#cantidad_pruebas_modal').val();\n    if (cantidad_pruebas_modal != '') {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${cantidad_pruebas_modal}</div>`;\n        $('.cantidad-pruebas').text(cantidad_pruebas_modal);\n    } else if (plan_seleccionado.cantidad_pruebas != null) {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${plan_seleccionado.cantidad_pruebas}</div>`;\n        $('.cantidad-pruebas').text(plan_seleccionado.cantidad_pruebas);\n    }\n    let unidades = '';\n    let unidades_modal = $('#unidades_modal').val();\n    if (unidades_modal != '') {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${unidades_modal}</div>`;\n    } else if (plan_seleccionado.unidades != null) {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${plan_seleccionado.unidades}</div>`;\n    }\n    let vigencia = '';\n    let vigencia_modal = $('#vigencia_modal').val();\n    if (plan_seleccionado.vigencia == 90 || vigencia_modal == '90') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n    } else if (plan_seleccionado.vigencia == 180 || vigencia_modal == '180') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n    }  else if (plan_seleccionado.vigencia == 365 || vigencia_modal == '365') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n    } else if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n    } else if (vigencia_modal != '') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${vigencia_modal} días</div>`;\n    } else {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${plan_seleccionado.vigencia} días</div>`;\n    }\n    let abrir_modal_elegir_plan = '';\n    let icono_editar = `\n        <div class=\"col-auto w-90px\">\n            <button type=\"button\" class=\"btn btn-text-primary text-white btn-circle\" onclick=\"abrirModalModificar(event);\" title=\"Modificar plan\">\n                <i class=\"bi bi-wrench\"></i>\n            </button>\n        </div>\n    `;\n    if (opcion == 'asignar') {\n        abrir_modal_elegir_plan = `onclick=\"modalElegirPlan();\"`;\n        icono_editar = '';\n    }\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"row border rounded rounded-3 m-0 w-100 px-3 py-5 text-headline-6 pointer\" ${abrir_modal_elegir_plan}>\n            <div class=\"col\">${plan_seleccionado.nombre !== null ? plan_seleccionado.nombre : ''} <span id=\"plan-modificado\"></span></div>\n            ${cantidad_ofertas_laborales}\n            ${unidades}\n            ${cantidad_usuarios}\n            ${cantidad_pruebas}\n            ${vigencia}\n            ${icono_editar}\n        </div>\n    `);\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    // Solo agregar el botón de elegir plan de créditos si no hay uno seleccionado y se requiere\n    if (tiene_creditos && plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n        let seccion_creditos = `\n            <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                            Elegir Plan de Créditos IA\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n        $('#contenedor-creditos').append(seccion_creditos);\n    }\n    $('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n\n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_plan_original').val(plan_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_plan_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento').val('');\n    }\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}\n\n/**\n * Actualizar el valor de venta total sumando plan de selección y créditos.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorVentaTotal() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n    }\n\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    // Usar los campos visuales para mostrar el total\n    let valor_plan_input = $('#precio_plan_visual').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos_visual').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Aplicar el porcentaje de descuento al valor del plan o créditos.\n *\n * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original_str = $(campo_original).val();\n    let valor_original = 0;\n\n    if (valor_original_str) {\n        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;\n    }\n\n    // Si no hay valor original guardado, tomarlo del campo visual\n    if (valor_original === 0) {\n        let valor_visual = $(campo_visual).val();\n        if (valor_visual) {\n            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;\n            $(campo_original).val(valor_original);\n        }\n    }\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        // Calcular el valor con descuento\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n\n        // Mostrar el valor con descuento en el campo visual\n        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));\n\n        // Deshabilitar el campo visual\n        $(campo_visual).prop('disabled', true);\n    } else {\n        // Si no hay descuento, mostrar el valor original y habilitar el campo\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original.toLocaleString('es-CO'));\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    // Actualizar el valor total mostrado\n    actualizarValorDesdeInput();\n}\n\n/**\n * Abrir la factura del plan en una nueva pestaña del navegador.\n * \n * @param {number} factura_id Id de la factura.\n * @returns {void}\n * @author Andres Morales\n */\nasync function abrirFacturaPlan(factura_id) {\n    if (!factura_id) {\n        mostrarToast('danger', 'No se encontró la factura');\n        return;\n    }\n    try {\n        const respuesta = await $.ajax({\n            type: 'GET',\n            url: `/archivos-abrir/${factura_id}`,\n            xhrFields: { responseType: 'blob' }\n        });\n        const blobUrl = window.URL.createObjectURL(respuesta);\n        window.open(blobUrl, '_blank');\n    } catch (error) {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    }\n}\n/**\n * Buscar las funcionalidades por tipo de prueba.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidades(tipo_prueba_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/funcionalidades-listado`,\n        data : {\n            tipo_prueba_id: tipo_prueba_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let beneficios = respuesta.data;\n            const ADICIONALES = beneficios\n                .filter(item => item.predeterminado === 0)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            const PREDEFINIDOS = beneficios\n                .filter(item => item.predeterminado === 1)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            funcionalidades_predefinidos = PREDEFINIDOS;\n            // Verificar si el multiselect está inicializado antes de destruir\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect('destroy');\n            }\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect('destroy');\n            }\n            ADICIONALES.forEach((item) => {\n                $('#adicionales_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            PREDEFINIDOS.forEach((item) => {\n                $('#predefinidos_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            inizializarMultiselect();\n            if (opcion == 'facturar' || opcion == 'editar') {\n                buscarfuncionalidadesPlanEmpresa($('#id').val());\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Buscar las funcionalidades del plan de la empresa.\n * @param {number} empresa_plan_id ID del plan de empresa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidadesPlanEmpresa(empresa_plan_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/empresas-planes-funcionalidades-listado`,\n        data : {\n            empresa_plan_id: empresa_plan_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let funcionalidades = respuesta.data.map(item => item.funcionalidad_id);\n            $('#adicionales_modal').val(funcionalidades);\n            // Verificar si el multiselect está inicializado antes de refrescar\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect(\"refresh\");\n            }\n            $('#predefinidos_modal').val(funcionalidades);\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect(\"refresh\");\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Función para agregar validaciones adicionales y data adicional en el envío del form.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction validacionAdicional() {\n    let valido = true;\n    let es_solo_creditos = plan_seleccionado === null && plan_creditos_seleccionado !== null;\n    $('#vigencia').val($('#vigencia_modal').val());\n    if ($('#unidades_modal').val() == 'Ilimitadas') {\n        $('#unidades').val('');\n    } else {\n        $('#unidades').val($('#unidades_modal').val());\n    }\n    if ($('#cantidad_ofertas_laborales_modal').val() == 'Ilimitadas') {\n        $('#cantidad_ofertas_laborales').val('');\n    } else {\n        $('#cantidad_ofertas_laborales').val($('#cantidad_ofertas_laborales_modal').val());\n    }\n    $('#cantidad_usuarios').val($('#cantidad_usuarios_modal').val());\n    $('#cantidad_pruebas').val($('#cantidad_pruebas_modal').val());\n    if (opcion == 'facturar' || opcion == 'editar') {\n        let adicionales = $('#adicionales_modal').val();\n        let predefinidos = $('#predefinidos_modal').val();\n        let funcionalidades = adicionales.concat(predefinidos);\n        $('#funcionalidades').val(JSON.stringify(funcionalidades));\n        if (!es_solo_creditos && funcionalidades.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una funcionalidad.');\n        }\n    } else {\n        let ids = [];\n        if (plan_seleccionado && Array.isArray(plan_seleccionado.funcionalidades)) {\n            ids = plan_seleccionado.funcionalidades.map(objeto => objeto.id);\n        }\n        $('#funcionalidades').val(JSON.stringify(ids));\n    }\n    var pruebas_seleccionadas = $('.pruebas:checked').map(function() {\n        return this.value;\n    }).get();\n    $('#pruebas').val('');\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado ? plan_seleccionado.cantidad_pruebas : 0;\n    }\n    if (!es_solo_creditos) {\n        if (pruebas_seleccionadas.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una prueba.');\n        } else if (pruebas_seleccionadas.length > maximo_pruebas) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione maximo ' + maximo_pruebas + ' pruebas.');\n        }\n    }\n    if (valido) {\n        $('#pruebas').val(JSON.stringify(pruebas_seleccionadas));\n    }\n    return valido;\n}\n/**\n * Función para validar que no se exceda al seleccionar limite de pruebas.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction ValidarPruebas() {\n    let cantidad_seleccionadas = $('.pruebas:checked').length;\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado.cantidad_pruebas;\n    }\n    if (cantidad_seleccionadas > maximo_pruebas) {\n        $('#alerta-pruebas').removeClass('d-none');\n    } else {\n        $('#alerta-pruebas').addClass('d-none');\n    }\n}\n/**\n * Abrir el modal con los campos para modificar plan.\n * @param {Event} evento Evento desencadenado.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalModificar(evento) {\n    evento.stopPropagation();\n    if (modificado == false) {\n        $('#nombre-plan-modal').text(plan_seleccionado.nombre);\n        $('#cantidad_pruebas_modal').empty();\n        $('#cantidad_pruebas_modal').append(`\n            <option value=\"\">Seleccione</option>\n        `);\n        for (let j = 1; j <= pruebas.length; j++) {\n            $('#cantidad_pruebas_modal').append(`\n                <option value=\"${j}\">${j} Pruebas</option>\n            `);\n        }\n        $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n        if ([90, 180, 365].includes(plan_seleccionado.vigencia)) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val(plan_seleccionado.vigencia).trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else if (plan_seleccionado.vigencia != null && plan_seleccionado.vigencia != 0) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val('personalizado').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else {\n            $('#tiempo_modal').prop('disabled', true);\n            $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val('');\n        }\n        if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n            $('#unidades_modal').val(plan_seleccionado.unidades);\n            $('#unidades_modal').prop('disabled', false);\n            if (opcion == 'asignar') {\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa_plan.cantidad_ofertas_laborales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', false);\n        } else {\n            $('#unidades_modal').val(empresa.procesos_estimados_mensuales);\n            $('#unidades_modal').prop('disabled', true);\n            if (opcion == 'facturar' || opcion == 'editar') {\n                $('#unidades_modal').val(plan_seleccionado.unidades);\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa.pruebas_estimadas_mensuales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', true);\n        }\n        $('#cantidad_usuarios_modal').val(plan_seleccionado.cantidad_usuarios);\n        if (opcion == 'facturar' || opcion == 'editar') {\n            $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n            buscarfuncionalidadesPlanEmpresa($('#id').val());\n        }\n        $('#boton-guardar-modificaciones').prop('disabled', true);\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('show');\n    }\n}\n/**\n * Función que habilita el boton de guardar un plan modificado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction habilitarBotonGuardar() {\n    $('#boton-guardar-modificaciones').prop('disabled', false);\n}\n/**\n * Función que controla los campos de vigencia en el modal de editar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarTiempo(vigencia) {\n    $('.texto-label-tiempo').text('máximas permitidas');\n    $('#input-container-tiempo').removeClass('d-none');\n    $('#input-container-tiempo').addClass('col-md-6');\n    if (vigencia == 'personalizado') {\n        $('#input-container-vigencia').removeClass('d-none');\n        $('#vigencia_modal').val('');\n    } else if ((vigencia == '' || vigencia == null || vigencia == 0) && plan_seleccionado != null && (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0)) {\n        $('.texto-label-tiempo').text('');\n        $('#input-container-tiempo').addClass('d-none');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val('');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    } else if (['90', '180', '365'].includes(vigencia)) {\n        $('#input-container-tiempo').removeClass('col-md-6');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val(vigencia);\n    } else {\n        $('#vigencia_modal').val(vigencia);\n        $('#input-container-vigencia').addClass('d-none');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    }\n}\n/**\n * Abrir el modal de confirmación.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalEstasSeguro() {\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('hide');\n        $('#modal-estas-seguro').modal('show');\n    }\n}\n/**\n * Cancelar la edición de un plan.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction cancelarEdicion() {\n    modificado = false;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    limpiarAdicional();\n    mostrarPlanSeleccionado();\n}\n/**\n * Confirmar los datos editados.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction confirmarEdicion() {\n    modificado = true;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    $('#plan-modificado').text('(modificado)');\n    mostrarPlanSeleccionado();\n}\n/**\n * Limpiar los campos del modal.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction limpiarAdicional() {\n    $('#cantidad_pruebas_modal').val('').trigger('change').trigger('select2:select');\n    $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n    $('#unidades_modal').val('');\n    $('#cantidad_ofertas_laborales_modal').val('');\n    $('#cantidad_usuarios_modal').val('');\n    // Verificar si el multiselect está inicializado antes de llamar uncheckAll\n    if ($('#adicionales_modal').data('multiselect')) {\n        $('#adicionales_modal').multiselect(\"uncheckAll\");\n    }\n    if ($('#predefinidos_modal').data('multiselect')) {\n        $('#predefinidos_modal').multiselect(\"uncheckAll\");\n    }\n}\n/**\n * Función para ejecutar acciones luego de guardar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction postSuccess(respuesta) {\n    limpiarFormulario(respuesta.formulario);\n    if (opcion == 'asignar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se asignó con éxito a la empresa`,\n        }));\n    } else if (opcion == 'facturar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se facturó con éxito`,\n        }));\n    } else if (opcion == 'editar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se actualizó con éxito`,\n        }));\n    }\n    window.location.href='/empresas-gestionar/' + empresa.id;\n}\n\n/**\n * Agregar o modificar datos de la petición.\n *\n * @param {FormData} datos_formulario Datos del formulario.\n * @returns {Promise<Array>}\n * @author Andres Gonzalez\n */\nfunction agregarDataForm(datos_formulario) {\n    datos_formulario.delete('undefined');\n    return datos_formulario;\n}\n","structuredPatch":[{"oldStart":683,"oldLines":36,"newStart":683,"newLines":22,"lines":["     let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';"," ","     let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;","-    let valor_original_str = $(campo_original).val();","-    let valor_original = 0;","+    let valor_original = $(campo_original).val();"," ","-    if (valor_original_str) {","-        valor_original = parseFloat(valor_original_str.toString().replace(/[^\\d]/g, '')) || 0;","-    }","-","-    // Si no hay valor original guardado, tomarlo del campo visual","-    if (valor_original === 0) {","-        let valor_visual = $(campo_visual).val();","-        if (valor_visual) {","-            valor_original = parseFloat(valor_visual.toString().replace(/[^\\d]/g, '')) || 0;","-            $(campo_original).val(valor_original);","-        }","-    }","-","     if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {","-        // Calcular el valor con descuento","+        // Calcular el valor con descuento directo","         let descuento = valor_original * (porcentaje / 100);","         let valor_con_descuento = Math.round(valor_original - descuento);"," ","         // Mostrar el valor con descuento en el campo visual","-        $(campo_visual).val(valor_con_descuento.toLocaleString('es-CO'));","+        $(campo_visual).val(valor_con_descuento);"," ","         // Deshabilitar el campo visual","         $(campo_visual).prop('disabled', true);","     } else {","         // Si no hay descuento, mostrar el valor original y habilitar el campo","         if (valor_original > 0) {","-            $(campo_visual).val(valor_original.toLocaleString('es-CO'));","+            $(campo_visual).val(valor_original);","         }","         $(campo_visual).prop('disabled', false);","     }"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"293b30ad-ceee-43f9-abd5-518062c1fc50"}
{"parentUuid":"bd791de5-536d-4598-b95d-0ae39807df03","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NMqS6wq4U61AeTxyfceByg","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El diagnóstico es solo un \"Hint\" del IDE, no un error real. La variable `plan_creditos_seleccionado` está declarada globalmente al inicio del archivo en la línea 6.\n\nLa función está simplificada ahora. El usuario puede probarla.","signature":"EpADCkYICxgCKkDAg4it1AhHgHgdrzP16lrLaPWOQr8zFHRVC1fwN/39cnCSte6/jzDU2MNbNTKBiTj6PgN47d2IF1qzJrY6j6bbEgz3U/WkkZpL8zAgikgaDLUVlKnmkSm9+/HYGiIwgg4GIidBl2FvaTjr4PTQPqgySX3o7aqvg1jSf0KRY0I7ba3svZUOPiJui2pUYKhLKvcBgeJnUstTuyKjW/HoABBBw8LiznwqjVwYjmwltmwt6XPkuLZvWmiga5VT3j0C2bE+rwQ3JlIHz9BWQp+/GpDnmQen60qKQfbx6a+0QVBg/ItYEUgrgYq5x0O+12UQi71LDms+g4sAw3g7Fb/QiwMJxSMoqxx/PvZGi7tjaizdgqcRlBhqI2W1vIcVRRHk4a6dZ80gAB4QoA5PWs/WgjSMfEEchjvscZOCRZq3eBg795tOtRkqodlMj8IerE8MiGm2txuBs1D7s00fy30lH3k3pemdt5IJxVnY+Cy2MZJM4GYQup39UOmP/+k3zpC5RCRO9Nnq7np7qhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1833,"cache_read_input_tokens":111816,"cache_creation":{"ephemeral_5m_input_tokens":1833,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXWALPSuux6iJrnEBEdR3","type":"assistant","uuid":"6b86dda0-03ac-473e-9f25-9e4875087ee6","timestamp":"2026-01-26T14:39:26.340Z"}
{"parentUuid":"6b86dda0-03ac-473e-9f25-9e4875087ee6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NMqS6wq4U61AeTxyfceByg","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. La función ahora está simplificada:\n\n- Toma el valor original directo del campo hidden\n- Aplica el descuento sin conversiones\n- Muestra el valor con descuento directamente en el campo visual\n\nPrueba ahora para ver si funciona correctamente."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1833,"cache_read_input_tokens":111816,"cache_creation":{"ephemeral_5m_input_tokens":1833,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXWALPSuux6iJrnEBEdR3","type":"assistant","uuid":"38d9a4b1-67b7-4bac-92fb-a90029f5d66f","timestamp":"2026-01-26T14:39:27.744Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-26T14:42:26.219Z","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287"}
{"type":"file-history-snapshot","messageId":"24b455f9-bcdc-4f34-b461-21e07eb5968a","snapshot":{"messageId":"24b455f9-bcdc-4f34-b461-21e07eb5968a","trackedFileBackups":{"resources\\views\\empresas\\paginas\\asignar-plan.blade.php":{"backupFileName":"23a0b404d58f48f6@v5","version":5,"backupTime":"2026-01-26T14:38:34.296Z"},"public\\js\\empresas\\asignar-plan.js":{"backupFileName":"25fa1d462d51e622@v7","version":7,"backupTime":"2026-01-26T14:42:26.848Z"}},"timestamp":"2026-01-26T14:42:26.845Z"},"isSnapshotUpdate":false}
{"parentUuid":"671012eb-a5e4-4f62-aca9-f8637757e9a5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01UwgRhVBEYZEa2s7W4xyUwc","parentToolUseID":"toolu_01UwgRhVBEYZEa2s7W4xyUwc","uuid":"e29fa88a-b1d6-4c1f-82d1-f0fa0f840830","timestamp":"2026-01-26T14:38:50.178Z"}
{"parentUuid":"e29fa88a-b1d6-4c1f-82d1-f0fa0f840830","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01UwgRhVBEYZEa2s7W4xyUwc","parentToolUseID":"toolu_01UwgRhVBEYZEa2s7W4xyUwc","uuid":"c6dea68b-7001-404f-b24e-74633936f8d7","timestamp":"2026-01-26T14:38:50.179Z"}
{"parentUuid":"c099e4fc-eb0d-4404-98c9-fee74a90c5d7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01FESLspykzHpyHs3YjaLWLY","parentToolUseID":"toolu_01FESLspykzHpyHs3YjaLWLY","uuid":"5e71023a-c115-4bc9-bd1e-cf9d97beaf3a","timestamp":"2026-01-26T14:39:03.124Z"}
{"parentUuid":"293b30ad-ceee-43f9-abd5-518062c1fc50","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01AyEbt76sf44ZKL1SPiZVfb","parentToolUseID":"toolu_01AyEbt76sf44ZKL1SPiZVfb","uuid":"3daf5b25-f0dc-4209-b274-b8474ce97297","timestamp":"2026-01-26T14:39:14.255Z"}
{"parentUuid":"3daf5b25-f0dc-4209-b274-b8474ce97297","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01AyEbt76sf44ZKL1SPiZVfb","parentToolUseID":"toolu_01AyEbt76sf44ZKL1SPiZVfb","uuid":"76b1d178-6032-4f92-bf1d-0b480fbdd5e9","timestamp":"2026-01-26T14:39:14.255Z"}
{"parentUuid":"bd791de5-536d-4598-b95d-0ae39807df03","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01AyEbt76sf44ZKL1SPiZVfb","toolUseID":"toolu_01AyEbt76sf44ZKL1SPiZVfb","timestamp":"2026-01-26T14:39:21.392Z","uuid":"27280d88-ba2d-425c-9b86-875a4c61efab"}
{"parentUuid":"38d9a4b1-67b7-4bac-92fb-a90029f5d66f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"listo entonces hay otro problema y es que cuando selciono iun plan de creditos y se coloca el valor automatico en el campo de de valor venta en crdito quirto que hagas lo mismo quitale .00 y que se el valor directo"}]},"uuid":"24b455f9-bcdc-4f34-b461-21e07eb5968a","timestamp":"2026-01-26T14:42:26.842Z","permissionMode":"default"}
{"parentUuid":"24b455f9-bcdc-4f34-b461-21e07eb5968a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01X5WgYedKBQHnMKdtHQXTjm","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que cuando se selecciona un plan de créditos y se coloca el valor automáticamente en el campo de valor de venta, se quite el \".00\" y se muestre el valor directo sin decimales.\n\nEsto sucede en la función `mostrarPlanCreditosSeleccionado()` donde se establece el valor del campo visual. Necesito buscar esa función y modificar cómo se establece el valor para que no tenga decimales.\n\nVoy a buscar la función `mostrarPlanCreditosSeleccionado()` y también `mostrarPlanSeleccionado()` para hacer el mismo cambio en ambas.","signature":"EsYFCkYICxgCKkA5ITGWMU9UoxWHz2+xkYpDuXOSM9eYU6o6EBQEZFwfnXbOuMG1waqMSHW0czTdp1szrd9jeZYZE+LOVo+IkIFtEgycASXeIZJSjyu01TgaDNy24MGr/F2wAVSCUSIw1JKKc0+wzqQ91v4OWdC88or+Yifjf/DMi4ezirgMljAgpkyMilzWUCFbZ+WB11xpKq0E1N6OqxijgdzHQfTdE9yCAEolYS/HvfEggWMYh9Nzkc78QSuBVzvMLCyZDcnNjhJZ9A+QsbnVzHxkrpweyc5xX+g9+Q/EJ4WLP14CxoOOxmp7RYAXtvEupbzEifS9hO8tDUfez72n1Hs1ZeaPy6D3ZqLkG62aLHAuWlvN2MEX6rU7cytIEcWaR5n6XzR1hX//eXQngqwVmzJZCfnITM64jIJ/Ct3WU/LciOPVg72AKmZfIAdYLwq+CGiJeLaF2Bq3gBWBSB3Qabfa1fgz5/vBFVvtOaC9lAjqm+AxyILNAjFmNBHiN24cAMFiSqH3JKKgJS5oUtvD8F2edTaSzdsDa9orQJZXBRaeFYKCqvW0EPXyYOHwGK+l7QqHmLAyaB1ipzI2xVI20W1sweH71UGJ0HQGqfQDspYyHLhdwCEXyvomFVT/YX4xT1kBNFWI7RAlo1gU55Dt8jCRXkLWqe53xtPG60wFsvw5yEoqPgwygjJ2QdPYSIwgUpLmo0XhBhwMiZtsUoQJOCJRX9v3q7H+pvSDEEdG+sZU6BKn2Pyla9nddl6n2WXHpLLMk+IKG8FgLIyUdOBtGX8WLeNh5+3cau+tWwwGMI16raRRj2F+ul+h+FaPq6rSvqJn5vxItcvMqzqrwXB1D7BCrnCoBNaewss01MytDaoGiz1numU6O7qFJx0IFxXDo6+Val8rlW5GqIKbIoza+dYKPOq79KEIO4ph9uG6sfaUBR5nneUYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4826,"cache_read_input_tokens":112897,"cache_creation":{"ephemeral_5m_input_tokens":4826,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXWAZzeMdMjDdVqBZkEBD","type":"assistant","uuid":"653ca956-6002-477c-87c2-09c26830b683","timestamp":"2026-01-26T14:42:32.021Z"}
{"parentUuid":"653ca956-6002-477c-87c2-09c26830b683","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01X5WgYedKBQHnMKdtHQXTjm","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a modificar las funciones que establecen el valor del precio para quitar los decimales."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4826,"cache_read_input_tokens":112897,"cache_creation":{"ephemeral_5m_input_tokens":4826,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXWAZzeMdMjDdVqBZkEBD","type":"assistant","uuid":"467334f9-75d6-48bb-8882-385e05ec8653","timestamp":"2026-01-26T14:42:32.642Z"}
{"parentUuid":"467334f9-75d6-48bb-8882-385e05ec8653","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01X5WgYedKBQHnMKdtHQXTjm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JPTvkPcaN8AKK36imp7hRz","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","offset":385,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4826,"cache_read_input_tokens":112897,"cache_creation":{"ephemeral_5m_input_tokens":4826,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXWAZzeMdMjDdVqBZkEBD","type":"assistant","uuid":"5f63483a-f03c-4465-a288-f6e1209feb42","timestamp":"2026-01-26T14:42:33.494Z"}
{"parentUuid":"5f63483a-f03c-4465-a288-f6e1209feb42","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JPTvkPcaN8AKK36imp7hRz","type":"tool_result","content":"   385→    } else {\n   386→        $('#contenedor-plan').after(seccion_creditos);\n   387→    }\n   388→    // Mostrar campos de precio para plan de créditos\n   389→    $('#contenedor-precio-creditos').removeClass('d-none');\n   390→    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n   391→        // Guardar el valor original en el campo hidden\n   392→        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n   393→        // Mostrar el valor en el campo visual\n   394→        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n   395→        // Habilitar el campo visual inicialmente\n   396→        $('#precio_creditos_visual').prop('disabled', false);\n   397→        // Limpiar el porcentaje de descuento\n   398→        $('#porcentaje_descuento_creditos').val('');\n   399→    }\n   400→    actualizarValorVentaTotal();\n   401→}\n   402→\n   403→/**\n   404→ * Mostrar en el modal los planes obtenidos en el listado.\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"49159f28-645c-4454-9f57-6c83c5c5a285","timestamp":"2026-01-26T14:42:34.698Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","content":"    } else {\n        $('#contenedor-plan').after(seccion_creditos);\n    }\n    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }\n    actualizarValorVentaTotal();\n}\n\n/**\n * Mostrar en el modal los planes obtenidos en el listado.","numLines":20,"startLine":385,"totalLines":1086}},"sourceToolAssistantUUID":"5f63483a-f03c-4465-a288-f6e1209feb42"}
{"parentUuid":"49159f28-645c-4454-9f57-6c83c5c5a285","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RDns67egHGuVMqzxYobh9Q","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Veo que en la línea 392 y 394 se usa `plan_creditos_seleccionado.precio` directamente. Necesito convertirlo a entero para quitar los decimales. Voy a usar `Math.round()` o `parseInt()` para quitar los decimales.\n\nTambién necesito hacer lo mismo para el plan de selección en la función `mostrarPlanSeleccionado()`.","signature":"EuYDCkYICxgCKkCGsQ2Iiaat0wCzYHC1CVpyqXCtxQNZUDy4Zbp/fkbDceNvrLw4J6tlBe0n7/5sdo1+2wyoV8Mmg6pjQhq+1LOTEgw/CUX3umlvqZYJj4EaDJdnfTOaiGwALfN5NCIwvmjVrESDhb7Fz3ZvFkpq2QmObrzI3uEnZ2NOiTXXenm5+X30stu76vNHB68xnsKRKs0ClaOB+oJprKhIqxSsdk6kXlMJmtb3J+pae8bC/hBNMSdsADkzQJ4o9HGoMhI6NGgMQQWo57CHOF4+Hk6th1r4Ct+6x/ro/XHU9J60edWxdgCibJjN89S6Fwygzp2BcNgHnmttkgHI/8T1pMi+G1MSrOHFB89DFKVAijxfCtORRVxc7Fyl+f1qFBJXN2KR8Vf2HNMXd/k5eNsfQx6MxLtt0j0O2NLO4/1MG4Z9NfY4UIQBF0ixFd4MRcuxn2g0Ygd0NcDlS3ALPzN7+/Qf7xdMwmL01JprnDseOGfzYNw160n5EphkZAWSrpAlpQHZmQANW5nGZ2QFHVBWc1ipYCPqKInf2bFtipor96y4V1iYk0coveF5Bq8FOuMDTQ1CRJrLWhqq88wnPG768tSxsvZkxnJKhDFCZKXux4R+3KdS02QGB9rqCGZwCB6fs3TAGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":824,"cache_read_input_tokens":117723,"cache_creation":{"ephemeral_5m_input_tokens":824,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXWAaaGvXKVWb2Rca1YQ6","type":"assistant","uuid":"aaae9226-91de-4347-8385-add63e545436","timestamp":"2026-01-26T14:42:38.633Z"}
{"parentUuid":"aaae9226-91de-4347-8385-add63e545436","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RDns67egHGuVMqzxYobh9Q","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GVssatzSpRcySwAsuZspx6","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"// Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }","new_string":"// Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden (sin decimales)\n        let precio_creditos = Math.round(plan_creditos_seleccionado.precio);\n        $('#precio_creditos_original').val(precio_creditos);\n        // Mostrar el valor en el campo visual (sin decimales)\n        $('#precio_creditos_visual').val(precio_creditos).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":824,"cache_read_input_tokens":117723,"cache_creation":{"ephemeral_5m_input_tokens":824,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXWAaaGvXKVWb2Rca1YQ6","type":"assistant","uuid":"d69905f6-c743-4f90-ae94-b1d995878ae8","timestamp":"2026-01-26T14:42:42.737Z"}
{"parentUuid":"d69905f6-c743-4f90-ae94-b1d995878ae8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). The user provided the following reason for the rejection:  y quitake lo de round","is_error":true,"tool_use_id":"toolu_01GVssatzSpRcySwAsuZspx6"}]},"uuid":"7c1befe7-e4a4-4e70-ac20-3d2fbe50e0ce","timestamp":"2026-01-26T14:43:05.086Z","toolUseResult":"Error: The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). The user provided the following reason for the rejection:  y quitake lo de round","sourceToolAssistantUUID":"d69905f6-c743-4f90-ae94-b1d995878ae8"}
{"parentUuid":"7c1befe7-e4a4-4e70-ac20-3d2fbe50e0ce","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KSRZNha8miZAZwaA54XJ8n","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario no quiere usar Math.round(). Quiere que simplemente use parseInt() o que quite los decimales de otra forma. Voy a usar parseInt() para convertir a entero directamente.","signature":"EtsCCkYICxgCKkAcoSkZphxMsCs0jSnp2vxEd4wcIr5eByd+VpK+a/xbMXwGJZynwLlL7ts1xtLMGg0/MBWv0tpRleQ/XoP+LiVNEgxEYfjdG29j5OOrAaAaDEvxy0xugOPTJ/wmxiIw4EnFIQlJIk1qDfcq6EiIR3ctpAdNp4HTszBPfKtKNAcgcQO/cQslmSjF7lsEMIw3KsIB2OAv+OoYTQu0gAUy0puSOLXJ1n1uUkd4zidG6gKZgvpc8obojQnLXnQ6gzq39ViQ9VlfY2hDhey0zEc2xX+BZy9Feelle2clfnLsgCReL28rZ0hMP/GbFW0GwpfU6ox0hsMjBGQm8A+vUgegiEKv1yFtkIjzr+W4bW6tIT4WHFQNwnEMiy3MyewjbmWaiWpHIr/ttiuxl8s9oGAxCjMzMxDrktVI/Tc6Aqg7Eef9J1puYXqQqeOKWya/fMQ53zpGiX8YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":740,"cache_read_input_tokens":118547,"cache_creation":{"ephemeral_5m_input_tokens":740,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXWAcpm82BtcFWgqV4Rdw","type":"assistant","uuid":"86878280-eb7f-4168-a275-28e74340c9e1","timestamp":"2026-01-26T14:43:08.668Z"}
{"parentUuid":"86878280-eb7f-4168-a275-28e74340c9e1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KSRZNha8miZAZwaA54XJ8n","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019NAuktdGXxSKiHNbS31HS4","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"// Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }","new_string":"// Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden (sin decimales)\n        let precio_creditos = parseInt(plan_creditos_seleccionado.precio);\n        $('#precio_creditos_original').val(precio_creditos);\n        // Mostrar el valor en el campo visual (sin decimales)\n        $('#precio_creditos_visual').val(precio_creditos).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":740,"cache_read_input_tokens":118547,"cache_creation":{"ephemeral_5m_input_tokens":740,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXWAcpm82BtcFWgqV4Rdw","type":"assistant","uuid":"145fb444-4105-4d37-872e-727148953342","timestamp":"2026-01-26T14:43:12.179Z"}
{"parentUuid":"145fb444-4105-4d37-872e-727148953342","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019NAuktdGXxSKiHNbS31HS4","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   384→        $('#contenedor-creditos').html(seccion_creditos);\n   385→    } else {\n   386→        $('#contenedor-plan').after(seccion_creditos);\n   387→    }\n   388→    // Mostrar campos de precio para plan de créditos\n   389→    $('#contenedor-precio-creditos').removeClass('d-none');\n   390→    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n   391→        // Guardar el valor original en el campo hidden (sin decimales)\n   392→        let precio_creditos = parseInt(plan_creditos_seleccionado.precio);\n   393→        $('#precio_creditos_original').val(precio_creditos);\n   394→        // Mostrar el valor en el campo visual (sin decimales)\n   395→        $('#precio_creditos_visual').val(precio_creditos).trigger('input');\n   396→        // Habilitar el campo visual inicialmente\n   397→        $('#precio_creditos_visual').prop('disabled', false);\n   398→        // Limpiar el porcentaje de descuento\n   399→        $('#porcentaje_descuento_creditos').val('');\n   400→    }\n   401→    actualizarValorVentaTotal();\n   402→}\n   403→\n   404→/**"}]},"uuid":"4f145e75-9ba9-4993-b95b-93d5f81ebd77","timestamp":"2026-01-26T14:43:20.800Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","oldString":"// Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }","newString":"// Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden (sin decimales)\n        let precio_creditos = parseInt(plan_creditos_seleccionado.precio);\n        $('#precio_creditos_original').val(precio_creditos);\n        // Mostrar el valor en el campo visual (sin decimales)\n        $('#precio_creditos_visual').val(precio_creditos).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }","originalFile":"table = null;\nplanes = [];\npruebas = [];\nmodificado = false;\nfuncionalidades_predefinidos = [];\nplan_creditos_seleccionado = null;\n\n$(document).ready(function() {\n    $(document).on('input', '#precio_plan_visual, #precio_creditos_visual', function() {\n        actualizarValorDesdeInput();\n    });\n});\n\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Morales\n */\nfunction seleccionarTipoPrueba(tipo_prueba_id) {\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"card-body text-center\">\n            <button type=\"button\" id=\"elegir-plan\" class=\"btn btn-outline-primary\" disabled onclick=\"modalElegirPlan();\">Elegir plan</button>\n        </div>\n    `);\n    $('#seccion-pruebas').addClass('d-none');\n    $('#plan_id').val('');\n    pruebas = [];\n    // Convertir tipo_prueba_id a array si no lo es\n    let tipos_prueba = Array.isArray(tipo_prueba_id) ? tipo_prueba_id : [tipo_prueba_id];\n    // Crear los botones según los tipos de prueba seleccionados\n    let botones_html = '<div class=\"card-body text-center\">';\n    tipos_prueba.forEach(function(tipo_id) {\n        let texto_boton = 'Elegir plan';\n        let clase_boton = 'btn-outline-primary';\n        if (tipo_id == 1) {\n            texto_boton = 'Elegir Plan de Selección';\n            clase_boton = 'btn-outline-primary';\n        } else if (tipo_id == 2) {\n            texto_boton = 'Elegir Plan de Créditos IA';\n            clase_boton = 'btn-outline-info';\n        }\n        botones_html += `\n            <button type=\"button\" id=\"elegir-plan-${tipo_id}\" class=\"btn ${clase_boton} mx-1 my-1\" disabled onclick=\"modalElegirPlan(${tipo_id});\">\n                ${texto_boton}\n            </button>\n        `;\n    });\n    botones_html += '</div>';\n    $('#contenedor-plan').append(botones_html);\n    $('#tipo_prueba_id').val(tipo_prueba_id).trigger('select2');\n    if (tipo_prueba_id && (Array.isArray(tipo_prueba_id) ? tipo_prueba_id.length > 0 : tipo_prueba_id)) {\n        // Habilitar todos los botones creados\n        tipos_prueba.forEach(function(tipo_id) {\n            $(`#elegir-plan-${tipo_id}`).prop('disabled', false);\n        });\n        $.ajax({\n            type: 'GET',\n            url : `/pruebas-listado`,\n            data: {\n                tipo_prueba_id: tipo_prueba_id,\n                activo: 1\n            }\n        }).then((respuesta) => {\n            limpiarAdicional();\n            $('#contenedor-pruebas').empty();\n            pruebas = respuesta.data;\n            for (let i = 0; i < pruebas.length; i++) {\n                $('#contenedor-pruebas').append(`\n                    <div class=\"col-12 col-md-6\">\n                        <div class=\"d-flex align-items-center\">\n                            <div class=\"check-container my-1 me-1\">\n                                <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                            </div>\n                            <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                        </div>\n                    </div>\n                `);\n            }\n            if (opcion == 'facturar' || opcion == 'editar') {\n                for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                    $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n                }\n                $('#seccion-pruebas').removeClass('d-none');\n                mostrarPlanSeleccionado();\n            }\n            if (opcion == 'editar') {\n                $('#tipo_prueba_id').prop('disabled', true);\n            }\n        }).catch((error) => {\n            console.error(error);\n        });\n    } else {\n        $('#elegir-plan').prop('disabled', true);\n    }\n}\n/**\n * Establecer el tipo de prueba en el selector del formulario.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction seleccionarTipoPruebaMultiple() {\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    tipos_prueba = tipos_prueba.filter(function(tipo_id) {\n        return tipo_id !== null && tipo_id !== '' && tipo_id !== undefined;\n    });\n    if (tipos_prueba.length === 0) {\n        // Si no hay tipos seleccionados, limpiar todo\n        $('#contenedor-plan').empty();\n        $('#contenedor-creditos').empty();\n        $('#seccion-pruebas').addClass('d-none');\n        $('#plan_id').val('');\n        $('#plan_id').prop('required', false);\n        $('#plan_id').prop('disabled', true);\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n        plan_seleccionado = null;\n        plan_creditos_seleccionado = null;\n        pruebas = [];\n        return;\n    }\n    let tiene_seleccion = tipos_prueba.includes('1') || tipos_prueba.includes(1);\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    $('#plan_id').prop('required', tiene_seleccion);\n    $('#plan_id').prop('disabled', !tiene_seleccion);\n    // Manejo del plan de selección\n    if (tiene_seleccion) {\n        // Si hay un plan seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_seleccionado === null && $('#contenedor-plan').children().length === 0) {\n            let seccion_seleccion = `\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Selección</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-1\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(1);\">\n                            Elegir Plan de Selección\n                        </button>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-plan').html(seccion_seleccion);\n        }\n    } else {\n        // Si se deseleccionó el tipo de selección, limpiar el plan\n        $('#contenedor-plan').empty();\n        plan_seleccionado = null;\n        $('#plan_id').val('');\n    }\n    // Manejo del plan de créditos\n    if (tiene_creditos) {\n        // Si hay un plan de créditos seleccionado, mantenerlo; si no, mostrar el botón\n        if (plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n            let seccion_creditos = `\n                <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                    <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                    <div class=\"card rounded rounded-3\">\n                        <div class=\"card-body text-center\">\n                            <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                                Elegir Plan de Créditos IA\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n            $('#contenedor-creditos').html(seccion_creditos);\n        }\n    } else {\n        // Si se deseleccionó el tipo de créditos, limpiar el plan de créditos\n        $('#contenedor-creditos').empty();\n        $('#contenedor-plan-creditos').remove();\n        plan_creditos_seleccionado = null;\n        $('#plan_credito_id').val('');\n        $('#creditos').val('');\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/pruebas-listado`,\n        data: {\n            tipo_prueba_id: tipos_prueba,\n            activo: 1\n        }\n    }).then((respuesta) => {\n        limpiarAdicional();\n        $('#contenedor-pruebas').empty();\n        pruebas = respuesta.data;\n        for (let i = 0; i < pruebas.length; i++) {\n            $('#contenedor-pruebas').append(`\n                <div class=\"col-12 col-md-6\">\n                    <div class=\"d-flex align-items-center\">\n                        <div class=\"check-container my-1 me-1\">\n                            <input type=\"checkbox\" id=\"prueba-${pruebas[i].id}\" name=\"prueba-${pruebas[i].id}\" value=\"${pruebas[i].id}\" class=\"form-check-input input-dinamico pruebas\" onchange=\"ValidarPruebas();\">\n                        </div>\n                        <label class=\"text-label-1\" for=\"prueba-${pruebas[i].id}\">${pruebas[i].nombre}</label>\n                    </div>\n                </div>\n            `);\n        }\n        if (opcion == 'facturar' || opcion == 'editar') {\n            for (let i = 0; i < pruebas_empresa_plan.length; i++) {\n                $(`#prueba-${pruebas_empresa_plan[i].id}`).prop('checked', true);\n            }\n            $('#seccion-pruebas').removeClass('d-none');\n            mostrarPlanSeleccionado();\n        }\n        if (opcion == 'editar') {\n            $('#tipo_prueba_id').prop('disabled', true);\n        }\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    });\n}\n/**\n * Obtener el listado de planes según el tipo_prueba_id seleccionado anteriormente.\n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalElegirPlan(tipo_especifico = null) {\n    let tipo_prueba_para_consulta = tipo_especifico !== null ? tipo_especifico : $('#tipo_prueba_id').val();\n    // Si es tipo 2 (Créditos IA), cargar planes de créditos\n    if (tipo_prueba_para_consulta == 2 || tipo_prueba_para_consulta == '2') {\n        $.ajax({\n            type: 'GET',\n            url: '/planes-creditos',\n            data: {\n                activo: true\n            }\n        }).then((respuesta) => {\n            planes_creditos = respuesta.data.planes;\n            mostrarPlanesCreditos();\n        }).catch((error) => {\n            mostrarToast('danger', 'Ocurrió un error');\n        });\n        return;\n    }\n    $.ajax({\n        type: 'GET',\n        url : `/planes-listado`,\n        data: {\n            tipo_prueba_id: $('#tipo_prueba_id').val()\n        }\n    }).then((respuesta) => {\n        planes = respuesta.data;\n        mostrarPlanes();\n    }).catch((error) => {\n        console.error(error);\n    });\n}\n/**\n * Mostrar los planes de créditos en el modal.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction mostrarPlanesCreditos() {\n    let filtro_orden = $('#filtro-plan-credito').val();\n    let buscar = $('#buscador-plan-credito').val() || '';\n    // Ordenar planes según el filtro\n    let planes_ordenados = [...planes_creditos];\n    if (filtro_orden === 'Mayor') {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else if (filtro_orden === 'Menor') {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    if (buscar !== '') {\n        planes_ordenados = planes_ordenados.filter(plan =>\n            plan.nombre.toLowerCase().includes(buscar.toLowerCase())\n        );\n    }\n    $('#contenedor-planes-creditos').empty();\n    if (planes_ordenados.length === 0) {\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"text-center py-5\">\n                <p class=\"text-muted\">No se encontraron planes</p>\n            </div>\n        `);\n    }\n    for (let i = 0; i < planes_ordenados.length; i++) {\n        let plan = planes_ordenados[i];\n        let creditos_disponibles = plan.creditos_disponibles || plan.creditos || 0;\n        let creditos_promedio = plan.creditos_promedio_accion || 0;\n        let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n            ? Math.floor(creditos_disponibles / creditos_promedio)\n            : 0;\n        $('#contenedor-planes-creditos').append(`\n            <div class=\"card rounded rounded-3 border-hover pointer mb-3\" onclick=\"elegirPlanCreditos(${i}, ${filtro_orden === 'Mayor' ? 'true' : 'false'});\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6 text-gray-10\">${plan.nombre}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        `);\n    }\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('show');\n    }\n    $('#buscador-plan-credito').off('input').on('input', function() {\n        mostrarPlanesCreditos();\n    });\n}\n/**\n * Elegir un plan de créditos IA.\n * @param {number} indice Índice del plan en el array.\n * @param {boolean} orden_mayor Si está ordenado de mayor a menor.\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction elegirPlanCreditos(indice, orden_mayor = false) {\n    // Aplicar el mismo ordenamiento que en mostrarPlanesCreditos\n    let planes_ordenados = [...planes_creditos];\n    if (orden_mayor) {\n        planes_ordenados.sort((a, b) => b.creditos - a.creditos);\n    } else {\n        planes_ordenados.sort((a, b) => a.creditos - b.creditos);\n    }\n    plan_creditos_seleccionado = planes_ordenados[indice];\n    // Establecer los valores en los campos hidden\n    $('#plan_credito_id').val(plan_creditos_seleccionado.id);\n    $('#creditos').val(plan_creditos_seleccionado.creditos);\n    mostrarPlanCreditosSeleccionado();\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes-creditos').modal('hide');\n    }\n}\n/**\n * Mostrar el plan de créditos seleccionado en el contenedor.\n * @returns {void}\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarPlanCreditosSeleccionado() {\n    if (!plan_creditos_seleccionado || !plan_creditos_seleccionado.creditos) {\n        mostrarToast('danger', 'Ocurrió un error'+plan_creditos_seleccionado);\n        return;\n    }\n    let creditos_disponibles = plan_creditos_seleccionado.creditos_disponibles || plan_creditos_seleccionado.creditos || 0;\n    let creditos_promedio = plan_creditos_seleccionado.creditos_promedio_accion || 0;\n    let acciones_estimadas = creditos_disponibles > 0 && creditos_promedio > 0\n        ? Math.floor(creditos_disponibles / creditos_promedio)\n        : 0;\n    let seccion_creditos = `\n        <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n            <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n            <div class=\"card rounded rounded-3\">\n                <div class=\"row align-items-center m-0 w-100 px-3 py-4 pointer\" onclick=\"modalElegirPlan(2);\">\n                    <div class=\"col\">\n                        <div class=\"text-headline-6\">${plan_creditos_seleccionado.nombre || 'Plan de Créditos'}</div>\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearTag({\n                            texto: 'Créditos disponibles: ' + plan_creditos_seleccionado.creditos.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                    <div class=\"col-auto text-primary fw-bold\">\n                        ${crearTag({\n                            texto: 'Acciones estimadas: ' + acciones_estimadas.toLocaleString('es-CO'),\n                            class: 'tag-tonal-yellow',\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n    // Remover el contenedor anterior si existe\n    $('#contenedor-plan-creditos').remove();\n    // Agregar después del contenedor-plan o dentro de contenedor-creditos\n    if ($('#contenedor-creditos').length) {\n        $('#contenedor-creditos').html(seccion_creditos);\n    } else {\n        $('#contenedor-plan').after(seccion_creditos);\n    }\n    // Mostrar campos de precio para plan de créditos\n    $('#contenedor-precio-creditos').removeClass('d-none');\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_creditos_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento_creditos').val('');\n    }\n    actualizarValorVentaTotal();\n}\n\n/**\n * Mostrar en el modal los planes obtenidos en el listado.\n * \n * @param {number|null} tipo_especifico ID del tipo de prueba específico (opcional).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPlanes() {\n    let buscar = $('#buscador-plan').val();\n    let filtro_plan = $('#filtro-plan').val();\n    if ($.fn.DataTable.isDataTable('#tabla-planes')) {\n        table.destroy();\n    }\n    $('#buscador-plan').remove();\n    $('#tbody-planes').empty();\n    for (let i = 0; i < planes.length; i++) {\n        if (\n            (filtro_plan == 'Todos') ||\n            (filtro_plan == 'Ofertas' && planes[i].cantidad_ofertas_laborales != null) ||\n            (filtro_plan == 'Unidades' && planes[i].unidades != null) ||\n            (filtro_plan == 'Tiempo' && planes[i].vigencia != null)\n        ) {\n            let cantidad_usuarios = '';\n            if (planes[i].cantidad_usuarios != null) {\n                cantidad_usuarios = `<div class=\"col-auto w-90px\"><i class=\"bi bi-person\"></i> ${planes[i].cantidad_usuarios}</div>`;\n            }\n            let cantidad_ofertas_laborales = '';\n            if (planes[i].cantidad_ofertas_laborales != null) {\n                cantidad_ofertas_laborales = `<div class=\"col-auto w-90px\"><i class=\"bi bi-briefcase\"></i> ${planes[i].cantidad_ofertas_laborales}</div>`;\n            }\n            let cantidad_pruebas = '';\n            if (planes[i].cantidad_pruebas != null) {\n                cantidad_pruebas = `<div class=\"col-auto w-90px\"><i class=\"bi bi-clipboard2-check\"></i> ${planes[i].cantidad_pruebas}</div>`;\n            }\n            let unidades = '';\n            if (planes[i].unidades != null) {\n                unidades = `<div class=\"col-auto w-90px\"><i class=\"bi bi-box\"></i> ${planes[i].unidades}</div>`;\n            }\n            let vigencia = '';\n            if (planes[i].vigencia == 90) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n            } else if (planes[i].vigencia == 180) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n            }  else if (planes[i].vigencia == 365) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n            } else if (planes[i].vigencia == null || planes[i].vigencia == 0) {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n            } else {\n                vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${planes[i].vigencia} días</div>`;\n            }\n            $('#tbody-planes').append(`\n                <tr>\n                    <td style=\"border-bottom: 0px!important;\">\n                        <div class=\"border border-1 rounded rounded-2 pointer border-hover\" onclick=\"elegirPlan(${i});\">\n                            <div class=\"row m-0 w-100 px-3 py-5 text-headline-6\">\n                                <div class=\"col\">${planes[i].nombre !== null ? planes[i].nombre : ''}</div>\n                                ${cantidad_ofertas_laborales}\n                                ${unidades}\n                                ${cantidad_usuarios}\n                                ${cantidad_pruebas}\n                                ${vigencia}\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            `);\n        }\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('show');\n    }\n    table = $('#tabla-planes').DataTable({\n        \"paging\": false,\n        \"searching\": true,\n        \"ordering\": false,\n        \"info\": false\n    });\n    let buscador = $('#tabla-planes_wrapper input');\n    $(buscador).addClass('rounded-2 text-body-2');\n    $(buscador).prop('placeholder', 'Buscar');\n    $(buscador).prop('id', 'buscador-plan');\n    $('#input-busqueda').append(buscador);\n    $(buscador).val(buscar).trigger('input');\n}\n/**\n * Elegir un plan del listado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction elegirPlan(i) {\n    plan_seleccionado = planes[i];\n    mostrarPlanSeleccionado();\n}\n/**\n * Mostrar el plan seleccionado en el contenedor y en las opciones del modificar.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction mostrarPlanSeleccionado() {\n    let cantidad_usuarios = '';\n    let cantidad_usuarios_modal = $('#cantidad_usuarios_modal').val();\n    if (cantidad_usuarios_modal != '') {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${cantidad_usuarios_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_usuarios != null) {\n        cantidad_usuarios = `<div class=\"col-auto\"><i class=\"bi bi-person\"></i> ${plan_seleccionado.cantidad_usuarios}</div>`;\n    }\n    let cantidad_ofertas_laborales = '';\n    let cantidad_ofertas_laborales_modal = $('#cantidad_ofertas_laborales_modal').val();\n    if (cantidad_ofertas_laborales_modal != '') {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${cantidad_ofertas_laborales_modal}</div>`;\n    } else if (plan_seleccionado.cantidad_ofertas_laborales != null) {\n        cantidad_ofertas_laborales = `<div class=\"col-auto\"><i class=\"bi bi-briefcase\"></i> ${plan_seleccionado.cantidad_ofertas_laborales}</div>`;\n    }\n    let cantidad_pruebas = '';\n    let cantidad_pruebas_modal = $('#cantidad_pruebas_modal').val();\n    if (cantidad_pruebas_modal != '') {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${cantidad_pruebas_modal}</div>`;\n        $('.cantidad-pruebas').text(cantidad_pruebas_modal);\n    } else if (plan_seleccionado.cantidad_pruebas != null) {\n        cantidad_pruebas = `<div class=\"col-auto\"><i class=\"bi bi-clipboard2-check\"></i> ${plan_seleccionado.cantidad_pruebas}</div>`;\n        $('.cantidad-pruebas').text(plan_seleccionado.cantidad_pruebas);\n    }\n    let unidades = '';\n    let unidades_modal = $('#unidades_modal').val();\n    if (unidades_modal != '') {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${unidades_modal}</div>`;\n    } else if (plan_seleccionado.unidades != null) {\n        unidades = `<div class=\"col-auto\"><i class=\"bi bi-box\"></i> ${plan_seleccionado.unidades}</div>`;\n    }\n    let vigencia = '';\n    let vigencia_modal = $('#vigencia_modal').val();\n    if (plan_seleccionado.vigencia == 90 || vigencia_modal == '90') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 3 Meses</div>`;\n    } else if (plan_seleccionado.vigencia == 180 || vigencia_modal == '180') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 6 Meses</div>`;\n    }  else if (plan_seleccionado.vigencia == 365 || vigencia_modal == '365') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> 1 Año</div>`;\n    } else if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> Ilimitado</div>`;\n    } else if (vigencia_modal != '') {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${vigencia_modal} días</div>`;\n    } else {\n        vigencia = `<div class=\"col-auto w-120px\"><i class=\"bi bi-clock\"></i> ${plan_seleccionado.vigencia} días</div>`;\n    }\n    let abrir_modal_elegir_plan = '';\n    let icono_editar = `\n        <div class=\"col-auto w-90px\">\n            <button type=\"button\" class=\"btn btn-text-primary text-white btn-circle\" onclick=\"abrirModalModificar(event);\" title=\"Modificar plan\">\n                <i class=\"bi bi-wrench\"></i>\n            </button>\n        </div>\n    `;\n    if (opcion == 'asignar') {\n        abrir_modal_elegir_plan = `onclick=\"modalElegirPlan();\"`;\n        icono_editar = '';\n    }\n    $('#contenedor-plan').empty();\n    $('#contenedor-plan').append(`\n        <div class=\"row border rounded rounded-3 m-0 w-100 px-3 py-5 text-headline-6 pointer\" ${abrir_modal_elegir_plan}>\n            <div class=\"col\">${plan_seleccionado.nombre !== null ? plan_seleccionado.nombre : ''} <span id=\"plan-modificado\"></span></div>\n            ${cantidad_ofertas_laborales}\n            ${unidades}\n            ${cantidad_usuarios}\n            ${cantidad_pruebas}\n            ${vigencia}\n            ${icono_editar}\n        </div>\n    `);\n    let tipos_prueba = $('#tipo_prueba_id').val() || [];\n    let tiene_creditos = tipos_prueba.includes('2') || tipos_prueba.includes(2);\n    // Solo agregar el botón de elegir plan de créditos si no hay uno seleccionado y se requiere\n    if (tiene_creditos && plan_creditos_seleccionado === null && $('#contenedor-plan-creditos').length === 0) {\n        let seccion_creditos = `\n            <div class=\"mt-3\" id=\"contenedor-plan-creditos\">\n                <p class=\"text-headline-4 text-gray-10 mb-2\">Plan de Créditos IA</p>\n                <div class=\"card rounded rounded-3\">\n                    <div class=\"card-body text-center\">\n                        <button type=\"button\" id=\"elegir-plan-2\" class=\"btn btn-outline-primary mx-1 my-1\" onclick=\"modalElegirPlan(2);\">\n                            Elegir Plan de Créditos IA\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n        $('#contenedor-creditos').append(seccion_creditos);\n    }\n    $('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n\n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_plan_original').val(plan_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_plan_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento').val('');\n    }\n\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-planes').modal('hide');\n    }\n    ValidarPruebas();\n    $('#boton-guardar-modificaciones').prop('disabled', true);\n    actualizarValorVentaTotal();\n}\n\n/**\n * Actualizar el valor de venta total sumando plan de selección y créditos.\n * \n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorVentaTotal() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        valor_plan = parseFloat(plan_seleccionado.precio) || 0;\n    }\n\n    if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {\n        valor_creditos = parseFloat(plan_creditos_seleccionado.precio) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Actualizar el valor de venta total desde los inputs cuando se modifican manualmente.\n *\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction actualizarValorDesdeInput() {\n    let valor_plan = 0;\n    let valor_creditos = 0;\n\n    // Usar los campos visuales para mostrar el total\n    let valor_plan_input = $('#precio_plan_visual').val();\n    if (valor_plan_input) {\n        valor_plan = parseFloat(valor_plan_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_creditos_input = $('#precio_creditos_visual').val();\n    if (valor_creditos_input) {\n        valor_creditos = parseFloat(valor_creditos_input.replace(/[^\\d]/g, '')) || 0;\n    }\n\n    let valor_total = valor_plan + valor_creditos;\n\n    // Formatear el valor con separador de miles\n    let valor_formateado = valor_total.toLocaleString('es-CO');\n\n    $('#valor-venta-mostrar').text(valor_formateado);\n}\n\n/**\n * Aplicar el porcentaje de descuento al valor del plan o créditos.\n *\n * @param {string} tipo - Tipo de plan: \"plan\" o \"creditos\"\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction aplicarDescuento(tipo) {\n    let campo_porcentaje = tipo === 'plan' ? '#porcentaje_descuento' : '#porcentaje_descuento_creditos';\n    let campo_original = tipo === 'plan' ? '#precio_plan_original' : '#precio_creditos_original';\n    let campo_visual = tipo === 'plan' ? '#precio_plan_visual' : '#precio_creditos_visual';\n\n    let porcentaje = parseFloat($(campo_porcentaje).val()) || 0;\n    let valor_original = $(campo_original).val();\n\n    if (porcentaje > 0 && porcentaje <= 100 && valor_original > 0) {\n        let descuento = valor_original * (porcentaje / 100);\n        let valor_con_descuento = Math.round(valor_original - descuento);\n        $(campo_visual).val(valor_con_descuento);\n        $(campo_visual).prop('disabled', true);\n    } else {\n        if (valor_original > 0) {\n            $(campo_visual).val(valor_original);\n        }\n        $(campo_visual).prop('disabled', false);\n    }\n\n    actualizarValorDesdeInput();\n}\n\n/**\n * Abrir la factura del plan en una nueva pestaña del navegador.\n * \n * @param {number} factura_id Id de la factura.\n * @returns {void}\n * @author Andres Morales\n */\nasync function abrirFacturaPlan(factura_id) {\n    if (!factura_id) {\n        mostrarToast('danger', 'No se encontró la factura');\n        return;\n    }\n    try {\n        const respuesta = await $.ajax({\n            type: 'GET',\n            url: `/archivos-abrir/${factura_id}`,\n            xhrFields: { responseType: 'blob' }\n        });\n        const blobUrl = window.URL.createObjectURL(respuesta);\n        window.open(blobUrl, '_blank');\n    } catch (error) {\n        mostrarToast('danger', 'Ocurrió un error al intentar abrir la factura');\n    }\n}\n/**\n * Buscar las funcionalidades por tipo de prueba.\n * @param {number} tipo_prueba_id ID del tipo de prueba.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidades(tipo_prueba_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/funcionalidades-listado`,\n        data : {\n            tipo_prueba_id: tipo_prueba_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let beneficios = respuesta.data;\n            const ADICIONALES = beneficios\n                .filter(item => item.predeterminado === 0)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            const PREDEFINIDOS = beneficios\n                .filter(item => item.predeterminado === 1)\n                .map(({ id, nombre, predeterminado }) => ({ id, nombre, predeterminado }))\n                .sort((a, b) => b.id - a.id);\n            funcionalidades_predefinidos = PREDEFINIDOS;\n            // Verificar si el multiselect está inicializado antes de destruir\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect('destroy');\n            }\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect('destroy');\n            }\n            ADICIONALES.forEach((item) => {\n                $('#adicionales_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            PREDEFINIDOS.forEach((item) => {\n                $('#predefinidos_modal').append(`<option value=\"${item.id}\">${item.nombre}</option>`);\n            });\n            inizializarMultiselect();\n            if (opcion == 'facturar' || opcion == 'editar') {\n                buscarfuncionalidadesPlanEmpresa($('#id').val());\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Buscar las funcionalidades del plan de la empresa.\n * @param {number} empresa_plan_id ID del plan de empresa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction buscarfuncionalidadesPlanEmpresa(empresa_plan_id) {\n    $.ajax({\n        type : 'GET',\n        url : `/empresas-planes-funcionalidades-listado`,\n        data : {\n            empresa_plan_id: empresa_plan_id,\n            incluir_tipo_prueba_null: true\n        },\n        success: function(respuesta) {\n            let funcionalidades = respuesta.data.map(item => item.funcionalidad_id);\n            $('#adicionales_modal').val(funcionalidades);\n            // Verificar si el multiselect está inicializado antes de refrescar\n            if ($('#adicionales_modal').data('multiselect')) {\n                $('#adicionales_modal').multiselect(\"refresh\");\n            }\n            $('#predefinidos_modal').val(funcionalidades);\n            if ($('#predefinidos_modal').data('multiselect')) {\n                $('#predefinidos_modal').multiselect(\"refresh\");\n            }\n        },\n        error: function(error) {\n            console.log(error);\n        }\n    });\n}\n/**\n * Función para agregar validaciones adicionales y data adicional en el envío del form.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction validacionAdicional() {\n    let valido = true;\n    let es_solo_creditos = plan_seleccionado === null && plan_creditos_seleccionado !== null;\n    $('#vigencia').val($('#vigencia_modal').val());\n    if ($('#unidades_modal').val() == 'Ilimitadas') {\n        $('#unidades').val('');\n    } else {\n        $('#unidades').val($('#unidades_modal').val());\n    }\n    if ($('#cantidad_ofertas_laborales_modal').val() == 'Ilimitadas') {\n        $('#cantidad_ofertas_laborales').val('');\n    } else {\n        $('#cantidad_ofertas_laborales').val($('#cantidad_ofertas_laborales_modal').val());\n    }\n    $('#cantidad_usuarios').val($('#cantidad_usuarios_modal').val());\n    $('#cantidad_pruebas').val($('#cantidad_pruebas_modal').val());\n    if (opcion == 'facturar' || opcion == 'editar') {\n        let adicionales = $('#adicionales_modal').val();\n        let predefinidos = $('#predefinidos_modal').val();\n        let funcionalidades = adicionales.concat(predefinidos);\n        $('#funcionalidades').val(JSON.stringify(funcionalidades));\n        if (!es_solo_creditos && funcionalidades.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una funcionalidad.');\n        }\n    } else {\n        let ids = [];\n        if (plan_seleccionado && Array.isArray(plan_seleccionado.funcionalidades)) {\n            ids = plan_seleccionado.funcionalidades.map(objeto => objeto.id);\n        }\n        $('#funcionalidades').val(JSON.stringify(ids));\n    }\n    var pruebas_seleccionadas = $('.pruebas:checked').map(function() {\n        return this.value;\n    }).get();\n    $('#pruebas').val('');\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado ? plan_seleccionado.cantidad_pruebas : 0;\n    }\n    if (!es_solo_creditos) {\n        if (pruebas_seleccionadas.length == 0) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione al menos una prueba.');\n        } else if (pruebas_seleccionadas.length > maximo_pruebas) {\n            valido = false;\n            mostrarToast('danger', 'Seleccione maximo ' + maximo_pruebas + ' pruebas.');\n        }\n    }\n    if (valido) {\n        $('#pruebas').val(JSON.stringify(pruebas_seleccionadas));\n    }\n    return valido;\n}\n/**\n * Función para validar que no se exceda al seleccionar limite de pruebas.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction ValidarPruebas() {\n    let cantidad_seleccionadas = $('.pruebas:checked').length;\n    let maximo_pruebas = $('#cantidad_pruebas_modal').val();\n    if (maximo_pruebas == '') {\n        maximo_pruebas = plan_seleccionado.cantidad_pruebas;\n    }\n    if (cantidad_seleccionadas > maximo_pruebas) {\n        $('#alerta-pruebas').removeClass('d-none');\n    } else {\n        $('#alerta-pruebas').addClass('d-none');\n    }\n}\n/**\n * Abrir el modal con los campos para modificar plan.\n * @param {Event} evento Evento desencadenado.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalModificar(evento) {\n    evento.stopPropagation();\n    if (modificado == false) {\n        $('#nombre-plan-modal').text(plan_seleccionado.nombre);\n        $('#cantidad_pruebas_modal').empty();\n        $('#cantidad_pruebas_modal').append(`\n            <option value=\"\">Seleccione</option>\n        `);\n        for (let j = 1; j <= pruebas.length; j++) {\n            $('#cantidad_pruebas_modal').append(`\n                <option value=\"${j}\">${j} Pruebas</option>\n            `);\n        }\n        $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n        if ([90, 180, 365].includes(plan_seleccionado.vigencia)) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val(plan_seleccionado.vigencia).trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else if (plan_seleccionado.vigencia != null && plan_seleccionado.vigencia != 0) {\n            $('#tiempo_modal').prop('disabled', false);\n            $('#tiempo_modal').val('personalizado').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val(plan_seleccionado.vigencia);\n        } else {\n            $('#tiempo_modal').prop('disabled', true);\n            $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n            $('#vigencia_modal').val('');\n        }\n        if (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0) {\n            $('#unidades_modal').val(plan_seleccionado.unidades);\n            $('#unidades_modal').prop('disabled', false);\n            if (opcion == 'asignar') {\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa_plan.cantidad_ofertas_laborales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', false);\n        } else {\n            $('#unidades_modal').val(empresa.procesos_estimados_mensuales);\n            $('#unidades_modal').prop('disabled', true);\n            if (opcion == 'facturar' || opcion == 'editar') {\n                $('#unidades_modal').val(plan_seleccionado.unidades);\n                $('#cantidad_ofertas_laborales_modal').val(plan_seleccionado.cantidad_ofertas_laborales);\n            } else {\n                $('#cantidad_ofertas_laborales_modal').val(empresa.pruebas_estimadas_mensuales);\n            }\n            $('#cantidad_ofertas_laborales_modal').prop('disabled', true);\n        }\n        $('#cantidad_usuarios_modal').val(plan_seleccionado.cantidad_usuarios);\n        if (opcion == 'facturar' || opcion == 'editar') {\n            $('#cantidad_pruebas_modal').val(plan_seleccionado.cantidad_pruebas).trigger('change').trigger('select2:select');\n            buscarfuncionalidadesPlanEmpresa($('#id').val());\n        }\n        $('#boton-guardar-modificaciones').prop('disabled', true);\n    }\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('show');\n    }\n}\n/**\n * Función que habilita el boton de guardar un plan modificado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction habilitarBotonGuardar() {\n    $('#boton-guardar-modificaciones').prop('disabled', false);\n}\n/**\n * Función que controla los campos de vigencia en el modal de editar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarTiempo(vigencia) {\n    $('.texto-label-tiempo').text('máximas permitidas');\n    $('#input-container-tiempo').removeClass('d-none');\n    $('#input-container-tiempo').addClass('col-md-6');\n    if (vigencia == 'personalizado') {\n        $('#input-container-vigencia').removeClass('d-none');\n        $('#vigencia_modal').val('');\n    } else if ((vigencia == '' || vigencia == null || vigencia == 0) && plan_seleccionado != null && (plan_seleccionado.vigencia == null || plan_seleccionado.vigencia == 0)) {\n        $('.texto-label-tiempo').text('');\n        $('#input-container-tiempo').addClass('d-none');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val('');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    } else if (['90', '180', '365'].includes(vigencia)) {\n        $('#input-container-tiempo').removeClass('col-md-6');\n        $('#input-container-vigencia').addClass('d-none');\n        $('#vigencia_modal').val(vigencia);\n    } else {\n        $('#vigencia_modal').val(vigencia);\n        $('#input-container-vigencia').addClass('d-none');\n        $('#input-container-tiempo').removeClass('col-md-6');\n    }\n}\n/**\n * Abrir el modal de confirmación.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction abrirModalEstasSeguro() {\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-modificar-planes').modal('hide');\n        $('#modal-estas-seguro').modal('show');\n    }\n}\n/**\n * Cancelar la edición de un plan.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction cancelarEdicion() {\n    modificado = false;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    limpiarAdicional();\n    mostrarPlanSeleccionado();\n}\n/**\n * Confirmar los datos editados.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction confirmarEdicion() {\n    modificado = true;\n    // Verificar si Bootstrap modal está disponible antes de usar\n    if (typeof $.fn.modal !== 'undefined') {\n        $('#modal-estas-seguro').modal('hide');\n    }\n    $('#plan-modificado').text('(modificado)');\n    mostrarPlanSeleccionado();\n}\n/**\n * Limpiar los campos del modal.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction limpiarAdicional() {\n    $('#cantidad_pruebas_modal').val('').trigger('change').trigger('select2:select');\n    $('#tiempo_modal').val('').trigger('change').trigger('select2:select');\n    $('#unidades_modal').val('');\n    $('#cantidad_ofertas_laborales_modal').val('');\n    $('#cantidad_usuarios_modal').val('');\n    // Verificar si el multiselect está inicializado antes de llamar uncheckAll\n    if ($('#adicionales_modal').data('multiselect')) {\n        $('#adicionales_modal').multiselect(\"uncheckAll\");\n    }\n    if ($('#predefinidos_modal').data('multiselect')) {\n        $('#predefinidos_modal').multiselect(\"uncheckAll\");\n    }\n}\n/**\n * Función para ejecutar acciones luego de guardar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction postSuccess(respuesta) {\n    limpiarFormulario(respuesta.formulario);\n    if (opcion == 'asignar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se asignó con éxito a la empresa`,\n        }));\n    } else if (opcion == 'facturar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se facturó con éxito`,\n        }));\n    } else if (opcion == 'editar') {\n        localStorage.setItem('notificacionToast', JSON.stringify({\n            tipo_alerta: 'success',\n            texto_1: `El plan se actualizó con éxito`,\n        }));\n    }\n    window.location.href='/empresas-gestionar/' + empresa.id;\n}\n\n/**\n * Agregar o modificar datos de la petición.\n *\n * @param {FormData} datos_formulario Datos del formulario.\n * @returns {Promise<Array>}\n * @author Andres Gonzalez\n */\nfunction agregarDataForm(datos_formulario) {\n    datos_formulario.delete('undefined');\n    return datos_formulario;\n}\n","structuredPatch":[{"oldStart":388,"oldLines":10,"newStart":388,"newLines":11,"lines":["     // Mostrar campos de precio para plan de créditos","     $('#contenedor-precio-creditos').removeClass('d-none');","     if (plan_creditos_seleccionado && plan_creditos_seleccionado.precio) {","-        // Guardar el valor original en el campo hidden","-        $('#precio_creditos_original').val(plan_creditos_seleccionado.precio);","-        // Mostrar el valor en el campo visual","-        $('#precio_creditos_visual').val(plan_creditos_seleccionado.precio).trigger('input');","+        // Guardar el valor original en el campo hidden (sin decimales)","+        let precio_creditos = parseInt(plan_creditos_seleccionado.precio);","+        $('#precio_creditos_original').val(precio_creditos);","+        // Mostrar el valor en el campo visual (sin decimales)","+        $('#precio_creditos_visual').val(precio_creditos).trigger('input');","         // Habilitar el campo visual inicialmente","         $('#precio_creditos_visual').prop('disabled', false);","         // Limpiar el porcentaje de descuento"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"145fb444-4105-4d37-872e-727148953342"}
{"parentUuid":"4f145e75-9ba9-4993-b95b-93d5f81ebd77","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_018j73cFqf5HRjaGodMZJPVv","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora debo hacer lo mismo para el plan de selección en la función `mostrarPlanSeleccionado()`.","signature":"EogCCkYICxgCKkBhVueVaQxzV2uiAYzSDbXmKzxwp0oJnKOpDBkdQGCx2xnZiCURvf3HKit/8uumwCjR434v9G1SU6G39bD0prlBEgzwi0YBjfShD/ConQkaDFzKuTQppOKlxYMsbyIw031+sG8PTCS8xjtlsswkKj/aZ5trZNPyww7KTDBx4B7Z6kfJH+3wJKRUrhkJr47RKnCqQ6AvH5MWyaenCZCdGn/bZ5iSH55Vd8FXSQANuVNN2cHHMuXHTcYArrw/p8RiowRE4UDGGs4URa2wgccQi0JnRW/lK3/SG8Xa2aa5Fnh/Nokorq7tlWQMgyEEAoQwH3QP/K3QPHKIDPdFcJMND8nHGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1013,"cache_read_input_tokens":119287,"cache_creation":{"ephemeral_5m_input_tokens":1013,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXWAe6KmxjzJRUkRABkG6","type":"assistant","uuid":"6a71bb1b-3128-41a1-a6c9-a84d96fef142","timestamp":"2026-01-26T14:43:25.290Z"}
{"parentUuid":"6a71bb1b-3128-41a1-a6c9-a84d96fef142","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_018j73cFqf5HRjaGodMZJPVv","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora hago lo mismo para el plan de selección."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1013,"cache_read_input_tokens":119287,"cache_creation":{"ephemeral_5m_input_tokens":1013,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXWAe6KmxjzJRUkRABkG6","type":"assistant","uuid":"7b8e116c-aa19-4884-821e-464bb8f3186b","timestamp":"2026-01-26T14:43:25.630Z"}
{"parentUuid":"7b8e116c-aa19-4884-821e-464bb8f3186b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_018j73cFqf5HRjaGodMZJPVv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DV4F6E1LCCfAKQYqjyC7YB","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","offset":588,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1013,"cache_read_input_tokens":119287,"cache_creation":{"ephemeral_5m_input_tokens":1013,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXWAe6KmxjzJRUkRABkG6","type":"assistant","uuid":"8b169e41-3508-4aed-987a-032d3e5b25fb","timestamp":"2026-01-26T14:43:26.239Z"}
{"parentUuid":"8b169e41-3508-4aed-987a-032d3e5b25fb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DV4F6E1LCCfAKQYqjyC7YB","type":"tool_result","content":"   588→                    </div>\n   589→                </div>\n   590→            </div>\n   591→        `;\n   592→        $('#contenedor-creditos').append(seccion_creditos);\n   593→    }\n   594→    $('#plan_id').val(plan_seleccionado.id);\n   595→    $('#seccion-pruebas').removeClass('d-none');\n   596→\n   597→    // Mostrar campos de precio para plan de selección\n   598→    $('#contenedor-precio-plan').removeClass('d-none');\n   599→    if (plan_seleccionado && plan_seleccionado.precio) {\n   600→        // Guardar el valor original en el campo hidden\n   601→        $('#precio_plan_original').val(plan_seleccionado.precio);\n   602→        // Mostrar el valor en el campo visual\n   603→        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n   604→        // Habilitar el campo visual inicialmente\n   605→        $('#precio_plan_visual').prop('disabled', false);\n   606→        // Limpiar el porcentaje de descuento\n   607→        $('#porcentaje_descuento').val('');\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"896d7009-1144-4b95-a725-f510c4772edf","timestamp":"2026-01-26T14:43:27.463Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","content":"                    </div>\n                </div>\n            </div>\n        `;\n        $('#contenedor-creditos').append(seccion_creditos);\n    }\n    $('#plan_id').val(plan_seleccionado.id);\n    $('#seccion-pruebas').removeClass('d-none');\n\n    // Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_plan_original').val(plan_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_plan_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento').val('');","numLines":20,"startLine":588,"totalLines":1087}},"sourceToolAssistantUUID":"8b169e41-3508-4aed-987a-032d3e5b25fb"}
{"parentUuid":"896d7009-1144-4b95-a725-f510c4772edf","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MB69SQm2D77LGMtzopHE7j","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora modifico la parte del plan de selección para usar parseInt() también.","signature":"EvUBCkYICxgCKkBI8xfB/YTBDXAYSwQwwL9r1zzIwU/0A5oMVa33nz1r/8wY6J1EHjCOSByKTTzyBzaiD0UBiHJ+A50q9fStSrBmEgxkY8syoMCaheg4iEQaDO86PNoXov2w4V/t8iIwf2+yMb1zZywJS8GxgVtJRpaIhhNR8nTXEC5hlCJsqYKE/zSEEH/vDunKoJkmqiVQKl3nGu6O21ZvXCNi4yBQ8t4dAkR7bLe+rPAn56tEVdI1drCJJeaypNuO0MRlUC0E0FHXd2uYs52jthUWYy03znIJl69E/jjKRZW3ikTeskITXsHOKizMOi+psQpS1ysYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":575,"cache_read_input_tokens":120300,"cache_creation":{"ephemeral_5m_input_tokens":575,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXWAeTqLmbYGAFm2mzpxJ","type":"assistant","uuid":"e1d83447-ea08-478d-93e4-4b50469f16f9","timestamp":"2026-01-26T14:43:30.122Z"}
{"parentUuid":"e1d83447-ea08-478d-93e4-4b50469f16f9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MB69SQm2D77LGMtzopHE7j","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019fECe8UFfiFvACsWd9opA1","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\empresas\\asignar-plan.js","old_string":"// Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden\n        $('#precio_plan_original').val(plan_seleccionado.precio);\n        // Mostrar el valor en el campo visual\n        $('#precio_plan_visual').val(plan_seleccionado.precio).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_plan_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento').val('');\n    }","new_string":"// Mostrar campos de precio para plan de selección\n    $('#contenedor-precio-plan').removeClass('d-none');\n    if (plan_seleccionado && plan_seleccionado.precio) {\n        // Guardar el valor original en el campo hidden (sin decimales)\n        let precio_plan = parseInt(plan_seleccionado.precio);\n        $('#precio_plan_original').val(precio_plan);\n        // Mostrar el valor en el campo visual (sin decimales)\n        $('#precio_plan_visual').val(precio_plan).trigger('input');\n        // Habilitar el campo visual inicialmente\n        $('#precio_plan_visual').prop('disabled', false);\n        // Limpiar el porcentaje de descuento\n        $('#porcentaje_descuento').val('');\n    }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":575,"cache_read_input_tokens":120300,"cache_creation":{"ephemeral_5m_input_tokens":575,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXWAeTqLmbYGAFm2mzpxJ","type":"assistant","uuid":"18cd1942-b580-4229-82c2-504b66142225","timestamp":"2026-01-26T14:43:33.488Z"}
{"parentUuid":"18cd1942-b580-4229-82c2-504b66142225","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). The user provided the following reason for the rejection:  espera","is_error":true,"tool_use_id":"toolu_019fECe8UFfiFvACsWd9opA1"}]},"uuid":"4d386c5b-2a55-437d-b1d5-69ebb5813a85","timestamp":"2026-01-26T14:43:39.637Z","toolUseResult":"Error: The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). The user provided the following reason for the rejection:  espera","sourceToolAssistantUUID":"18cd1942-b580-4229-82c2-504b66142225"}
{"parentUuid":"4d386c5b-2a55-437d-b1d5-69ebb5813a85","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_0136Xu2qfVfHV2TUHZxyV67f","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario me pidió esperar, entonces voy a aguardar sus instrucciones.","signature":"EvABCkYICxgCKkAoX9KfiejlWD4TFHSAsrxmvhT0+zLR3SjPOTd29pgUL1M4/atSVRpSGUelPP/dUZJviIuvCqu+exBvT2knbwFpEgxUf1uyzRO0SzlfeWQaDGb+S/MXy6CnjndtHyIw22gTfu+K0+LckIkX5dnY4nqgqoxxTgxi9Mpol9zSQMaNsPJS3D469BrMoIIx755iKlifLzVD32oSNxbJAJSF7adQh9h1zpe13lE8Dm88K2X2bjyvMokkfIhMdvo71FNAxBgPDqfTBWABcHszfRSrBz07eNR0RfeSjA8jIsUb6kcJJIaBegDS0TuQGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":612,"cache_read_input_tokens":120875,"cache_creation":{"ephemeral_5m_input_tokens":612,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXWAfN8KiM4MziUzQtHEB","type":"assistant","uuid":"ea3f7d77-5547-40d9-9f5c-73d001d6261c","timestamp":"2026-01-26T14:43:42.040Z"}
{"parentUuid":"ea3f7d77-5547-40d9-9f5c-73d001d6261c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"cc30031e-b750-429a-b3b8-0a636ffeb287","version":"2.1.17","gitBranch":"D26-260","slug":"reflective-soaring-balloon","message":{"model":"claude-opus-4-5-20251101","id":"msg_0136Xu2qfVfHV2TUHZxyV67f","type":"message","role":"assistant","content":[{"type":"text","text":"Ok, esperando tus instrucciones."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":612,"cache_read_input_tokens":120875,"cache_creation":{"ephemeral_5m_input_tokens":612,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXWAfN8KiM4MziUzQtHEB","type":"assistant","uuid":"6b6e7eef-41a6-49ad-97b5-d3e4a59139d6","timestamp":"2026-01-26T14:43:42.338Z"}
