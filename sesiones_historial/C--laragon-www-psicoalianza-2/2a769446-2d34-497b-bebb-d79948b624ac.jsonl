{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-04T17:16:29.346Z","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac"}
{"type":"file-history-snapshot","messageId":"4a130cd8-5439-46ae-a260-93a967b882f8","snapshot":{"messageId":"4a130cd8-5439-46ae-a260-93a967b882f8","trackedFileBackups":{},"timestamp":"2026-02-04T17:16:29.429Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 699 to 705 from c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php:\n$calificacion_baja  = 40;\n        $calificacion_media = 70;\n\n        if ($escala_pruebas_psicometricas) {\n            $calificacion_baja  = 59;\n            $calificacion_media = 75;\n        }\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"me puedes colocar estos en contantes $calificacion_baja  = 40;\n        $calificacion_media = 70;\n\n        if ($escala_pruebas_psicometricas) {\n            $calificacion_baja  = 59;\n            $calificacion_media = 75;\n        } y locolocas aqui app\\Models\\Vacantes\\EtapaVacanteUsuario.php"}]},"uuid":"4a130cd8-5439-46ae-a260-93a967b882f8","timestamp":"2026-02-04T17:16:29.426Z","permissionMode":"default"}
{"parentUuid":"4a130cd8-5439-46ae-a260-93a967b882f8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017pYssTqhqE9AVKbmjj8uD7","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que convierta estos valores numéricos en constantes y las coloque en el modelo EtapaVacanteUsuario.php. \n\nLas constantes serían:\n- Para cuando NO se usa escala de pruebas psicométricas: 40 y 70\n- Para cuando SÍ se usa escala de pruebas psicométricas: 59 y 75\n\nPrimero debo leer el modelo para ver su estructura actual y luego agregarle las constantes. Después debo modificar el servicio para usar esas constantes en lugar de los valores hardcodeados.\n\nSegún las convenciones del proyecto:\n- Las constantes se nombran en mayúsculas y usando snake_case\n- Los nombres deben estar en español\n\nVoy a leer primero ambos archivos para entender el contexto.","signature":"EsQGCkYICxgCKkBNwXzSvL27+4Pi7Z2ebJXcnjmz3faDMvlLDHmg0QxELga348KDXtneoetYCWXgK0k0LVWHdzpYPUgipv5Utc6cEgwxEpy2XD9Ijdu1fpkaDKiSXkoAjBAJbAj2SCIwgqhTSKAjYBkQo54/W9diln0MP6Wjb6KA/ssdYbmok7K1rz+53WsmQ1Z5N5gJEoTqKqsFNMAtL6cJQ0WsJxXMUaifiHB/nNUai6rOVMFgsTzRFX1kvxB8kbDETrLyrOm36buis3NEraSc7d0zTmizJPeqvaU+DmsmT7d1HK8WBTXiOAe2wBzxVYo79A9f4d52U0CoUdrxQEA4TL8X1JGT0ULZbLIfgoqjRyXnHTFMGjeX9J0LhokelzbvI3rgt3OQzn5lw9iAydfdtQxncd4z7ZCwXhI7mD3wTrKjtvZ13deckGJq2x1OawcEbbvgDCWrM+nejmdd1bZCvbjXcAy/sEL/xPhxfTDGfwrHyzBlR09MUw3Jncg4k4JabmCkwzuGdY1PSj5Eet1SXipYK8r/1zpfvoRVKtZlO7NS4avHcm0g3dsAed7CTWg5vV1dh5R/oUOFF2ILo2/WD02Ha8yYtxK+RGH3sjKeXX+tJIncFwPxGPahl0jjm7G8xcGDIaerZsQVHVwydSccqO256mpaBwAOiX8wEbt3onShBPsehdVP1H6gb+cWvufp384kuZAR0F2ywomkOaTIjbZjlGL/ND7e+fIDHbRnhRKqNu6vyTvVHZ+NEKRW8g/dxBS6lQY9v58r2yG8/PPZVZAZ3aB/wR5Rvh98slS5ovxcJ5kCJZtRN8OtcQuGl2KudLwtpRaH/7d1SQaFBhF8Yuy2nQEysdLFZYha45Qwa8pZpf+ADECjv+kzYRmqbs1iElDBWgLMdfNwBH4Voeqqr1uF6rIUYDkP6QqDi/DpqadIbhFyhtpbtT7m93du/ha4uplhj1iFEbFpCHRU06tn3pXrJfCigFzMcl3ADmbcd3Ca2zOiTYkfFyPLYzPrTyrvHccs2unZ6kcMpq0YW8fFvceJQHLanuDONFXisSWdCPFVRACTVoJF1P31M4EuVLQIEp9nPHOA6IW1VocadhHMMd2s1RQYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5652,"cache_read_input_tokens":19625,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5652},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXoQbYQHcVfnpxjz2KhnF","type":"assistant","uuid":"d05fd7b9-8858-45b3-8e60-634a7218b0db","timestamp":"2026-02-04T17:16:43.755Z"}
{"parentUuid":"d05fd7b9-8858-45b3-8e60-634a7218b0db","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017pYssTqhqE9AVKbmjj8uD7","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a ayudarte a convertir esos valores en constantes y colocarlas en el modelo. Primero déjame leer ambos archivos."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5652,"cache_read_input_tokens":19625,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5652},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXoQbYQHcVfnpxjz2KhnF","type":"assistant","uuid":"3937895a-759c-490b-b1c1-2485da05fc21","timestamp":"2026-02-04T17:16:44.391Z"}
{"parentUuid":"3937895a-759c-490b-b1c1-2485da05fc21","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017pYssTqhqE9AVKbmjj8uD7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BDm1JNw7Q2sqjAtzbuTjw7","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5652,"cache_read_input_tokens":19625,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5652},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXoQbYQHcVfnpxjz2KhnF","type":"assistant","uuid":"43362181-0283-4c96-8e1a-2d6795ccd400","timestamp":"2026-02-04T17:16:45.095Z"}
{"parentUuid":"43362181-0283-4c96-8e1a-2d6795ccd400","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017pYssTqhqE9AVKbmjj8uD7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01ArkyniFewtoQA5CN2TgggT","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","offset":690,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5652,"cache_read_input_tokens":19625,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5652},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXoQbYQHcVfnpxjz2KhnF","type":"assistant","uuid":"833213db-9d43-459a-9520-11afc75637ff","timestamp":"2026-02-04T17:16:46.182Z"}
{"parentUuid":"43362181-0283-4c96-8e1a-2d6795ccd400","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BDm1JNw7Q2sqjAtzbuTjw7","type":"tool_result","content":"     1→<?php\n     2→\n     3→namespace App\\Models\\Vacantes;\n     4→\n     5→use App\\Models\\Vacantes\\PruebaTecnica;\n     6→use App\\Models\\Configuraciones\\Archivo;\n     7→use Illuminate\\Database\\Eloquent\\Model;\n     8→use App\\Models\\Usuarios\\User as Usuario;\n     9→use App\\Models\\Vacantes\\FormatoEntrevista;\n    10→use Illuminate\\Database\\Eloquent\\Relations\\HasOne;\n    11→use Illuminate\\Database\\Eloquent\\Relations\\HasMany;\n    12→use Illuminate\\Database\\Eloquent\\Relations\\BelongsTo;\n    13→use Illuminate\\Database\\Eloquent\\Relations\\MorphMany;\n    14→use Illuminate\\Database\\Eloquent\\Relations\\HasOneThrough;\n    15→\n    16→class EtapaVacanteUsuario extends Model\n    17→{\n    18→    protected $table = 'etapas_vacantes_usuarios';\n    19→\n    20→    protected $fillable = [\n    21→        'usuario_id',\n    22→        'etapa_vacante_id',\n    23→        'puntaje',\n    24→        'puntaje_ia',\n    25→        'notas_ia',\n    26→        'fecha_notificacion',\n    27→        'fecha_ejecucion',\n    28→        'motivo_abandono',\n    29→        'activo'\n    30→    ];\n    31→\n    32→    /**\n    33→     * Relación de muchos a uno con `users`.\n    34→     *\n    35→     * @return BelongsTo\n    36→     * @author Fahibram Cárcamo\n    37→     */\n    38→    public function usuario(): BelongsTo {\n    39→        return $this->belongsTo(Usuario::class, 'usuario_id');\n    40→    }\n    41→\n    42→    /**\n    43→     * Relación de muchos a uno con etapas de vacantes.\n    44→     *\n    45→     * @return BelongsTo\n    46→     * @author Fahibram Cárcamo\n    47→     */\n    48→    public function etapa(): BelongsTo {\n    49→        return $this->belongsTo(EtapaVacante::class, 'etapa_vacante_id');\n    50→    }\n    51→\n    52→    /**\n    53→     * Relación de uno a muchos con pruebas técnicas.\n    54→     *\n    55→     * @return HasMany\n    56→     * @author Andres Gonzalez\n    57→     * @deprecated\n    58→     */\n    59→    public function pruebasTecnicas(): HasMany {\n    60→        return $this->hasMany(PruebaTecnica::class, 'etapa_vacante_usuario_id');\n    61→    }\n    62→\n    63→    /**\n    64→     * Relación de uno a uno con pruebas_tecnicas.\n    65→     *\n    66→     * @return HasOne\n    67→     * @author Daniel Beltrán\n    68→     */\n    69→    public function pruebaTecnica(): HasOne {\n    70→        return $this->hasOne(PruebaTecnica::class, 'etapa_vacante_usuario_id');\n    71→    }\n    72→\n    73→    /**\n    74→     * Relación polimórfica de uno a muchos con archivos.\n    75→     *\n    76→     * @return MorphMany\n    77→     * @author Andres Gonzalez\n    78→     */\n    79→    public function archivos(): MorphMany {\n    80→        return $this->morphMany(Archivo::class, 'archivable', 'modelo', 'modelo_id');\n    81→    }\n    82→\n    83→    /**\n    84→     * Relación de uno a través de muchos con vacantes.\n    85→     *\n    86→     * @return HasOneThrough\n    87→     * @author Daniel Beltrán\n    88→     */\n    89→    public function vacante(): HasOneThrough {\n    90→        return $this->hasOneThrough(Vacante::class, EtapaVacante::class, 'id', 'id', 'etapa_vacante_id', 'vacante_id');\n    91→    }\n    92→\n    93→    /**\n    94→     * Relación de uno a muchos con etapas_usuarios_comentarios.\n    95→     *\n    96→     * @return HasMany\n    97→     * @author Daniel Beltrán\n    98→     * @author Andres Gonzalez\n    99→     */\n   100→    public function comentarios(): HasMany {\n   101→        return $this->hasMany(EtapaUsuarioComentario::class, 'etapa_vacante_usuario_id');\n   102→    }\n   103→\n   104→    /**\n   105→     * Relación de uno a uno con formatos entrevistas.\n   106→     *\n   107→     * @return HasOne\n   108→     * @author Andrés González\n   109→     */\n   110→    public function formatoEntrevista(): HasOne {\n   111→        return $this->hasOne(FormatoEntrevista::class, 'etapa_vacante_usuario_id');\n   112→    }\n   113→\n   114→    /**\n   115→     * Relación de uno a uno con transcripciones.\n   116→     *\n   117→     * @return HasOne\n   118→     * @author Andres González\n   119→     */\n   120→    public function transcripcion(): HasOne {\n   121→        return $this->hasOne(Transcripcion::class, 'etapa_vacante_usuario_id');\n   122→    }\n   123→}\n   124→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"22966e45-47ae-4fe7-9b21-1d08bbe51470","timestamp":"2026-02-04T17:16:47.394Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php","content":"<?php\n\nnamespace App\\Models\\Vacantes;\n\nuse App\\Models\\Vacantes\\PruebaTecnica;\nuse App\\Models\\Configuraciones\\Archivo;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse App\\Models\\Usuarios\\User as Usuario;\nuse App\\Models\\Vacantes\\FormatoEntrevista;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasOne;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasMany;\nuse Illuminate\\Database\\Eloquent\\Relations\\BelongsTo;\nuse Illuminate\\Database\\Eloquent\\Relations\\MorphMany;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasOneThrough;\n\nclass EtapaVacanteUsuario extends Model\n{\n    protected $table = 'etapas_vacantes_usuarios';\n\n    protected $fillable = [\n        'usuario_id',\n        'etapa_vacante_id',\n        'puntaje',\n        'puntaje_ia',\n        'notas_ia',\n        'fecha_notificacion',\n        'fecha_ejecucion',\n        'motivo_abandono',\n        'activo'\n    ];\n\n    /**\n     * Relación de muchos a uno con `users`.\n     *\n     * @return BelongsTo\n     * @author Fahibram Cárcamo\n     */\n    public function usuario(): BelongsTo {\n        return $this->belongsTo(Usuario::class, 'usuario_id');\n    }\n\n    /**\n     * Relación de muchos a uno con etapas de vacantes.\n     *\n     * @return BelongsTo\n     * @author Fahibram Cárcamo\n     */\n    public function etapa(): BelongsTo {\n        return $this->belongsTo(EtapaVacante::class, 'etapa_vacante_id');\n    }\n\n    /**\n     * Relación de uno a muchos con pruebas técnicas.\n     *\n     * @return HasMany\n     * @author Andres Gonzalez\n     * @deprecated\n     */\n    public function pruebasTecnicas(): HasMany {\n        return $this->hasMany(PruebaTecnica::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación de uno a uno con pruebas_tecnicas.\n     *\n     * @return HasOne\n     * @author Daniel Beltrán\n     */\n    public function pruebaTecnica(): HasOne {\n        return $this->hasOne(PruebaTecnica::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación polimórfica de uno a muchos con archivos.\n     *\n     * @return MorphMany\n     * @author Andres Gonzalez\n     */\n    public function archivos(): MorphMany {\n        return $this->morphMany(Archivo::class, 'archivable', 'modelo', 'modelo_id');\n    }\n\n    /**\n     * Relación de uno a través de muchos con vacantes.\n     *\n     * @return HasOneThrough\n     * @author Daniel Beltrán\n     */\n    public function vacante(): HasOneThrough {\n        return $this->hasOneThrough(Vacante::class, EtapaVacante::class, 'id', 'id', 'etapa_vacante_id', 'vacante_id');\n    }\n\n    /**\n     * Relación de uno a muchos con etapas_usuarios_comentarios.\n     *\n     * @return HasMany\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function comentarios(): HasMany {\n        return $this->hasMany(EtapaUsuarioComentario::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación de uno a uno con formatos entrevistas.\n     *\n     * @return HasOne\n     * @author Andrés González\n     */\n    public function formatoEntrevista(): HasOne {\n        return $this->hasOne(FormatoEntrevista::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación de uno a uno con transcripciones.\n     *\n     * @return HasOne\n     * @author Andres González\n     */\n    public function transcripcion(): HasOne {\n        return $this->hasOne(Transcripcion::class, 'etapa_vacante_usuario_id');\n    }\n}\n","numLines":124,"startLine":1,"totalLines":124}},"sourceToolAssistantUUID":"43362181-0283-4c96-8e1a-2d6795ccd400"}
{"parentUuid":"833213db-9d43-459a-9520-11afc75637ff","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01ArkyniFewtoQA5CN2TgggT","type":"tool_result","content":"   690→     * @param int $puntaje Puntaje obtenido en la etapa actual.\n   691→     * @param string $llave_puntajes_bajos Llave de configuración para puntajes bajos.\n   692→     * @param string $llave_puntajes_medios Llave de configuración para puntajes medios.\n   693→     * @param bool $escala_pruebas_psicometricas Indica si debe utilizar la escala de puntajes de pruebas psicométricas.\n   694→     * @return void\n   695→     * @author Daniel Beltrán\n   696→     * @author Andres Gonzalez\n   697→     */\n   698→    public function gestionarContinuidadAplicante(EtapaVacanteUsuario $etapa_usuario, int $movimiento_vacante_id, int $puntaje, string $llave_puntajes_bajos, string $llave_puntajes_medios, bool $escala_pruebas_psicometricas = false) {\n   699→        $calificacion_baja  = 40;\n   700→        $calificacion_media = 70;\n   701→\n   702→        if ($escala_pruebas_psicometricas) {\n   703→            $calificacion_baja  = 59;\n   704→            $calificacion_media = 75;\n   705→        }\n   706→\n   707→        // Obtener el movimiento de la etapa con sus configuraciones\n   708→        $etapa_movimiento = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n   709→            'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n   710→            'movimiento_vacante_id'   => $movimiento_vacante_id,\n   711→            'incluir_configuraciones' => true\n   712→        ]));\n   713→\n   714→        $configuracion_adecuaciones_bajas  = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_bajos)->first();\n   715→        $configuracion_adecuaciones_medias = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_medios)->first();\n   716→\n   717→        if (!is_null($configuracion_adecuaciones_medias) && filter_var($configuracion_adecuaciones_medias->valor, FILTER_VALIDATE_BOOLEAN) && $puntaje <= $calificacion_media) {\n   718→            $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje, descartar: true);\n   719→            return;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f641804b-6aea-4f17-b771-45294d611fa1","timestamp":"2026-02-04T17:16:48.545Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","content":"     * @param int $puntaje Puntaje obtenido en la etapa actual.\n     * @param string $llave_puntajes_bajos Llave de configuración para puntajes bajos.\n     * @param string $llave_puntajes_medios Llave de configuración para puntajes medios.\n     * @param bool $escala_pruebas_psicometricas Indica si debe utilizar la escala de puntajes de pruebas psicométricas.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function gestionarContinuidadAplicante(EtapaVacanteUsuario $etapa_usuario, int $movimiento_vacante_id, int $puntaje, string $llave_puntajes_bajos, string $llave_puntajes_medios, bool $escala_pruebas_psicometricas = false) {\n        $calificacion_baja  = 40;\n        $calificacion_media = 70;\n\n        if ($escala_pruebas_psicometricas) {\n            $calificacion_baja  = 59;\n            $calificacion_media = 75;\n        }\n\n        // Obtener el movimiento de la etapa con sus configuraciones\n        $etapa_movimiento = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n            'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n            'movimiento_vacante_id'   => $movimiento_vacante_id,\n            'incluir_configuraciones' => true\n        ]));\n\n        $configuracion_adecuaciones_bajas  = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_bajos)->first();\n        $configuracion_adecuaciones_medias = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_medios)->first();\n\n        if (!is_null($configuracion_adecuaciones_medias) && filter_var($configuracion_adecuaciones_medias->valor, FILTER_VALIDATE_BOOLEAN) && $puntaje <= $calificacion_media) {\n            $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje, descartar: true);\n            return;","numLines":30,"startLine":690,"totalLines":1351}},"sourceToolAssistantUUID":"833213db-9d43-459a-9520-11afc75637ff"}
{"parentUuid":"f641804b-6aea-4f17-b771-45294d611fa1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EfXynUx9HuyR1Kz6JvGMeh","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto, ahora entiendo el contexto. Voy a:\n\n1. Agregar las constantes en el modelo EtapaVacanteUsuario.php\n2. Modificar el servicio para usar esas constantes\n\nLas constantes serán:\n- CALIFICACION_BAJA_ESTANDAR = 40\n- CALIFICACION_MEDIA_ESTANDAR = 70\n- CALIFICACION_BAJA_PSICOMETRICA = 59\n- CALIFICACION_MEDIA_PSICOMETRICA = 75\n\nSiguiendo las convenciones del proyecto, las constantes deben estar en mayúsculas y usar snake_case, y los nombres en español.","signature":"EvAECkYICxgCKkAvYh8TyaxVrzPMCPgUW7fFnf8Hj/5gGR2MTrV7JiPxtgcBYF1Efcj7IzvxDKNCy6P0c9HyzKtqMjwD5xjzDnCXEgxQoxIiHzAVYfaqUwQaDJiwCOtmbIbmgvXgcCIw+C0mYYYbSSBO0lQ1hGAFhSoo1WbhfBGRHFckzA7jVjXarG1NPSpDicIZl0XZG0B1KtcDrGzRCaIxsEHWxWxoiTDeU1ZWlmfqzC93hex83ezqp3hKLBNNStoEVafxuDkSMmV5npUm7uw+oF7OQfCa3rFN59Ti7owiLJS1kEpuU9vzM6P4CtojbLOgI1DsVGKDCTKv3uw+2F7/VWWSqEwkB1eSQO4S9e0OzHZjmhXqdJCvGhUsDeXEclFjIG+wXa2LXa1lEOEHuUw29vWP8LssTPbnNg3NWvxa0rD8e23i873QTU3mYpWsOwTTRx7tm9VBGEpm0GkdPTDElgKCRRiXa1Ot1IVOlbldiUkA2bt6WVPRpt7CRsKzkgN/IaDdi6jFQMZC36/7zJFkiZt36+2LC7fixnl/ehBfFR1zKAQAyYnWYhIRny8QPeXooJpdYc7e7BPe2esXADF1+h33sTfOziChHvN2w432yIB/Xlx8oT78NK57zZLaoUxoRSkVy5aiwb8uczTuMzzmpPGGJhzfdeBSjH/+1UmgdAMS46G2jWIaxAvMZLHOmzPR3h2I+jsGXd5G73ZN3Pfjt/qTM1z2w5DMSId9vTiy0XUGwMdfSxvdtdCeclMY+2rZ7uET0O8F4AZ/H0p4QhCV1v3UaLk7ZGRCKWRrWdfWF72LOpBGMJaUWGegiduanVyUGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2920,"cache_read_input_tokens":25277,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2920},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQcxoWBFPwK6TYSK52D","type":"assistant","uuid":"a37506a4-89d9-4596-aaea-a65cf9ad25e9","timestamp":"2026-02-04T17:16:54.115Z"}
{"parentUuid":"a37506a4-89d9-4596-aaea-a65cf9ad25e9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EfXynUx9HuyR1Kz6JvGMeh","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto. Voy a agregar las constantes en el modelo y luego actualizar el servicio para usarlas."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2920,"cache_read_input_tokens":25277,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2920},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQcxoWBFPwK6TYSK52D","type":"assistant","uuid":"70c77eac-e528-4479-b8e1-cfd5b1a293e5","timestamp":"2026-02-04T17:16:54.633Z"}
{"parentUuid":"70c77eac-e528-4479-b8e1-cfd5b1a293e5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EfXynUx9HuyR1Kz6JvGMeh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HVs9yrJCcK6n14sP3KQqx9","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php","old_string":"class EtapaVacanteUsuario extends Model\n{\n    protected $table = 'etapas_vacantes_usuarios';\n\n    protected $fillable = [\n        'usuario_id',\n        'etapa_vacante_id',\n        'puntaje',\n        'puntaje_ia',\n        'notas_ia',\n        'fecha_notificacion',\n        'fecha_ejecucion',\n        'motivo_abandono',\n        'activo'\n    ];","new_string":"class EtapaVacanteUsuario extends Model\n{\n    protected $table = 'etapas_vacantes_usuarios';\n\n    // Constantes para calificaciones estándar\n    public const CALIFICACION_BAJA_ESTANDAR = 40;\n    public const CALIFICACION_MEDIA_ESTANDAR = 70;\n\n    // Constantes para calificaciones con escala psicométrica\n    public const CALIFICACION_BAJA_PSICOMETRICA = 59;\n    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;\n\n    protected $fillable = [\n        'usuario_id',\n        'etapa_vacante_id',\n        'puntaje',\n        'puntaje_ia',\n        'notas_ia',\n        'fecha_notificacion',\n        'fecha_ejecucion',\n        'motivo_abandono',\n        'activo'\n    ];"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2920,"cache_read_input_tokens":25277,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2920},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQcxoWBFPwK6TYSK52D","type":"assistant","uuid":"24e7d085-e30c-4742-8ee8-08a690a27436","timestamp":"2026-02-04T17:16:59.791Z"}
{"type":"file-history-snapshot","messageId":"24e7d085-e30c-4742-8ee8-08a690a27436","snapshot":{"messageId":"4a130cd8-5439-46ae-a260-93a967b882f8","trackedFileBackups":{"app\\Models\\Vacantes\\EtapaVacanteUsuario.php":{"backupFileName":"8e9db565b73c39ad@v1","version":1,"backupTime":"2026-02-04T17:17:30.764Z"}},"timestamp":"2026-02-04T17:16:29.429Z"},"isSnapshotUpdate":true}
{"parentUuid":"24e7d085-e30c-4742-8ee8-08a690a27436","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HVs9yrJCcK6n14sP3KQqx9","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php has been updated successfully."}]},"uuid":"31bdb560-60c1-49ac-bb88-0c46d47bbdf1","timestamp":"2026-02-04T17:17:30.803Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php","oldString":"class EtapaVacanteUsuario extends Model\n{\n    protected $table = 'etapas_vacantes_usuarios';\n\n    protected $fillable = [\n        'usuario_id',\n        'etapa_vacante_id',\n        'puntaje',\n        'puntaje_ia',\n        'notas_ia',\n        'fecha_notificacion',\n        'fecha_ejecucion',\n        'motivo_abandono',\n        'activo'\n    ];","newString":"class EtapaVacanteUsuario extends Model\n{\n    protected $table = 'etapas_vacantes_usuarios';\n\n    // Constantes para calificaciones estándar\n    public const CALIFICACION_BAJA_ESTANDAR = 40;\n    public const CALIFICACION_MEDIA_ESTANDAR = 70;\n\n    // Constantes para calificaciones con escala psicométrica\n    public const CALIFICACION_BAJA_PSICOMETRICA = 59;\n    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;\n\n    protected $fillable = [\n        'usuario_id',\n        'etapa_vacante_id',\n        'puntaje',\n        'puntaje_ia',\n        'notas_ia',\n        'fecha_notificacion',\n        'fecha_ejecucion',\n        'motivo_abandono',\n        'activo'\n    ];","originalFile":"<?php\n\nnamespace App\\Models\\Vacantes;\n\nuse App\\Models\\Vacantes\\PruebaTecnica;\nuse App\\Models\\Configuraciones\\Archivo;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse App\\Models\\Usuarios\\User as Usuario;\nuse App\\Models\\Vacantes\\FormatoEntrevista;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasOne;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasMany;\nuse Illuminate\\Database\\Eloquent\\Relations\\BelongsTo;\nuse Illuminate\\Database\\Eloquent\\Relations\\MorphMany;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasOneThrough;\n\nclass EtapaVacanteUsuario extends Model\n{\n    protected $table = 'etapas_vacantes_usuarios';\n\n    protected $fillable = [\n        'usuario_id',\n        'etapa_vacante_id',\n        'puntaje',\n        'puntaje_ia',\n        'notas_ia',\n        'fecha_notificacion',\n        'fecha_ejecucion',\n        'motivo_abandono',\n        'activo'\n    ];\n\n    /**\n     * Relación de muchos a uno con `users`.\n     *\n     * @return BelongsTo\n     * @author Fahibram Cárcamo\n     */\n    public function usuario(): BelongsTo {\n        return $this->belongsTo(Usuario::class, 'usuario_id');\n    }\n\n    /**\n     * Relación de muchos a uno con etapas de vacantes.\n     *\n     * @return BelongsTo\n     * @author Fahibram Cárcamo\n     */\n    public function etapa(): BelongsTo {\n        return $this->belongsTo(EtapaVacante::class, 'etapa_vacante_id');\n    }\n\n    /**\n     * Relación de uno a muchos con pruebas técnicas.\n     *\n     * @return HasMany\n     * @author Andres Gonzalez\n     * @deprecated\n     */\n    public function pruebasTecnicas(): HasMany {\n        return $this->hasMany(PruebaTecnica::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación de uno a uno con pruebas_tecnicas.\n     *\n     * @return HasOne\n     * @author Daniel Beltrán\n     */\n    public function pruebaTecnica(): HasOne {\n        return $this->hasOne(PruebaTecnica::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación polimórfica de uno a muchos con archivos.\n     *\n     * @return MorphMany\n     * @author Andres Gonzalez\n     */\n    public function archivos(): MorphMany {\n        return $this->morphMany(Archivo::class, 'archivable', 'modelo', 'modelo_id');\n    }\n\n    /**\n     * Relación de uno a través de muchos con vacantes.\n     *\n     * @return HasOneThrough\n     * @author Daniel Beltrán\n     */\n    public function vacante(): HasOneThrough {\n        return $this->hasOneThrough(Vacante::class, EtapaVacante::class, 'id', 'id', 'etapa_vacante_id', 'vacante_id');\n    }\n\n    /**\n     * Relación de uno a muchos con etapas_usuarios_comentarios.\n     *\n     * @return HasMany\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function comentarios(): HasMany {\n        return $this->hasMany(EtapaUsuarioComentario::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación de uno a uno con formatos entrevistas.\n     *\n     * @return HasOne\n     * @author Andrés González\n     */\n    public function formatoEntrevista(): HasOne {\n        return $this->hasOne(FormatoEntrevista::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación de uno a uno con transcripciones.\n     *\n     * @return HasOne\n     * @author Andres González\n     */\n    public function transcripcion(): HasOne {\n        return $this->hasOne(Transcripcion::class, 'etapa_vacante_usuario_id');\n    }\n}\n","structuredPatch":[{"oldStart":17,"oldLines":6,"newStart":17,"newLines":14,"lines":[" {","     protected $table = 'etapas_vacantes_usuarios';"," ","+    // Constantes para calificaciones estándar","+    public const CALIFICACION_BAJA_ESTANDAR = 40;","+    public const CALIFICACION_MEDIA_ESTANDAR = 70;","+","+    // Constantes para calificaciones con escala psicométrica","+    public const CALIFICACION_BAJA_PSICOMETRICA = 59;","+    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;","+","     protected $fillable = [","         'usuario_id',","         'etapa_vacante_id',"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"24e7d085-e30c-4742-8ee8-08a690a27436"}
{"parentUuid":"31bdb560-60c1-49ac-bb88-0c46d47bbdf1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016EP4qp2KFTfQC7Tb1ApF2p","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora debo actualizar el servicio para usar estas constantes. Primero debo verificar si el servicio ya tiene un import del modelo EtapaVacanteUsuario, y si no, agregarlo.","signature":"EtMCCkYICxgCKkD2qt/8QKZKAQ3/udcZrlWXR9YGi3sW0gt+mU638UtpSmgR0WrwfnXO4+9yvz2oyYehJH3IpZ4aTOfGWtVxLYsSEgyI3c69Ycya+pesDqEaDKV96KE2w/0QqenQ/CIwn9U9hMuR4utxxWZWfyNSf6Uw5sWZ8Fm929pyvPlF+uVUR/3oRhDVo+ty7yWDpGxvKroBx3EvhEkf38ZedLNOjNYV3j9Mbfs0ooJPUF16zLZOtmDOl3LbZMiGnWb9f2s4k6Bwcq0H6TZp+7iuzSKwSlmPJfBZp03x40mwzcdUxeEub3HN0md9QqR9YR7ADcjdlGjhaAWTwwT/crImq4Yk1d4RNV2k4uZeJTx5BCHwge+eGR1PBJMmlnJdSXPwU2Q1T/MnH+Iv/d0nD4tRXSJBnGM8gLMAUa7M1NF93XMVOb0hObtuuck5Y+kRtjl5GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":760,"cache_read_input_tokens":28197,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":760},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXoQgDGFAQkVo1235exH3","type":"assistant","uuid":"0407ec2a-6e68-4768-9882-8280c6ac9376","timestamp":"2026-02-04T17:17:40.978Z"}
{"parentUuid":"0407ec2a-6e68-4768-9882-8280c6ac9376","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016EP4qp2KFTfQC7Tb1ApF2p","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a actualizar el servicio para usar estas constantes. Primero déjame verificar los imports del servicio."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":760,"cache_read_input_tokens":28197,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":760},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXoQgDGFAQkVo1235exH3","type":"assistant","uuid":"033be582-b157-49ad-9707-7fc80d81565c","timestamp":"2026-02-04T17:17:41.669Z"}
{"parentUuid":"033be582-b157-49ad-9707-7fc80d81565c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016EP4qp2KFTfQC7Tb1ApF2p","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Cu4kLvdbN9wQU4yXLECctM","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","offset":1,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":760,"cache_read_input_tokens":28197,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":760},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXoQgDGFAQkVo1235exH3","type":"assistant","uuid":"1fe343bd-f7e7-4a01-b1c6-1fba0932a644","timestamp":"2026-02-04T17:17:42.818Z"}
{"parentUuid":"1fe343bd-f7e7-4a01-b1c6-1fba0932a644","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Cu4kLvdbN9wQU4yXLECctM","type":"tool_result","content":"     1→<?php\n     2→\n     3→namespace App\\Http\\Services\\Vacantes;\n     4→\n     5→use App\\Traits\\IATrait;\n     6→use App\\Traits\\StringTrait;\n     7→use Illuminate\\Support\\Arr;\n     8→use App\\Traits\\ArchivoTrait;\n     9→use Illuminate\\Http\\Request;\n    10→use App\\Models\\Vacantes\\Vacante;\n    11→use App\\Http\\Services\\BaseService;\n    12→use App\\Models\\Agendas\\EstadoAgenda;\n    13→use Illuminate\\Support\\Facades\\Auth;\n    14→use Illuminate\\Support\\Facades\\Mail;\n    15→use App\\Models\\Vacantes\\EtapaVacante;\n    16→use App\\Models\\Vacantes\\EstadoVacante;\n    17→use App\\Models\\Vacantes\\MovimientoVacante;\n    18→use App\\Mail\\NotificarFinalizacionEtapaMail;\n    19→use App\\Mail\\NotificarPostulanteVacanteMail;\n    20→use App\\Models\\Vacantes\\EtapaVacanteUsuario;\n    21→use Illuminate\\Http\\Client\\RequestException;\n    22→use App\\Http\\Services\\Vacantes\\VacanteService;\n    23→use App\\Models\\Configuraciones\\PlantillaCorreo;\n    24→use Illuminate\\Http\\Client\\ConnectionException;\n    25→use App\\Http\\Repositories\\Usuarios\\UserRepository;\n    26→use App\\Http\\Services\\Usuarios\\TokenAccesoService;\n    27→use App\\Http\\Repositories\\Agendas\\AgendaRepository;\n    28→use App\\Http\\Services\\Vacantes\\EtapaVacanteService;\n    29→use App\\Jobs\\Vacantes\\ProcesarVideoentrevistaIAJob;\n    30→use App\\Http\\Repositories\\Procesos\\ProcesoRepository;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"29682cc0-a24e-4f2e-bc40-004e4b8c16fa","timestamp":"2026-02-04T17:17:44.040Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","content":"<?php\n\nnamespace App\\Http\\Services\\Vacantes;\n\nuse App\\Traits\\IATrait;\nuse App\\Traits\\StringTrait;\nuse Illuminate\\Support\\Arr;\nuse App\\Traits\\ArchivoTrait;\nuse Illuminate\\Http\\Request;\nuse App\\Models\\Vacantes\\Vacante;\nuse App\\Http\\Services\\BaseService;\nuse App\\Models\\Agendas\\EstadoAgenda;\nuse Illuminate\\Support\\Facades\\Auth;\nuse Illuminate\\Support\\Facades\\Mail;\nuse App\\Models\\Vacantes\\EtapaVacante;\nuse App\\Models\\Vacantes\\EstadoVacante;\nuse App\\Models\\Vacantes\\MovimientoVacante;\nuse App\\Mail\\NotificarFinalizacionEtapaMail;\nuse App\\Mail\\NotificarPostulanteVacanteMail;\nuse App\\Models\\Vacantes\\EtapaVacanteUsuario;\nuse Illuminate\\Http\\Client\\RequestException;\nuse App\\Http\\Services\\Vacantes\\VacanteService;\nuse App\\Models\\Configuraciones\\PlantillaCorreo;\nuse Illuminate\\Http\\Client\\ConnectionException;\nuse App\\Http\\Repositories\\Usuarios\\UserRepository;\nuse App\\Http\\Services\\Usuarios\\TokenAccesoService;\nuse App\\Http\\Repositories\\Agendas\\AgendaRepository;\nuse App\\Http\\Services\\Vacantes\\EtapaVacanteService;\nuse App\\Jobs\\Vacantes\\ProcesarVideoentrevistaIAJob;\nuse App\\Http\\Repositories\\Procesos\\ProcesoRepository;","numLines":30,"startLine":1,"totalLines":1351}},"sourceToolAssistantUUID":"1fe343bd-f7e7-4a01-b1c6-1fba0932a644"}
{"parentUuid":"29682cc0-a24e-4f2e-bc40-004e4b8c16fa","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"text","text":"[Request interrupted by user]"}]},"uuid":"a10722c5-4f31-4eb4-9202-199806aba91e","timestamp":"2026-02-04T17:17:44.520Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-04T17:17:52.089Z","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac"}
{"type":"file-history-snapshot","messageId":"fba25e19-9b88-4b6c-94f9-73911a25bec7","snapshot":{"messageId":"fba25e19-9b88-4b6c-94f9-73911a25bec7","trackedFileBackups":{"app\\Models\\Vacantes\\EtapaVacanteUsuario.php":{"backupFileName":"8e9db565b73c39ad@v2","version":2,"backupTime":"2026-02-04T17:17:52.268Z"}},"timestamp":"2026-02-04T17:17:52.259Z"},"isSnapshotUpdate":false}
{"parentUuid":"a10722c5-4f31-4eb4-9202-199806aba91e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01BDm1JNw7Q2sqjAtzbuTjw7","parentToolUseID":"toolu_01BDm1JNw7Q2sqjAtzbuTjw7","uuid":"9e6ea3dc-813b-4f9a-b3d9-ded9784d18d4","timestamp":"2026-02-04T17:16:46.174Z"}
{"parentUuid":"9e6ea3dc-813b-4f9a-b3d9-ded9784d18d4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01BDm1JNw7Q2sqjAtzbuTjw7","toolUseID":"toolu_01BDm1JNw7Q2sqjAtzbuTjw7","timestamp":"2026-02-04T17:16:47.395Z","uuid":"d609c7f2-126e-4af2-a709-4002b15914d8"}
{"parentUuid":"d609c7f2-126e-4af2-a709-4002b15914d8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01ArkyniFewtoQA5CN2TgggT","parentToolUseID":"toolu_01ArkyniFewtoQA5CN2TgggT","uuid":"4ca84230-cf08-471d-9eb1-d6816704fd65","timestamp":"2026-02-04T17:16:47.479Z"}
{"parentUuid":"4ca84230-cf08-471d-9eb1-d6816704fd65","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01ArkyniFewtoQA5CN2TgggT","toolUseID":"toolu_01ArkyniFewtoQA5CN2TgggT","timestamp":"2026-02-04T17:16:48.546Z","uuid":"7991e376-3689-4713-b4d6-16f94d6cc897"}
{"parentUuid":"7991e376-3689-4713-b4d6-16f94d6cc897","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01HVs9yrJCcK6n14sP3KQqx9","parentToolUseID":"toolu_01HVs9yrJCcK6n14sP3KQqx9","uuid":"a46d4cc3-3efd-474f-903c-f018410821fc","timestamp":"2026-02-04T17:16:59.935Z"}
{"parentUuid":"a46d4cc3-3efd-474f-903c-f018410821fc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01HVs9yrJCcK6n14sP3KQqx9","parentToolUseID":"toolu_01HVs9yrJCcK6n14sP3KQqx9","uuid":"cf8107ed-153f-409a-9e88-cf435bea3360","timestamp":"2026-02-04T17:16:59.936Z"}
{"parentUuid":"cf8107ed-153f-409a-9e88-cf435bea3360","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01HVs9yrJCcK6n14sP3KQqx9","toolUseID":"toolu_01HVs9yrJCcK6n14sP3KQqx9","timestamp":"2026-02-04T17:17:30.805Z","uuid":"aea5c53c-cd28-4df1-a893-69945df12f74"}
{"parentUuid":"aea5c53c-cd28-4df1-a893-69945df12f74","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01HVs9yrJCcK6n14sP3KQqx9","toolUseID":"toolu_01HVs9yrJCcK6n14sP3KQqx9","timestamp":"2026-02-04T17:17:30.805Z","uuid":"4dbc79c8-4a4b-4b1b-89a4-ea0a2f9f3636"}
{"parentUuid":"4dbc79c8-4a4b-4b1b-89a4-ea0a2f9f3636","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01Cu4kLvdbN9wQU4yXLECctM","parentToolUseID":"toolu_01Cu4kLvdbN9wQU4yXLECctM","uuid":"994b530a-fc25-4c8b-bead-ef1c12b59f2c","timestamp":"2026-02-04T17:17:42.963Z"}
{"parentUuid":"994b530a-fc25-4c8b-bead-ef1c12b59f2c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01Cu4kLvdbN9wQU4yXLECctM","toolUseID":"toolu_01Cu4kLvdbN9wQU4yXLECctM","timestamp":"2026-02-04T17:17:44.040Z","uuid":"9b835bff-261f-4615-955e-183bcdd3b8ee"}
{"parentUuid":"9b835bff-261f-4615-955e-183bcdd3b8ee","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"quitale lo de estandar a las nomales"}]},"uuid":"fba25e19-9b88-4b6c-94f9-73911a25bec7","timestamp":"2026-02-04T17:17:52.258Z","permissionMode":"default"}
{"parentUuid":"fba25e19-9b88-4b6c-94f9-73911a25bec7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01A38ZYTst1BBu64iR8wJyYs","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que quite la palabra \"ESTANDAR\" de las constantes normales (las que no son psicométricas). Entonces las constantes quedarían:\n- CALIFICACION_BAJA = 40\n- CALIFICACION_MEDIA = 70\n- CALIFICACION_BAJA_PSICOMETRICA = 59\n- CALIFICACION_MEDIA_PSICOMETRICA = 75","signature":"ErkDCkYICxgCKkBa+cPRnZT2Ollh89Obu5d9AfU+l/YK0WaNogeJ2HD0VUKObBA1RGAJnC1oGV8uKNvdmaCDYgwDVa4wKkmJXQWsEgxtDYBsvbfyFyGh9C4aDFL68R+JNBcYlu1wXyIws9pUIqlZnAo5o4d7/1H1vSvJHOTnrZHgIKUyOwQGjrfacr07K3NRkG/10UMQt3VpKqACbzilBvtcmy/gjGMfmGJ3Z15X6GABZ+NnFe7Z0tqmzRrFGbKLmqYvqJ0ObReka6RbxA53e/NhQiXh2vIFs4SIxAtJsQ862c9CzxhvHJEkcynBBAB8For9+rl+Sl5e3KmTV9/u7pVfaKB8xJ1b5p9+igrgOzG8ty//N+kIVF/wPK0Xh4WC5IRXHxS9lrpzjDpCXd3K+RtVuFhY+MEVtaBVeFCdpDJrupTN9Vkn0s73ugSruMfzo5o9P5m44r8Hi2x7t5HN72dRfAU2FMpaawDtXRCZs5CKkEuAFNCpKVvT3t5/eHvwdn6jObpxCVTP8s1AbpUceIVdVqP9iApzCvLHBEOXfazr6l/dxpfLsedIKfIeBScQG/WBRZElWVNG8hv1GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1486,"cache_read_input_tokens":28957,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1486},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXoQhedWDWTGdnd3NoRvZ","type":"assistant","uuid":"17e87e5b-f59d-4549-8816-b427432eb6d1","timestamp":"2026-02-04T17:17:56.999Z"}
{"parentUuid":"17e87e5b-f59d-4549-8816-b427432eb6d1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01A38ZYTst1BBu64iR8wJyYs","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto, voy a simplificar las constantes normales quitándoles \"ESTANDAR\"."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1486,"cache_read_input_tokens":28957,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1486},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXoQhedWDWTGdnd3NoRvZ","type":"assistant","uuid":"3e36402e-ece4-47f3-bb61-ff5bfa7f715d","timestamp":"2026-02-04T17:17:57.758Z"}
{"parentUuid":"3e36402e-ece4-47f3-bb61-ff5bfa7f715d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01A38ZYTst1BBu64iR8wJyYs","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UEu7Jfd98iThL5chsEHKMM","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php","old_string":"    // Constantes para calificaciones estándar\n    public const CALIFICACION_BAJA_ESTANDAR = 40;\n    public const CALIFICACION_MEDIA_ESTANDAR = 70;\n\n    // Constantes para calificaciones con escala psicométrica\n    public const CALIFICACION_BAJA_PSICOMETRICA = 59;\n    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;","new_string":"    // Constantes para calificaciones\n    public const CALIFICACION_BAJA = 40;\n    public const CALIFICACION_MEDIA = 70;\n\n    // Constantes para calificaciones con escala psicométrica\n    public const CALIFICACION_BAJA_PSICOMETRICA = 59;\n    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1486,"cache_read_input_tokens":28957,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1486},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXoQhedWDWTGdnd3NoRvZ","type":"assistant","uuid":"d76b1390-8778-4194-b834-08b15b5c7f24","timestamp":"2026-02-04T17:18:00.342Z"}
{"parentUuid":"d76b1390-8778-4194-b834-08b15b5c7f24","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has been modified since read, either by the user or by a linter. Read it again before attempting to write it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_01UEu7Jfd98iThL5chsEHKMM"}]},"uuid":"22ac5f7a-f0a0-4be3-948d-25208e0f4cd7","timestamp":"2026-02-04T17:18:00.476Z","toolUseResult":"Error: File has been modified since read, either by the user or by a linter. Read it again before attempting to write it.","sourceToolAssistantUUID":"d76b1390-8778-4194-b834-08b15b5c7f24"}
{"parentUuid":"22ac5f7a-f0a0-4be3-948d-25208e0f4cd7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JsUjr4UmMAcJZQUuna2jRq","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El archivo ha sido modificado. Necesito leerlo de nuevo para ver el estado actual.","signature":"EvoBCkYICxgCKkCsLHy/MZat41zJsjle0KJ5KY+DfHjVgsTDKFYebC+FiKSgYkkQM6OpLs8MBLzmMRLmKXnFjsQRRhuAIFTdTeO1EgxgNn1KsIjfZVKncQgaDFv5aOLYUjELhq1S0SIw9DaxIyqJPr3/lTs1qTzb+SMgQQlu4UG4/7yK7fgTEtOhZZArRLopIuyu13FHE733KmKd3WHPoJMsBji6yCZekawdSkh44KPPNbnFqrCyXRLbhFipygG4F2iZYFOP7p36b9xJ1A3c7EAdXqOmphRcIJe3PNvaV4pk99cPqZ8T4eXIMsgqqqda8BX09Rz/GvhQW9laBhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":554,"cache_read_input_tokens":30443,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":554},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXoQiGN5hB7S7PVyoC2sD","type":"assistant","uuid":"b7645558-2ad2-4aad-8dcd-5dc9e57702b5","timestamp":"2026-02-04T17:18:03.632Z"}
{"parentUuid":"b7645558-2ad2-4aad-8dcd-5dc9e57702b5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JsUjr4UmMAcJZQUuna2jRq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MRy1356hDAAG6M2k3TJMqU","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php","offset":1,"limit":35}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":554,"cache_read_input_tokens":30443,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":554},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXoQiGN5hB7S7PVyoC2sD","type":"assistant","uuid":"f0b68d7f-f6af-468c-82ef-ef315de145bd","timestamp":"2026-02-04T17:18:04.443Z"}
{"parentUuid":"f0b68d7f-f6af-468c-82ef-ef315de145bd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MRy1356hDAAG6M2k3TJMqU","type":"tool_result","content":"     1→<?php\n     2→\n     3→namespace App\\Models\\Vacantes;\n     4→\n     5→use App\\Models\\Vacantes\\PruebaTecnica;\n     6→use App\\Models\\Configuraciones\\Archivo;\n     7→use Illuminate\\Database\\Eloquent\\Model;\n     8→use App\\Models\\Usuarios\\User as Usuario;\n     9→use App\\Models\\Vacantes\\FormatoEntrevista;\n    10→use Illuminate\\Database\\Eloquent\\Relations\\HasOne;\n    11→use Illuminate\\Database\\Eloquent\\Relations\\HasMany;\n    12→use Illuminate\\Database\\Eloquent\\Relations\\BelongsTo;\n    13→use Illuminate\\Database\\Eloquent\\Relations\\MorphMany;\n    14→use Illuminate\\Database\\Eloquent\\Relations\\HasOneThrough;\n    15→\n    16→class EtapaVacanteUsuario extends Model\n    17→{\n    18→    protected $table = 'etapas_vacantes_usuarios';\n    19→\n    20→    public const CALIFICACION_BAJA_ESTANDAR = 40;\n    21→    public const CALIFICACION_MEDIA_ESTANDAR = 70;\n    22→    public const CALIFICACION_BAJA_PSICOMETRICA = 59;\n    23→    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;\n    24→\n    25→    protected $fillable = [\n    26→        'usuario_id',\n    27→        'etapa_vacante_id',\n    28→        'puntaje',\n    29→        'puntaje_ia',\n    30→        'notas_ia',\n    31→        'fecha_notificacion',\n    32→        'fecha_ejecucion',\n    33→        'motivo_abandono',\n    34→        'activo'\n    35→    ];\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"50ecda7a-5d4f-44ca-80aa-4a2a85d0af1d","timestamp":"2026-02-04T17:18:05.637Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php","content":"<?php\n\nnamespace App\\Models\\Vacantes;\n\nuse App\\Models\\Vacantes\\PruebaTecnica;\nuse App\\Models\\Configuraciones\\Archivo;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse App\\Models\\Usuarios\\User as Usuario;\nuse App\\Models\\Vacantes\\FormatoEntrevista;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasOne;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasMany;\nuse Illuminate\\Database\\Eloquent\\Relations\\BelongsTo;\nuse Illuminate\\Database\\Eloquent\\Relations\\MorphMany;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasOneThrough;\n\nclass EtapaVacanteUsuario extends Model\n{\n    protected $table = 'etapas_vacantes_usuarios';\n\n    public const CALIFICACION_BAJA_ESTANDAR = 40;\n    public const CALIFICACION_MEDIA_ESTANDAR = 70;\n    public const CALIFICACION_BAJA_PSICOMETRICA = 59;\n    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;\n\n    protected $fillable = [\n        'usuario_id',\n        'etapa_vacante_id',\n        'puntaje',\n        'puntaje_ia',\n        'notas_ia',\n        'fecha_notificacion',\n        'fecha_ejecucion',\n        'motivo_abandono',\n        'activo'\n    ];","numLines":35,"startLine":1,"totalLines":129}},"sourceToolAssistantUUID":"f0b68d7f-f6af-468c-82ef-ef315de145bd"}
{"parentUuid":"50ecda7a-5d4f-44ca-80aa-4a2a85d0af1d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01RH6sg6mjRTgBd58FnsHwU1","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Veo que el archivo fue modificado por el linter y quitó los comentarios. Ahora solo necesito cambiar los nombres de las constantes.","signature":"Eq0CCkYICxgCKkCkqpOxTPKbxMeFMYwjC5fwmC+rfMVw2Ac2xErLxgf7iXz9BIf2QhVRSb9VJM+y1q8px5vhLUpzjmBIlxCnFYjdEgzj0+CoJIA4gz8h1iYaDAPC22sSyXmWCGc4qiIwA45ulS9A2VsCUKQrf6/BDQoGBgNQyJ66IKrE8RbTFOJTZ4RbQI5SqcTWZX6dRD0+KpQBf/B6TPdxbEZloKX+WlgIrwQj3zRR+SEIPt2oBN7T+kmiNeOcHLdenpKKFEJjXO7/le9RfwE9sBCfstDqCdAhiAkYd1Blb82Zjw6VoHAgjwU4aszhsU95ppkm2y1naHZAGRCn+nT1nSe2e6jeXxlr/aEGNOJo2VKH5FV0hWVH/5DgxM/rh98Ii7PD6ZGvWMMgD+NVhRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":835,"cache_read_input_tokens":30997,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":835},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQie82KJtURfVAC5sKp","type":"assistant","uuid":"b6f49b2e-dedb-4e43-b9d0-a3b41383b958","timestamp":"2026-02-04T17:18:08.971Z"}
{"parentUuid":"b6f49b2e-dedb-4e43-b9d0-a3b41383b958","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01RH6sg6mjRTgBd58FnsHwU1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UM6EAmye3DDak8oY4r3oq9","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php","old_string":"    public const CALIFICACION_BAJA_ESTANDAR = 40;\n    public const CALIFICACION_MEDIA_ESTANDAR = 70;\n    public const CALIFICACION_BAJA_PSICOMETRICA = 59;\n    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;","new_string":"    public const CALIFICACION_BAJA = 40;\n    public const CALIFICACION_MEDIA = 70;\n    public const CALIFICACION_BAJA_PSICOMETRICA = 59;\n    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":835,"cache_read_input_tokens":30997,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":835},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQie82KJtURfVAC5sKp","type":"assistant","uuid":"56b6b047-587f-47f6-852e-21c3c37dc218","timestamp":"2026-02-04T17:18:11.162Z"}
{"parentUuid":"56b6b047-587f-47f6-852e-21c3c37dc218","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UM6EAmye3DDak8oY4r3oq9","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php has been updated successfully."}]},"uuid":"57f26577-1556-4561-9a0b-3a929ea48b48","timestamp":"2026-02-04T17:18:28.160Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Models\\Vacantes\\EtapaVacanteUsuario.php","oldString":"    public const CALIFICACION_BAJA_ESTANDAR = 40;\n    public const CALIFICACION_MEDIA_ESTANDAR = 70;\n    public const CALIFICACION_BAJA_PSICOMETRICA = 59;\n    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;","newString":"    public const CALIFICACION_BAJA = 40;\n    public const CALIFICACION_MEDIA = 70;\n    public const CALIFICACION_BAJA_PSICOMETRICA = 59;\n    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;","originalFile":"<?php\n\nnamespace App\\Models\\Vacantes;\n\nuse App\\Models\\Vacantes\\PruebaTecnica;\nuse App\\Models\\Configuraciones\\Archivo;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse App\\Models\\Usuarios\\User as Usuario;\nuse App\\Models\\Vacantes\\FormatoEntrevista;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasOne;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasMany;\nuse Illuminate\\Database\\Eloquent\\Relations\\BelongsTo;\nuse Illuminate\\Database\\Eloquent\\Relations\\MorphMany;\nuse Illuminate\\Database\\Eloquent\\Relations\\HasOneThrough;\n\nclass EtapaVacanteUsuario extends Model\n{\n    protected $table = 'etapas_vacantes_usuarios';\n\n    public const CALIFICACION_BAJA_ESTANDAR = 40;\n    public const CALIFICACION_MEDIA_ESTANDAR = 70;\n    public const CALIFICACION_BAJA_PSICOMETRICA = 59;\n    public const CALIFICACION_MEDIA_PSICOMETRICA = 75;\n\n    protected $fillable = [\n        'usuario_id',\n        'etapa_vacante_id',\n        'puntaje',\n        'puntaje_ia',\n        'notas_ia',\n        'fecha_notificacion',\n        'fecha_ejecucion',\n        'motivo_abandono',\n        'activo'\n    ];\n\n    /**\n     * Relación de muchos a uno con `users`.\n     *\n     * @return BelongsTo\n     * @author Fahibram Cárcamo\n     */\n    public function usuario(): BelongsTo {\n        return $this->belongsTo(Usuario::class, 'usuario_id');\n    }\n\n    /**\n     * Relación de muchos a uno con etapas de vacantes.\n     *\n     * @return BelongsTo\n     * @author Fahibram Cárcamo\n     */\n    public function etapa(): BelongsTo {\n        return $this->belongsTo(EtapaVacante::class, 'etapa_vacante_id');\n    }\n\n    /**\n     * Relación de uno a muchos con pruebas técnicas.\n     *\n     * @return HasMany\n     * @author Andres Gonzalez\n     * @deprecated\n     */\n    public function pruebasTecnicas(): HasMany {\n        return $this->hasMany(PruebaTecnica::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación de uno a uno con pruebas_tecnicas.\n     *\n     * @return HasOne\n     * @author Daniel Beltrán\n     */\n    public function pruebaTecnica(): HasOne {\n        return $this->hasOne(PruebaTecnica::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación polimórfica de uno a muchos con archivos.\n     *\n     * @return MorphMany\n     * @author Andres Gonzalez\n     */\n    public function archivos(): MorphMany {\n        return $this->morphMany(Archivo::class, 'archivable', 'modelo', 'modelo_id');\n    }\n\n    /**\n     * Relación de uno a través de muchos con vacantes.\n     *\n     * @return HasOneThrough\n     * @author Daniel Beltrán\n     */\n    public function vacante(): HasOneThrough {\n        return $this->hasOneThrough(Vacante::class, EtapaVacante::class, 'id', 'id', 'etapa_vacante_id', 'vacante_id');\n    }\n\n    /**\n     * Relación de uno a muchos con etapas_usuarios_comentarios.\n     *\n     * @return HasMany\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function comentarios(): HasMany {\n        return $this->hasMany(EtapaUsuarioComentario::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación de uno a uno con formatos entrevistas.\n     *\n     * @return HasOne\n     * @author Andrés González\n     */\n    public function formatoEntrevista(): HasOne {\n        return $this->hasOne(FormatoEntrevista::class, 'etapa_vacante_usuario_id');\n    }\n\n    /**\n     * Relación de uno a uno con transcripciones.\n     *\n     * @return HasOne\n     * @author Andres González\n     */\n    public function transcripcion(): HasOne {\n        return $this->hasOne(Transcripcion::class, 'etapa_vacante_usuario_id');\n    }\n}\n","structuredPatch":[{"oldStart":17,"oldLines":8,"newStart":17,"newLines":8,"lines":[" {","     protected $table = 'etapas_vacantes_usuarios';"," ","-    public const CALIFICACION_BAJA_ESTANDAR = 40;","-    public const CALIFICACION_MEDIA_ESTANDAR = 70;","+    public const CALIFICACION_BAJA = 40;","+    public const CALIFICACION_MEDIA = 70;","     public const CALIFICACION_BAJA_PSICOMETRICA = 59;","     public const CALIFICACION_MEDIA_PSICOMETRICA = 75;"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"56b6b047-587f-47f6-852e-21c3c37dc218"}
{"parentUuid":"57f26577-1556-4561-9a0b-3a929ea48b48","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01VQGpSBV7qPJmQyNhkb2Rfi","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto. Ahora debo actualizar el servicio para usar estas constantes en lugar de los valores hardcodeados. El código actual es:\n\n```php\n$calificacion_baja  = 40;\n$calificacion_media = 70;\n\nif ($escala_pruebas_psicometricas) {\n    $calificacion_baja  = 59;\n    $calificacion_media = 75;\n}\n```\n\nDebería cambiarse a:\n\n```php\n$calificacion_baja  = EtapaVacanteUsuario::CALIFICACION_BAJA;\n$calificacion_media = EtapaVacanteUsuario::CALIFICACION_MEDIA;\n\nif ($escala_pruebas_psicometricas) {\n    $calificacion_baja  = EtapaVacanteUsuario::CALIFICACION_BAJA_PSICOMETRICA;\n    $calificacion_media = EtapaVacanteUsuario::CALIFICACION_MEDIA_PSICOMETRICA;\n}\n```","signature":"Eq0GCkYICxgCKkAhdbIF98kYkc767PJEoNhjgfEtfCuKIAJSEu4DlAa+fPy+FBynaxGW4645udau8ygIGa5dnhIg0mD2tz935YvUEgw2x/ogGuRurwMWz6oaDOy7OUKMv4RNmvH8iCIwmh1zMfYcgPNJHU1TfWXspBjR51ieFdQvSP7vYAaJ5mhOYJwIDII9kn6I9HwdFjNdKpQFz7yxtL8L0DYKjFIabIOoCCR8G6uWFtxBFDiuF5CbqrC3JM8WeADD+xQkiia5+lG+ywORki9dKWo9W3HzalUSKyMI3HA5mtwOFwEbb25VzZNSs7MU2yAm7LdT11R0VmfQjtgu72CqQGwiHr5bZEUoRRXVUieFB28PHIn8LjXO6eurkyzMKVrYdlBdYQJShJl3VnTdiB1AhH+ZlDtQNP/syvxYuMbw1AQOVuHIBS3lK/GiPb1VJS/XmlCfypvMirt88wCwARW3zBmTGwce3S1Gf5+Spr/CNoY7V3i7P5ljjxs7p6Ky1CYDOSJfdecHVDTKEnZqBgJxnCC5qDULTylIqJE8vNVVetDx8cQ5yXgFOMiBuhcG9u3q49I7kg5416qEbGiBSzZIKNJ2omCERJoWwS/I0xyV/TmouWdjwhWGRgt7bekYYQmJYqqPal0tpo+1YDp2MEEo8y8/cdKcr4+Rr4oRwjLevjbndOq8kG1GIXBvgF92dSplGgihmmeOB9tOE39mUds09nsCn29WFEKJUDIkTVbJDmvBCBXO4mFgjHSjlmeGRE5NOF1LLVNNCiEkn8oH5AIxLRFLzlhZVUJk/+UJaDRk4qi0caIaKrR6qzVcvMn3apNg2fFLPzL9EZjCGIngPzAUbQfdrvZLllSyO3cmQ45T8A6O1CX6MMBEjdLFwa+6pCsk88ruecL7fiAVB7wImOEasfYFHl2rtprHCIWvMKxM1GsR0PI8XIcF/tkFN3gWUp0HBKhtlFJ72L4o/Qo4XI32RQIrN1vskx61ScFY0WJhOFc4XYLNSwzfGoHs+DBRHoeS/GWxHIyUMqTbWn+kMDKIzqUr/MGBRhipDrTGUFw2GJ4aWghQ6wyF3rkYlTJdGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":400,"cache_read_input_tokens":31832,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":400},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQkWHnpRZAUo2GJVzn3","type":"assistant","uuid":"20ba07bb-30f8-4140-857d-4bf8c56f53a3","timestamp":"2026-02-04T17:18:36.434Z"}
{"parentUuid":"20ba07bb-30f8-4140-857d-4bf8c56f53a3","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01VQGpSBV7qPJmQyNhkb2Rfi","type":"message","role":"assistant","content":[{"type":"text","text":"Ahora voy a actualizar el servicio para usar estas constantes."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":400,"cache_read_input_tokens":31832,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":400},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQkWHnpRZAUo2GJVzn3","type":"assistant","uuid":"e92bb2cb-5b5d-48ce-94d1-1793adb3ee72","timestamp":"2026-02-04T17:18:36.730Z"}
{"parentUuid":"e92bb2cb-5b5d-48ce-94d1-1793adb3ee72","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01VQGpSBV7qPJmQyNhkb2Rfi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WXTekUinEDkNttX4kaTxF7","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","old_string":"        $calificacion_baja  = 40;\n        $calificacion_media = 70;\n\n        if ($escala_pruebas_psicometricas) {\n            $calificacion_baja  = 59;\n            $calificacion_media = 75;\n        }","new_string":"        $calificacion_baja  = EtapaVacanteUsuario::CALIFICACION_BAJA;\n        $calificacion_media = EtapaVacanteUsuario::CALIFICACION_MEDIA;\n\n        if ($escala_pruebas_psicometricas) {\n            $calificacion_baja  = EtapaVacanteUsuario::CALIFICACION_BAJA_PSICOMETRICA;\n            $calificacion_media = EtapaVacanteUsuario::CALIFICACION_MEDIA_PSICOMETRICA;\n        }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":400,"cache_read_input_tokens":31832,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":400},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQkWHnpRZAUo2GJVzn3","type":"assistant","uuid":"5610ee35-7d77-4e46-94b0-84cff1bb978b","timestamp":"2026-02-04T17:18:39.544Z"}
{"parentUuid":"5610ee35-7d77-4e46-94b0-84cff1bb978b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has not been read yet. Read it first before writing to it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_01WXTekUinEDkNttX4kaTxF7"}]},"uuid":"b3e0344f-f1bf-4ab7-bea5-1c126b49c7be","timestamp":"2026-02-04T17:18:39.723Z","toolUseResult":"Error: File has not been read yet. Read it first before writing to it.","sourceToolAssistantUUID":"5610ee35-7d77-4e46-94b0-84cff1bb978b"}
{"parentUuid":"b3e0344f-f1bf-4ab7-bea5-1c126b49c7be","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01AgJVFFz85So2Fnk7J17L7G","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Necesito leer el archivo del servicio primero antes de poder editarlo.","signature":"Eu4BCkYICxgCKkAeU6OoFzWVyp3hCoSlXLoj0+A7B+DfYUFFTCEnU8pcJ4h6yzJNxh4HAefjPLlnE6c8fYWHyMv4h7LIWBDbvmG8EgzJN4ezEvHTeOAQuSEaDFn6bBG0W1nq3WJT+yIw3KXCEc5XCasPmhauIhuwcKR/YNICd8XiA4nCQR8PEE0QSfIDs95kXwXeC363mgfuKlY4Jr0eUUDIAHvBTjYjwVZRvmuALbgAxCfAmFAuTnXReUTmz9/4WK0h55k3R9YUMo5A9+wJuGSk1QIV8LAvcDzm4kL5p4FEfgb1USsQR7vd7KPZJ2CSChgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1101,"cache_read_input_tokens":32232,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1101},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQmAbttUqxyUbtVFLE1","type":"assistant","uuid":"6f9d3247-5dfb-4283-ba65-26dcd6c57e5b","timestamp":"2026-02-04T17:18:44.758Z"}
{"parentUuid":"6f9d3247-5dfb-4283-ba65-26dcd6c57e5b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01AgJVFFz85So2Fnk7J17L7G","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DLyDySjKCsYymiQT22wMDr","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","offset":695,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1101,"cache_read_input_tokens":32232,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1101},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQmAbttUqxyUbtVFLE1","type":"assistant","uuid":"3c3a8bac-82ce-4c30-8e7c-e16e2bfc7f8a","timestamp":"2026-02-04T17:18:45.653Z"}
{"parentUuid":"3c3a8bac-82ce-4c30-8e7c-e16e2bfc7f8a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DLyDySjKCsYymiQT22wMDr","type":"tool_result","content":"   695→     * @author Daniel Beltrán\n   696→     * @author Andres Gonzalez\n   697→     */\n   698→    public function gestionarContinuidadAplicante(EtapaVacanteUsuario $etapa_usuario, int $movimiento_vacante_id, int $puntaje, string $llave_puntajes_bajos, string $llave_puntajes_medios, bool $escala_pruebas_psicometricas = false) {\n   699→        $calificacion_baja  = 40;\n   700→        $calificacion_media = 70;\n   701→\n   702→        if ($escala_pruebas_psicometricas) {\n   703→            $calificacion_baja  = 59;\n   704→            $calificacion_media = 75;\n   705→        }\n   706→\n   707→        // Obtener el movimiento de la etapa con sus configuraciones\n   708→        $etapa_movimiento = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n   709→            'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n   710→            'movimiento_vacante_id'   => $movimiento_vacante_id,\n   711→            'incluir_configuraciones' => true\n   712→        ]));\n   713→\n   714→        $configuracion_adecuaciones_bajas  = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_bajos)->first();\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c92a8c6b-f17c-4056-9b50-6bf7f23ff23d","timestamp":"2026-02-04T17:18:46.865Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","content":"     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function gestionarContinuidadAplicante(EtapaVacanteUsuario $etapa_usuario, int $movimiento_vacante_id, int $puntaje, string $llave_puntajes_bajos, string $llave_puntajes_medios, bool $escala_pruebas_psicometricas = false) {\n        $calificacion_baja  = 40;\n        $calificacion_media = 70;\n\n        if ($escala_pruebas_psicometricas) {\n            $calificacion_baja  = 59;\n            $calificacion_media = 75;\n        }\n\n        // Obtener el movimiento de la etapa con sus configuraciones\n        $etapa_movimiento = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n            'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n            'movimiento_vacante_id'   => $movimiento_vacante_id,\n            'incluir_configuraciones' => true\n        ]));\n\n        $configuracion_adecuaciones_bajas  = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_bajos)->first();","numLines":20,"startLine":695,"totalLines":1351}},"sourceToolAssistantUUID":"3c3a8bac-82ce-4c30-8e7c-e16e2bfc7f8a"}
{"parentUuid":"c92a8c6b-f17c-4056-9b50-6bf7f23ff23d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01WBvtBBuT9QHur1UCYe52wJ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora puedo hacer la edición en el servicio.","signature":"EtUBCkYICxgCKkC5QPH58YVSuDvIzvn+2BjK/auljYv55LXZjMPRJWI0yxamMLszf+eOTuPLk2lkYx3cxBc2chZkDID0XrsFinUgEgzxQcvzWgZHFvk3aTUaDOACujWcG5zvyZ/pXSIwmlkU8Hj49yfHLj4e7hQFmRESKPSPyQfLwGiMr23HaJGIhcFecIWQWdMH3fesLhMBKj0cGFgiTZKcdw+316j4zNDB2n2+yAO/Z41Nx0I4E51j1DDbObZdAlAkolrfrox3rMQ5C+2ebcdG8NiFgdGpGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":664,"cache_read_input_tokens":33333,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":664},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXoQmgMo7NLQ9z41azuxr","type":"assistant","uuid":"b8d05bcb-f328-4e82-a69c-254e5f50794f","timestamp":"2026-02-04T17:18:53.849Z"}
{"parentUuid":"b8d05bcb-f328-4e82-a69c-254e5f50794f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01WBvtBBuT9QHur1UCYe52wJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HXXnJmJTg3xmQST61dqyc8","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","old_string":"        $calificacion_baja  = 40;\n        $calificacion_media = 70;\n\n        if ($escala_pruebas_psicometricas) {\n            $calificacion_baja  = 59;\n            $calificacion_media = 75;\n        }","new_string":"        $calificacion_baja  = EtapaVacanteUsuario::CALIFICACION_BAJA;\n        $calificacion_media = EtapaVacanteUsuario::CALIFICACION_MEDIA;\n\n        if ($escala_pruebas_psicometricas) {\n            $calificacion_baja  = EtapaVacanteUsuario::CALIFICACION_BAJA_PSICOMETRICA;\n            $calificacion_media = EtapaVacanteUsuario::CALIFICACION_MEDIA_PSICOMETRICA;\n        }"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":664,"cache_read_input_tokens":33333,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":664},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CXoQmgMo7NLQ9z41azuxr","type":"assistant","uuid":"933b5611-416f-4101-a5e9-a18e5f53c0aa","timestamp":"2026-02-04T17:18:56.746Z"}
{"type":"file-history-snapshot","messageId":"933b5611-416f-4101-a5e9-a18e5f53c0aa","snapshot":{"messageId":"fba25e19-9b88-4b6c-94f9-73911a25bec7","trackedFileBackups":{"app\\Models\\Vacantes\\EtapaVacanteUsuario.php":{"backupFileName":"8e9db565b73c39ad@v2","version":2,"backupTime":"2026-02-04T17:17:52.268Z"},"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v1","version":1,"backupTime":"2026-02-04T17:19:03.329Z"}},"timestamp":"2026-02-04T17:17:52.259Z"},"isSnapshotUpdate":true}
{"parentUuid":"933b5611-416f-4101-a5e9-a18e5f53c0aa","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HXXnJmJTg3xmQST61dqyc8","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php has been updated successfully."}]},"uuid":"260e0948-7f47-4445-8e06-6d07c995eaa1","timestamp":"2026-02-04T17:19:03.364Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php","oldString":"        $calificacion_baja  = 40;\n        $calificacion_media = 70;\n\n        if ($escala_pruebas_psicometricas) {\n            $calificacion_baja  = 59;\n            $calificacion_media = 75;\n        }","newString":"        $calificacion_baja  = EtapaVacanteUsuario::CALIFICACION_BAJA;\n        $calificacion_media = EtapaVacanteUsuario::CALIFICACION_MEDIA;\n\n        if ($escala_pruebas_psicometricas) {\n            $calificacion_baja  = EtapaVacanteUsuario::CALIFICACION_BAJA_PSICOMETRICA;\n            $calificacion_media = EtapaVacanteUsuario::CALIFICACION_MEDIA_PSICOMETRICA;\n        }","originalFile":"<?php\n\nnamespace App\\Http\\Services\\Vacantes;\n\nuse App\\Traits\\IATrait;\nuse App\\Traits\\StringTrait;\nuse Illuminate\\Support\\Arr;\nuse App\\Traits\\ArchivoTrait;\nuse Illuminate\\Http\\Request;\nuse App\\Models\\Vacantes\\Vacante;\nuse App\\Http\\Services\\BaseService;\nuse App\\Models\\Agendas\\EstadoAgenda;\nuse Illuminate\\Support\\Facades\\Auth;\nuse Illuminate\\Support\\Facades\\Mail;\nuse App\\Models\\Vacantes\\EtapaVacante;\nuse App\\Models\\Vacantes\\EstadoVacante;\nuse App\\Models\\Vacantes\\MovimientoVacante;\nuse App\\Mail\\NotificarFinalizacionEtapaMail;\nuse App\\Mail\\NotificarPostulanteVacanteMail;\nuse App\\Models\\Vacantes\\EtapaVacanteUsuario;\nuse Illuminate\\Http\\Client\\RequestException;\nuse App\\Http\\Services\\Vacantes\\VacanteService;\nuse App\\Models\\Configuraciones\\PlantillaCorreo;\nuse Illuminate\\Http\\Client\\ConnectionException;\nuse App\\Http\\Repositories\\Usuarios\\UserRepository;\nuse App\\Http\\Services\\Usuarios\\TokenAccesoService;\nuse App\\Http\\Repositories\\Agendas\\AgendaRepository;\nuse App\\Http\\Services\\Vacantes\\EtapaVacanteService;\nuse App\\Jobs\\Vacantes\\ProcesarVideoentrevistaIAJob;\nuse App\\Http\\Repositories\\Procesos\\ProcesoRepository;\nuse App\\Http\\Repositories\\Vacantes\\VacanteRepository;\nuse App\\Http\\Services\\Agendas\\ResultadoAgendaService;\nuse App\\Http\\Services\\Configuraciones\\ArchivoService;\nuse App\\Notifications\\NotificarAvanceProcesoNotification;\nuse App\\Http\\Repositories\\Vacantes\\EtapaVacanteRepository;\nuse App\\Http\\Repositories\\Vacantes\\TranscripcionRepository;\nuse App\\Http\\Repositories\\Configuraciones\\ArchivoRepository;\nuse App\\Http\\Repositories\\Empresas\\EmpresaUsuarioRepository;\nuse App\\Http\\Repositories\\Vacantes\\AspectoPuntajeRepository;\nuse App\\Http\\Services\\Configuraciones\\PlantillaCorreoService;\nuse App\\Http\\Repositories\\Vacantes\\FormatoEntrevistaRepository;\nuse App\\Http\\Repositories\\Vacantes\\EtapaVacanteUsuarioRepository;\nuse App\\Http\\Services\\Configuraciones\\ConfiguracionModeloService;\nuse App\\Http\\Repositories\\Vacantes\\EtapaMovimientoVacanteRepository;\nuse App\\Http\\Repositories\\OfertasLaborales\\PreguntaOfertaLaboralRepository;\nuse App\\Http\\Repositories\\Usuarios\\PerfilesLaborales\\PerfilLaboralRepository;\nuse App\\Http\\Repositories\\OfertasLaborales\\PuntajePreguntaOfertaLaboralRepository;\n\n/**\n * @property EtapaVacanteUsuarioRepository $repositorio\n */\nclass EtapaVacanteUsuarioService extends BaseService\n{\n    use ArchivoTrait, IATrait, StringTrait;\n\n    /**\n     * @var float|int $puntaje_total Puntaje total, utilizado para la adecuación de HV.\n     */\n    private $puntaje_total = 0;\n\n    /**\n     * @var float $puntaje Puntaje de aspecto, utilizado para la adecuación de HV.\n     */\n    private $puntaje = 0;\n\n    /**\n     * @var bool $cumple Indica si cumple con el aspecto, utilizada para la adecuación de HV.\n     */\n    private $cumple = false;\n\n    /**\n     * Constructor.\n     *\n     * @param EtapaVacanteUsuarioRepository $repositorio Repositorio de etapas de vacantes de usuarios.\n     * @param PerfilLaboralRepository $perfil_laboral_repositorio Repositorio de perfiles laborales.\n     * @param EtapaVacanteRepository $etapa_vacante_repositorio Repositorio de etapas de vacantes.\n     * @param AspectoPuntajeRepository $aspecto_puntaje_repositorio Repositorio de puntajes de aspectos.\n     * @param ArchivoService $archivo_servicio Servicio de archivos.\n     * @param ArchivoRepository $archivo_repositorio Repositorio de archivos.\n     * @param EmpresaUsuarioRepository $empresa_usuario_repositorio Repositorio de usuarios de empresas.\n     * @param PreguntaOfertaLaboralRepository $pregunta_oferta_laboral_repositorio Repositorio de preguntas de ofertas laborales.\n     * @param PuntajePreguntaOfertaLaboralRepository $puntaje_pregunta_oferta_laboral_repositorio Repositorio de puntajes de preguntas de ofertas laborales.\n     * @param EtapaMovimientoVacanteRepository $etapa_movimiento_vacante_repositorio Repositorio de movimientos de etapas de vacantes.\n     * @param ProcesoRepository $proceso_repositorio Repositorio de procesos.\n     * @param TranscripcionRepository $transcripcion_repositorio Repositorio de transcripciones.\n     * @param PlantillaCorreoService $plantilla_correo_servicio Servicio de plantillas de correo.\n     * @param TokenAccesoService $token_acceso_servicio Servicio de tokens de acceso.\n     * @param UserRepository $usuario_repositorio Servicio de usuarios.\n     * @param VacanteRepository $vacante_repositorio Repositorio de vacantes.\n     * @param AgendaRepository $agenda_repositorio Repositorio de agendas.\n     * @param ResultadoAgendaService $resultado_agenda_servicio Servicio de resultados de agendas.\n     * @param ConfiguracionModeloService $configuracion_modelo_servicio Servicio de configuraciones de modelos.\n     * @param FormatoEntrevistaRepository $formato_entrevista_repositorio Repositorio de formatos de entrevista.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function __construct(\n        EtapaVacanteUsuarioRepository $repositorio,\n        protected PerfilLaboralRepository $perfil_laboral_repositorio,\n        protected EtapaVacanteRepository $etapa_vacante_repositorio,\n        protected AspectoPuntajeRepository $aspecto_puntaje_repositorio,\n        protected ArchivoService $archivo_servicio,\n        protected ArchivoRepository $archivo_repositorio,\n        protected EmpresaUsuarioRepository $empresa_usuario_repositorio,\n        protected PreguntaOfertaLaboralRepository $pregunta_oferta_laboral_repositorio,\n        protected PuntajePreguntaOfertaLaboralRepository $puntaje_pregunta_oferta_laboral_repositorio,\n        protected EtapaMovimientoVacanteRepository $etapa_movimiento_vacante_repositorio,\n        protected ProcesoRepository $proceso_repositorio,\n        protected TranscripcionRepository $transcripcion_repositorio,\n        protected PlantillaCorreoService $plantilla_correo_servicio,\n        protected TokenAccesoService $token_acceso_servicio,\n        protected UserRepository $usuario_repositorio,\n        protected VacanteRepository $vacante_repositorio,\n        protected AgendaRepository $agenda_repositorio,\n        protected ResultadoAgendaService $resultado_agenda_servicio,\n        protected ConfiguracionModeloService $configuracion_modelo_servicio,\n        protected FormatoEntrevistaRepository $formato_entrevista_repositorio\n    ) {\n        parent::__construct($repositorio);\n    }\n\n    /**\n     * Guardar documento solicitado de una etapa de vacante de usuario.\n     *\n     * @param Request $request Contenido de la petición.\n     * @return void\n     * @author Andres Gonzalez\n     */\n    public function guardarDocumentoSolicitado(Request $request): void {\n        $empresa = $this->empresa_usuario_repositorio->obtenerEmpresaActualUsuario();\n\n        if ($request->hasFile('archivo')) {\n            $this->archivo_servicio->guardarVarios(EtapaVacanteUsuario::class, $request->etapa_vacante_usuario_id, [$request->nombre_documento => $request->file('archivo')], 'empresas/' . $empresa->id . '/documentos-solicitados', true);\n        }\n    }\n\n    /**\n     * Establecer valores para puntaje y cumplimiento de un aspecto.\n     *\n     * @param float $puntaje Puntaje obtenido.\n     * @param bool $cumple Indica si cumple.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    private function establecerPuntajeCumplimiento(float $puntaje = 0, bool $cumple = false): void {\n        $this->puntaje = $puntaje;\n        $this->cumple  = $cumple;\n    }\n\n    /**\n     * Guardar puntaje de un aspecto evaluado.\n     *\n     * @param int $etapa_vacante_usuario_id ID de la etapa del usuario en la vacante.\n     * @param string $categoria Categoría del aspecto.\n     * @param string $aspecto Aspecto evaluado.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    private function guardarAspectoPuntaje(int $etapa_vacante_usuario_id, string $categoria, string $aspecto): void {\n        $this->aspecto_puntaje_repositorio->crearOActualizar([\n            'etapa_vacante_usuario_id' => $etapa_vacante_usuario_id,\n            'categoria'                => $categoria,\n            'aspecto'                  => $aspecto\n        ], [\n            'puntaje'                  => $this->puntaje,\n            'cumple'                   => $this->cumple\n        ]);\n\n        $this->puntaje_total += $this->puntaje;\n        $this->establecerPuntajeCumplimiento();\n    }\n\n    /**\n     * Generar adecuación de hoja de vida.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function generarAdecuacionHV(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::REVISION_HV_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje)) {\n            $perfil_laboral = $this->perfil_laboral_repositorio->getUnoAvanzado(new Request([\n                'usuario_id'                     => $etapa_usuario->usuario_id,\n                'incluir_experiencias_laborales' => true,\n                'incluir_estudios'               => true,\n                'incluir_idiomas'                => true,\n                'incluir_usuario'                => true\n            ]));\n\n            // Generar y guardar la adecuación del perfil de candidato (habilidades y herramientas tecnológicas)\n            $categoria            = 'perfil';\n            $puntaje_aspecto      = 100 / 2;\n            $datos_vacante        = $etapa_usuario->vacante->datos;\n            $habilidades_vacante  = $datos_vacante->where('llave', 'habilidades')->first();\n            $herramientas_vacante = $datos_vacante->where('llave', 'herramientas_tecnologicas')->first();\n\n            // Validar coincidencia para las habilidades\n            if (!is_null($habilidades_vacante->valor) && !empty($habilidades_vacante->valor)) {\n                $habilidades_vacante        = array_map(fn($item) => trim($item), explode(',', $habilidades_vacante->valor));\n                $habilidades_perfil_laboral = array_map(fn($item) => trim($item), explode(',', $perfil_laboral->habilidades));\n                $coincidencias              = count(array_uintersect($habilidades_vacante, $habilidades_perfil_laboral, 'strcasecmp'));\n\n                if ($coincidencias >= count($habilidades_vacante)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'habilidades');\n\n            // Validar coincidencia para las herramientas tecnológicas\n            if (!is_null($herramientas_vacante->valor) && !empty($herramientas_vacante->valor)) {\n                $herramientas_vacante        = array_map(fn($item) => trim($item), explode(',', $herramientas_vacante->valor));\n                $herramientas_perfil_laboral = array_map(fn($item) => trim($item), explode(',', $perfil_laboral->herramientas_tecnologicas));\n                $coincidencias               = count(array_uintersect($herramientas_vacante, $herramientas_perfil_laboral, 'strcasecmp'));\n\n                if ($coincidencias >= count($herramientas_vacante)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'herramientas');\n\n            // Generar y guardar la adecuación de requisitos del candidato (género, edad, nivel educativo, modalidad de trabajo, salario, experiencia, idiomas, licencia de conducir)\n            $categoria       = 'requisito';\n            $puntaje_aspecto = 100 / 8;\n\n            // Validar coincidencia de género\n            $genero_vacante = $datos_vacante->where('llave', 'genero')->first();\n\n            if (!is_null($genero_vacante) && !empty($genero_vacante)) {\n                if ($genero_vacante->valor === mb_convert_case($perfil_laboral->usuario->genero->nombre, MB_CASE_LOWER)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                } elseif ($genero_vacante->valor === 'indiferente') {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'genero');\n\n            // Validar coincidencia de edad\n            $edad_minima_vacante = $datos_vacante->where('llave', 'edad_minima')->first();\n            $edad_maxima_vacante = $datos_vacante->where('llave', 'edad_maxima')->first();\n\n            if (empty($edad_minima_vacante->valor) || empty($edad_maxima_vacante->valor)) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif ($perfil_laboral->usuario->edad >= $edad_minima_vacante->valor && $perfil_laboral->usuario->edad <= $edad_maxima_vacante->valor) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'edad');\n\n            // Validar coincidencia de nivel educativo\n            $nivel_educativo_vacante = $datos_vacante->where('llave', 'nivel_educativo')->first();\n            $escala_estudios         = [\n                'Preescolar'                      => 1,\n                'Primaria'                        => 2,\n                'Secundaria básica'               => 3,\n                'Secundaria superior'             => 4,\n                'Educación continua y permanente' => 5,\n                'Técnico'                         => 6,\n                'Tecnólogo'                       => 7,\n                'Profesional'                     => 8,\n                'Especialización (postgrado)'     => 9,\n                'Maestría (postgrado)'            => 10,\n                'Doctorado (postgrado)'           => 11\n            ];\n\n            if (empty($nivel_educativo_vacante->valor) || $nivel_educativo_vacante->valor === 'indiferente') {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif (count($perfil_laboral->estudios) > 0) {\n                $cumple_nivel_educativo = false;\n\n                foreach ($perfil_laboral->estudios as $estudio) {\n                    if ($escala_estudios[$nivel_educativo_vacante->valor] <= $escala_estudios[$estudio->nivelEducativo->nombre]) {\n                        $cumple_nivel_educativo = true;\n                        break;\n                    }\n                }\n\n                if ($cumple_nivel_educativo) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'estudios');\n\n            // Validar coincidencia de modalidad de trabajo\n            if (!is_null($etapa_usuario->vacante->modalidad_trabajo_id)) {\n                if ($etapa_usuario->vacante->modalidad_trabajo_id === $perfil_laboral->modalidad_trabajo_id) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'modalidad_trabajo');\n\n            // Validar coincidencia de salario\n            if (is_null($etapa_usuario->vacante->salario)) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif (!is_null($etapa_usuario->vacante->salario) && is_null($etapa_usuario->vacante->salario_maximo)) {\n                // Salario fijo\n                if (!is_null($perfil_laboral->salario_maximo)) {\n                    // Validar cuando el salario de la vacante es fijo pero el del usuario es rango\n                    if (($etapa_usuario->vacante->salario >= $perfil_laboral->salario && $etapa_usuario->vacante->salario <= $perfil_laboral->salario_maximo) || ($perfil_laboral->salario <= $etapa_usuario->vacante->salario && $perfil_laboral->salario_maximo <= $etapa_usuario->vacante->salario)) {\n                        $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                    }\n                } elseif ($perfil_laboral->salario <= $etapa_usuario->vacante->salario) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } elseif (!is_null($etapa_usuario->vacante->salario) && !is_null($etapa_usuario->vacante->salario_maximo)) {\n                // Rango de salario\n                if (!is_null($perfil_laboral->salario_maximo)) {\n                    // Validar cuando el salario del usuario y de la vacante son rangos\n                    if (($perfil_laboral->salario >= $etapa_usuario->vacante->salario && $perfil_laboral->salario <= $etapa_usuario->vacante->salario_maximo) || ($perfil_laboral->salario_maximo >= $etapa_usuario->vacante->salario && $perfil_laboral->salario_maximo <= $etapa_usuario->vacante->salario_maximo)) {\n                        $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                    }\n                } else {\n                    if ($perfil_laboral->salario >= $etapa_usuario->vacante->salario && $perfil_laboral->salario <= $etapa_usuario->vacante->salario_maximo) {\n                        $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                    }\n                }\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'salario');\n\n            // Validar coincidencia de experiencia\n            $experiencia_vacante   = $datos_vacante->where('llave', 'experiencia_laboral')->first();\n            $experiencia_aplicante = $perfil_laboral->experienciasLaborales->sum('tiempo');\n            $experiencias          = [\n                '1 año'        => 1,\n                '2 años'       => 2,\n                '3 años'       => 3,\n                '4 años'       => 4,\n                '5 años o más' => 5\n            ];\n\n            if (empty($experiencia_vacante->valor) || $experiencia_vacante->valor === 'Sin experiencia') {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif ($experiencia_vacante->valor === 'Menos de 1 año') {\n                if ($experiencia_aplicante > 0 && $experiencia_aplicante < 365) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } elseif (($experiencias[$experiencia_vacante->valor] * 365) <= $experiencia_aplicante) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'experiencia');\n\n            // Validar coincidencia de idiomas\n            $idiomas_vacante = $etapa_usuario->vacante->idiomas;\n            $escala_idiomas  = [\n                'A1' => 1,\n                'A2' => 2,\n                'B1' => 3,\n                'B2' => 4,\n                'C1' => 5,\n                'C2' => 6\n            ];\n\n            if ($idiomas_vacante->count() > 0) {\n                $coincidencias_idiomas = 0;\n\n                if ($perfil_laboral->idiomas->count() > 0) {\n                    foreach ($idiomas_vacante as $idioma) {\n                        foreach ($perfil_laboral->idiomas as $idioma_perfil) {\n                            if ($idioma->idioma_id === $idioma_perfil->idioma_id && $escala_idiomas[$idioma->nivel] <= $escala_idiomas[$idioma_perfil->nivel]) {\n                                $coincidencias_idiomas++;\n                            }\n                        }\n                    }\n                }\n\n                if ($coincidencias_idiomas >= $idiomas_vacante->count()) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } else {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'idiomas');\n\n            // Validar coincidencia de licencia de conducir\n            $licencia_conducir_vacante = $datos_vacante->where('llave', 'licencia_conducir')->first();\n            $escala_licencias          = [\n                'A1' => 1,\n                'A2' => 2,\n                'B1' => 3,\n                'B2' => 4,\n                'B3' => 5,\n                'C1' => 6,\n                'C2' => 7,\n                'C3' => 8\n            ];\n\n            if (empty($licencia_conducir_vacante->valor)) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            } elseif (is_null($perfil_laboral->licencia_conducir)) {\n                if (empty($licencia_conducir_vacante->valor)) {\n                    $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n                }\n            } elseif ($escala_licencias[$licencia_conducir_vacante->valor] <= $escala_licencias[$perfil_laboral->licencia_conducir]) {\n                $this->establecerPuntajeCumplimiento($puntaje_aspecto, true);\n            }\n\n            $this->guardarAspectoPuntaje($etapa_usuario->id, $categoria, 'licencia_conducir');\n\n            $puntaje_total = round($this->puntaje_total / 2); // Se divide entre las dos categorías existentes\n            $this->gestionarContinuidadAplicante($etapa_usuario, MovimientoVacante::REVISION_HV_ID, $puntaje_total, 'descartar_candidatos_adecuaciones_bajas_hv', 'descartar_candidatos_adecuaciones_medias_hv');\n        }\n    }\n\n    /**\n     * Generar adecuación para preguntas prefiltro.\n     *\n     * Califica las respuestas del aplicante en cada una de las preguntas y calcula la adecuación en base a sus resultados.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function generarAdecuacionPrefiltro(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje)) {\n            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n                'etapa_vacante_id'   => $etapa_usuario->etapa_vacante_id,\n                'usuario_id'         => $etapa_usuario->usuario_id,\n                'incluir_respuestas' => true\n            ]));\n\n            $porcentaje_pregunta  = 100 / $preguntas->count();\n            $respuestas_correctas = 0;\n\n            foreach ($preguntas as $pregunta) {\n                $puntaje    = null;\n                $puntaje_ia = null;\n\n                if ($pregunta->es_abierta) {\n                    $respuesta = $opcion_seleccionada = $pregunta->respuestas->first();\n\n                    if (!is_null($respuesta)) {\n                        try {\n                            $peticion_ia = $this->realizarPeticionIA(\n                                ruta: 'calificar-pregunta-abierta',\n                                parametros: [\n                                    'pregunta'  => $pregunta->enunciado,\n                                    'respuesta' => $respuesta->respuesta,\n                                ],\n                                contexto_tracking: [\n                                    'vacante_id' => $etapa_usuario->etapa->vacante_id ?? null,\n                                    'agenda_id' => null,\n                                ]\n                            );\n\n                            if (!is_null($peticion_ia) && $peticion_ia['status_code'] === 200) {\n                                $puntaje_ia = $peticion_ia['calificacion'];\n                            }\n                        } catch (RequestException|ConnectionException $error) {}\n                    }\n                } else {\n                    $opciones_correctas = $pregunta->opciones->where('es_correcta', true);\n\n                    // Selección única\n                    if ($opciones_correctas->count() === 1) {\n                        $opcion_correcta     = $opciones_correctas->first();\n                        $opcion_seleccionada = $pregunta->respuestas->first();\n                        $puntaje             = (int) (!is_null($opcion_seleccionada) && $opcion_correcta->id === $opcion_seleccionada->opcion_pregunta_id);\n                    } else { // Selección múltiple\n                        $opciones_correctas     = $opciones_correctas->pluck('id')->toArray();\n                        $opciones_seleccionadas = $pregunta->respuestas->pluck('opcion_pregunta_id')->toArray();\n                        $aciertos               = count(array_intersect($opciones_seleccionadas, $opciones_correctas));\n                        $fallos                 = count(array_diff($opciones_seleccionadas, $opciones_correctas));\n                        $puntaje                = (int) ($aciertos - $fallos === count($opciones_correctas));\n                    }\n                }\n\n                // Guardar el puntaje obtenido en cada pregunta\n                $this->puntaje_pregunta_oferta_laboral_repositorio->crearSiNoExiste([\n                    'pregunta_id' => $pregunta->id,\n                    'usuario_id'  => $etapa_usuario->usuario_id\n                ], [\n                    'puntaje'     => $puntaje,\n                    'puntaje_ia'  => $puntaje_ia\n                ]);\n\n                // Sumar el puntaje total\n                if (is_null($puntaje) && !is_null($puntaje_ia)) {\n                    $respuestas_correctas += $puntaje_ia;\n                } else {\n                    $respuestas_correctas += $puntaje;\n                }\n            }\n\n            $puntaje_etapa = $respuestas_correctas * $porcentaje_pregunta;\n\n            // Obtener el movimiento de la etapa con sus configuraciones\n            $etapa_movimiento = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n                'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n                'movimiento_vacante_id'   => MovimientoVacante::PREGUNTAS_PREFILTRO_ID,\n                'incluir_configuraciones' => true\n            ]));\n\n            $configuracion_preguntas_correctas = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', 'descartar_candidatos_respondieron_menos_preguntas_prefiltro')->first();\n\n            if (!is_null($configuracion_preguntas_correctas) && $respuestas_correctas < $configuracion_preguntas_correctas->valor) {\n                $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje_etapa, descartar: true);\n                return;\n            }\n\n            if ($etapa_usuario->vacante->automatizar_etapas) {\n                $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje_etapa);\n            } else {\n                $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje_etapa]);\n            }\n        }\n    }\n\n    /**\n     * Guardar el puntaje de adecuación dado por el reclutador.\n     *\n     * Guarda la adecuación para las etapas de prueba técnica, videoentrevista y entrevista.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @param int $puntaje Puntaje dado por el reclutador.\n     * @param bool $forzar_actualizacion Si es true, omite la validación de puntaje nulo.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function guardarPuntajeAdecuacionReclutador(int $id, int $puntaje, bool $forzar_actualizacion = false): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        if ($etapa_usuario->activo && ($forzar_actualizacion || is_null($etapa_usuario->puntaje))) {\n            if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n                $this->gestionarContinuidadAplicante($etapa_usuario, MovimientoVacante::PRUEBA_TECNICA_ID, $puntaje, 'descartar_candidatos_adecuaciones_bajas_prueba_tecnica', 'descartar_candidatos_adecuaciones_medias_prueba_tecnica');\n            }\n\n            if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::VIDEO_ENTREVISTA_NOMBRE, EtapaVacante::ENTREVISTA_NOMBRE])) {\n                if ($etapa_usuario->etapa->nombre === EtapaVacante::VIDEO_ENTREVISTA_NOMBRE) {\n                    $movimiento_vacante_id                   = MovimientoVacante::SOLICITUD_VIDEOENTREVISTA_ID;\n                    $llave_configuracion_formato             = 'solicitar_formato_videoentrevista';\n                    $llave_configuracion_adecuaciones_bajas  = 'descartar_candidatos_adecuaciones_bajas_videoentrevista';\n                    $llave_configuracion_adecuaciones_medias = 'descartar_candidatos_adecuaciones_medias_videoentrevista';\n                } else {\n                    $movimiento_vacante_id                   = MovimientoVacante::SOLICITUD_ENTREVISTA_ID;\n                    $llave_configuracion_formato             = 'solicitar_formato_entrevista';\n                    $llave_configuracion_adecuaciones_bajas  = 'descartar_candidatos_adecuaciones_bajas_entrevista';\n                    $llave_configuracion_adecuaciones_medias = 'descartar_candidatos_adecuaciones_medias_entrevista';\n                }\n\n                if ($this->verificarFormatoEntrevista($etapa_usuario, $movimiento_vacante_id, $llave_configuracion_formato)) {\n                    $this->gestionarContinuidadAplicante($etapa_usuario, $movimiento_vacante_id, $puntaje, $llave_configuracion_adecuaciones_bajas, $llave_configuracion_adecuaciones_medias);\n                } else {\n                    $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje]);\n                }\n\n                // TODO: Invocar esta función al momento de completar el formato de entrevista\n            }\n        }\n    }\n\n    /**\n     * Generar adecuación para pruebas psicométricas.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function generarAdecuacionPruebasPsicometricas(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje)) {\n            $indice_talento = $this->proceso_repositorio->obtenerIndiceTalento($etapa_usuario->vacante->proceso->id, $etapa_usuario->usuario_id)->indice_talento;\n\n            if ($indice_talento >= 0) {\n                $this->gestionarContinuidadAplicante($etapa_usuario, MovimientoVacante::PRUEBAS_PSICOMETRICAS_ID, $indice_talento, 'descartar_candidatos_puntuaciones_bajas', 'descartar_candidatos_puntuaciones_medias', true);\n            }\n        }\n    }\n\n    /**\n     * Generar adecuación para videoentrevista.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function generarAdecuacionVideoentrevista(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n\n        // Validar que sea la etapa actual del aplicante y no que tenga puntaje\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::VIDEO_ENTREVISTA_NOMBRE && $etapa_usuario->activo && is_null($etapa_usuario->puntaje_ia)) {\n            ProcesarVideoentrevistaIAJob::dispatch($etapa_usuario->id);\n        }\n    }\n\n    /**\n     * Verificar si la etapa tiene activado el formato de entrevista y si ya está diligenciado por parte del aplicante.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa del usuario en la vacante.\n     * @param int $movimiento_vacante_id ID del movimiento de la vacante.\n     * @param string $llave_configuracion Llave de configuración para formato de entrevista.\n     * @return bool Devuelve true cuando no existe la configuración, está deshabilitada o ya haya sido completada por el aplicante, false en caso de estar habilitada pero no completada por el aplicante.\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function verificarFormatoEntrevista(EtapaVacanteUsuario $etapa_usuario, int $movimiento_vacante_id, string $llave_configuracion): bool {\n        $formato_diligenciado = false;\n        $etapa_movimiento     = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n            'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n            'movimiento_vacante_id'   => $movimiento_vacante_id,\n            'incluir_configuraciones' => true\n        ]));\n\n        $configuracion_formato_entrevista = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_configuracion)->first();\n\n        if (!is_null($configuracion_formato_entrevista) && (bool) $configuracion_formato_entrevista->valor) {\n            if ($movimiento_vacante_id == MovimientoVacante::SOLICITUD_VIDEOENTREVISTA_ID) {\n                $formato_entrevista = $this->formato_entrevista_repositorio->getUnoAvanzado(new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id]));\n\n                if (!is_null($formato_entrevista) && !is_null($formato_entrevista->descripcion_vacante) && !empty($formato_entrevista->descripcion_vacante)) {\n                    $formato_diligenciado = true;\n                }\n            } else {\n                $formato_diligenciado = $this->verificarEtapaCompletada($etapa_usuario->id);\n            }\n        } else {\n            $formato_diligenciado = true;\n        }\n\n        return $formato_diligenciado;\n    }\n\n    /**\n     * Recalcular adecuación para preguntas prefiltro sin utilizar IA.\n     *\n     * @param int $etapa_vacante_id ID de la etapa de la vacante.\n     * @param int $usuario_id ID del usuario (aplicante).\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function recalcularAdecuacionPrefiltro(int $etapa_vacante_id, int $usuario_id): void {\n        $etapa_usuario = $this->repositorio->getUnoAvanzado(new Request([\n            'etapa_vacante_id' => $etapa_vacante_id,\n            'usuario_id'       => $usuario_id\n        ]));\n\n        if ($etapa_usuario->activo) {\n            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n                'etapa_vacante_id' => $etapa_usuario->etapa_vacante_id,\n                'usuario_id'       => $etapa_usuario->usuario_id,\n                'incluir_puntajes' => true\n            ]));\n\n            $puntaje            = 0;\n            $puntaje_individual = 100 / $preguntas->count();\n\n            foreach ($preguntas as $pregunta) {\n                if (is_null($pregunta->puntajes[0]->puntaje) && !is_null($pregunta->puntajes[0]->puntaje_ia)) {\n                    $puntaje += $pregunta->puntajes[0]->puntaje_ia;\n                } elseif (!is_null($pregunta->puntajes[0]->puntaje)) {\n                    $puntaje += $pregunta->puntajes[0]->puntaje;\n                }\n            }\n\n            $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje_individual * $puntaje]);\n        }\n    }\n\n    /**\n     * Guardar el puntaje de la etapa actual y gestionar la continuidad del aplicante en la vacante.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param int $movimiento_vacante_id ID del movimiento de la vacante.\n     * @param int $puntaje Puntaje obtenido en la etapa actual.\n     * @param string $llave_puntajes_bajos Llave de configuración para puntajes bajos.\n     * @param string $llave_puntajes_medios Llave de configuración para puntajes medios.\n     * @param bool $escala_pruebas_psicometricas Indica si debe utilizar la escala de puntajes de pruebas psicométricas.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function gestionarContinuidadAplicante(EtapaVacanteUsuario $etapa_usuario, int $movimiento_vacante_id, int $puntaje, string $llave_puntajes_bajos, string $llave_puntajes_medios, bool $escala_pruebas_psicometricas = false) {\n        $calificacion_baja  = 40;\n        $calificacion_media = 70;\n\n        if ($escala_pruebas_psicometricas) {\n            $calificacion_baja  = 59;\n            $calificacion_media = 75;\n        }\n\n        // Obtener el movimiento de la etapa con sus configuraciones\n        $etapa_movimiento = $this->etapa_movimiento_vacante_repositorio->getUnoAvanzado(new Request([\n            'etapa_vacante_id'        => $etapa_usuario->etapa_vacante_id,\n            'movimiento_vacante_id'   => $movimiento_vacante_id,\n            'incluir_configuraciones' => true\n        ]));\n\n        $configuracion_adecuaciones_bajas  = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_bajos)->first();\n        $configuracion_adecuaciones_medias = $etapa_movimiento->configuraciones->where('movimientoConfiguracion.llave', $llave_puntajes_medios)->first();\n\n        if (!is_null($configuracion_adecuaciones_medias) && filter_var($configuracion_adecuaciones_medias->valor, FILTER_VALIDATE_BOOLEAN) && $puntaje <= $calificacion_media) {\n            $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje, descartar: true);\n            return;\n        } elseif (!is_null($configuracion_adecuaciones_bajas) && filter_var($configuracion_adecuaciones_bajas->valor, FILTER_VALIDATE_BOOLEAN) && $puntaje <= $calificacion_baja) {\n            $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje, descartar: true);\n            return;\n        }\n\n        if ($etapa_usuario->vacante->automatizar_etapas) {\n            $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $puntaje);\n        } else {\n            $this->repositorio->actualizar($etapa_usuario->id, ['puntaje' => $puntaje]);\n        }\n    }\n\n    /**\n     * Guardar puntaje de la etapa actual y mover al aplicante a la siguiente etapa.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param ?int $puntaje Puntaje obtenido en la etapa actual.\n     * @param ?int $puntaje_ia Puntaje obtenido por la IA en la etapa actual.\n     * @param ?string $notas_ia Notas dadas por la IA para la etapa actual.\n     * @param bool $descartar Indica si la etapa a la que se debe cambiar es 'descartados'.\n     * @return void\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     * @author Esperanza Olivo\n     * @author Sergio Vargas\n     */\n    public function guardarPuntajeYCambiarDeEtapa(EtapaVacanteUsuario $etapa_usuario, ?int $puntaje = null, ?int $puntaje_ia = null, ?string $notas_ia = null, bool $descartar = false, bool $es_manual = false): void {\n        if ($descartar) {\n            $etapa_siguiente = $this->etapa_vacante_repositorio->getUnoAvanzado(new Request(['vacante_id' => $etapa_usuario->vacante->id, 'nombre' => EtapaVacante::DESCARTADOS_NOMBRE]));\n        } else {\n            $etapa_siguiente = $this->etapa_vacante_repositorio->obtenerEtapaSiguiente($etapa_usuario->vacante->id, $etapa_usuario->etapa->orden);\n        }\n\n        $etapa_actual_activa = true;\n\n        if ($etapa_siguiente->nombre !== EtapaVacante::CONTRATADOS_NOMBRE) {\n            $etapa_actual_activa = false;\n            $this->guardarEtapa($etapa_usuario, $etapa_siguiente);\n        } elseif ($es_manual) {\n            $etapa_actual_activa = false;\n            $this->guardarEtapa($etapa_usuario, $etapa_siguiente);\n        }\n\n        $this->repositorio->actualizar($etapa_usuario->id, [\n            'puntaje'    => $puntaje,\n            'puntaje_ia' => $puntaje_ia,\n            'notas_ia'   => $notas_ia,\n            'activo'     => $etapa_actual_activa\n        ]);\n\n        // Cuando la etapa es contratado, se valida si ya se han completado las vacantes requeridas para cerrar la vacante\n        if ($etapa_siguiente->nombre === EtapaVacante::CONTRATADOS_NOMBRE) {\n            if ($etapa_usuario->vacante->cantidad_vacantes === $this->repositorio->contarContratados($etapa_usuario->etapa->vacante_id)) {\n                $this->vacante_repositorio->actualizar($etapa_usuario->etapa->vacante_id, ['estado_id' => EstadoVacante::COMPLETADA_ID]);\n\n                $aplicantes_activos_restantes_ids = $this->repositorio->getTodo(new Request([\n                    'vacante_id'             => $etapa_usuario->etapa->vacante_id,\n                    'activo'                 => true,\n                    'excluir_etapas'         => [EtapaVacante::DESCARTADOS_NOMBRE, EtapaVacante::CONTRATADOS_NOMBRE]\n                ]))->pluck('id')->toArray();\n\n                // Descartar a los aplicantes que quedan activos en la vacante\n                $this->descartarAplicantesManual($aplicantes_activos_restantes_ids);\n\n                $aplicantes_activos_sin_notificar = $this->repositorio->getTodo(new Request([\n                    'vacante_id'             => $etapa_usuario->etapa->vacante_id,\n                    'activo'                 => true,\n                    'sin_fecha_notificacion' => true\n                ]));\n\n                foreach ($aplicantes_activos_sin_notificar as $aplicante) {\n                    $this->notificarCambioEtapa($aplicante, false);\n                }\n            }\n        }\n    }\n\n    /**\n     * Crear y activar la siguiente etapa del aplicante.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param EtapaVacante $etapa_siguiente Etapa siguiente a crear.\n     * @return ?EtapaVacanteUsuario\n     * @author Esperanza Olivo\n     */\n    public function guardarEtapa(EtapaVacanteUsuario $etapa_usuario, EtapaVacante $etapa_siguiente): ?EtapaVacanteUsuario {\n        $nueva_etapa_usuario = $this->repositorio->crear([\n            'usuario_id'       => $etapa_usuario->usuario_id,\n            'etapa_vacante_id' => $etapa_siguiente->id,\n            'activo'           => true\n        ]);\n\n        app(VacanteService::class)->crearAgendasPruebasPsicometricas($etapa_usuario, $etapa_siguiente->id);\n\n        if ($nueva_etapa_usuario) {\n            $this->notificarCambioEtapa($nueva_etapa_usuario);\n        }\n\n        return $nueva_etapa_usuario;\n    }\n\n    /**\n     * Obtener la adecuación actual del usuario en la vacante.\n     *\n     * @param int $usuario_id ID del usuario.\n     * @param int $vacante_id ID de la vacante.\n     * @return ?int\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function obtenerAdecuacionUsuario(int $usuario_id, int $vacante_id): ?int {\n        $etapas     = $this->repositorio->obtenerEtapasCompletadasUsuario($usuario_id, $vacante_id);\n        $adecuacion = 0;\n\n        foreach ($etapas as $etapa) {\n            if (!is_null($etapa->puntaje)) {\n                $adecuacion += $etapa->puntaje;\n            } elseif (is_null($etapa->puntaje) && !is_null($etapa->puntaje_ia)) {\n                $adecuacion += $etapa->puntaje_ia;\n            }\n        }\n\n        return ($etapas->count() > 0) ? $adecuacion / $etapas->count() : null;\n    }\n\n    /**\n     * Verificar si una etapa ya ha sido completada por el aplicante.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante (etapa_vacante_usuario_id).\n     * @return bool\n     * @author Daniel Beltrán\n     * @author Andres Gonzalez\n     */\n    public function verificarEtapaCompletada(int $id): bool {\n        $etapa_usuario    = $this->repositorio->getUno($id);\n        $etapa_completada = false;\n\n        // Verificar si la etapa de revisión de hoja de vida ya fue completada\n        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::REVISION_HV_NOMBRE, EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE]) && !is_null($etapa_usuario->puntaje) || !is_null($etapa_usuario->puntaje_ia)) {\n            $etapa_completada = true;\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::ENTREVISTA_NOMBRE) {\n            if ($this->configuracion_modelo_servicio->obtenerValorLlaveConfiguracion(app(VacanteService::class)->obtenerConfiguracionesEtapaAplicante($etapa_usuario->etapa_vacante_id), 'solicitar_formato_entrevista')) {\n                $formato_entrevista = $this->formato_entrevista_repositorio->getUnoAvanzado(new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id]));\n\n                if (!is_null($formato_entrevista) && !is_null($formato_entrevista->descripcion_vacante) && !empty($formato_entrevista->descripcion_vacante)) {\n                    $etapa_completada = true;\n                }\n            } else {\n                $etapa_completada = true;\n            }\n        }\n\n        // Verificar si las etapas de preguntas prefiltro o videoentrevista ya han sido completadas\n        if (in_array($etapa_usuario->etapa->nombre, [EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE, EtapaVacante::VIDEO_ENTREVISTA_NOMBRE])) {\n            $preguntas = $this->pregunta_oferta_laboral_repositorio->getTodo(new Request([\n                'etapa_vacante_id'                      => $etapa_usuario->etapa_vacante_id,\n                'usuario_id'                            => $etapa_usuario->usuario_id,\n                'incluir_cantidad_respuestas_aplicante' => true\n            ]));\n\n            $preguntas_contestadas = 0;\n\n            foreach ($preguntas as $pregunta) {\n                if ($pregunta['respuestas_count'] > 0) {\n                    $preguntas_contestadas++;\n                }\n            }\n\n            // Validar que todas las preguntas hayan sido contestadas\n            if (count($preguntas) === $preguntas_contestadas) {\n                $etapa_completada = true;\n            }\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n            if ((!is_null($etapa_usuario->pruebaTecnica?->enlace) && !empty($etapa_usuario->pruebaTecnica?->enlace) || $etapa_usuario->pruebaTecnica?->archivos->count() > 0) && $etapa_usuario->pruebaTecnica?->borrador == false) {\n                $etapa_completada = true;\n            }\n        }\n\n        if ($etapa_usuario->etapa->nombre === EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE) {\n            $documentos_contratacion = app(EtapaVacanteService::class)->obtenerDocumentosContratacion(\n                $etapa_usuario->etapa_vacante_id,\n                new Request(['etapa_vacante_usuario_id' => $etapa_usuario->id])\n            );\n\n            $documentos_solicitados     = collect($documentos_contratacion['documentos']);\n            $archivos_guardados         = collect($documentos_contratacion['archivos_guardados']);\n            $archivos_guardados_nombres = $archivos_guardados->pluck('nombre')->toArray();\n\n            $todos_cargados = true;\n            foreach ($documentos_solicitados as $documento) {\n                $nombre_normalizado = $this->normalizarNombreDocumento($documento['nombre']);\n\n                if (!in_array($nombre_normalizado, $archivos_guardados_nombres)) {\n                    $todos_cargados = false;\n                    break;\n                }\n            }\n\n            if ($todos_cargados && $documentos_solicitados->count() > 0 && !is_null($etapa_usuario->fecha_ejecucion)) {\n                $etapa_completada = true;\n            }\n        }\n\n        return $etapa_completada;\n    }\n\n    /**\n     * Notificar documentos solicitados.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Jair Carvajal\n     * @author Daniel Beltrán\n     */\n    public function notificarDocumentosSolicitados(int $id): void {\n        $etapa_vacante_usuario = $this->repositorio->getUno($id);\n\n        if ($etapa_vacante_usuario) {\n            $this->enviarCorreoFinalizacionEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->vacante); \n\n            // Actualizar fecha de ejecución de la etapa\n            $this->repositorio->actualizar($etapa_vacante_usuario->id, ['fecha_ejecucion' => now()]);\n        }\n    }\n\n    /**\n     * Descartar uno o varios aplicantes manualmente y moverlos a la etapa de descartados.\n     *\n     * @param array $ids IDs de las etapas de usuarios en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Daniel Beltrán\n     * @author Sergio Vargas\n     */\n    public function descartarAplicantesManual(array $ids): void {\n        foreach ($ids as $id) {\n            $etapa_vacante_usuario = $this->repositorio->getUno($id);\n\n            if ($etapa_vacante_usuario) {\n                $this->guardarPuntajeYCambiarDeEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->puntaje ?? 0, descartar: true, es_manual: true);\n            }\n        }\n    }\n\n    /**\n     * Revertir descarte de aplicantes.\n     *\n     * @param array $ids IDs de las etapas de los usuarios descartados en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     */\n    public function revertirDescarteAplicantes(array $ids): void {\n        foreach ($ids as $id) {\n            $etapa_descartado = $this->repositorio->getUno($id);\n\n            if ($etapa_descartado && $etapa_descartado->etapa->nombre === EtapaVacante::DESCARTADOS_NOMBRE && $etapa_descartado->activo) {\n                $etapas_no_descartados = $this->etapa_vacante_repositorio->getTodo(new Request(['vacante_id' => $etapa_descartado->vacante->id]))->where('nombre', '!=', EtapaVacante::DESCARTADOS_NOMBRE);\n                $etapas_ids            = $etapas_no_descartados->pluck('id')->toArray();\n                $etapa_previa          = $this->repositorio->obtenerEtapaPrevia($etapa_descartado->usuario_id, $etapas_ids);\n\n                if ($etapa_previa) {\n                    $this->repositorio->eliminar($etapa_descartado->id);\n                    $this->repositorio->actualizar($etapa_previa->id, ['activo' => true]);\n                }\n            }\n        }\n    }\n\n    /**\n     * Mover manualmente al aplicante a la siguiente etapa.\n     *\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Daniel Beltrán\n     * @author Sergio Vargas\n     */\n    public function moverAplicanteEtapaManual(int $id): void {\n        $etapa_usuario = $this->repositorio->getUno($id);\n        $this->guardarPuntajeYCambiarDeEtapa($etapa_usuario, $etapa_usuario->puntaje ?? 0, es_manual: true);\n    }\n\n    /**\n     * Marcar la vacante como abandonada por el aplicante.\n     *\n     * @param Request $request Contenido de la petición.\n     * @return void\n     * @author Andres Gonzalez\n     * @author Daniel Beltrán\n     */\n    public function abandonarVacante(Request $request): void {\n        $etapas_no_descartados = $this->etapa_vacante_repositorio->getTodo(new Request(['vacante_id' => $request->vacante_id]))->where('nombre', '!=', EtapaVacante::DESCARTADOS_NOMBRE);\n        $etapas_ids            = $etapas_no_descartados->pluck('id')->toArray();\n        $etapa_vacante_usuario = $this->repositorio->obtenerEtapaPrevia($request->usuario_id, $etapas_ids);\n\n        if ($etapa_vacante_usuario) {\n            $this->repositorio->actualizar($etapa_vacante_usuario->id, ['motivo_abandono' => $request->motivo_abandono]);\n            $this->guardarPuntajeYCambiarDeEtapa($etapa_vacante_usuario, $etapa_vacante_usuario->puntaje ?? 0, descartar: true);\n        }\n    }\n\n    /**\n     * Notificar al aplicante sobre el cambio de etapa.\n     *\n     * @param EtapaVacanteUsuario $etapa_usuario Etapa actual del usuario.\n     * @param bool $aplicar_validacion_fin_proceso Indica si se debe aplicar la validación de fin de proceso.\n     * @return void\n     * @author Andres Gonzalez\n     */\n    public function notificarCambioEtapa(EtapaVacanteUsuario $etapa_usuario, bool $aplicar_validacion_fin_proceso = true): void {\n        $etapa_usuario->load(['etapa', 'vacante', 'usuario']);\n        $etapa = $etapa_usuario->etapa;\n\n        if ($etapa->nombre === EtapaVacante::PRUEBA_TECNICA_NOMBRE) {\n            $configuraciones_prueba_tecnica = app(EtapaVacanteService::class)->obtenerConfiguracionesPruebaTecnica($etapa->id);\n\n            if (!($configuraciones_prueba_tecnica['prueba_cargada'] ?? false)) {\n                return;\n            }\n        }\n\n        $plantilla_correo_id = [\n            EtapaVacante::PREGUNTAS_PREFILTRO_NOMBRE     => PlantillaCorreo::PREGUNTAS_PRE_FILTRO_ID,\n            EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE   => PlantillaCorreo::PRUEBAS_PSICOMETRICAS_ID,\n            EtapaVacante::PRUEBA_TECNICA_NOMBRE          => PlantillaCorreo::ENVIO_PRUEBA_TECNICA_ID,\n            EtapaVacante::VIDEO_ENTREVISTA_NOMBRE        => PlantillaCorreo::SOLICITUD_VIDEOENTREVISTAS_ID,\n            EtapaVacante::ENTREVISTA_NOMBRE              => PlantillaCorreo::NOTIFICACION_ENTREVISTA_ID,\n            EtapaVacante::DOCUMENTOS_CONTRATACION_NOMBRE => PlantillaCorreo::SOLICITUD_DOCUMENTOS_ID,\n            EtapaVacante::CONTRATADOS_NOMBRE             => PlantillaCorreo::NOTIFICACION_CONTRATADOS_ID,\n            EtapaVacante::DESCARTADOS_NOMBRE             => PlantillaCorreo::NOTIFICACION_DESCARTADOS_ID\n        ][$etapa->nombre] ?? null;\n\n        if (isset($plantilla_correo_id)) {\n            $plantilla_correo_etapa = $this->plantilla_correo_servicio->obtenerUno(new Request([\n                'plantilla_correo_id' => $plantilla_correo_id,\n                'empresa_id'          => $etapa_usuario->vacante->empresa_id\n            ]));\n\n            if (!is_null($plantilla_correo_etapa)) {\n                $es_etapa_fin_proceso = in_array($etapa->nombre, [\n                    EtapaVacante::CONTRATADOS_NOMBRE,\n                    EtapaVacante::DESCARTADOS_NOMBRE\n                ]);\n\n                // Si es etapa de fin de proceso y notificar_fin_proceso es true, no enviar notificación\n                if ($aplicar_validacion_fin_proceso && $es_etapa_fin_proceso && $plantilla_correo_etapa->notificar_fin_proceso) {\n                    return;\n                }\n\n                $usuario            = $etapa_usuario->usuario;\n                $vacante            = $etapa_usuario->vacante;\n                $token_acceso       = $this->token_acceso_servicio->generar($usuario->id);\n                $enlace             = request()->getSchemeAndHttpHost() . \"/control-acceso/{$token_acceso->token}?vacante_id={$vacante->id}\";\n                $usuario_informador = null;\n\n                if ($etapa->nombre !== EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE) {\n                    Mail::to($usuario->email)->queue(new NotificarPostulanteVacanteMail(\n                        $usuario,\n                        $enlace,\n                        $vacante,\n                        $plantilla_correo_etapa->titulo,\n                        $plantilla_correo_etapa->contenido,\n                        $plantilla_correo_etapa->con_logo_empresa,\n                        $etapa->nombre,\n                        $usuario_informador\n                    ));\n                }\n\n                // Enviar notificación de avance en el proceso\n                $usuario->notify(new NotificarAvanceProcesoNotification(\n                    $vacante->id,\n                    $vacante->nombre_vacante,\n                    $etapa->nombre,\n                    $vacante->empresa->nombre ?? 'la empresa'\n                ));\n\n                $this->repositorio->actualizar($etapa_usuario->id, ['fecha_notificacion' => now()]);\n            }\n        }\n    }\n\n    /**\n     * Enviar correo de notificación al finalizar una etapa.\n     *\n     * @param EtapaVacanteUsuario $etapa_vacante_usuario Etapa del usuario en la vacante.\n     * @param Vacante $vacante Vacante.\n     * @return void\n     * @author Jair Carvajal\n     */\n    private function enviarCorreoFinalizacionEtapa(EtapaVacanteUsuario $etapa_vacante_usuario, Vacante $vacante): void {\n        $usuario     = Auth::user();\n        $maneja_logo = file_exists(public_path('empresas-logo/' . $vacante->empresa->id)) ? '1' : null;\n\n        Mail::send(new NotificarFinalizacionEtapaMail(\n            $usuario,\n            $vacante,\n            $etapa_vacante_usuario->etapa,\n            $maneja_logo\n        ));\n    }\n\n    /**\n     * Obtener candidatos recomendados con IA.\n     *\n     * Obtiene los 3 mejores candidatos para la vacante, entre varios candidatos seleccionados por el reclutador.\n     *\n     * @param Request $request Contenido de la petición.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function obtenerCandidatosRecomendadosIA(Request $request): array {\n        $vacante       = $this->vacante_repositorio->getUno($request->vacante_id);\n        $candidatos    = $this->usuario_repositorio->obtenerCandidatosSeleccionadosVacante($request->usuarios_ids, $request->vacante_id);\n        $candidatos_ia = [];\n        $vacante_ia    = [\n            ...Arr::only($vacante->toArray(), ['nombre_vacante', 'salario', 'salario_maximo']),\n            'habilidades'               => $vacante->datos->first(fn($item) => $item->llave === 'habilidades')->valor,\n            'herramientas_tecnologicas' => $vacante->datos->first(fn($item) => $item->llave === 'herramientas_tecnologicas')->valor,\n            'experiencia_laboral'       => $vacante->datos->first(fn($item) => $item->llave === 'experiencia_laboral')->valor,\n            'nivel_educativo'           => $vacante->datos->first(fn($item) => $item->llave === 'nivel_educativo')->valor\n        ];\n\n        if (!is_null($vacante->ciudad_id)) {\n            $direccion_trabajo = $vacante->datos->first(fn($item) => $item->llave === 'direccion_trabajo')->valor;\n            $ubicacion_empresa = \"{$vacante->ciudad->departamento->pais->nombre}, {$vacante->ciudad->departamento->nombre} - {$vacante->ciudad->nombre}, {$direccion_trabajo}\";\n        } elseif (!is_null($vacante->empresa->ciudad_id)) {\n            $ubicacion_empresa = \"{$vacante->empresa->ciudad->departamento->pais->nombre}, {$vacante->empresa->ciudad->departamento->nombre} - {$vacante->empresa->ciudad->nombre}, {$vacante->empresa->direccion}\";\n        }\n\n        if (isset($ubicacion_empresa)) {\n            $vacante_ia['ubicacion'] = $ubicacion_empresa;\n        }\n\n        foreach ($candidatos as $candidato) {\n            if (!is_null($candidato->ciudad_id) && !is_null($candidato->direccion)) {\n                $ubicacion = \"{$candidato->ciudad->departamento->pais->nombre}, {$candidato->ciudad->departamento->nombre} - {$candidato->ciudad->nombre}, {$candidato->direccion}\";\n            }\n\n            $usuario = [\n                ...Arr::only($candidato->toArray(), ['id', 'nombre_completo', 'email', 'telefono', 'edad']),\n                'adecuacion' => $this->obtenerAdecuacionUsuario($candidato->id, $request->vacante_id)\n            ];\n\n            if (isset($ubicacion)) {\n                $usuario['ubicacion'] = $ubicacion;\n            }\n\n            if (!is_null($candidato->perfilLaboral)) {\n                $usuario['salario']                   = $candidato->perfilLaboral->salario;\n                $usuario['salario_maximo']            = $candidato->perfilLaboral->salario_maximo;\n                $usuario['habilidades']               = $candidato->perfilLaboral->habilidades;\n                $usuario['herramientas_tecnologicas'] = $candidato->perfilLaboral->herramientas_tecnologicas;\n                $usuario['estudios']                  = [];\n                $usuario['experiencias_laborales']    = [];\n                $usuario['idiomas']                   = [];\n                $usuario['etapas']                    = [];\n\n                foreach ($candidato->perfilLaboral->estudios as $item) {\n                    array_push($usuario['estudios'], [\n                        ...Arr::only($item->toArray(), ['titulo', 'fecha_inicio', 'fecha_fin']),\n                        'nivel_educativo' => $item->nivelEducativo->nombre,\n                    ]);\n                }\n\n                foreach ($candidato->perfilLaboral->experienciasLaborales as $item) {\n                    array_push($usuario['experiencias_laborales'], [...Arr::only($item->toArray(), ['empresa', 'cargo', 'fecha_inicio', 'fecha_fin', 'tiempo'])]);\n                }\n\n                foreach ($candidato->perfilLaboral->idiomas as $item) {\n                    array_push($usuario['idiomas'], [\n                        'idioma' => $item->idioma->nombre,\n                        'nivel'  => $item->nivel\n                    ]);\n                }\n\n                foreach ($candidato->etapasUsuarios as $item) {\n                    $datos_etapas = [\n                        'nombre'      => $item->etapa->nombre,\n                        'puntaje'     => $item->puntaje,\n                        'puntaje_ia'  => $item->puntaje_ia,\n                        'comentarios' => $item->comentarios->pluck('comentario')->values()->toArray()\n                    ];\n\n                    if ($item->etapa->nombre === EtapaVacante::PRUEBAS_PSICOMETRICAS_NOMBRE) {\n                        $agendas = $this->agenda_repositorio->getTodo(new Request([\n                            'proceso_id'         => $vacante->proceso->id,\n                            'evaluado_id'        => $item->usuario_id,\n                            'estado_id'          => EstadoAgenda::FINALIZADA_ID,\n                            'incluir_resultados' => true\n                        ]));\n\n                        $datos_etapas['pruebas_psicometricas'] = [];\n\n                        foreach ($agendas as $agenda) {\n                            array_push($datos_etapas['pruebas_psicometricas'], [\n                                'prueba'     => $agenda->prueba->nombre,\n                                'ajuste'     => $agenda->ajuste,\n                                'resultados' => $agenda->resultados->map(function ($resultado) {\n                                    return [\n                                        'dimension' => $resultado->dimension->nombre,\n                                        'puntaje'   => $resultado->puntaje_transformado\n                                    ];\n                                })->values()->toArray()\n                            ]);\n                        }\n\n                        if (count($datos_etapas['pruebas_psicometricas']) === 0) {\n                            unset($datos_etapas['pruebas_psicometricas']);\n                        }\n                    }\n\n                    array_push($usuario['etapas'], $datos_etapas);\n                }\n            }\n\n            array_push($candidatos_ia, $usuario);\n        }\n\n        return $this->realizarPeticionIA('obtener-candidatos-recomendados', [\n            'vacante_id' => $request->vacante_id,\n            'vacante'    => json_encode($vacante_ia, JSON_UNESCAPED_UNICODE),\n            'candidatos' => json_encode($candidatos_ia, JSON_UNESCAPED_UNICODE)\n        ]);\n    }\n\n    /**\n     * Obtener competencias por mejorar para usuario que será contratado.\n     * SOLO Buscar agendas de TenDisc Plus (12) y Potencial Comercial (7)\n     * @param int $id ID de la etapa del usuario en la vacante.\n     * @return array\n     * @author Sergio Vargas\n     */\n    public function obtenerCompetenciasPorMejorar(int $id): array {\n        $etapa_vacante_usuario = $this->repositorio->getUno($id);\n        $usuario_id = $etapa_vacante_usuario->usuario_id;\n        $proceso = $etapa_vacante_usuario->vacante->proceso;\n\n        if (is_null($proceso)) {\n            return [\n                'usuario_id' => $usuario_id,\n                'pruebas' => []\n            ];\n        }\n\n        $agendas = $this->agenda_repositorio->getTodo(new Request([\n            'proceso_id' => $proceso->id,\n            'evaluado_id' => $usuario_id,\n            'pruebas_ids' => [12, 7],\n            'estado_id' => 3,\n            'con_evaluado' => true\n        ]));\n\n        $resultado = [\n            'usuario_id' => $usuario_id,\n            'pruebas' => []\n        ];\n\n        foreach ($agendas as $agenda) {\n            $competencias_bajas = $this->extraerCompetenciasBajas($agenda);\n\n            if (!empty($competencias_bajas)) {\n                $resultado['pruebas'][] = [\n                    'prueba_id' => $agenda->prueba_id,\n                    'nombre_prueba' => $agenda->prueba->nombre,\n                    'competencias' => $competencias_bajas\n                ];\n            }\n        }\n\n        return $resultado;\n    }\n\n    /**\n     * Extraer las 2 competencias más bajas de una agenda según su prueba.\n     *\n     * @param \\App\\Models\\Agendas\\Agenda $agenda Agenda finalizada.\n     * @return array\n     * @author Sergio Vargas\n     */\n    private function extraerCompetenciasBajas($agenda): array {\n        $resultados = $this->resultado_agenda_servicio->gestionarResultados($agenda);\n\n        if (empty($resultados)) {\n            return [];\n        }\n\n        $competencias_todas = [];\n\n        // TenDisc Plus (prueba_id = 12)\n        if ($agenda->prueba_id === 12) {\n            $factor_especificas = collect($resultados)->firstWhere('nombre', 'Competencias Específicas');\n            $factor_transversales = collect($resultados)->firstWhere('nombre', 'Competencias Transversales');\n\n            if ($factor_especificas) {\n                $competencias_todas = array_merge($competencias_todas, $factor_especificas['dimensiones']);\n            }\n            if ($factor_transversales) {\n                $competencias_todas = array_merge($competencias_todas, $factor_transversales['dimensiones']);\n            }\n        }\n\n        // Potencial Comercial (prueba_id = 7)\n        if ($agenda->prueba_id === 7) {\n            $factor_caracter = collect($resultados)->firstWhere('nombre', 'Carácter');\n            $factor_habilidades = collect($resultados)->firstWhere('nombre', 'Habilidades');\n\n            if ($factor_caracter) {\n                $competencias_todas = array_merge($competencias_todas, $factor_caracter['dimensiones']);\n            }\n            if ($factor_habilidades) {\n                $competencias_todas = array_merge($competencias_todas, $factor_habilidades['dimensiones']);\n            }\n        }\n\n        // Ordenar por puntaje ascendente y tomar las 2 más bajas\n        return collect($competencias_todas)\n            ->sortBy('puntaje_transformado')\n            ->take(2)\n            ->map(fn($c) => [\n                'nombre' => $c['nombre'],\n                'puntaje' => round($c['puntaje_transformado'], 0)\n            ])\n            ->values()\n            ->toArray();\n    }\n}\n","structuredPatch":[{"oldStart":696,"oldLines":12,"newStart":696,"newLines":12,"lines":["      * @author Andres Gonzalez","      */","     public function gestionarContinuidadAplicante(EtapaVacanteUsuario $etapa_usuario, int $movimiento_vacante_id, int $puntaje, string $llave_puntajes_bajos, string $llave_puntajes_medios, bool $escala_pruebas_psicometricas = false) {","-        $calificacion_baja  = 40;","-        $calificacion_media = 70;","+        $calificacion_baja  = EtapaVacanteUsuario::CALIFICACION_BAJA;","+        $calificacion_media = EtapaVacanteUsuario::CALIFICACION_MEDIA;"," ","         if ($escala_pruebas_psicometricas) {","-            $calificacion_baja  = 59;","-            $calificacion_media = 75;","+            $calificacion_baja  = EtapaVacanteUsuario::CALIFICACION_BAJA_PSICOMETRICA;","+            $calificacion_media = EtapaVacanteUsuario::CALIFICACION_MEDIA_PSICOMETRICA;","         }"," ","         // Obtener el movimiento de la etapa con sus configuraciones"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"933b5611-416f-4101-a5e9-a18e5f53c0aa"}
{"parentUuid":"260e0948-7f47-4445-8e06-6d07c995eaa1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01VHZyYjYzuU6F2CRgjBpuKM","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto. He completado la tarea. He:\n\n1. Creado las constantes en el modelo EtapaVacanteUsuario:\n   - CALIFICACION_BAJA = 40\n   - CALIFICACION_MEDIA = 70\n   - CALIFICACION_BAJA_PSICOMETRICA = 59\n   - CALIFICACION_MEDIA_PSICOMETRICA = 75\n\n2. Actualizado el servicio EtapaVacanteUsuarioService para usar estas constantes en lugar de los valores hardcodeados.\n\nEsto sigue las convenciones del proyecto de usar constantes en mayúsculas con snake_case y nombres en español.","signature":"EvoECkYICxgCKkDNs4ixjuPhW9k2yj9ECjKCdABgbpjEaqTeq0Y3GEFqI3qk0YoJVaUyM0+9IjzGOXjHJTKa+jfG/48vepbYNXQhEgzQrYubzGpS4nRB+pIaDNpq2TMzuWp0XPLXRSIwz4nvmAgx6dv8o+oMDV2zYcpSW5dzgOI0fXWM/upP6XpnGbqewrEbXZF4uu45Ait6KuEDsZ+Q8BWA0J6gxvcafmVvrL4Hn5ix2nQ0qnqD2I8xh24tBUzNcsjW2NkHVmp4EwrxlEgXJHJ+R8YDb80R971+2bbvJb1LPbjjrROrGFv+twfZEZYajehcP1Ud/lrF0AlLbh2oW/bUjIbTjzWNL6LnvCPKL79WcqWYZ8cSdvkBP1ozRaqw2oLKgpqWOGYOmf51NwAJgoJOXzxx+SOeiNqFdE3JRAdSlq4FFgf1a868lKfMPxY3CsI84Hxe58Wn4FSVHQ8Z/SBmJU4Tdx8Q1d8wj+rz2Yk36+etAVtpLI/VLH22ICgCpNDka+8Wl7bAQYwGvweb6q5/Ae8cwIAfMj1KaIZeJX8/94k0XCGPDYCyt46MTTq7Cfw4TRzY5l9jsyjLIkW4QNkiYPZDWUja+LgPTCZoX0vGTWbQB06ROzCLH0PpurCHEmyDg/KHYaQB/V8uJz7+vgYNVqBfjQueneXqPwYx800K6t6L7bRdvtdqrFbx2fiuym7EePlZYiS8H9Nyhv8Xk/iA8+zAtIAtxbUo7R2hu7QeXd/H59kLD7IHpdWW6XtyWzwluHZXyt3hhgn6cN+LVO0rIpcB2+QF2aIUHdg3hGXdveuZ93Y6nf1HKsC6uNLHrKiwNK50M0YotNRn0BgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":452,"cache_read_input_tokens":33997,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":452},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQo22krEiNEKESbb2T9","type":"assistant","uuid":"bab18c98-f70d-43b0-a9b2-5385241f7d02","timestamp":"2026-02-04T17:19:09.603Z"}
{"parentUuid":"bab18c98-f70d-43b0-a9b2-5385241f7d02","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01VHZyYjYzuU6F2CRgjBpuKM","type":"message","role":"assistant","content":[{"type":"text","text":"Listo! He convertido los valores en constantes y actualizado el código:\n\n**Constantes creadas en [EtapaVacanteUsuario.php](app/Models/Vacantes/EtapaVacanteUsuario.php#L20-L23)**:\n- `CALIFICACION_BAJA = 40`\n- `CALIFICACION_MEDIA = 70`\n- `CALIFICACION_BAJA_PSICOMETRICA = 59`\n- `CALIFICACION_MEDIA_PSICOMETRICA = 75`\n\n**Actualizado en [EtapaVacanteUsuarioService.php](app/Http/Services/Vacantes/EtapaVacanteUsuarioService.php#L699-L705)**: Ahora usa las constantes del modelo en lugar de valores hardcodeados, haciendo el código más mantenible y centralizado."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":452,"cache_read_input_tokens":33997,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":452},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoQo22krEiNEKESbb2T9","type":"assistant","uuid":"11fbe529-0f54-4b13-a9f2-3fc53d231d26","timestamp":"2026-02-04T17:19:12.726Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-04T19:18:44.715Z","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac"}
{"type":"file-history-snapshot","messageId":"3456d9a6-4e1e-4017-97d9-7c5812a77781","snapshot":{"messageId":"3456d9a6-4e1e-4017-97d9-7c5812a77781","trackedFileBackups":{"app\\Models\\Vacantes\\EtapaVacanteUsuario.php":{"backupFileName":"8e9db565b73c39ad@v3","version":3,"backupTime":"2026-02-04T19:18:46.190Z"},"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-02-04T19:18:46.218Z"}},"timestamp":"2026-02-04T19:18:46.163Z"},"isSnapshotUpdate":false}
{"parentUuid":"11fbe529-0f54-4b13-a9f2-3fc53d231d26","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01MRy1356hDAAG6M2k3TJMqU","parentToolUseID":"toolu_01MRy1356hDAAG6M2k3TJMqU","uuid":"21f445ab-79cc-4add-9fab-6e1206465dbc","timestamp":"2026-02-04T17:18:04.583Z"}
{"parentUuid":"21f445ab-79cc-4add-9fab-6e1206465dbc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01MRy1356hDAAG6M2k3TJMqU","toolUseID":"toolu_01MRy1356hDAAG6M2k3TJMqU","timestamp":"2026-02-04T17:18:05.637Z","uuid":"039f4124-717b-4d8f-8d13-efaa7d38e072"}
{"parentUuid":"039f4124-717b-4d8f-8d13-efaa7d38e072","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01UM6EAmye3DDak8oY4r3oq9","parentToolUseID":"toolu_01UM6EAmye3DDak8oY4r3oq9","uuid":"c66b9da8-bc8c-4e1d-9173-2f9e1cc96166","timestamp":"2026-02-04T17:18:11.314Z"}
{"parentUuid":"c66b9da8-bc8c-4e1d-9173-2f9e1cc96166","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01UM6EAmye3DDak8oY4r3oq9","parentToolUseID":"toolu_01UM6EAmye3DDak8oY4r3oq9","uuid":"a571f913-9f8a-4014-90ba-56f28246d910","timestamp":"2026-02-04T17:18:11.314Z"}
{"parentUuid":"a571f913-9f8a-4014-90ba-56f28246d910","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01UM6EAmye3DDak8oY4r3oq9","toolUseID":"toolu_01UM6EAmye3DDak8oY4r3oq9","timestamp":"2026-02-04T17:18:28.160Z","uuid":"5ef7f08e-2d0b-4015-a943-660148a30c31"}
{"parentUuid":"5ef7f08e-2d0b-4015-a943-660148a30c31","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01UM6EAmye3DDak8oY4r3oq9","toolUseID":"toolu_01UM6EAmye3DDak8oY4r3oq9","timestamp":"2026-02-04T17:18:28.160Z","uuid":"7254fb71-4c3e-488d-8c73-61381cc7adc0"}
{"parentUuid":"7254fb71-4c3e-488d-8c73-61381cc7adc0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01DLyDySjKCsYymiQT22wMDr","parentToolUseID":"toolu_01DLyDySjKCsYymiQT22wMDr","uuid":"05850d9e-102a-487f-832a-50a28857703f","timestamp":"2026-02-04T17:18:45.786Z"}
{"parentUuid":"05850d9e-102a-487f-832a-50a28857703f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01DLyDySjKCsYymiQT22wMDr","toolUseID":"toolu_01DLyDySjKCsYymiQT22wMDr","timestamp":"2026-02-04T17:18:46.865Z","uuid":"3a72f98b-843f-41f1-b853-a2f0bbfa0773"}
{"parentUuid":"3a72f98b-843f-41f1-b853-a2f0bbfa0773","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01HXXnJmJTg3xmQST61dqyc8","parentToolUseID":"toolu_01HXXnJmJTg3xmQST61dqyc8","uuid":"ba0d1241-e125-42e9-a6f3-700d483a4c73","timestamp":"2026-02-04T17:18:56.895Z"}
{"parentUuid":"ba0d1241-e125-42e9-a6f3-700d483a4c73","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01HXXnJmJTg3xmQST61dqyc8","parentToolUseID":"toolu_01HXXnJmJTg3xmQST61dqyc8","uuid":"763bd4d4-2751-4f44-a490-010caf7da465","timestamp":"2026-02-04T17:18:56.895Z"}
{"parentUuid":"763bd4d4-2751-4f44-a490-010caf7da465","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01HXXnJmJTg3xmQST61dqyc8","toolUseID":"toolu_01HXXnJmJTg3xmQST61dqyc8","timestamp":"2026-02-04T17:19:03.365Z","uuid":"97d1d8d5-d558-417c-be4c-4e825720cf75"}
{"parentUuid":"97d1d8d5-d558-417c-be4c-4e825720cf75","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01HXXnJmJTg3xmQST61dqyc8","toolUseID":"toolu_01HXXnJmJTg3xmQST61dqyc8","timestamp":"2026-02-04T17:19:03.366Z","uuid":"31ab2049-cda1-4836-9da0-e6e71beb2181"}
{"parentUuid":"31ab2049-cda1-4836-9da0-e6e71beb2181","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 1526 to 1526 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"mira tengo esta modal function reprocesarAgenda(agenda_id, nombre_tabla) { de public\\js\\vacantes\\detalles\\detalle-resultados.js pero quiero que lusca como este function modalSuspender(id, nombre, estado_id) { de public\\js\\vacantes\\general-vacantes.js"}]},"uuid":"3456d9a6-4e1e-4017-97d9-7c5812a77781","timestamp":"2026-02-04T19:18:46.156Z","permissionMode":"default"}
{"parentUuid":"3456d9a6-4e1e-4017-97d9-7c5812a77781","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01HieUdmQUtav8hf3WAe2Mfa","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que revise la función `reprocesarAgenda` en `detalle-resultados.js` y la haga lucir como `modalSuspender` en `general-vacantes.js`. Necesito leer ambos archivos para ver cómo están estructuradas y hacer que la primera se vea similar a la segunda.\n\nVoy a leer ambas funciones primero para entender la estructura.","signature":"EvUDCkYICxgCKkBP48m3nil6r11vUm/jt9xEBWFAgznZnysg5IxaPm2wY+u8yRXVBkNUG+4ojNWrKyz7taJeReG1v8hF9bJP0zBKEgw/w4/w0/LkT3BmDkUaDHuklyg8O9mCriFJVSIw/PCev0Gk9W5c3xBwI56PDYJqFnQZS6LuvyaiXbEyJuChfgDiCBNSSszQpzl7u4NdKtwC/mXs21xBKwQDn+UIM9lqCUNBx6o2RPsj8Hl1/p80XPMmxU9GiU8gClWWQmXgfSgdHNKYyJN9r8E4jgUg4gUmIGUbClXMUan5D++RBhNIjevRuZCKdx/nSm0eykskhQbPvswQbLmYPBd/Zcjdxr+1AtbdcG3Cx3yHHeUWtlUaWn/OPHp6Sg/3tWSKYJ6OH+uYKWQ7cldv5jRdz2xzcYM1O42J48EeH5Y0KFukgOti+6JhVH3ufSa0eGcxtlgZxxuNyO6gtDL+1TCdKr5XVe6Gs7MWdFvGxeUtIvgXfBsUNQy99RdvoIHc/Em9vYk4OI8Z3IDPS3A0T4tWPxiQpTMqq8NcsJck3Qa28aRlPR7gIFCKqfznXApzLKm7KC0c9qTvrA/iqiCv1pqGHFwT/lq+8L75+FyvkfF6Evhfw51XKpI8z3n1Ug5Ek7iRVa106ehiH7UG/wy9mVoHRRqbGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":35545,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":35545},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXoZvR8orkmSeuC2TpaRn","type":"assistant","uuid":"c956c522-e4e0-445d-bdbe-c31dd797fe80","timestamp":"2026-02-04T19:18:53.350Z"}
{"parentUuid":"c956c522-e4e0-445d-bdbe-c31dd797fe80","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01HieUdmQUtav8hf3WAe2Mfa","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a leer ambas funciones para entender cómo está estructurada la que quieres usar como referencia y luego actualizar la función `reprocesarAgenda`."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":35545,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":35545},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXoZvR8orkmSeuC2TpaRn","type":"assistant","uuid":"f309fd25-5789-4667-a8ee-3f23dae8dd73","timestamp":"2026-02-04T19:18:54.282Z"}
{"parentUuid":"f309fd25-5789-4667-a8ee-3f23dae8dd73","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01HieUdmQUtav8hf3WAe2Mfa","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FCNGHnTo67CMYxi7Xe9whb","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\general-vacantes.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":35545,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":35545},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXoZvR8orkmSeuC2TpaRn","type":"assistant","uuid":"e212186f-db83-4fd6-b167-ba7888fe30b2","timestamp":"2026-02-04T19:18:54.991Z"}
{"parentUuid":"e212186f-db83-4fd6-b167-ba7888fe30b2","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01HieUdmQUtav8hf3WAe2Mfa","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015ZhNMejELCDn7GUvgmwmWd","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":1520,"limit":50}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":35545,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":35545},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXoZvR8orkmSeuC2TpaRn","type":"assistant","uuid":"8e1523cd-e057-4561-9964-0fdbe8349d4b","timestamp":"2026-02-04T19:18:56.552Z"}
{"parentUuid":"8e1523cd-e057-4561-9964-0fdbe8349d4b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015ZhNMejELCDn7GUvgmwmWd","type":"tool_result","content":"  1520→ * @param {number} agenda_id ID de la agenda\n  1521→ * @param {string} nombre_tabla Nombre de la tabla\n  1522→ * @returns {void}\n  1523→ * @author Sergio Vargas\n  1524→ * @author Andres Gonzalez\n  1525→ */\n  1526→function reprocesarAgenda(agenda_id, nombre_tabla) {\n  1527→    console.log('Reprocesar agenda ID:', agenda_id);\n  1528→    Swal.fire({\n  1529→        title: '¿Reprocesar agenda?',\n  1530→        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n  1531→        icon: 'question',\n  1532→        showCancelButton: true,\n  1533→        showDenyButton: true,\n  1534→        confirmButtonColor: '#3085d6',\n  1535→        denyButtonColor: '#28a745',\n  1536→        cancelButtonColor: '#6c757d',\n  1537→        confirmButtonText: 'Solo reprocesar',\n  1538→        denyButtonText: 'Reprocesar y enviar correo',\n  1539→        cancelButtonText: 'Cancelar'\n  1540→    }).then((resultado) => {\n  1541→        if (resultado.isConfirmed || resultado.isDenied) {\n  1542→            let enviar_correo = resultado.isDenied;\n  1543→            $.ajax({\n  1544→                url: `/agendas-reprocesar/${agenda_id}`,\n  1545→                type: 'POST',\n  1546→                data: {\n  1547→                    enviar_notificacion_correo: enviar_correo,\n  1548→                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n  1549→                },\n  1550→                success: function(respuesta) {\n  1551→                    if (respuesta.message) {\n  1552→                        mostrarToast('success', respuesta.message);\n  1553→                        if (nombre_tabla) {\n  1554→                            actualizarDatatables(nombre_tabla);\n  1555→                            actualizarDatatables(nombre_tabla_resultados);\n  1556→                        }\n  1557→                    }\n  1558→                },\n  1559→                error: function(xhr) {\n  1560→                    let mensaje = 'Error al reprocesar la agenda.';\n  1561→                    if (xhr.responseJSON && xhr.responseJSON.message) {\n  1562→                        mensaje = xhr.responseJSON.message;\n  1563→                    }\n  1564→                    mostrarToast('danger', mensaje);\n  1565→                }\n  1566→            });\n  1567→        }\n  1568→    });\n  1569→}\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b700964a-631b-4f38-a258-58dbd3219fe6","timestamp":"2026-02-04T19:18:58.051Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":" * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n * @author Andres Gonzalez\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    console.log('Reprocesar agenda ID:', agenda_id);\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}","numLines":50,"startLine":1520,"totalLines":2671}},"sourceToolAssistantUUID":"8e1523cd-e057-4561-9964-0fdbe8349d4b"}
{"parentUuid":"e212186f-db83-4fd6-b167-ba7888fe30b2","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FCNGHnTo67CMYxi7Xe9whb","type":"tool_result","content":"     1→/**\n     2→ * Archivo general para funciones compartidas de vacantes\n     3→ * @author Andres Morales\n     4→ */\n     5→\n     6→const ESTADOS_VACANTES = {\n     7→    1: crearTag({ texto: 'Activada', class: 'tag-filled-green' }),\n     8→    2: crearTag({ texto: 'Suspendida', class: 'tag-filled-purple' }),\n     9→    3: crearTag({ texto: 'Completada', class: 'tag-filled-blue' }),\n    10→    4: crearTag({ texto: '<i class=\"bi bi-eraser me-2\"></i>Borrador', class: 'tag-tonal-gray' })\n    11→};\n    12→\n    13→let archivo_cargado = '';\n    14→\n    15→/**\n    16→ * Duplicar vacante.\n    17→ *\n    18→ * @param {number} id ID de la vacante.\n    19→ * @param {string} nombre_vacante Nombre de la vacante.\n    20→ * @returns {void}\n    21→ * @author Andres Morales\n    22→ * @author Andres Gonzalez\n    23→ */\n    24→function duplicarVacante(id, nombre_vacante) {\n    25→    let nombre_con_copia = `${nombre_vacante} - Copia`;\n    26→\n    27→    Swal.fire({\n    28→        showCloseButton: true,\n    29→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n    30→        showConfirmButton: false,\n    31→        showDenyButton: false,\n    32→        showCancelButton: false,\n    33→        html: `\n    34→            <div class=\"row w-100 mx-0 mt-2\">\n    35→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Duplicar vacante</div>\n    36→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n    37→                    Ingresa el nombre para la nueva vacante.\n    38→                </div>\n    39→                <div class=\"col-12 mt-4\">\n    40→                    ${crearInput({\n    41→                        id: 'nombre_vacante_duplicar',\n    42→                        name: 'nombre_vacante',\n    43→                        type: 'text',\n    44→                        label: 'Nombre de la vacante',\n    45→                        required: true,\n    46→                        maxlength: 255,\n    47→                        value: nombre_con_copia\n    48→                    })}\n    49→                </div>\n    50→                <div class=\"col-6 mt-5 mb-2\">\n    51→                    ${crearBoton({\n    52→                        clases: 'btn-outline-primary w-100 justify-content-center',\n    53→                        texto: 'Cancelar',\n    54→                        onclick: `Swal.close();`\n    55→                    })}\n    56→                </div>\n    57→                <div class=\"col-6 mt-5 mb-2\">\n    58→                    ${crearBoton({\n    59→                        clases: 'btn-primary w-100 justify-content-center',\n    60→                        texto: 'Duplicar',\n    61→                        onclick: `Swal.getConfirmButton().click();`\n    62→                    })}\n    63→                </div>\n    64→            </div>\n    65→        `,\n    66→        focusConfirm: false,\n    67→        preConfirm: async () => {\n    68→            const NUEVO_NOMBRE = $('#nombre_vacante_duplicar').val().trim();\n    69→\n    70→            if (!NUEVO_NOMBRE) {\n    71→                mostrarToast('warning', 'Por favor ingresa un nombre para la vacante');\n    72→                return false;\n    73→            }\n    74→\n    75→            let permitir_duplicados = await obtenerConfiguracionNombresDuplicados();\n    76→\n    77→            try {\n    78→                if (permitir_duplicados == 0) {\n    79→                    const RESPUESTA = await $.ajax({\n    80→                        type: 'GET',\n    81→                        url: '/vacantes-listado-tabla',\n    82→                        data: {\n    83→                            nombre_vacante: NUEVO_NOMBRE,\n    84→                            activo: 1\n    85→                        }\n    86→                    });\n    87→                    const VACANTES_ENCONTRADAS = RESPUESTA.data || [];\n    88→                    \n    89→                    if (VACANTES_ENCONTRADAS.length > 0) {\n    90→                        mostrarToast('danger', 'Ya existe una vacante con este nombre. Por favor, elige un nombre diferente.');\n    91→                        $('#nombre_vacante_duplicar').addClass('error');\n    92→                        \n    93→                        throw new Error('Nombre duplicado');\n    94→                    } else {\n    95→                        $('#nombre_vacante_duplicar').removeClass('error');\n    96→                        return NUEVO_NOMBRE;\n    97→                    }\n    98→                } else {\n    99→                    return NUEVO_NOMBRE;\n   100→                }\n   101→            } catch (error) {\n   102→                return false;\n   103→            }\n   104→        }\n   105→    }).then(async (resultado) => {\n   106→        if (resultado.isConfirmed && resultado.value) {\n   107→            await ejecutarDuplicarVacante(id, resultado.value, function() {\n   108→                if (typeof actualizarDatatables !== 'undefined' && typeof nombre_tabla_vacantes !== 'undefined') {\n   109→                    actualizarDatatables(nombre_tabla_vacantes);\n   110→                }\n   111→                if (typeof cargarDatosVacante !== 'undefined') {\n   112→                    cargarDatosVacante();\n   113→                }\n   114→            });\n   115→        }\n   116→    });\n   117→}\n   118→\n   119→$(document).ready(function() {\n   120→    obtenerFuncionalidadesActivasPlan();\n   121→});\n   122→\n   123→/**\n   124→ * Ejecutar la duplicación de una vacante.\n   125→ *\n   126→ * @param {number} id ID de la vacante a duplicar.\n   127→ * @param {string} nombre_vacante Nuevo nombre para la vacante duplicada.\n   128→ * @param {Function} callback Función a ejecutar después de duplicar.\n   129→ * @returns {Promise<void>}\n   130→ * @author Andres Gonzalez\n   131→ */\n   132→async function ejecutarDuplicarVacante(id, nombre_vacante, callback) {\n   133→    await $.ajax({\n   134→        url : '/vacantes-duplicar',\n   135→        type: 'POST',\n   136→        data: {\n   137→            _token: $('input[name=\"_token\"]').val(),\n   138→            vacante_id: id,\n   139→            nombre: nombre_vacante\n   140→        }\n   141→    }).then((respuesta) => {\n   142→        mostrarToast('success', respuesta.message);\n   143→        if (callback && typeof callback === 'function') {\n   144→            callback();\n   145→        }\n   146→    }).catch(() => {\n   147→        mostrarToast('danger', 'Ocurrió un error al duplicar la vacante');\n   148→    });\n   149→}\n   150→\n   151→/**\n   152→ * Muestra modal para suspender o reactivar una vacante.\n   153→ *\n   154→ * @param {number} id ID de la vacante.\n   155→ * @param {string} nombre Nombre de la vacante.\n   156→ * @param {number} estado_id ID del nuevo estado.\n   157→ * @returns {void}\n   158→ * @author Andres Morales\n   159→ */\n   160→function modalSuspender(id, nombre, estado_id) {\n   161→    let va_a_suspender = estado_id == 2;\n   162→    let titulo = va_a_suspender ? '¿Seguro que deseas suspender?' : '¿Seguro que deseas reactivar?';\n   163→    let mensaje = va_a_suspender\n   164→        ? `Estás a punto de suspender la vacante <strong>\"${nombre}\"</strong>. Esta acción pausará temporalmente la vacante.`\n   165→        : `Estás a punto de reactivar la vacante <strong>\"${nombre}\"</strong>. Esta acción reactivará la vacante.`;\n   166→    let texto_boton = va_a_suspender ? 'Suspender' : 'Reactivar';\n   167→\n   168→    Swal.fire({\n   169→        showCloseButton: true,\n   170→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   171→        showConfirmButton: false,\n   172→        showDenyButton: false,\n   173→        showCancelButton: false,\n   174→        html: `\n   175→            <div class=\"row w-100 mx-0 mt-2\">\n   176→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">${titulo}</div>\n   177→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">${mensaje}</div>\n   178→                <div class=\"col-6 mt-5 mb-2\">\n   179→                    ${crearBoton({\n   180→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   181→                        texto: 'Cancelar',\n   182→                        onclick: `Swal.clickDeny();`\n   183→                    })}\n   184→                </div>\n   185→                <div class=\"col-6 mt-5 mb-2\">\n   186→                    ${crearBoton({\n   187→                        clases: 'btn-primary w-100 justify-content-center',\n   188→                        texto: texto_boton,\n   189→                        onclick: `Swal.clickConfirm();`\n   190→                    })}\n   191→                </div>\n   192→            </div>\n   193→        `,\n   194→    }).then(async (result) => {\n   195→        if (result.isConfirmed) {\n   196→            await cambiarEstadoVacante(id, estado_id, function() {\n   197→                if (typeof actualizarDatatables !== 'undefined' && typeof nombre_tabla_vacantes !== 'undefined') {\n   198→                    actualizarDatatables(nombre_tabla_vacantes);\n   199→                }\n   200→                if (typeof cargarDatosVacante !== 'undefined') {\n   201→                    cargarDatosVacante();\n   202→                }\n   203→            });\n   204→        }\n   205→    });\n   206→}\n   207→\n   208→/**\n   209→ * Cambiar el estado de una vacante.\n   210→ *\n   211→ * @param {number} id ID de la vacante.\n   212→ * @param {number} estado_id ID del nuevo estado.\n   213→ * @param {Function} callback Función a ejecutar después de cambiar el estado.\n   214→ * @returns {Promise<void>}\n   215→ * @author Fahibram Cárcamo\n   216→ * @author Andrés González\n   217→ */\n   218→async function cambiarEstadoVacante(id, estado_id, callback) {\n   219→    await $.ajax({\n   220→        url : '/vacantes-cambiar-estado',\n   221→        type: 'PUT',\n   222→        data: {\n   223→            _token: $('input[name=\"_token\"]').val(),\n   224→            id: id,\n   225→            estado_id: estado_id\n   226→        }\n   227→    }).then((respuesta) => {\n   228→        mostrarToast('success', respuesta.message);\n   229→        if (callback && typeof callback === 'function') {\n   230→            callback();\n   231→        }\n   232→    }).catch(() => {\n   233→        mostrarToast('danger', 'Ocurrió un error al actualizar la vacante');\n   234→    });\n   235→}\n   236→\n   237→/**\n   238→ * Muestra modal para archivar o desarchivar una vacante.\n   239→ *\n   240→ * @param {number} id ID de la vacante.\n   241→ * @param {number} activo Estado activo de la vacante (1 = activa, 0 = archivada).\n   242→ * @param {string} nombre nombre de la vacante.\n   243→ * @returns {void}\n   244→ * @author Andres Gonzalez\n   245→ */\n   246→function archivarDesarchivarVacante(id, activo, nombre) {\n   247→    let es_activa = activo == 1;\n   248→    let titulo = es_activa ? 'Archivar' : 'Desarchivar';\n   249→    let mensaje = es_activa\n   250→        ? `Se archivara la vacante \"${nombre}\" ¿Desea continuar?.`\n   251→        : `Se desarchivara la vacante \"${nombre}\" ¿Desea continuar?.`;\n   252→    let texto_boton = es_activa ? 'Archivar' : 'Desarchivar';\n   253→\n   254→    Swal.fire({\n   255→        showCloseButton: true,\n   256→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   257→        showConfirmButton: false,\n   258→        showDenyButton: false,\n   259→        showCancelButton: false,\n   260→        html: `\n   261→            <div class=\"row w-100 mx-0 mt-2\">\n   262→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">${titulo}</div>\n   263→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">${mensaje}</div>\n   264→                <div class=\"col-6 mt-5 mb-2\">\n   265→                    ${crearBoton({\n   266→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   267→                        texto: 'Cancelar',\n   268→                        onclick: `Swal.clickDeny();`\n   269→                    })}\n   270→                </div>\n   271→                <div class=\"col-6 mt-5 mb-2\">\n   272→                    ${crearBoton({\n   273→                        clases: 'btn-primary w-100 justify-content-center',\n   274→                        texto: texto_boton,\n   275→                        onclick: `Swal.clickConfirm();`\n   276→                    })}\n   277→                </div>\n   278→            </div>\n   279→        `,\n   280→    }).then(async (result) => {\n   281→        if (result.isConfirmed) {\n   282→            await ejecutarArchivarVacante(id, function() {\n   283→                if (typeof actualizarDatatables !== 'undefined' && typeof nombre_tabla_vacantes !== 'undefined') {\n   284→                    actualizarDatatables(nombre_tabla_vacantes);\n   285→                }\n   286→                if (typeof cargarDatosVacante !== 'undefined') {\n   287→                    cargarDatosVacante();\n   288→                }\n   289→            });\n   290→        }\n   291→    });\n   292→}\n   293→\n   294→/**\n   295→ * Ejecutar el archivado o desarchivado de una vacante.\n   296→ *\n   297→ * @param {number} id ID de la vacante.\n   298→ * @param {Function} callback Función a ejecutar después de archivar.\n   299→ * @returns {Promise<void>}\n   300→ * @author Andres Gonzalez\n   301→ */\n   302→async function ejecutarArchivarVacante(id, callback) {\n   303→    await $.ajax({\n   304→        url : '/vacantes-archivar',\n   305→        type: 'PUT',\n   306→        data: {\n   307→            _token: $('input[name=\"_token\"]').val(),\n   308→            id: id\n   309→        }\n   310→    }).then((respuesta) => {\n   311→        mostrarToast('success', respuesta.message);\n   312→        if (callback && typeof callback === 'function') {\n   313→            callback();\n   314→        }\n   315→    }).catch(() => {\n   316→        mostrarToast('danger', 'Ocurrió un error al archivar la vacante');\n   317→    });\n   318→}\n   319→\n   320→/**\n   321→ * Muestra el SweetAlert de confirmación de eliminación.\n   322→ *\n   323→ * @param {number|string} id Identificador único de la vacante a eliminar.\n   324→ * @param {string} nombre Nombre de la vacante que se eliminará.\n   325→ * @returns {void}\n   326→ * @author Fahibram Cárcamo\n   327→ * @author Andres Morales\n   328→ */\n   329→function modalEliminar(id, nombre) {\n   330→    Swal.fire({\n   331→        showCloseButton: true,\n   332→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   333→        showConfirmButton: false,\n   334→        showDenyButton: false,\n   335→        showCancelButton: false,\n   336→        html: `\n   337→            <div class=\"row w-100 mx-0 mt-2\">\n   338→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas eliminar?</div>\n   339→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Estás a punto de eliminar la vacante <strong>\"${nombre}\"</strong>. Esta acción no se puede deshacer.</div>\n   340→                <div class=\"col-6 mt-5 mb-2\">\n   341→                    ${crearBoton({\n   342→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   343→                        texto: 'Cancelar',\n   344→                        onclick: `Swal.clickDeny();`\n   345→                    })}\n   346→                </div>\n   347→                <div class=\"col-6 mt-5 mb-2\">\n   348→                    ${crearBoton({\n   349→                        clases: 'btn-danger w-100 justify-content-center',\n   350→                        texto: 'Eliminar',\n   351→                        onclick: `Swal.clickConfirm();`\n   352→                    })}\n   353→                </div>\n   354→            </div>\n   355→        `,\n   356→    }).then(async (result) => {\n   357→        if (result.isConfirmed) {\n   358→            await eliminarVacante(id, function() {\n   359→                if (typeof actualizarDatatables !== 'undefined' && typeof nombre_tabla_vacantes !== 'undefined') {\n   360→                    actualizarDatatables(nombre_tabla_vacantes);\n   361→                }\n   362→                if (typeof cargarDatosVacante !== 'undefined') {\n   363→                    cargarDatosVacante();\n   364→                }\n   365→            });\n   366→        }\n   367→    });\n   368→}\n   369→\n   370→/**\n   371→ * Eliminar vacante.\n   372→ *\n   373→ * @param {number|string} id Identificador único de la vacante a eliminar.\n   374→ * @param {Function} callback Función a ejecutar después de eliminar.\n   375→ * @returns {Promise<void>}\n   376→ * @author Fahibram Cárcamo\n   377→ * @author Andres Morales\n   378→ * @author Andres Gonzalez\n   379→ */\n   380→async function eliminarVacante(id, callback) {\n   381→    await $.ajax({\n   382→        url : `/vacantes/${id}`,\n   383→        type: 'POST',\n   384→        data: {\n   385→            _token : $('input[name=\"_token\"]').val(),\n   386→            _method: 'DELETE'\n   387→        }\n   388→    }).then((respuesta) => {\n   389→        mostrarToast('success', respuesta.message);\n   390→        if (callback && typeof callback === 'function') {\n   391→            callback();\n   392→        }\n   393→    }).catch(() => {\n   394→        mostrarToast('danger', 'Ocurrió un error al eliminar la vacante');\n   395→    });\n   396→}\n   397→\n   398→let candidatos_agregados = [];\n   399→\n   400→/**\n   401→ * Consulta la plantilla de correo predeterminada para agregar candidatos.\n   402→ *\n   403→ * @returns {Promise} Promesa con los datos de la plantilla\n   404→ * @author Andres Morales\n   405→ */\n   406→function consultarPlantillaCandidatos() {\n   407→    return $.ajax({\n   408→        url: '/plantilla-correo',\n   409→        method: 'GET',\n   410→        data: {\n   411→            plantilla_correo_id: 12,\n   412→            empresa_id: empresa_id\n   413→        },\n   414→        dataType: 'json'\n   415→    });\n   416→}\n   417→\n   418→/**\n   419→ * Abre el modal para agregar candidatos a una vacante.\n   420→ *\n   421→ * @param {number} vacante_id ID de la vacante.\n   422→ * @returns {void}\n   423→ * @author Andres Morales\n   424→ * @author Andres Gonzalez\n   425→ */\n   426→function agregarCandidato(vacante_id) {\n   427→    if (!buscarFuncionalidad('plantillas_personalizadas')) {\n   428→        $('#titulo_mensaje').attr('readonly', true);\n   429→\n   430→        $('#titulo_mensaje').off('click').on('click', function() {\n   431→            modalFuncionalidadInactiva();\n   432→        });\n   433→\n   434→        setTimeout(function() {\n   435→            if ($('#descripcion_mensaje').data('editor')) {\n   436→                $('#descripcion_mensaje').data('editor').enableReadOnlyMode('readonly-mode');\n   437→            }\n   438→\n   439→            $('.btn-dropdown-ckeditor').prop('disabled', true).addClass('disabled');\n   440→            $('#descripcion_mensaje').siblings('.ck-editor').find('.ck-editor__editable').off('click').on('click', function() {\n   441→                modalFuncionalidadInactiva();\n   442→            });\n   443→        }, 600);\n   444→    }\n   445→\n   446→    $('#formulario-agregar-candidatos')[0].reset();\n   447→    candidatos_agregados = [];\n   448→    $('#lista-candidatos-agregados').html('');\n   449→\n   450→    $('#vacante_id').val(vacante_id);\n   451→\n   452→    var enlace_base = window.location.origin;\n   453→    var enlace_vacante = `${enlace_base}/ats/oferta/DisañadorUI/${vacante_id}`;\n   454→    $('#enlace-vacante').text(enlace_vacante);\n   455→\n   456→    consultarPlantillaCandidatos().then(function(respuesta) {\n   457→        var plantilla = respuesta.data;\n   458→\n   459→        $('#titulo_mensaje').val(plantilla.titulo || '');\n   460→\n   461→        setTimeout(function() {\n   462→            if ($('#descripcion_mensaje').data('editor')) {\n   463→                $('#descripcion_mensaje').data('editor').setData(plantilla.contenido || '');\n   464→            }\n   465→        }, 500);\n   466→    }).catch(function() {\n   467→\n   468→    });\n   469→\n   470→    $('#modal-agregar-candidatos').modal('show');\n   471→}\n   472→\n   473→/**\n   474→ * Copia el enlace de la vacante al portapapeles.\n   475→ *\n   476→ * @returns {void}\n   477→ * @author Andres Morales\n   478→ */\n   479→function copiarEnlaceVacante() {\n   480→    var enlace = $('#enlace-vacante').text();\n   481→\n   482→    navigator.clipboard.writeText(enlace).then(() => {\n   483→        mostrarToast('success', 'Enlace copiado exitosamente');\n   484→    }).catch(() => {\n   485→        mostrarToast('danger', 'No se pudo copiar el enlace');\n   486→    });\n   487→}\n   488→\n   489→/**\n   490→ * Muestra un modal con el código QR de la vacante.\n   491→ *\n   492→ * @returns {void}\n   493→ * @author Andres Morales\n   494→ * @author Andres Gonzalez\n   495→ */\n   496→function mostrarCodigoQR() {\n   497→    var enlace = $('#enlace-vacante').text();\n   498→\n   499→    Swal.fire({\n   500→        html: `\n   501→            <div class=\"row w-100 mx-0 mt-2\">\n   502→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Código QR</div>\n   503→                <div class=\"col-12 mt-5\">\n   504→                    <div id=\"qrcode-container\" class=\"d-flex justify-content-center\"></div>\n   505→                </div>\n   506→                <div class=\"col-6 mt-5 mb-2\">\n   507→                    ${crearBoton({\n   508→                        clases: 'btn-outline-primary w-100 justify-content-center',\n   509→                        texto: 'Volver',\n   510→                        onclick: `Swal.close();`\n   511→                    })}\n   512→                </div>\n   513→                <div class=\"col-6 mt-5 mb-2\">\n   514→                    ${crearBoton({\n   515→                        clases: 'btn-primary w-100 justify-content-center',\n   516→                        texto: 'Descargar imagen',\n   517→                        onclick: `descargarImagenQR();`\n   518→                    })}\n   519→                </div>\n   520→            </div>\n   521→        `,\n   522→        showCloseButton: true,\n   523→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n   524→        showCancelButton: false,\n   525→        showConfirmButton: false,\n   526→        didOpen: () => {\n   527→            if (typeof QRCode !== 'undefined') {\n   528→                new QRCode(document.getElementById('qrcode-container'), {\n   529→                    text: enlace,\n   530→                    width: 256,\n   531→                    height: 256\n   532→                });\n   533→            } else {\n   534→                mostrarToast('warning', 'Librería de código QR no disponible');\n   535→            }\n   536→        }\n   537→    });\n   538→}\n   539→\n   540→/**\n   541→ * Descarga la imagen del código QR.\n   542→ *\n   543→ * @returns {void}\n   544→ * @author Andres Morales\n   545→ */\n   546→function descargarImagenQR() {\n   547→    try {\n   548→        var qr_contenedor = document.getElementById('qrcode-container');\n   549→        var canvas = qr_contenedor.querySelector('canvas');\n   550→\n   551→        if (!canvas) {\n   552→            mostrarToast('danger', 'No se pudo obtener la imagen del código QR');\n   553→            return;\n   554→        }\n   555→\n   556→        canvas.toBlob(function(blob) {\n   557→            var url = window.URL.createObjectURL(blob);\n   558→            var enlace = document.createElement('a');\n   559→            enlace.href = url;\n   560→            enlace.download = 'codigo-qr-vacante.png';\n   561→            document.body.appendChild(enlace);\n   562→            enlace.click();\n   563→            document.body.removeChild(enlace);\n   564→            window.URL.revokeObjectURL(url);\n   565→\n   566→            mostrarToast('success', 'QR descargado correctamente');\n   567→        });\n   568→    } catch (error) {\n   569→        mostrarToast('danger', 'Error al descargar la imagen del QR');\n   570→    }\n   571→}\n   572→\n   573→/**\n   574→ * Crea el botón adicional del CKEditor para agregar variables en vacantes.\n   575→ *\n   576→ * @param {string} _id ID del editor (no utilizado pero requerido por la API del CKEditor).\n   577→ * @returns {string} HTML del botón con dropdown de variables.\n   578→ * @author Andres Morales\n   579→ * @author Andres Gonzalez\n   580→ */\n   581→function botonAdicionalCkeditorVacantes(_id) {\n   582→    return `\n   583→        <div class=\"border-start border-black border-2 px-2 my-0 dropdown ms-auto\">\n   584→            ${crearBoton({\n   585→                clases: 'dropdown-toggle text-body-3 btn-dropdown-ckeditor',\n   586→                texto: 'Agregar variable<i class=\"bi bi-chevron-down text-body-3 ms-2\"></i>',\n   587→                data: [{texto: 'bs-toggle', value: 'dropdown'},{texto: 'bs-auto-close', value: 'outside'},]\n   588→            })}\n   589→            <div class=\"dropdown-menu bg-white\">\n   590→                <button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableVacante('__nombre_informador__')\">Nombre de usuario (Yo)</button>\n   591→                <button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableVacante('__nombre_empresa__')\">Nombre de la empresa</button>\n   592→                <button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableVacante('__nombre_vacante__')\">Nombre de la vacante</button>\n   593→                <button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableVacante('__nombre_candidato__')\">Nombre del candidato</button>\n   594→                <button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableVacante('__etapa__')\">Etapa</button>\n   595→            </div>\n   596→        </div>\n   597→    `;\n   598→}\n   599→\n   600→/**\n   601→ * Agrega la variable seleccionada en el CKEditor de vacantes.\n   602→ *\n   603→ * @param {string} variable Variable a agregar.\n   604→ * @returns {void}\n   605→ * @author Andres Morales\n   606→ * @author Andres Gonzalez\n   607→ */\n   608→function agregarVariableVacante(variable) {\n   609→    const EDITOR = $('#descripcion_mensaje').data('editor');\n   610→    const FRAGMENTO_VISTA = EDITOR.data.processor.toView(variable);\n   611→    const FRAGMENTO_MODELO = EDITOR.data.toModel(FRAGMENTO_VISTA);\n   612→    EDITOR.model.insertContent(FRAGMENTO_MODELO);\n   613→}\n   614→\n   615→/**\n   616→ * Agrega un candidato a la lista de candidatos a agregar.\n   617→ *\n   618→ * @returns {void}\n   619→ * @author Andres Morales\n   620→ */\n   621→function agregarCandidatoALista() {\n   622→    var tipo_documento = $('#tipo_documento_candidato').val();\n   623→    var numero_documento = $('#numero_documento_candidato').val().trim();\n   624→    var correo = $('#correo_candidato').val().trim();\n   625→\n   626→    if (!numero_documento || !correo) {\n   627→        mostrarToast('warning', 'Por favor completa todos los campos');\n   628→        return;\n   629→    }\n   630→\n   631→    var regex_correo = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n   632→    if (!regex_correo.test(correo)) {\n   633→        mostrarToast('warning', 'Por favor ingresa un correo electrónico válido');\n   634→        return;\n   635→    }\n   636→\n   637→    var existe = candidatos_agregados.some(candidato =>\n   638→        candidato.documento === numero_documento || candidato.email === correo\n   639→    );\n   640→\n   641→    if (existe) {\n   642→        mostrarToast('warning', 'El candidato ya fue agregado a la lista');\n   643→        return;\n   644→    }\n   645→\n   646→    var candidato = {\n   647→        tipo_documento_id: tipo_documento,\n   648→        documento: numero_documento,\n   649→        email: correo\n   650→    };\n   651→\n   652→    candidatos_agregados.push(candidato);\n   653→\n   654→    actualizarListaCandidatos();\n   655→\n   656→    $('#numero_documento_candidato').val('');\n   657→    $('#correo_candidato').val('');\n   658→\n   659→    mostrarToast('success', 'Candidato agregado a la lista');\n   660→}\n   661→\n   662→/**\n   663→ * Actualiza la vista de la lista de candidatos agregados.\n   664→ *\n   665→ * @returns {void}\n   666→ * @author Andres Morales\n   667→ */\n   668→function actualizarListaCandidatos() {\n   669→    var contenedor = $('#lista-candidatos-agregados');\n   670→    contenedor.html('');\n   671→\n   672→    if (candidatos_agregados.length === 0) {\n   673→        return;\n   674→    }\n   675→\n   676→    let tabla_html = `\n   677→        <div class=\"col-12\">\n   678→            <table class=\"table table-hover\">\n   679→                <thead class=\"table-ligth border-top border-bottom bg-gray-90\">\n   680→                    <tr>\n   681→                        <th class=\"bg-gray-90 text-body-2 fw-semibold text-gray-30\">Tipo de documento</th>\n   682→                        <th class=\"bg-gray-90 text-body-2 fw-semibold text-gray-30\">Numero de documento</th>\n   683→                        <th class=\"bg-gray-90 text-body-2 fw-semibold text-gray-30\">Correo electrónico</th>\n   684→                        <th class=\"bg-gray-90 text-body-2 fw-semibold text-gray-30 text-center\">Eliminar</th>\n   685→                    </tr>\n   686→                </thead>\n   687→                <tbody>\n   688→    `;\n   689→\n   690→    candidatos_agregados.forEach((candidato, index) => {\n   691→        var tipo_documento_texto = $('#tipo_documento_candidato option[value=\"' + candidato.tipo_documento_id + '\"]').text();\n   692→\n   693→        tabla_html += `\n   694→            <tr>\n   695→                <td class=\"text-body-2 text-gray-30 align-middle\">${tipo_documento_texto}</td>\n   696→                <td class=\"text-body-2 text-gray-30 align-middle\">${candidato.documento}</td>\n   697→                <td class=\"text-body-2 text-gray-30 align-middle\">${candidato.email}</td>\n   698→                <td class=\"text-center align-middle\">\n   699→                    <button type=\"button\" class=\"btn btn-outline-danger border-0\" onclick=\"eliminarCandidatoDeLista(${index})\">\n   700→                        <i class=\"bi bi-trash-fill\"></i>\n   701→                    </button>\n   702→                </td>\n   703→            </tr>\n   704→        `;\n   705→    });\n   706→\n   707→    tabla_html += `\n   708→                </tbody>\n   709→            </table>\n   710→        </div>\n   711→    `;\n   712→\n   713→    contenedor.html(tabla_html);\n   714→}\n   715→\n   716→/**\n   717→ * Elimina un candidato de la lista.\n   718→ *\n   719→ * @param {number} index Índice del candidato en el arreglo.\n   720→ * @returns {void}\n   721→ * @author Andres Morales\n   722→ */\n   723→function eliminarCandidatoDeLista(index) {\n   724→    candidatos_agregados.splice(index, 1);\n   725→    actualizarListaCandidatos();\n   726→    mostrarToast('success', 'Candidato eliminado de la lista');\n   727→}\n   728→\n   729→/**\n   730→ * Abre el modal de carga masiva de candidatos.\n   731→ *\n   732→ * @returns {void}\n   733→ * @author Andres Morales\n   734→ * @author Jair Carvajal\n   735→ */\n   736→function abrirCargaMasiva() {\n   737→    archivo_cargado = '';\n   738→    $('#contenido-normal').addClass('d-none');\n   739→    $('#contenido-pandape').addClass('d-none');\n   740→    $('#archivo_candidatos_normal').val('');\n   741→    $('#archivo_candidatos_pandape').val('');\n   742→    $('#tipo_importacion').val('').trigger('change');\n   743→    $('#boton-guardar-archivo').prop('disabled', true);\n   744→\n   745→    $('#boton-volver-carga').text('Cancelar');\n   746→    $('#boton-volver-carga').attr('onclick', \"$('#modal-cargar-archivo').modal('hide');\");\n   747→\n   748→    $('#modal-agregar-candidatos').modal('hide');\n   749→    $('#modal-cargar-archivo').modal('show');\n   750→}\n   751→\n   752→/**\n   753→ * Selecciona el tipo de importación y muestra el contenido correspondiente.\n   754→ *\n   755→ * @param {string} tipo - Tipo de importación ('normal' o 'pandape')\n   756→ * @returns {void}\n   757→ * @author Andres Morales\n   758→ */\n   759→function seleccionarTipoImportacion(tipo) {\n   760→    archivo_cargado = '';\n   761→    $('#boton-guardar-archivo').prop('disabled', true);\n   762→\n   763→    if (!tipo) {\n   764→        $('#contenido-normal').addClass('d-none');\n   765→        $('#contenido-pandape').addClass('d-none');\n   766→        $('#texto-intro').removeClass('d-none');\n   767→\n   768→        $('#boton-volver-carga').text('Cancelar');\n   769→        $('#boton-volver-carga').attr('onclick', \"$('#modal-cargar-archivo').modal('hide');\");\n   770→        return;\n   771→    }\n   772→\n   773→    $('#boton-volver-carga').text('Volver');\n   774→    $('#boton-volver-carga').attr('onclick', 'volverEstadoInicial()');\n   775→\n   776→    if (tipo === 'normal') {\n   777→        $('#texto-intro').addClass('d-none');\n   778→        $('#contenido-normal').removeClass('d-none');\n   779→        $('#contenido-pandape').addClass('d-none');\n   780→        $('#archivo_candidatos_normal').val('');\n   781→    } else if (tipo === 'pandape') {\n   782→        $('#texto-intro').addClass('d-none');\n   783→        $('#contenido-pandape').removeClass('d-none');\n   784→        $('#contenido-normal').addClass('d-none');\n   785→        $('#archivo_candidatos_pandape').val('');\n   786→    }\n   787→}\n   788→\n   789→/**\n   790→ * Vuelve al estado inicial del modal de carga masiva.\n   791→ *\n   792→ * @returns {void}\n   793→ * @author Andres Morales\n   794→ */\n   795→function volverEstadoInicial() {\n   796→    $('#contenido-normal').addClass('d-none');\n   797→    $('#contenido-pandape').addClass('d-none');\n   798→    $('#archivo_candidatos_normal').val('');\n   799→    $('#archivo_candidatos_pandape').val('');\n   800→    $('#tipo_importacion').val('').trigger('change');\n   801→    archivo_cargado = '';\n   802→    $('#boton-guardar-archivo').prop('disabled', true);\n   803→\n   804→    $('#boton-volver-carga').text('Cancelar');\n   805→    $('#boton-volver-carga').attr('onclick', \"$('#modal-cargar-archivo').modal('hide');\");\n   806→}\n   807→\n   808→/**\n   809→ * Descarga la plantilla de candidatos en formato Excel.\n   810→ * Usa la misma plantilla que carga masiva de procesos.\n   811→ *\n   812→ * @returns {void}\n   813→ * @author Andres Morales\n   814→ */\n   815→function descargarPlantillaCandidatos() {\n   816→    $.ajax({\n   817→        url: '/procesos-descargar-guia-agendamiento-masivo',\n   818→        type: 'GET',\n   819→        xhrFields: {\n   820→            responseType: 'blob'\n   821→        },\n   822→        success: function(datos, estado, solicitud) {\n   823→            var nombre_archivo = 'plantilla_carga_masiva_candidatos.xlsx';\n   824→            var disposicion_contenido = solicitud.getResponseHeader('Content-Disposition');\n   825→\n   826→            if (disposicion_contenido) {\n   827→                var nombre_archivo_coincidencia = disposicion_contenido.match(/filename=\"(.+)\"/);\n   828→                if (nombre_archivo_coincidencia) {\n   829→                    nombre_archivo = nombre_archivo_coincidencia[1];\n   830→                }\n   831→            }\n   832→\n   833→            var blob = new Blob([datos], {type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});\n   834→            var url = window.URL.createObjectURL(blob);\n   835→            var enlace = document.createElement('a');\n   836→            enlace.href = url;\n   837→            enlace.download = nombre_archivo;\n   838→            document.body.appendChild(enlace);\n   839→            enlace.click();\n   840→            document.body.removeChild(enlace);\n   841→            window.URL.revokeObjectURL(url);\n   842→\n   843→            mostrarToast('success', 'Plantilla descargada correctamente');\n   844→        },\n   845→        error: function() {\n   846→            mostrarToast('danger', 'Error al descargar la plantilla');\n   847→        }\n   848→    });\n   849→}\n   850→\n   851→/**\n   852→ * Eejecuta la lectura y procesamiento del archivo Excel cargado.\n   853→ *\n   854→ * @returns {void}\n   855→ * @author Andres Morales\n   856→ * @author Jair Carvajal\n   857→ */\n   858→async function ejecutarArchivo() {\n   859→    var tipo_importacion = $('#tipo_importacion').val();\n   860→    var input_id = tipo_importacion === 'pandape' ? 'archivo_candidatos_pandape' : 'archivo_candidatos_normal';\n   861→    var input_archivo = document.getElementById(input_id);\n   862→    var archivo = archivo_cargado || (input_archivo && input_archivo.files && input_archivo.files[0]);\n   863→\n   864→    if (!archivo) {\n   865→        mostrarToast('warning', 'No se seleccionó ningún archivo');\n   866→        return;\n   867→    }\n   868→\n   869→    try {\n   870→        var datos_excel = await leerArchivoExcel(archivo);\n   871→\n   872→        if (datos_excel.length === 0) {\n   873→            mostrarToast('warning', 'El archivo no contiene datos');\n   874→            return;\n   875→        }\n   876→\n   877→        $('#modal-cargar-archivo').modal('hide');\n   878→        $('#modal-agregar-candidatos').modal('show');\n   879→\n   880→        if (tipo_importacion === 'pandape') {\n   881→            procesarCandidatosPandaPe(datos_excel);\n   882→        } else {\n   883→            procesarCandidatosMasivos(datos_excel);\n   884→        }\n   885→\n   886→        $('#' + input_id).val('').trigger('change');\n   887→        archivo_cargado = '';\n   888→        $('#boton-guardar-archivo').prop('disabled', true);\n   889→    } catch (error) {\n   890→        mostrarToast('danger', 'Error al leer el archivo Excel. Verifica que el formato sea correcto.');\n   891→    }\n   892→}\n   893→\n   894→/**\n   895→ * Lee un archivo Excel y retorna los datos como array de objetos.\n   896→ *\n   897→ * @param {File} archivo Archivo Excel a leer\n   898→ * @returns {Promise<Array>}\n   899→ * @author Andres Morales\n   900→ * @author Andres Gonzalez\n   901→ */\n   902→async function leerArchivoExcel(archivo) {\n   903→    return new Promise((resolve, reject) => {\n   904→        var lector = new FileReader();\n   905→\n   906→        lector.onload = function(evento) {\n   907→            try {\n   908→                var datos = new Uint8Array(evento.target.result);\n   909→                var libro = XLSX.read(datos, { type: 'array' });\n   910→                var nombre_hoja = libro.SheetNames[0];\n   911→                var hoja = libro.Sheets[nombre_hoja];\n   912→\n   913→                // Intentar leer con encabezados en la fila 1 (por defecto)\n   914→                var datos_json = XLSX.utils.sheet_to_json(hoja);\n   915→\n   916→                // Si no hay datos o las columnas esperadas no existen, intentar desde fila 6\n   917→                if (datos_json.length === 0 ||\n   918→                    (!datos_json[0]['Número de documento'] &&\n   919→                     !datos_json[0]['Número de identificación'] &&\n   920→                     !datos_json[0]['Correo electrónico'])) {\n   921→                    // Leer desde la fila 6 como encabezados\n   922→                    datos_json = XLSX.utils.sheet_to_json(hoja, { range: 5 }); // range: 5 = fila 6 (0-indexed)\n   923→                }\n   924→\n   925→                resolve(datos_json);\n   926→            } catch (error) {\n   927→                reject(error);\n   928→            }\n   929→        };\n   930→\n   931→        lector.onerror = function(error) {\n   932→            reject(error);\n   933→        };\n   934→\n   935→        lector.readAsArrayBuffer(archivo);\n   936→    });\n   937→}\n   938→\n   939→/**\n   940→ * Procesa los candidatos cargados masivamente y los agrega a la lista.\n   941→ *\n   942→ * @param {Array} datos Array con los datos de los candidatos\n   943→ * @returns {void}\n   944→ * @author Andres Morales\n   945→ * @author Andres Gonzalez\n   946→ */\n   947→function procesarCandidatosMasivos(datos) {\n   948→    var mapeo_tipos_documento = {\n   949→        'cédula de ciudadanía': 1,\n   950→        'cedula de ciudadania': 1,\n   951→        'cc': 1,\n   952→        'tarjeta de identidad': 2,\n   953→        'ti': 2,\n   954→        'pasaporte': 3,\n   955→        'cédula de extranjería': 4,\n   956→        'cedula de extranjeria': 4,\n   957→        'ce': 4\n   958→    };\n   959→\n   960→    var candidatos_agregados_exitosamente = 0;\n   961→    var candidatos_duplicados = 0;\n   962→    var candidatos_con_errores = 0;\n   963→\n   964→    datos.forEach((fila) => {\n   965→        var tipo_documento_texto = fila['Tipo de documento'] || fila.tipo_documento || fila.TipoDocumento || '';\n   966→        var tipo_documento_id = 1;\n   967→\n   968→        if (tipo_documento_texto && typeof tipo_documento_texto === 'string') {\n   969→            var tipo_normalizado = tipo_documento_texto.toLowerCase().trim();\n   970→            tipo_documento_id = mapeo_tipos_documento[tipo_normalizado] || 1;\n   971→        } else if (tipo_documento_texto && typeof tipo_documento_texto === 'number') {\n   972→            tipo_documento_id = tipo_documento_texto;\n   973→        }\n   974→\n   975→        var documento = String(fila['Número de identificación'] || fila['Número de documento'] || fila.numero_documento || fila.NumeroDocumento || fila.Documento || fila.documento || '').trim();\n   976→        var email = String(fila['Correo electrónico'] || fila.email || fila.correo || fila.Email || fila.Correo || '').trim();\n   977→\n   978→        if (!documento || !email) {\n   979→            candidatos_con_errores++;\n   980→            return;\n   981→        }\n   982→\n   983→        var regex_correo = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n   984→        if (!regex_correo.test(email)) {\n   985→            candidatos_con_errores++;\n   986→            return;\n   987→        }\n   988→\n   989→        var existe = candidatos_agregados.some(candidato =>\n   990→            candidato.documento === documento || candidato.email === email\n   991→        );\n   992→\n   993→        if (existe) {\n   994→            candidatos_duplicados++;\n   995→            return;\n   996→        }\n   997→\n   998→        var candidato = {\n   999→            tipo_documento_id: tipo_documento_id,\n  1000→            documento: documento,\n  1001→            email: email\n  1002→        };\n  1003→\n  1004→        candidatos_agregados.push(candidato);\n  1005→        candidatos_agregados_exitosamente++;\n  1006→    });\n  1007→\n  1008→    actualizarListaCandidatos();\n  1009→\n  1010→    var mensaje = `Se agregaron ${candidatos_agregados_exitosamente} candidato(s) exitosamente.`;\n  1011→\n  1012→    if (candidatos_duplicados > 0) {\n  1013→        mensaje += ` ${candidatos_duplicados} duplicado(s) omitido(s).`;\n  1014→    }\n  1015→\n  1016→    if (candidatos_con_errores > 0) {\n  1017→        mensaje += ` ${candidatos_con_errores} con errores omitido(s).`;\n  1018→    }\n  1019→\n  1020→    if (candidatos_agregados_exitosamente > 0) {\n  1021→        mostrarToast('success', mensaje);\n  1022→    } else {\n  1023→        mostrarToast('warning', 'No se agregaron candidatos. Verifica el formato del archivo.');\n  1024→    }\n  1025→}\n  1026→\n  1027→/**\n  1028→ * Procesa candidatos desde Excel de PandaPe con datos completos\n  1029→ * Lee todos los campos adicionales disponibles\n  1030→ *\n  1031→ * @param {Array} datos Array con los datos de los candidatos\n  1032→ * @returns {void}\n  1033→ */\n  1034→function procesarCandidatosPandaPe(datos) {\n  1035→    var mapeo_tipos_documento = {\n  1036→        'cédula de ciudadanía': 1,\n  1037→        'cedula de ciudadania': 1,\n  1038→        'cc': 1,\n  1039→        'tarjeta de identidad': 2,\n  1040→        'ti': 2,\n  1041→        'pasaporte': 3,\n  1042→        'cédula de extranjería': 4,\n  1043→        'cedula de extranjeria': 4,\n  1044→        'ce': 4\n  1045→    };\n  1046→\n  1047→    var candidatos_agregados_exitosamente = 0;\n  1048→    var candidatos_duplicados = 0;\n  1049→    var candidatos_con_errores = 0;\n  1050→\n  1051→    datos.forEach((fila) => {\n  1052→        try {\n  1053→            // === CAMPOS OBLIGATORIOS ===\n  1054→            var tipo_documento_texto = fila['Tipo de documento'] || fila.tipo_documento || '';\n  1055→            var tipo_documento_id = 1;\n  1056→\n  1057→            if (tipo_documento_texto && typeof tipo_documento_texto === 'string') {\n  1058→                var tipo_normalizado = tipo_documento_texto.toLowerCase().trim();\n  1059→                tipo_documento_id = mapeo_tipos_documento[tipo_normalizado] || 1;\n  1060→            }\n  1061→\n  1062→            var documento = String(fila['Número de identificación'] || fila['Número de documento'] || '').trim();\n  1063→            var email = String(fila['Correo electrónico'] || fila.email || '').trim();\n  1064→\n  1065→            // Validaciones básicas\n  1066→            if (!documento || !email) {\n  1067→                candidatos_con_errores++;\n  1068→                return;\n  1069→            }\n  1070→\n  1071→            var regex_correo = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  1072→            if (!regex_correo.test(email)) {\n  1073→                candidatos_con_errores++;\n  1074→                return;\n  1075→            }\n  1076→\n  1077→            // Verificar duplicados\n  1078→            var existe = candidatos_agregados.some(c =>\n  1079→                c.documento === documento || c.email === email\n  1080→            );\n  1081→\n  1082→            if (existe) {\n  1083→                candidatos_duplicados++;\n  1084→                return;\n  1085→            }\n  1086→\n  1087→            // === CONSTRUIR OBJETO CON CAMPOS EXISTENTES EN BD ===\n  1088→            var candidato = {\n  1089→                tipo_documento_id: tipo_documento_id,\n  1090→                documento: documento,\n  1091→                email: email,\n  1092→\n  1093→                // Datos personales (campos existentes)\n  1094→                nombres: limpiarTexto(fila['Nombre'] || fila.nombre || ''),\n  1095→                apellidos: limpiarTexto(fila['Apellido'] || fila.apellido || ''),\n  1096→                telefono: limpiarTelefono(fila['Teléfono'] || fila.telefono || ''),\n  1097→                telefono_secundario: limpiarTelefono(fila['Teléfono celular'] || fila.telefono_celular || ''),\n  1098→\n  1099→                // Ubicación (campos existentes)\n  1100→                departamento: limpiarTexto(fila['Departamento'] || fila.departamento || ''),\n  1101→                ciudad: limpiarTexto(fila['Ciudad'] || fila.ciudad || ''),\n  1102→                direccion: limpiarTexto(fila['Dirección'] || fila.direccion || ''),\n  1103→\n  1104→                // Demográficos (solo campos existentes)\n  1105→                fecha_nacimiento: fila['Fecha de nacimiento'] || fila.fecha_nacimiento || '',\n  1106→                genero: limpiarTexto(fila['Género'] || fila.genero || ''),\n  1107→\n  1108→                // Perfil laboral\n  1109→                salario_minimo: limpiarTexto(fila['Salario mínimo'] || fila.salario_minimo || ''),\n  1110→\n  1111→                // Campos complejos (para parsear en backend)\n  1112→                experiencia_profesional: limpiarTexto(fila['Experiencia profesional'] || fila.experiencia_profesional || ''),\n  1113→                formacion: limpiarTexto(fila['Formación'] || fila.formacion || ''),\n  1114→                idiomas: limpiarTexto(fila['Idiomas'] || fila.idiomas || '')\n  1115→            };\n  1116→\n  1117→            candidatos_agregados.push(candidato);\n  1118→            candidatos_agregados_exitosamente++;\n  1119→\n  1120→        } catch (error) {\n  1121→            console.error('Error procesando candidato PandaPe:', error);\n  1122→            candidatos_con_errores++;\n  1123→        }\n  1124→    });\n  1125→\n  1126→    actualizarListaCandidatos();\n  1127→\n  1128→    var mensaje = `Se agregaron ${candidatos_agregados_exitosamente} candidato(s) desde PandaPe.`;\n  1129→    if (candidatos_duplicados > 0) {\n  1130→        mensaje += ` ${candidatos_duplicados} duplicado(s) omitido(s).`;\n  1131→    }\n  1132→    if (candidatos_con_errores > 0) {\n  1133→        mensaje += ` ${candidatos_con_errores} con errores omitido(s).`;\n  1134→    }\n  1135→\n  1136→    if (candidatos_agregados_exitosamente > 0) {\n  1137→        mostrarToast('success', mensaje);\n  1138→    } else {\n  1139→        mostrarToast('warning', 'No se agregaron candidatos. Verifica el formato del archivo.');\n  1140→    }\n  1141→}\n  1142→\n  1143→/**\n  1144→ * Limpia texto eliminando espacios extra\n  1145→ *\n  1146→ * @param {string} texto - Texto a limpiar\n  1147→ * @returns {string}\n  1148→ */\n  1149→function limpiarTexto(texto) {\n  1150→    if (!texto) return '';\n  1151→    return String(texto).trim().replace(/\\s+/g, ' ');\n  1152→}\n  1153→\n  1154→/**\n  1155→ * Limpia número de teléfono eliminando caracteres no numéricos\n  1156→ *\n  1157→ * @param {string} telefono - Teléfono a limpiar\n  1158→ * @returns {string}\n  1159→ */\n  1160→function limpiarTelefono(telefono) {\n  1161→    if (!telefono) return '';\n  1162→    return String(telefono).replace(/[^\\d+]/g, '');\n  1163→}\n  1164→\n  1165→/**\n  1166→ * Guarda los candidatos agregados a la vacante.\n  1167→ *\n  1168→ * @returns {Promise<void>}\n  1169→ * @author Andres Morales\n  1170→ * @author Esperanza Olivo\n  1171→ */\n  1172→async function guardarCandidatosVacante() {\n  1173→    var vacante_id = $('#vacante_id').val();\n  1174→    var titulo_mensaje = $('#titulo_mensaje').val().trim();\n  1175→    var descripcion_mensaje = $('#descripcion_mensaje').data('editor') ? $('#descripcion_mensaje').data('editor').getData() : '';\n  1176→\n  1177→    if (candidatos_agregados.length === 0) {\n  1178→        mostrarToast('warning', 'Por favor agrega al menos un candidato');\n  1179→        return;\n  1180→    }\n  1181→\n  1182→    $('#boton-guardar-candidatos').prop('disabled', true).html('<span class=\"spinner-border spinner-border-sm me-2\"></span>Guardando...');\n  1183→\n  1184→    try {\n  1185→        await $.ajax({\n  1186→            url: '/vacantes-postular-aplicantes',\n  1187→            type: 'POST',\n  1188→            data: {\n  1189→                _token: $('input[name=\"_token\"]').val(),\n  1190→                vacante_id: vacante_id,\n  1191→                titulo: titulo_mensaje,\n  1192→                mensaje: descripcion_mensaje,\n  1193→                aplicantes: candidatos_agregados\n  1194→            }\n  1195→        });\n  1196→\n  1197→        mostrarToast('success', 'Candidatos agregados exitosamente');\n  1198→\n  1199→        $('#modal-agregar-candidatos').modal('hide');\n  1200→\n  1201→        if (typeof actualizarDatatables !== 'undefined' && typeof nombre_tabla_vacantes !== 'undefined') {\n  1202→            actualizarDatatables(nombre_tabla_vacantes);\n  1203→        }\n  1204→\n  1205→        if (typeof vacante_datos !== 'undefined' && typeof encabezadoDetalle === 'function') {\n  1206→            vacante_datos.conteo_aplicantes = (vacante_datos.conteo_aplicantes || 0) + candidatos_agregados.length;\n  1207→            encabezadoDetalle(vacante_datos);\n  1208→            actualizarConteoAplicantes(vacante_datos.conteo_aplicantes);\n  1209→        }\n  1210→\n  1211→        if (typeof cargarEtapasConCandidatos === 'function' && typeof prepararFiltrosActuales === 'function') {\n  1212→            cargarEtapasConCandidatos(prepararFiltrosActuales());\n  1213→        }\n  1214→    } catch (error) {\n  1215→        mostrarToast('danger', error.responseJSON?.errors || 'Ocurrió un error al agregar los candidatos');\n  1216→    } finally {\n  1217→        $('#boton-guardar-candidatos').prop('disabled', false).html('Agregar');\n  1218→    }\n  1219→}\n  1220→\n  1221→$(document).on('change', '#archivo_candidatos_normal, #archivo_candidatos_pandape', function(evento) {\n  1222→    if (evento.target.files && evento.target.files[0]) {\n  1223→        archivo_cargado = evento.target.files[0];\n  1224→        $('#boton-guardar-archivo').prop('disabled', false);\n  1225→    } else {\n  1226→        archivo_cargado = '';\n  1227→        $('#boton-guardar-archivo').prop('disabled', true);\n  1228→    }\n  1229→});\n  1230→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a31ffd62-9083-4c71-8529-956a9d8e2d4f","timestamp":"2026-02-04T19:18:58.085Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\general-vacantes.js","content":"/**\n * Archivo general para funciones compartidas de vacantes\n * @author Andres Morales\n */\n\nconst ESTADOS_VACANTES = {\n    1: crearTag({ texto: 'Activada', class: 'tag-filled-green' }),\n    2: crearTag({ texto: 'Suspendida', class: 'tag-filled-purple' }),\n    3: crearTag({ texto: 'Completada', class: 'tag-filled-blue' }),\n    4: crearTag({ texto: '<i class=\"bi bi-eraser me-2\"></i>Borrador', class: 'tag-tonal-gray' })\n};\n\nlet archivo_cargado = '';\n\n/**\n * Duplicar vacante.\n *\n * @param {number} id ID de la vacante.\n * @param {string} nombre_vacante Nombre de la vacante.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction duplicarVacante(id, nombre_vacante) {\n    let nombre_con_copia = `${nombre_vacante} - Copia`;\n\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Duplicar vacante</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                    Ingresa el nombre para la nueva vacante.\n                </div>\n                <div class=\"col-12 mt-4\">\n                    ${crearInput({\n                        id: 'nombre_vacante_duplicar',\n                        name: 'nombre_vacante',\n                        type: 'text',\n                        label: 'Nombre de la vacante',\n                        required: true,\n                        maxlength: 255,\n                        value: nombre_con_copia\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.close();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Duplicar',\n                        onclick: `Swal.getConfirmButton().click();`\n                    })}\n                </div>\n            </div>\n        `,\n        focusConfirm: false,\n        preConfirm: async () => {\n            const NUEVO_NOMBRE = $('#nombre_vacante_duplicar').val().trim();\n\n            if (!NUEVO_NOMBRE) {\n                mostrarToast('warning', 'Por favor ingresa un nombre para la vacante');\n                return false;\n            }\n\n            let permitir_duplicados = await obtenerConfiguracionNombresDuplicados();\n\n            try {\n                if (permitir_duplicados == 0) {\n                    const RESPUESTA = await $.ajax({\n                        type: 'GET',\n                        url: '/vacantes-listado-tabla',\n                        data: {\n                            nombre_vacante: NUEVO_NOMBRE,\n                            activo: 1\n                        }\n                    });\n                    const VACANTES_ENCONTRADAS = RESPUESTA.data || [];\n                    \n                    if (VACANTES_ENCONTRADAS.length > 0) {\n                        mostrarToast('danger', 'Ya existe una vacante con este nombre. Por favor, elige un nombre diferente.');\n                        $('#nombre_vacante_duplicar').addClass('error');\n                        \n                        throw new Error('Nombre duplicado');\n                    } else {\n                        $('#nombre_vacante_duplicar').removeClass('error');\n                        return NUEVO_NOMBRE;\n                    }\n                } else {\n                    return NUEVO_NOMBRE;\n                }\n            } catch (error) {\n                return false;\n            }\n        }\n    }).then(async (resultado) => {\n        if (resultado.isConfirmed && resultado.value) {\n            await ejecutarDuplicarVacante(id, resultado.value, function() {\n                if (typeof actualizarDatatables !== 'undefined' && typeof nombre_tabla_vacantes !== 'undefined') {\n                    actualizarDatatables(nombre_tabla_vacantes);\n                }\n                if (typeof cargarDatosVacante !== 'undefined') {\n                    cargarDatosVacante();\n                }\n            });\n        }\n    });\n}\n\n$(document).ready(function() {\n    obtenerFuncionalidadesActivasPlan();\n});\n\n/**\n * Ejecutar la duplicación de una vacante.\n *\n * @param {number} id ID de la vacante a duplicar.\n * @param {string} nombre_vacante Nuevo nombre para la vacante duplicada.\n * @param {Function} callback Función a ejecutar después de duplicar.\n * @returns {Promise<void>}\n * @author Andres Gonzalez\n */\nasync function ejecutarDuplicarVacante(id, nombre_vacante, callback) {\n    await $.ajax({\n        url : '/vacantes-duplicar',\n        type: 'POST',\n        data: {\n            _token: $('input[name=\"_token\"]').val(),\n            vacante_id: id,\n            nombre: nombre_vacante\n        }\n    }).then((respuesta) => {\n        mostrarToast('success', respuesta.message);\n        if (callback && typeof callback === 'function') {\n            callback();\n        }\n    }).catch(() => {\n        mostrarToast('danger', 'Ocurrió un error al duplicar la vacante');\n    });\n}\n\n/**\n * Muestra modal para suspender o reactivar una vacante.\n *\n * @param {number} id ID de la vacante.\n * @param {string} nombre Nombre de la vacante.\n * @param {number} estado_id ID del nuevo estado.\n * @returns {void}\n * @author Andres Morales\n */\nfunction modalSuspender(id, nombre, estado_id) {\n    let va_a_suspender = estado_id == 2;\n    let titulo = va_a_suspender ? '¿Seguro que deseas suspender?' : '¿Seguro que deseas reactivar?';\n    let mensaje = va_a_suspender\n        ? `Estás a punto de suspender la vacante <strong>\"${nombre}\"</strong>. Esta acción pausará temporalmente la vacante.`\n        : `Estás a punto de reactivar la vacante <strong>\"${nombre}\"</strong>. Esta acción reactivará la vacante.`;\n    let texto_boton = va_a_suspender ? 'Suspender' : 'Reactivar';\n\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">${titulo}</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">${mensaje}</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: texto_boton,\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then(async (result) => {\n        if (result.isConfirmed) {\n            await cambiarEstadoVacante(id, estado_id, function() {\n                if (typeof actualizarDatatables !== 'undefined' && typeof nombre_tabla_vacantes !== 'undefined') {\n                    actualizarDatatables(nombre_tabla_vacantes);\n                }\n                if (typeof cargarDatosVacante !== 'undefined') {\n                    cargarDatosVacante();\n                }\n            });\n        }\n    });\n}\n\n/**\n * Cambiar el estado de una vacante.\n *\n * @param {number} id ID de la vacante.\n * @param {number} estado_id ID del nuevo estado.\n * @param {Function} callback Función a ejecutar después de cambiar el estado.\n * @returns {Promise<void>}\n * @author Fahibram Cárcamo\n * @author Andrés González\n */\nasync function cambiarEstadoVacante(id, estado_id, callback) {\n    await $.ajax({\n        url : '/vacantes-cambiar-estado',\n        type: 'PUT',\n        data: {\n            _token: $('input[name=\"_token\"]').val(),\n            id: id,\n            estado_id: estado_id\n        }\n    }).then((respuesta) => {\n        mostrarToast('success', respuesta.message);\n        if (callback && typeof callback === 'function') {\n            callback();\n        }\n    }).catch(() => {\n        mostrarToast('danger', 'Ocurrió un error al actualizar la vacante');\n    });\n}\n\n/**\n * Muestra modal para archivar o desarchivar una vacante.\n *\n * @param {number} id ID de la vacante.\n * @param {number} activo Estado activo de la vacante (1 = activa, 0 = archivada).\n * @param {string} nombre nombre de la vacante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction archivarDesarchivarVacante(id, activo, nombre) {\n    let es_activa = activo == 1;\n    let titulo = es_activa ? 'Archivar' : 'Desarchivar';\n    let mensaje = es_activa\n        ? `Se archivara la vacante \"${nombre}\" ¿Desea continuar?.`\n        : `Se desarchivara la vacante \"${nombre}\" ¿Desea continuar?.`;\n    let texto_boton = es_activa ? 'Archivar' : 'Desarchivar';\n\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">${titulo}</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">${mensaje}</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: texto_boton,\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then(async (result) => {\n        if (result.isConfirmed) {\n            await ejecutarArchivarVacante(id, function() {\n                if (typeof actualizarDatatables !== 'undefined' && typeof nombre_tabla_vacantes !== 'undefined') {\n                    actualizarDatatables(nombre_tabla_vacantes);\n                }\n                if (typeof cargarDatosVacante !== 'undefined') {\n                    cargarDatosVacante();\n                }\n            });\n        }\n    });\n}\n\n/**\n * Ejecutar el archivado o desarchivado de una vacante.\n *\n * @param {number} id ID de la vacante.\n * @param {Function} callback Función a ejecutar después de archivar.\n * @returns {Promise<void>}\n * @author Andres Gonzalez\n */\nasync function ejecutarArchivarVacante(id, callback) {\n    await $.ajax({\n        url : '/vacantes-archivar',\n        type: 'PUT',\n        data: {\n            _token: $('input[name=\"_token\"]').val(),\n            id: id\n        }\n    }).then((respuesta) => {\n        mostrarToast('success', respuesta.message);\n        if (callback && typeof callback === 'function') {\n            callback();\n        }\n    }).catch(() => {\n        mostrarToast('danger', 'Ocurrió un error al archivar la vacante');\n    });\n}\n\n/**\n * Muestra el SweetAlert de confirmación de eliminación.\n *\n * @param {number|string} id Identificador único de la vacante a eliminar.\n * @param {string} nombre Nombre de la vacante que se eliminará.\n * @returns {void}\n * @author Fahibram Cárcamo\n * @author Andres Morales\n */\nfunction modalEliminar(id, nombre) {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Seguro que deseas eliminar?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">Estás a punto de eliminar la vacante <strong>\"${nombre}\"</strong>. Esta acción no se puede deshacer.</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-danger w-100 justify-content-center',\n                        texto: 'Eliminar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then(async (result) => {\n        if (result.isConfirmed) {\n            await eliminarVacante(id, function() {\n                if (typeof actualizarDatatables !== 'undefined' && typeof nombre_tabla_vacantes !== 'undefined') {\n                    actualizarDatatables(nombre_tabla_vacantes);\n                }\n                if (typeof cargarDatosVacante !== 'undefined') {\n                    cargarDatosVacante();\n                }\n            });\n        }\n    });\n}\n\n/**\n * Eliminar vacante.\n *\n * @param {number|string} id Identificador único de la vacante a eliminar.\n * @param {Function} callback Función a ejecutar después de eliminar.\n * @returns {Promise<void>}\n * @author Fahibram Cárcamo\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nasync function eliminarVacante(id, callback) {\n    await $.ajax({\n        url : `/vacantes/${id}`,\n        type: 'POST',\n        data: {\n            _token : $('input[name=\"_token\"]').val(),\n            _method: 'DELETE'\n        }\n    }).then((respuesta) => {\n        mostrarToast('success', respuesta.message);\n        if (callback && typeof callback === 'function') {\n            callback();\n        }\n    }).catch(() => {\n        mostrarToast('danger', 'Ocurrió un error al eliminar la vacante');\n    });\n}\n\nlet candidatos_agregados = [];\n\n/**\n * Consulta la plantilla de correo predeterminada para agregar candidatos.\n *\n * @returns {Promise} Promesa con los datos de la plantilla\n * @author Andres Morales\n */\nfunction consultarPlantillaCandidatos() {\n    return $.ajax({\n        url: '/plantilla-correo',\n        method: 'GET',\n        data: {\n            plantilla_correo_id: 12,\n            empresa_id: empresa_id\n        },\n        dataType: 'json'\n    });\n}\n\n/**\n * Abre el modal para agregar candidatos a una vacante.\n *\n * @param {number} vacante_id ID de la vacante.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction agregarCandidato(vacante_id) {\n    if (!buscarFuncionalidad('plantillas_personalizadas')) {\n        $('#titulo_mensaje').attr('readonly', true);\n\n        $('#titulo_mensaje').off('click').on('click', function() {\n            modalFuncionalidadInactiva();\n        });\n\n        setTimeout(function() {\n            if ($('#descripcion_mensaje').data('editor')) {\n                $('#descripcion_mensaje').data('editor').enableReadOnlyMode('readonly-mode');\n            }\n\n            $('.btn-dropdown-ckeditor').prop('disabled', true).addClass('disabled');\n            $('#descripcion_mensaje').siblings('.ck-editor').find('.ck-editor__editable').off('click').on('click', function() {\n                modalFuncionalidadInactiva();\n            });\n        }, 600);\n    }\n\n    $('#formulario-agregar-candidatos')[0].reset();\n    candidatos_agregados = [];\n    $('#lista-candidatos-agregados').html('');\n\n    $('#vacante_id').val(vacante_id);\n\n    var enlace_base = window.location.origin;\n    var enlace_vacante = `${enlace_base}/ats/oferta/DisañadorUI/${vacante_id}`;\n    $('#enlace-vacante').text(enlace_vacante);\n\n    consultarPlantillaCandidatos().then(function(respuesta) {\n        var plantilla = respuesta.data;\n\n        $('#titulo_mensaje').val(plantilla.titulo || '');\n\n        setTimeout(function() {\n            if ($('#descripcion_mensaje').data('editor')) {\n                $('#descripcion_mensaje').data('editor').setData(plantilla.contenido || '');\n            }\n        }, 500);\n    }).catch(function() {\n\n    });\n\n    $('#modal-agregar-candidatos').modal('show');\n}\n\n/**\n * Copia el enlace de la vacante al portapapeles.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction copiarEnlaceVacante() {\n    var enlace = $('#enlace-vacante').text();\n\n    navigator.clipboard.writeText(enlace).then(() => {\n        mostrarToast('success', 'Enlace copiado exitosamente');\n    }).catch(() => {\n        mostrarToast('danger', 'No se pudo copiar el enlace');\n    });\n}\n\n/**\n * Muestra un modal con el código QR de la vacante.\n *\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction mostrarCodigoQR() {\n    var enlace = $('#enlace-vacante').text();\n\n    Swal.fire({\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Código QR</div>\n                <div class=\"col-12 mt-5\">\n                    <div id=\"qrcode-container\" class=\"d-flex justify-content-center\"></div>\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Volver',\n                        onclick: `Swal.close();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Descargar imagen',\n                        onclick: `descargarImagenQR();`\n                    })}\n                </div>\n            </div>\n        `,\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showCancelButton: false,\n        showConfirmButton: false,\n        didOpen: () => {\n            if (typeof QRCode !== 'undefined') {\n                new QRCode(document.getElementById('qrcode-container'), {\n                    text: enlace,\n                    width: 256,\n                    height: 256\n                });\n            } else {\n                mostrarToast('warning', 'Librería de código QR no disponible');\n            }\n        }\n    });\n}\n\n/**\n * Descarga la imagen del código QR.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction descargarImagenQR() {\n    try {\n        var qr_contenedor = document.getElementById('qrcode-container');\n        var canvas = qr_contenedor.querySelector('canvas');\n\n        if (!canvas) {\n            mostrarToast('danger', 'No se pudo obtener la imagen del código QR');\n            return;\n        }\n\n        canvas.toBlob(function(blob) {\n            var url = window.URL.createObjectURL(blob);\n            var enlace = document.createElement('a');\n            enlace.href = url;\n            enlace.download = 'codigo-qr-vacante.png';\n            document.body.appendChild(enlace);\n            enlace.click();\n            document.body.removeChild(enlace);\n            window.URL.revokeObjectURL(url);\n\n            mostrarToast('success', 'QR descargado correctamente');\n        });\n    } catch (error) {\n        mostrarToast('danger', 'Error al descargar la imagen del QR');\n    }\n}\n\n/**\n * Crea el botón adicional del CKEditor para agregar variables en vacantes.\n *\n * @param {string} _id ID del editor (no utilizado pero requerido por la API del CKEditor).\n * @returns {string} HTML del botón con dropdown de variables.\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction botonAdicionalCkeditorVacantes(_id) {\n    return `\n        <div class=\"border-start border-black border-2 px-2 my-0 dropdown ms-auto\">\n            ${crearBoton({\n                clases: 'dropdown-toggle text-body-3 btn-dropdown-ckeditor',\n                texto: 'Agregar variable<i class=\"bi bi-chevron-down text-body-3 ms-2\"></i>',\n                data: [{texto: 'bs-toggle', value: 'dropdown'},{texto: 'bs-auto-close', value: 'outside'},]\n            })}\n            <div class=\"dropdown-menu bg-white\">\n                <button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableVacante('__nombre_informador__')\">Nombre de usuario (Yo)</button>\n                <button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableVacante('__nombre_empresa__')\">Nombre de la empresa</button>\n                <button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableVacante('__nombre_vacante__')\">Nombre de la vacante</button>\n                <button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableVacante('__nombre_candidato__')\">Nombre del candidato</button>\n                <button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariableVacante('__etapa__')\">Etapa</button>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Agrega la variable seleccionada en el CKEditor de vacantes.\n *\n * @param {string} variable Variable a agregar.\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction agregarVariableVacante(variable) {\n    const EDITOR = $('#descripcion_mensaje').data('editor');\n    const FRAGMENTO_VISTA = EDITOR.data.processor.toView(variable);\n    const FRAGMENTO_MODELO = EDITOR.data.toModel(FRAGMENTO_VISTA);\n    EDITOR.model.insertContent(FRAGMENTO_MODELO);\n}\n\n/**\n * Agrega un candidato a la lista de candidatos a agregar.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction agregarCandidatoALista() {\n    var tipo_documento = $('#tipo_documento_candidato').val();\n    var numero_documento = $('#numero_documento_candidato').val().trim();\n    var correo = $('#correo_candidato').val().trim();\n\n    if (!numero_documento || !correo) {\n        mostrarToast('warning', 'Por favor completa todos los campos');\n        return;\n    }\n\n    var regex_correo = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!regex_correo.test(correo)) {\n        mostrarToast('warning', 'Por favor ingresa un correo electrónico válido');\n        return;\n    }\n\n    var existe = candidatos_agregados.some(candidato =>\n        candidato.documento === numero_documento || candidato.email === correo\n    );\n\n    if (existe) {\n        mostrarToast('warning', 'El candidato ya fue agregado a la lista');\n        return;\n    }\n\n    var candidato = {\n        tipo_documento_id: tipo_documento,\n        documento: numero_documento,\n        email: correo\n    };\n\n    candidatos_agregados.push(candidato);\n\n    actualizarListaCandidatos();\n\n    $('#numero_documento_candidato').val('');\n    $('#correo_candidato').val('');\n\n    mostrarToast('success', 'Candidato agregado a la lista');\n}\n\n/**\n * Actualiza la vista de la lista de candidatos agregados.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction actualizarListaCandidatos() {\n    var contenedor = $('#lista-candidatos-agregados');\n    contenedor.html('');\n\n    if (candidatos_agregados.length === 0) {\n        return;\n    }\n\n    let tabla_html = `\n        <div class=\"col-12\">\n            <table class=\"table table-hover\">\n                <thead class=\"table-ligth border-top border-bottom bg-gray-90\">\n                    <tr>\n                        <th class=\"bg-gray-90 text-body-2 fw-semibold text-gray-30\">Tipo de documento</th>\n                        <th class=\"bg-gray-90 text-body-2 fw-semibold text-gray-30\">Numero de documento</th>\n                        <th class=\"bg-gray-90 text-body-2 fw-semibold text-gray-30\">Correo electrónico</th>\n                        <th class=\"bg-gray-90 text-body-2 fw-semibold text-gray-30 text-center\">Eliminar</th>\n                    </tr>\n                </thead>\n                <tbody>\n    `;\n\n    candidatos_agregados.forEach((candidato, index) => {\n        var tipo_documento_texto = $('#tipo_documento_candidato option[value=\"' + candidato.tipo_documento_id + '\"]').text();\n\n        tabla_html += `\n            <tr>\n                <td class=\"text-body-2 text-gray-30 align-middle\">${tipo_documento_texto}</td>\n                <td class=\"text-body-2 text-gray-30 align-middle\">${candidato.documento}</td>\n                <td class=\"text-body-2 text-gray-30 align-middle\">${candidato.email}</td>\n                <td class=\"text-center align-middle\">\n                    <button type=\"button\" class=\"btn btn-outline-danger border-0\" onclick=\"eliminarCandidatoDeLista(${index})\">\n                        <i class=\"bi bi-trash-fill\"></i>\n                    </button>\n                </td>\n            </tr>\n        `;\n    });\n\n    tabla_html += `\n                </tbody>\n            </table>\n        </div>\n    `;\n\n    contenedor.html(tabla_html);\n}\n\n/**\n * Elimina un candidato de la lista.\n *\n * @param {number} index Índice del candidato en el arreglo.\n * @returns {void}\n * @author Andres Morales\n */\nfunction eliminarCandidatoDeLista(index) {\n    candidatos_agregados.splice(index, 1);\n    actualizarListaCandidatos();\n    mostrarToast('success', 'Candidato eliminado de la lista');\n}\n\n/**\n * Abre el modal de carga masiva de candidatos.\n *\n * @returns {void}\n * @author Andres Morales\n * @author Jair Carvajal\n */\nfunction abrirCargaMasiva() {\n    archivo_cargado = '';\n    $('#contenido-normal').addClass('d-none');\n    $('#contenido-pandape').addClass('d-none');\n    $('#archivo_candidatos_normal').val('');\n    $('#archivo_candidatos_pandape').val('');\n    $('#tipo_importacion').val('').trigger('change');\n    $('#boton-guardar-archivo').prop('disabled', true);\n\n    $('#boton-volver-carga').text('Cancelar');\n    $('#boton-volver-carga').attr('onclick', \"$('#modal-cargar-archivo').modal('hide');\");\n\n    $('#modal-agregar-candidatos').modal('hide');\n    $('#modal-cargar-archivo').modal('show');\n}\n\n/**\n * Selecciona el tipo de importación y muestra el contenido correspondiente.\n *\n * @param {string} tipo - Tipo de importación ('normal' o 'pandape')\n * @returns {void}\n * @author Andres Morales\n */\nfunction seleccionarTipoImportacion(tipo) {\n    archivo_cargado = '';\n    $('#boton-guardar-archivo').prop('disabled', true);\n\n    if (!tipo) {\n        $('#contenido-normal').addClass('d-none');\n        $('#contenido-pandape').addClass('d-none');\n        $('#texto-intro').removeClass('d-none');\n\n        $('#boton-volver-carga').text('Cancelar');\n        $('#boton-volver-carga').attr('onclick', \"$('#modal-cargar-archivo').modal('hide');\");\n        return;\n    }\n\n    $('#boton-volver-carga').text('Volver');\n    $('#boton-volver-carga').attr('onclick', 'volverEstadoInicial()');\n\n    if (tipo === 'normal') {\n        $('#texto-intro').addClass('d-none');\n        $('#contenido-normal').removeClass('d-none');\n        $('#contenido-pandape').addClass('d-none');\n        $('#archivo_candidatos_normal').val('');\n    } else if (tipo === 'pandape') {\n        $('#texto-intro').addClass('d-none');\n        $('#contenido-pandape').removeClass('d-none');\n        $('#contenido-normal').addClass('d-none');\n        $('#archivo_candidatos_pandape').val('');\n    }\n}\n\n/**\n * Vuelve al estado inicial del modal de carga masiva.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction volverEstadoInicial() {\n    $('#contenido-normal').addClass('d-none');\n    $('#contenido-pandape').addClass('d-none');\n    $('#archivo_candidatos_normal').val('');\n    $('#archivo_candidatos_pandape').val('');\n    $('#tipo_importacion').val('').trigger('change');\n    archivo_cargado = '';\n    $('#boton-guardar-archivo').prop('disabled', true);\n\n    $('#boton-volver-carga').text('Cancelar');\n    $('#boton-volver-carga').attr('onclick', \"$('#modal-cargar-archivo').modal('hide');\");\n}\n\n/**\n * Descarga la plantilla de candidatos en formato Excel.\n * Usa la misma plantilla que carga masiva de procesos.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction descargarPlantillaCandidatos() {\n    $.ajax({\n        url: '/procesos-descargar-guia-agendamiento-masivo',\n        type: 'GET',\n        xhrFields: {\n            responseType: 'blob'\n        },\n        success: function(datos, estado, solicitud) {\n            var nombre_archivo = 'plantilla_carga_masiva_candidatos.xlsx';\n            var disposicion_contenido = solicitud.getResponseHeader('Content-Disposition');\n\n            if (disposicion_contenido) {\n                var nombre_archivo_coincidencia = disposicion_contenido.match(/filename=\"(.+)\"/);\n                if (nombre_archivo_coincidencia) {\n                    nombre_archivo = nombre_archivo_coincidencia[1];\n                }\n            }\n\n            var blob = new Blob([datos], {type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});\n            var url = window.URL.createObjectURL(blob);\n            var enlace = document.createElement('a');\n            enlace.href = url;\n            enlace.download = nombre_archivo;\n            document.body.appendChild(enlace);\n            enlace.click();\n            document.body.removeChild(enlace);\n            window.URL.revokeObjectURL(url);\n\n            mostrarToast('success', 'Plantilla descargada correctamente');\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al descargar la plantilla');\n        }\n    });\n}\n\n/**\n * Eejecuta la lectura y procesamiento del archivo Excel cargado.\n *\n * @returns {void}\n * @author Andres Morales\n * @author Jair Carvajal\n */\nasync function ejecutarArchivo() {\n    var tipo_importacion = $('#tipo_importacion').val();\n    var input_id = tipo_importacion === 'pandape' ? 'archivo_candidatos_pandape' : 'archivo_candidatos_normal';\n    var input_archivo = document.getElementById(input_id);\n    var archivo = archivo_cargado || (input_archivo && input_archivo.files && input_archivo.files[0]);\n\n    if (!archivo) {\n        mostrarToast('warning', 'No se seleccionó ningún archivo');\n        return;\n    }\n\n    try {\n        var datos_excel = await leerArchivoExcel(archivo);\n\n        if (datos_excel.length === 0) {\n            mostrarToast('warning', 'El archivo no contiene datos');\n            return;\n        }\n\n        $('#modal-cargar-archivo').modal('hide');\n        $('#modal-agregar-candidatos').modal('show');\n\n        if (tipo_importacion === 'pandape') {\n            procesarCandidatosPandaPe(datos_excel);\n        } else {\n            procesarCandidatosMasivos(datos_excel);\n        }\n\n        $('#' + input_id).val('').trigger('change');\n        archivo_cargado = '';\n        $('#boton-guardar-archivo').prop('disabled', true);\n    } catch (error) {\n        mostrarToast('danger', 'Error al leer el archivo Excel. Verifica que el formato sea correcto.');\n    }\n}\n\n/**\n * Lee un archivo Excel y retorna los datos como array de objetos.\n *\n * @param {File} archivo Archivo Excel a leer\n * @returns {Promise<Array>}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nasync function leerArchivoExcel(archivo) {\n    return new Promise((resolve, reject) => {\n        var lector = new FileReader();\n\n        lector.onload = function(evento) {\n            try {\n                var datos = new Uint8Array(evento.target.result);\n                var libro = XLSX.read(datos, { type: 'array' });\n                var nombre_hoja = libro.SheetNames[0];\n                var hoja = libro.Sheets[nombre_hoja];\n\n                // Intentar leer con encabezados en la fila 1 (por defecto)\n                var datos_json = XLSX.utils.sheet_to_json(hoja);\n\n                // Si no hay datos o las columnas esperadas no existen, intentar desde fila 6\n                if (datos_json.length === 0 ||\n                    (!datos_json[0]['Número de documento'] &&\n                     !datos_json[0]['Número de identificación'] &&\n                     !datos_json[0]['Correo electrónico'])) {\n                    // Leer desde la fila 6 como encabezados\n                    datos_json = XLSX.utils.sheet_to_json(hoja, { range: 5 }); // range: 5 = fila 6 (0-indexed)\n                }\n\n                resolve(datos_json);\n            } catch (error) {\n                reject(error);\n            }\n        };\n\n        lector.onerror = function(error) {\n            reject(error);\n        };\n\n        lector.readAsArrayBuffer(archivo);\n    });\n}\n\n/**\n * Procesa los candidatos cargados masivamente y los agrega a la lista.\n *\n * @param {Array} datos Array con los datos de los candidatos\n * @returns {void}\n * @author Andres Morales\n * @author Andres Gonzalez\n */\nfunction procesarCandidatosMasivos(datos) {\n    var mapeo_tipos_documento = {\n        'cédula de ciudadanía': 1,\n        'cedula de ciudadania': 1,\n        'cc': 1,\n        'tarjeta de identidad': 2,\n        'ti': 2,\n        'pasaporte': 3,\n        'cédula de extranjería': 4,\n        'cedula de extranjeria': 4,\n        'ce': 4\n    };\n\n    var candidatos_agregados_exitosamente = 0;\n    var candidatos_duplicados = 0;\n    var candidatos_con_errores = 0;\n\n    datos.forEach((fila) => {\n        var tipo_documento_texto = fila['Tipo de documento'] || fila.tipo_documento || fila.TipoDocumento || '';\n        var tipo_documento_id = 1;\n\n        if (tipo_documento_texto && typeof tipo_documento_texto === 'string') {\n            var tipo_normalizado = tipo_documento_texto.toLowerCase().trim();\n            tipo_documento_id = mapeo_tipos_documento[tipo_normalizado] || 1;\n        } else if (tipo_documento_texto && typeof tipo_documento_texto === 'number') {\n            tipo_documento_id = tipo_documento_texto;\n        }\n\n        var documento = String(fila['Número de identificación'] || fila['Número de documento'] || fila.numero_documento || fila.NumeroDocumento || fila.Documento || fila.documento || '').trim();\n        var email = String(fila['Correo electrónico'] || fila.email || fila.correo || fila.Email || fila.Correo || '').trim();\n\n        if (!documento || !email) {\n            candidatos_con_errores++;\n            return;\n        }\n\n        var regex_correo = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        if (!regex_correo.test(email)) {\n            candidatos_con_errores++;\n            return;\n        }\n\n        var existe = candidatos_agregados.some(candidato =>\n            candidato.documento === documento || candidato.email === email\n        );\n\n        if (existe) {\n            candidatos_duplicados++;\n            return;\n        }\n\n        var candidato = {\n            tipo_documento_id: tipo_documento_id,\n            documento: documento,\n            email: email\n        };\n\n        candidatos_agregados.push(candidato);\n        candidatos_agregados_exitosamente++;\n    });\n\n    actualizarListaCandidatos();\n\n    var mensaje = `Se agregaron ${candidatos_agregados_exitosamente} candidato(s) exitosamente.`;\n\n    if (candidatos_duplicados > 0) {\n        mensaje += ` ${candidatos_duplicados} duplicado(s) omitido(s).`;\n    }\n\n    if (candidatos_con_errores > 0) {\n        mensaje += ` ${candidatos_con_errores} con errores omitido(s).`;\n    }\n\n    if (candidatos_agregados_exitosamente > 0) {\n        mostrarToast('success', mensaje);\n    } else {\n        mostrarToast('warning', 'No se agregaron candidatos. Verifica el formato del archivo.');\n    }\n}\n\n/**\n * Procesa candidatos desde Excel de PandaPe con datos completos\n * Lee todos los campos adicionales disponibles\n *\n * @param {Array} datos Array con los datos de los candidatos\n * @returns {void}\n */\nfunction procesarCandidatosPandaPe(datos) {\n    var mapeo_tipos_documento = {\n        'cédula de ciudadanía': 1,\n        'cedula de ciudadania': 1,\n        'cc': 1,\n        'tarjeta de identidad': 2,\n        'ti': 2,\n        'pasaporte': 3,\n        'cédula de extranjería': 4,\n        'cedula de extranjeria': 4,\n        'ce': 4\n    };\n\n    var candidatos_agregados_exitosamente = 0;\n    var candidatos_duplicados = 0;\n    var candidatos_con_errores = 0;\n\n    datos.forEach((fila) => {\n        try {\n            // === CAMPOS OBLIGATORIOS ===\n            var tipo_documento_texto = fila['Tipo de documento'] || fila.tipo_documento || '';\n            var tipo_documento_id = 1;\n\n            if (tipo_documento_texto && typeof tipo_documento_texto === 'string') {\n                var tipo_normalizado = tipo_documento_texto.toLowerCase().trim();\n                tipo_documento_id = mapeo_tipos_documento[tipo_normalizado] || 1;\n            }\n\n            var documento = String(fila['Número de identificación'] || fila['Número de documento'] || '').trim();\n            var email = String(fila['Correo electrónico'] || fila.email || '').trim();\n\n            // Validaciones básicas\n            if (!documento || !email) {\n                candidatos_con_errores++;\n                return;\n            }\n\n            var regex_correo = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n            if (!regex_correo.test(email)) {\n                candidatos_con_errores++;\n                return;\n            }\n\n            // Verificar duplicados\n            var existe = candidatos_agregados.some(c =>\n                c.documento === documento || c.email === email\n            );\n\n            if (existe) {\n                candidatos_duplicados++;\n                return;\n            }\n\n            // === CONSTRUIR OBJETO CON CAMPOS EXISTENTES EN BD ===\n            var candidato = {\n                tipo_documento_id: tipo_documento_id,\n                documento: documento,\n                email: email,\n\n                // Datos personales (campos existentes)\n                nombres: limpiarTexto(fila['Nombre'] || fila.nombre || ''),\n                apellidos: limpiarTexto(fila['Apellido'] || fila.apellido || ''),\n                telefono: limpiarTelefono(fila['Teléfono'] || fila.telefono || ''),\n                telefono_secundario: limpiarTelefono(fila['Teléfono celular'] || fila.telefono_celular || ''),\n\n                // Ubicación (campos existentes)\n                departamento: limpiarTexto(fila['Departamento'] || fila.departamento || ''),\n                ciudad: limpiarTexto(fila['Ciudad'] || fila.ciudad || ''),\n                direccion: limpiarTexto(fila['Dirección'] || fila.direccion || ''),\n\n                // Demográficos (solo campos existentes)\n                fecha_nacimiento: fila['Fecha de nacimiento'] || fila.fecha_nacimiento || '',\n                genero: limpiarTexto(fila['Género'] || fila.genero || ''),\n\n                // Perfil laboral\n                salario_minimo: limpiarTexto(fila['Salario mínimo'] || fila.salario_minimo || ''),\n\n                // Campos complejos (para parsear en backend)\n                experiencia_profesional: limpiarTexto(fila['Experiencia profesional'] || fila.experiencia_profesional || ''),\n                formacion: limpiarTexto(fila['Formación'] || fila.formacion || ''),\n                idiomas: limpiarTexto(fila['Idiomas'] || fila.idiomas || '')\n            };\n\n            candidatos_agregados.push(candidato);\n            candidatos_agregados_exitosamente++;\n\n        } catch (error) {\n            console.error('Error procesando candidato PandaPe:', error);\n            candidatos_con_errores++;\n        }\n    });\n\n    actualizarListaCandidatos();\n\n    var mensaje = `Se agregaron ${candidatos_agregados_exitosamente} candidato(s) desde PandaPe.`;\n    if (candidatos_duplicados > 0) {\n        mensaje += ` ${candidatos_duplicados} duplicado(s) omitido(s).`;\n    }\n    if (candidatos_con_errores > 0) {\n        mensaje += ` ${candidatos_con_errores} con errores omitido(s).`;\n    }\n\n    if (candidatos_agregados_exitosamente > 0) {\n        mostrarToast('success', mensaje);\n    } else {\n        mostrarToast('warning', 'No se agregaron candidatos. Verifica el formato del archivo.');\n    }\n}\n\n/**\n * Limpia texto eliminando espacios extra\n *\n * @param {string} texto - Texto a limpiar\n * @returns {string}\n */\nfunction limpiarTexto(texto) {\n    if (!texto) return '';\n    return String(texto).trim().replace(/\\s+/g, ' ');\n}\n\n/**\n * Limpia número de teléfono eliminando caracteres no numéricos\n *\n * @param {string} telefono - Teléfono a limpiar\n * @returns {string}\n */\nfunction limpiarTelefono(telefono) {\n    if (!telefono) return '';\n    return String(telefono).replace(/[^\\d+]/g, '');\n}\n\n/**\n * Guarda los candidatos agregados a la vacante.\n *\n * @returns {Promise<void>}\n * @author Andres Morales\n * @author Esperanza Olivo\n */\nasync function guardarCandidatosVacante() {\n    var vacante_id = $('#vacante_id').val();\n    var titulo_mensaje = $('#titulo_mensaje').val().trim();\n    var descripcion_mensaje = $('#descripcion_mensaje').data('editor') ? $('#descripcion_mensaje').data('editor').getData() : '';\n\n    if (candidatos_agregados.length === 0) {\n        mostrarToast('warning', 'Por favor agrega al menos un candidato');\n        return;\n    }\n\n    $('#boton-guardar-candidatos').prop('disabled', true).html('<span class=\"spinner-border spinner-border-sm me-2\"></span>Guardando...');\n\n    try {\n        await $.ajax({\n            url: '/vacantes-postular-aplicantes',\n            type: 'POST',\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: vacante_id,\n                titulo: titulo_mensaje,\n                mensaje: descripcion_mensaje,\n                aplicantes: candidatos_agregados\n            }\n        });\n\n        mostrarToast('success', 'Candidatos agregados exitosamente');\n\n        $('#modal-agregar-candidatos').modal('hide');\n\n        if (typeof actualizarDatatables !== 'undefined' && typeof nombre_tabla_vacantes !== 'undefined') {\n            actualizarDatatables(nombre_tabla_vacantes);\n        }\n\n        if (typeof vacante_datos !== 'undefined' && typeof encabezadoDetalle === 'function') {\n            vacante_datos.conteo_aplicantes = (vacante_datos.conteo_aplicantes || 0) + candidatos_agregados.length;\n            encabezadoDetalle(vacante_datos);\n            actualizarConteoAplicantes(vacante_datos.conteo_aplicantes);\n        }\n\n        if (typeof cargarEtapasConCandidatos === 'function' && typeof prepararFiltrosActuales === 'function') {\n            cargarEtapasConCandidatos(prepararFiltrosActuales());\n        }\n    } catch (error) {\n        mostrarToast('danger', error.responseJSON?.errors || 'Ocurrió un error al agregar los candidatos');\n    } finally {\n        $('#boton-guardar-candidatos').prop('disabled', false).html('Agregar');\n    }\n}\n\n$(document).on('change', '#archivo_candidatos_normal, #archivo_candidatos_pandape', function(evento) {\n    if (evento.target.files && evento.target.files[0]) {\n        archivo_cargado = evento.target.files[0];\n        $('#boton-guardar-archivo').prop('disabled', false);\n    } else {\n        archivo_cargado = '';\n        $('#boton-guardar-archivo').prop('disabled', true);\n    }\n});\n","numLines":1230,"startLine":1,"totalLines":1230}},"sourceToolAssistantUUID":"e212186f-db83-4fd6-b167-ba7888fe30b2"}
{"parentUuid":"a31ffd62-9083-4c71-8529-956a9d8e2d4f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EzgeaPCdyQ5EtD1vDpDe5h","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora tengo ambas funciones. Veo que:\n\n**modalSuspender** (la referencia):\n- Usa template literals de JavaScript en el HTML\n- Usa el sistema de componentes `crearBoton()`\n- Tiene una estructura más moderna y consistente con el diseño del proyecto\n- Usa `Swal.clickDeny()` y `Swal.clickConfirm()` para los botones\n- Tiene botones con clases Bootstrap personalizadas (`btn-outline-primary`, `btn-primary`)\n- El HTML está estructurado con un grid de Bootstrap\n\n**reprocesarAgenda** (la que necesita actualizarse):\n- Usa el antiguo sistema de SweetAlert2 con title, text, icon\n- No usa el sistema de componentes UI del proyecto\n- Usa botones nativos de SweetAlert2 en lugar de componentes personalizados\n- No sigue la estructura moderna de modales del proyecto\n\nNecesito transformar `reprocesarAgenda` para que use el mismo estilo que `modalSuspender`:\n1. Cambiar a usar `html` en lugar de title/text/icon\n2. Usar `crearBoton()` para los botones\n3. Usar la estructura de grid de Bootstrap\n4. Seguir el patrón de diseño moderno del proyecto\n5. Mantener la lógica de tres opciones (reprocesar, reprocesar y enviar correo, cancelar)","signature":"EokKCkYICxgCKkDvr2lvjWD/hlyCPt28PZUjtg8ytBZQzSdDxfcSBP0eze7PBSYpscgaJ+Ob5Eq2jA02AZLEDj4Z1Nft7xKJHkDIEgxQr/HbTljnMj2oDBgaDNXiZTTZYZdlpQ4ucSIwsdkngVhbK7TN79uhp5clSGEHMX00JaV5w0S8QUb+NI6d3ZO0zuJbciSkLakaaz7cKvAI6UTuA1rWtesghHixYxEQfsmhvQATx3Gk8tUtY0g8WV+6nCNYFwJKfCeX21Sq20BAGuOgqfUXaE8zgqjC8h2xzK/iMYwHJX9iMKhjxdgvYuDJf1xJBrSkpd6VWdZC388s4nX4kXbloCxHRKqNu7Rl3o6M6t5DfjZ9ku6he+s3Z88qpgGanCibt+BgglTw7i4ZFePkHCtNP816DiKjbWZrd26aGgrU+GE8i59VPfp0jdFo+cWjE1Y2BDL/0f147JBpUzy1kWbZSwSfgDAPqY9YlfS8vsFrnra70dtmancoQ6c8g0QKikxBvrRbQUQSj/MhIaNkgUEkC7R9dS33RA6Cur8f0QI2EJHDUw1bYt1UtkC3emdqCYjbZZyiDND56eSROgK3EG5BgDFHjLuBdT3ok4Jxwaat1SwD2j1vhkdsQ2TyG727H3Rydjln3en9tTMBLqMmqAbaIxKmX1ppl+dbtMDqM00NDINAmDcBGj2ZEd2koHJMaoA3POu+gG6uadWVkA9JZ4QeOxqqU9wtL+pL0WD6gjpdPyPmwsIl3HVn5eASM0NyiHo8sO1+yQ55I+HlUzGF9TVvsch6/ezsmOOn3cGoxuTVkBgBTs1V6sCspd+luagv4ox3izd8N1njbxknmECBjem0JncW8810dh7lEnrish2aj/T08cbWTt6dYh9Wiqz6EYKUQ/WDR8c3QG9Nma/njMba2DZJ0KnHlEQi4rUDPlH0HaKeMTJ/7GAMQ+pyYAK+kIiu+gOi7UDO2Ke8LLqZoBO5p5bwGY1isIN/hH/DlFx7MouHtijP/maiyngeBQm72PnZruOwBEoKhdTxLBoAYgHK6/Vcz/Ktktw7MIgkr1juhbC2+Mt8ZkPlZQB/81V7KVqyDMLJVOF8IhhDvQtOGs85AXqNtPo6lTFlMJlvLd4IQxza837Ju86An0rUxvTezTdLXpLLNHJnBVASn+JFC6qyZLYXwk5SO1aAppqKKlznIcN6f5Kr4rS2XYj/L0ZnzBEh314/H9GkTCwGXoWX0VcXRymoAZKUvDrDGXRTzqGfLqqyp9xGcY5oH8KKpapdYR20x0Nf2QEbqGZHmeBStiljiPFrcG/THVVDNtpQw+Jp5i/5t920yO3Lmi1dWzzIQzCB1eCqP8PqxjrgZm2kon4c6D3GatedmxdCJDlP2cXn6TLmHTK+InhdAqaN/mSGytREXM5mhvLTJxZIvqpyGCkuVKSzQCXmZxh8Hf1Jn3eBGBXsc65uzMMoFAfisUao/xpL3bFEJclImhQieULiQ+Cd0C6sqFZgsP3PXl8hDKjatj8P5si1VuR3nU1LONWm5BEAkz3k7tIy5IUSk8aBFDZ5HAGcnWNpKDxfTUeSxRWQW8AucX4/BLt37MTyl2uXO9ZYmu7xPm4pnTPqKa0LET/SjW2/HpXlkWf1fk+Q3OfkKu1BP7wfMx2ft5x9DkoSZrljwJnR5Nb05BuLIpy+Jd+JrKIBMI+gi1AJ4cbnFUpP3sBFtmIY0zOoxQQYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":859,"cache_creation_input_tokens":17883,"cache_read_input_tokens":35545,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":17883},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoZwGiKuQ4ZfaPjzNk6z","type":"assistant","uuid":"3bdfc451-b085-4817-9ae8-595a3dcce0b2","timestamp":"2026-02-04T19:19:09.184Z"}
{"parentUuid":"3bdfc451-b085-4817-9ae8-595a3dcce0b2","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EzgeaPCdyQ5EtD1vDpDe5h","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a actualizar la función `reprocesarAgenda` para que use el mismo estilo moderno que `modalSuspender` con el sistema de componentes del proyecto."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":859,"cache_creation_input_tokens":17883,"cache_read_input_tokens":35545,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":17883},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoZwGiKuQ4ZfaPjzNk6z","type":"assistant","uuid":"e171dcf0-f27f-4414-a413-fb49f9124c09","timestamp":"2026-02-04T19:19:09.875Z"}
{"parentUuid":"e171dcf0-f27f-4414-a413-fb49f9124c09","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EzgeaPCdyQ5EtD1vDpDe5h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01F3HHpkdM7fuZ5GE9WBgBio","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"function reprocesarAgenda(agenda_id, nombre_tabla) {\n    console.log('Reprocesar agenda ID:', agenda_id);\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}","new_string":"function reprocesarAgenda(agenda_id, nombre_tabla) {\n    console.log('Reprocesar agenda ID:', agenda_id);\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Reprocesar agenda?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                    Esta acción volverá a procesar los resultados de la agenda.\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.close();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Solo reprocesar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-success w-100 justify-content-center',\n                        texto: 'Reprocesar y enviar correo',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":859,"cache_creation_input_tokens":17883,"cache_read_input_tokens":35545,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":17883},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoZwGiKuQ4ZfaPjzNk6z","type":"assistant","uuid":"2c17a7ca-d242-4589-acc0-75de4f81a3ef","timestamp":"2026-02-04T19:19:24.165Z"}
{"type":"file-history-snapshot","messageId":"2c17a7ca-d242-4589-acc0-75de4f81a3ef","snapshot":{"messageId":"3456d9a6-4e1e-4017-97d9-7c5812a77781","trackedFileBackups":{"app\\Models\\Vacantes\\EtapaVacanteUsuario.php":{"backupFileName":"8e9db565b73c39ad@v3","version":3,"backupTime":"2026-02-04T19:18:46.190Z"},"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-02-04T19:18:46.218Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v1","version":1,"backupTime":"2026-02-04T19:19:28.788Z"}},"timestamp":"2026-02-04T19:18:46.163Z"},"isSnapshotUpdate":true}
{"parentUuid":"2c17a7ca-d242-4589-acc0-75de4f81a3ef","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01F3HHpkdM7fuZ5GE9WBgBio","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated successfully."}]},"uuid":"023d4373-5201-4362-a284-87af03da54fa","timestamp":"2026-02-04T19:19:28.931Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"function reprocesarAgenda(agenda_id, nombre_tabla) {\n    console.log('Reprocesar agenda ID:', agenda_id);\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}","newString":"function reprocesarAgenda(agenda_id, nombre_tabla) {\n    console.log('Reprocesar agenda ID:', agenda_id);\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Reprocesar agenda?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                    Esta acción volverá a procesar los resultados de la agenda.\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.close();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Solo reprocesar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-success w-100 justify-content-center',\n                        texto: 'Reprocesar y enviar correo',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(input_id, filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: null,\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n\n    if (aplicante.adecuacion !== null) {\n        if (adecuacion <= ADECUACION_CALIFICACION_BAJA) {\n            borde_color = 'borde-indice-talento-rojo';\n            etiqueta_estilo = 'badge-indice-talento-rojo';\n        } else if (adecuacion <= ADECUACION_CALIFICACION_ALTA) {\n            borde_color = 'borde-indice-talento-amarillo';\n            etiqueta_estilo = 'badge-indice-talento-amarillo';\n        } else {\n            borde_color = 'borde-indice-talento-verde';\n            etiqueta_estilo = 'badge-indice-talento-verde';\n        }\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').removeClass('d-none');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').removeClass('d-none');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || '',\n                                        disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n * @author Andres Gonzalez\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    console.log('Reprocesar agenda ID:', agenda_id);\n    Swal.fire({\n        title: '¿Reprocesar agenda?',\n        text: \"Esta acción volverá a procesar los resultados de la agenda.\",\n        icon: 'question',\n        showCancelButton: true,\n        showDenyButton: true,\n        confirmButtonColor: '#3085d6',\n        denyButtonColor: '#28a745',\n        cancelButtonColor: '#6c757d',\n        confirmButtonText: 'Solo reprocesar',\n        denyButtonText: 'Reprocesar y enviar correo',\n        cancelButtonText: 'Cancelar'\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @param {object} etapa Objeto de la etapa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction crearPregunta(pregunta, etapa) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta, etapa)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @param {object} etapa Objeto de la etapa.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction crearRespuesta(pregunta, etapa) {\n    let etapa_actual = detalle_usuario?.etapa_actual?.etapa?.nombre === etapa.nombre_etapa;\n\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            }),\n                                            disabled: !etapa_actual\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            }),\n                                            disabled: !etapa_actual\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta, etapa);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                                disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n\n            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];\n            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    $('#contenedor-archivos-contratacion').closest('.accordion-body').empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":1526,"oldLines":17,"newStart":1526,"newLines":40,"lines":[" function reprocesarAgenda(agenda_id, nombre_tabla) {","     console.log('Reprocesar agenda ID:', agenda_id);","     Swal.fire({","-        title: '¿Reprocesar agenda?',","-        text: \"Esta acción volverá a procesar los resultados de la agenda.\",","-        icon: 'question',","-        showCancelButton: true,","-        showDenyButton: true,","-        confirmButtonColor: '#3085d6',","-        denyButtonColor: '#28a745',","-        cancelButtonColor: '#6c757d',","-        confirmButtonText: 'Solo reprocesar',","-        denyButtonText: 'Reprocesar y enviar correo',","-        cancelButtonText: 'Cancelar'","+        showCloseButton: true,","+        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',","+        showConfirmButton: false,","+        showDenyButton: false,","+        showCancelButton: false,","+        html: `","+            <div class=\"row w-100 mx-0 mt-2\">","+                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Reprocesar agenda?</div>","+                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">","+                    Esta acción volverá a procesar los resultados de la agenda.","+                </div>","+                <div class=\"col-4 mt-5 mb-2\">","+                    ${crearBoton({","+                        clases: 'btn-outline-primary w-100 justify-content-center',","+                        texto: 'Cancelar',","+                        onclick: `Swal.close();`","+                    })}","+                </div>","+                <div class=\"col-4 mt-5 mb-2\">","+                    ${crearBoton({","+                        clases: 'btn-primary w-100 justify-content-center',","+                        texto: 'Solo reprocesar',","+                        onclick: `Swal.clickConfirm();`","+                    })}","+                </div>","+                <div class=\"col-4 mt-5 mb-2\">","+                    ${crearBoton({","+                        clases: 'btn-success w-100 justify-content-center',","+                        texto: 'Reprocesar y enviar correo',","+                        onclick: `Swal.clickDeny();`","+                    })}","+                </div>","+            </div>","+        `,","     }).then((resultado) => {","         if (resultado.isConfirmed || resultado.isDenied) {","             let enviar_correo = resultado.isDenied;"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"2c17a7ca-d242-4589-acc0-75de4f81a3ef"}
{"parentUuid":"023d4373-5201-4362-a284-87af03da54fa","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01WhrFMdj5tN1fnpCCmA1Shd","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto. He actualizado la función `reprocesarAgenda` para que siga el mismo patrón moderno que `modalSuspender`. Los cambios principales son:\n\n1. Eliminé las propiedades antiguas de SweetAlert2 (title, text, icon, confirmButtonColor, etc.)\n2. Agregué el sistema moderno con `html` y estructura Bootstrap\n3. Usé el componente `crearBoton()` para los tres botones\n4. Usé la estructura de grid de Bootstrap con columnas de 4 (col-4) para los tres botones\n5. Mantuve la lógica original con los tres casos: cancelar, solo reprocesar, y reprocesar y enviar correo\n6. Usé las clases de botones modernas del proyecto (btn-outline-primary, btn-primary, btn-success)\n7. Agregué el botón de cierre con el ícono Bootstrap Icons\n8. Mantuve toda la lógica AJAX original\n\nEl modal ahora se ve y funciona como los demás modales modernos del proyecto.","signature":"EvYHCkYICxgCKkA8r63uRCtDoap9wQWu8A2f6VT5d92Fnp1XLXwBs8R2iLSOhdQ7/IRD90DoUz1AU0IiEqIvzYbLl/RAurp/aibbEgz59bXx3oRcK3AgIKAaDE0TcPX93fvOY8wjhSIwT5hpXtEgoeH3G3k1tG2RggfvlH+YOldo7/LaVHINYsaMXuhLki5xujAILpcCWmgzKt0GkfPYM9i86190vgHbcQf3BK7W8MySZTHtgKjfnFNz1ZQPhK5AXWhkVIphlw33mDTEA+LiZoJnb9cT9KEO0vpSQpquOxr+NPYNK6+g4GdAKK3JdlX1Ybu9Dj3JD1PWlNphfn/8oPLqBqnY1a5r9z7zKuH/ZSOGDS3acj7wawxK4iRSTkCzGG8Fcx+V//PR40zJcbgZ63IGiDMQxwhKJujcEeTNGSf/gx1HSMz1sVp6iOvVuB1u4XzmC749UvdXJ48LJxLKldI4RL1vNKe4qlBb3kiK7Daq53SyN5mEURU8Tj/bAsQmT8D7dJ7qOEaMbuhqTZFCb06DDX55mzHWDkFMuFtKkvO8UyqDXm8gghe2XLjuOmVBYRS0Obkmu5rBs0PzlhPhv4JZReSsg1aKXQD3sFZ3MjA+UUdgaZhSbfE5LyG2tTwQ0MHzqxQ587Is8o1fkvCxKxy1r9fBviHY87wXAcv5p7Lj4IEpb+IoCfI5Qh2XuoGT1FV8kvZQUvFlV5/wcMNufWnjMV682BKaxplGoa8J/ubydTqvOAcBm5N3cC15wp0OaWaS7fCaXAUb5THLTUsIKrvkvwiXmHbnH0kppaX/0x2OhHbiXUiolsdbjfpED9HJfpwo3t/pOTdJLQNRxfTbJYm0+voWek54nwP1x45/bNmk7gQ1fYrsTu85g+Fp4SE/4BDQUINFTMQtbsJwAfIs5I0I5WVUQSWjlFeqhp8wZ1/9SLaFoNGZFZg3uHg+Pj1yckv/3bTzthBESeLK0Ow6DS1JHMPMGvTUSOcRCAWRco9SLzZPoIh2eYlXxTfrxBUjr2OC4lbbzg9V9l1Kxp65CFDOTQUmMdC8Yd5Cfn4G3gBaOW1tNCllQZ0kZH+o2eodyqIMs9NPfXnSLtibD94TaUr/gfvjPHq568dNkndUGum4nPDN6qU51RfqWk7K4juRF7yRQLTyHS+c3enRCqpUzXVlnK7DKyXCDfCE0TA69WDxmnZilbXFz2PwlFMz/mjZmp76et3ODThUHlLlMaVLKmBkaKgQJ0KOUuSTGbmPQ5KOCJUdueOFc/sJHVVSGnDl60HEKi7zyCa3HSkkdOxhuL+XuOszxLGvYLFZ/SY2Xu9v/G2w7TZzpUjKuReOWIEMdcwSVTM3aJAGGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2803,"cache_read_input_tokens":53428,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2803},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoZyeqQHbJe3tqrkryH9","type":"assistant","uuid":"bdd81a72-3c9e-4c5f-9991-f6332b5b9ae6","timestamp":"2026-02-04T19:19:39.559Z"}
{"parentUuid":"bdd81a72-3c9e-4c5f-9991-f6332b5b9ae6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01WhrFMdj5tN1fnpCCmA1Shd","type":"message","role":"assistant","content":[{"type":"text","text":"Listo! He actualizado la función `reprocesarAgenda` para que use el mismo estilo moderno que `modalSuspender`. Los principales cambios fueron:\n\n**Cambios realizados en [detalle-resultados.js](public/js/vacantes/detalles/detalle-resultados.js#L1526)**:\n\n1. **Eliminé el estilo antiguo de SweetAlert2**: Ya no usa `title`, `text`, `icon`, `confirmButtonColor`, etc.\n\n2. **Implementé la estructura moderna con HTML personalizado**:\n   - Grid de Bootstrap con diseño responsive\n   - Títulos y textos con clases tipográficas del sistema de diseño\n   - Botón de cierre con ícono Bootstrap Icons\n\n3. **Usé el sistema de componentes UI**: Los tres botones ahora usan `crearBoton()` siguiendo las convenciones del proyecto\n\n4. **Distribución de botones**: 3 columnas de igual tamaño (`col-4`) para:\n   - Cancelar (outline-primary)\n   - Solo reprocesar (primary)\n   - Reprocesar y enviar correo (success)\n\n5. **Mantuve toda la lógica original**: El comportamiento AJAX y las actualizaciones de datatables siguen igual\n\nAhora el modal tiene un aspecto consistente con el resto de modales del proyecto."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2803,"cache_read_input_tokens":53428,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2803},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoZyeqQHbJe3tqrkryH9","type":"assistant","uuid":"356f9fc3-d7b1-4122-bb11-254d98515826","timestamp":"2026-02-04T19:19:45.054Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-04T19:25:01.901Z","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac"}
{"type":"file-history-snapshot","messageId":"92fccd4c-fde9-484c-828b-b4089b097759","snapshot":{"messageId":"92fccd4c-fde9-484c-828b-b4089b097759","trackedFileBackups":{"app\\Models\\Vacantes\\EtapaVacanteUsuario.php":{"backupFileName":"8e9db565b73c39ad@v3","version":3,"backupTime":"2026-02-04T19:18:46.190Z"},"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-02-04T19:18:46.218Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v2","version":2,"backupTime":"2026-02-04T19:25:03.376Z"}},"timestamp":"2026-02-04T19:25:03.360Z"},"isSnapshotUpdate":false}
{"parentUuid":"356f9fc3-d7b1-4122-bb11-254d98515826","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01FCNGHnTo67CMYxi7Xe9whb","parentToolUseID":"toolu_01FCNGHnTo67CMYxi7Xe9whb","uuid":"7c52172c-2742-46ac-a0f3-94807637d24a","timestamp":"2026-02-04T19:18:55.177Z"}
{"parentUuid":"7c52172c-2742-46ac-a0f3-94807637d24a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_015ZhNMejELCDn7GUvgmwmWd","parentToolUseID":"toolu_015ZhNMejELCDn7GUvgmwmWd","uuid":"38c3d363-d1bd-465d-b1c2-f66154e7e1a4","timestamp":"2026-02-04T19:18:56.707Z"}
{"parentUuid":"38c3d363-d1bd-465d-b1c2-f66154e7e1a4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_015ZhNMejELCDn7GUvgmwmWd","toolUseID":"toolu_015ZhNMejELCDn7GUvgmwmWd","timestamp":"2026-02-04T19:18:58.054Z","uuid":"506b4e9b-cb70-44c5-a9d5-61f0a820310a"}
{"parentUuid":"506b4e9b-cb70-44c5-a9d5-61f0a820310a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01FCNGHnTo67CMYxi7Xe9whb","toolUseID":"toolu_01FCNGHnTo67CMYxi7Xe9whb","timestamp":"2026-02-04T19:18:58.086Z","uuid":"0a61b38c-95bc-476c-814a-c94cfd5337c9"}
{"parentUuid":"0a61b38c-95bc-476c-814a-c94cfd5337c9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01F3HHpkdM7fuZ5GE9WBgBio","parentToolUseID":"toolu_01F3HHpkdM7fuZ5GE9WBgBio","uuid":"e5005deb-6f0b-4f7c-85e7-ccb0aab216c1","timestamp":"2026-02-04T19:19:24.319Z"}
{"parentUuid":"e5005deb-6f0b-4f7c-85e7-ccb0aab216c1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01F3HHpkdM7fuZ5GE9WBgBio","parentToolUseID":"toolu_01F3HHpkdM7fuZ5GE9WBgBio","uuid":"14a2cde6-bcda-4553-b617-0dc9bfdd3b12","timestamp":"2026-02-04T19:19:24.320Z"}
{"parentUuid":"14a2cde6-bcda-4553-b617-0dc9bfdd3b12","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01F3HHpkdM7fuZ5GE9WBgBio","toolUseID":"toolu_01F3HHpkdM7fuZ5GE9WBgBio","timestamp":"2026-02-04T19:19:28.934Z","uuid":"c3ffed66-98a1-4f1f-833a-2563fe10ccc8"}
{"parentUuid":"c3ffed66-98a1-4f1f-833a-2563fe10ccc8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01F3HHpkdM7fuZ5GE9WBgBio","toolUseID":"toolu_01F3HHpkdM7fuZ5GE9WBgBio","timestamp":"2026-02-04T19:19:28.935Z","uuid":"777d75cd-658a-4fa5-b6e8-7fc839642542"}
{"parentUuid":"777d75cd-658a-4fa5-b6e8-7fc839642542","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"listo quiero que ese modal sea un poco mas ancho"}]},"uuid":"92fccd4c-fde9-484c-828b-b4089b097759","timestamp":"2026-02-04T19:25:03.355Z","permissionMode":"default"}
{"parentUuid":"92fccd4c-fde9-484c-828b-b4089b097759","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01YDKKvw8N2hRnLy2zmPrXc3","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que el modal de `reprocesarAgenda` sea más ancho. En SweetAlert2, puedo controlar el ancho del modal usando la propiedad `width` o `customClass` con clases CSS personalizadas.\n\nLa forma más común y limpia sería agregar la propiedad `width` al objeto de configuración de Swal.fire(). Puedo usar un valor como '600px' o '50rem' o un porcentaje.\n\nTambién podría usar `customClass` para aplicar una clase personalizada, pero creo que usar `width` es más directo.","signature":"EokFCkYICxgCKkBwhx8cYZfUyZRJUNkw3az3PlXce5gbruZdQeqiCjRy8NUjLzjiuUX0JWrncemeCZjHCyGP/mHdjLv9O70R6ZZpEgz/gkq4MbNf2tToTCMaDKNDf+Px1IRfS3woHSIwyMnQxhde8uzp9jeDoTOGcC2I4vuEu4iELlWOQW7Ww8zi9KvYShv/+Fe9dvOXbIHsKvADWdB16dmVJQn9CoyI/ZBGT1AdgjzKTePbpzOWGSxes3RQtdwBSl7OE8eF3Hi2UM4HDAWVn0LkFEqpKidTQ2FbpATXJH0Tl+xzGwHp/lTGvvZe63Mqc0T+DGGkAnkp6VVZpOk3dJJr1u7O3P3YoJxzjhNeQsWGXsRE8GPq2lULITyQ6z8k5/JhR7gzePgkh1pfKtuGJVVWDDjPidm9Os0dn6phFfyrx9TwR5tPbsjo3KtIx5dM6FHDPy1LgCcW8zyefZBCmfgpR/Pq0SqohL7fvHKtp5b+geEVRfHJZxEuESdEHW9T882pAkZaYRdKonesM7FA9L3YTIyTkz1KyyIWcOyPj1bj9/gCnR1UtlgssAfwXDK0Ppiw+ewFvpAPlZCi5cFv0iUG9b76mkrRsns5R5LNoz5Yq66ceoSQZS794oODznjlHedG5dsv7mJiRk84VYr+kUv0a0476q5Uk/+CDO72sZasxabIFwROG6VlbWHuZDeGCSxra4aTGo6zJax0b9qIf2bqXPONAgjQsOYOGZkOlmqSCDV/wdcmY2NZzWsmDNHPO8mVEfQ5v2x81ZeE9bDgXgAQrAZcvyQpp0oxf9MW8A3zUiuPSGgabC6JxEYKj4z/FCREkn1OPNfpxLrHogEhCgrkSIaekC7aqm/c6xgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1210,"cache_read_input_tokens":56231,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1210},"output_tokens":8,"service_tier":"standard"}},"requestId":"req_011CXoaQCr9wzLuomNr5FDyC","type":"assistant","uuid":"9db2a9fb-6bcb-4d04-9a22-cd3d936baf1a","timestamp":"2026-02-04T19:25:10.873Z"}
{"parentUuid":"9db2a9fb-6bcb-4d04-9a22-cd3d936baf1a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01YDKKvw8N2hRnLy2zmPrXc3","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a agregar la propiedad `width` al modal para hacerlo más ancho."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1210,"cache_read_input_tokens":56231,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1210},"output_tokens":8,"service_tier":"standard"}},"requestId":"req_011CXoaQCr9wzLuomNr5FDyC","type":"assistant","uuid":"76fe8162-24e8-4d98-b105-52046c73ff57","timestamp":"2026-02-04T19:25:11.519Z"}
{"parentUuid":"76fe8162-24e8-4d98-b105-52046c73ff57","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01YDKKvw8N2hRnLy2zmPrXc3","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015UdEUa1NioHDrQthhpuDnH","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":1526,"limit":60}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1210,"cache_read_input_tokens":56231,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1210},"output_tokens":8,"service_tier":"standard"}},"requestId":"req_011CXoaQCr9wzLuomNr5FDyC","type":"assistant","uuid":"21d00eb4-863f-451c-a836-74c2d87fc2df","timestamp":"2026-02-04T19:25:12.503Z"}
{"parentUuid":"21d00eb4-863f-451c-a836-74c2d87fc2df","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015UdEUa1NioHDrQthhpuDnH","type":"tool_result","content":"  1526→function reprocesarAgenda(agenda_id, nombre_tabla) {\n  1527→    console.log('Reprocesar agenda ID:', agenda_id);\n  1528→    Swal.fire({\n  1529→        showCloseButton: true,\n  1530→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n  1531→        showConfirmButton: false,\n  1532→        showDenyButton: false,\n  1533→        showCancelButton: false,\n  1534→        html: `\n  1535→            <div class=\"row w-100 mx-0 mt-2\">\n  1536→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Reprocesar agenda?</div>\n  1537→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n  1538→                    Esta acción volverá a procesar los resultados de la agenda.\n  1539→                </div>\n  1540→                <div class=\"col-4 mt-5 mb-2\">\n  1541→                    ${crearBoton({\n  1542→                        clases: 'btn-outline-primary w-100 justify-content-center',\n  1543→                        texto: 'Cancelar',\n  1544→                        onclick: `Swal.close();`\n  1545→                    })}\n  1546→                </div>\n  1547→                <div class=\"col-4 mt-5 mb-2\">\n  1548→                    ${crearBoton({\n  1549→                        clases: 'btn-primary w-100 justify-content-center',\n  1550→                        texto: 'Solo reprocesar',\n  1551→                        onclick: `Swal.clickConfirm();`\n  1552→                    })}\n  1553→                </div>\n  1554→                <div class=\"col-4 mt-5 mb-2\">\n  1555→                    ${crearBoton({\n  1556→                        clases: 'btn-tonal-primary w-100 justify-content-center',\n  1557→                        texto: 'Reprocesar y enviar correo',\n  1558→                        onclick: `Swal.clickDeny();`\n  1559→                    })}\n  1560→                </div>\n  1561→            </div>\n  1562→        `,\n  1563→    }).then((resultado) => {\n  1564→        if (resultado.isConfirmed || resultado.isDenied) {\n  1565→            let enviar_correo = resultado.isDenied;\n  1566→            $.ajax({\n  1567→                url: `/agendas-reprocesar/${agenda_id}`,\n  1568→                type: 'POST',\n  1569→                data: {\n  1570→                    enviar_notificacion_correo: enviar_correo,\n  1571→                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n  1572→                },\n  1573→                success: function(respuesta) {\n  1574→                    if (respuesta.message) {\n  1575→                        mostrarToast('success', respuesta.message);\n  1576→                        if (nombre_tabla) {\n  1577→                            actualizarDatatables(nombre_tabla);\n  1578→                            actualizarDatatables(nombre_tabla_resultados);\n  1579→                        }\n  1580→                    }\n  1581→                },\n  1582→                error: function(xhr) {\n  1583→                    let mensaje = 'Error al reprocesar la agenda.';\n  1584→                    if (xhr.responseJSON && xhr.responseJSON.message) {\n  1585→                        mensaje = xhr.responseJSON.message;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"91ba450d-da84-4e09-8535-413f68d1da35","timestamp":"2026-02-04T19:25:13.893Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"function reprocesarAgenda(agenda_id, nombre_tabla) {\n    console.log('Reprocesar agenda ID:', agenda_id);\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Reprocesar agenda?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                    Esta acción volverá a procesar los resultados de la agenda.\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.close();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Solo reprocesar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-tonal-primary w-100 justify-content-center',\n                        texto: 'Reprocesar y enviar correo',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;","numLines":60,"startLine":1526,"totalLines":2694}},"sourceToolAssistantUUID":"21d00eb4-863f-451c-a836-74c2d87fc2df"}
{"parentUuid":"91ba450d-da84-4e09-8535-413f68d1da35","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JwXRFk53t2A1snR1g5r7NX","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Veo que la clase del tercer botón cambió de `btn-success` a `btn-tonal-primary`, probablemente el usuario o el linter lo modificó. Ahora voy a agregar la propiedad `width` al Swal.fire() para hacer el modal más ancho.","signature":"EoYDCkYICxgCKkB9PRILf/SUhOM8mYcY+fEyW6fOS6rdZTABk232CGtqEQXmFWkuO0Gu1zrktn76Kw5TEXMPOxCheuF5micJvmAIEgzXCvztbcT9U3+CcCAaDOsLrBRJVYpBzbIZUCIw3V9EG9RMa2o5CnCO+f/Dcp1GP0xZx0iDNYL6EMzKBHGVc9ZZpAkpOGy74AZY/1e8Ku0B/GfIejXkUAelb/4z8OTD6bQLp8mR7ACQPQaLYjBxa9gRaUlNrvwZDEMBR+vNusqWDsizqCgNKt+wn7RVRTpT7n+uCXpRf2ge+ZnZYbCH6+6kxQukNv58ePvxK8OVGRGz8+cS2om8C37RIV60z3DqkVRbi1UpGPfQrOwJQ2XhTks2f+FJrrl/TQrITEjeDJc/yS9S7JAPcgNGc2JyK7z3lREkwxac8qoq33T1YQ+wSdZfjXKVB3JKXej63HaD207u5JG2IGfMWGHR1ZOnepLnwWgL8f8k7cpZ5/q5qwmfWCeE2AEf5fWuotqZ7+n8GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1393,"cache_read_input_tokens":57441,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1393},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoaQxxm4CifkMJpJdT4M","type":"assistant","uuid":"129dbd58-b52d-4db5-a67a-96bc1591faf1","timestamp":"2026-02-04T19:25:20.897Z"}
{"parentUuid":"129dbd58-b52d-4db5-a67a-96bc1591faf1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JwXRFk53t2A1snR1g5r7NX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AEfjDRpPx79GGgPARzteD6","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `","new_string":"    Swal.fire({\n        width: '650px',\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1393,"cache_read_input_tokens":57441,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1393},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoaQxxm4CifkMJpJdT4M","type":"assistant","uuid":"de8565c7-2ebb-49d8-a075-c6022942bd2c","timestamp":"2026-02-04T19:25:25.328Z"}
{"parentUuid":"de8565c7-2ebb-49d8-a075-c6022942bd2c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AEfjDRpPx79GGgPARzteD6","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated successfully."}]},"uuid":"d4363553-2fa7-4f0d-80f6-b7a620878729","timestamp":"2026-02-04T19:25:43.687Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `","newString":"    Swal.fire({\n        width: '650px',\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(input_id, filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: null,\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n\n    if (aplicante.adecuacion !== null) {\n        if (adecuacion <= ADECUACION_CALIFICACION_BAJA) {\n            borde_color = 'borde-indice-talento-rojo';\n            etiqueta_estilo = 'badge-indice-talento-rojo';\n        } else if (adecuacion <= ADECUACION_CALIFICACION_ALTA) {\n            borde_color = 'borde-indice-talento-amarillo';\n            etiqueta_estilo = 'badge-indice-talento-amarillo';\n        } else {\n            borde_color = 'borde-indice-talento-verde';\n            etiqueta_estilo = 'badge-indice-talento-verde';\n        }\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').removeClass('d-none');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').removeClass('d-none');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || '',\n                                        disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n * @author Andres Gonzalez\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    console.log('Reprocesar agenda ID:', agenda_id);\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Reprocesar agenda?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                    Esta acción volverá a procesar los resultados de la agenda.\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.close();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Solo reprocesar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-tonal-primary w-100 justify-content-center',\n                        texto: 'Reprocesar y enviar correo',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @param {object} etapa Objeto de la etapa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction crearPregunta(pregunta, etapa) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta, etapa)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @param {object} etapa Objeto de la etapa.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction crearRespuesta(pregunta, etapa) {\n    let etapa_actual = detalle_usuario?.etapa_actual?.etapa?.nombre === etapa.nombre_etapa;\n\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            }),\n                                            disabled: !etapa_actual\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            }),\n                                            disabled: !etapa_actual\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta, etapa);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                                disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n\n            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];\n            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    $('#contenedor-archivos-contratacion').closest('.accordion-body').empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":1526,"oldLines":6,"newStart":1526,"newLines":7,"lines":[" function reprocesarAgenda(agenda_id, nombre_tabla) {","     console.log('Reprocesar agenda ID:', agenda_id);","     Swal.fire({","+        width: '650px',","         showCloseButton: true,","         closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',","         showConfirmButton: false,"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"de8565c7-2ebb-49d8-a075-c6022942bd2c"}
{"parentUuid":"d4363553-2fa7-4f0d-80f6-b7a620878729","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0176ALpTV2A6twJuyPuakUmQ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto, he agregado `width: '650px'` al modal para hacerlo más ancho. Esto debería darle más espacio a los tres botones que están distribuidos en columnas de 4.","signature":"Es8CCkYICxgCKkC1jLykLTF0K/1mOo5UyYt6Ihe8ELd9Obohtxh4hu+0N+oW2ccDsBq8eBKXZXOfkYdUIl8JPY4d5GZawE86o3vJEgz7P8SdYNfY092dH1EaDJ8iRFWdmtzBKBDa+SIwkL2DlkhjKiHpN3iLaYJwWswCZdjN1PmZeU4Ff50RpDYiICZjzhOyxTgJFqNvO835KrYBoKTKtS/I3hS0Sq7ZGGFiwOFn8CyCu67zj35fNC1D7ByFKKUVtG8mZQKVkCp8fqkfVh1+1OH/n5uirBn6LCn7ZQ7AylPSKUf6LbkmwrIZ+JgEgrHB+tw/RQW8gIt7+HR2sFBhWxv1GkWxt6uVL6CF4Rv3mQb6lniFGo+gYFIF8SAlwQKFujNiTECuOIIClznr9K3NYn1opOU15/xtyrbBLtIJDsjM4H3XLdX/1BT6DXuavOqEY+kYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":441,"cache_read_input_tokens":58834,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":441},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoaTHwLCxcP6GTjakHiv","type":"assistant","uuid":"59485eab-f178-476a-887a-d6c4f6e898ad","timestamp":"2026-02-04T19:25:50.118Z"}
{"parentUuid":"59485eab-f178-476a-887a-d6c4f6e898ad","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0176ALpTV2A6twJuyPuakUmQ","type":"message","role":"assistant","content":[{"type":"text","text":"Listo! He agregado la propiedad `width: '650px'` al modal en [detalle-resultados.js:1528](public/js/vacantes/detalles/detalle-resultados.js#L1528). Esto hará que el modal sea más ancho y los tres botones tengan más espacio para mostrarse correctamente."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":441,"cache_read_input_tokens":58834,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":441},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoaTHwLCxcP6GTjakHiv","type":"assistant","uuid":"a5e0653a-1fec-4955-8711-b8b093b0c67f","timestamp":"2026-02-04T19:25:51.245Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-04T20:46:47.719Z","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac"}
{"type":"file-history-snapshot","messageId":"1b04c951-0684-469a-896c-90773bbffcf7","snapshot":{"messageId":"1b04c951-0684-469a-896c-90773bbffcf7","trackedFileBackups":{"app\\Models\\Vacantes\\EtapaVacanteUsuario.php":{"backupFileName":"8e9db565b73c39ad@v3","version":3,"backupTime":"2026-02-04T19:18:46.190Z"},"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-02-04T19:18:46.218Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v3","version":3,"backupTime":"2026-02-04T20:46:49.879Z"}},"timestamp":"2026-02-04T20:46:49.817Z"},"isSnapshotUpdate":false}
{"parentUuid":"a5e0653a-1fec-4955-8711-b8b093b0c67f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_015UdEUa1NioHDrQthhpuDnH","parentToolUseID":"toolu_015UdEUa1NioHDrQthhpuDnH","uuid":"b06781d7-d737-4c65-8520-762ad8577c0c","timestamp":"2026-02-04T19:25:12.666Z"}
{"parentUuid":"b06781d7-d737-4c65-8520-762ad8577c0c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_015UdEUa1NioHDrQthhpuDnH","toolUseID":"toolu_015UdEUa1NioHDrQthhpuDnH","timestamp":"2026-02-04T19:25:13.894Z","uuid":"35ee6958-e765-4221-9f5a-20d9e9634d43"}
{"parentUuid":"35ee6958-e765-4221-9f5a-20d9e9634d43","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01AEfjDRpPx79GGgPARzteD6","parentToolUseID":"toolu_01AEfjDRpPx79GGgPARzteD6","uuid":"c73c5d97-ece2-4a7d-82b2-1448abfab293","timestamp":"2026-02-04T19:25:25.586Z"}
{"parentUuid":"c73c5d97-ece2-4a7d-82b2-1448abfab293","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01AEfjDRpPx79GGgPARzteD6","parentToolUseID":"toolu_01AEfjDRpPx79GGgPARzteD6","uuid":"42c704e9-9464-4de8-bd84-1932d3f0c003","timestamp":"2026-02-04T19:25:25.586Z"}
{"parentUuid":"42c704e9-9464-4de8-bd84-1932d3f0c003","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01AEfjDRpPx79GGgPARzteD6","toolUseID":"toolu_01AEfjDRpPx79GGgPARzteD6","timestamp":"2026-02-04T19:25:43.688Z","uuid":"fee95028-38d0-435c-b95d-5a63e9ef3f0e"}
{"parentUuid":"fee95028-38d0-435c-b95d-5a63e9ef3f0e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01AEfjDRpPx79GGgPARzteD6","toolUseID":"toolu_01AEfjDRpPx79GGgPARzteD6","timestamp":"2026-02-04T19:25:43.688Z","uuid":"612f467c-639f-4083-a026-d4aaaa416241"}
{"parentUuid":"612f467c-639f-4083-a026-d4aaaa416241","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 788 to 788 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"analiza esta funcion function verDetalleCandidato(usuario_id, etapa_expandir = null) {"}]},"uuid":"1b04c951-0684-469a-896c-90773bbffcf7","timestamp":"2026-02-04T20:46:49.755Z","permissionMode":"default"}
{"parentUuid":"1b04c951-0684-469a-896c-90773bbffcf7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_015xp5txfRr53DhtSAcmeSCc","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que analice la función `verDetalleCandidato` que está en la línea 788 del archivo `detalle-resultados.js`. Voy a leer esa función completa para analizarla.","signature":"EtoCCkYICxgCKkBsyp5XxY0RaaEgxzrKSyJX5l4Q1Qeet4RlOEdVQJVFDz8iJ0khWjIVgNjPNKQ3PYh1TcHcMTJ8JA4cpXiBN7ddEgylJfpFXhe59Ul/VRMaDDghhmKbhv5yhuzvwyIweD2lnQeKTmld9XBMIhHUzl0Myi1aLUoFN5ayZ/WyPVxsSnmTpwiqAXCNY3w33u6GKsEBvtpADVoIAdTaXpib6dYgN+O5weXOLTvsqZNGm32p+O9gWzPJEqdLrJ61u3mNHSqqTu+dI8OW7P9n/uKVnYb2MtRy5JOA+5xP0ODzGpJC9W5q+Mlgf6vrqQm0jiPPdjGcC74LE61VTBz8CZxOe66qdk7/ekrOGcNDs+3XsLp1T2XsoYJ+r5N34p+SQE6fylnNG+VCBzpj6qSeAAqFkvjLH39z32Zo8FBjXMr7Z7RJxxNbECSWYXpPgdEnpz/RK4OaehgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":60075,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":60075},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXogdvVzNiRFGUU8PBPAj","type":"assistant","uuid":"7bca0176-2c8d-4682-9ac0-36c36985a3a7","timestamp":"2026-02-04T20:46:55.520Z"}
{"parentUuid":"7bca0176-2c8d-4682-9ac0-36c36985a3a7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_015xp5txfRr53DhtSAcmeSCc","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a leer la función completa para analizarla."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":60075,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":60075},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXogdvVzNiRFGUU8PBPAj","type":"assistant","uuid":"4a6fdb06-0c6d-4cd7-a84c-ca2b2cf8b32b","timestamp":"2026-02-04T20:46:56.021Z"}
{"parentUuid":"4a6fdb06-0c6d-4cd7-a84c-ca2b2cf8b32b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_015xp5txfRr53DhtSAcmeSCc","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012ekq2pKgwynbjKdTGJU3jP","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":788,"limit":150}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":60075,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":60075},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXogdvVzNiRFGUU8PBPAj","type":"assistant","uuid":"f6798f3d-803f-4780-8943-fca8c31efe25","timestamp":"2026-02-04T20:46:56.917Z"}
{"parentUuid":"f6798f3d-803f-4780-8943-fca8c31efe25","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012ekq2pKgwynbjKdTGJU3jP","type":"tool_result","content":"   788→function verDetalleCandidato(usuario_id, etapa_expandir = null) {\n   789→    usuario_detalle_id = usuario_id;\n   790→    $.ajax({\n   791→        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n   792→        type: 'GET',\n   793→        dataType: 'json',\n   794→        success: function(respuesta) {\n   795→            detalle_usuario = respuesta.data;\n   796→            let etapas = respuesta.data.etapas;\n   797→            mostrarCardDetalleCandidato(respuesta.data);\n   798→            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n   799→                id: 'acordeon',\n   800→                acordeon: etapas.map((etapa, indice) => ({\n   801→                    id: `etapa-${indice}`,\n   802→                    titulo: `${etapa.nombre_etapa}`,\n   803→                    contenido: mostrarResultadoEtapa(etapa),\n   804→                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n   805→                    seleccionar: true,\n   806→                    acordeon_header_class: 'py-6',\n   807→                    opciones_izquierda: `\n   808→                        <div class=\"col-auto ps-2 position-absolute z-3\">\n   809→                            ${crearCheckbox({\n   810→                                id: 'checkbox',\n   811→                                name: 'checkbox',\n   812→                                class: 'checkbox-etapa',\n   813→                                required: true,\n   814→                                disabled: false,\n   815→                                onchange: `seleccionarCheckboxEtapa();`\n   816→                            })}\n   817→                        </div>\n   818→                    `,\n   819→                    opciones_derecha: `\n   820→                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n   821→                            <div class=\"row align-items-center\">\n   822→                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n   823→                                <div class=\"col-auto pe-0\">\n   824→                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n   825→                                </div>\n   826→                                `}\n   827→                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n   828→                                    ${\n   829→                                    etapa.nombre_etapa === 'Documentos para contratación'\n   830→                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n   831→                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n   832→                                            ? crearTag({\n   833→                                                texto: `Resultados pendientes`,\n   834→                                                class: 'bg-gray-80 text-gray-30'\n   835→                                            })\n   836→                                            : (etapa.puntaje != null\n   837→                                                ? crearTag({\n   838→                                                    texto: `${etapa.puntaje}%`,\n   839→                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n   840→                                                })\n   841→                                                : (etapa.puntaje_ia != null\n   842→                                                    ? crearTag({\n   843→                                                        texto: `${etapa.puntaje_ia}%`,\n   844→                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n   845→                                                    })\n   846→                                                    : crearTag({\n   847→                                                        texto: `0%`,\n   848→                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n   849→                                                    })\n   850→                                                )\n   851→                                            )\n   852→                                        )\n   853→                                    }\n   854→                                </div>\n   855→                            </div>\n   856→                        </div>\n   857→                    `\n   858→                }))\n   859→            }));\n   860→            $('#btn-abrir-archivos').on('click', function (evento_click) {\n   861→                evento_click.preventDefault();\n   862→                $('#input-archivos').trigger('click');\n   863→            });\n   864→            $('#modal-detalle-resultados').modal('show');\n   865→            inicializarTooltips();\n   866→            mostrarPuntajeTotalPrefiltro();\n   867→            inicializarClassicEditor();\n   868→            $('.tooltip').remove();\n   869→            setTimeout(ajustarAlturaListaVideos, 100);\n   870→\n   871→            // Expandir automáticamente la etapa indicada\n   872→            if (etapa_expandir) {\n   873→                setTimeout(function() {\n   874→                    expandirEtapaPorNombre(etapa_expandir);\n   875→                }, 30);\n   876→            }\n   877→        },\n   878→        error: function() {\n   879→            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n   880→        }\n   881→    });\n   882→}\n   883→\n   884→/**\n   885→ * Expandir automáticamente una etapa del acordeón por su nombre.\n   886→ *\n   887→ * @param {string} nombre_etapa Nombre de la etapa a expandir.\n   888→ * @returns {void}\n   889→ * @author Andres Gonzalez\n   890→ */\n   891→function expandirEtapaPorNombre(nombre_etapa) {\n   892→    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n   893→\n   894→    if (item_etapa.length > 0) {\n   895→        let boton = item_etapa.find('.accordion-button');\n   896→\n   897→        if (boton.hasClass('collapsed')) {\n   898→            boton.trigger('click');\n   899→        }\n   900→    }\n   901→}\n   902→\n   903→/**\n   904→ * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n   905→ *\n   906→ * @param {number} puntaje Puntaje obtenido por el aplicante.\n   907→ * @returns {string}\n   908→ * @author Daniel Beltrán\n   909→ */\n   910→function obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n   911→    let clase = 'tag-filled-smooth-red';\n   912→\n   913→    if (puntaje > 70) {\n   914→        clase = 'tag-filled-green';\n   915→    } else if (puntaje >= 41 && puntaje <= 70) {\n   916→        clase = 'tag-filled-yellow';\n   917→    }\n   918→\n   919→    return clase;\n   920→}\n   921→\n   922→/**\n   923→ * Mostrar la tarjeta detallada del candidato.\n   924→ *\n   925→ * @param {Object} candidato Objeto con la información del candidato.\n   926→ * @returns {void}\n   927→ * @author José Manuel Jiménez\n   928→ * @author Andres Gonzalez\n   929→ */\n   930→function mostrarCardDetalleCandidato(candidato) {\n   931→    $('#card-informacion-candidato').empty().append(`\n   932→        <div class=\"d-flex align-items-center\">\n   933→            <div class=\"position-relative me-4 text-center\">\n   934→                <div class=\"position-relative mb-2\">\n   935→                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n   936→                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n   937→                         ${candidato?.adecuacion || '0'}%\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"0f4ed8d2-8d9f-4434-917d-7b89a2ae9c48","timestamp":"2026-02-04T20:46:58.399Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"function verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%","numLines":150,"startLine":788,"totalLines":2695}},"sourceToolAssistantUUID":"f6798f3d-803f-4780-8943-fca8c31efe25"}
{"parentUuid":"0f4ed8d2-8d9f-4434-917d-7b89a2ae9c48","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013JCNLeRDUaUAwZm5tuFkUc","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto, ahora tengo toda la función `verDetalleCandidato`. Voy a hacer un análisis completo de esta función para el usuario.","signature":"EqoCCkYICxgCKkApG0P7gf3tJmLwBpONMhzW2B+1sFCcXrwBVCGVHXv7RQv3vZLEqJx4efM67btfKkOlwO9H4542du0nDy9LmQXMEgyYSX6/yeiXJ1V8i9waDG0EmWhHHrYY7Y01UiIwYxWsQ8TtPE6OhlKTvqDqcdzFtZoCUrk3S1u6wjIQvYJpA7D0WPpcgWSfkJ1m4MWmKpEBMTcOQaklZXXtk2NbKL/N4TFy0N/Xahuum8taN3d86GgYGX28c5q/o6HBwP/GQAyVhyoI28M4Seh2BVm/4NeArcrJ9w7+dMUH79aam6otcgvEBNkbjAY5CWxr0m5o+zIrlyq9m5mlTSgpMkeKLMTo9WRCgFLFZXSOwlV4/sb01EOqVtswXbzVODsgn+ueIeVokRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2713,"cache_read_input_tokens":60075,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2713},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXogeWWdZSCe8EahMT6xz","type":"assistant","uuid":"bb209dae-e883-489c-b8ae-60de1f240fbb","timestamp":"2026-02-04T20:47:02.271Z"}
{"parentUuid":"bb209dae-e883-489c-b8ae-60de1f240fbb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013JCNLeRDUaUAwZm5tuFkUc","type":"message","role":"assistant","content":[{"type":"text","text":"## Análisis de la función `verDetalleCandidato`\n\n### **Propósito**\nEsta función muestra un modal con el detalle completo de un candidato/aplicante en una vacante, incluyendo todas las etapas del proceso de selección que ha cursado.\n\n### **Parámetros**\n- `usuario_id` (number): ID del usuario/candidato a mostrar\n- `etapa_expandir` (string, opcional): Nombre de la etapa que se debe expandir automáticamente al abrir el modal\n\n### **Flujo de Ejecución**\n\n#### 1. **Almacenamiento del ID** (línea 789)\n```javascript\nusuario_detalle_id = usuario_id;\n```\nGuarda el ID en una variable global para uso posterior en otras funciones.\n\n#### 2. **Petición AJAX** (líneas 790-793)\n```javascript\n$.ajax({\n    url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n    type: 'GET',\n    dataType: 'json',\n```\n- Solicita los datos del candidato al endpoint\n- Usa `VACANTE_ID` (variable global) y el `usuario_id` proporcionado\n\n#### 3. **Procesamiento de Respuesta** (líneas 794-797)\n- Almacena los datos en `detalle_usuario` (variable global)\n- Extrae las etapas del candidato\n- Llama a `mostrarCardDetalleCandidato()` para mostrar la información básica\n\n#### 4. **Creación del Acordeón de Etapas** (líneas 798-859)\nConstruye un acordeón dinámico con:\n\n**Estructura de cada etapa:**\n- **Checkbox izquierdo**: Para seleccionar etapas\n- **Título**: Nombre de la etapa\n- **Contenido**: Resultados de la etapa (vía `mostrarResultadoEtapa()`)\n- **Opciones derecha**:\n  - Botón de descarga (excepto para Prueba técnica sin archivos)\n  - Tag con puntaje o estado:\n    - \"Documentos para contratación\": tag azul con cantidad de adjuntos\n    - \"Prueba técnica\" sin archivos: \"Resultados pendientes\"\n    - Con puntaje: muestra el % con color según desempeño\n    - Con puntaje IA: muestra el puntaje IA\n    - Sin puntaje: muestra 0%\n\n**Sistema de Colores de Puntaje** (función auxiliar líneas 910-920):\n- Verde (`tag-filled-green`): > 70%\n- Amarillo (`tag-filled-yellow`): 41% - 70%\n- Rojo (`tag-filled-smooth-red`): ≤ 40%\n\n#### 5. **Event Listeners y Configuración** (líneas 860-868)\n```javascript\n$('#btn-abrir-archivos').on('click', ...);  // Trigger para input de archivos\n$('#modal-detalle-resultados').modal('show'); // Abre el modal\ninicializarTooltips();                       // Inicializa tooltips\nmostrarPuntajeTotalPrefiltro();             // Muestra puntaje total\ninicializarClassicEditor();                  // Inicializa editor CKEditor\n$('.tooltip').remove();                      // Limpia tooltips previos\nsetTimeout(ajustarAlturaListaVideos, 100);   // Ajusta UI de videos\n```\n\n#### 6. **Expansión Automática de Etapa** (líneas 872-876)\nSi se proporciona `etapa_expandir`:\n```javascript\nsetTimeout(function() {\n    expandirEtapaPorNombre(etapa_expandir);\n}, 30);\n```\nExpande automáticamente la etapa especificada tras un pequeño delay.\n\n#### 7. **Manejo de Errores** (líneas 878-880)\nMuestra un toast de error si falla la petición AJAX.\n\n### **Funciones Auxiliares Relacionadas**\n\n1. **`expandirEtapaPorNombre(nombre_etapa)`** (líneas 891-901)\n   - Busca el item del acordeón por nombre de etapa\n   - Si está colapsado, simula un click para expandirlo\n\n2. **`obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje)`** (líneas 910-920)\n   - Retorna la clase CSS según el puntaje obtenido\n   - **NOTA**: Usa valores hardcodeados (70 y 41) que deberían usar las constantes que creamos antes\n\n### **Oportunidades de Mejora**\n\n1. **Usar constantes para puntajes** en `obtenerClaseEtiquetaSegunPuntajeObtenido`:\n   ```javascript\n   // Actualmente usa valores hardcodeados (70, 41)\n   // Debería usar las constantes del modelo EtapaVacanteUsuario\n   ```\n\n2. **Variables globales**: Usa `usuario_detalle_id` y `detalle_usuario` como globales, lo cual puede causar problemas de estado.\n\n3. **Timeout mágico**: El `setTimeout(..., 30)` y `setTimeout(..., 100)` son números arbitrarios que podrían fallar en dispositivos lentos.\n\n### **Dependencias**\n- jQuery y AJAX\n- Bootstrap modals y accordions\n- Sistema de componentes UI (`crearAcordeon`, `crearCheckbox`, `crearBoton`, `crearTag`)\n- CKEditor (Classic Editor)\n- Tooltips de Bootstrap\n\nEsta función es central para la visualización de candidatos en el módulo de vacantes."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2713,"cache_read_input_tokens":60075,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2713},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXogeWWdZSCe8EahMT6xz","type":"assistant","uuid":"3840cc57-cf26-4b02-a303-c125d3ea8497","timestamp":"2026-02-04T20:47:30.145Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-04T21:05:06.659Z","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac"}
{"type":"file-history-snapshot","messageId":"f1bd597e-040d-4819-9861-9475f728a76a","snapshot":{"messageId":"f1bd597e-040d-4819-9861-9475f728a76a","trackedFileBackups":{"app\\Models\\Vacantes\\EtapaVacanteUsuario.php":{"backupFileName":"8e9db565b73c39ad@v3","version":3,"backupTime":"2026-02-04T19:18:46.190Z"},"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-02-04T19:18:46.218Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v3","version":3,"backupTime":"2026-02-04T20:46:49.879Z"}},"timestamp":"2026-02-04T21:05:08.318Z"},"isSnapshotUpdate":false}
{"parentUuid":"3840cc57-cf26-4b02-a303-c125d3ea8497","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_012ekq2pKgwynbjKdTGJU3jP","parentToolUseID":"toolu_012ekq2pKgwynbjKdTGJU3jP","uuid":"4ba64e58-2529-445d-96a8-b04dd791059d","timestamp":"2026-02-04T20:46:57.137Z"}
{"parentUuid":"4ba64e58-2529-445d-96a8-b04dd791059d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_012ekq2pKgwynbjKdTGJU3jP","toolUseID":"toolu_012ekq2pKgwynbjKdTGJU3jP","timestamp":"2026-02-04T20:46:58.400Z","uuid":"c4a6b2d3-f58d-4611-ac36-1a786ee561c4"}
{"parentUuid":"c4a6b2d3-f58d-4611-ac36-1a786ee561c4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 832 to 835 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\ncrearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"mira aqui nececito hacer un ajauste <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })  y es cuando se muestra este tag crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            }) y se muestra cuando la puntuacion o la puntuacion ia es diferente a 0"}]},"uuid":"f1bd597e-040d-4819-9861-9475f728a76a","timestamp":"2026-02-04T21:05:08.275Z","permissionMode":"default"}
{"parentUuid":"f1bd597e-040d-4819-9861-9475f728a76a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01MsmRCsvMRi4syjV3qMTSbZ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere hacer un ajuste en la lógica que muestra el tag \"Resultados pendientes\". Actualmente se muestra cuando:\n- `etapa.nombre_etapa === 'Prueba técnica'` Y\n- `(etapa?.archivos?.archivos || []).length === 0`\n\nPero el usuario quiere que se muestre cuando:\n- El puntaje (`etapa.puntaje`) O el puntaje IA (`etapa.puntaje_ia`) sea diferente de 0\n\nDéjame entender mejor: creo que el usuario quiere que se muestre \"Resultados pendientes\" cuando NO haya puntaje, es decir, cuando ambos sean null o 0.\n\nEspera, el usuario dice \"se muestra cuando la puntuacion o la puntuacion ia es diferente a 0\". Esto es confuso porque actualmente se muestra cuando no hay archivos.\n\nCreo que el usuario quiere cambiar la condición para que \"Resultados pendientes\" se muestre cuando:\n- `etapa.puntaje` sea null/0 Y `etapa.puntaje_ia` sea null/0\n\nO tal vez quiere que se muestre cuando SÍ haya puntaje diferente de 0.\n\nNecesito aclarar esto con el usuario antes de hacer cambios.\n\nEspera, revisando de nuevo: \"y se muestra cuando la puntuacion o la puntuacion ia es diferente a 0\" - creo que el usuario está diciendo que actualmente se muestra mal, y quiere que se muestre solo cuando ambos puntajes sean 0 o null.\n\nDéjame leer más cuidadosamente la estructura actual:\n\n```javascript\netapa.nombre_etapa === 'Documentos para contratación'\n    ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n    : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n        ? crearTag({ texto: `Resultados pendientes`, class: 'bg-gray-80 text-gray-30' })\n        : (etapa.puntaje != null\n            ? crearTag({ texto: `${etapa.puntaje}%`, class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje) })\n            : (etapa.puntaje_ia != null\n                ? crearTag\n\nVeo que la lógica actual verifica primero si hay archivos. El usuario quiere cambiar esto para que en lugar de verificar archivos, se verifique si ambos puntajes son nulos o cero. Entonces la condición debería ser algo como `etapa.puntaje == null && etapa.puntaje_ia == null` para mostrar \"Resultados pendientes\". The current logic handles several cases: showing an empty blue tag for \"Documentos para contratación\", displaying \"Resultados pendientes\" for \"Prueba técnica\" when there are no files, showing the score if available, showing the AI score if present, or defaulting to 0%. The user's request to display \"Resultados pendientes\" when the score or AI score differs from 0 seems contradictory—I suspect they actually mean showing it when both values are 0 or null instead. I should clarify this with them before making changes.","signature":"Eq8VCkYICxgCKkATxbBcUl0J126tRSA1/GePrh4TAueIK+EK+mB3MQEPWhOyIR1qQwtYhbnAxHtfQm/U/aQeSY9dqUKU3vKRDiPQEgzv1C6t92dB2IydfkkaDOb7K9cZH6P4f9VXKiIw7ziECO7knUPYQjfix8cSbAl1uUxxCIxuDYbYGUY580Ty8YgCmMXPF6/sVVQhQLV0KpYUVPUEdg408Wxzja/sxQE5dfT8LZuCbi+pH87AgJWDDok9HPwTNz7EpjK8pGXen63/CdX5QfALdegTww9690XzsLBbERG8LFUpjAfU0jeNThEmHecgPl4SvWyPjeBMN6VW3LFfUrezWmDkYboQYrjUwZdKZuBDr1MmP+VaIOaQSeFa80Qaq6vgAAoQG7iFXLcdHhSm4nNkNxLX2ZV0zRL3dKP9ABw/iH7BMS+Ean6CJ6ylcji/S9XEDitmBRBiC2dYuoC/knFA/yydD2sOMa4/HQJN7zyZBkVFRjXRvdACie4KTXFypv1EiBTqAOLdkznwiXzmbptSAYEt6q+ogpv2td3UFbuCDwda15bcsip+J6+vezxYLsVSlHNknXw6fidy1lGiWw68c2NgqBq2Qtdhn9A/87UTU13grCAhfYM8glizGz6LBEtcF82Ys/4qK3A8MZWEE0Xl/tfIFQO4wADhROyJd9Ubn4zav3ETLtvGl1ZaeIVZcCA9rMS3/qCmSZ9nunp7MtDIJR8HAl1gAS8PwdqV+LDkGz8zlQFfTX/RXX29yepoH+JU/mc0MZr73r3nguYcL+l3ae2RaBVFpVIqJ5/zlnMNlZCsDApJuArB2TzPY4oAKJNBENvnbsujxztr+OgX8x2Y9XfaZlYWpnK01PGxMUNBqJPnpSUQXea+mplMZffYASvZ31DYb8ZRnfY0c4BCvaAZKc1Y8cXONNGR71lj4zvC+5jf5ox/yYDM16GeSB8nCVpWlEh/aKT+WHndO2C5CEKZYUyKADATmgEK6+vpHx5yChzQzUqNDrsM4+Kg6w2p/+XCVp4CHp3dnXEV3Lymg20HAAc/Y+GdIe+sPr/f5q4oHQ/kXDHo62W2qi2bFAUO/BdW1/PV1lg2wrRqHdUmHYAZszclWAM3ljpioyRv8QyXsSExAxw74soaLWEiH9jbmm6cMPQLDZEQQnnYfNu2HBxsDC2rg7jPfXF9hzQchocINUFZKvzGQzLgYmKIqEMSw7Dfa/zJLMmwKJ7+WHDSaZX1gSZ3+F4inV7F8EWcx8mV2VZi86g+QdzrqNtYk8+SkQOUb/6epyoNw1eOCk9DP6WT+qMafMfMK/qjRUV9Qv7C7Si3Q8azEycxuuTgWN14zsWKy7I22HjdERnLyKULOnsTtKKFhj5VccCkCDsbOmCwSQyPtBAnYDbVeat8rCjEj8F6QKxEEvcF3DHKdDh9xsDliSntrRnT7kkbyvE24l9t57jIYa4pVhbSvn9LA/onQiAi2rg9zf0ygULBuweT0D6HPg4lAvWAvFB0wNHZd/RuJZF5yCRg8UF1I69X1JHVrWMLCTZ4IjidZUiSPIeAzPjk4lzyHBRTRsj91XOkEk1/KDyvbyirv7+kfVeoV+cBwnlcvimA4iRscYxFmTR+mkCzh+1HJ6wXQwmimj+kHlkFemP1zMAxAQxuaUl7ieDKGjsJ4luZZ6Mu03UTx86cLQgxtmc0vgrpuYGYVfp5TSoMtiFWuuSm+4lqTOE/CODGMuAGfWZ8+/ytHnprDHaxwQRD1fgFdZTV1KTQuhoX5H/JL+AmNI8gwJXgDtCoIboocQnlVBOcLPa3z4EQ3q2UdGAHMdzzHEMQ9zEZQ2ZBlDdVfyChUTCkHY9CAXSwpFcEVedKxqJ3vbZjvv6l4HQXdgL9Ad+LVTRvczNkm59Xg59RsnYrVOrbqi16oCe4CfmWK2LlTd8JGpideqcRiyn6DW6wYx7HDBMau7CPJ4WIJsjHGgzZ/plConJ6FsU1U4c3MGR04NVDEPgv4P3pEHWQBhJwhUXAG9PRpqdN3YUqWbm/H0lqZ+EzmZ3Uq9yndJTBAuMHO20AHmk68FRY+lYtNoMFidYGAuzFnkDypUYTEFCg8Oba4PL7sXTS2VxbK9Dcuo/6KvalkEw2nhPjea33wuD+tm7hfxJpkpQzijmh2tQs4ONhn3bKpXOAtS39F1j6KvA4OH6oHZOV+4+1XetvqSxvacsBFX3sv/NT5okBH2bi8QCz1mO9eLqEZ+8L8eEyKDerXAltibqhu4In2+6OaargN6YAOxjrd4B+jlbj55qMI1Ui0RGYMhXZsKgEqtl6E44ZtruKZG9EcADAJl/Ck0YeMIgNi/GNAH+PWO5rr0PM3bFNblOjPXJ1eHcyuEpRnwb5NUGNwwm0S4tM0fcuVv5yFMRcG55ESzR7dR65TACJM+hl2rIyPryDvzsXPIw+8WvaHd/ZU4pN0ZEm95xIkXDX+A947h5RM2Rd33Kgp1ysq5+NmaorZbz1t9a0bqRWTMeRwPRkAOmOiIcqTWrv8Md4WhCBMP0FCLOToY26I1Z7JiQ7PuZT8kQkrQZSQhnBAXg0Rvm16g/DGnN0YK2DnL6btCjPpMd6PMm63ZHNKi4gyKzx2Q+gkik0qyL2FNJWPH4aTA8RzDi37BQsgPIIW4pjXi63qSQbJ1jGHOKrrdLhhMz8+YgRl78wHaYeG4/uKc8oQ2l70wDObLq1B49vDe+DSNXOOQnPbXvM7stxCHWOyK6TxPunvUpcLH2CQzpRiLzRhuR4k3xobfuKWPYxmCwEkzAogBx8b/Xo0nq6eAO45FxhFRD0beX9AIdS+p9OjRL3KofnBAq1EsNalcU/8GOEHD7O2DajP34zQDx3GnAIu+RGqzLPm4IV43Y1UMPsOEvOw05oJa+Syj+Y5VJIQ6tuDER9T56P31ogK1iyC0tENQEsh8DWmt2i7KANPH5bTL98Vb1iPBLkL9A6doo8nbHDVUXRKdDB6i2zw0PGTctm/57G2Mb86pDP/B2pS8mq/tzOMYFV2bC2NwQibPKo0ECVAKXiA1fwIgUYB/fjzaMAjJCRYTc98jv/sqBraMyS9ZIUO45oSbdhuJvI9rPCDf3JIUQfq2A3HNfHp4LhwTk4luJEEq3lNskS1wh6MSO8Zz+M2MiucCga8pOtnnIO3T4OT4HN4wRv0lVrycWvVlEOuoox2/TFjZas3KZGJmrfksCOBCdHVoeFOpEmMnnYMFb8cMTne//0gHEFv+z6UNlAPZuV47AF3Aj98PsDSImv5X/OS//+aLTQPAzWTky3dGgKS0XQ1yq6y2EJ9yFh5IrJoNPZYutO3BBK410qeWaC9W+csPDhl4WXlTBJ2Nilhg1b33g+TdXO7qXVg04b4ZaNdHMHYQts3Zg4pwlJ+92DlRx92SubLjM3YzcxH1eroCzqEmHkzhK8vs2qCHspz8eJMrPPoI1gRSeZQNSOcR47TdlqvTSJPRUkC/7f/zppvKCn0TK6ll4bSTCP2Jahwn+nMRHdLUSliFCeLb9+kmibG5U9cVSZMcs/FWS7u/aA28SiA9vA89zYZXvgkn/0oO74Z0siABZD3mR1n/t53aq54eNtduLu0YCTT1DlRNkDjyTEZ23egNF5C4d1mD+NgdbHwXMkaHFYfjyY+4E4zdFqg8gYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2406,"cache_read_input_tokens":62788,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2406},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXoi2xdVD9p5Hw9PJgTG9","type":"assistant","uuid":"6ed45aae-5bf4-4d37-b92e-b7850f95f7f5","timestamp":"2026-02-04T21:05:27.391Z"}
{"parentUuid":"6ed45aae-5bf4-4d37-b92e-b7850f95f7f5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01MsmRCsvMRi4syjV3qMTSbZ","type":"message","role":"assistant","content":[{"type":"text","text":"Necesito aclarar el ajuste que quieres hacer. Actualmente el tag \"Resultados pendientes\" se muestra cuando:\n- La etapa es \"Prueba técnica\" Y no hay archivos\n\n¿Quieres que se muestre \"Resultados pendientes\" cuando:\n\n**Opción A:** El puntaje Y el puntaje_ia sean 0 o null (es decir, cuando NO hay puntuación)\n\n**Opción B:** El puntaje O el puntaje_ia sea diferente de 0 (es decir, cuando SÍ hay puntuación)\n\nLa Opción A tiene más sentido lógicamente (mostrar \"pendiente\" cuando no hay resultados), pero quiero confirmar cuál es tu intención."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2406,"cache_read_input_tokens":62788,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2406},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXoi2xdVD9p5Hw9PJgTG9","type":"assistant","uuid":"326521d7-f00b-48e5-8ae9-ecd2c460af92","timestamp":"2026-02-04T21:05:29.022Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-04T21:08:09.110Z","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac"}
{"type":"file-history-snapshot","messageId":"6396d454-11ee-4a7a-8feb-4a81e885a3c0","snapshot":{"messageId":"6396d454-11ee-4a7a-8feb-4a81e885a3c0","trackedFileBackups":{"app\\Models\\Vacantes\\EtapaVacanteUsuario.php":{"backupFileName":"8e9db565b73c39ad@v3","version":3,"backupTime":"2026-02-04T19:18:46.190Z"},"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-02-04T19:18:46.218Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v3","version":3,"backupTime":"2026-02-04T20:46:49.879Z"}},"timestamp":"2026-02-04T21:08:10.652Z"},"isSnapshotUpdate":false}
{"parentUuid":"326521d7-f00b-48e5-8ae9-ecd2c460af92","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"text","text":"haslo con la opcion A pero no semurestre ese tag si tien punytage o puntage ia o los dos"}]},"uuid":"6396d454-11ee-4a7a-8feb-4a81e885a3c0","timestamp":"2026-02-04T21:08:10.649Z","permissionMode":"default"}
{"parentUuid":"6396d454-11ee-4a7a-8feb-4a81e885a3c0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PrsTcUCTqyMVKyaPre7vLL","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto, ahora entiendo. El usuario quiere que \"Resultados pendientes\" se muestre SOLO cuando:\n- NO haya puntaje (puntaje es null o 0) Y\n- NO haya puntaje_ia (puntaje_ia es null o 0)\n\nEs decir, solo mostrar \"Resultados pendientes\" cuando no hay ningún tipo de puntuación registrada.\n\nEntonces necesito modificar la condición para que:\n- Si hay puntaje o puntaje_ia (cualquiera de los dos o ambos) → mostrar el puntaje correspondiente\n- Si NO hay ni puntaje ni puntaje_ia → mostrar \"Resultados pendientes\"\n\nVoy a reescribir la lógica del ternario para que sea más clara:\n\n```javascript\netapa.nombre_etapa === 'Documentos para contratación'\n    ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n    : (etapa.puntaje != null && etapa.puntaje !== 0) || (etapa.puntaje_ia != null && etapa.puntaje_ia !== 0)\n        ? (etapa.puntaje != null && etapa.puntaje !== 0\n            ? crearTag({ texto: `${etapa.puntaje}%`, class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje) })\n            : crearTag({ texto: `${etapa.puntaje_ia}%`, class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia) })\n        )\n        : crearTag({ texto: `Resultados pendientes`, class: 'bg-gray-80 text-gray-30' })\n\n\n```\n\nNecesito revisar la estructura completa del código para aplicar este cambio correctamente. La lógica debe ser: si es \"Documentos para contratación\" mostrar el tag azul, si hay puntaje mostrar ese valor, si no hay puntaje pero sí hay puntaje_ia mostrar ese, y si no hay ninguno de los dos mostrar \"Resultados pendientes\".","signature":"Eu0NCkYICxgCKkBKDT78X3cqfder7tZyqABsHkmRmIIXVJDI6PKgB/QzQsCSyHpuP7LdmM4TmOY2zLr5TH88HNTok1GZ7RX7FBQEEgx4j7zWVOOugYkP4LkaDGhDXuh2awa6zfBI2yIwu1GkCa0tp+rERZuwmr4F1eClDAu0xqIRwWei5p4+nocSU4olyCjy1v2QIdiNkoysKtQMneMc3nj8yv1JIZZ5VQC2b5Il+7uTQMdZ/J9A1Rw/lrOCzydD/h8VjhIC0c7jVPvaIi1j6X1SG9qcWtgiuw5zxvP6hN8D/RKuT6/rpofBGTSm+Fpcl6rKQkfsYpEVKtlye4VmzJot5XJPM8xoItf/mB2MH7F8U56J8sD+YYF1nZeP0czk5sP5xkXeG+utHn3kAjm6G14w5m+dNcj1hoIfW4jwxLUqNladcQ3ah2e7AESmkOPL/d8DZAYYh77CN5ulxuXl0paxQ+kNp2i+CS7gPNvw64J56NCAFWk6hJcu4lJqvO2aT21iSpJXew2OWOMK3df0KQY0EokWkaSgpe7Gd5f6RF4prcpGhIkUqv3O/iIP8adjWW4fVca/zDn6E4tnE1EKUff344M+CEXuDLRI97KnoOGVI0GoECFn4ilaa/AmwX+TN5eUd5s1eo07WcjX/TEkW+hYihbJw0z2oDdB00UIbr1dbrs9S4XZa4zt5Hpzoh6r4GYMB5PY/N/H4hzK8CoFAJB0SZBKPMPjBvTdXSlZGcycvsM/3tfl8wOCgSBoxDlyAGjp13rxUhg7GFscHaRV8gWZ4aJub6V7JeIgO1XpS43fsLWg8vJU4myo4QeWdfGpSPwwppFwVQOcCvAyzhOSvcjM4Dzjkf/U9V1ozqtuZncyDTVS64GObNuDYAkweQZWASpyWXUNILS22uLWZKKDrrliZbQSvE/SKeAGb/eG2o8vaYDpNS4mlNjRTt6AanaOLcyz/iBq5kCKmuXgQFMivmXg/hn0aNSrEc546wq+AR4gSh5NDvGovqu0qAv/U8ccMzIjgJqY9q5TSAjJ44w1WRjClHJLhjQHNLDEaMzF+una2a6gFb9lsNsjvFgeBORNev4saczzVdqKwykQFoRSoeGfsHW7PAAeKrKJG8EHmd+PLQIqS5fJCFus8XXd3Arye28nNKlTpvr/upXpGKsP9oIfCsrm97SsX0WISP4itJcfK0J6Z2TaeY9DckQRjLTJBgPCJUVFKt07CaHFUrzp7O0vA6DUPPZ/Hn/MaPLusfMPfdxwO96t564iK8JzfUWNvRaogWH1XPW7WJUVYG/locJYmRDear09EfX2tHO13dkMZZ9JgoP0CrCc7Wyz4qIk6zkK6VNw7oNgT58h+PWMeTOappB22dGDFXB4YulpToj/jjIa8tBK+a+r1sunJpjxoGMbsXSejKA379UfqurvivSxSrd3RWOjD91XcXeyyYkgLvtXlTrNJTSasK1K8N3QDaJAFCiIPsrN5b6f6bLKditeZ6NO0hiW7IZWvceOdxdclBJvlrFpMqKLvTucnSDyLHeV4zsPqUxWLxh2EXv4L68aBzOjz2tqK+A6yj6/tm88JUPQELC0RRzxCYS2fE12Ll/gzl/JBOMHJ2sGq5sC/z7VeZREttZnAOPdvNzFoeagG7njuUu+6V8TNlQM7fJU0unMgBUr0W1HmXRZ695NVK8bmErIVk1WeU6ShrZIY+0cYRatqgrvd2yeGVyn7LCBJ8zh6iPw8SKu63YHjM+oYvmGvhzDQcPVeE1bP0l7fZ13BE02Z6Z2CcB0K2AdnUNtpUwUgl4LFBJhSXfBt4ltMiGFR4KlYhJwppB5Dt7h85Du8wi2LTuhF/f1g4cIetnN9naBFtwoVaMvYrgz4KgVP/f5+7QV/vO1jPLp6rlsPF0bCOkjcOZfas/Z+MVBPxTArEttZCyl1CWEEV7uypfgiteI1lrdROoWbvjPMIWtft3qZeoIgilPc9Jd4VbT9S1g9u08syZA6i/wDZYhlQWU6GWcp+Kw6SfFmbgEvKq6fSYa8dUh/nhVET4DaGulewVnkvqiuHRUGnhFyYD4DvYuUW6mM4HdA0XoYpkF2eQIQ3yJ04wES5yx3QgAX5IA3IAeLxmWUYZs2T+j0jKsHMUZWuamTE/2lYxcfcZj4k/G24zf3djZGqVBAWKoHb2TbKacgW9EUkQuLdOk1YXsSCiNrefzIfTGJ7xarayqd4a0onEkKpdu5bnvYzrQ2dgTU+W9nES5oRkSvEjhC5T6qZv/W/5Sgc7bAo12fGnqXzzZBeON+Hj8lBslQaI4EMwMK835noBCMdfAg9REqLELlUcAaJjYgqDAjfvYATbcCPt8/IFulWM1hNkgQlow7AAej1+PGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1637,"cache_read_input_tokens":65194,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1637},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoiGHG2QSYqcPDHZkFBo","type":"assistant","uuid":"ee56f037-a1eb-40b9-811c-6ef11f4ab712","timestamp":"2026-02-04T21:08:23.769Z"}
{"parentUuid":"ee56f037-a1eb-40b9-811c-6ef11f4ab712","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PrsTcUCTqyMVKyaPre7vLL","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto, entiendo. Voy a modificar la lógica para que \"Resultados pendientes\" se muestre SOLO cuando no haya ni puntaje ni puntaje_ia. Si existe cualquiera de los dos, se mostrará el puntaje correspondiente."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1637,"cache_read_input_tokens":65194,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1637},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoiGHG2QSYqcPDHZkFBo","type":"assistant","uuid":"31bf0b3c-c38e-4943-89d6-00b417feacc9","timestamp":"2026-02-04T21:08:23.949Z"}
{"parentUuid":"31bf0b3c-c38e-4943-89d6-00b417feacc9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PrsTcUCTqyMVKyaPre7vLL","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019qY3JXgbHurpuQtYhh1zYn","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":827,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1637,"cache_read_input_tokens":65194,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1637},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoiGHG2QSYqcPDHZkFBo","type":"assistant","uuid":"87618915-b007-461c-b42c-54e2e3211ef9","timestamp":"2026-02-04T21:08:25.013Z"}
{"parentUuid":"87618915-b007-461c-b42c-54e2e3211ef9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019qY3JXgbHurpuQtYhh1zYn","type":"tool_result","content":"   827→                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n   828→                                    ${\n   829→                                    etapa.nombre_etapa === 'Documentos para contratación'\n   830→                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n   831→                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n   832→                                            ? crearTag({\n   833→                                                texto: `Resultados pendientes`,\n   834→                                                class: 'bg-gray-80 text-gray-30'\n   835→                                            })\n   836→                                            : (etapa.puntaje != null\n   837→                                                ? crearTag({\n   838→                                                    texto: `${etapa.puntaje}%`,\n   839→                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n   840→                                                })\n   841→                                                : (etapa.puntaje_ia != null\n   842→                                                    ? crearTag({\n   843→                                                        texto: `${etapa.puntaje_ia}%`,\n   844→                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n   845→                                                    })\n   846→                                                    : crearTag({\n   847→                                                        texto: `0%`,\n   848→                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n   849→                                                    })\n   850→                                                )\n   851→                                            )\n   852→                                        )\n   853→                                    }\n   854→                                </div>\n   855→                            </div>\n   856→                        </div>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"5cd9511b-b3b2-4398-8e6e-96929e7752cc","timestamp":"2026-02-04T21:08:26.526Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>","numLines":30,"startLine":827,"totalLines":2695}},"sourceToolAssistantUUID":"87618915-b007-461c-b42c-54e2e3211ef9"}
{"parentUuid":"5cd9511b-b3b2-4398-8e6e-96929e7752cc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01HkV8SmEcPmjugWjbfgF55o","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora voy a reescribir la lógica completa. La nueva lógica será:\n\n1. Si es \"Documentos para contratación\" → tag azul vacío\n2. Si hay puntaje (puntaje != null y puntaje > 0) → mostrar puntaje\n3. Si no hay puntaje pero hay puntaje_ia (puntaje_ia != null y puntaje_ia > 0) → mostrar puntaje_ia\n4. Si no hay ni puntaje ni puntaje_ia → mostrar \"Resultados pendientes\"\n\nVoy a eliminar la condición de \"Prueba técnica\" sin archivos y la opción de mostrar \"0%\" al final, porque ahora todo lo que no tenga puntaje mostrará \"Resultados pendientes\".","signature":"EtMFCkYICxgCKkDBU/iZKtOskhUqFwhjzuYskgn33c0S/f0pjpJ8u6G2BsjH8sYwl6MVyoF1srC7cmMuZ9TAyehEZ9pooIjy6q3iEgy7xlkH1f2WEXMc6y0aDJrWExG9QvHpPyjvsSIw/uikooPy9n0efv0YPy4tDxZv0P/Lc0nikaAiy2/qqxguiwkvymH2J5sZ57SF7yRWKroEDctO+iU2/aN87PdQccR01xewWqbXNI49dsyehadhA0yD8iLRkcnuPgeHcIOaUJGn85Q5CA5q+VHFkPaqTNp0yRsn1S9PJJXNcy8mKRFv1XQmZVkDPyQYc9GXg6xLv78ydon2L3XbmdgMRH6mmNaMlUGRitT3UBFIRkKzu7vJIgLL1dX8M6ZXn+vVqe1EL12xA99o5zeNEe4sbPAAMB47YIbxCOjvpb26c+fez93aa051mUZ6WMvgiYVY/KSnyy/mma1Qsrw0XWl3ebL6QtXJ7zOlrjHCva2x4rNTxWO9OXsWrXjTDDL2y4UFYgEMxRn2oWo3/xjk7GvfuDV4fJOTttgI4uPZR688uF45GWibfxRJZ7v6cOklmVVytAKGDkKdIWbSl1EJxbsYrPP/4JLPwZUagf1Bd5Wmxy1xTZ2enlsiQoC11p7U7eg8rEDnrUezNVD4k0OFNMirdsx/oMIM5W6NsMBSfW3plu3nSaI9Nkdq6GN5vtAMQ/K0qKasC3T959Y7l5ZjRCsTxFEQGYqzWWNY13d5ouFyd3lGJnOllXNzWJU3rZSnAo7Gy3B6pRLwQ7t30WOGv78OCSdI9hNl/4ZWYUQqG4xq27qJzuGvU7UJgRSylHlD04nrj9auKoujywfphV4RcwoQ2paJyh43YfixOj3ktMZTW9cBBSkN2N+38lhaV4Pj71ZUB2lgiBfM8WLBKbiAZ51YoY4vq/VMOm+fWyhHd1G7KNKy+Otz2WdklejY3lGonnpbGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1504,"cache_read_input_tokens":66831,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1504},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoiHTf8RXUEVWKr3qT4i","type":"assistant","uuid":"6fac10ab-ea68-40aa-8680-a39eb8a7cf1d","timestamp":"2026-02-04T21:08:33.141Z"}
{"parentUuid":"6fac10ab-ea68-40aa-8680-a39eb8a7cf1d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01HkV8SmEcPmjugWjbfgF55o","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AxDo4PLbUuCtLxfes3eGs6","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>","new_string":"                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.puntaje != null && etapa.puntaje > 0)\n                                            ? crearTag({\n                                                texto: `${etapa.puntaje}%`,\n                                                class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                            })\n                                            : (etapa.puntaje_ia != null && etapa.puntaje_ia > 0)\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje_ia}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                })\n                                                : crearTag({\n                                                    texto: `Resultados pendientes`,\n                                                    class: 'bg-gray-80 text-gray-30'\n                                                })\n                                    }\n                                </div>"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1504,"cache_read_input_tokens":66831,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1504},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoiHTf8RXUEVWKr3qT4i","type":"assistant","uuid":"1f71d05c-20ba-4dcf-a835-bc2d00f429d2","timestamp":"2026-02-04T21:08:40.247Z"}
{"parentUuid":"1f71d05c-20ba-4dcf-a835-bc2d00f429d2","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"The user doesn't want to proceed with this tool use. The tool use was rejected (eg. if it was a file edit, the new_string was NOT written to the file). STOP what you are doing and wait for the user to tell you how to proceed.","is_error":true,"tool_use_id":"toolu_01AxDo4PLbUuCtLxfes3eGs6"}]},"uuid":"e52f6a1b-5340-433b-adf8-f2e8f8de0042","timestamp":"2026-02-04T21:10:51.272Z","toolUseResult":"User rejected tool use","sourceToolAssistantUUID":"1f71d05c-20ba-4dcf-a835-bc2d00f429d2"}
{"parentUuid":"e52f6a1b-5340-433b-adf8-f2e8f8de0042","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"text","text":"[Request interrupted by user for tool use]"}]},"uuid":"bd6996c2-98f3-4f75-ac9e-f4268d29cc2c","timestamp":"2026-02-04T21:10:51.383Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-04T21:16:16.942Z","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac"}
{"type":"file-history-snapshot","messageId":"0b55558f-387a-4697-9dbb-923795e3658c","snapshot":{"messageId":"0b55558f-387a-4697-9dbb-923795e3658c","trackedFileBackups":{"app\\Models\\Vacantes\\EtapaVacanteUsuario.php":{"backupFileName":"8e9db565b73c39ad@v3","version":3,"backupTime":"2026-02-04T19:18:46.190Z"},"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-02-04T19:18:46.218Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v4","version":4,"backupTime":"2026-02-04T21:16:18.427Z"}},"timestamp":"2026-02-04T21:16:18.373Z"},"isSnapshotUpdate":false}
{"parentUuid":"bd6996c2-98f3-4f75-ac9e-f4268d29cc2c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_019qY3JXgbHurpuQtYhh1zYn","parentToolUseID":"toolu_019qY3JXgbHurpuQtYhh1zYn","uuid":"a39f5e4a-a9ee-4a96-9b16-5fa5c6ed156f","timestamp":"2026-02-04T21:08:25.221Z"}
{"parentUuid":"a39f5e4a-a9ee-4a96-9b16-5fa5c6ed156f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_019qY3JXgbHurpuQtYhh1zYn","toolUseID":"toolu_019qY3JXgbHurpuQtYhh1zYn","timestamp":"2026-02-04T21:08:26.527Z","uuid":"d338ce24-0e8d-4b77-918d-31c999a6dc8f"}
{"parentUuid":"d338ce24-0e8d-4b77-918d-31c999a6dc8f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01AxDo4PLbUuCtLxfes3eGs6","parentToolUseID":"toolu_01AxDo4PLbUuCtLxfes3eGs6","uuid":"0ada1262-0154-40cf-a5ad-6052af7b2865","timestamp":"2026-02-04T21:08:40.438Z"}
{"parentUuid":"0ada1262-0154-40cf-a5ad-6052af7b2865","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01AxDo4PLbUuCtLxfes3eGs6","parentToolUseID":"toolu_01AxDo4PLbUuCtLxfes3eGs6","uuid":"2bb4ff32-e224-4ff8-88f2-71be8cfa3228","timestamp":"2026-02-04T21:08:40.439Z"}
{"parentUuid":"2bb4ff32-e224-4ff8-88f2-71be8cfa3228","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 797 to 797 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\n            console.log(etapas);\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"no espera lo cambio  se bostrayra ese tag cuand fecha_ejecucion se igual a null y eso llega dentro de etapa"}]},"uuid":"0b55558f-387a-4697-9dbb-923795e3658c","timestamp":"2026-02-04T21:16:18.362Z","permissionMode":"default"}
{"parentUuid":"0b55558f-387a-4697-9dbb-923795e3658c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Cp58VS4utdwAVorHKoFct1","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ah, entiendo mejor ahora. El usuario quiere que el tag \"Resultados pendientes\" se muestre cuando `etapa.fecha_ejecucion` sea `null`. Esto tiene más sentido porque si no hay fecha de ejecución, significa que la etapa aún no se ha completado/ejecutado.\n\nEntonces la lógica debería ser:\n1. Si es \"Documentos para contratación\" → tag azul vacío\n2. Si `fecha_ejecucion` es null → mostrar \"Resultados pendientes\"\n3. Si hay puntaje → mostrar puntaje\n4. Si hay puntaje_ia → mostrar puntaje_ia\n5. Si no hay ninguno pero sí hay fecha_ejecucion → mostrar 0%\n\nO tal vez:\n1. Si es \"Documentos para contratación\" → tag azul vacío\n2. Si `fecha_ejecucion` es null → mostrar \"Resultados pendientes\"\n3. Si hay fecha_ejecucion:\n   - Si hay puntaje → mostrar puntaje\n   - Si hay puntaje_ia → mostrar puntaje_ia\n   - Si no hay ninguno → mostrar 0%\n\nDéjame confirmar primero qué datos vienen en `etapa` agregando un console.log temporal.","signature":"EtoICkYICxgCKkDx2JYcWuysMDh1JVRmK9U9zhqnNGbk/DrzPutsXMZsRZY3FbjZOyiL5+z9AJtS2ginyMWyQggKKIBOuyXiXpM5EgxFT/1nJg317mMEtzoaDCuk1/eXDSkyIHYC1SIwzEPVcYo3y7DLNR9e8vh0Mhbc3P+Y7qus9li8YihN1ak1So0Zd2MQ0nIrWNeLT6EPKsEHO+rC/ePBtOu4V55lTMtJhl6szsKDpkdKHZTSbkKTFdx9Z61g8UKry85Gr61bO4dZEynjTAW1NFel6/AenZTfm2lx9E+YAg+BH2dvr1vBhFp4gBs2BMTUUKkVje1hF9JIdpYp/nYNwRNKdDOB5SB8gXz9xUCA+StiyYlNf77W6Z4OBcYsT1q2TOX6cL3nUmOW22gtZ/uiB4YWQF3Jk3KvnjMgioc0oi+YxBkxFvQ0R5lVxfazENF82O4OyAHcdFOyh6LTzWPISJeBkveI/RxF4AXyelORZ8U0lu/EmJkyWWq4WLTGTClQK1jTaNaTBRlGdtiMy1vvMRYREQMp11N/4+5twtTDVCxWrBMQsNZC6q3sXRThX2kugb5JDyPuBFLk98Dt+VOrk08EhYoZox5wfBsxf+yKnvTVxPOjA3seIj2O2ql3etstX/QzxTBFFAMQpEG65Y3i+g3dj8fODa7QyJzZhZrQL5nHZeg5ikpsNoE2fGzolnBCe/uhvfNuAYWBZKCLnBi63GzhOLs2hI6G30OgJrGTs7g3la/GuYQi+ThR7AtM4sVKy+hP/59kYCh8OiQ6tICV+hkzgj64F+B+iXnE68qTpZ7PcOV7TWgR1k1n+EIL0/sHoZJ8R1kEJXIDtiJ2sfvx6UjcvoD+P+zeVrROaQGGttAapfil/ER7klpDp4ZTWd7dWsFB4hGTqBb8uhWST5OotEQzpzumU+amXf5aNJeUjetXHd5afYpN61Zo1oVnTwLkNi+aXHRj4hhR+P4ijJJIt9/FhGqNAg+pJvzC0m5d+KhzIU1xIS72mi3xfH9PrHtLyA17xhlYcZ0kLN4xDF4Xbd8bw5IC3xzJJkie2WDy2fE5RA0W0Leh+v0oco9c7vcTY8p5jznWfW4P7rjyZ20PS355m1Hl4K8C+GeauURZCHtrSMlvwmF4yth2bLw41JYMfoZvDNCg2EtiCLmhePLaCXlcquS+mDICByNCRgx6FodsFamGuxdpGiiIGK+rRK8Xf3UP4lq3iAt5QR7lRs1G2KUx1JZL0iPNMnKrbjzk2eVklR2QGL7cWH7vHzSBof5vl6KB1trW8P2nwkSuVuTuOYc5kGJM9Dsj20s9yqtrDh0vCNBZ7pGUZjqmllNx6laO5KEwngkT4Dg8tkFgsOKPL+dBt55B7MbvRdCW44+8WgZ1Ma4+xzgy3ehcLrnsr8NHx6VHEA4c5752rQtvM3ws+pYyF20CBNxakH93vnCz3OlKa1aVic2ad8SkB4Owl4FeAFRQYei/KuNjPhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1867,"cache_read_input_tokens":68335,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1867},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXoitG8KMQsz4hjfxNmBz","type":"assistant","uuid":"13251ac0-5490-4a18-b911-11e3fbe328c2","timestamp":"2026-02-04T21:16:29.312Z"}
{"parentUuid":"13251ac0-5490-4a18-b911-11e3fbe328c2","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Cp58VS4utdwAVorHKoFct1","type":"message","role":"assistant","content":[{"type":"text","text":"Entendido! Entonces el tag \"Resultados pendientes\" se debe mostrar cuando `etapa.fecha_ejecucion` sea `null`. Déjame actualizar la lógica:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1867,"cache_read_input_tokens":68335,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1867},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXoitG8KMQsz4hjfxNmBz","type":"assistant","uuid":"5184e1bc-eef8-4c97-9d60-d04ced7391fd","timestamp":"2026-02-04T21:16:30.118Z"}
{"parentUuid":"5184e1bc-eef8-4c97-9d60-d04ced7391fd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Cp58VS4utdwAVorHKoFct1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014V8wLF7DR54WdSLhMMathn","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>","new_string":"                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : etapa.fecha_ejecucion === null\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                    }\n                                </div>"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1867,"cache_read_input_tokens":68335,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1867},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXoitG8KMQsz4hjfxNmBz","type":"assistant","uuid":"2816dad8-691c-42f8-9e17-cbf3c9a1d906","timestamp":"2026-02-04T21:16:40.037Z"}
{"parentUuid":"2816dad8-691c-42f8-9e17-cbf3c9a1d906","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has not been read yet. Read it first before writing to it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_014V8wLF7DR54WdSLhMMathn"}]},"uuid":"f6dd7be7-e187-4bf2-b60a-994ae29e4021","timestamp":"2026-02-04T21:16:40.306Z","toolUseResult":"Error: File has not been read yet. Read it first before writing to it.","sourceToolAssistantUUID":"2816dad8-691c-42f8-9e17-cbf3c9a1d906"}
{"parentUuid":"f6dd7be7-e187-4bf2-b60a-994ae29e4021","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0145MtW4mYQ65FD2wGfmXU14","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Necesito leer el archivo primero antes de editarlo.","signature":"EtsBCkYICxgCKkA+55ABi5YAUdM2VAHfIiR2B7p6LURg4xg1uIWkEY3eG47nVywLz+xUsascCmbpSSSQoZO2hfp1N2lB4hCbYVQzEgzES34DqlN7Qjh6EjMaDA67FQsSOOf9/XG+uiIwyaT1C8Bntj1NGUuQKxy7osLp/A9AEyCXbdnNAuOh8fdjcX4bM2zQCCzZZeDTHBjWKkMvvVj6JCMU386tUuuAdXRoSTi5diLRJd4B1aYNggWvJWuu1uZMEHJyBdSsKJ+CMwHj5RbiF14L2kE+6kfYh2DTVhU6GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1414,"cache_read_input_tokens":70202,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1414},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoiusZ4gmT5UXxuep1wu","type":"assistant","uuid":"82c73c81-0cc7-4af5-9dbd-6fd7a9c5b5a7","timestamp":"2026-02-04T21:16:43.632Z"}
{"parentUuid":"82c73c81-0cc7-4af5-9dbd-6fd7a9c5b5a7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0145MtW4mYQ65FD2wGfmXU14","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0143v7ZnGewGFjY67FDAMLw5","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":827,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1414,"cache_read_input_tokens":70202,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1414},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoiusZ4gmT5UXxuep1wu","type":"assistant","uuid":"7a17e4d0-e984-4ae9-a02a-aeea87fa9cfc","timestamp":"2026-02-04T21:16:44.699Z"}
{"parentUuid":"7a17e4d0-e984-4ae9-a02a-aeea87fa9cfc","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0143v7ZnGewGFjY67FDAMLw5","type":"tool_result","content":"   827→                                `}\n   828→                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n   829→                                    ${\n   830→                                    etapa.nombre_etapa === 'Documentos para contratación'\n   831→                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n   832→                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n   833→                                            ? crearTag({\n   834→                                                texto: `Resultados pendientes`,\n   835→                                                class: 'bg-gray-80 text-gray-30'\n   836→                                            })\n   837→                                            : (etapa.puntaje != null\n   838→                                                ? crearTag({\n   839→                                                    texto: `${etapa.puntaje}%`,\n   840→                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n   841→                                                })\n   842→                                                : (etapa.puntaje_ia != null\n   843→                                                    ? crearTag({\n   844→                                                        texto: `${etapa.puntaje_ia}%`,\n   845→                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n   846→                                                    })\n   847→                                                    : crearTag({\n   848→                                                        texto: `0%`,\n   849→                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n   850→                                                    })\n   851→                                                )\n   852→                                            )\n   853→                                        )\n   854→                                    }\n   855→                                </div>\n   856→                            </div>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f8bee508-5cf0-4eb1-825c-5e88d7222b96","timestamp":"2026-02-04T21:16:47.091Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>","numLines":30,"startLine":827,"totalLines":2696}},"sourceToolAssistantUUID":"7a17e4d0-e984-4ae9-a02a-aeea87fa9cfc"}
{"parentUuid":"f8bee508-5cf0-4eb1-825c-5e88d7222b96","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01THCkWvssmPQjCEPNWuovjY","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora puedo hacer la edición. Voy a cambiar la condición de \"Prueba técnica sin archivos\" por \"fecha_ejecucion === null\".","signature":"EqUCCkYICxgCKkBSLt6Pw91F1UPksKdI8UMiqkj35Nh+0hNorG012RmP76fqxbfnrj4n8goVJQ+dgH1lVxClN9WF8Foq3NrAkJTBEgwADprbQYc2R8NLC3gaDHkgKmfeL6kkm1MQzSIwECW64w+2RxuH6W/fzVd4Qz12jg6wMZ9bJZr67L+DJwsjNFI/f6NsLUpZ1AskYZpdKowBdHIYwlYimO0dZseTKSNUmvZLhDg3vrzsMVQb155+qIhqSkmb0O8Ofe/P4yBIDl5V6GYcxkLHh/FLdjKxNSDRykhTlfPNn/Excrif3RG9PjnrOookUaO3xAf5wQSgpjBVqtTSjjb5eFWNyHePzz0Gy6p4aDuglykF4uVoJNEJzwUTqtsvchIOJfMAdXcYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":779,"cache_read_input_tokens":71616,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":779},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXoivMcGyd92AW2xTUbor","type":"assistant","uuid":"ede67c25-4af4-4b2b-8a18-7c39a7d9ac68","timestamp":"2026-02-04T21:16:54.273Z"}
{"parentUuid":"ede67c25-4af4-4b2b-8a18-7c39a7d9ac68","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01THCkWvssmPQjCEPNWuovjY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011MEabMThk8FKXs8gEKYZ7a","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>","new_string":"                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : etapa.fecha_ejecucion === null\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                    }\n                                </div>"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":779,"cache_read_input_tokens":71616,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":779},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CXoivMcGyd92AW2xTUbor","type":"assistant","uuid":"9e5a84a0-1615-4e00-bc5c-ea06a7e281ef","timestamp":"2026-02-04T21:17:01.703Z"}
{"parentUuid":"9e5a84a0-1615-4e00-bc5c-ea06a7e281ef","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011MEabMThk8FKXs8gEKYZ7a","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated successfully."}]},"uuid":"6c46710f-fbd3-4818-80d1-ecc396f4be1e","timestamp":"2026-02-04T21:17:14.738Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>","newString":"                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : etapa.fecha_ejecucion === null\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                    }\n                                </div>","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(input_id, filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: null,\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n\n    if (aplicante.adecuacion !== null) {\n        if (adecuacion <= ADECUACION_CALIFICACION_BAJA) {\n            borde_color = 'borde-indice-talento-rojo';\n            etiqueta_estilo = 'badge-indice-talento-rojo';\n        } else if (adecuacion <= ADECUACION_CALIFICACION_ALTA) {\n            borde_color = 'borde-indice-talento-amarillo';\n            etiqueta_estilo = 'badge-indice-talento-amarillo';\n        } else {\n            borde_color = 'borde-indice-talento-verde';\n            etiqueta_estilo = 'badge-indice-talento-verde';\n        }\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').removeClass('d-none');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').removeClass('d-none');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            console.log(etapas);\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                        )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Ver hoja de vida\" data-bs-placement=\"bottom\"'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\" data-bs-toggle=\"tooltip\" data-bs-title=\"Mover de etapa\" data-bs-placement=\"bottom\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Descartar candidato\" data-bs-placement=\"bottom\"',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || '',\n                                        disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n * @author Andres Gonzalez\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Reprocesar agenda?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                    Esta acción volverá a procesar los resultados de la agenda.\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.close();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Solo reprocesar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-tonal-primary w-100 justify-content-center',\n                        texto: 'Reprocesar y enviar correo',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @param {object} etapa Objeto de la etapa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction crearPregunta(pregunta, etapa) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta, etapa)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @param {object} etapa Objeto de la etapa.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction crearRespuesta(pregunta, etapa) {\n    let etapa_actual = detalle_usuario?.etapa_actual?.etapa?.nombre === etapa.nombre_etapa;\n\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            }),\n                                            disabled: !etapa_actual\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            }),\n                                            disabled: !etapa_actual\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta, etapa);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                                disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n\n            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];\n            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    $('#contenedor-archivos-contratacion').closest('.accordion-body').empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":829,"oldLines":7,"newStart":829,"newLines":7,"lines":["                                     ${","                                     etapa.nombre_etapa === 'Documentos para contratación'","                                         ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })","-                                        : (etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0","+                                        : etapa.fecha_ejecucion === null","                                             ? crearTag({","                                                 texto: `Resultados pendientes`,","                                                 class: 'bg-gray-80 text-gray-30'"]},{"oldStart":850,"oldLines":7,"newStart":850,"newLines":6,"lines":["                                                     })","                                                 )","                                             )","-                                        )","                                     }","                                 </div>","                             </div>"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"9e5a84a0-1615-4e00-bc5c-ea06a7e281ef"}
{"parentUuid":"6c46710f-fbd3-4818-80d1-ecc396f4be1e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01DJXtjWucgUyhp9tv2EtGTj","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto. He cambiado la lógica para que el tag \"Resultados pendientes\" se muestre cuando `etapa.fecha_ejecucion === null`. Esto es más lógico porque:\n\n1. Si la fecha de ejecución es null, significa que la etapa no se ha completado aún\n2. No depende de si es \"Prueba técnica\" o si tiene archivos\n3. Es una condición más general y aplicable a cualquier tipo de etapa\n\nLa nueva lógica es:\n1. Si es \"Documentos para contratación\" → tag azul vacío\n2. Si fecha_ejecucion es null → \"Resultados pendientes\"\n3. Si hay puntaje → mostrar puntaje\n4. Si hay puntaje_ia → mostrar puntaje_ia\n5. Si no hay ninguno → mostrar 0%","signature":"Ep8GCkYICxgCKkDMwOoRTku3OKDNIgqAEzdf5hzPuZJm2xwdwuPEcx3RDIRM2wrslcTVI0LFsd+fKQ8xQPhuGA+lsXXBRtXCEAOiEgzMhOeHbacqcujbZuwaDI48lxC1gjiqSvc2YCIw6Lb+N6KlVlqP0+4Um98zc+ZqOU5WLGvxgyrgorFcCpUYv5jq/mAjX78HYLE6+1TtKoYFyEu6CkrI6Jgu768hDqd7usfFtBHbrCvRJTHVN6vfvFlT9RVlHZbreiXxsGKs6/pebu/F4Dr/BuR+SwBYE3vkuIM8v5zGrfPohk508pK6KqUAJlxCn6tQb9d/RyGMwXwHZYgpeDK6llUz3JxIUfOAgJcID+UxEDwPE+y6rAGAbkGFcZGlkBfCGK7wQM7pvmYkt26T4MvgR9E/Jrz4XUtJknj5GVBJPq8vDTwOMqSKtGSq7C02/lw6BOtzeYKNfD5hvyH1F5fj9OcK9dfGMOcfwYojQ1uv6ybiSmPbHSU+vPgLaWztrF5WPYvlLMmmw0uI0pz40v0/ZFA4+0qmuBY6Nv20rD4JxfFBTf8KvIErB3zBzocz5TjNfow1ZR4CmNv4QdONQkMF6nZQzG+I2lJBpoUEkfYdsPPJjPvyWOj2zCcNRcIUAIyZIVzV396+e4k9CjQb4KsJ0+FIO7K3wTHMQHPFVaZHnz194UzYHOhLeIXBRbdA5iizXyVLP5rlKYCzivp1cZfMPeit86emuEev4rqLSktufDkP/MmMMscvI73WLWwW4gezvOazzOG+ukx36fpTKBS5IliIn5l+/hyEWtAZX3TXCFNGd1DUBiwdOdOgmpCgDpdX1Lyp6EZKEhV3vqfykGIECmFhGXVgUjTo3jGWmQwJK+Qv8zTNj5GFsYBAn03yFDN/Xz/IstMAtlWeB2d8utpXFOr/T6RXxhT3cV84dF05D7SBsNA3Zh4mLPoSeB9siPPqzQzxlmKmnIFK50deR7XWpPoD/eOd/nACpgdoH8f1XyOoGyQ/a2JKpVyzYe3PLsCkvPzZVGXUOye1e+/n+exj0jVnt3/BVMmIoowHzucmsBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1093,"cache_read_input_tokens":72395,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1093},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoixXLE949naQDfvKMYm","type":"assistant","uuid":"382743ab-0f82-4cd2-9cf0-6a81aaff754e","timestamp":"2026-02-04T21:17:23.398Z"}
{"parentUuid":"382743ab-0f82-4cd2-9cf0-6a81aaff754e","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01DJXtjWucgUyhp9tv2EtGTj","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto! He actualizado la lógica en [detalle-resultados.js:828-855](public/js/vacantes/detalles/detalle-resultados.js#L828-L855). Ahora el tag \"Resultados pendientes\" se mostrará cuando `etapa.fecha_ejecucion` sea `null`, independientemente del tipo de etapa.\n\n**Nueva lógica:**\n1. Si es \"Documentos para contratación\" → tag azul con cantidad de adjuntos\n2. Si `fecha_ejecucion === null` → \"Resultados pendientes\" (gris)\n3. Si hay `puntaje` → muestra el puntaje con su color correspondiente\n4. Si hay `puntaje_ia` → muestra el puntaje IA con su color\n5. Si no hay ninguno → muestra 0%\n\nEsto es más preciso porque la fecha de ejecución indica si la etapa se ha completado o no, aplicable a cualquier tipo de etapa."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1093,"cache_read_input_tokens":72395,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1093},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoixXLE949naQDfvKMYm","type":"assistant","uuid":"15770b39-829b-439f-92ac-6cecfcc91ac4","timestamp":"2026-02-04T21:17:27.291Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-04T22:44:37.976Z","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac"}
{"type":"file-history-snapshot","messageId":"2537d7be-a79f-4f2b-86fd-73565a94b370","snapshot":{"messageId":"2537d7be-a79f-4f2b-86fd-73565a94b370","trackedFileBackups":{"app\\Models\\Vacantes\\EtapaVacanteUsuario.php":{"backupFileName":"8e9db565b73c39ad@v3","version":3,"backupTime":"2026-02-04T19:18:46.190Z"},"app\\Http\\Services\\Vacantes\\EtapaVacanteUsuarioService.php":{"backupFileName":"5419cff174eb966b@v2","version":2,"backupTime":"2026-02-04T19:18:46.218Z"},"public\\js\\vacantes\\detalles\\detalle-resultados.js":{"backupFileName":"e365c76da77883ea@v5","version":5,"backupTime":"2026-02-04T22:44:39.846Z"}},"timestamp":"2026-02-04T22:44:39.812Z"},"isSnapshotUpdate":false}
{"parentUuid":"15770b39-829b-439f-92ac-6cecfcc91ac4","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_0143v7ZnGewGFjY67FDAMLw5","parentToolUseID":"toolu_0143v7ZnGewGFjY67FDAMLw5","uuid":"5c64a5e9-784c-432a-bd40-d9d27863d12b","timestamp":"2026-02-04T21:16:44.960Z"}
{"parentUuid":"5c64a5e9-784c-432a-bd40-d9d27863d12b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_0143v7ZnGewGFjY67FDAMLw5","toolUseID":"toolu_0143v7ZnGewGFjY67FDAMLw5","timestamp":"2026-02-04T21:16:47.096Z","uuid":"eab3224b-2661-4fa9-b919-f105d26cdc65"}
{"parentUuid":"eab3224b-2661-4fa9-b919-f105d26cdc65","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_011MEabMThk8FKXs8gEKYZ7a","parentToolUseID":"toolu_011MEabMThk8FKXs8gEKYZ7a","uuid":"8f685825-2359-49f9-85cc-4f1a1b225512","timestamp":"2026-02-04T21:17:01.938Z"}
{"parentUuid":"8f685825-2359-49f9-85cc-4f1a1b225512","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_011MEabMThk8FKXs8gEKYZ7a","parentToolUseID":"toolu_011MEabMThk8FKXs8gEKYZ7a","uuid":"5e78d08d-c772-4883-9605-1010122f0e99","timestamp":"2026-02-04T21:17:01.939Z"}
{"parentUuid":"5e78d08d-c772-4883-9605-1010122f0e99","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_011MEabMThk8FKXs8gEKYZ7a","toolUseID":"toolu_011MEabMThk8FKXs8gEKYZ7a","timestamp":"2026-02-04T21:17:14.739Z","uuid":"c577e445-0aa2-4a75-96c7-bf6fab824bb7"}
{"parentUuid":"c577e445-0aa2-4a75-96c7-bf6fab824bb7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_011MEabMThk8FKXs8gEKYZ7a","toolUseID":"toolu_011MEabMThk8FKXs8gEKYZ7a","timestamp":"2026-02-04T21:17:14.739Z","uuid":"69f6c30a-876b-4487-b09a-e2222e859fda"}
{"parentUuid":"69f6c30a-876b-4487-b09a-e2222e859fda","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 832 to 832 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js:\netapa.etapa_completada == false\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"loajute etapa.etapa_completada == false pero valida si esxiste ese parameto por que si no existe tambien me puietre ese tag"}]},"uuid":"2537d7be-a79f-4f2b-86fd-73565a94b370","timestamp":"2026-02-04T22:44:39.766Z","permissionMode":"default"}
{"parentUuid":"2537d7be-a79f-4f2b-86fd-73565a94b370","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Csxvq7Qb8Ca2Taex44aBS7","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere cambiar la condición de `etapa.fecha_ejecucion === null` a `etapa.etapa_completada == false`, pero también quiere validar si ese parámetro existe. Si no existe, también debe mostrar el tag \"Resultados pendientes\".\n\nEntonces la lógica debería ser:\n- Si `etapa.etapa_completada` existe y es `false` → mostrar \"Resultados pendientes\"\n- Si `etapa.etapa_completada` no existe (undefined/null) → también mostrar \"Resultados pendientes\"\n- Si `etapa.etapa_completada` es `true` → mostrar puntajes\n\nEn JavaScript, puedo hacer esto de varias formas:\n1. `etapa.etapa_completada !== true` - esto cubrirá false, undefined, null\n2. `!etapa.etapa_completada` - esto también funciona pero podría ser menos explícito\n3. `etapa.etapa_completada == false || etapa.etapa_completada === undefined || etapa.etapa_completada === null`\n\nLa opción más limpia sería `etapa.etapa_completada !== true` porque:\n- Si es `false` → muestra \"Resultados pendientes\"\n- Si es `undefined` → muestra \"Resultados pendientes\"\n- Si es `null` → muestra \"Resultados pendientes\"\n- Si es `true` → no muestra \"Resultados pendientes\"\n\nVoy a usar esa opción.","signature":"EqgKCkYICxgCKkDr443Z0y+aG8rWQJDNM5axPUB2CIFUGX1f8lPDK6rN7dWAkDkl+Ur0pxknUDndtehscNqzAGdnDJcXwtsa4hwlEgzsiZkk2ZHn1oF/4rgaDE9R7qaNAKoBBkhFBiIw4lLLtIp1IkNOPqs7/AbapRWd+Wi2jNn97hGZT6m78a0DasPrBinFdhVQ7rrgH6gfKo8Jbonm9PGEAWyB/3Ch+A2iseGF16ov/t13PwqXowjqshEQlW5FDrM0sQchLgXbX3WkU51AtRXYIcv7mnFsp6jOK1hTRBDwidn88BXcRSfQytAdMGI7Rf4lygvPBQMqmY1AIDIwLQqxOaHYXA/q6t7fnI97zRkz7IxNF38qpYUlqwdndF7UtseC01gsAxyYyno0+t6mOW2mcGTVzR8b1vQVN0n5sBYS5P+5w37MSXXVmPhXT/WRGw3RvMxTP4HoVaeP9c+x9rUp760rosAFTTXNVeAwJpI8/DMPoK6GIZ3HRMhqOYYLK9sNNo5YjG9+1j5nCFOoNXFfSxHTVpHndhZk7nPcm/AszT6IoF3T6j/cerHZBMa9Pk/KYt7ngOGajnaKD1lIx1HkEcEMHoz+L3xdsL1cEvcLIgpRDM7QtjyuGfnpwAzoO/85ATkvG2dpn6kVAcy5YYgv73c9AkntU4KpIbEl5gdFhQjFRBCBWWH5oBmULFt/UmjL9dC6tort/ShVmdHiXSas9a9ikLOoKCqlGcbxZjaRojQfDSyKc1WfZgzlvAxzP+o0ZPAb0ZgxiNI9sjRI8xDfMrMoSTDbiw8o1U1SXwQhaLlGJT/gHjuXcqke/RY/p2SiJkhW0md9JDXRbf//9WWv1seL/ymSY68lHmWwTBZA6E0Bi6gUnR3sMdBo2D4vGO1BMRdPR9Jk5D6jzl1rfK4njVFiLwWLdFIVYjJEVqHFBFc84O3PuqTLfvJTof4r6RvFE3WVR/B/aKFS8hzOH4d1hXSk1Hsjt7LXk0hzYwTRbAAq4XWliKv/AwDznX07IW89Aaty1fbGq3vbqf9yzvjXAdHcBiv1XDCLdYZ9r6GGopA5+cwgpwi7ZNzx2h400+aS6XK+MUZ8Mxns8CEwsjYyNA74keDFDekWv4PHe31Ns/2hTVDtYwx7kUnRENIrEfJ+aex6nRcK2k7cipokI+qNjqCJ9RfIjw6/aNkKCTfjer3TT8oh3E1eT6T0Q+uyl9k3CFLiyAExdkHUDF2k8+QMMtKQ7GXuaDRLCdOwIlVkvO6xe/X5r4Dc4U2xXrJhoUxQWsGwcDWo/LPj19YQ0ZipA8jX5StPrBqpGM8eVUbmFO/DFNF9glqEt4AyVoJ2K4RvkV/eGE2nn4MyMbUHJF+6HmiuTa5DKZDTFLEqXlEAFhEwVWdOKYcL4XvbiT0SnATldKp/EqPxQcafw4wcDjmnCGF0+/6ACAWS3TwIrVJRdgLzjW1czkIokzN3GMR77ua+wPC2Zmx/QkvoDlSIFDl0TAdWvya0oE2++dJgpaNWLCKUkElQeTn7ZQ2A1RLP7r/3OuINeJQQeC9Fr5RfNJO+hHVIOhJAd2+m9b4a7HkzoM+D57Uzh4c2IRMLpDsd0pPkgrIqEcl+Jy/x9xovlC4OXhgWEufs0LUEPdVHHmUrW8LOm6e/MJ8IJsSsf8GHeJW/YCBRAIxO4wD1KAy3pvunGbVsAhleypMHc+lnvYy0RHoI0hNrH9G9ClCIOvJWIb9uR+MBtaJLpeMqDeQ1waFVa/tf09PQLA/3GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":74600,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":74600},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXoqd4PH42hooNBQJzX8c","type":"assistant","uuid":"56b84b68-ed9c-4ebc-b0c4-65e0837844e0","timestamp":"2026-02-04T22:44:50.455Z"}
{"parentUuid":"56b84b68-ed9c-4ebc-b0c4-65e0837844e0","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Csxvq7Qb8Ca2Taex44aBS7","type":"message","role":"assistant","content":[{"type":"text","text":"Perfecto, voy a cambiar la condición a `etapa.etapa_completada` y validar si existe. Si no existe o es `false`, mostrará el tag \"Resultados pendientes\"."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":74600,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":74600},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXoqd4PH42hooNBQJzX8c","type":"assistant","uuid":"bb362756-8c20-4ecd-bb8d-9d7f9c76aa3c","timestamp":"2026-02-04T22:44:51.568Z"}
{"parentUuid":"bb362756-8c20-4ecd-bb8d-9d7f9c76aa3c","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Csxvq7Qb8Ca2Taex44aBS7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019Q5xgv2hRGUFD6W6TSZCvB","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","offset":828,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":74600,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":74600},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXoqd4PH42hooNBQJzX8c","type":"assistant","uuid":"8ea65226-6645-4a65-a6d8-5ace2569bba8","timestamp":"2026-02-04T22:44:52.490Z"}
{"parentUuid":"8ea65226-6645-4a65-a6d8-5ace2569bba8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019Q5xgv2hRGUFD6W6TSZCvB","type":"tool_result","content":"   828→                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n   829→                                    ${\n   830→                                    etapa.nombre_etapa === 'Documentos para contratación'\n   831→                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n   832→                                        : etapa.etapa_completada == false\n   833→                                            ? crearTag({\n   834→                                                texto: `Resultados pendientes`,\n   835→                                                class: 'bg-gray-80 text-gray-30'\n   836→                                            })\n   837→                                            : (etapa.puntaje != null\n   838→                                                ? crearTag({\n   839→                                                    texto: `${etapa.puntaje}%`,\n   840→                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n   841→                                                })\n   842→                                                : (etapa.puntaje_ia != null\n   843→                                                    ? crearTag({\n   844→                                                        texto: `${etapa.puntaje_ia}%`,\n   845→                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n   846→                                                    })\n   847→                                                    : crearTag({\n   848→                                                        texto: `0%`,\n   849→                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n   850→                                                    })\n   851→                                                )\n   852→                                            )\n   853→                                    }\n   854→                                </div>\n   855→                            </div>\n   856→                        </div>\n   857→                    `\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f148374d-2c09-49b0-a880-64e4b1934c4a","timestamp":"2026-02-04T22:44:53.923Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","content":"                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : etapa.etapa_completada == false\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `","numLines":30,"startLine":828,"totalLines":2695}},"sourceToolAssistantUUID":"8ea65226-6645-4a65-a6d8-5ace2569bba8"}
{"parentUuid":"f148374d-2c09-49b0-a880-64e4b1934c4a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013ZAX4tGshYzUB3LpYdbwno","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Veo que ya está usando `etapa.etapa_completada == false`. Ahora necesito cambiarlo para que también valide si el parámetro existe. Voy a usar `etapa.etapa_completada !== true` que cubrirá los casos de `false`, `undefined`, y `null`.","signature":"EpUDCkYICxgCKkBw+1pSVo3OpKti896vdJRoCZXNxOy/j4KG+rS4gSvqP0Wh//L9TqVop4spQakYVwdbhGfL/EdbGSNrDmQakCC2EgxPBvu439Xx9lFKBngaDHcWYFa8XrO+ayMBuyIw8nnt0lK+Ko4P8pgk1UeX6/V2k8BTOalEe8rMfEi5Dj0E2lGq6jg6nLFD+qPdvr+VKvwB1SSTchicIhGlyHN9T6Px2dxgxI2aAZyPYiaJJmivZyCvQs6Vod/7y9YHAYsw7M0KKP4mrUWxtO1k6/Sm9iZjisuP9wX4bkes0t5kxRPtaPD5JxaXK4S2M3KQbK5jEMML2VV7zTTvUyD8iYzLQP/i7p2B6K1TMYI8MyL9IY0qAStazQj9ttlcggq+A/28mGHVjVrONqcdKac5Ou6+HWqWceOBZ2NKF4gd30KwdYAWxKTq9AnWDi7DEmZPRujKizpnl8dHpUDS2lddeKpVH/KkRYVQnXovdr2vulC7mEwyfxa84YIKKKDKnPyyS/KW6Hyx3oeHN284q/X1P9XPGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1159,"cache_read_input_tokens":74600,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1159},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXoqe5FPd3oDEJthtsPf1","type":"assistant","uuid":"1d4f79d8-130b-44a6-8d05-6b002dad54b2","timestamp":"2026-02-04T22:44:58.476Z"}
{"parentUuid":"1d4f79d8-130b-44a6-8d05-6b002dad54b2","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013ZAX4tGshYzUB3LpYdbwno","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01USqSgZ2HFiyWnseoWEBc7u","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","old_string":"                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : etapa.etapa_completada == false\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })","new_string":"                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : etapa.etapa_completada !== true\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1159,"cache_read_input_tokens":74600,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1159},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXoqe5FPd3oDEJthtsPf1","type":"assistant","uuid":"e7761a84-b9e4-4e7c-9536-dcc7d5f17cb6","timestamp":"2026-02-04T22:45:01.284Z"}
{"parentUuid":"e7761a84-b9e4-4e7c-9536-dcc7d5f17cb6","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01USqSgZ2HFiyWnseoWEBc7u","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js has been updated successfully."}]},"uuid":"582d0483-9d4f-4aa0-aed3-ade872e8ca7a","timestamp":"2026-02-04T22:45:05.597Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\vacantes\\detalles\\detalle-resultados.js","oldString":"                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : etapa.etapa_completada == false\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })","newString":"                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : etapa.etapa_completada !== true\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })","originalFile":"let usuario_detalle_id = null;\nlet detalle_usuario = null;\nvar nombre_tabla_resultados = 'tabla-resultados-candidatos';\nwindow[nombre_tabla_resultados + '_ids'] = [];\nwindow[nombre_tabla_resultados + '_seleccionados'] = [];\nwindow[nombre_tabla_resultados + '_filtros'] = [];\nvar respuesta_ia_candidatos_recomendados = null;\nconst CAJAS_IDS = [\n    '#verificar-uno',\n    '#verificar-dos',\n    '#verificar-tres',\n    '#verificar-cuatro',\n    '#verificar-cinco',\n    '#verificar-seis',\n    '#verificar-siete'\n];\nconst CONFIGURACION_TABLAS = {\n    autoWidth: false,\n    responsive: true,\n    processing: false,\n    serverSide: false,\n    searching: true,\n    deferRender: true,\n    paging: true,\n    aaSorting: [],\n    language: lenguaje_componente_datatables,\n    lengthMenu: [\n        [5, 10, 25, 50, 100, 200],\n        [5, 10, 25, 50, 100, 200]\n    ],\n    pageLength: 5,\n    scrollX: true,\n    scrollY: 'calc(100vh)',\n    scrollCollapse: true\n};\nlet usuarios_comparados_ia = [];\nlet clonar_usuario_id = null;\n\n/**\n * Aplicar filtros específicos para la tabla de resultados y etapas.\n * Sobrescribe la función de detalle-etapas.js para manejar ambas tablas.\n *\n * @param {string} input_id ID del filtro dropdown.\n * @param {Object} filtros Objeto con filtros seleccionados.\n * @returns {void}\n * @author Andres Gonzalez\n */\n(function() {\n    const APLICAR_FILTROS_ETAPAS = window.aplicarFiltrosDropdown;\n\n    // Sobrescribir con función que maneja ambas tablas\n    window.aplicarFiltrosDropdown = function(input_id, filtros) {\n        // Si el filtro pertenece a la tabla de resultados\n        if (input_id === `filtro_${nombre_tabla_resultados}`) {\n            window[nombre_tabla_resultados + '_filtros'] = filtros;\n            actualizarDatatables(nombre_tabla_resultados);\n        } else if (typeof APLICAR_FILTROS_ETAPAS === 'function') {\n            APLICAR_FILTROS_ETAPAS(input_id, filtros);\n        }\n    };\n})();\n\n$(document).ready(function() {\n    moment.locale('es');\n    $(document).on('click', '#resultados-pestana', function() {\n        if ($.fn.DataTable.isDataTable(`#${nombre_tabla_resultados}`)) {\n            actualizarDatatables(nombre_tabla_resultados);\n        }\n    });\n\n    $('.checkbox-container').on('click mousedown', function(evento) {\n        evento.stopPropagation();\n    });\n\n    $('#btn-abrir-archivos').on('click', function(evento_click) {\n        evento_click.preventDefault();\n        $('#input-archivos').trigger('click');\n    });\n\n    $(document).on('click', '#btn-comparativo-basico', function() {\n        comparativoBasico();\n    });\n\n    $(document).on('click', '#btn-identificar-mejores', function() {\n        identificarMejoresCandidatos();\n    });\n\n    /**\n     * Actualizar el texto del botón de exportar según las etapas seleccionadas.\n     * Si hay etapas marcadas muestra \"Exportar selección\", de lo contrario \"Exportar todo\".\n     *\n     * @returns {void}\n     * @author Andrés Morales\n     */\n    function actualizarTextoBotonExportar() {\n        const ETAPAS_MARCADAS = CAJAS_IDS.filter(id => $(id).is(':checked')).length;\n        const BOTON = $('#btn-exportar-resultados');\n\n        if (ETAPAS_MARCADAS > 0) {\n            BOTON.html(' Exportar selección');\n        } else {\n            BOTON.html(' Exportar todo');\n        }\n    }\n\n    CAJAS_IDS.forEach(id => {\n        $(id).on('change', actualizarTextoBotonExportar);\n    });\n\n    $(document).on('change', `#filtro_mas_recientes_${nombre_tabla_resultados}`, function() {\n        actualizarDatatables(nombre_tabla_resultados);\n    });\n\n    $(document).on('click', '.copiar-elemento',function () {\n        let texto = $(this).data('texto');\n        navigator.clipboard.writeText(texto).then(function() {\n            mostrarToast('success', 'Información copiada al portapapeles');\n        }).catch(function(error) {\n            mostrarToast('danger', 'Error al copiar en el portapapeles.');\n        });\n        if ($(this).data('direccion')) {\n            window.open($(this).data('direccion'), '_blank');\n        }\n    });\n});\n\n$(`#${nombre_tabla_resultados}`).DataTable({\n    ...CONFIGURACION_TABLAS,\n    scrollY: false,\n    ajax: {\n        url: `/vacantes-listado-aplicantes/${VACANTE_ID}`,\n        data: function(datos) {\n            datos.mas_adecuados = $(`#filtro_mas_recientes_${nombre_tabla_resultados}`).val();\n\n            if (window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`]) {\n                datos.nivel_adecuacion = window[nombre_tabla_resultados + '_filtros'][`nivel_adecuacion_filtro_${nombre_tabla_resultados}`];\n            }\n        },\n        dataSrc: function(json) {\n            return json.data.aplicantes || [];\n        }\n    },\n    columns: [\n        {\n            data: null,\n            class: null,\n            orderable: false,\n            render: (dato) => {\n                return crearCardCandidatoResultados(dato);\n            }\n        }\n    ],\n    drawCallback: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    },\n    initComplete: function() {\n        window[nombre_tabla_resultados + '_ids'] = $(`#${nombre_tabla_resultados}`).DataTable().data().toArray();\n        $(`[aria-describedby=\"${nombre_tabla_resultados}_info\"] .thead-componente`).hide();\n        if ($(`.componentes-botones-adicionales-${nombre_tabla_resultados}`).length === 0) {\n            $(`.row.justify-content-end.tabla-componente-${nombre_tabla_resultados}`).append(renderizarBotonesAcciones(nombre_tabla_resultados));\n        }\n        cargarDataTablas();\n        inicializarTooltips();\n        validarSeleccionados(nombre_tabla_resultados);\n    }\n});\n\n/**\n * Crear card de candidato con etapas y puntajes.\n *\n * @param {Object} aplicante Datos del aplicante con usuario y etapas.\n * @returns {string} HTML de la card del candidato.\n * @author Andrés Morales\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction crearCardCandidatoResultados(aplicante) {\n    var usuario = aplicante.usuario;\n    var etapas = aplicante.etapas;\n\n    var adecuacion = aplicante.adecuacion;\n    var borde_color = '';\n    var etiqueta_estilo = '';\n\n    if (aplicante.adecuacion !== null) {\n        if (adecuacion <= ADECUACION_CALIFICACION_BAJA) {\n            borde_color = 'borde-indice-talento-rojo';\n            etiqueta_estilo = 'badge-indice-talento-rojo';\n        } else if (adecuacion <= ADECUACION_CALIFICACION_ALTA) {\n            borde_color = 'borde-indice-talento-amarillo';\n            etiqueta_estilo = 'badge-indice-talento-amarillo';\n        } else {\n            borde_color = 'borde-indice-talento-verde';\n            etiqueta_estilo = 'badge-indice-talento-verde';\n        }\n    }\n\n    let etapas_html = etapas\n        .filter(etapa => etapa.nombre_etapa !== 'Contratados' && etapa.nombre_etapa !== 'Descartados')\n        .map(etapa => {\n            let puntaje_final = etapa.puntaje !== null ? etapa.puntaje : etapa.puntaje_ia;\n\n            let clase_etiqueta = 'bg-secondary-subtle';\n            if (puntaje_final !== null) {\n                if (puntaje_final >= 75) {\n                    clase_etiqueta = 'tag-tonal-green';\n                } else if (puntaje_final >= 50) {\n                    clase_etiqueta = 'tag-tonal-yellow';\n                } else {\n                    clase_etiqueta = 'tag-tonal-red';\n                }\n            }\n\n            var texto_puntaje = puntaje_final !== null\n                ? `${puntaje_final}%`\n                : (etapa.nombre_etapa === 'Documentos para contratación' ? 'Pendiente' : 'N/A');\n\n            if (etapa.nombre_etapa == 'Documentos para contratación') {\n                texto_puntaje = `${etapa?.archivos_solicitados?.archivos_guardados.length || 0} de ${etapa?.archivos_solicitados?.documentos.length || 0} Adjuntos`;\n                clase_etiqueta = 'bg-info-subtle';\n            }\n\n            return `\n                <div class=\"col text-center d-flex flex-column\">\n                    <small class=\"text-gray-30 text-label-2 fw-semibold mb-2\">${etapa.nombre_etapa}</small>\n                    ${crearTag({\n                        class: `${clase_etiqueta} fw-semibold`,\n                        texto: texto_puntaje\n                    })}\n                </div>\n            `;\n        }).join('');\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-body\">\n                <div class=\"d-flex align-items-center\">\n                    <div class=\"me-3\">\n                        ${crearCheckbox({\n                            id: `checkbox-candidato-${usuario.id}`,\n                            name: 'checkbox_candidatos_resultados',\n                            value: usuario.id,\n                            class: 'checkbox-tabla-componente',\n                            checked: window[nombre_tabla_resultados + '_seleccionados'].some(item => item.usuario.id == usuario.id),\n                            onchange: `seleccionarElemento(${usuario.id}, this.checked, '${nombre_tabla_resultados}');`\n                        })}\n                    </div>\n                    <div class=\"position-relative me-3\">\n                        <img src=\"/usuarios-imagen/${usuario.id}\" class=\"rounded-circle pointer ${borde_color}\" width=\"60\" height=\"60\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                        ${(adecuacion !== null) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                    </div>\n                    <div>\n                        <h5 class=\"mb-1 fw-semibold\">\n                            <label class=\"text-headline-4 text-gray-10 cursor-pointer\" onclick=\"verDetalleCandidato(${usuario.id})\">\n                                ${usuario.nombres} ${usuario.apellidos}\n                            </label>\n                        </h5>\n                        <div class=\"d-flex flex-wrap gap-5 text-label-2 text-gray-30\">\n                            <span><i class=\"text-body-2 bi bi-envelope me-2\"></i> ${usuario.email || 'N/A'}</span>\n                            <span><i class=\"text-body-2 bi bi-telephone me-2\"></i> ${usuario.telefono || 'N/A'}</span>\n                        </div>\n                    </div>\n                    <div class=\"ms-auto\">\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle me-2',\n                            texto: '<i class=\"bi bi-person-plus\"></i>',\n                            onclick: `modalAsignarCandidatoOtraVacante(${usuario.id})`\n                        })}\n                        ${crearBoton({\n                            clases: 'btn-outline-primary btn-circle',\n                            texto: '<i class=\"bi bi-file-earmark-person\"></i>',\n                        })}\n                    </div>\n                </div>\n                <hr>\n                <div class=\"d-flex flex-wrap gap-3\">\n                    ${etapas_html}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Renderizar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {string} HTML con los botones de acciones.\n * @author Andrés Morales\n */\nfunction renderizarBotonesAcciones(nombre_tabla) {\n    return `\n        <div class=\"col-12 componentes-botones-adicionales-${nombre_tabla}\">\n            <div class=\"row\">\n                <div class=\"col-auto me-5 px-3\">\n                    ${crearCheckbox({\n                        id: `checkbox-seleccionar-todos-${nombre_tabla}`,\n                        onchange: `seleccionarTodos(this.checked, '${nombre_tabla}');`,\n                        label: `<span id=\"${nombre_tabla}-seleccionados-total\">Seleccionado: 0</span>`,\n                    })}\n                </div>\n                <div class=\"col-auto px-1\">\n                    ${crearBoton({\n                        id: `boton-descartar_${nombre_tabla}`,\n                        clases: 'btn-outline-danger',\n                        texto: '<i class=\"bi bi-person-fill-x text-body-1 me-2\"></i> Descartar',\n                        disabled: true,\n                        onclick: `descartarCandidatos(null, '${nombre_tabla}')`\n                    })}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Seleccionar o deseleccionar todos los candidatos.\n *\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nasync function seleccionarTodos(comprobado, nombre_tabla) {\n    window[nombre_tabla + '_seleccionados'] = [];\n    if (comprobado) {\n        for (var i = 0; i < window[nombre_tabla + '_ids'].length; i++) {\n            window[nombre_tabla + '_seleccionados'].push(window[nombre_tabla + '_ids'][i]);\n        }\n    }\n    actualizarDatatables(nombre_tabla);\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Seleccionar o deseleccionar un candidato.\n *\n * @param {number} entrante_id ID del aplicante seleccionado.\n * @param {boolean} comprobado Chequear o deschequear.\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction seleccionarElemento(entrante_id, comprobado, nombre_tabla) {\n    if (comprobado) {\n        if (!window[nombre_tabla + '_seleccionados'].some(item => item.usuario.id == entrante_id)) {\n            var objeto = window[nombre_tabla + '_ids'].find(item => item.usuario.id == entrante_id);\n            if (objeto) {\n                window[nombre_tabla + '_seleccionados'].push(objeto);\n            }\n        }\n    } else {\n        window[nombre_tabla + '_seleccionados'] = window[nombre_tabla + '_seleccionados'].filter(item => item.usuario.id != entrante_id);\n    }\n    validarSeleccionados(nombre_tabla);\n}\n\n/**\n * Validar candidatos seleccionados y actualizar UI.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction validarSeleccionados(nombre_tabla) {\n    if (window[nombre_tabla + '_seleccionados'].length == 0) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar todo`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', false);\n    } else if (window[nombre_tabla + '_seleccionados'].length == window[nombre_tabla + '_ids'].length) {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', false);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('checked', true);\n    } else {\n        $(`#btn-exportar-${nombre_tabla}`).html(`<img class=\"me-3\" src=\"/iconos/excel_icon.svg\"> Exportar seleccionado`);\n        $(`#checkbox-seleccionar-todos-${nombre_tabla}`).prop('indeterminate', true);\n    }\n    habilitarBotonesAcciones(nombre_tabla);\n    $(`#${nombre_tabla}-seleccionados-total`).text('Seleccionado: ' + window[nombre_tabla + '_seleccionados'].length);\n}\n\n/**\n * Habilitar o deshabilitar botones de acciones masivas.\n *\n * @param {string} nombre_tabla Nombre de la tabla.\n * @returns {void}\n * @author Andrés Morales\n */\nfunction habilitarBotonesAcciones(nombre_tabla) {\n    var habilitado = window[nombre_tabla + '_seleccionados'].length > 0;\n\n    $(`#boton-descartar_${nombre_tabla}`).prop('disabled', !habilitado);\n\n    actualizarEstadoBotonesComparacion();\n}\n\n/**\n * Actualizar estado de botones de comparación según candidatos seleccionados.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction actualizarEstadoBotonesComparacion() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n    var cantidad_seleccionados = candidatos_seleccionados.length;\n    var boton_comparativo = $('#btn-comparativo-basico');\n\n    if (cantidad_seleccionados >= 2) {\n        boton_comparativo.prop('disabled', false).removeClass('disabled');\n    } else {\n        boton_comparativo.prop('disabled', true).addClass('disabled');\n    }\n}\n\n/**\n * Generar comparativo básico de candidatos seleccionados.\n * Envía una petición POST al servidor con los IDs de los candidatos seleccionados\n * y la vacante actual para obtener el reporte PDF comparativo.\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction comparativoBasico() {\n    var candidatos_seleccionados = window[nombre_tabla_resultados + '_seleccionados'] || [];\n\n    if (candidatos_seleccionados.length < 2) {\n        mostrarAlerta('warning', 'Debe seleccionar al menos 2 candidatos para realizar el comparativo');\n        return;\n    }\n\n    // Extraer los IDs de usuario de los candidatos seleccionados\n    var usuarios_ids = candidatos_seleccionados.map(item => item.usuario.id);\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-comparativo-basico-aplicantes';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar usuarios_ids (array)\n    usuarios_ids.forEach(function(usuario_id) {\n        var usuario_input = document.createElement('input');\n        usuario_input.type = 'hidden';\n        usuario_input.name = 'usuarios_ids[]';\n        usuario_input.value = usuario_id;\n        formulario.appendChild(usuario_input);\n    });\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    // Mostrar mensaje de éxito\n    mostrarToast('success', 'Generando reporte comparativo...');\n}\n\n/**\n * Función para identificar los mejores candidatos utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction identificarMejoresCandidatos() {\n    usuarios_comparados_ia = [];\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    if (usuarios_ids.length > 1) {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/obtener-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                usuarios_ids: usuarios_ids\n            },\n            type: 'GET',\n            success: function (respuesta) {\n                $('#respuesta-candidatos-ia').empty();\n                usuarios_comparados_ia = JSON.stringify(respuesta.data.recomendados);\n                $.each(respuesta.data.recomendados, function(indice, aplicante) {\n                    var borde_color = '';\n                    var etiqueta_estilo = '';\n                    var adecuacion = aplicante.adecuacion ?? 0;\n                    if (adecuacion >= 10 && adecuacion <= 40) {\n                        borde_color = 'borde-indice-talento-rojo';\n                        etiqueta_estilo = 'badge-indice-talento-rojo';\n                    } else if (adecuacion >= 41 && adecuacion <= 70) {\n                        borde_color = 'borde-indice-talento-amarillo';\n                        etiqueta_estilo = 'badge-indice-talento-amarillo';\n                    } else if (adecuacion >= 71 && adecuacion <= 100) {\n                        borde_color = 'borde-indice-talento-verde';\n                        etiqueta_estilo = 'badge-indice-talento-verde';\n                    }\n                    $('#respuesta-candidatos-ia').append(`\n                        <div class=\"card mb-4 p-4\">\n                            <div class=\"row\">\n                                <div class=\"col mb-4 align-items-center\">\n                                    <div class=\"row\">\n                                        <div class=\"col-auto position-relative\">\n                                            <img src=\"/usuarios-imagen/${aplicante.id}\" class=\"rounded-circle ${borde_color}\" width=\"60\" height=\"60\">\n                                            ${(adecuacion !== null && adecuacion > 0) ? `<span class=\"candidato-badge text-label-1 badge ${etiqueta_estilo} position-absolute\">${adecuacion}%</span>` : ''}\n                                        </div>\n                                        <div class=\"col\">\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Nombre:</div>\n                                                <div class=\"col ps-0 text-body-2\">${aplicante.nombre_completo || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Teléfono:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.telefono || ''}</div>\n                                            </div>\n                                            <div class=\"row\">\n                                                <div class=\"col-auto pe-1 text-gray-10 text-body-2\">Correo:</div>\n                                                <div class=\"col ps-0 text-body-2 text-cta-blue\">${aplicante.email || ''}</div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearTag({\n                                        texto: `${aplicante.puesto}° Puesto`,\n                                        class: (aplicante.puesto == '1' ? 'tag-tonal-green' : 'tag-tonal-yellow')\n                                    })}\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-12 text-body-3\">${aplicante.analisis}</div>\n                                <div class=\"col-12 mt-4\">\n                                    ${crearAcordeon({\n                                        id: 'acordeon',\n                                        acordeon: [{\n                                            id: `acordeon-${aplicante.id}`,\n                                            titulo: `Ver más`,\n                                            contenido: `\n                                                <div class=\"col-12\">\n                                                    <ul class=\"ps-4\">\n                                                        ${aplicante.experiencia ? `\n                                                            <li class=\"mb-4\">\n                                                                💼 Experiencia: ${aplicante.experiencia}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.salario ? `\n                                                            <li class=\"mb-4\">\n                                                                💰 Expectativa salarial: ${aplicante.salario}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.ubicacion ? `\n                                                            <li class=\"mb-4\">\n                                                                📍 Ubicación: ${aplicante.ubicacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.formacion ? `\n                                                            <li class=\"mb-4\">\n                                                                🎓 Formación: ${aplicante.formacion}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.pruebas_psicometricas ? `\n                                                            <li class=\"mb-4\">\n                                                                🧠 Pruebas psicométricas: ${aplicante.pruebas_psicometricas}\n                                                            </li>\n                                                        ` : ''}\n                                                        ${aplicante.prueba_tecnica ? `\n                                                            <li class=\"mb-4\">\n                                                                💻 Prueba técnica: ${aplicante.prueba_tecnica}\n                                                            </li>\n                                                        ` : ''}\n                                                    </ul>\n                                                </div>\n                                            `\n                                        }]\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    `);\n                });\n                $('#respuesta-candidatos-ia').append(`\n                    <div class=\"row align-items-center mt-3\">\n                        <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                            Preguntas\n                        </div>\n                        <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4 d-none\" id=\"comentarios-ia\">0</div>\n                    </div>\n                    <div class=\"rounded-4 mt-4 pt-6 pb-1 px-4 bg-gray-90 d-none\" id=\"contenedor-comentarios-comparacion-ia\"></div>\n                    <div class=\"col-12 mt-4 mb-8\">\n                        <div class=\"row\">\n                            <div class=\"col px-0\">\n                                ${crearEditorTexto({\n                                    id: 'comentario_comparacion',\n                                    name: 'comentario_comparacion',\n                                    input_container_class: 'mb-0',\n                                    class: 'classic-editor-opciones',\n                                    disabled: false,\n                                    required: false,\n                                    label: '',\n                                })}\n                            </div>\n                            <div class=\"col-auto d-flex align-items-end\">\n                                ${crearBoton({\n                                    clases: `btn-primary btn-circle`,\n                                    texto: '<i class=\"bi bi-send-fill\"></i>',\n                                    onclick: `preguntaCandidatoRecomendadosIA()`\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                `);\n                inicializarClassicEditor();\n                // Guardar respuesta completa en variable global\n                respuesta_ia_candidatos_recomendados = {\n                    respuesta_ia: respuesta.data,\n                    vacante_id: VACANTE_ID,\n                    fecha_generacion: new Date().toISOString()\n                };\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').modal('show');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Función para realizar una pregunta sobre los candidatos recomendados utilizando IA.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction preguntaCandidatoRecomendadosIA() {\n    let seleccionados_ia = window[nombre_tabla_resultados + '_seleccionados'];\n    let usuarios_ids = [];\n    $.each(seleccionados_ia, function(indice, candidato) {\n        usuarios_ids.push(candidato.usuario.id);\n    });\n    let pregunta = obtenerDatosClassicEditor('comentario_comparacion');\n    if (usuarios_ids.length > 1 && pregunta.trim() != '') {\n        $('#titulo-generando-ia').text(`Generando ${usuarios_ids.length} candidatos...`);\n        $('#modal-generando-ia').modal('show');\n        $.ajax({\n            url: `/preguntar-candidatos-recomendados`,\n            data: {\n                _token: $('input[name=\"_token\"]').val(),\n                vacante_id: VACANTE_ID,\n                candidatos: usuarios_comparados_ia,\n                pregunta: pregunta\n            },\n            type: 'POST',\n            success: function (respuesta) {\n                let respuesta_comentario = respuesta.data.respuesta;\n                $('#contenedor-comentarios-comparacion-ia').append(`\n                    <div class=\"row mb-5 comentario-ia\">\n                        <div class=\"col-auto\">\n                            <img src=\"/usuarios-imagen/${USUARIO.id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n                        </div>\n                        <div class=\"col ps-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">${USUARIO.nombre_completo}</div>\n                                    <div class=\"col-12 text-body-3\">${pregunta}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row mb-5\">\n                        <div class=\"col pe-0\">\n                            <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                                <div class=\"row\">\n                                    <div class=\"col-12 text-label-2 text-gray-10\">IA</div>\n                                    <div class=\"col-12 text-body-3 pb-2\">${respuesta_comentario}</div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-auto\">\n                            <img src=\"/iconos/icono_ia.svg\" class=\"rounded-circle bg-state-yellow border p-1\" width=\"50\" height=\"50\">\n                        </div>\n                    </div>\n                `);\n                let comentarios_ia = $('#contenedor-comentarios-comparacion-ia').children('.comentario-ia').length;\n                $('#comentarios-ia').removeClass('d-none').text(comentarios_ia);\n                $('#contenedor-comentarios-comparacion-ia').removeClass('d-none');\n                establecerDatosClassicEditor('comentario_comparacion', '');\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-respuesta-candidatos-ia').removeClass('d-none');\n            },\n            error: function (error) {\n                mostrarToast('danger', 'Error al generar datos con IA.');\n                $('#modal-respuesta-candidatos-ia').removeClass('d-none');\n            }\n        });\n    } else {\n        mostrarToast('danger', 'Seleccione al menos 2 candidatos para comparar con la IA.');\n    }\n}\n\n/**\n * Descargar reporte PDF con respuesta de IA sobre candidatos recomendados.\n * Abre el PDF en una nueva ventana (similar a comparativoBasico).\n *\n * @returns {void}\n * @author Andrés Morales\n */\nfunction descargarRespuestaCandidatosIA() {\n    // Validar que existe la respuesta de IA\n    if (!respuesta_ia_candidatos_recomendados || !respuesta_ia_candidatos_recomendados.respuesta_ia) {\n        mostrarToast('warning', 'No hay una respuesta de IA disponible para descargar.');\n        return;\n    }\n\n    // Validar que existe la vacante\n    if (!VACANTE_ID) {\n        mostrarToast('danger', 'Error: No se pudo identificar la vacante.');\n        return;\n    }\n\n    // Crear formulario para enviar POST y abrir PDF en nueva ventana\n    var formulario = document.createElement('form');\n    formulario.method = 'POST';\n    formulario.action = '/vacantes-descargar-reporte-respuesta-ia';\n    formulario.target = '_blank';\n\n    // Agregar token CSRF\n    var csrf_input = document.createElement('input');\n    csrf_input.type = 'hidden';\n    csrf_input.name = '_token';\n    csrf_input.value = $('meta[name=\"csrf-token\"]').attr('content');\n    formulario.appendChild(csrf_input);\n\n    // Agregar vacante_id\n    var vacante_input = document.createElement('input');\n    vacante_input.type = 'hidden';\n    vacante_input.name = 'vacante_id';\n    vacante_input.value = VACANTE_ID;\n    formulario.appendChild(vacante_input);\n\n    // Agregar respuesta_ia como JSON string\n    var respuesta_input = document.createElement('input');\n    respuesta_input.type = 'hidden';\n    respuesta_input.name = 'respuesta_ia';\n    respuesta_input.value = JSON.stringify(respuesta_ia_candidatos_recomendados.respuesta_ia);\n    formulario.appendChild(respuesta_input);\n\n    // Agregar formulario al body y enviarlo\n    document.body.appendChild(formulario);\n    formulario.submit();\n    document.body.removeChild(formulario);\n\n    mostrarToast('success', 'Generando reporte de candidatos con IA...');\n}\n\n/**\n * Ver detalle completo de un candidato con sus etapas y resultados.\n * Muestra un modal con información detallada del candidato y un acordeón de etapas.\n *\n * @param {number} usuario_id ID del usuario candidato.\n * @param {string|null} etapa_expandir Nombre de la etapa a expandir automáticamente.\n * @returns {void}\n * @author Jair Carvajal\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction verDetalleCandidato(usuario_id, etapa_expandir = null) {\n    usuario_detalle_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_id}`,\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            detalle_usuario = respuesta.data;\n            let etapas = respuesta.data.etapas;\n            console.log(etapas);\n            mostrarCardDetalleCandidato(respuesta.data);\n            $('#acordeon-etapas-candidato').empty().append(crearAcordeon({\n                id: 'acordeon',\n                acordeon: etapas.map((etapa, indice) => ({\n                    id: `etapa-${indice}`,\n                    titulo: `${etapa.nombre_etapa}`,\n                    contenido: mostrarResultadoEtapa(etapa),\n                    adicional: `data-etapa_vacante_id=\"${etapa.id}\" data-nombre_etapa=\"${etapa.nombre_etapa}\"`,\n                    seleccionar: true,\n                    acordeon_header_class: 'py-6',\n                    opciones_izquierda: `\n                        <div class=\"col-auto ps-2 position-absolute z-3\">\n                            ${crearCheckbox({\n                                id: 'checkbox',\n                                name: 'checkbox',\n                                class: 'checkbox-etapa',\n                                required: true,\n                                disabled: false,\n                                onchange: `seleccionarCheckboxEtapa();`\n                            })}\n                        </div>\n                    `,\n                    opciones_derecha: `\n                        <div class=\"col-auto end-0 me-10 ps-2 position-absolute z-3\">\n                            <div class=\"row align-items-center\">\n                                ${etapa.nombre_etapa === 'Prueba técnica' && (etapa?.archivos?.archivos || []).length === 0 ? '' : `\n                                <div class=\"col-auto pe-0\">\n                                    ${crearBoton({clases: 'btn-outline-primary btn-circle', texto: '<i class=\"bi bi-download\"></i>' })}\n                                </div>\n                                `}\n                                <div class=\"col-auto px-4\" ${etapa.nombre_etapa === 'Documentos para contratación' ? `id=\"contenedor-cantidad-adjuntos\"` : ''}>\n                                    ${\n                                    etapa.nombre_etapa === 'Documentos para contratación'\n                                        ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })\n                                        : etapa.etapa_completada == false\n                                            ? crearTag({\n                                                texto: `Resultados pendientes`,\n                                                class: 'bg-gray-80 text-gray-30'\n                                            })\n                                            : (etapa.puntaje != null\n                                                ? crearTag({\n                                                    texto: `${etapa.puntaje}%`,\n                                                    class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje)\n                                                })\n                                                : (etapa.puntaje_ia != null\n                                                    ? crearTag({\n                                                        texto: `${etapa.puntaje_ia}%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(etapa.puntaje_ia)\n                                                    })\n                                                    : crearTag({\n                                                        texto: `0%`,\n                                                        class: obtenerClaseEtiquetaSegunPuntajeObtenido(0)\n                                                    })\n                                                )\n                                            )\n                                    }\n                                </div>\n                            </div>\n                        </div>\n                    `\n                }))\n            }));\n            $('#btn-abrir-archivos').on('click', function (evento_click) {\n                evento_click.preventDefault();\n                $('#input-archivos').trigger('click');\n            });\n            $('#modal-detalle-resultados').modal('show');\n            inicializarTooltips();\n            mostrarPuntajeTotalPrefiltro();\n            inicializarClassicEditor();\n            $('.tooltip').remove();\n            setTimeout(ajustarAlturaListaVideos, 100);\n\n            // Expandir automáticamente la etapa indicada\n            if (etapa_expandir) {\n                setTimeout(function() {\n                    expandirEtapaPorNombre(etapa_expandir);\n                }, 30);\n            }\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al cargar las etapas y candidatos');\n        }\n    });\n}\n\n/**\n * Expandir automáticamente una etapa del acordeón por su nombre.\n *\n * @param {string} nombre_etapa Nombre de la etapa a expandir.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction expandirEtapaPorNombre(nombre_etapa) {\n    let item_etapa = $(`.accordion-item[data-nombre_etapa=\"${nombre_etapa}\"]`);\n\n    if (item_etapa.length > 0) {\n        let boton = item_etapa.find('.accordion-button');\n\n        if (boton.hasClass('collapsed')) {\n            boton.trigger('click');\n        }\n    }\n}\n\n/**\n * Obtener la clase que corresponda para la etiqueta según el puntaje obtenido del aplicante.\n *\n * @param {number} puntaje Puntaje obtenido por el aplicante.\n * @returns {string}\n * @author Daniel Beltrán\n */\nfunction obtenerClaseEtiquetaSegunPuntajeObtenido(puntaje) {\n    let clase = 'tag-filled-smooth-red';\n\n    if (puntaje > 70) {\n        clase = 'tag-filled-green';\n    } else if (puntaje >= 41 && puntaje <= 70) {\n        clase = 'tag-filled-yellow';\n    }\n\n    return clase;\n}\n\n/**\n * Mostrar la tarjeta detallada del candidato.\n *\n * @param {Object} candidato Objeto con la información del candidato.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarCardDetalleCandidato(candidato) {\n    $('#card-informacion-candidato').empty().append(`\n        <div class=\"d-flex align-items-center\">\n            <div class=\"position-relative me-4 text-center\">\n                <div class=\"position-relative mb-2\">\n                    <img class=\"imagen-participante mx-auto d-block borde-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\" src=\"/usuarios-imagen/${candidato.id}\">\n                    <span class=\"position-absolute top-100 start-50 translate-middle badge rounded-pill px-2 badge-indice-talento-${candidato.adecuacion >= 71 ? 'verde' : (candidato.adecuacion >= 41 ? 'amarillo' : 'rojo')}\">\n                         ${candidato?.adecuacion || '0'}%\n                    </span>\n                </div>\n                <div class=\"small text-label-2 text-gray-30 mt-4\">\n                    ${candidato?.ciudad?.nombre || ''}, ${candidato?.ciudad?.departamento?.pais?.nombre || ''}\n                </div>\n            </div>\n            <div class=\"flex-grow-1\">\n                <div class=\"d-flex align-items-center gap-2\">\n                    <h5 class=\"fw-semibold text-headline-5 text-gray-10 mb-0\">${candidato.nombre_completo || ''}</h5>\n                    <span class=\"text-gray-10\">|</span>\n                    <span class=\"text-label-2 text-gray-10 small\">${candidato.edad || ''} años</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small mb-2\">\n                    Etapa: ${candidato?.etapa_actual?.etapa?.nombre || ''}\n                </div>\n                <div class=\"d-flex flex-wrap text-label-2 text-gray-30 gap-4 small mb-1\">\n                    <span><i class=\"bi bi-envelope\"></i> ${candidato.email || ''}</span>\n                    <span><i class=\"bi bi-telephone\"></i> ${candidato.telefono || ''}</span>\n                </div>\n                <div class=\"text-label-2 text-gray-30 small\">\n                    <i class=\"bi bi-mortarboard\"></i> ${candidato?.perfil_laboral?.nivel_educativo?.nombre || ''}: ${candidato?.perfil_laboral?.titulo || ''}\n                </div>\n            </div>\n            <div class=\"d-flex align-items-center gap-2 ms-auto\">\n                ${crearBoton({\n                    clases: 'btn-outline-primary btn-circle',\n                    texto: '<i class=\"bi bi-link\"></i>',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Compartir acceso\" data-bs-placement=\"bottom\"',\n                    onclick : `modalCompartirAcceso({id: ${candidato.id}, nombre: '${candidato.nombre_completo}', email: '${candidato.email}'})`\n                })}\n                ${crearBoton({\n                    clases: 'btn btn-outline-primary rounded-circle btn-icon',\n                    texto: '<img src=\"/iconos/hoja_vida.svg\">',\n                    adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Ver hoja de vida\" data-bs-placement=\"bottom\"'\n                })}\n                ${candidato.etapa_actual.etapa.nombre !== 'Contratados'\n                    ? crearBoton({\n                        clases: 'btn btn-outline-primary rounded-circle btn-icon btn-mover-etapa-accion',\n                        adicional: `data-etapa-vacante-usuario-id=\"${candidato.etapa_actual.id}\" data-bs-toggle=\"tooltip\" data-bs-title=\"Mover de etapa\" data-bs-placement=\"bottom\"`,\n                        texto: '<i class=\"bi bi-arrow-90deg-right\"></i>',\n                        onclick: `moverEtapaCandidato(${candidato.etapa_actual.id})`,\n                        disabled: candidato.etapa_actual.etapa.nombre === 'Documentos para contratación'\n                            ? !candidato.etapa_actual.etapa_finalizada\n                            : ((candidato.etapa_actual.puntaje === null && candidato.etapa_actual.puntaje_ia === null) || candidato.etapa_actual.etapa_finalizada === false || (candidato?.etapa_actual?.formato_entrevista_completado !== undefined && candidato?.etapa_actual?.formato_entrevista_completado === false))\n                    }) + crearBoton({\n                        clases: 'btn btn-outline-danger rounded-circle btn-icon',\n                        texto: '<img src=\"/iconos/descartar.svg\">',\n                        adicional: 'data-bs-toggle=\"tooltip\" data-bs-title=\"Descartar candidato\" data-bs-placement=\"bottom\"',\n                        onclick: `descartarCandidatos(${candidato.etapa_actual.id})`,\n                    })\n                    : ''\n                }\n            </div>\n        </div>\n        <div class=\"text-secondary text-label-2 text-gray-30 small text-end mt-2\">\n            Agregado: ${candidato?.fecha_agregado ? moment(candidato?.fecha_agregado).format(\"DD/MMM/YY - h:mm A\") : \"\"}\n        </div>\n    `);\n}\n\n/**\n * Mostrar el resultado de la etapa según su nombre.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEtapa(etapa) {\n    switch (etapa.nombre_etapa) {\n        case 'Revisión HV':\n            return mostrarResultadoRevisionHV(etapa);\n        case 'Preguntas prefiltro':\n            return mostrarPreguntasPrefiltro(etapa);\n        case 'Pruebas psicométricas':\n            return mostrarResultadoPruebasPsiciometricas(etapa);\n        case 'Prueba técnica':\n            return mostrarResultadoPruebaTecnica(etapa);\n        case 'Video entrevista':\n            return mostrarResultadoVideoentrevista(etapa);\n        case 'Entrevista':\n            return mostrarResultadoEntrevista(etapa);\n        case 'Documentos para contratación':\n            return mostrarResultadoDocumentosContratacion(etapa);\n        case 'Contratados':\n            return ``;\n        case 'Descartados':\n            return ``;\n        default:\n            return ``;\n    }\n}\n\n/**\n * Mostrar el resultado de la video entrevista.\n *\n * @param {Object} etapa Objeto etapa con preguntas, puntajes y comentarios.\n * @returns {string} HTML del resultado de la video entrevista.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoVideoentrevista(etapa) {\n    let preguntas = etapa.preguntas || [];\n    let contenido_preguntas = '';\n    let transcripcion = etapa?.transcripcion?.texto;\n    if (transcripcion != null) {\n        let expresion_regular = /Pregunta\\s+(\\d+)\\s+([\\s\\S]*?)\\s+Respuesta\\s+([\\s\\S]*?)(?=Pregunta\\s+\\d+|$)/g;\n        let encontrado;\n        let resultados = [];\n        while ((encontrado = expresion_regular.exec(transcripcion)) !== null) {\n            resultados.push({\n                numero_pregunta: Number(encontrado[1]),\n                pregunta: encontrado[2].trim(),\n                respuesta: encontrado[3].trim()\n            });\n        }\n        $.each(resultados, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-headline-6 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta?.pregunta}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    } else {\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += `\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Pregunta ${indice + 1}\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n                </div>\n                <div class=\"row mt-3 respuestas\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        ${pregunta?.respuestas[0]?.respuesta || ''}\n                    </div>\n                </div>\n            `;\n        });\n    }\n    let videos = [];\n    preguntas.forEach(pregunta => {\n        pregunta.respuestas.forEach(respuesta => {\n            respuesta.archivos.forEach(archivo => {\n                videos.push(archivo);\n            });\n        });\n    });\n    if (etapa?.puntaje == null && etapa?.puntaje_ia == null && videos.length == 0) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-youtube text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado la video entrevista\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 pregunta rounded-3 border px-4 pt-4 mb-4\">\n                <div class=\"row\">\n                    <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                        Videograbación\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                        <div class=\"row\" id=\"videos\">\n                            <div class=\"col-12 col-lg-9\">\n                                <div class=\"w-100 text-label-1 fw-semibold text-gray-10\"></div>\n                                <video class=\"w-100 rounded-3 pointer\" id=\"reproductor-videoentrevista\" src=\"/archivos-abrir/${videos[0]?videos[0].id : ''}\" controls>\n                                    <source type=\"video/mp4\">\n                                </video>\n                            </div>\n                            <div class=\"col-12 overflow-auto col-lg-3\" id=\"contenedor-lista-videos\">\n                                <div class=\"row\" id=\"lista-videos\">\n                                    ${videos.length > 0 ? videos.map((video, i) => `\n                                        <div class=\"w-100 text-label-1 fw-semibold text-gray-10 mb-3 pointer\" onclick=\"reproducirVideoEntrevista(${video.id}, ${i + 1});\">\n                                            Pregunta ${i + 1}:\n                                            <video class=\"w-100 rounded-3 pointer\">\n                                                <source src=\"/archivos-abrir/${video.id}\" type=\"video/mp4\">\n                                                Tu navegador no soporta el elemento de video.\n                                            </video>\n                                        </div>\n                                    `).join('') : ``}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center d-none\" id=\"sin-videos\">\n                            <div class=\"col-3 bg-white rounded-3 border text-center py-14\">\n                                <i class=\"bi bi-camera-video-off-fill text-gray-70 my-14\" style=\"font-size: 70px\"></i>\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold text-gray-10 mt-2\">\n                                No hemos encontrado videos\n                            </div>\n                            <div class=\"col-12 text-label-1 text-center fw-semibold mt-2\">\n                                Tus videos han expirado luego de 90 días o han sido eliminados. <a href=\"/\" class=\"text-blue-40\">Más información</a>\n                            </div>\n                        </div>\n                    </div>\n                    ${etapa.formato_entrevista ? `\n                        <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                            <div class=\"row justify-content-end\">\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        clases: `btn-outline-primary`,\n                                        texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                        onclick: `verFormatoEntrevista(${etapa.id})`\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    ` : ''}\n                    <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${contenido_preguntas}</div>\n                </div>\n            </div>\n            <div class=\"col-12 mb-4\">\n                <div class=\"w-100 border-top\"></div>\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                Notas de IA\n            </div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${etapa.notas_ia || ''}\n            </div>\n            <div class=\"col-12\" id=\"seccion-comentarios-videoentrevista\">\n                ${mostrarSeccionComentarios(etapa.comentarios, 'videoentrevista')}\n            </div>\n            <div class=\"my-4\">\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_videoentrevista',\n                                name: 'comentario_videoentrevista',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'videoentrevista')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-between\">\n                        <div class=\"col-6\">\n                            <div class=\"row align-items-center\">\n                                <div class=\"col-auto text-label-1\">\n                                    Puntuación dada por IA\n                                </div>\n                                <div class=\"col-auto pe-0 py-2\">\n                                    ${crearAlerta(`${etapa.puntaje_ia && etapa.puntaje_ia > 59 ? 'success' : 'danger'}`, `${etapa.puntaje_ia || 0}%`, 'py-2 px-3')}\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"row justify-content-end align-items-center\">\n                                <div class=\"col-8 text-label-1\">\n                                    Puntuación dada por reclutador\n                                </div>\n                                <div class=\"col-4\">\n                                    ${crearInput({\n                                        autocomplete: 'off',\n                                        id: 'puntaje_videoentrevista',\n                                        input_container_class: 'mb-0',\n                                        maxlength: 8,\n                                        label: 'Ej 100%',\n                                        onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                        value: etapa.puntaje || '',\n                                        disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la entrevista.\n *\n * @param {Object} etapa Objeto etapa con comentarios y puntajes.\n * @returns {string} HTML del resultado de la entrevista.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoEntrevista(etapa) {\n    return `\n        <div class=\"col-12\" id=\"seccion-comentarios-entrevista\">\n            ${mostrarSeccionComentarios(etapa.comentarios, 'entrevista')}\n        </div>\n        <div class=\"my-4\">\n            <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                Notas del entrevistador\n            </div>\n            ${etapa.formato_entrevista ? `\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                    <div class=\"row justify-content-end\">\n                        <div class=\"col-auto\">\n                            ${crearBoton({\n                                clases: `btn-outline-primary`,\n                                texto: '<i class=\"bi bi-eye pe-3\"></i> Ver formato de entrevista',\n                                onclick: `verFormatoEntrevista(${etapa.id})`\n                            })}\n                        </div>\n                    </div>\n                </div>\n            ` : ''}\n            <div class=\"col-12\">\n                <div class=\"row\">\n                    <div class=\"col\">\n                        ${crearEditorTexto({\n                            id: 'comentario_entrevista',\n                            name: 'comentario_entrevista',\n                            input_container_class: 'mb-0',\n                            class: 'classic-editor-opciones',\n                            disabled: false,\n                            required: false,\n                            label: '',\n                        })}\n                    </div>\n                    <div class=\"col-auto d-flex align-items-end\">\n                        ${crearBoton({\n                            clases: `btn-primary btn-circle`,\n                            texto: '<i class=\"bi bi-send-fill\"></i>',\n                            onclick: `enviarComentario(${etapa.id}, 'entrevista')`\n                        })}\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                <div class=\"row justify-content-end align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación dada por reclutador\n                    </div>\n                    <div class=\"col-auto\">\n                        ${crearInput({\n                            autocomplete: 'off',\n                            id: 'puntaje_entrevista',\n                            input_container_class: 'mb-0',\n                            maxlength: 8,\n                            label: 'Puntuación (%)',\n                            onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                            value: etapa.puntaje || '',\n                            disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                        })}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideoEntrevista(video_id, parte) {\n    $('#reproductor-videoentrevista').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor-videoentrevista')[0].play();\n}\n\n/**\n * Mostrar el resultado de las pruebas psicométricas.\n *\n * @param {Object} etapa Objeto etapa con agendas de pruebas.\n * @returns {string} HTML del resultado de las pruebas psicométricas.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoPruebasPsiciometricas(etapa) {\n    let agendas = etapa?.proceso?.agendas || [];\n    return `\n        <div class=\"table-responsive\">\n            <table class=\"table\">\n                <thead class=\"table-light border-top border-bottom\">\n                    <tr class=\"heigth-cabecera\">\n                        <th class=\"text-body-3 align-content-center text-center\">\n                            ${crearCheckbox({\n                                id: `checkbox-seleccionar-todos`,\n                                onchange: `seleccionarTodos(this.checked);`,\n                            })}\n                        </th>\n                        <th class=\"text-body-3 align-content-center text-start\">Prueba</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Peso</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Fecha de aplicación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Puntuación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Estado</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Reporte</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Grabación</th>\n                        <th class=\"text-body-3 align-content-center text-center\">Acciones</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(agendas || []).map(agenda => `\n                        <tr class=\"border-bottom-1\">\n                            <td class=\"align-content-center text-center\">\n                                ${crearCheckbox({\n                                    value: agenda?.id,\n                                    checked: false,\n                                    onchange: `seleccionarElemento(this.value, this.checked, 'nombre_tabla_quitar', 'tipo_quitar');`,\n                                })}\n                            </td>\n                            <td class=\"align-content-center text-start ps-5\">\n                                <div class=\"row\">\n                                    <div class=\"col-auto my-auto\">\n                                        <img src=\"/imagenes/logos/pruebas/${agenda.prueba.slug}.png\"\n                                            class=\"rounded-circle pointer\"\n                                            width=\"40\"\n                                            height=\"40\"\n                                            alt=\"${agenda.prueba.nombre}\"\n                                            onclick=\"copiarIdAgenda(${agenda.id})\"\n                                            ${crearTooltip({\n                                                placement: `top`,\n                                                content: `ID Agenda: ${agenda.id}<br>Clic para copiar`,\n                                                toggle: `popover`,\n                                                html: true\n                                            })}>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.prueba?.procesos_pruebas[0]?.porcentaje?agenda.prueba.procesos_pruebas[0].porcentaje + '%' : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda?.fecha_procesamiento ? moment(agenda.fecha_procesamiento).format(\"DD/MMM/YY\") : ''}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${agenda.ajuste == null && [4, 5].includes(agenda.estado_id) ? crearBoton({\n                                    clases: 'btn-text-primary btn-circle p-2',\n                                    texto: '<i class=\"bi bi-arrow-repeat text-headline-5\"></i>',\n                                    tooltip: crearTooltip({\n                                        placement: `top`,\n                                        content: `Reenviar agendamiento`,\n                                        toggle: `popover`\n                                    }),\n                                    onclick: `abrirModalReenviarAgendamiento({\n                                        id: '${agenda.id}',\n                                        nombre: '${agenda.nombre_completo}',\n                                        email: '${agenda.email}',\n                                        id_prueba: '${agenda.prueba.id}',\n                                        modal: false\n                                    })`\n                                }) : agenda.estado_id == 3 ? `${agenda.ajuste}%` : ``}\n                            </td>\n                            <td class=\"align-content-center text-center\">\n                                ${crearTagEstadoAgenda(agenda)}\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-file-earmark-arrow-down-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver reporte`,\n                                            toggle: `popover`\n                                        }),\n                                        url: `/reporte-agenda/${agenda.id}`,\n                                        target: '_blank'\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id == 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-primary btn-circle p-2',\n                                        texto: '<i class=\"bi bi-play-btn-fill text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Ver grabación`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `abrirModalVideograbacion('${agenda.id}')`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                            <td class=\"text-center\">\n                                ${(agenda.estado_id === 1)\n                                    ? crearBoton({\n                                        clases: 'btn-text-danger btn-circle p-2',\n                                        texto: '<i class=\"bi bi-trash text-headline-5\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Eliminar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `eliminarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                                ${(agenda.estado_id === 3)\n                                    ? crearBoton({\n                                        clases: 'btn-text-warning btn-circle p-2 ms-1',\n                                        texto: '<i class=\"bi bi-arrow-repeat text-headline-5 text-blue-40\"></i>',\n                                        tooltip: crearTooltip({\n                                            placement: `top`,\n                                            content: `Reprocesar agenda`,\n                                            toggle: `popover`\n                                        }),\n                                        onclick: `reprocesarAgenda(${agenda.id})`\n                                    })\n                                    : ''\n                                }\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Crear tag de estado de agenda con tooltip si el estado requiere fechas.\n *\n * @param {object} agenda Objeto agenda con estado_id, fecha_inicio y fecha_cierre.\n * @returns {string} HTML del tag con o sin tooltip.\n * @author Sergio Vargas\n * @author José Manuel Jiménez\n */\nfunction crearTagEstadoAgenda(agenda) {\n    let estados_configuraciones = {\n        '1': { texto: 'Sin iniciar', class: 'px-4 text-center text-label-1 tag-tonal-blue', mostrar_fechas: true },\n        '2': { texto: 'Iniciada', class: 'px-4 text-center text-label-1 tag-tonal-yellow', mostrar_fechas: true },\n        '3': { texto: 'Finalizada', class: 'px-4 text-center text-label-1 tag-tonal-green', mostrar_fechas: false },\n        '4': { texto: 'Expirada', class: 'px-4 text-center text-label-1 tag-tonal-red', mostrar_fechas: true },\n        '5': { texto: 'Invalidada', class: 'px-4 text-center text-label-1 tag-tonal-gray', mostrar_fechas: false },\n        '6': { texto: 'Sin pago', class: 'px-4 text-center text-label-1 tag-tonal-purple', mostrar_fechas: false },\n    };\n    let estado_id = String(agenda.estado_id);\n    let configuracion = estados_configuraciones[estado_id];\n    if (!configuracion) {\n        return crearTag({ texto: 'Desconocido', class: 'px-4 text-center text-label-1 tag-tonal-gray' });\n    }\n    let contenido_tooltip = '';\n    if (configuracion.mostrar_fechas && agenda.fecha_inicio && agenda.fecha_cierre) {\n        let fecha_inicio_formateada = convertirFecha(agenda.fecha_inicio);\n        let fecha_cierre_formateada = convertirFecha(agenda.fecha_cierre);\n        contenido_tooltip = `Fecha inicio: ${fecha_inicio_formateada}<br>Fecha fin: ${fecha_cierre_formateada}`;\n    }\n    if (contenido_tooltip) {\n        return `\n            <div class=\"tag ${configuracion.class} text-label-1\" data-bs-toggle=\"tooltip\" data-bs-html=\"true\" data-bs-placement=\"top\" title=\"${contenido_tooltip}\">\n                ${configuracion.texto}\n            </div>\n        `;\n    } else {\n        return crearTag({ texto: configuracion.texto, class: configuracion.class });\n    }\n}\n\n/**\n * Reprocesar una agenda finalizada.\n *\n * @param {number} agenda_id ID de la agenda\n * @param {string} nombre_tabla Nombre de la tabla\n * @returns {void}\n * @author Sergio Vargas\n * @author Andres Gonzalez\n */\nfunction reprocesarAgenda(agenda_id, nombre_tabla) {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">¿Reprocesar agenda?</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">\n                    Esta acción volverá a procesar los resultados de la agenda.\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.close();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'Solo reprocesar',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n                <div class=\"col-4 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-tonal-primary w-100 justify-content-center',\n                        texto: 'Reprocesar y enviar correo',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then((resultado) => {\n        if (resultado.isConfirmed || resultado.isDenied) {\n            let enviar_correo = resultado.isDenied;\n            $.ajax({\n                url: `/agendas-reprocesar/${agenda_id}`,\n                type: 'POST',\n                data: {\n                    enviar_notificacion_correo: enviar_correo,\n                    _token: $('meta[name=\"csrf-token\"]').attr('content')\n                },\n                success: function(respuesta) {\n                    if (respuesta.message) {\n                        mostrarToast('success', respuesta.message);\n                        if (nombre_tabla) {\n                            actualizarDatatables(nombre_tabla);\n                            actualizarDatatables(nombre_tabla_resultados);\n                        }\n                    }\n                },\n                error: function(xhr) {\n                    let mensaje = 'Error al reprocesar la agenda.';\n                    if (xhr.responseJSON && xhr.responseJSON.message) {\n                        mensaje = xhr.responseJSON.message;\n                    }\n                    mostrarToast('danger', mensaje);\n                }\n            });\n        }\n    });\n}\n\n/**\n * Abrir el modal de videograbación y mostrar los videos asociados a la agenda.\n *\n * @param {number} agenda_id ID de la agenda.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction abrirModalVideograbacion(agenda_id) {\n    $.ajax({\n        url: `/archivos`,\n        data: {\n            modelo_id: agenda_id,\n            modelo: \"App\\\\Models\\\\Agendas\\\\Agenda\",\n            nombre: 'video'\n        },\n        type: 'GET',\n        success: function (respuesta) {\n            let videos = respuesta.data;\n            $('#reproduciendo-parte').text('1');\n            $('#reproductor').attr('src', '');\n            $('#lista-videos').empty();\n            if (videos.length == 0) {\n                $('#sin-videos').removeClass('d-none');\n                $('#videos').addClass('d-none');\n            } else {\n                $('#sin-videos').addClass('d-none');\n                $('#videos').removeClass('d-none');\n            }\n            for (let i = 0; i < videos.length; i++) {\n                if (i == 0) {\n                    $('#reproductor').prop('src', '/archivos-abrir/' + videos[i].id);\n                }\n                $('#lista-videos').append(`\n                    <div class=\"w-100 text-label-1 fw-semibold text-gray-10\" onclick=\"reproducirVideo(${videos[i].id}, ${i + 1});\">\n                        Parte ${i + 1}:\n                        <video class=\"w-100 rounded-3 pointer\">\n                            <source src=\"/archivos-abrir/${videos[i].id}\" type=\"video/mp4\">\n                            Tu navegador no soporta el elemento de video.\n                        </video>\n                    </div>\n                `);\n            }\n            $('#modal-detalle-participante').modal('hide');\n            $('#modal-vidograbaciones').modal('show');\n            // Ajustar altura de lista de videos después de mostrar el modal\n            setTimeout(ajustarAlturaListaVideos, 100);\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Error al cargar la videograbación.');\n        }\n    });\n}\n\n/**\n * Reproducir un video específico en el reproductor.\n *\n * @param {number} video_id ID del video a reproducir.\n * @param {number} parte Parte del video que se está reproduciendo.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction reproducirVideo(video_id, parte) {\n    $('#reproductor').prop('src', '/archivos-abrir/' + video_id);\n    $('#reproductor')[0].play();\n    $('#reproduciendo-parte').text(parte);\n}\n\n/**\n * Mostrar el resultado de la etapa de revisión de hoja de vida.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n */\nfunction mostrarResultadoRevisionHV(etapa) {\n    let valor_perfil_candidato = etapa?.aspectos?.perfil?.puntaje || 0;\n    let valor_requisitos_candidato = etapa?.aspectos?.requisitos?.puntaje || 0;\n    let coincidentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_coincidentes || []).forEach((dato, indice) => {\n        coincidentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_coincidentes.length || 0) - 1) {\n            coincidentes_string += ', ';\n        }\n    });\n    let diferentes_string = '';\n    (etapa?.aspectos?.perfil?.datos_diferentes || []).forEach((dato, indice) => {\n        diferentes_string += dato;\n        if (indice < (etapa?.aspectos?.perfil.datos_diferentes.length || 0) - 1) {\n            diferentes_string += ', ';\n        }\n    });\n    return `\n        <div class=\"col-12 mt-5\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Perfil del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.perfil?.datos_coincidentes.length || 0} de las ${etapa?.aspectos?.perfil?.total_habilidades_herramientas || 0} habilidades y herramientas requeridas para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 pe-0 text-body-3\"><span class=\"fw-semibold\">Coincidentes:</span> ${coincidentes_string}</div>\n            </div>\n            <div class=\"row mt-1\">\n                <div class=\"col-auto pe-0 text-body-3\"><span class=\"fw-semibold\">No coincidentes:</span> ${diferentes_string}</div>\n            </div>\n            <div class=\"row align-items-center mt-5\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_perfil_candidato && valor_perfil_candidato > 59 ? 'success' : 'warning'}`, `${valor_perfil_candidato}%`, 'py-2 px-3')}\n                </div>\n                <div class=\"col-12 mt-4\">\n                    <div class=\"w-100 border-top\"></div>\n                </div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12 text-body-1 text-gray-10 fw-semibold\">Requisitos del candidato</div>\n                <div class=\"col-12 mt-2 text-body-3\">El candidato cumple con ${etapa?.aspectos?.requisitos?.datos?.filter(item => item.cumple === 1).length || 0} de los ${etapa?.aspectos?.requisitos?.datos?.length || 0} requisitos definidos para esta vacante.</div>\n            </div>\n            <div class=\"row mt-5\">\n                <div class=\"col-12\">\n                    <div class=\"table-responsive\">\n                        <table class=\"table\">\n                            <thead class=\"table-light border-top border-bottom\">\n                                <tr>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Requisito</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Vacante</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4\">Candidato</th>\n                                    <th class=\"text-body-3 text-gray-10 py-4 text-center\">¿Cumple?</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${(etapa?.aspectos?.requisitos?.datos || []).map(requisito =>\n                                    `<tr>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">${requisito.nombre}</td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                        ${\n                                            Array.isArray(requisito.dato_vacante)\n                                                ? requisito.dato_vacante\n                                                    .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                    .join('<br>')\n                                                : requisito.dato_vacante\n                                        }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle\">\n                                            ${\n                                                Array.isArray(requisito.dato_candidato)\n                                                    ? requisito.dato_candidato\n                                                        .map(item => `${item.idioma.nombre}: ${item.nivel}`)\n                                                        .join('<br>')\n                                                    : requisito.dato_candidato\n                                            }\n                                        </td>\n                                        <td class=\"text-body-3 text-gray-30 py-4 align-middle text-center\"><i class=\"bi ${requisito.cumple == 1 ? 'bi-check text-green-cta' : 'bi-x text-gray-40'} text-headline-4\"</td>\n                                    </tr>`\n                                ).join('')}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n            <div class=\"row align-items-center my-3\">\n                <div class=\"col-auto text-label-2 fw-normal\">Puntuación obtenida</div>\n                <div class=\"col-auto ps-0\">\n                    ${crearAlerta(`${valor_requisitos_candidato && valor_requisitos_candidato > 59 ? 'success' : 'warning'}`, `${valor_requisitos_candidato}%`, 'py-2 px-3')}\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Crear una pregunta en el contenedor de preguntas\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @param {number} numero_pregunta Número de la pregunta.\n * @param {object} etapa Objeto de la etapa.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n * @author Andres Gonzalez\n */\nfunction crearPregunta(pregunta, etapa) {\n    pregunta.tipo_pregunta = obtenerTipoPregunta(pregunta);\n    return `\n        <div class=\"col-12 pregunta prefiltro rounded-3 border px-4 pt-4 mb-4\" data-tipo_pregunta=\"${pregunta.tipo_pregunta}\" data-pregunta_id=\"${pregunta.id}\" data-puntaje=\"${pregunta?.puntaje?.puntaje}\" data-puntaje_ia=\"${pregunta?.puntaje?.puntaje_ia}\">\n            <div class=\"row\">\n                <div class=\"col-12 text-body-2 text-gray-10 mb-2\">\n                    Pregunta ${pregunta.tipo_pregunta == 'abierta' ? 'abierta' : ''} ${pregunta.tipo_pregunta == 'seleccion_multiple' ? 'selección múltiple' : ''} ${pregunta.tipo_pregunta == 'seleccion_unica' ? 'selección única' : ''}\n                </div>\n                <div class=\"col-12 text-body-3 text-gray-30 mb-3\">${pregunta.enunciado}</div>\n            </div>\n            <div class=\"row mt-3 respuestas\">${crearRespuesta(pregunta, etapa)}</div>\n        </div>\n    `;\n}\n\n/**\n * Crear el componente de opciones de respuestas según el tipo de pregunta\n * @param {object} pregunta Objeto de la pregunta.\n * @param {object} etapa Objeto de la etapa.\n * @returns {string} Componente de opciones de respuestas.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction crearRespuesta(pregunta, etapa) {\n    let etapa_actual = detalle_usuario?.etapa_actual?.etapa?.nombre === etapa.nombre_etapa;\n\n    if (pregunta.tipo_pregunta == 'abierta') {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta?.respuestas[0]?.respuesta || ''}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row justify-content-between align-items-center\">\n                    <div class=\"col-auto\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por IA\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearAlerta(`${pregunta.puntaje.puntaje_ia && pregunta.puntaje.puntaje_ia > 0 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje_ia || 0} pt`, 'py-2 px-3')}\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"col-auto contenedor-puntuacion-reclutador\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-auto\">\n                                Puntuación dada por reclutador\n                            </div>\n                            <div class=\"col-auto puntuacion-reclutador\">\n                                ${pregunta?.puntaje?.puntaje != null ?\n                                    `${crearAlerta(`${pregunta?.puntaje?.puntaje && pregunta?.puntaje?.puntaje > 0 ? 'success' : 'danger'}`, `${pregunta?.puntaje?.puntaje || 0} pt`, 'py-2 px-3')}`\n                                : ''}\n                            </div>\n                        </div>\n                        <div class=\"row justify-content-center align-items-center\">\n                            <div class=\"col-auto ps-0 py-2\">\n                                <div class=\"row align-items-center\">\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 1 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-check-square-fill text-state-green\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, true, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar como correcta',\n                                                placement: 'top'\n                                            }),\n                                            disabled: !etapa_actual\n                                        })}\n                                    </div>\n                                    <div class=\"col\">\n                                        ${crearBoton({\n                                            clases: `btn-text-primary btn-circle ${pregunta?.puntaje?.puntaje === 0 ? 'selected' : ''}`,\n                                            texto: '<i class=\"bi bi-x-square-fill text-state-red\"></i>',\n                                            onclick: `seleccionarOpcionRespuesta(${pregunta.id}, false, this)`,\n                                            tooltip: crearTooltip({\n                                                content: 'Marcar incorrecta',\n                                                placement: 'top'\n                                            }),\n                                            disabled: !etapa_actual\n                                        })}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2\">Respuesta del candidato</div>\n            <div class=\"col-12 text-body-3 text-gray-30 mb-3\">\n                ${pregunta.opciones.map(opcion =>\n                    crearCard({\n                        nombre_grupo: `opcion_pregunta_${pregunta.id}`,\n                        id: opcion.id,\n                        contenido: opcion.texto,\n                        contenido_class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-green' : 'text-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'text-state-red' : 'text-state-red'}`}` : '',\n                        class: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id) ? `${opcion.es_correcta === 1 ? `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-green' : 'check-state-green'}` : `${pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio-state-red' : 'check-state-red'}`}` : '',\n                        tipo: pregunta.tipo_pregunta == 'seleccion_unica' ? 'radio' : 'checkbox',\n                        onchange: 'validarBotonSiguiente();',\n                        checked: pregunta.respuestas.some(respuesta => respuesta.opcion_pregunta_id === opcion.id),\n                        disabled: true,\n                    })\n                ).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                Correctas\n            </div>\n            <div class=\"col-12\">\n                ${pregunta.opciones.filter(opcion => opcion.es_correcta == 1).map(opcion => `\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto\">\n                            ${pregunta.tipo_pregunta == 'seleccion_unica' ?\n                                crearRadioButton({\n                                    disabled: true,\n                                }) : crearCheckbox({\n                                    disabled: true,\n                                })\n                            }\n                        </div>\n                        <div class=\"col-auto px-0\">\n                            ${opcion.texto}\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            <div class=\"col-12 text-body-2 text-gray-10 mb-2 border-top pt-3 mb-3\">\n                <div class=\"row align-items-center\">\n                    <div class=\"col-auto\">\n                        Puntuación obtenida\n                    </div>\n                    <div class=\"col-auto px-0 py-2\">\n                        ${crearAlerta(`${pregunta.puntaje.puntaje && pregunta.puntaje.puntaje == 1 ? 'success' : 'danger'}`, `${pregunta.puntaje.puntaje || 0} pt`, 'py-2 px-3')}\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de preguntas prefiltro.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarPreguntasPrefiltro(etapa) {\n    let preguntas = etapa.preguntas || [];\n    if (etapa.puntaje == null && etapa.puntaje_ia == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha completado las<br>preguntas prefiltro\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        let contenido_preguntas = '';\n        $.each(preguntas, function(indice, pregunta) {\n            contenido_preguntas += crearPregunta(pregunta, etapa);\n        });\n\n        let total_puntos = mostrarPuntajeTotalPrefiltro();\n\n        contenido_preguntas += `\n            <div class=\"col-12 text-end mb-4\">\n                <div class=\"row justify-content-between\">\n                    <div class=\"col-auto text-headline-4 text-gray-10\">\n                        Total\n                    </div>\n                    <div class=\"col-auto\">\n                        <div class=\"row\">\n                            <div class=\"col-auto pe-0 py-2\">\n                                ${crearTag({\n                                    texto: `<i class=\"bi bi-dot text-state-green\"></i> Se requieren más de ${etapa.cantidad_preguntas_correctas} pt`,\n                                    class: 'tag-tonal-gray',\n                                })}\n                            </div>\n                            <div class=\"col-auto pe-0 py-2\" id=\"contenedor-total-puntos-prefiltro\">${crearAlerta(`${total_puntos >= parseInt(etapa.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n        return contenido_preguntas;\n    }\n}\n\n/**\n * Obtener el tipo de pregunta según sus características\n *\n * @param {object} pregunta Objeto de la pregunta.\n * @returns {string} Tipo de pregunta.\n * @author José Manuel Jiménez\n */\nfunction obtenerTipoPregunta(pregunta) {\n    if (pregunta.es_abierta == 1) {\n        return 'abierta';\n    } else {\n        let cantidades_correctas = 0;\n        pregunta.opciones.forEach(function(opcion) {\n            if (opcion.es_correcta == 1) {\n                cantidades_correctas++;\n            }\n        });\n        if (cantidades_correctas == 1) {\n            return 'seleccion_unica';\n        } else {\n            return 'seleccion_multiple';\n        }\n    }\n}\n\n/**\n * Seleccionar opción de respuesta para pregunta abierta.\n *\n * @param {number} pregunta_id ID de la pregunta.\n * @param {boolean} es_correcta Indica si la respuesta es correcta.\n * @param {object} elemento Elemento HTML del botón seleccionado.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarOpcionRespuesta(pregunta_id, es_correcta, elemento) {\n    $(elemento).closest('.row').find('.btn-circle').removeClass('selected');\n    $(elemento).addClass('selected');\n    let puntaje = es_correcta ? 1 : 0;\n    $.ajax({\n        url: `/guardar-puntaje-pregunta-reclutador`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            pregunta_id: pregunta_id,\n            puntaje: puntaje,\n            usuario_id: usuario_detalle_id\n        },\n        success: function(respuesta) {\n            if (es_correcta) {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('success', '1 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato gana 1 punto.');\n            } else {\n                $(elemento).closest('.contenedor-puntuacion-reclutador').find('.puntuacion-reclutador').empty().append(`\n                    ${crearAlerta('danger', '0 pt', 'py-2 px-3')}\n                `);\n                mostrarToast('success', 'El candidato no obtiene puntos.');\n            }\n            mostrarPuntajeTotalPrefiltro();\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al guardar la respuesta.');\n        }\n    });\n}\n\n/**\n * Mostrar el puntaje total actualizado en la etapa de preguntas prefiltro.\n *\n * @returns {number} Puntaje total.\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction mostrarPuntajeTotalPrefiltro() {\n    let total_puntos = 0;\n\n    if ($('#contenedor-total-puntos-prefiltro').length > 0) {\n        $('.pregunta.prefiltro').each(function() {\n            let puntaje    = parseInt($(this).data('puntaje'));\n            let puntaje_ia = parseInt($(this).data('puntaje_ia'));\n\n            if (puntaje !== null && !isNaN(puntaje)) {\n                total_puntos += puntaje;\n            } else if (puntaje_ia !== null && !isNaN(puntaje_ia)) {\n                total_puntos += puntaje_ia;\n            }\n        });\n\n        let etapa_preguntas_prefiltro = detalle_usuario.etapas.find(etapa => etapa.nombre_etapa === 'Preguntas prefiltro');\n\n        $('#contenedor-total-puntos-prefiltro').empty().append(`\n            ${crearAlerta(`${total_puntos >= parseInt(etapa_preguntas_prefiltro.cantidad_preguntas_correctas) ? 'success' : 'warning'}`, `${total_puntos} pt`, 'py-2 px-3')}\n        `);\n    }\n\n    return total_puntos;\n}\n\n/**\n * Mostrar el resultado de la etapa de prueba técnica.\n *\n * @param {Object} etapa Etapa de la vacante.\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Jair Carvajal\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoPruebaTecnica(etapa) {\n    let archivos_prueba_tecnica = etapa?.archivos?.archivos || [];\n    $('#contenedor-archivos-prueba-tecnica').empty();\n    let documentos_prueba_tecnica = [];\n    let imagenes_cargadas = [];\n    archivos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_prueba_tecnica.push(archivo);\n        }\n    });\n\n    let archivos_html = '';\n    documentos_prueba_tecnica.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 nowrap text-decoration-none\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa?.archivos?.enlace != '' && etapa?.archivos?.enlace != null) {\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"bi bi-link-45deg text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3 text-blue-40\">\n                            ${etapa.archivos.enlace}\n                        </div>\n                        <a class=\"col-auto\" href=\"${etapa.archivos.enlace}\" target=\"_blank\">\n                            <i class=\"bi bi-eye text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    if (archivos_prueba_tecnica.length == 0 && etapa?.archivos?.enlace == null) {\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-file-text-fill text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado la prueba técnica\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-auto mb-3 text-body-2 text-gray-10\">\n                        Archivos adjuntos\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-prueba-tecnica\">${archivos_html}</div>\n                    <div class=\"col-12 mt-5 mb-1 text-body-2 text-gray-10\">\n                        Comentario aplicante\n                    </div>\n                    <div class=\"col-12 text-body-3 text-gray-30\">\n                        ${etapa.archivos.observacion_candidato || 'Sin comentarios'}\n                    </div>\n                </div>\n                <div class=\"col-12\" id=\"seccion-comentarios-prueba_tecnica\">\n                    ${mostrarSeccionComentarios(etapa.comentarios, 'prueba_tecnica')}\n                </div>\n                <div class=\"col-12 my-3 text-body-2 text-gray-10\">\n                    Adicionales\n                </div>\n                <div class=\"col-12\">\n                    <div class=\"row\">\n                        <div class=\"col\">\n                            ${crearEditorTexto({\n                                id: 'comentario_prueba_tecnica',\n                                name: 'comentario_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                class: 'classic-editor-opciones',\n                                disabled: false,\n                                required: false,\n                                label: '',\n                            })}\n                        </div>\n                        <div class=\"col-auto d-flex align-items-end\">\n                            ${crearBoton({\n                                clases: `btn-primary btn-circle`,\n                                texto: '<i class=\"bi bi-send-fill\"></i>',\n                                onclick: `enviarComentario(${etapa.id}, 'prueba_tecnica')`\n                            })}\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-12 mt-10 text-body-2 text-gray-10\">\n                    <div class=\"row justify-content-end align-items-center\">\n                        <div class=\"col-auto\">\n                            Puntuación dada por reclutador\n                        </div>\n                        <div class=\"col-auto\">\n                            ${crearInput({\n                                autocomplete: 'off',\n                                id: 'puntaje_prueba_tecnica',\n                                input_container_class: 'mb-0',\n                                maxlength: 8,\n                                label: 'Puntuación (%)',\n                                onblur: `actualizarPuntajePruebaTecnica(${etapa.id}, this.value)`,\n                                value: etapa.puntaje || '',\n                                disabled: etapa.puntaje == null && detalle_usuario?.etapa_actual?.etapa?.nombre == etapa.nombre_etapa ? false : true\n                            })}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Actualizar el puntaje de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {number} puntaje Puntaje a actualizar.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction actualizarPuntajePruebaTecnica(etapa_vacante_usuario_id, puntaje) {\n    if (puntaje == '') {\n        return;\n    } else if (puntaje >= 0 && puntaje <= 100) {\n        $.ajax({\n            url: `/guardar-puntaje-adecuacion-reclutador`,\n            type: 'POST',\n            dataType: 'json',\n            data: {\n                _token: $('meta[name=\"csrf-token\"]').attr('content'),\n                id: etapa_vacante_usuario_id,\n                puntaje: puntaje,\n            },\n            success: function(respuesta) {\n                mostrarToast('success', 'Puntaje actualizado correctamente.');\n            },\n            error: function() {\n                mostrarToast('danger', 'Error al actualizar el puntaje.');\n            }\n        });\n    } else {\n        mostrarToast('warning', 'El puntaje debe estar entre 0 y 100.');\n    }\n}\n\n/**\n * Mostrar la sección de comentarios en la etapa de prueba técnica.\n *\n * @param {Array} comentarios Lista de comentarios.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {string} Código HTML de la sección de comentarios.\n * @author José Manuel Jiménez\n */\nfunction mostrarSeccionComentarios(comentarios, tipo_comentario) {\n    return comentarios && comentarios.length > 0 ? `\n        <div class=\"row align-items-center mb-5\">\n            <div class=\"col-auto text-headline-5 text-gray-10 fw-bold\">\n                Comentarios\n            </div>\n            <div class=\"col-auto py-1 px-3 bg-gray-90 rounded-4\">${comentarios.length}</div>\n        </div>\n        <div class=\"rounded-4 pt-6 pb-1 px-4 bg-gray-90\" id=\"contenedor-comentarios-${tipo_comentario}\">\n            ${comentarios.map(comentario => mostrarComentario(comentario)).join('')}\n        </div>\n    ` : '';\n}\n\n/**\n * Mostrar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {Object} comentario Objeto del comentario.\n * @returns {string} Código HTML del comentario.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarComentario(comentario) {\n    // Crear elemento temporal para insertar HTML de forma segura\n    let elemento_temporal = document.createElement('div');\n    elemento_temporal.innerHTML = comentario.comentario || '';\n\n    return `\n        <div class=\"row mb-5\">\n            <div class=\"col-auto\">\n                <img src=\"/usuarios-imagen/${comentario.usuario_id}\" class=\"rounded-circle border\" width=\"50\" height=\"50\">\n            </div>\n            <div class=\"col ps-0\">\n                <div class=\"col-12 px-4 pt-4 bg-white rounded-4 shadow-1\">\n                    <div class=\"row\">\n                        <div class=\"col-12 text-label-2 text-gray-10\">\n                            ${comentario?.usuario?.nombre_completo || ''}\n                        </div>\n                        <div class=\"col-12 text-body-3 comentario-contenido\">\n                            ${elemento_temporal.innerHTML}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Enviar un comentario en la sección de comentarios de la prueba técnica.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @param {string} tipo_comentario Tipo de comentario (prueba_tecnica o videoentrevista)\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction enviarComentario(etapa_vacante_usuario_id, tipo_comentario) {\n    let comentario = obtenerDatosClassicEditor(`comentario_${tipo_comentario}`);\n    if (comentario.trim() === '') {\n        mostrarToast('warning', 'Debes escribir un comentario.');\n        return;\n    }\n    establecerDatosClassicEditor(`comentario_${tipo_comentario}`, '');\n    $.ajax({\n        url: `/etapas-usuarios-comentarios`,\n        type: 'POST',\n        dataType: 'json',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content'),\n            etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n            comentario: limpiarHTMLCKEditor(comentario),\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Comentario enviado correctamente.');\n            $.ajax({\n                url: `/etapas-usuarios-comentarios`,\n                type: 'GET',\n                data: {\n                    etapa_vacante_usuario_id: etapa_vacante_usuario_id,\n                },\n                dataType: 'json',\n                success: function(datos) {\n                    let comentarios = datos.data;\n                    $(`#seccion-comentarios-${tipo_comentario}`).empty().append(mostrarSeccionComentarios(comentarios, tipo_comentario));\n                },\n                error: function() {\n                    mostrarToast('danger', 'Error al cargar los comentarios.');\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al enviar el comentario.');\n        }\n    });\n}\n\n/**\n * Obtiene el ícono correspondiente a una extensión de archivo\n *\n * @param {string} extension Extensión del archivo\n * @returns {string} Clase del ícono correspondiente\n * @author José Manuel Jiménez\n */\nfunction obtenerIconoPorExtension(extension) {\n    switch (extension) {\n        case 'pdf':\n            return 'bi bi-filetype-pdf';\n        case 'doc':\n        case 'docx':\n            return 'bi bi-filetype-docx';\n        case 'xls':\n        case 'xlsx':\n            return 'bi bi-filetype-xlsx';\n        default:\n            return 'bi bi-file-earmark';\n    }\n}\n\n/**\n * Mostrar el resultado de la etapa de documentos para contratación.\n *\n * @returns {string} Código HTML del resultado de la etapa.\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarResultadoDocumentosContratacion(etapa) {\n    let archivos_contratacion = etapa?.archivos_solicitados?.archivos_guardados || [];\n\n    // Si fecha_ejecucion es null, solo mostrar archivos cargados por la empresa (prefijo cliente_empresa_)\n    if (etapa.fecha_ejecucion == null) {\n        archivos_contratacion = archivos_contratacion.filter(archivo => archivo.nombre.startsWith('cliente_empresa_'));\n    }\n\n    $('#contenedor-archivos-contratacion').empty();\n    let documentos_contratacion = [];\n    let imagenes_cargadas = [];\n    archivos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let es_imagen = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n        if (es_imagen) {\n            imagenes_cargadas.push(archivo);\n        } else {\n            documentos_contratacion.push(archivo);\n        }\n    });\n    let archivos_html = '';\n    documentos_contratacion.forEach((archivo) => {\n        let extension = archivo.nombre_original_archivo.split('.').pop().toLowerCase();\n        let icono = obtenerIconoPorExtension(extension);\n        let url_archivo = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-auto py-3\">\n                            <i class=\"${icono} text-blue-40\"></i>\n                        </div>\n                        <div class=\"col px-0 py-3\">\n                            <a href=\"${url_archivo}\"\n                               target=\"_blank\"\n                               class=\"text-blue-40 text-decoration-none nombre-archivo-contratacion\"\n                               ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                                ${archivo.nombre_original_archivo}\n                            </a>\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_archivo}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    imagenes_cargadas.forEach((archivo) => {\n        let url_imagen = `/archivos-abrir/${archivo.id}`;\n        archivos_html += `\n            <div class=\"col-auto archivo-item\">\n                <div class=\"col-auto px-3 border rounded-2 contenedor-archivo-imagen\">\n                    <div class=\"row align-items-center\">\n                        <img class=\"col-12 border-bottom px-0 pointer imagen-archivo-previsualizacion\" src=\"${url_imagen}\" alt=\"${archivo.nombre_original_archivo}\" onclick=\"mostrarPrevisualizacionImagen('${url_imagen}')\">\n                    </div>\n                    <div class=\"row align-items-center\">\n                        <div class=\"col pe-0 py-3 text-blue-40 nowrap\" ${crearTooltip({placement: 'top', content: archivo.nombre_original_archivo, toggle: 'popover'})}>\n                            ${archivo.nombre_original_archivo}\n                        </div>\n                        <a class=\"col-auto\" href=\"${url_imagen}\" download>\n                            <i class=\"bi bi-download text-blue-40 pointer\"></i>\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n    if (etapa.fecha_ejecucion == null && archivos_contratacion.length == 0) {\n        $('#contenedor-cantidad-adjuntos').empty();\n        return `\n            <div class=\"col-12\">\n                <div class=\"row justify-content-center my-14\">\n                    <div class=\"col-auto\">\n                        <i class=\"bi bi-filetype-pdf text-gray-60 icono-sin-completar-etapa\"></i>\n                    </div>\n                    <div class=\"col-12 text-center text-headline-5\">\n                        Este candidato aún no ha adjuntado los documentos para contratación\n                    </div>\n                </div>\n            </div>\n        `;\n    } else {\n        setTimeout(() => {\n            $('#contenedor-cantidad-adjuntos').empty().append(\n                crearTag({texto: '', class: 'tag-tonal-blue cantidad-adjuntos'})\n            );\n\n            let archivos_aplicante = etapa.archivos_solicitados.archivos_guardados.filter(archivo => !archivo.nombre.startsWith('cliente_empresa_'));\n            let tipos_documentos_cargados = [...new Set(archivos_aplicante.map(archivo => archivo.nombre))];\n            $('.cantidad-adjuntos').text(`${tipos_documentos_cargados.length} de ${etapa.archivos_solicitados.documentos.length} Adjuntos`);\n        }, 100);\n        return `\n            <div class=\"col-12\">\n                <div class=\"border rounded-4 p-4 mb-4 position-relative\">\n                    <div class=\"col-12\">\n                        <div class=\"row justify-content-between align-items-center mb-4\">\n                            <div class=\"col-auto text-body-2 text-gray-10\">\n                                Archivos adjuntos\n                            </div>\n                            <div class=\"col-auto\">\n                                ${crearBoton({\n                                    clases: 'btn-outline-primary',\n                                    texto: '<i class=\"bi bi-link-45deg\"></i> Adjuntar archivos',\n                                    onclick: `$('#documentos_contratacion').click();`\n                                })}\n                                <input type=\"file\" id=\"documentos_contratacion\" accept=\"application/pdf,.doc,.docx,.xls,.xlsx\" class=\"d-none\" onchange=\"adjuntarDocumentosContratacion(${etapa.id})\">\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row g-3\" id=\"contenedor-archivos-contratacion\">${archivos_html}</div>\n                </div>\n            </div>\n        `;\n    }\n}\n\n/**\n * Adjuntar documentos para contratación.\n *\n * @param {number} etapa_vacante_usuario_id ID de la etapa vacante usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction adjuntarDocumentosContratacion(etapa_vacante_usuario_id) {\n    let formulario_datos = new FormData();\n    formulario_datos.append('etapa_vacante_usuario_id', etapa_vacante_usuario_id);\n    let archivo = $('#documentos_contratacion')[0].files[0];\n    formulario_datos.append('archivo', archivo);\n    let nombre_documento = archivo.name;\n    formulario_datos.append('nombre_documento', 'cliente_empresa_' + nombre_documento);\n    $.ajax({\n        url: `/vacantes-guardar-documentos-solicitados`,\n        type: 'POST',\n        data: formulario_datos,\n        processData: false,\n        contentType: false,\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        success: function(respuesta) {\n            mostrarToast('success', 'Documento adjuntado correctamente.');\n            $.ajax({\n                url: `/vacantes-detalle-aplicante/${VACANTE_ID}/${usuario_detalle_id}`,\n                type: 'GET',\n                dataType: 'json',\n                success: function(datos) {\n                    let etapa_documentos_contratacion = datos.data.etapas.find(etapa => etapa.nombre_etapa === 'Documentos para contratación');\n                    $('#contenedor-archivos-contratacion').closest('.accordion-body').empty().append(mostrarResultadoDocumentosContratacion(etapa_documentos_contratacion));\n                }\n            });\n        },\n        error: function() {\n            mostrarToast('danger', 'Error al adjuntar el documento.');\n        }\n    });\n}\n\n/**\n * Seleccionar checkbox de etapa.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction seleccionarCheckboxEtapa() {\n    let seleccionados = $('.checkbox-etapa:checked').length;\n    if (seleccionados > 0) {\n        $('#texto-boton-exportar').html('Exportar selección');\n    } else {\n        $('#texto-boton-exportar').html('Exportar todo');\n    }\n}\n\n/**\n * Mostrar el modal de compartir acceso.\n *\n * @param {Object} usuario Información del participante.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalCompartirAcceso(usuario) {\n    $.ajax({\n        url : `/generar-acceso-usuario/${usuario.id}`,\n        type: 'POST',\n        data: {\n            _token: $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    }).done((respuesta) => {\n        $('#enlace-acceso').attr('href', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('#enlace-acceso').text(respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n        $('.enlace-acceso').data('texto', respuesta.data.enlace + '?vacante_id='+VACANTE_ID);\n    }).fail((error) => {\n        mostrarToast('danger', 'Ocurrió un error al generar el enlace de acceso');\n    });\n\n    $('#modal-compartir-acceso #imagen_usuario').attr('src', '/usuarios-imagen/'+usuario.id);\n    $('#modal-compartir-acceso #nombre').html(`ID ${usuario.id} - ${usuario.nombre}`);\n    $('#modal-compartir-acceso #correo').html(`<i class=\"bi bi-envelope me-2\"></i> ${usuario.email}`);\n    $('#modal-detalle-resultados').modal('hide');\n    $('#modal-compartir-acceso').modal('show');\n}\n\n/**\n * Mostrar el modal para asignar candidato a otra vacante.\n *\n * @param {number} usuario_id ID del usuario.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction modalAsignarCandidatoOtraVacante(usuario_id) {\n    clonar_usuario_id = usuario_id;\n    $.ajax({\n        url: `/vacantes-listado-tabla`,\n        data: {\n            activo: 1\n        },\n        type: 'GET',\n        dataType: 'json',\n        success: function(datos) {\n            let vacantes = datos.data;\n            $('#asignar_vacante_id').empty().append(\n                `<option value=\"\">Selecciona una vacante</option>` + vacantes.map(vacante => `\n                    <option value=\"${vacante.id}\">${vacante.nombre_vacante || ''}</option>\n                `).join('')\n            );\n        }\n    });\n    $('#modal-asignar-candidato-otra-vacante').modal('show');\n}\n\n/**\n * Clonar aplicante de una vacante a otra.\n *\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction clonarAplicante() {\n    if ($('#asignar_vacante_id').val() == '') {\n        mostrarToast('danger', 'Debes seleccionar una vacante.');\n    } else {\n        $.ajax({\n            url: '/vacantes-clonar-aplicante',\n            type: 'POST',\n            data: {\n                _token          : $('meta[name=\"csrf-token\"]').attr('content'),\n                vacante_id      : VACANTE_ID,\n                nueva_vacante_id: $('#asignar_vacante_id').val(),\n                usuario_id      : clonar_usuario_id\n            }\n        }).done((respuesta) => {\n            mostrarToast('success', respuesta.message);\n            $('#modal-asignar-candidato-otra-vacante').modal('hide');\n        }).fail((error) => {\n            mostrarToast('danger', error.responseJSON?.message);\n        });\n    }\n}\n\n/**\n * Ver formato de entrevista.\n *\n * @param {number} etapa_id ID de la etapa de entrevista.\n * @returns {void}\n * @author José Manuel Jiménez\n */\nfunction verFormatoEntrevista(etapa_id) {\n    window.open(`/formatos-entrevistas/${etapa_id}`, '_blank');\n}\n\n/**\n * Ajustar altura de lista de videos dinámicamente según el tamaño de pantalla.\n * Calcula la altura disponible basándose en el viewport height y aplica\n * un límite máximo responsivo al contenedor de la lista de videos.\n *\n * @returns {void}\n * @author Jair Carvajal\n */\nfunction ajustarAlturaListaVideos() {\n    var contenedor = document.getElementById('contenedor-lista-videos');\n    if (!contenedor) return;\n    var altura_viewport = window.innerHeight;\n    var altura_maxima = altura_viewport * 0.6;\n    contenedor.style.maxHeight = `${altura_maxima}px`;\n}\n\nwindow.addEventListener('resize', ajustarAlturaListaVideos);\nwindow.addEventListener('load', ajustarAlturaListaVideos);\n","structuredPatch":[{"oldStart":829,"oldLines":7,"newStart":829,"newLines":7,"lines":["                                     ${","                                     etapa.nombre_etapa === 'Documentos para contratación'","                                         ? crearTag({ texto: '', class: 'tag-tonal-blue cantidad-adjuntos' })","-                                        : etapa.etapa_completada == false","+                                        : etapa.etapa_completada !== true","                                             ? crearTag({","                                                 texto: `Resultados pendientes`,","                                                 class: 'bg-gray-80 text-gray-30'"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"e7761a84-b9e4-4e7c-9536-dcc7d5f17cb6"}
{"parentUuid":"582d0483-9d4f-4aa0-aed3-ade872e8ca7a","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016v6GYFgMotyRfJRMNb8vrS","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto. He cambiado la condición de `etapa.etapa_completada == false` a `etapa.etapa_completada !== true`. Esto es mejor porque:\n\n1. Si `etapa.etapa_completada` es `false` → muestra \"Resultados pendientes\" ✓\n2. Si `etapa.etapa_completada` es `undefined` (no existe) → muestra \"Resultados pendientes\" ✓\n3. Si `etapa.etapa_completada` es `null` → muestra \"Resultados pendientes\" ✓\n4. Si `etapa.etapa_completada` es `true` → NO muestra \"Resultados pendientes\", pasa a evaluar puntajes ✓\n\nEsta es una forma más robusta de validar porque cubre todos los casos donde la etapa no está completada o donde el parámetro no existe.","signature":"EqkGCkYICxgCKkDIk1V+Ta+vQnTl8nJr0C4/DHaqE9wMtqeS3W1huiYlX+nZz/nmlQJ9PZYO/LncuceV2LTeLFceihCzW97PCREjEgx8aP2B0M1g5ipTEkIaDDHOYritiRZL78+rpCIwjlXqz15OK3IkaM+L+6mkEL7naPxVGjVv2ZWABhpSY7qD6UMvh+bHvYAkelAcfKeOKpAFBLGB85d2B69RwO7TcqOtnLe3sVg52scChCCyWOk/Ojw2E7TKbflX3mnfUZOrYdS7bAwq8cmdnxCHIEn9MK2ueJOzQU45UrdYcLn5HEP4Z6wskbL0gJYDDZ8dHC5EEZQ28k/9QzrhHVI47LzeEs0PiGxlYCFX7WNRm8Ua5mnab+sy5prmrB1rVO1vte0Xf7UH+VSnyfpn/zvtf50FuLtY0fzC7Wz80Ho20wO1F1fa2NyUsqDyfrHcmg8Kl+pZn/QmFYjLHkCQBwa5y6F90SRZiwtsA6g5mhEaAkK+ozIVoJ8Ojo/uk5zuk9QsQqRTuiwXF/kOyxJoFj6EnBFHhrrkDk+6fvFEDmQZASLj+sxD1lJvA5cL+qFpbxYRcUnP+OxRFOXtSUJn+V69YNb3MEWT58Uc+bdbU6jfbXOvhs7lX/FFkVp4GDNLRyW0tyRcGGSY5Sq+rErq4/I8JqTl6RKtrXcy5fVTEKkCpOroN713+rIh+7K0CufRCB7Q0kJiKmiuVuw437IOmzyeVWJvyl08F8vl9Xt3BWRn9b+HbM/RnhRExISAXHoX9HJBqoXnFNRo90eMBcRWxW7uFKrYpRtnscF0cYSr6uxKPfvb5wid3HylodCx7k07qRmraF59FEPwELhRhH1xhNImIwhGe8lxo8dPMcb8cSXuu0pZKVDWp2/FbOQyruO1a6FUnwid657H34cclI/VOgPqka7D67x9rc1EKKODjIgLgoZ8V4t1XSz9pyDHIFPtXR69KSFcRnc6jK5QtPxLJcGUVOg+iOSnT+S+6spwFe0wdi52M5hRb9I4FS5q4otW6tNM+iFZFDrgbnQqZNPZwessOxvfYjju+wFzO8UmRMvE8Vw1rsZGJDcYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":505,"cache_read_input_tokens":75759,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":505},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoqezxwzHC5hXXK4Br7H","type":"assistant","uuid":"12a77643-b506-46da-90be-5616a41fc2e1","timestamp":"2026-02-04T22:45:13.038Z"}
{"parentUuid":"12a77643-b506-46da-90be-5616a41fc2e1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"2a769446-2d34-497b-bebb-d79948b624ac","version":"2.1.29","gitBranch":"D26-489","slug":"shimmering-swimming-cerf","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016v6GYFgMotyRfJRMNb8vrS","type":"message","role":"assistant","content":[{"type":"text","text":"Listo! He actualizado la condición en [detalle-resultados.js:832](public/js/vacantes/detalles/detalle-resultados.js#L832) a `etapa.etapa_completada !== true`.\n\n**Esta condición cubre todos los casos:**\n- Si `etapa_completada` es `false` → muestra \"Resultados pendientes\" ✓\n- Si `etapa_completada` no existe (`undefined`) → muestra \"Resultados pendientes\" ✓\n- Si `etapa_completada` es `null` → muestra \"Resultados pendientes\" ✓\n- Si `etapa_completada` es `true` → NO muestra \"Resultados pendientes\", evalúa puntajes ✓\n\nEsto es más robusto que `== false` porque maneja correctamente los casos donde el parámetro no existe en el objeto."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":505,"cache_read_input_tokens":75759,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":505},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXoqezxwzHC5hXXK4Br7H","type":"assistant","uuid":"a8339792-10cf-440a-9d72-8373c0b7506f","timestamp":"2026-02-04T22:45:15.762Z"}
