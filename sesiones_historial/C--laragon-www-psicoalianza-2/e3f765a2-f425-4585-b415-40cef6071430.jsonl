{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-27T16:35:17.155Z","sessionId":"e3f765a2-f425-4585-b415-40cef6071430"}
{"type":"file-history-snapshot","messageId":"ac658136-2543-44e8-a978-cdb0f0c582fd","snapshot":{"messageId":"ac658136-2543-44e8-a978-cdb0f0c582fd","trackedFileBackups":{},"timestamp":"2026-01-27T16:35:17.267Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\laragon\\www\\psicoalianza-2\\public\\js\\globales.js in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"aqui en globales creame una funcion que se llam ebuscar funcionlidad y que si la encuentra debulba true y siu no false ya la data que le llega es asi [\n    {\n      \"id\": 15,\n      \"empresa_plan_id\": 27,\n      \"funcionalidad_id\": 11,\n      \"funcionalidad\": {\n        \"id\": 11,\n        \"tipo_prueba_id\": 1,\n        \"nombre\": \"Plantillas personalizadas\",\n        \"llave\": \"plantillas_personalizadas\"\n      }\n    },\n    {\n      \"id\": 16,\n      \"empresa_plan_id\": 27,\n      \"funcionalidad_id\": 31,\n      \"funcionalidad\": {\n        \"id\": 31,\n        \"tipo_prueba_id\": null,\n        \"nombre\": \"Atención personalizada de soporte\",\n        \"llave\": \"atencion_soporte\"\n      }\n    },\n    {\n      \"id\": 17,\n      \"empresa_plan_id\": 27,\n      \"funcionalidad_id\": 30,\n      \"funcionalidad\": {\n        \"id\": 30,\n        \"tipo_prueba_id\": null,\n        \"nombre\": \"Envío masivo de correos\",\n        \"llave\": \"envio_masivo_correos\"\n      }\n    },\n    {\n      \"id\": 18,\n      \"empresa_plan_id\": 27,\n      \"funcionalidad_id\": 21,\n      \"funcionalidad\": {\n        \"id\": 21,\n        \"tipo_prueba_id\": 1,\n        \"nombre\": \"Índice de talento\",\n        \"llave\": \"indice_talento\"\n      }\n    },\n    {\n      \"id\": 19,\n      \"empresa_plan_id\": 27,\n      \"funcionalidad_id\": 32,\n      \"funcionalidad\": {\n        \"id\": 32,\n        \"tipo_prueba_id\": null,\n        \"nombre\": \"Parametrización del tiempo\",\n        \"llave\": \"parametrizacion_tiempo\"\n      }\n    },\n    {\n      \"id\": 20,\n      \"empresa_plan_id\": 27,\n      \"funcionalidad_id\": 33,\n      \"funcionalidad\": {\n        \"id\": 33,\n        \"tipo_prueba_id\": null,\n        \"nombre\": \"Previsualización de reportes\",\n        \"llave\": \"previsualizar_reportes_seleccion\"\n      }\n    },\n    {\n      \"id\": 21,\n      \"empresa_plan_id\": 27,\n      \"funcionalidad_id\": 22,\n      \"funcionalidad\": {\n        \"id\": 22,\n        \"tipo_prueba_id\": 1,\n        \"nombre\": \"Psicoacademy\",\n        \"llave\": \"psicoacademy\"\n      }\n    },\n    {\n      \"id\": 22,\n      \"empresa_plan_id\": 27,\n      \"funcionalidad_id\": 29,\n      \"funcionalidad\": {\n        \"id\": 29,\n        \"tipo_prueba_id\": null,\n        \"nombre\": \"Registro fotográfico\",\n        \"llave\": \"capturar_fotos\"\n      }\n    },\n    {\n      \"id\": 23,\n      \"empresa_plan_id\": 27,\n      \"funcionalidad_id\": 24,\n      \"funcionalidad\": {\n        \"id\": 24,\n        \"tipo_prueba_id\": 1,\n        \"nombre\": \"Reportes comparativos\",\n        \"llave\": \"reportes_comparativos_seleccion\"\n      }\n    },\n    {\n      \"id\": 24,\n      \"empresa_plan_id\": 27,\n      \"funcionalidad_id\": 23,\n      \"funcionalidad\": {\n        \"id\": 23,\n        \"tipo_prueba_id\": 1,\n        \"nombre\": \"Videograbación\",\n        \"llave\": \"capturar_videos_seleccion\"\n      }\n    } y es buscar por la llave"}]},"uuid":"ac658136-2543-44e8-a978-cdb0f0c582fd","timestamp":"2026-01-27T16:35:17.262Z","permissionMode":"default"}
{"parentUuid":"ac658136-2543-44e8-a978-cdb0f0c582fd","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","message":{"model":"claude-opus-4-5-20251101","id":"msg_01M7AKWpqrkGFrb9eTYz7EjK","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere que cree una función en el archivo globales.js que busque una funcionalidad por su llave en un array de objetos. La función debe devolver true si encuentra la funcionalidad y false si no la encuentra.\n\nLa estructura de datos muestra que cada elemento tiene una propiedad `funcionalidad` que a su vez tiene una propiedad `llave`. La función debe buscar por esa llave.\n\nPrimero debo leer el archivo para ver dónde agregar la función.","signature":"Eu0ECkYICxgCKkAUEPX+AzALqOzn3Od3qFyt/jZ7kQ07QXjjfL/UOCeKsyd3CqOpq8uFsg018JN2Zh9Z8qIFtWyka+Ljj7b7zOaLEgwZ5lbAyucfuUlh61waDNdbhzCv1/m0t5u5NSIwcZl0F1wvEfSew+qo4GS3jHkGA+N7bAtWu3g7AWDPe/ot3fh2E+l0gWYZY1dvyNliKtQDNqUcwNh+QMubvEqSQgI0IEB30Iwip1NF6YOGVcKdxfkXYUOyYvziX6j/PadWlvA5O/mo4D3qpNCizHhUYXAmW2ySER/4uQVo8ojijpghIzhvtIzfsnXplVF/+g+ygNK2ImGTAXe8e2iOzkkZj2gVZlTZ3zrAK8CRoqALAzOyPxaMnw3lrJrt1bNXoj5Ob9/zDtDY7SeVFW5PTQFvHLMogOt6I6lFzCd55/lLmWmfcSXVTqFDehr7GnBSQGo4PVptUkGV8NqxGB8PhiUiJn249sMaek5QdO9meGe8LG4NFSyJoixmtjO43ltYikRZXlCK75mciBredhooWFw5+KDAnfZ/xHhu1TG4r3IdDqH0bDR3HBzj2a8bRel+R/shivF3SDD91CYwhYKseCAsiV8RHd89D5VLzIpc+WUJpxcTQundAwNEkv3ghgjR4Bq6C+dvWu+vV1HnZVkr+HQK2GnH7c7VUeRp1Gk7eIszS7YGcyX3hnZOtHgLbX61LZw5OglX2DETSPfjbwwfR1p+do4NWf1uzrSpr3Dg0lFKCtEs2mTk887b3ynao9/6iRqYYCskrsbsl0cO1KcbpUHXIaX5eQwB8pHDlv+NHXl7kw84trV3cX9qGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":26225,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":26225,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXYCz1f33dS9y4qvBsE6r","type":"assistant","uuid":"b8af9b38-59aa-401f-808b-c0f870ade269","timestamp":"2026-01-27T16:35:22.680Z"}
{"parentUuid":"b8af9b38-59aa-401f-808b-c0f870ade269","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","message":{"model":"claude-opus-4-5-20251101","id":"msg_01M7AKWpqrkGFrb9eTYz7EjK","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012zeGQREic9iNkA8VSMgWzb","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\globales.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":26225,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":26225,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXYCz1f33dS9y4qvBsE6r","type":"assistant","uuid":"c03f2e07-4f91-457a-936d-f7033e51b580","timestamp":"2026-01-27T16:35:23.147Z"}
{"parentUuid":"c03f2e07-4f91-457a-936d-f7033e51b580","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012zeGQREic9iNkA8VSMgWzb","type":"tool_result","content":"     1→// Mensajes en español para el plugin Select2\n     2→const mensajes_select2 = {\n     3→    'noResults'              : () => { return 'No hay resultados para la búsqueda.'; },\n     4→    'searching'              : () => { return 'Buscando...'; },\n     5→    'Loading'                : () => { return 'Cargando...'; },\n     6→    'loadingMore'            : () => { return 'Cargando más resultados...'; },\n     7→    'dropdownFooter'         : (texto) => { return `Mostrando ${texto} resultados`; },\n     8→    'emptyOptions'           : () => { return 'No hay opciones disponibles.'; },\n     9→    'appendItems'            : (items) => { return `Agregando ${items.length} elementos.`; },\n    10→    'maximumSelectionReached': () => { return 'Se ha alcanzado el número máximo de selecciones.'; },\n    11→    'selectOnClose'          : () => { return 'Seleccione una opción al cerrar el menú.'; },\n    12→    'escapeKeyUp'            : () => { return 'Presione \\'Escape\\' para cerrar el menú.'; },\n    13→    'errorLoading'           : () => { return 'Error al cargar datos. Inténtalo de nuevo más tarde.'; },\n    14→    'inputTooShort'          : (elemento) => { return `Ingresa al menos ${elemento.minimum} caracteres para iniciar una búsqueda.`; },\n    15→    'noMatches'              : () => { return 'No se encontraron coincidencias para tu búsqueda.'; },\n    16→    'allowClear'             : () => { return 'Borrar selección'; },\n    17→    'SelectionTooLong'       : (conteo, maximo) => { return `Solo puedes seleccionar ${maximo} opciones.`; },\n    18→    'loadMore'               : () => { return 'Cargando más resultados...'; },\n    19→    'removing'               : (seleccion) => { return 'Eliminando...'; },\n    20→    'matches'                : (coincidencias, total) => {\n    21→        if (coincidencias === 0) {\n    22→            return 'No hay coincidencias.';\n    23→        } else if (coincidencias === 1) {\n    24→            return 'Se encontró 1 coincidencia.';\n    25→        } else {\n    26→            return `Se encontraron ${coincidencias} coincidencias entre ${total}.`;\n    27→        }\n    28→    }\n    29→};\n    30→\n    31→// audios\n    32→var audio_notificacion = new Audio('/audios/notificacion.mp3');\n    33→\n    34→let mostro_modal_creditos_ia = false;\n    35→let funcion_ejecucion_ia = null;\n    36→let modals_abiertos_ia = null;\n    37→\n    38→let configuraciones_disponibles_empresa = [];\n    39→\n    40→/**\n    41→ * Obtiene las funcionalidades activas del plan vigente de la empresa del usuario actual.\n    42→ *\n    43→ * @param {number|null} tipo_prueba_id ID del tipo de prueba (opcional).\n    44→ * @returns {Promise} Promesa que se resuelve con las funcionalidades activas.\n    45→ * @author Andres Gonzalez\n    46→ */\n    47→function obtenerFuncionalidadesActivasPlan(tipo_prueba_id = null) {\n    48→    let parametros = {};\n    49→\n    50→    if (tipo_prueba_id !== null) {\n    51→        parametros.tipo_prueba_id = tipo_prueba_id;\n    52→    }\n    53→\n    54→    return $.ajax({\n    55→        url: '/funcionalidades-activas-plan',\n    56→        method: 'GET',\n    57→        dataType: 'json',\n    58→        data: parametros,\n    59→        success: function(respuesta) {\n    60→            configuraciones_disponibles_empresa = respuesta?.data ?? [];\n    61→        },\n    62→        error: function(error) {\n    63→            console.error('Error al obtener funcionalidades activas del plan:', error);\n    64→            configuraciones_disponibles_empresa = [];\n    65→        }\n    66→    });\n    67→}\n    68→\n    69→/**\n    70→ * Mostrar modal de créditos IA\n    71→ *\n    72→ * @return void\n    73→ * @author José Manuel Jiménez\n    74→ */\n    75→function mostrarModalCreditosIA(servicio_ia_id) {\n    76→    $.ajax({\n    77→        url: `/empresas/${$('#empresa_sesion_id').val()}/creditos`,\n    78→        method: 'GET',\n    79→        dataType: 'json',\n    80→        success: function(respuesta_empresa) {\n    81→            if (respuesta_empresa?.data?.creditos_disponibles > 0) {\n    82→                $.ajax({\n    83→                    url: `/servicios-ia/${servicio_ia_id}/creditos`,\n    84→                    method: 'GET',\n    85→                    dataType: 'json',\n    86→                    success: function(respuesta) {\n    87→                        if (respuesta?.data?.consume_creditos && respuesta?.data?.consume_creditos <= respuesta_empresa.data.creditos_disponibles) {\n    88→                            $('#cantidad-creditos-descontar-modal').text(respuesta.data.consume_creditos);\n    89→                            $('#modal-consumo-creditos-ia').modal('show');\n    90→                            mostro_modal_creditos_ia = true;\n    91→                            modals_abiertos_ia = $('.modal.show').not('#modal-consumo-creditos-ia').not('#modal-generando-ia');\n    92→                            $(modals_abiertos_ia).addClass('d-none');\n    93→                        } else {\n    94→                            mostrarToastSolicitarCreditosIA();\n    95→                        }\n    96→                    }\n    97→                });\n    98→            } else {\n    99→                mostrarToastSolicitarCreditosIA();\n   100→            }\n   101→        }\n   102→    });\n   103→}\n   104→\n   105→/**\n   106→ * Mostrar toast para solicitar créditos IA\n   107→ *\n   108→ * @return void\n   109→ * @author José Manuel Jiménez\n   110→ */\n   111→function mostrarToastSolicitarCreditosIA() {\n   112→    $.ajax({\n   113→        url: `/empresas/${$('#empresa_sesion_id').val()}`,\n   114→        method: 'GET',\n   115→        dataType: 'json',\n   116→        success: function(respuesta) {\n   117→            let adicional_toast = '';\n   118→            if (respuesta?.data?.ejecutivo?.telefono) {\n   119→                adicional_toast = `<a href=\"https://wa.me/${respuesta.data.ejecutivo.telefono.replace(/\\D/g, '')}?text=Hola,%20me%20gustar%C3%ADa%20solicitar%20cr%C3%A9ditos%20adicionales%20para%20mi%20empresa.\" target=\"_blank\">\n   120→                    <p class=\"text-label-1 text-white no-visited text-decoration-none mb-0\">Solicitar</p>\n   121→                </a>`;\n   122→            }\n   123→            setTimeout(() => {\n   124→                $('#modal-generando-ia').modal('hide');\n   125→                $('#modal-cargue-ia').modal('hide');\n   126→                mostrarToast('danger', 'No cuentas con créditos. Solicita créditos adicionales.', '', adicional_toast);\n   127→            }, 300);\n   128→        }\n   129→    });\n   130→}\n   131→\n   132→/**\n   133→ * Continuar ejecución IA luego del modal de créditos\n   134→ *\n   135→ * @return void\n   136→ * @author José Manuel Jiménez\n   137→ */\n   138→function continuarEjecucionIA() {\n   139→    if (funcion_ejecucion_ia) {\n   140→        funcion_ejecucion_ia();\n   141→        funcion_ejecucion_ia = null;\n   142→    }\n   143→    mostro_modal_creditos_ia = false;\n   144→    $('#modal-consumo-creditos-ia').modal('hide');\n   145→}\n   146→\n   147→/**\n   148→ * Solicitar más créditos IA\n   149→ *\n   150→ * @return void\n   151→ * @author José Manuel Jiménez\n   152→ */\n   153→function solicitarMasCreditosIA() {\n   154→    $.ajax({\n   155→        url: `/empresas/${$('#empresa_sesion_id').val()}`,\n   156→        method: 'GET',\n   157→        dataType: 'json',\n   158→        success: function(respuesta) {\n   159→            if (respuesta?.data?.ejecutivo?.telefono) {\n   160→                window.open(`https://wa.me/${respuesta.data.ejecutivo.telefono.replace(/\\D/g, '')}?text=Hola,%20me%20gustar%C3%ADa%20solicitar%20cr%C3%A9ditos%20adicionales%20para%20mi%20empresa.`, '_blank');\n   161→            } else {\n   162→                mostrarToast('danger', 'No se encontró un ejecutivo asignado a la empresa. Por favor, comunícate con soporte para recargar créditos.');\n   163→            }\n   164→            $('#modal-solicitar-mas-creditos-ia').modal('hide');\n   165→        }\n   166→    });\n   167→}\n   168→\n   169→/**\n   170→ * Validar respuesta de créditos IA\n   171→ *\n   172→ * @return void\n   173→ * @author José Manuel Jiménez\n   174→ */\n   175→function validarRespuestaCreditosIA(error_ia) {\n   176→    if (error_ia == 'No tienes créditos disponibles en este momento. Renueva tu plan o adquiere más créditos para continuar.') {\n   177→        mostrarToastSolicitarCreditosIA();\n   178→        return true;\n   179→    }\n   180→    return false;\n   181→}\n   182→\n   183→/**\n   184→ * Ajustar el ancho de los elementos select2 asincrono multiple.\n   185→ *\n   186→ * @returns {void}\n   187→ * @author Andres Morales\n   188→ */\n   189→$(document).ready(function () {\n   190→    cargarNotificiacionesHeader();\n   191→    if (window.configuracion_reverbg && window.configuracion_reverbg.activar_websocket) {\n   192→        configurarWebSocketNotificaciones();\n   193→    }\n   194→    setTimeout(() => {\n   195→        $(\".input-container\").each(function () {\n   196→            let $container = $(this);\n   197→            let $select = $container.find(\"select[multiple]\");\n   198→            let $icon = $container.find(\".input-icono1\");\n   199→            if ($select.length && $icon.length) {\n   200→                $(this).find('.select2-selection--multiple').addClass('ps-5')\n   201→            }\n   202→        });\n   203→    }, 1000);\n   204→    $('#modal-consumo-creditos-ia').on('hidden.bs.modal', function () {\n   205→        if (mostro_modal_creditos_ia) {\n   206→            $(modals_abiertos_ia).removeClass('d-none');\n   207→        }\n   208→        mostro_modal_creditos_ia = false;\n   209→    });\n   210→\n   211→    // Cargar créditos disponibles si existe el contenedor y el ID de empresa\n   212→    if ($('#contenedor-tag-creditos').length && $('#empresa_sesion_id').length) {\n   213→        obtenerCreditosDisponiblesEmpresa($('#empresa_sesion_id').val());\n   214→    }\n   215→});\n   216→\n   217→/**\n   218→ * Formatear fecha a formato dd/mm/yyyy - hh:mm AM/PM.  Ejemplo: 01/Feb/2022 - 12:00 PM\n   219→ *\n   220→ * @param {string} fecha_entrada fecha en formato ISO\n   221→ * @returns {string} fecha y hora formateada\n   222→ * @author Andres Morales\n   223→ */\n   224→function formatearFecha(fecha_entrada) {\n   225→    var fecha = new Date(fecha_entrada);\n   226→    var dia = fecha.getDate();\n   227→    var mes = fecha.toLocaleString('es-ES', { month: 'short' });\n   228→    var anio = fecha.getFullYear();\n   229→    let hora = fecha.getHours();\n   230→    let minuto = fecha.getMinutes();\n   231→    let ampm = hora >= 12 ? 'PM' : 'AM';\n   232→    hora = hora % 12 || 12;\n   233→    minuto = minuto.toString().padStart(2, '0');\n   234→    return `${dia}/${mes}/${anio} - ${hora}:${minuto} ${ampm}`;\n   235→}\n   236→\n   237→function formatearFecha2(fecha_entrada) {\n   238→    let partes = fecha_entrada.split(' ');\n   239→    let fecha = partes[0].split('-');\n   240→    let hora = partes[1];\n   241→    let fechaISO = `${fecha[2]}-${fecha[1]}-${fecha[0]}T${hora}`;\n   242→\n   243→    let date = new Date(fechaISO);\n   244→\n   245→    if (isNaN(date.getTime())) {\n   246→        return 'Fecha inválida';\n   247→    }\n   248→\n   249→    let dia = date.getDate();\n   250→    let mes = date.toLocaleString('eu-EU', { month: 'short' });\n   251→    let anio = date.getFullYear();\n   252→    return `${dia}/${mes}/${anio}`;\n   253→}\n   254→\n   255→/**\n   256→ * Opción para contraer o agrandar el menú principal\n   257→ *\n   258→ * @returns {void}\n   259→ * @author José Manuel Jiménez\n   260→ * @author Andres Morales\n   261→ */\n   262→function contraerMenu() {\n   263→    if ($('.sidebar-menu').hasClass('close')) {\n   264→        $('.sidebar-menu').removeClass('d-none');\n   265→        localStorage.setItem('opcion_menu_storage', 'abierto');\n   266→        $('#btn-collapse').attr('data-bs-original-title', 'Contraer');\n   267→        $('#btn-collapse').attr('data-bs-title', 'Contraer');\n   268→        $(\".menu-bar\").each(function() {\n   269→            $(this).removeClass(\"px-2\").addClass(\"px-5\");\n   270→        });\n   271→        $('[data-bs-toggle=\"tooltip\"]').each(function () { new bootstrap.Tooltip(this); });\n   272→        $('.lista-primary[data-bs-toggle=\"tooltip\"]').each(function () {\n   273→            var tooltip_instancia = bootstrap.Tooltip.getInstance(this);\n   274→            if (tooltip_instancia) {\n   275→                tooltip_instancia.dispose();\n   276→            }\n   277→        });\n   278→    } else {\n   279→        $('.sidebar-menu').addClass('d-none');\n   280→        localStorage.setItem('opcion_menu_storage', 'cerrado');\n   281→        $('#btn-collapse').attr('data-bs-original-title', 'Expandir');\n   282→        $('#btn-collapse').attr('data-bs-title', 'Expandir');\n   283→        $(\".menu-bar\").each(function() {\n   284→            $(this).removeClass(\"px-5\").addClass(\"px-2\");\n   285→        });\n   286→        $('[data-bs-toggle=\"tooltip\"]').each(function () { new bootstrap.Tooltip(this); });\n   287→    }\n   288→    $('.tooltip.bs-tooltip-auto').remove();\n   289→    $('.sidebar-menu').toggleClass('close');\n   290→    $('.contenedor-vista').toggleClass('close');\n   291→    $('#btn-collapse').toggleClass('close');\n   292→    $('.nombre-usuario-empresa').toggle();\n   293→    $('.menu-bar .text-menu').toggle();\n   294→}\n   295→\n   296→/**\n   297→ * Opción para abrir o cerrar el menu segun la elección guardada\n   298→ *\n   299→ * @returns {void}\n   300→ * @author José Manuel Jiménez\n   301→ * @author Andres Morales\n   302→ */\n   303→function mostrarMenuStorage() {\n   304→    $(document).ready(function() {\n   305→        $('.lista-primary[data-bs-toggle=\"tooltip\"]').each(function () {\n   306→            var tooltip_instancia = bootstrap.Tooltip.getInstance(this);\n   307→            if (tooltip_instancia) {\n   308→                tooltip_instancia.dispose();\n   309→            }\n   310→        });\n   311→\n   312→        if (window.innerWidth < 768) {\n   313→            localStorage.setItem('opcion_menu_storage', 'cerrado');\n   314→        }\n   315→\n   316→        if (localStorage.getItem('opcion_menu_storage') === 'cerrado') {\n   317→            contraerMenu();\n   318→        }\n   319→        let $active = $('.menu-bar .active');\n   320→\n   321→        if ($active.length) {\n   322→            $('.menu-bar').scrollTop($active.position().top);\n   323→        }\n   324→    });\n   325→}\n   326→mostrarMenuStorage();\n   327→\n   328→/**\n   329→ * Funcion para hacer el slug de un texto desde jquery.\n   330→ *\n   331→ * @returns {void}\n   332→ * @author Andres Morales\n   333→ */\n   334→function slugify(text) {\n   335→    return $.trim(text)\n   336→        .toLowerCase()\n   337→        .normalize(\"NFD\")\n   338→        .replace(/[\\u0300-\\u036f]/g, \"\")\n   339→        .replace(/[^a-z0-9 -]/g, \"\")\n   340→        .replace(/\\s+/g, \"-\")\n   341→        .replace(/-+/g, \"-\");\n   342→}\n   343→\n   344→/**\n   345→ * Función generica para mostrar mensajes de respuesta\n   346→ *\n   347→ * @param {string} tipo_alerta define el color de la alerta segun alerts de botstrap.\n   348→ * @param {string} texto_1 Texto que mostrara la alerta.\n   349→ * @param {string} texto_2 Texto secundario en la alerta.\n   350→ * @param {string} accion Acción adicional(por definir).\n   351→ * @returns {void}\n   352→ * @author José Manuel Jiménez\n   353→ * @author Andres Gonzalez\n   354→ */\n   355→function mostrarToast(tipo_alerta, texto_1, texto_2 = '', accion = '', icono2 = '') {\n   356→    let icono = '';\n   357→    let texto_color = 'text-white';\n   358→    if (accion != '') {\n   359→        accion = `<div class=\"col-auto p-0 text-label-1\">${accion}</div>`;\n   360→    }\n   361→\n   362→    if (tipo_alerta == 'success') {\n   363→        icono = 'bi bi-check-circle';\n   364→    }\n   365→\n   366→    if (tipo_alerta == 'neutral') {\n   367→        icono = 'bi bi-info-circle';\n   368→    }\n   369→\n   370→    if (tipo_alerta == 'warning') {\n   371→        icono = 'bi bi-info-circle';\n   372→        texto_color = \"text-red-letras\";\n   373→    }\n   374→\n   375→    if (tipo_alerta == 'danger') {\n   376→        icono = 'bi bi-x-circle';\n   377→    }\n   378→\n   379→    if (icono2 != '') {\n   380→        icono = icono2;\n   381→    }\n   382→\n   383→    if (texto_2 != '') {\n   384→        texto_2 = `<div class=\"col-12 p-0 text-label-1 ${texto_color}\">${texto_2}</div>`;\n   385→    }\n   386→\n   387→    let alert_toast = $(`\n   388→        <div class=\"alert toast-${tipo_alerta} alert-dismissible fade show d-flex align-items-center pe-3 py-3 me-3\" role=\"alert\" style=\"display:none\">\n   389→            <div class=\"col-auto\">\n   390→                <span class=\"${icono} ${texto_color}\"></span>\n   391→            </div>\n   392→            <div class=\"col px-3\">\n   393→                <div class=\"row m-0 ${texto_color}\">\n   394→                    <div class=\"col-12 p-0 text-label-1 ${texto_color}\">\n   395→                        ${texto_1}\n   396→                    </div>\n   397→                    ${texto_2}\n   398→                </div>\n   399→            </div>\n   400→            ${accion}\n   401→            <div class=\"col-auto ms-3 pointer\" data-bs-dismiss=\"alert\">\n   402→                <span class=\"bi bi-x ${texto_color}\"></span>\n   403→            </div>\n   404→        </div>\n   405→    `);\n   406→    $('#contenedor-alert-toast').append(alert_toast);\n   407→    alert_toast.fadeIn();\n   408→    setTimeout(function() {\n   409→        alert_toast.fadeOut();\n   410→        alert_toast.alert('close');\n   411→    }, 5000);\n   412→}\n   413→\n   414→/**\n   415→ * Formatear número.\n   416→ *\n   417→ * @param {number} numero número a formatear\n   418→ * @author Andres Morales\n   419→ */\n   420→function formatearNumero(numero) {\n   421→    return parseInt(numero).toLocaleString('es-ES');\n   422→}\n   423→\n   424→/**\n   425→ * Formatear fecha.\n   426→ *\n   427→ * @param {*} fecha Fecha a formatear.\n   428→ * @param {boolean} incluir_segundos Indica si se debe incluir los segundos en la hora.\n   429→ * @param {string} formato Formato en el que se retornará la fecha.\n   430→ * @param {string} separador Símbolo que se usará para separar días, meses y años.\n   431→ * @returns {Object} Objeto con la fecha y hora formateada.\n   432→ * @author Daniel Beltrán\n   433→ */\n   434→function formatearFechaConceptual(fecha, incluir_segundos = false, formato = 'Ymd', separador = '-') {\n   435→    const NUEVA_FECHA = new Date(fecha);\n   436→    const ANO         = NUEVA_FECHA.getFullYear();\n   437→    const MES         = String(NUEVA_FECHA.getMonth() + 1).padStart(2, '0');\n   438→    const DIA         = String(NUEVA_FECHA.getDate()).padStart(2, '0');\n   439→    const HORAS       = String(NUEVA_FECHA.getHours()).padStart(2, '0');\n   440→    const MINUTOS     = String(NUEVA_FECHA.getMinutes()).padStart(2, '0');\n   441→    const SEGUNDOS    = String(NUEVA_FECHA.getSeconds()).padStart(2, '0');\n   442→\n   443→    let fecha_formateada = `${ANO}${separador}${MES}${separador}${DIA}`;\n   444→\n   445→    if (formato === 'dmY') {\n   446→        fecha_formateada = `${DIA}${separador}${MES}${separador}${ANO}`;\n   447→    }\n   448→\n   449→    return {\n   450→        fecha: fecha_formateada,\n   451→        hora : incluir_segundos ? `${HORAS}:${MINUTOS}:${SEGUNDOS}` : `${HORAS}:${MINUTOS}`\n   452→    };\n   453→}\n   454→\n   455→/**\n   456→ * Formatear fecha a May. 2023.\n   457→ *\n   458→ * @param {string} fechaISO Fecha a formatear.\n   459→ * @returns {string} Objeto con la fecha y hora formateada.\n   460→ * @author Andres Morales\n   461→ */\n   462→function formatearFechaAnioMes(fechaISO) {\n   463→    const fecha = new Date(fechaISO);\n   464→    const opciones = { month: 'short', year: 'numeric' };\n   465→    let fecha_formateada = fecha.toLocaleDateString('es-ES', opciones);\n   466→\n   467→    fecha_formateada = fecha_formateada.replace(\n   468→        /^([a-zñ]+)(\\s\\d{4})$/,\n   469→        (_, mes, anio) => `${mes.charAt(0).toUpperCase() + mes.slice(1)}. ${anio.trim()}`\n   470→    );\n   471→\n   472→    return fecha_formateada;\n   473→}\n   474→\n   475→/**\n   476→ * Formatear un numero a moneda.\n   477→ *\n   478→ * @param {string} valor Numero.\n   479→ * @returns {string} Numero formateado.\n   480→ * @author Andres Morales\n   481→ */\n   482→function formatearMonedaCOP(valor) {\n   483→    return new Intl.NumberFormat('es-CO', {\n   484→        style: 'currency',\n   485→        currency: 'COP',\n   486→        minimumFractionDigits: 0,\n   487→        maximumFractionDigits: 0\n   488→    }).format(valor);\n   489→}\n   490→\n   491→/**\n   492→ * Formatear fecha a un formato d/m/Y hh:mm:ss entendible para el usuario.\n   493→ *\n   494→ * @param {*} fecha_inicial Fecha a formatear.\n   495→ * @returns {String} String con la fecha y hora formateada.\n   496→ * @author José Manuel Jiménez\n   497→ */\n   498→function fechaMostrar(fecha_inicial) {\n   499→    if (!fecha_inicial) {\n   500→        return \"\";\n   501→    }\n   502→    const fecha = new Date(fecha_inicial);\n   503→    if (isNaN(fecha.getTime())) {\n   504→        return \"\";\n   505→    }\n   506→    const dia = String(fecha.getUTCDate()).padStart(2, '0');\n   507→    const mes = String(fecha.getUTCMonth() + 1).padStart(2, '0');\n   508→    const anio = fecha.getUTCFullYear();\n   509→    if (!fecha_inicial.includes(\" \")) {\n   510→        return `${dia}/${mes}/${anio}`;\n   511→    }\n   512→    const horas = String(fecha.getUTCHours()).padStart(2, '0');\n   513→    const minutos = String(fecha.getUTCMinutes()).padStart(2, '0');\n   514→    const segundos = String(fecha.getUTCSeconds()).padStart(2, '0');\n   515→    return `${dia}/${mes}/${anio} ${horas}:${minutos}:${segundos}`;\n   516→}\n   517→\n   518→/**\n   519→ * Descargar Excel.\n   520→ *\n   521→ * @param {string} ruta Ruta desde donde se descarga el archivo.\n   522→ * @param {string} nombre_archivo Nombre del archivo descargado.\n   523→ * @param {boolean} marca_tiempo Indica si el nombre del archivo debe llevar marca de tiempo.\n   524→ * @param {Object} parametros Parámetros a enviar en la petición.\n   525→ * @returns {void}\n   526→ * @author Daniel Beltrán\n   527→ */\n   528→async function descargarExcel(ruta, nombre_archivo, marca_tiempo = true, parametros = {}) {\n   529→    parametros._token = $('meta[name=\"csrf-token\"]').attr('content');\n   530→\n   531→    await $.ajax({\n   532→        type     : 'POST',\n   533→        url      : `/${ruta}`,\n   534→        data     : parametros,\n   535→        xhrFields: {\n   536→            responseType: 'blob'\n   537→        },\n   538→        success: function (respuesta) {\n   539→            // Crear una URL para el Blob\n   540→            let url = window.URL.createObjectURL(respuesta); // 'respuesta' es el Blob\n   541→            let a   = document.createElement('a'); // Crea un nuevo elemento <a> para iniciar la descarga\n   542→            a.href  = url;\n   543→            const fecha_actual     = new Date();\n   544→            const dia              = fecha_actual.getDate();\n   545→            const mes              = fecha_actual.getMonth() + 1;\n   546→            const ano              = fecha_actual.getFullYear();\n   547→            const hora             = fecha_actual.getHours();\n   548→            const minutos          = fecha_actual.getMinutes();\n   549→            const segundos         = fecha_actual.getSeconds();\n   550→            const fecha_formateada = `${dia}${mes}${ano}${hora}${minutos}${segundos}`;\n   551→\n   552→            a.download = marca_tiempo ? `${nombre_archivo}-${fecha_formateada}.xlsx` : `${nombre_archivo}.xlsx`;\n   553→            document.body.appendChild(a);\n   554→            a.click();\n   555→            window.URL.revokeObjectURL(url);\n   556→            document.body.removeChild(a);\n   557→        }\n   558→    }).then(() => {\n   559→        mostrarToast('success', 'Archivo descargado correctamente.');\n   560→    }).catch((error) => {\n   561→        mostrarToast('danger', 'Ocurrió un error al descargar el archivo.');\n   562→    });\n   563→}\n   564→\n   565→/**\n   566→ * Convierte un string a slug.\n   567→ *\n   568→ * @param {string} str\n   569→ * @returns {string}\n   570→ * @author Fahibram Cárcamo\n   571→ */\n   572→function slug(str) {\n   573→\n   574→    // Quita espacios en blanco\n   575→    str = str.replace(/^\\s+|\\s+$/g, \"\")\n   576→\n   577→    // Convierte el string a minusculas\n   578→    str = str.toLowerCase()\n   579→\n   580→    // Quita los caracteres no alfanuméricos\n   581→    str = str.replace(/[^a-z0-9 -]/g, \"\")\n   582→\n   583→    // Reemplaza los espacio con guiones\n   584→    str = str.replace(/\\s+/g, \"-\")\n   585→\n   586→    // Remueve los guiones consecutivos\n   587→    str = str.replace(/-+/g, \"-\")\n   588→\n   589→    return str\n   590→}\n   591→\n   592→/**\n   593→ * Compara los elementos de dos arreglos y retorna `true` si son iguales y `false` en caso contrario\n   594→ * (Este función está pensada para comparar arreglos unidimensionales).\n   595→ *\n   596→ * @param {array} primer_arreglo\n   597→ * @param {array} segundo_arreglo\n   598→ * @param {boolean} comparar_orden\n   599→ * @return {boolean}\n   600→ * @author Fahibram Cárcamo\n   601→ */\n   602→function sonArreglosIguales(primer_arreglo, segundo_arreglo, comparar_orden = false) {\n   603→\n   604→    if (!comparar_orden) {\n   605→        primer_arreglo.sort()\n   606→        segundo_arreglo.sort()\n   607→    }\n   608→\n   609→    if (primer_arreglo.length !== segundo_arreglo.length) return false\n   610→\n   611→    for (let i = 0; i < primer_arreglo.length; i++) {\n   612→        if (primer_arreglo[i] !== segundo_arreglo[i]) return false\n   613→    }\n   614→\n   615→    return true\n   616→}\n   617→\n   618→/**\n   619→ * Función para cambiar de empresa.\n   620→ *\n   621→ * @param {number} empresa_id ID de la empresa a la que se va a cambiar.\n   622→ * @returns {void}\n   623→ * @author José Manuel Jiménez\n   624→ * @author Daniel Beltrán\n   625→ */\n   626→function cambiarEmpresa(empresa_id) {\n   627→    $.ajax({\n   628→        type: 'POST',\n   629→        url: '/suplantar-rol-admin-general',\n   630→        data: {\n   631→            _token    : $('meta[name=\"csrf-token\"]').attr('content'),\n   632→            empresa_id: empresa_id\n   633→        },\n   634→        success: function (respuesta) {\n   635→            localStorage.setItem('notificacionToast', JSON.stringify({\n   636→                tipo_alerta: 'success',\n   637→                texto_1    : 'Cambio de empresa exitoso'\n   638→            }));\n   639→\n   640→            window.location.reload();\n   641→        },\n   642→        error: function (error) {\n   643→            mostrarToast('danger', 'Ocurrió un error al cambiar de empresa');\n   644→        }\n   645→    });\n   646→}\n   647→\n   648→/**\n   649→ * Enviar la solucitud de suplantación de rol y empresa al Back-end.\n   650→ *\n   651→ * @param {function|null} callback_exito Callback ejecutado en caso de éxito.\n   652→ * @param {string} url URL de suplantación.\n   653→ * @param {string} _token Token CSRF del formulario.\n   654→ * @param {number} empresa_id Id de la empresa a suplantar.\n   655→ * @param {number|null} rol_id Id del rol a suplantar.\n   656→ * @param {function|null} callback_error Callback ejecutado en caso de error.\n   657→ * @returns {void}\n   658→ * @author Fahibram Cárcamo\n   659→ */\n   660→async function enviarOrdenSuplantacionRolEmpresa (callback_exito, url, _token, empresa_id = null, rol_id = null, callback_error = null) {\n   661→\n   662→    let condicion_suplantacion = rol_id === null\n   663→        ? empresa_id === null\n   664→            ? true\n   665→            : parseInt($('#empresa_sesion_id').val()) !== parseInt(empresa_id)\n   666→        : parseInt($('#rol_sesion_id').val()) !== parseInt(rol_id) && parseInt($('#empresa_sesion_id').val()) !== parseInt(empresa_id);\n   667→\n   668→    if (condicion_suplantacion) {\n   669→        let data = { _token };\n   670→        if (empresa_id !== null) data.empresa_id = empresa_id;\n   671→        if (rol_id !== null) data.rol_id = rol_id;\n   672→\n   673→        await $.ajax({ type: 'POST', url, data })\n   674→            .then((respuesta, status, xhr) => {\n   675→                if (xhr.status >= 200 && xhr.status < 300 && callback_exito !== null) callback_exito();\n   676→            })\n   677→            .catch(error => {\n   678→                let swal_titulo, swal_texto;\n   679→\n   680→                if (error.status === 404) {\n   681→                    if (error.responseJSON.mensaje) {\n   682→                        swal_titulo = 'Algo salió mal';\n   683→                        if (error.responseJSON.mensaje === 'no existe rol_suplantar') {\n   684→                            swal_texto = 'El rol no existe.';\n   685→                        } else if (error.responseJSON.mensaje === 'no existe empresa_suplantar') {\n   686→                            swal_texto = 'La empresa no existe.';\n   687→                        } else if (error.responseJSON.mensaje === 'no existe usuario_suplantar') {\n   688→                            swal_texto = 'El usuario no existe.';\n   689→                        } else {\n   690→                            swal_texto = '';\n   691→                        }\n   692→                    } else if (error.responseJSON.empresa && error.responseJSON.rol) {\n   693→                        swal_titulo = 'No fué posible cambiar de empresa';\n   694→                        swal_texto = error.responseJSON.rol === 'Administrador general' || error.responseJSON.rol === 'Propietario'\n   695→                            ? `La empresa ${error.responseJSON.empresa} no tiene ningún usuario con el rol Administrador general o Propietario.`\n   696→                            : `La empresa ${error.responseJSON.empresa} no tiene ningún usuario con el rol ${error.responseJSON.rol}.`;\n   697→                    } else {\n   698→                        swal_titulo = 'Algo salió mal';\n   699→                        swal_texto = error.responseJSON.errors;\n   700→                    }\n   701→                } else {\n   702→                    swal_titulo = 'Algo salió mal';\n   703→                    swal_texto = '';\n   704→                }\n   705→\n   706→                if (callback_error !== null) callback_error();\n   707→\n   708→                Swal.fire({\n   709→                    title: swal_titulo,\n   710→                    text: swal_texto,\n   711→                    icon: \"error\",\n   712→                    confirmButtonText: \"Aceptar\"\n   713→                });\n   714→            });\n   715→    }\n   716→}\n   717→\n   718→/**\n   719→ * Mostrar tooltip según el div que lo contenga.\n   720→ *\n   721→ * @param {div} div Elemento en donde se va a mostrar el tooltip.\n   722→ * @returns {void}\n   723→ * @author Sol Espitia\n   724→ */\n   725→function mostrarTooltip(div) {\n   726→    const TOOLTIP         = div.querySelector('.tooltip-x');\n   727→    TOOLTIP.style.display = 'block';\n   728→}\n   729→\n   730→/**\n   731→ * Ocultar tooltip según el div que lo contenga.\n   732→ *\n   733→ * @param {div} div Elemento en donde se va a mostrar el tooltip.\n   734→ * @returns {void}\n   735→ * @author Sol Espitia\n   736→ */\n   737→function ocultarTooltip(div) {\n   738→    const TOOLTIP         = div.querySelector('.tooltip-x');\n   739→    TOOLTIP.style.display = 'none';\n   740→}\n   741→\n   742→/**\n   743→ * Retornar la diferencia en días de dos fechas dadas.\n   744→ *\n   745→ * @param {string} fecha_inicial Fecha inicial\n   746→ * @param {string} fecha_final Fecha final\n   747→ * @param {bool} valor_absoluto Retorna la diferencia en valor absoluto\n   748→ * @returns {number}\n   749→ * @author Fahibram Cárcamo\n   750→ * @author Andres Morales\n   751→ */\n   752→function diferenciaFechasDias(fecha_inicial, fecha_final, valor_absoluto = false, sumar_dia = true) {\n   753→    let fecha1 = new Date(fecha_inicial);\n   754→    let fecha2 = new Date(fecha_final);\n   755→\n   756→    fecha1.setHours(0, 0, 0, 0);\n   757→    fecha2.setHours(0, 0, 0, 0);\n   758→\n   759→    let diferencia_milisegundos = fecha2.getTime() - fecha1.getTime();\n   760→\n   761→    let diferencia_dias = diferencia_milisegundos / (1000 * 60 * 60 * 24);\n   762→    let resultado = diferencia_dias;\n   763→    if (sumar_dia) {\n   764→        resultado = diferencia_dias + 1;\n   765→    }\n   766→\n   767→    return valor_absoluto ? Math.abs(resultado) : resultado;\n   768→}\n   769→\n   770→/**\n   771→ * Retornar `true` si una fecha dada está dentro de un rango de fechas dadas, `false` en otro caso.\n   772→ *\n   773→ * @param {string} fecha Fecha dada\n   774→ * @param {string} fecha_desde Fecha inicial del rango\n   775→ * @param {string} fecha_hasta Fecha final del rango\n   776→ * @returns {boolean}\n   777→ * @author Fahibram Cárcamo\n   778→ */\n   779→function fechaDentroDelRango(fecha, fecha_desde, fecha_hasta) {\n   780→    fecha = new Date(fecha);\n   781→    fecha_desde = new Date(fecha_desde);\n   782→    fecha_hasta = new Date(fecha_hasta);\n   783→\n   784→    if (isNaN(fecha) || isNaN(fecha_desde) || isNaN(fecha_hasta)) {\n   785→        throw new Error('Una o más fechas no son válidas.');\n   786→    }\n   787→\n   788→    return fecha >= fecha_desde && fecha <= fecha_hasta;\n   789→}\n   790→\n   791→/**\n   792→ * Descuenta el tiempo para las respuestas.\n   793→ *\n   794→ * @param id - ID del elemento HTML donde mostrar el tiempo\n   795→ * @param tiempo - Tiempo inicial en segundos\n   796→ * @author Jair Carvajal\n   797→ */\n   798→var tiempos_usados = {};\n   799→\n   800→function descuentoTiempo(id, tiempo, callback, onTick) {\n   801→    var $elemento = $('#' + id);\n   802→    if ($elemento.length === 0) {\n   803→        console.error('Elemento con id \"' + id + '\" no encontrado.');\n   804→        return;\n   805→    }\n   806→    if (tiempos_usados[id]) {\n   807→        clearInterval(tiempos_usados[id]);\n   808→    }\n   809→    let tiempoTotal = tiempo;\n   810→    tiempos_usados[id] = setInterval(function() {\n   811→        if (tiempo <= 0) {\n   812→            clearInterval(tiempos_usados[id]);\n   813→            delete tiempos_usados[id];\n   814→            $elemento.text('Tiempo finalizado');\n   815→            if (window.tiempoFinalizado()) {\n   816→                tiempoFinalizado();\n   817→            }\n   818→            if (typeof callback === 'function') {\n   819→                callback();\n   820→            }\n   821→            return;\n   822→        }\n   823→\n   824→        var minutos = Math.floor(tiempo / 60);\n   825→        var segundos = tiempo % 60;\n   826→\n   827→        var textoTiempo = minutos + ':' + (segundos < 10 ? '0' : '') + segundos + '<i class=\"bi bi-alarm ms-2\"></i>';\n   828→\n   829→        if (tiempo <= 15) {\n   830→            $elemento.addClass('text-state-red');\n   831→            $elemento.removeClass('text-state-green');\n   832→        } else {\n   833→            $elemento.addClass('text-state-green');\n   834→            $elemento.removeClass('text-state-red');\n   835→        }\n   836→\n   837→        $elemento.html(textoTiempo);\n   838→\n   839→        var tiempoUsado = tiempoTotal - tiempo;\n   840→\n   841→        if (typeof onTick === 'function') {\n   842→            onTick((tiempoUsado % 5));\n   843→        }\n   844→        tiempo--;\n   845→    }, 1000);\n   846→}\n   847→\n   848→/**\n   849→ * Detengo el tiempo para las respuestas.\n   850→ *\n   851→ * @param id - ID del elemento HTML donde mostrar el tiempo\n   852→ * @param tiempo - Tiempo inicial en segundos\n   853→ * @author Jair Carvajal\n   854→ */\n   855→function detenerDescuentoTiempo(id) {\n   856→    if (tiempos_usados[id]) {\n   857→        clearInterval(tiempos_usados[id]);\n   858→        delete tiempos_usados[id];\n   859→    }\n   860→}\n   861→\n   862→/**\n   863→ * Genera un SVG de la imagen de usuario.\n   864→ *\n   865→ * @param id ID del usuario.\n   866→ * @param nombres Nombres del usuario.\n   867→ * @param apellidos Apellidos del usuario.\n   868→ * @return image\n   869→ * @author Andres Morales\n   870→ */\n   871→function crearImagenUsuarioLetras(id, nombres, apellidos) {\n   872→    var tamano = 200;\n   873→    var iniciales = (nombres[0] + apellidos[0]).toUpperCase();\n   874→    var hash = md5(id);\n   875→\n   876→    var r = parseInt(hash.substring(0, 2), 16);\n   877→    var g = parseInt(hash.substring(2, 4), 16);\n   878→    var b = parseInt(hash.substring(4, 6), 16);\n   879→    var colorFondo = `rgb(${r},${g},${b})`;\n   880→\n   881→    var luminancia = 0.299 * r + 0.587 * g + 0.114 * b;\n   882→    var colorTexto = luminancia > 150 ? \"#000000\" : \"#FFFFFF\";\n   883→\n   884→    // SVG como texto\n   885→    var svg = `\n   886→    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${tamano}\" height=\"${tamano}\">\n   887→        <rect width=\"100%\" height=\"100%\" fill=\"${colorFondo}\" />\n   888→        <text x=\"50%\" y=\"50%\" dy=\".35em\"\n   889→            text-anchor=\"middle\"\n   890→            font-family=\"Lato, sans-serif\"\n   891→            font-size=\"${tamano * 0.4}\"\n   892→            fill=\"${colorTexto}\">\n   893→            ${iniciales}\n   894→        </text>\n   895→    </svg>`;\n   896→    var svgEncoded = encodeURIComponent(svg)\n   897→        .replace(/'/g, \"%27\")\n   898→        .replace(/\"/g, \"%22\");\n   899→\n   900→    var dataUri = `data:image/svg+xml,${svgEncoded}`;\n   901→    return dataUri;\n   902→}\n   903→\n   904→/**\n   905→ * Carga las notificaciones\n   906→ *\n   907→ * @return void\n   908→ * @author Andres Morales\n   909→ * @author Andres Gonzalez\n   910→ * @author Esperanza Olivo\n   911→ */\n   912→function cargarNotificiacionesHeader() {\n   913→    $.ajax({\n   914→        url: '/usuario-notificaciones',\n   915→        type: 'GET',\n   916→        dataType: 'json',\n   917→        success: function(respuesta) {\n   918→            let datos = respuesta.data;\n   919→            let notificaciones_noleidas = datos?.unread_notifications?.length ?? 0;\n   920→\n   921→            // Siempre remover el badge existente\n   922→            $('#dropdownNotificaciones #badge-notificaciones').remove();\n   923→\n   924→            // Solo agregar el badge si hay notificaciones no leídas\n   925→            if (notificaciones_noleidas > 0) {\n   926→                $('#dropdownNotificaciones').append(`<span id=\"badge-notificaciones\" class=\"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-white\">${notificaciones_noleidas}</span>`);\n   927→                $('#contador-notificaciones-abierto').append(`<span id=\"badge-notificaciones\" class=\"badge rounded-pill bg-danger border border-white\">${notificaciones_noleidas}</span>`);\n   928→\n   929→                $('#contenedor-boton-marcar-todas').html(`\n   930→                    <button class=\"btn btn-link text-primary w-100 d-flex justify-content-center\" onclick=\"marcarNotificacionesLeidas('all')\">\n   931→                        Marcar todo como leído\n   932→                    </button>\n   933→                `);\n   934→            }\n   935→\n   936→            const NO_LEIDOS_IDS = new Set(Array.isArray(datos?.unread_notifications) ? datos.unread_notifications.map(notificacion => notificacion.id) : []);\n   937→\n   938→            if (Array.isArray(datos?.notifications) && datos.notifications.length > 0) {\n   939→                $('#notificacion-sinnotificaciones').hide();\n   940→                $('.notificaciones-listado').remove();\n   941→                datos.notifications.forEach(notificacion => {\n   942→                    const { id, data, updated_at } = notificacion;\n   943→\n   944→                    const NO_LEIDO = NO_LEIDOS_IDS.has(id);\n   945→                    const MENSAJE = (data?.mensaje || '').slice(0, 120) + '...';\n   946→                    const HORA = new Date(updated_at).toLocaleTimeString('es-CO', {\n   947→                        hour: '2-digit',\n   948→                        minute: '2-digit',\n   949→                        hour12: false\n   950→                    });\n   951→\n   952→                    const notificaciones = `\n   953→                        <li class=\"${NO_LEIDO ? '' : 'bg-gray-90'} notificaciones-listado py-0\" id=\"notificacion-${id}\">\n   954→                            <a class=\"dropdown-item text-gray-10 text-decoration-none border-top pt-0 pb-1\" href=\"javascript:void(0)\" onclick=\"marcarNotificacionesLeidas('${id}','${data?.ruta}')\">\n   955→                                <div class=\"d-flex justify-content-between\">\n   956→                                    <div class=\"w-auto flex-grow-1 pe-3\">\n   957→                                        <p class=\"mt-1 mb-0 text-headline-6 text-gray-10\">${data?.titulo}</p>\n   958→                                        <p class=\"mb-0 text-body-3 text-gray-30 notificacion-mensaje\">${MENSAJE}</p>\n   959→                                    </div>\n   960→                                    <div class=\"w-auto my-auto ${NO_LEIDO ? 'text-cta-azul' : 'text-gray-10'} text-label-2 flex-shrink-0\">\n   961→                                        ${HORA}${NO_LEIDO ? `<i class=\"bi bi-circle-fill text-cta-azul my-auto texto-notificacion-icono ms-3\"></i>` : ''}\n   962→                                    </div>\n   963→                                </div>\n   964→                            </a>\n   965→                        </li>\n   966→                    `;\n   967→\n   968→                    $(notificaciones).insertBefore('#contenedor-boton-marcar-todas');\n   969→                });\n   970→\n   971→            } else {\n   972→                $('#notificacion-sinnotificaciones').hide();\n   973→                $('.notificaciones-listado').remove();\n   974→            }\n   975→\n   976→        },\n   977→        error: function(xhr, status, error) {\n   978→            console.error('Error al cargar notificaciones:', error);\n   979→        }\n   980→    });\n   981→}\n   982→\n   983→/**\n   984→ * Marcar las notificaciones leídas.\n   985→ *\n   986→ * @param {array} notificaciones_ids ids de las notificaciones\n   987→ * @param {string} ruta_destino ruta donde se va ha actualizar la pagina\n   988→ * @returns {void}\n   989→ * @author Andres Gonzalez\n   990→ * @author Esperanza Olivo\n   991→ */\n   992→function marcarNotificacionesLeidas(notificaciones_ids = null, ruta_destino = null, soporte_id = null) {\n   993→\n   994→    let data = {\n   995→        _token: $('meta[name=\"csrf-token\"]').attr('content')\n   996→    };\n   997→\n   998→    if (notificaciones_ids === 'all') {\n   999→        data.marcar_todo = true;\n  1000→    } else if (soporte_id) {\n  1001→        data.soporte_id = soporte_id;\n  1002→    } else if (notificaciones_ids) {\n  1003→        data.notificaciones_ids = Array.isArray(notificaciones_ids)\n  1004→            ? notificaciones_ids\n  1005→            : [notificaciones_ids];\n  1006→    }\n  1007→\n  1008→    $.ajax({\n  1009→        url: '/usuario-marcar-notificaciones-leidas',\n  1010→        type: 'POST',\n  1011→        data: data,\n  1012→        success: function(respuesta) {\n  1013→            cargarNotificiacionesHeader();\n  1014→\n  1015→            if (notificaciones_ids && notificaciones_ids !== 'all' && ruta_destino) {\n  1016→                window.location.href = \"/\" + ruta_destino;\n  1017→            }\n  1018→\n  1019→            if (notificaciones_ids === 'all') {\n  1020→                $('#badge-notificaciones').remove();\n  1021→                $('#contenedor-boton-marcar-todas').empty();\n  1022→                $('.notificaciones-listado').addClass('bg-gray-90');\n  1023→                $('.bi-circle-fill').remove();\n  1024→            }\n  1025→        },\n  1026→        error: function(xhr, estatus, error) {\n  1027→            console.error('Error al cargar notificaciones:', error);\n  1028→        }\n  1029→    });\n  1030→}\n  1031→\n  1032→/**\n  1033→ * Configurar WebSocket para notificaciones en tiempo real\n  1034→ *\n  1035→ * @return void\n  1036→ * @author Andres Gonzalez\n  1037→ */\n  1038→function configurarWebSocketNotificaciones() {\n  1039→    try {\n  1040→        if (!window.configuracion_reverbg) {\n  1041→            return;\n  1042→        }\n  1043→\n  1044→        const PUSHER = new Pusher(window.configuracion_reverbg.appKey, {\n  1045→            wsHost: window.configuracion_reverbg.host,\n  1046→            wsPort: window.configuracion_reverbg.port,\n  1047→            wssPort: window.configuracion_reverbg.port,\n  1048→            cluster: 'mt1',\n  1049→            forceTLS: false,\n  1050→            enabledTransports: ['ws', 'wss'],\n  1051→            authEndpoint: '/broadcasting-auth',\n  1052→            auth: {\n  1053→                headers: {\n  1054→                    'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n  1055→                }\n  1056→            }\n  1057→        });\n  1058→\n  1059→        PUSHER.connection.bind('failed', function() {\n  1060→            console.error('❌ Conexión WebSocket falló');\n  1061→        });\n  1062→\n  1063→        PUSHER.connection.bind('error', function(error) {\n  1064→            console.error('❌ Error de WebSocket:', error);\n  1065→        });\n  1066→\n  1067→        let usuario_id = window.configuracion_reverbg.usuario_id;\n  1068→\n  1069→        if (!usuario_id) {\n  1070→            return;\n  1071→        }\n  1072→\n  1073→        const NOMBRE_CANAL = `private-App.Models.Usuarios.User.${usuario_id}`;\n  1074→        const CANAL = PUSHER.subscribe(NOMBRE_CANAL);\n  1075→\n  1076→        CANAL.bind('pusher:subscription_error', function(error) {\n  1077→            console.error('❌ Error al suscribirse al canal:', error);\n  1078→        });\n  1079→\n  1080→        // Escuchar eventos específicos de notificaciones\n  1081→        CANAL.bind('Illuminate\\\\Notifications\\\\Events\\\\BroadcastNotificationCreated', function(data) {\n  1082→            if (data.tipo === 'nueva_notificacion') {\n  1083→                audio_notificacion.play();\n  1084→                cargarNotificiacionesHeader();\n  1085→            }\n  1086→\n  1087→            if (data.tipo === 'nuevo_mensaje') {\n  1088→                if (($('#soporte-guardado-id').val() == data.soporte_id) || ($('#soporte_empresa_id').val() == data.soporte_id)) {\n  1089→                    audio_notificacion.play();\n  1090→                    consultarChat(data.soporte_id);\n  1091→                }\n  1092→            }\n  1093→        });\n  1094→    } catch (error) {\n  1095→        console.error('💥 Error en configurarWebSocketNotificaciones:', error);\n  1096→        console.error('Stack trace:', error.stack);\n  1097→    }\n  1098→}\n  1099→\n  1100→/**\n  1101→ * Retornar el string entrante en formato title case.\n  1102→ *\n  1103→ * @param {string} texto\n  1104→ * @returns {string}\n  1105→ * @author Fahibram Cárcamo\n  1106→ */\n  1107→function titleCase(texto) {\n  1108→    return texto.toLowerCase().replace(/\\b\\w/g, caracter => caracter.toUpperCase());\n  1109→}\n  1110→\n  1111→/**\n  1112→ * Número de horas que durará el almacenamiento de la variable `ulitmas_empresas` en el\n  1113→ * almacenamiento local **LocalStorage**.\n  1114→ *\n  1115→ * @var {number}\n  1116→ * @author Fahibram Cárcamo\n  1117→ */\n  1118→const CANTIDAD_HORAS_VENCIMIENTO_ULTIMAS_EMPRESAS_LOCALSTORAGE = 6;\n  1119→\n  1120→/**\n  1121→ * Validar si ya debe removerse la variable `ultimas_empresas` del alamacenamiento local\n  1122→ * **LocalStorage**, si no es tiempo de eliminarla entonces se reinicia el tiempo de vigencia de la\n  1123→ * variable.\n  1124→ *\n  1125→ * @returns {void}\n  1126→ * @author Fahibram Cárcamo\n  1127→ */\n  1128→function validarYActualizarUltimasEmpresasLocalStorage() {\n  1129→    let fecha_hora_actuales = moment();\n  1130→    let fecha_hora_vencimiento_ultimas_empresas = fecha_hora_actuales.clone().add(CANTIDAD_HORAS_VENCIMIENTO_ULTIMAS_EMPRESAS_LOCALSTORAGE, 'hours');\n  1131→    let fecha_hora_vencimiento_ultimas_empresas_localstorage = localStorage.getItem('vencimiento_ultimas_empresas');\n  1132→    let ultimas_empresas = localStorage.getItem('ultimas_empresas');\n  1133→\n  1134→    if (\n  1135→        ultimas_empresas != null &&\n  1136→        fecha_hora_vencimiento_ultimas_empresas_localstorage != null &&\n  1137→        fecha_hora_actuales.clone().isBefore(moment(fecha_hora_vencimiento_ultimas_empresas_localstorage).clone())\n  1138→    ) {\n  1139→        localStorage.setItem('vencimiento_ultimas_empresas', fecha_hora_vencimiento_ultimas_empresas.format('YYYY-MM-DD HH:mm:ss'));\n  1140→        return;\n  1141→    }\n  1142→\n  1143→    localStorage.removeItem('vencimiento_ultimas_empresas');\n  1144→    localStorage.removeItem('ultimas_empresas');\n  1145→}\n  1146→\n  1147→/**\n  1148→ * Obtener la edad actual de un usuario según su fecha de nacimiento.\n  1149→ *\n  1150→ * @param {string} fecha_nacimiento\n  1151→ * @returns {string}\n  1152→ * @author José Manuel Jiménez\n  1153→ * @author Fahibram Cárcamo\n  1154→ * @author Andres Morales\n  1155→ */\n  1156→function obtenerEdad(fecha_nacimiento) {\n  1157→    if (!fecha_nacimiento) return \"N/A\";\n  1158→    let hoy = new Date();\n  1159→    let nacimiento = new Date(fecha_nacimiento);\n  1160→    let edad = hoy.getFullYear() - nacimiento.getFullYear();\n  1161→    let mes = hoy.getMonth() - nacimiento.getMonth();\n  1162→    if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) edad--;\n  1163→    return edad + \" años\";\n  1164→}\n  1165→\n  1166→/**\n  1167→ * Restablecer un input de tipo file.\n  1168→ *\n  1169→ * @param {html} elemento_input_html Elemento input html.\n  1170→ * @param {html} label_elemento_input_html Label del elemento input html.\n  1171→ * @param {html} boton_eliminar_elemento_input_html Botón para eliminar archivo del elemento input html.\n  1172→ * @author Fahibram Cárcamo\n  1173→ */\n  1174→function reiniciarCampoArchivo(elemento_input_html, label_elemento_input_html, boton_eliminar_elemento_input_html) {\n  1175→    elemento_input_html.val('');\n  1176→    elemento_input_html.removeAttr('data-base64');\n  1177→    label_elemento_input_html.text('Ningún archivo seleccionado');\n  1178→    boton_eliminar_elemento_input_html.hide();\n  1179→\n  1180→    if (elemento_input_html.data('imagen')) {\n  1181→        $('#' + elemento_input_html.data('imagen')).val('');\n  1182→        $('#' + elemento_input_html.data('imagen') + '_previsualizacion').attr('src', '');\n  1183→        $('#' + elemento_input_html.data('imagen') + '_fondo_previsualizacion').removeClass('d-none');\n  1184→    }\n  1185→}\n  1186→\n  1187→/**\n  1188→ * Definir un campo destinado a recibir un número de teléfono celular.\n  1189→ *\n  1190→ * Esta función debe llamarse en el evento ready del objeto global document:\n  1191→ * `$(document).ready(...)`. Ademas debe incluirse un pequeño fragmento de código en la función\n  1192→ * `validacionAdicional` para que se agregué el código del número de celular al valor de campo\n  1193→ * cuando se envíe el formulario donde se encutra el campo.\n  1194→ *\n  1195→ * ```\n  1196→ * if (\n  1197→ *   $('#input_celular_id').length &&\n  1198→ *   $('#input_celular_id').val() !== '' &&\n  1199→ *   input_celular.getNumber() !== ''\n  1200→ * ) {\n  1201→ *   $('#input_celular_id').val(input_celular.getNumber().slice(1));\n  1202→ * }\n  1203→ * ```\n  1204→ *\n  1205→ * Donde `input_celular` es el objeto retornado por esta función.\n  1206→ *\n  1207→ * @param {string} input_celular_id Id del campo.\n  1208→ * @param {string} nombre_input_celular Nombre del campo.\n  1209→ * @param {string} placeholder_input_celular Placeholder del campo.\n  1210→ * @param {boolean} obligatorio El campo es obligatorio en el formulario.\n  1211→ * @returns {object}\n  1212→ * @author Fahibram Cárcamo\n  1213→ */\n  1214→function definirInputTipoCelular(input_celular_id, nombre_input_celular, placeholder_input_celular, obligatorio = true) {\n  1215→    /**\n  1216→     * 🌎 Campo para ingresar un número de telefono con selectór de código de país con banderas.\n  1217→     * Este componente se creó con la librería International Telephone Input\n  1218→     * (https://intl-tel-input.com).\n  1219→     *\n  1220→     * La linea hiddenInput: () => ({ phone: 'celular_contacto' }) tiene como función establecer el\n  1221→     * nombre del campo, es decir, la llave del par llave-valor que se adjuntará en los datos del\n  1222→     * formulario cuando se envíe, en este caso 'celular_contacto'.\n  1223→     *\n  1224→     * Las lienas autoPlaceholder: 'aggressive' y\n  1225→     * customPlaceholder: (placeholder, country) => 'Celular*' se usan para definir el placeholder\n  1226→     * del campo.\n  1227→     *\n  1228→     * Con $('#celular_contacto').attr('required', true); se establece el campo como requerido\n  1229→     * dentro del formulario, se hace de esta forma porque la librería no admite el atributo\n  1230→     * required directamente en el componente html.\n  1231→     *\n  1232→     * @author Fahibram Cárcamo\n  1233→     */\n  1234→    if (document.querySelector(`#${input_celular_id}`)) {\n  1235→        const dropdown_dinamico = document.createElement('div');\n  1236→        document.body.appendChild(dropdown_dinamico);\n  1237→\n  1238→        let campo_celular = window.intlTelInput(document.querySelector(`#${input_celular_id}`), {\n  1239→            nationalMode: true,\n  1240→            initialCountry: 'co',\n  1241→            separateDialCode: true,\n  1242→            autoInsertDialCode: false,\n  1243→            autoPlaceholder: 'aggressive',\n  1244→            dropdownContainer: dropdown_dinamico,\n  1245→            customPlaceholder: (placeholder, country) => placeholder_input_celular,\n  1246→            loadUtils: () => import('https://cdn.jsdelivr.net/npm/intl-tel-input@25.4.2/build/js/utils.js'),\n  1247→            onlyCountries: [\n  1248→                'CO', // Colombia\n  1249→                'EC', // Ecuador\n  1250→                'AR', // Argentina\n  1251→                'CL', // Chile\n  1252→                'VE', // Venezuela\n  1253→                'PE', // Perú\n  1254→                'BO', // Bolivia\n  1255→                'UY', // Uruguay\n  1256→                'PY', // Paraguay\n  1257→                'PA', // Panamá\n  1258→                'MX', // México\n  1259→                'CR', // Costa Rica\n  1260→                // 'PR', // Puerto Rico\n  1261→                'CU', // Cuba\n  1262→                // 'DO', // República Dominicana\n  1263→                'SV', // El Salvador\n  1264→                'GT', // Guatemala\n  1265→                'HN', // Honduras\n  1266→                'NI', // Nicaragua\n  1267→                'ES', // España\n  1268→                'US', // Estados Unidos\n  1269→                'GQ'  // Guinea Ecuatorial\n  1270→            ]\n  1271→        });\n  1272→\n  1273→        if (obligatorio) $(`#${input_celular_id}`).attr('required', true);\n  1274→\n  1275→        return campo_celular;\n  1276→    }\n  1277→\n  1278→    return null;\n  1279→}\n  1280→\n  1281→/**\n  1282→ * Establece la validación adicional que se aplica a un campo de tipo celular antes de enviar sus\n  1283→ * datos en un formulario.\n  1284→ *\n  1285→ * @param {HTMLInputElement} input Elemento HTML del campo de tipo celular.\n  1286→ * @param {string} input_id Id del elemento HTML del campo de tipo celular.\n  1287→ * @author Fahibram Cárcamo\n  1288→ * @author Jair Carvajal\n  1289→ */\n  1290→function validacionAdicionalInputTipoCelular(input, input_id) {\n  1291→    let numero_completo = input.getNumber();\n  1292→    let indicativo = '+' + input.getSelectedCountryData().dialCode;\n  1293→    let codigo_iso2_pais = input.getSelectedCountryData().iso2;\n  1294→    let numero_sin_indicativo = numero_completo.replace(indicativo, '');\n  1295→    $(`#indicativo_${input_id}`).val(indicativo);\n  1296→    $(`#codigo_iso2_pais_${input_id}`).val(codigo_iso2_pais);\n  1297→    $(`#${input_id}`).val(numero_sin_indicativo);\n  1298→}\n  1299→\n  1300→/**\n  1301→ * Rellenar un input de tipo celular.\n  1302→ *\n  1303→ * @param {string} indicativo_celular Código del país del número de celular.\n  1304→ * @param {string} codigo_pais_iso2 Código ISO2 del país del número de celular.\n  1305→ * @param {string} numero_celular Número de celular sin código de país.\n  1306→ * @param {string} input_celular_id ID del input de tipo celular.\n  1307→ * @param {HTMLInputElement} input_celular Input de tipo celular.\n  1308→ * @returns {void}\n  1309→ * @author Daniel Beltrán\n  1310→ * @author Fahibram Cárcamo\n  1311→ */\n  1312→function rellenarInputCelular(indicativo_celular, codigo_pais_iso2, numero_celular, input_celular_id, input_celular) {\n  1313→    $(`#${input_celular_id}`).val(numero_celular);\n  1314→    if (![null, undefined].includes(codigo_pais_iso2)) input_celular.setCountry(codigo_pais_iso2);\n  1315→}\n  1316→\n  1317→/**\n  1318→ * Convierte imágenes de base64 a Blob.\n  1319→ *\n  1320→ * @param {string} cadena_base_64 Base 64 de la imagen.\n  1321→ * @returns {Promise<Array>}\n  1322→ * @author Andres Gonzalez\n  1323→ */\n  1324→function imagenBase64Blob(cadena_base_64) {\n  1325→    if (!cadena_base_64 || !cadena_base_64.startsWith('data:image')) return null;\n  1326→    let datos_base_64 = cadena_base_64.split(',')[1];\n  1327→    let tipo_mime = cadena_base_64.match(/data:(.*?);base64/)[1];\n  1328→    let caracteres_binarios = atob(datos_base_64);\n  1329→    let arreglo_bytes = new Array(caracteres_binarios.length).fill(0).map((_, i) => caracteres_binarios.charCodeAt(i));\n  1330→    let bytes_uint8 = new Uint8Array(arreglo_bytes);\n  1331→    return new Blob([bytes_uint8], { type: tipo_mime });\n  1332→}\n  1333→\n  1334→\n  1335→/**\n  1336→ * Limpiar estructuras html innecesarias en el check editor.\n  1337→ *\n  1338→ * @param {string} html - Cadena HTML generada por CKEditor a limpiar\n  1339→ * @returns {string} HTML limpio sin elementos específicos de CKEditor\n  1340→ * @author Andres Gonzalez\n  1341→ * @author Jair Carvajal\n  1342→ */\n  1343→function limpiarHTMLCKEditor(html) {\n  1344→    // Remover todos los elementos con clases de CKEditor\n  1345→    html = html.replace(/<div class=\"ck[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n  1346→    html = html.replace(/<span class=\"[^\"]*ck[^\"]*\"[^>]*>/gi, '<span>');\n  1347→\n  1348→    // Limpiar spans de imagen inline\n  1349→    html = html.replace(/<span class=\"image-inline[^\"]*\"[^>]*>/gi, '');\n  1350→    html = html.replace(/<\\/span>/g, '');\n  1351→\n  1352→    // Remover elementos de upload y widgets\n  1353→    html = html.replace(/<div class=\"ck-image-upload[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n  1354→    html = html.replace(/<div class=\"ck-fake-selection[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n  1355→\n  1356→    // Remover atributos innecesarios\n  1357→    html = html.replace(/contenteditable=\"[^\"]*\"/gi, '');\n  1358→    html = html.replace(/data-cke-filler=\"[^\"]*\"/gi, '');\n  1359→\n  1360→    // Limpiar párrafos vacíos con br\n  1361→    html = html.replace(/<p><br[^>]*><\\/p>/gi, '');\n  1362→    html = html.replace(/<br data-cke[^>]*>/gi, '');\n  1363→\n  1364→    // Limpiar espacios múltiples y saltos de línea\n  1365→    html = html.replace(/\\s+/g, ' ');\n  1366→    html = html.replace(/>\\s+</g, '><');\n  1367→\n  1368→    return html.trim();\n  1369→}\n  1370→\n  1371→/**\n  1372→ * Ordena estudios por fecha_inicio más reciente (de más nueva a más antigua).\n  1373→ * Preserva los índices originales para permitir edición y eliminación correcta.\n  1374→ *\n  1375→ * @param {Array} estudios - Array de objetos con estudios\n  1376→ * @returns {Array} Array de estudios ordenados con propiedad indice_original\n  1377→ * @author Jair Carvajal\n  1378→ */\n  1379→function ordenarEstudiosPorFecha(estudios) {\n  1380→    // Mapear con índice original\n  1381→    let estudios_con_indice = estudios.map((estudio, indice_original) => ({\n  1382→        ...estudio,\n  1383→        indice_original: indice_original\n  1384→    }));\n  1385→\n  1386→    // Ordenar estudios por fecha_inicio (más reciente primero)\n  1387→    let estudios_ordenados = estudios_con_indice.sort((a, b) => {\n  1388→        // Si ambos tienen fecha_inicio, ordenar por más reciente\n  1389→        if (a.fecha_inicio && b.fecha_inicio) {\n  1390→            return moment(b.fecha_inicio).diff(moment(a.fecha_inicio));\n  1391→        }\n  1392→        // Si solo uno tiene fecha_inicio, ese va primero\n  1393→        if (a.fecha_inicio && !b.fecha_inicio) return -1;\n  1394→        if (!a.fecha_inicio && b.fecha_inicio) return 1;\n  1395→        // Si ninguno tiene fecha_inicio, mantener orden original\n  1396→        return 0;\n  1397→    });\n  1398→\n  1399→    return estudios_ordenados;\n  1400→}\n  1401→\n  1402→/**\n  1403→ * Ordena experiencias laborales por fecha: primero las que está trabajando actualmente (sin fecha_fin),\n  1404→ * luego por fecha_fin más reciente.\n  1405→ * Preserva los índices originales para permitir edición y eliminación correcta.\n  1406→ *\n  1407→ * @param {Array} experiencias - Array de objetos con experiencias laborales\n  1408→ * @returns {Array} Array de experiencias ordenadas con propiedad indice_original\n  1409→ * @author Jair Carvajal\n  1410→ */\n  1411→function ordenarExperienciasPorFecha(experiencias) {\n  1412→    // Mapear con índice original\n  1413→    let experiencias_con_indice = experiencias.map((experiencia, indice_original) => ({\n  1414→        ...experiencia,\n  1415→        indice_original: indice_original\n  1416→    }));\n  1417→\n  1418→    // Ordenar experiencias\n  1419→    let experiencias_ordenadas = experiencias_con_indice.sort((a, b) => {\n  1420→        // Si 'a' no tiene fecha_fin (trabaja actualmente), va primero\n  1421→        if (!a.fecha_fin && b.fecha_fin) return -1;\n  1422→        // Si 'b' no tiene fecha_fin (trabaja actualmente), va primero\n  1423→        if (a.fecha_fin && !b.fecha_fin) return 1;\n  1424→        // Si ambos están trabajando actualmente (sin fecha_fin), mantener el orden actual\n  1425→        if (!a.fecha_fin && !b.fecha_fin) return 0;\n  1426→        // Si ambos tienen fecha_fin, ordenar por fecha más reciente primero (descendente)\n  1427→        return moment(b.fecha_fin).diff(moment(a.fecha_fin));\n  1428→    });\n  1429→\n  1430→    return experiencias_ordenadas;\n  1431→}\n  1432→\n  1433→/**\n  1434→ * Obtener créditos disponibles de la empresa y actualizar el tag.\n  1435→ * - Si tiene créditos >= 20% del plan: tag azul\n  1436→ * - Si tiene créditos < 20% del plan: tag amarillo\n  1437→ * - Si no tiene créditos: tag gris \"Sin créditos\"\n  1438→ *\n  1439→ * @param {number} empresa_id ID de la empresa\n  1440→ * @param {string} contenedor_id ID del contenedor donde se mostrará el tag\n  1441→ * @returns {void}\n  1442→ * @author Andres Gonzalez\n  1443→ */\n  1444→function obtenerCreditosDisponiblesEmpresa(empresa_id, contenedor_id = 'contenedor-tag-creditos') {\n  1445→    if (!empresa_id || !$(`#${contenedor_id}`).length) {\n  1446→        return;\n  1447→    }\n  1448→\n  1449→    $.ajax({\n  1450→        url: `/empresas/${empresa_id}/creditos`,\n  1451→        method: 'GET',\n  1452→        dataType: 'json',\n  1453→        success: function(respuesta) {\n  1454→            let creditos_disponibles = respuesta?.data?.creditos_disponibles ?? 0;\n  1455→            let creditos_plan = respuesta?.data?.creditos_plan ?? 0;\n  1456→            let plan_credito = respuesta?.data?.plan_credito;\n  1457→            let porcentaje_disponible = creditos_plan > 0 ? (creditos_disponibles / creditos_plan) * 100 : 0;\n  1458→\n  1459→            let texto_tag = '';\n  1460→            let clase_tag = '';\n  1461→            let icono_final = '';\n  1462→\n  1463→            if (creditos_disponibles <= 0 || plan_credito === null) {\n  1464→                texto_tag = 'Sin créditos';\n  1465→                clase_tag = 'tag-tonal-gray';\n  1466→                icono_final = `<i class=\"bi bi-info-circle ms-1\" role=\"button\" tabindex=\"0\" ${crearTooltip({ placement: 'right', content: 'No tienes créditos disponibles en este momento. Renueva tu plan o adquiere más créditos para continuar.' })}></i>`;\n  1467→            } else if (porcentaje_disponible < 20) {\n  1468→                texto_tag = `Créditos disponibles: ${formatearNumero(creditos_disponibles)}`;\n  1469→                clase_tag = 'tag-filled-yellow';\n  1470→                icono_final = `<i class=\"bi bi-info-circle ms-1\" role=\"button\" tabindex=\"0\" ${crearTooltip({ placement: 'right', content: 'Estás cerca de agotar tus créditos. Te queda menos del 20% del total disponible. Considera recargar o revisar tu consumo para evitar interrupciones.' })}></i>`;\n  1471→            } else {\n  1472→                texto_tag = `Créditos disponibles: ${formatearNumero(creditos_disponibles)}`;\n  1473→                clase_tag = 'tag-tonal-blue';\n  1474→            }\n  1475→\n  1476→            $(`#${contenedor_id}`).html(crearTag({\n  1477→                texto: texto_tag,\n  1478→                class: clase_tag,\n  1479→                icono_final: icono_final,\n  1480→            }));\n  1481→\n  1482→            inicializarTooltips();\n  1483→        },\n  1484→        error: function (error) {\n  1485→            $(`#${contenedor_id}`).html(crearTag({\n  1486→                texto: error.status === 404 ? 'No tienes plan de créditos' : 'Error al cargar créditos',\n  1487→                class: 'tag-tonal-gray'\n  1488→            }));\n  1489→        }\n  1490→    });\n  1491→}\n  1492→\n  1493→/**\n  1494→ * Muestra Modal para informar que no cuenta con la funcionalidad\n  1495→ *.\n  1496→ * @returns {void}\n  1497→ * @author Andres Gonzalez\n  1498→ */\n  1499→function modalFuncionalidadInactiva() {\n  1500→    Swal.fire({\n  1501→        showCloseButton: true,\n  1502→        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n  1503→        showConfirmButton: false,\n  1504→        showDenyButton: false,\n  1505→        showCancelButton: false,\n  1506→        html: `\n  1507→            <div class=\"row w-100 mx-0 mt-2\">\n  1508→                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Sin funcionalidad</div>\n  1509→                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">No tienes esta funcionalidad activa. Por favor, contacta a tu asesor.</div>\n  1510→                <div class=\"col-6 mt-5 mb-2\">\n  1511→                    ${crearBoton({\n  1512→                        clases: 'btn-outline-primary w-100 justify-content-center',\n  1513→                        texto: 'Cancelar',\n  1514→                        onclick: `Swal.clickDeny();`\n  1515→                    })}\n  1516→                </div>\n  1517→                <div class=\"col-6 mt-5 mb-2\">\n  1518→                    ${crearBoton({\n  1519→                        clases: 'btn-primary w-100 justify-content-center',\n  1520→                        texto: 'entiendo',\n  1521→                        onclick: `Swal.clickConfirm();`\n  1522→                    })}\n  1523→                </div>\n  1524→            </div>\n  1525→        `,\n  1526→    }).then(async (result) => {\n  1527→        if (result.isConfirmed) {\n  1528→            console.log(66);\n  1529→        }\n  1530→    });\n  1531→}\n  1532→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"80282bbd-247e-4657-9262-4a3f04a91218","timestamp":"2026-01-27T16:35:26.055Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\globales.js","content":"// Mensajes en español para el plugin Select2\nconst mensajes_select2 = {\n    'noResults'              : () => { return 'No hay resultados para la búsqueda.'; },\n    'searching'              : () => { return 'Buscando...'; },\n    'Loading'                : () => { return 'Cargando...'; },\n    'loadingMore'            : () => { return 'Cargando más resultados...'; },\n    'dropdownFooter'         : (texto) => { return `Mostrando ${texto} resultados`; },\n    'emptyOptions'           : () => { return 'No hay opciones disponibles.'; },\n    'appendItems'            : (items) => { return `Agregando ${items.length} elementos.`; },\n    'maximumSelectionReached': () => { return 'Se ha alcanzado el número máximo de selecciones.'; },\n    'selectOnClose'          : () => { return 'Seleccione una opción al cerrar el menú.'; },\n    'escapeKeyUp'            : () => { return 'Presione \\'Escape\\' para cerrar el menú.'; },\n    'errorLoading'           : () => { return 'Error al cargar datos. Inténtalo de nuevo más tarde.'; },\n    'inputTooShort'          : (elemento) => { return `Ingresa al menos ${elemento.minimum} caracteres para iniciar una búsqueda.`; },\n    'noMatches'              : () => { return 'No se encontraron coincidencias para tu búsqueda.'; },\n    'allowClear'             : () => { return 'Borrar selección'; },\n    'SelectionTooLong'       : (conteo, maximo) => { return `Solo puedes seleccionar ${maximo} opciones.`; },\n    'loadMore'               : () => { return 'Cargando más resultados...'; },\n    'removing'               : (seleccion) => { return 'Eliminando...'; },\n    'matches'                : (coincidencias, total) => {\n        if (coincidencias === 0) {\n            return 'No hay coincidencias.';\n        } else if (coincidencias === 1) {\n            return 'Se encontró 1 coincidencia.';\n        } else {\n            return `Se encontraron ${coincidencias} coincidencias entre ${total}.`;\n        }\n    }\n};\n\n// audios\nvar audio_notificacion = new Audio('/audios/notificacion.mp3');\n\nlet mostro_modal_creditos_ia = false;\nlet funcion_ejecucion_ia = null;\nlet modals_abiertos_ia = null;\n\nlet configuraciones_disponibles_empresa = [];\n\n/**\n * Obtiene las funcionalidades activas del plan vigente de la empresa del usuario actual.\n *\n * @param {number|null} tipo_prueba_id ID del tipo de prueba (opcional).\n * @returns {Promise} Promesa que se resuelve con las funcionalidades activas.\n * @author Andres Gonzalez\n */\nfunction obtenerFuncionalidadesActivasPlan(tipo_prueba_id = null) {\n    let parametros = {};\n\n    if (tipo_prueba_id !== null) {\n        parametros.tipo_prueba_id = tipo_prueba_id;\n    }\n\n    return $.ajax({\n        url: '/funcionalidades-activas-plan',\n        method: 'GET',\n        dataType: 'json',\n        data: parametros,\n        success: function(respuesta) {\n            configuraciones_disponibles_empresa = respuesta?.data ?? [];\n        },\n        error: function(error) {\n            console.error('Error al obtener funcionalidades activas del plan:', error);\n            configuraciones_disponibles_empresa = [];\n        }\n    });\n}\n\n/**\n * Mostrar modal de créditos IA\n *\n * @return void\n * @author José Manuel Jiménez\n */\nfunction mostrarModalCreditosIA(servicio_ia_id) {\n    $.ajax({\n        url: `/empresas/${$('#empresa_sesion_id').val()}/creditos`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta_empresa) {\n            if (respuesta_empresa?.data?.creditos_disponibles > 0) {\n                $.ajax({\n                    url: `/servicios-ia/${servicio_ia_id}/creditos`,\n                    method: 'GET',\n                    dataType: 'json',\n                    success: function(respuesta) {\n                        if (respuesta?.data?.consume_creditos && respuesta?.data?.consume_creditos <= respuesta_empresa.data.creditos_disponibles) {\n                            $('#cantidad-creditos-descontar-modal').text(respuesta.data.consume_creditos);\n                            $('#modal-consumo-creditos-ia').modal('show');\n                            mostro_modal_creditos_ia = true;\n                            modals_abiertos_ia = $('.modal.show').not('#modal-consumo-creditos-ia').not('#modal-generando-ia');\n                            $(modals_abiertos_ia).addClass('d-none');\n                        } else {\n                            mostrarToastSolicitarCreditosIA();\n                        }\n                    }\n                });\n            } else {\n                mostrarToastSolicitarCreditosIA();\n            }\n        }\n    });\n}\n\n/**\n * Mostrar toast para solicitar créditos IA\n *\n * @return void\n * @author José Manuel Jiménez\n */\nfunction mostrarToastSolicitarCreditosIA() {\n    $.ajax({\n        url: `/empresas/${$('#empresa_sesion_id').val()}`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            let adicional_toast = '';\n            if (respuesta?.data?.ejecutivo?.telefono) {\n                adicional_toast = `<a href=\"https://wa.me/${respuesta.data.ejecutivo.telefono.replace(/\\D/g, '')}?text=Hola,%20me%20gustar%C3%ADa%20solicitar%20cr%C3%A9ditos%20adicionales%20para%20mi%20empresa.\" target=\"_blank\">\n                    <p class=\"text-label-1 text-white no-visited text-decoration-none mb-0\">Solicitar</p>\n                </a>`;\n            }\n            setTimeout(() => {\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-cargue-ia').modal('hide');\n                mostrarToast('danger', 'No cuentas con créditos. Solicita créditos adicionales.', '', adicional_toast);\n            }, 300);\n        }\n    });\n}\n\n/**\n * Continuar ejecución IA luego del modal de créditos\n *\n * @return void\n * @author José Manuel Jiménez\n */\nfunction continuarEjecucionIA() {\n    if (funcion_ejecucion_ia) {\n        funcion_ejecucion_ia();\n        funcion_ejecucion_ia = null;\n    }\n    mostro_modal_creditos_ia = false;\n    $('#modal-consumo-creditos-ia').modal('hide');\n}\n\n/**\n * Solicitar más créditos IA\n *\n * @return void\n * @author José Manuel Jiménez\n */\nfunction solicitarMasCreditosIA() {\n    $.ajax({\n        url: `/empresas/${$('#empresa_sesion_id').val()}`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            if (respuesta?.data?.ejecutivo?.telefono) {\n                window.open(`https://wa.me/${respuesta.data.ejecutivo.telefono.replace(/\\D/g, '')}?text=Hola,%20me%20gustar%C3%ADa%20solicitar%20cr%C3%A9ditos%20adicionales%20para%20mi%20empresa.`, '_blank');\n            } else {\n                mostrarToast('danger', 'No se encontró un ejecutivo asignado a la empresa. Por favor, comunícate con soporte para recargar créditos.');\n            }\n            $('#modal-solicitar-mas-creditos-ia').modal('hide');\n        }\n    });\n}\n\n/**\n * Validar respuesta de créditos IA\n *\n * @return void\n * @author José Manuel Jiménez\n */\nfunction validarRespuestaCreditosIA(error_ia) {\n    if (error_ia == 'No tienes créditos disponibles en este momento. Renueva tu plan o adquiere más créditos para continuar.') {\n        mostrarToastSolicitarCreditosIA();\n        return true;\n    }\n    return false;\n}\n\n/**\n * Ajustar el ancho de los elementos select2 asincrono multiple.\n *\n * @returns {void}\n * @author Andres Morales\n */\n$(document).ready(function () {\n    cargarNotificiacionesHeader();\n    if (window.configuracion_reverbg && window.configuracion_reverbg.activar_websocket) {\n        configurarWebSocketNotificaciones();\n    }\n    setTimeout(() => {\n        $(\".input-container\").each(function () {\n            let $container = $(this);\n            let $select = $container.find(\"select[multiple]\");\n            let $icon = $container.find(\".input-icono1\");\n            if ($select.length && $icon.length) {\n                $(this).find('.select2-selection--multiple').addClass('ps-5')\n            }\n        });\n    }, 1000);\n    $('#modal-consumo-creditos-ia').on('hidden.bs.modal', function () {\n        if (mostro_modal_creditos_ia) {\n            $(modals_abiertos_ia).removeClass('d-none');\n        }\n        mostro_modal_creditos_ia = false;\n    });\n\n    // Cargar créditos disponibles si existe el contenedor y el ID de empresa\n    if ($('#contenedor-tag-creditos').length && $('#empresa_sesion_id').length) {\n        obtenerCreditosDisponiblesEmpresa($('#empresa_sesion_id').val());\n    }\n});\n\n/**\n * Formatear fecha a formato dd/mm/yyyy - hh:mm AM/PM.  Ejemplo: 01/Feb/2022 - 12:00 PM\n *\n * @param {string} fecha_entrada fecha en formato ISO\n * @returns {string} fecha y hora formateada\n * @author Andres Morales\n */\nfunction formatearFecha(fecha_entrada) {\n    var fecha = new Date(fecha_entrada);\n    var dia = fecha.getDate();\n    var mes = fecha.toLocaleString('es-ES', { month: 'short' });\n    var anio = fecha.getFullYear();\n    let hora = fecha.getHours();\n    let minuto = fecha.getMinutes();\n    let ampm = hora >= 12 ? 'PM' : 'AM';\n    hora = hora % 12 || 12;\n    minuto = minuto.toString().padStart(2, '0');\n    return `${dia}/${mes}/${anio} - ${hora}:${minuto} ${ampm}`;\n}\n\nfunction formatearFecha2(fecha_entrada) {\n    let partes = fecha_entrada.split(' ');\n    let fecha = partes[0].split('-');\n    let hora = partes[1];\n    let fechaISO = `${fecha[2]}-${fecha[1]}-${fecha[0]}T${hora}`;\n\n    let date = new Date(fechaISO);\n\n    if (isNaN(date.getTime())) {\n        return 'Fecha inválida';\n    }\n\n    let dia = date.getDate();\n    let mes = date.toLocaleString('eu-EU', { month: 'short' });\n    let anio = date.getFullYear();\n    return `${dia}/${mes}/${anio}`;\n}\n\n/**\n * Opción para contraer o agrandar el menú principal\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction contraerMenu() {\n    if ($('.sidebar-menu').hasClass('close')) {\n        $('.sidebar-menu').removeClass('d-none');\n        localStorage.setItem('opcion_menu_storage', 'abierto');\n        $('#btn-collapse').attr('data-bs-original-title', 'Contraer');\n        $('#btn-collapse').attr('data-bs-title', 'Contraer');\n        $(\".menu-bar\").each(function() {\n            $(this).removeClass(\"px-2\").addClass(\"px-5\");\n        });\n        $('[data-bs-toggle=\"tooltip\"]').each(function () { new bootstrap.Tooltip(this); });\n        $('.lista-primary[data-bs-toggle=\"tooltip\"]').each(function () {\n            var tooltip_instancia = bootstrap.Tooltip.getInstance(this);\n            if (tooltip_instancia) {\n                tooltip_instancia.dispose();\n            }\n        });\n    } else {\n        $('.sidebar-menu').addClass('d-none');\n        localStorage.setItem('opcion_menu_storage', 'cerrado');\n        $('#btn-collapse').attr('data-bs-original-title', 'Expandir');\n        $('#btn-collapse').attr('data-bs-title', 'Expandir');\n        $(\".menu-bar\").each(function() {\n            $(this).removeClass(\"px-5\").addClass(\"px-2\");\n        });\n        $('[data-bs-toggle=\"tooltip\"]').each(function () { new bootstrap.Tooltip(this); });\n    }\n    $('.tooltip.bs-tooltip-auto').remove();\n    $('.sidebar-menu').toggleClass('close');\n    $('.contenedor-vista').toggleClass('close');\n    $('#btn-collapse').toggleClass('close');\n    $('.nombre-usuario-empresa').toggle();\n    $('.menu-bar .text-menu').toggle();\n}\n\n/**\n * Opción para abrir o cerrar el menu segun la elección guardada\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction mostrarMenuStorage() {\n    $(document).ready(function() {\n        $('.lista-primary[data-bs-toggle=\"tooltip\"]').each(function () {\n            var tooltip_instancia = bootstrap.Tooltip.getInstance(this);\n            if (tooltip_instancia) {\n                tooltip_instancia.dispose();\n            }\n        });\n\n        if (window.innerWidth < 768) {\n            localStorage.setItem('opcion_menu_storage', 'cerrado');\n        }\n\n        if (localStorage.getItem('opcion_menu_storage') === 'cerrado') {\n            contraerMenu();\n        }\n        let $active = $('.menu-bar .active');\n\n        if ($active.length) {\n            $('.menu-bar').scrollTop($active.position().top);\n        }\n    });\n}\nmostrarMenuStorage();\n\n/**\n * Funcion para hacer el slug de un texto desde jquery.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction slugify(text) {\n    return $.trim(text)\n        .toLowerCase()\n        .normalize(\"NFD\")\n        .replace(/[\\u0300-\\u036f]/g, \"\")\n        .replace(/[^a-z0-9 -]/g, \"\")\n        .replace(/\\s+/g, \"-\")\n        .replace(/-+/g, \"-\");\n}\n\n/**\n * Función generica para mostrar mensajes de respuesta\n *\n * @param {string} tipo_alerta define el color de la alerta segun alerts de botstrap.\n * @param {string} texto_1 Texto que mostrara la alerta.\n * @param {string} texto_2 Texto secundario en la alerta.\n * @param {string} accion Acción adicional(por definir).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarToast(tipo_alerta, texto_1, texto_2 = '', accion = '', icono2 = '') {\n    let icono = '';\n    let texto_color = 'text-white';\n    if (accion != '') {\n        accion = `<div class=\"col-auto p-0 text-label-1\">${accion}</div>`;\n    }\n\n    if (tipo_alerta == 'success') {\n        icono = 'bi bi-check-circle';\n    }\n\n    if (tipo_alerta == 'neutral') {\n        icono = 'bi bi-info-circle';\n    }\n\n    if (tipo_alerta == 'warning') {\n        icono = 'bi bi-info-circle';\n        texto_color = \"text-red-letras\";\n    }\n\n    if (tipo_alerta == 'danger') {\n        icono = 'bi bi-x-circle';\n    }\n\n    if (icono2 != '') {\n        icono = icono2;\n    }\n\n    if (texto_2 != '') {\n        texto_2 = `<div class=\"col-12 p-0 text-label-1 ${texto_color}\">${texto_2}</div>`;\n    }\n\n    let alert_toast = $(`\n        <div class=\"alert toast-${tipo_alerta} alert-dismissible fade show d-flex align-items-center pe-3 py-3 me-3\" role=\"alert\" style=\"display:none\">\n            <div class=\"col-auto\">\n                <span class=\"${icono} ${texto_color}\"></span>\n            </div>\n            <div class=\"col px-3\">\n                <div class=\"row m-0 ${texto_color}\">\n                    <div class=\"col-12 p-0 text-label-1 ${texto_color}\">\n                        ${texto_1}\n                    </div>\n                    ${texto_2}\n                </div>\n            </div>\n            ${accion}\n            <div class=\"col-auto ms-3 pointer\" data-bs-dismiss=\"alert\">\n                <span class=\"bi bi-x ${texto_color}\"></span>\n            </div>\n        </div>\n    `);\n    $('#contenedor-alert-toast').append(alert_toast);\n    alert_toast.fadeIn();\n    setTimeout(function() {\n        alert_toast.fadeOut();\n        alert_toast.alert('close');\n    }, 5000);\n}\n\n/**\n * Formatear número.\n *\n * @param {number} numero número a formatear\n * @author Andres Morales\n */\nfunction formatearNumero(numero) {\n    return parseInt(numero).toLocaleString('es-ES');\n}\n\n/**\n * Formatear fecha.\n *\n * @param {*} fecha Fecha a formatear.\n * @param {boolean} incluir_segundos Indica si se debe incluir los segundos en la hora.\n * @param {string} formato Formato en el que se retornará la fecha.\n * @param {string} separador Símbolo que se usará para separar días, meses y años.\n * @returns {Object} Objeto con la fecha y hora formateada.\n * @author Daniel Beltrán\n */\nfunction formatearFechaConceptual(fecha, incluir_segundos = false, formato = 'Ymd', separador = '-') {\n    const NUEVA_FECHA = new Date(fecha);\n    const ANO         = NUEVA_FECHA.getFullYear();\n    const MES         = String(NUEVA_FECHA.getMonth() + 1).padStart(2, '0');\n    const DIA         = String(NUEVA_FECHA.getDate()).padStart(2, '0');\n    const HORAS       = String(NUEVA_FECHA.getHours()).padStart(2, '0');\n    const MINUTOS     = String(NUEVA_FECHA.getMinutes()).padStart(2, '0');\n    const SEGUNDOS    = String(NUEVA_FECHA.getSeconds()).padStart(2, '0');\n\n    let fecha_formateada = `${ANO}${separador}${MES}${separador}${DIA}`;\n\n    if (formato === 'dmY') {\n        fecha_formateada = `${DIA}${separador}${MES}${separador}${ANO}`;\n    }\n\n    return {\n        fecha: fecha_formateada,\n        hora : incluir_segundos ? `${HORAS}:${MINUTOS}:${SEGUNDOS}` : `${HORAS}:${MINUTOS}`\n    };\n}\n\n/**\n * Formatear fecha a May. 2023.\n *\n * @param {string} fechaISO Fecha a formatear.\n * @returns {string} Objeto con la fecha y hora formateada.\n * @author Andres Morales\n */\nfunction formatearFechaAnioMes(fechaISO) {\n    const fecha = new Date(fechaISO);\n    const opciones = { month: 'short', year: 'numeric' };\n    let fecha_formateada = fecha.toLocaleDateString('es-ES', opciones);\n\n    fecha_formateada = fecha_formateada.replace(\n        /^([a-zñ]+)(\\s\\d{4})$/,\n        (_, mes, anio) => `${mes.charAt(0).toUpperCase() + mes.slice(1)}. ${anio.trim()}`\n    );\n\n    return fecha_formateada;\n}\n\n/**\n * Formatear un numero a moneda.\n *\n * @param {string} valor Numero.\n * @returns {string} Numero formateado.\n * @author Andres Morales\n */\nfunction formatearMonedaCOP(valor) {\n    return new Intl.NumberFormat('es-CO', {\n        style: 'currency',\n        currency: 'COP',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0\n    }).format(valor);\n}\n\n/**\n * Formatear fecha a un formato d/m/Y hh:mm:ss entendible para el usuario.\n *\n * @param {*} fecha_inicial Fecha a formatear.\n * @returns {String} String con la fecha y hora formateada.\n * @author José Manuel Jiménez\n */\nfunction fechaMostrar(fecha_inicial) {\n    if (!fecha_inicial) {\n        return \"\";\n    }\n    const fecha = new Date(fecha_inicial);\n    if (isNaN(fecha.getTime())) {\n        return \"\";\n    }\n    const dia = String(fecha.getUTCDate()).padStart(2, '0');\n    const mes = String(fecha.getUTCMonth() + 1).padStart(2, '0');\n    const anio = fecha.getUTCFullYear();\n    if (!fecha_inicial.includes(\" \")) {\n        return `${dia}/${mes}/${anio}`;\n    }\n    const horas = String(fecha.getUTCHours()).padStart(2, '0');\n    const minutos = String(fecha.getUTCMinutes()).padStart(2, '0');\n    const segundos = String(fecha.getUTCSeconds()).padStart(2, '0');\n    return `${dia}/${mes}/${anio} ${horas}:${minutos}:${segundos}`;\n}\n\n/**\n * Descargar Excel.\n *\n * @param {string} ruta Ruta desde donde se descarga el archivo.\n * @param {string} nombre_archivo Nombre del archivo descargado.\n * @param {boolean} marca_tiempo Indica si el nombre del archivo debe llevar marca de tiempo.\n * @param {Object} parametros Parámetros a enviar en la petición.\n * @returns {void}\n * @author Daniel Beltrán\n */\nasync function descargarExcel(ruta, nombre_archivo, marca_tiempo = true, parametros = {}) {\n    parametros._token = $('meta[name=\"csrf-token\"]').attr('content');\n\n    await $.ajax({\n        type     : 'POST',\n        url      : `/${ruta}`,\n        data     : parametros,\n        xhrFields: {\n            responseType: 'blob'\n        },\n        success: function (respuesta) {\n            // Crear una URL para el Blob\n            let url = window.URL.createObjectURL(respuesta); // 'respuesta' es el Blob\n            let a   = document.createElement('a'); // Crea un nuevo elemento <a> para iniciar la descarga\n            a.href  = url;\n            const fecha_actual     = new Date();\n            const dia              = fecha_actual.getDate();\n            const mes              = fecha_actual.getMonth() + 1;\n            const ano              = fecha_actual.getFullYear();\n            const hora             = fecha_actual.getHours();\n            const minutos          = fecha_actual.getMinutes();\n            const segundos         = fecha_actual.getSeconds();\n            const fecha_formateada = `${dia}${mes}${ano}${hora}${minutos}${segundos}`;\n\n            a.download = marca_tiempo ? `${nombre_archivo}-${fecha_formateada}.xlsx` : `${nombre_archivo}.xlsx`;\n            document.body.appendChild(a);\n            a.click();\n            window.URL.revokeObjectURL(url);\n            document.body.removeChild(a);\n        }\n    }).then(() => {\n        mostrarToast('success', 'Archivo descargado correctamente.');\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al descargar el archivo.');\n    });\n}\n\n/**\n * Convierte un string a slug.\n *\n * @param {string} str\n * @returns {string}\n * @author Fahibram Cárcamo\n */\nfunction slug(str) {\n\n    // Quita espacios en blanco\n    str = str.replace(/^\\s+|\\s+$/g, \"\")\n\n    // Convierte el string a minusculas\n    str = str.toLowerCase()\n\n    // Quita los caracteres no alfanuméricos\n    str = str.replace(/[^a-z0-9 -]/g, \"\")\n\n    // Reemplaza los espacio con guiones\n    str = str.replace(/\\s+/g, \"-\")\n\n    // Remueve los guiones consecutivos\n    str = str.replace(/-+/g, \"-\")\n\n    return str\n}\n\n/**\n * Compara los elementos de dos arreglos y retorna `true` si son iguales y `false` en caso contrario\n * (Este función está pensada para comparar arreglos unidimensionales).\n *\n * @param {array} primer_arreglo\n * @param {array} segundo_arreglo\n * @param {boolean} comparar_orden\n * @return {boolean}\n * @author Fahibram Cárcamo\n */\nfunction sonArreglosIguales(primer_arreglo, segundo_arreglo, comparar_orden = false) {\n\n    if (!comparar_orden) {\n        primer_arreglo.sort()\n        segundo_arreglo.sort()\n    }\n\n    if (primer_arreglo.length !== segundo_arreglo.length) return false\n\n    for (let i = 0; i < primer_arreglo.length; i++) {\n        if (primer_arreglo[i] !== segundo_arreglo[i]) return false\n    }\n\n    return true\n}\n\n/**\n * Función para cambiar de empresa.\n *\n * @param {number} empresa_id ID de la empresa a la que se va a cambiar.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction cambiarEmpresa(empresa_id) {\n    $.ajax({\n        type: 'POST',\n        url: '/suplantar-rol-admin-general',\n        data: {\n            _token    : $('meta[name=\"csrf-token\"]').attr('content'),\n            empresa_id: empresa_id\n        },\n        success: function (respuesta) {\n            localStorage.setItem('notificacionToast', JSON.stringify({\n                tipo_alerta: 'success',\n                texto_1    : 'Cambio de empresa exitoso'\n            }));\n\n            window.location.reload();\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Ocurrió un error al cambiar de empresa');\n        }\n    });\n}\n\n/**\n * Enviar la solucitud de suplantación de rol y empresa al Back-end.\n *\n * @param {function|null} callback_exito Callback ejecutado en caso de éxito.\n * @param {string} url URL de suplantación.\n * @param {string} _token Token CSRF del formulario.\n * @param {number} empresa_id Id de la empresa a suplantar.\n * @param {number|null} rol_id Id del rol a suplantar.\n * @param {function|null} callback_error Callback ejecutado en caso de error.\n * @returns {void}\n * @author Fahibram Cárcamo\n */\nasync function enviarOrdenSuplantacionRolEmpresa (callback_exito, url, _token, empresa_id = null, rol_id = null, callback_error = null) {\n\n    let condicion_suplantacion = rol_id === null\n        ? empresa_id === null\n            ? true\n            : parseInt($('#empresa_sesion_id').val()) !== parseInt(empresa_id)\n        : parseInt($('#rol_sesion_id').val()) !== parseInt(rol_id) && parseInt($('#empresa_sesion_id').val()) !== parseInt(empresa_id);\n\n    if (condicion_suplantacion) {\n        let data = { _token };\n        if (empresa_id !== null) data.empresa_id = empresa_id;\n        if (rol_id !== null) data.rol_id = rol_id;\n\n        await $.ajax({ type: 'POST', url, data })\n            .then((respuesta, status, xhr) => {\n                if (xhr.status >= 200 && xhr.status < 300 && callback_exito !== null) callback_exito();\n            })\n            .catch(error => {\n                let swal_titulo, swal_texto;\n\n                if (error.status === 404) {\n                    if (error.responseJSON.mensaje) {\n                        swal_titulo = 'Algo salió mal';\n                        if (error.responseJSON.mensaje === 'no existe rol_suplantar') {\n                            swal_texto = 'El rol no existe.';\n                        } else if (error.responseJSON.mensaje === 'no existe empresa_suplantar') {\n                            swal_texto = 'La empresa no existe.';\n                        } else if (error.responseJSON.mensaje === 'no existe usuario_suplantar') {\n                            swal_texto = 'El usuario no existe.';\n                        } else {\n                            swal_texto = '';\n                        }\n                    } else if (error.responseJSON.empresa && error.responseJSON.rol) {\n                        swal_titulo = 'No fué posible cambiar de empresa';\n                        swal_texto = error.responseJSON.rol === 'Administrador general' || error.responseJSON.rol === 'Propietario'\n                            ? `La empresa ${error.responseJSON.empresa} no tiene ningún usuario con el rol Administrador general o Propietario.`\n                            : `La empresa ${error.responseJSON.empresa} no tiene ningún usuario con el rol ${error.responseJSON.rol}.`;\n                    } else {\n                        swal_titulo = 'Algo salió mal';\n                        swal_texto = error.responseJSON.errors;\n                    }\n                } else {\n                    swal_titulo = 'Algo salió mal';\n                    swal_texto = '';\n                }\n\n                if (callback_error !== null) callback_error();\n\n                Swal.fire({\n                    title: swal_titulo,\n                    text: swal_texto,\n                    icon: \"error\",\n                    confirmButtonText: \"Aceptar\"\n                });\n            });\n    }\n}\n\n/**\n * Mostrar tooltip según el div que lo contenga.\n *\n * @param {div} div Elemento en donde se va a mostrar el tooltip.\n * @returns {void}\n * @author Sol Espitia\n */\nfunction mostrarTooltip(div) {\n    const TOOLTIP         = div.querySelector('.tooltip-x');\n    TOOLTIP.style.display = 'block';\n}\n\n/**\n * Ocultar tooltip según el div que lo contenga.\n *\n * @param {div} div Elemento en donde se va a mostrar el tooltip.\n * @returns {void}\n * @author Sol Espitia\n */\nfunction ocultarTooltip(div) {\n    const TOOLTIP         = div.querySelector('.tooltip-x');\n    TOOLTIP.style.display = 'none';\n}\n\n/**\n * Retornar la diferencia en días de dos fechas dadas.\n *\n * @param {string} fecha_inicial Fecha inicial\n * @param {string} fecha_final Fecha final\n * @param {bool} valor_absoluto Retorna la diferencia en valor absoluto\n * @returns {number}\n * @author Fahibram Cárcamo\n * @author Andres Morales\n */\nfunction diferenciaFechasDias(fecha_inicial, fecha_final, valor_absoluto = false, sumar_dia = true) {\n    let fecha1 = new Date(fecha_inicial);\n    let fecha2 = new Date(fecha_final);\n\n    fecha1.setHours(0, 0, 0, 0);\n    fecha2.setHours(0, 0, 0, 0);\n\n    let diferencia_milisegundos = fecha2.getTime() - fecha1.getTime();\n\n    let diferencia_dias = diferencia_milisegundos / (1000 * 60 * 60 * 24);\n    let resultado = diferencia_dias;\n    if (sumar_dia) {\n        resultado = diferencia_dias + 1;\n    }\n\n    return valor_absoluto ? Math.abs(resultado) : resultado;\n}\n\n/**\n * Retornar `true` si una fecha dada está dentro de un rango de fechas dadas, `false` en otro caso.\n *\n * @param {string} fecha Fecha dada\n * @param {string} fecha_desde Fecha inicial del rango\n * @param {string} fecha_hasta Fecha final del rango\n * @returns {boolean}\n * @author Fahibram Cárcamo\n */\nfunction fechaDentroDelRango(fecha, fecha_desde, fecha_hasta) {\n    fecha = new Date(fecha);\n    fecha_desde = new Date(fecha_desde);\n    fecha_hasta = new Date(fecha_hasta);\n\n    if (isNaN(fecha) || isNaN(fecha_desde) || isNaN(fecha_hasta)) {\n        throw new Error('Una o más fechas no son válidas.');\n    }\n\n    return fecha >= fecha_desde && fecha <= fecha_hasta;\n}\n\n/**\n * Descuenta el tiempo para las respuestas.\n *\n * @param id - ID del elemento HTML donde mostrar el tiempo\n * @param tiempo - Tiempo inicial en segundos\n * @author Jair Carvajal\n */\nvar tiempos_usados = {};\n\nfunction descuentoTiempo(id, tiempo, callback, onTick) {\n    var $elemento = $('#' + id);\n    if ($elemento.length === 0) {\n        console.error('Elemento con id \"' + id + '\" no encontrado.');\n        return;\n    }\n    if (tiempos_usados[id]) {\n        clearInterval(tiempos_usados[id]);\n    }\n    let tiempoTotal = tiempo;\n    tiempos_usados[id] = setInterval(function() {\n        if (tiempo <= 0) {\n            clearInterval(tiempos_usados[id]);\n            delete tiempos_usados[id];\n            $elemento.text('Tiempo finalizado');\n            if (window.tiempoFinalizado()) {\n                tiempoFinalizado();\n            }\n            if (typeof callback === 'function') {\n                callback();\n            }\n            return;\n        }\n\n        var minutos = Math.floor(tiempo / 60);\n        var segundos = tiempo % 60;\n\n        var textoTiempo = minutos + ':' + (segundos < 10 ? '0' : '') + segundos + '<i class=\"bi bi-alarm ms-2\"></i>';\n\n        if (tiempo <= 15) {\n            $elemento.addClass('text-state-red');\n            $elemento.removeClass('text-state-green');\n        } else {\n            $elemento.addClass('text-state-green');\n            $elemento.removeClass('text-state-red');\n        }\n\n        $elemento.html(textoTiempo);\n\n        var tiempoUsado = tiempoTotal - tiempo;\n\n        if (typeof onTick === 'function') {\n            onTick((tiempoUsado % 5));\n        }\n        tiempo--;\n    }, 1000);\n}\n\n/**\n * Detengo el tiempo para las respuestas.\n *\n * @param id - ID del elemento HTML donde mostrar el tiempo\n * @param tiempo - Tiempo inicial en segundos\n * @author Jair Carvajal\n */\nfunction detenerDescuentoTiempo(id) {\n    if (tiempos_usados[id]) {\n        clearInterval(tiempos_usados[id]);\n        delete tiempos_usados[id];\n    }\n}\n\n/**\n * Genera un SVG de la imagen de usuario.\n *\n * @param id ID del usuario.\n * @param nombres Nombres del usuario.\n * @param apellidos Apellidos del usuario.\n * @return image\n * @author Andres Morales\n */\nfunction crearImagenUsuarioLetras(id, nombres, apellidos) {\n    var tamano = 200;\n    var iniciales = (nombres[0] + apellidos[0]).toUpperCase();\n    var hash = md5(id);\n\n    var r = parseInt(hash.substring(0, 2), 16);\n    var g = parseInt(hash.substring(2, 4), 16);\n    var b = parseInt(hash.substring(4, 6), 16);\n    var colorFondo = `rgb(${r},${g},${b})`;\n\n    var luminancia = 0.299 * r + 0.587 * g + 0.114 * b;\n    var colorTexto = luminancia > 150 ? \"#000000\" : \"#FFFFFF\";\n\n    // SVG como texto\n    var svg = `\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${tamano}\" height=\"${tamano}\">\n        <rect width=\"100%\" height=\"100%\" fill=\"${colorFondo}\" />\n        <text x=\"50%\" y=\"50%\" dy=\".35em\"\n            text-anchor=\"middle\"\n            font-family=\"Lato, sans-serif\"\n            font-size=\"${tamano * 0.4}\"\n            fill=\"${colorTexto}\">\n            ${iniciales}\n        </text>\n    </svg>`;\n    var svgEncoded = encodeURIComponent(svg)\n        .replace(/'/g, \"%27\")\n        .replace(/\"/g, \"%22\");\n\n    var dataUri = `data:image/svg+xml,${svgEncoded}`;\n    return dataUri;\n}\n\n/**\n * Carga las notificaciones\n *\n * @return void\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author Esperanza Olivo\n */\nfunction cargarNotificiacionesHeader() {\n    $.ajax({\n        url: '/usuario-notificaciones',\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            let datos = respuesta.data;\n            let notificaciones_noleidas = datos?.unread_notifications?.length ?? 0;\n\n            // Siempre remover el badge existente\n            $('#dropdownNotificaciones #badge-notificaciones').remove();\n\n            // Solo agregar el badge si hay notificaciones no leídas\n            if (notificaciones_noleidas > 0) {\n                $('#dropdownNotificaciones').append(`<span id=\"badge-notificaciones\" class=\"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-white\">${notificaciones_noleidas}</span>`);\n                $('#contador-notificaciones-abierto').append(`<span id=\"badge-notificaciones\" class=\"badge rounded-pill bg-danger border border-white\">${notificaciones_noleidas}</span>`);\n\n                $('#contenedor-boton-marcar-todas').html(`\n                    <button class=\"btn btn-link text-primary w-100 d-flex justify-content-center\" onclick=\"marcarNotificacionesLeidas('all')\">\n                        Marcar todo como leído\n                    </button>\n                `);\n            }\n\n            const NO_LEIDOS_IDS = new Set(Array.isArray(datos?.unread_notifications) ? datos.unread_notifications.map(notificacion => notificacion.id) : []);\n\n            if (Array.isArray(datos?.notifications) && datos.notifications.length > 0) {\n                $('#notificacion-sinnotificaciones').hide();\n                $('.notificaciones-listado').remove();\n                datos.notifications.forEach(notificacion => {\n                    const { id, data, updated_at } = notificacion;\n\n                    const NO_LEIDO = NO_LEIDOS_IDS.has(id);\n                    const MENSAJE = (data?.mensaje || '').slice(0, 120) + '...';\n                    const HORA = new Date(updated_at).toLocaleTimeString('es-CO', {\n                        hour: '2-digit',\n                        minute: '2-digit',\n                        hour12: false\n                    });\n\n                    const notificaciones = `\n                        <li class=\"${NO_LEIDO ? '' : 'bg-gray-90'} notificaciones-listado py-0\" id=\"notificacion-${id}\">\n                            <a class=\"dropdown-item text-gray-10 text-decoration-none border-top pt-0 pb-1\" href=\"javascript:void(0)\" onclick=\"marcarNotificacionesLeidas('${id}','${data?.ruta}')\">\n                                <div class=\"d-flex justify-content-between\">\n                                    <div class=\"w-auto flex-grow-1 pe-3\">\n                                        <p class=\"mt-1 mb-0 text-headline-6 text-gray-10\">${data?.titulo}</p>\n                                        <p class=\"mb-0 text-body-3 text-gray-30 notificacion-mensaje\">${MENSAJE}</p>\n                                    </div>\n                                    <div class=\"w-auto my-auto ${NO_LEIDO ? 'text-cta-azul' : 'text-gray-10'} text-label-2 flex-shrink-0\">\n                                        ${HORA}${NO_LEIDO ? `<i class=\"bi bi-circle-fill text-cta-azul my-auto texto-notificacion-icono ms-3\"></i>` : ''}\n                                    </div>\n                                </div>\n                            </a>\n                        </li>\n                    `;\n\n                    $(notificaciones).insertBefore('#contenedor-boton-marcar-todas');\n                });\n\n            } else {\n                $('#notificacion-sinnotificaciones').hide();\n                $('.notificaciones-listado').remove();\n            }\n\n        },\n        error: function(xhr, status, error) {\n            console.error('Error al cargar notificaciones:', error);\n        }\n    });\n}\n\n/**\n * Marcar las notificaciones leídas.\n *\n * @param {array} notificaciones_ids ids de las notificaciones\n * @param {string} ruta_destino ruta donde se va ha actualizar la pagina\n * @returns {void}\n * @author Andres Gonzalez\n * @author Esperanza Olivo\n */\nfunction marcarNotificacionesLeidas(notificaciones_ids = null, ruta_destino = null, soporte_id = null) {\n\n    let data = {\n        _token: $('meta[name=\"csrf-token\"]').attr('content')\n    };\n\n    if (notificaciones_ids === 'all') {\n        data.marcar_todo = true;\n    } else if (soporte_id) {\n        data.soporte_id = soporte_id;\n    } else if (notificaciones_ids) {\n        data.notificaciones_ids = Array.isArray(notificaciones_ids)\n            ? notificaciones_ids\n            : [notificaciones_ids];\n    }\n\n    $.ajax({\n        url: '/usuario-marcar-notificaciones-leidas',\n        type: 'POST',\n        data: data,\n        success: function(respuesta) {\n            cargarNotificiacionesHeader();\n\n            if (notificaciones_ids && notificaciones_ids !== 'all' && ruta_destino) {\n                window.location.href = \"/\" + ruta_destino;\n            }\n\n            if (notificaciones_ids === 'all') {\n                $('#badge-notificaciones').remove();\n                $('#contenedor-boton-marcar-todas').empty();\n                $('.notificaciones-listado').addClass('bg-gray-90');\n                $('.bi-circle-fill').remove();\n            }\n        },\n        error: function(xhr, estatus, error) {\n            console.error('Error al cargar notificaciones:', error);\n        }\n    });\n}\n\n/**\n * Configurar WebSocket para notificaciones en tiempo real\n *\n * @return void\n * @author Andres Gonzalez\n */\nfunction configurarWebSocketNotificaciones() {\n    try {\n        if (!window.configuracion_reverbg) {\n            return;\n        }\n\n        const PUSHER = new Pusher(window.configuracion_reverbg.appKey, {\n            wsHost: window.configuracion_reverbg.host,\n            wsPort: window.configuracion_reverbg.port,\n            wssPort: window.configuracion_reverbg.port,\n            cluster: 'mt1',\n            forceTLS: false,\n            enabledTransports: ['ws', 'wss'],\n            authEndpoint: '/broadcasting-auth',\n            auth: {\n                headers: {\n                    'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n                }\n            }\n        });\n\n        PUSHER.connection.bind('failed', function() {\n            console.error('❌ Conexión WebSocket falló');\n        });\n\n        PUSHER.connection.bind('error', function(error) {\n            console.error('❌ Error de WebSocket:', error);\n        });\n\n        let usuario_id = window.configuracion_reverbg.usuario_id;\n\n        if (!usuario_id) {\n            return;\n        }\n\n        const NOMBRE_CANAL = `private-App.Models.Usuarios.User.${usuario_id}`;\n        const CANAL = PUSHER.subscribe(NOMBRE_CANAL);\n\n        CANAL.bind('pusher:subscription_error', function(error) {\n            console.error('❌ Error al suscribirse al canal:', error);\n        });\n\n        // Escuchar eventos específicos de notificaciones\n        CANAL.bind('Illuminate\\\\Notifications\\\\Events\\\\BroadcastNotificationCreated', function(data) {\n            if (data.tipo === 'nueva_notificacion') {\n                audio_notificacion.play();\n                cargarNotificiacionesHeader();\n            }\n\n            if (data.tipo === 'nuevo_mensaje') {\n                if (($('#soporte-guardado-id').val() == data.soporte_id) || ($('#soporte_empresa_id').val() == data.soporte_id)) {\n                    audio_notificacion.play();\n                    consultarChat(data.soporte_id);\n                }\n            }\n        });\n    } catch (error) {\n        console.error('💥 Error en configurarWebSocketNotificaciones:', error);\n        console.error('Stack trace:', error.stack);\n    }\n}\n\n/**\n * Retornar el string entrante en formato title case.\n *\n * @param {string} texto\n * @returns {string}\n * @author Fahibram Cárcamo\n */\nfunction titleCase(texto) {\n    return texto.toLowerCase().replace(/\\b\\w/g, caracter => caracter.toUpperCase());\n}\n\n/**\n * Número de horas que durará el almacenamiento de la variable `ulitmas_empresas` en el\n * almacenamiento local **LocalStorage**.\n *\n * @var {number}\n * @author Fahibram Cárcamo\n */\nconst CANTIDAD_HORAS_VENCIMIENTO_ULTIMAS_EMPRESAS_LOCALSTORAGE = 6;\n\n/**\n * Validar si ya debe removerse la variable `ultimas_empresas` del alamacenamiento local\n * **LocalStorage**, si no es tiempo de eliminarla entonces se reinicia el tiempo de vigencia de la\n * variable.\n *\n * @returns {void}\n * @author Fahibram Cárcamo\n */\nfunction validarYActualizarUltimasEmpresasLocalStorage() {\n    let fecha_hora_actuales = moment();\n    let fecha_hora_vencimiento_ultimas_empresas = fecha_hora_actuales.clone().add(CANTIDAD_HORAS_VENCIMIENTO_ULTIMAS_EMPRESAS_LOCALSTORAGE, 'hours');\n    let fecha_hora_vencimiento_ultimas_empresas_localstorage = localStorage.getItem('vencimiento_ultimas_empresas');\n    let ultimas_empresas = localStorage.getItem('ultimas_empresas');\n\n    if (\n        ultimas_empresas != null &&\n        fecha_hora_vencimiento_ultimas_empresas_localstorage != null &&\n        fecha_hora_actuales.clone().isBefore(moment(fecha_hora_vencimiento_ultimas_empresas_localstorage).clone())\n    ) {\n        localStorage.setItem('vencimiento_ultimas_empresas', fecha_hora_vencimiento_ultimas_empresas.format('YYYY-MM-DD HH:mm:ss'));\n        return;\n    }\n\n    localStorage.removeItem('vencimiento_ultimas_empresas');\n    localStorage.removeItem('ultimas_empresas');\n}\n\n/**\n * Obtener la edad actual de un usuario según su fecha de nacimiento.\n *\n * @param {string} fecha_nacimiento\n * @returns {string}\n * @author José Manuel Jiménez\n * @author Fahibram Cárcamo\n * @author Andres Morales\n */\nfunction obtenerEdad(fecha_nacimiento) {\n    if (!fecha_nacimiento) return \"N/A\";\n    let hoy = new Date();\n    let nacimiento = new Date(fecha_nacimiento);\n    let edad = hoy.getFullYear() - nacimiento.getFullYear();\n    let mes = hoy.getMonth() - nacimiento.getMonth();\n    if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) edad--;\n    return edad + \" años\";\n}\n\n/**\n * Restablecer un input de tipo file.\n *\n * @param {html} elemento_input_html Elemento input html.\n * @param {html} label_elemento_input_html Label del elemento input html.\n * @param {html} boton_eliminar_elemento_input_html Botón para eliminar archivo del elemento input html.\n * @author Fahibram Cárcamo\n */\nfunction reiniciarCampoArchivo(elemento_input_html, label_elemento_input_html, boton_eliminar_elemento_input_html) {\n    elemento_input_html.val('');\n    elemento_input_html.removeAttr('data-base64');\n    label_elemento_input_html.text('Ningún archivo seleccionado');\n    boton_eliminar_elemento_input_html.hide();\n\n    if (elemento_input_html.data('imagen')) {\n        $('#' + elemento_input_html.data('imagen')).val('');\n        $('#' + elemento_input_html.data('imagen') + '_previsualizacion').attr('src', '');\n        $('#' + elemento_input_html.data('imagen') + '_fondo_previsualizacion').removeClass('d-none');\n    }\n}\n\n/**\n * Definir un campo destinado a recibir un número de teléfono celular.\n *\n * Esta función debe llamarse en el evento ready del objeto global document:\n * `$(document).ready(...)`. Ademas debe incluirse un pequeño fragmento de código en la función\n * `validacionAdicional` para que se agregué el código del número de celular al valor de campo\n * cuando se envíe el formulario donde se encutra el campo.\n *\n * ```\n * if (\n *   $('#input_celular_id').length &&\n *   $('#input_celular_id').val() !== '' &&\n *   input_celular.getNumber() !== ''\n * ) {\n *   $('#input_celular_id').val(input_celular.getNumber().slice(1));\n * }\n * ```\n *\n * Donde `input_celular` es el objeto retornado por esta función.\n *\n * @param {string} input_celular_id Id del campo.\n * @param {string} nombre_input_celular Nombre del campo.\n * @param {string} placeholder_input_celular Placeholder del campo.\n * @param {boolean} obligatorio El campo es obligatorio en el formulario.\n * @returns {object}\n * @author Fahibram Cárcamo\n */\nfunction definirInputTipoCelular(input_celular_id, nombre_input_celular, placeholder_input_celular, obligatorio = true) {\n    /**\n     * 🌎 Campo para ingresar un número de telefono con selectór de código de país con banderas.\n     * Este componente se creó con la librería International Telephone Input\n     * (https://intl-tel-input.com).\n     *\n     * La linea hiddenInput: () => ({ phone: 'celular_contacto' }) tiene como función establecer el\n     * nombre del campo, es decir, la llave del par llave-valor que se adjuntará en los datos del\n     * formulario cuando se envíe, en este caso 'celular_contacto'.\n     *\n     * Las lienas autoPlaceholder: 'aggressive' y\n     * customPlaceholder: (placeholder, country) => 'Celular*' se usan para definir el placeholder\n     * del campo.\n     *\n     * Con $('#celular_contacto').attr('required', true); se establece el campo como requerido\n     * dentro del formulario, se hace de esta forma porque la librería no admite el atributo\n     * required directamente en el componente html.\n     *\n     * @author Fahibram Cárcamo\n     */\n    if (document.querySelector(`#${input_celular_id}`)) {\n        const dropdown_dinamico = document.createElement('div');\n        document.body.appendChild(dropdown_dinamico);\n\n        let campo_celular = window.intlTelInput(document.querySelector(`#${input_celular_id}`), {\n            nationalMode: true,\n            initialCountry: 'co',\n            separateDialCode: true,\n            autoInsertDialCode: false,\n            autoPlaceholder: 'aggressive',\n            dropdownContainer: dropdown_dinamico,\n            customPlaceholder: (placeholder, country) => placeholder_input_celular,\n            loadUtils: () => import('https://cdn.jsdelivr.net/npm/intl-tel-input@25.4.2/build/js/utils.js'),\n            onlyCountries: [\n                'CO', // Colombia\n                'EC', // Ecuador\n                'AR', // Argentina\n                'CL', // Chile\n                'VE', // Venezuela\n                'PE', // Perú\n                'BO', // Bolivia\n                'UY', // Uruguay\n                'PY', // Paraguay\n                'PA', // Panamá\n                'MX', // México\n                'CR', // Costa Rica\n                // 'PR', // Puerto Rico\n                'CU', // Cuba\n                // 'DO', // República Dominicana\n                'SV', // El Salvador\n                'GT', // Guatemala\n                'HN', // Honduras\n                'NI', // Nicaragua\n                'ES', // España\n                'US', // Estados Unidos\n                'GQ'  // Guinea Ecuatorial\n            ]\n        });\n\n        if (obligatorio) $(`#${input_celular_id}`).attr('required', true);\n\n        return campo_celular;\n    }\n\n    return null;\n}\n\n/**\n * Establece la validación adicional que se aplica a un campo de tipo celular antes de enviar sus\n * datos en un formulario.\n *\n * @param {HTMLInputElement} input Elemento HTML del campo de tipo celular.\n * @param {string} input_id Id del elemento HTML del campo de tipo celular.\n * @author Fahibram Cárcamo\n * @author Jair Carvajal\n */\nfunction validacionAdicionalInputTipoCelular(input, input_id) {\n    let numero_completo = input.getNumber();\n    let indicativo = '+' + input.getSelectedCountryData().dialCode;\n    let codigo_iso2_pais = input.getSelectedCountryData().iso2;\n    let numero_sin_indicativo = numero_completo.replace(indicativo, '');\n    $(`#indicativo_${input_id}`).val(indicativo);\n    $(`#codigo_iso2_pais_${input_id}`).val(codigo_iso2_pais);\n    $(`#${input_id}`).val(numero_sin_indicativo);\n}\n\n/**\n * Rellenar un input de tipo celular.\n *\n * @param {string} indicativo_celular Código del país del número de celular.\n * @param {string} codigo_pais_iso2 Código ISO2 del país del número de celular.\n * @param {string} numero_celular Número de celular sin código de país.\n * @param {string} input_celular_id ID del input de tipo celular.\n * @param {HTMLInputElement} input_celular Input de tipo celular.\n * @returns {void}\n * @author Daniel Beltrán\n * @author Fahibram Cárcamo\n */\nfunction rellenarInputCelular(indicativo_celular, codigo_pais_iso2, numero_celular, input_celular_id, input_celular) {\n    $(`#${input_celular_id}`).val(numero_celular);\n    if (![null, undefined].includes(codigo_pais_iso2)) input_celular.setCountry(codigo_pais_iso2);\n}\n\n/**\n * Convierte imágenes de base64 a Blob.\n *\n * @param {string} cadena_base_64 Base 64 de la imagen.\n * @returns {Promise<Array>}\n * @author Andres Gonzalez\n */\nfunction imagenBase64Blob(cadena_base_64) {\n    if (!cadena_base_64 || !cadena_base_64.startsWith('data:image')) return null;\n    let datos_base_64 = cadena_base_64.split(',')[1];\n    let tipo_mime = cadena_base_64.match(/data:(.*?);base64/)[1];\n    let caracteres_binarios = atob(datos_base_64);\n    let arreglo_bytes = new Array(caracteres_binarios.length).fill(0).map((_, i) => caracteres_binarios.charCodeAt(i));\n    let bytes_uint8 = new Uint8Array(arreglo_bytes);\n    return new Blob([bytes_uint8], { type: tipo_mime });\n}\n\n\n/**\n * Limpiar estructuras html innecesarias en el check editor.\n *\n * @param {string} html - Cadena HTML generada por CKEditor a limpiar\n * @returns {string} HTML limpio sin elementos específicos de CKEditor\n * @author Andres Gonzalez\n * @author Jair Carvajal\n */\nfunction limpiarHTMLCKEditor(html) {\n    // Remover todos los elementos con clases de CKEditor\n    html = html.replace(/<div class=\"ck[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n    html = html.replace(/<span class=\"[^\"]*ck[^\"]*\"[^>]*>/gi, '<span>');\n\n    // Limpiar spans de imagen inline\n    html = html.replace(/<span class=\"image-inline[^\"]*\"[^>]*>/gi, '');\n    html = html.replace(/<\\/span>/g, '');\n\n    // Remover elementos de upload y widgets\n    html = html.replace(/<div class=\"ck-image-upload[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n    html = html.replace(/<div class=\"ck-fake-selection[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n\n    // Remover atributos innecesarios\n    html = html.replace(/contenteditable=\"[^\"]*\"/gi, '');\n    html = html.replace(/data-cke-filler=\"[^\"]*\"/gi, '');\n\n    // Limpiar párrafos vacíos con br\n    html = html.replace(/<p><br[^>]*><\\/p>/gi, '');\n    html = html.replace(/<br data-cke[^>]*>/gi, '');\n\n    // Limpiar espacios múltiples y saltos de línea\n    html = html.replace(/\\s+/g, ' ');\n    html = html.replace(/>\\s+</g, '><');\n\n    return html.trim();\n}\n\n/**\n * Ordena estudios por fecha_inicio más reciente (de más nueva a más antigua).\n * Preserva los índices originales para permitir edición y eliminación correcta.\n *\n * @param {Array} estudios - Array de objetos con estudios\n * @returns {Array} Array de estudios ordenados con propiedad indice_original\n * @author Jair Carvajal\n */\nfunction ordenarEstudiosPorFecha(estudios) {\n    // Mapear con índice original\n    let estudios_con_indice = estudios.map((estudio, indice_original) => ({\n        ...estudio,\n        indice_original: indice_original\n    }));\n\n    // Ordenar estudios por fecha_inicio (más reciente primero)\n    let estudios_ordenados = estudios_con_indice.sort((a, b) => {\n        // Si ambos tienen fecha_inicio, ordenar por más reciente\n        if (a.fecha_inicio && b.fecha_inicio) {\n            return moment(b.fecha_inicio).diff(moment(a.fecha_inicio));\n        }\n        // Si solo uno tiene fecha_inicio, ese va primero\n        if (a.fecha_inicio && !b.fecha_inicio) return -1;\n        if (!a.fecha_inicio && b.fecha_inicio) return 1;\n        // Si ninguno tiene fecha_inicio, mantener orden original\n        return 0;\n    });\n\n    return estudios_ordenados;\n}\n\n/**\n * Ordena experiencias laborales por fecha: primero las que está trabajando actualmente (sin fecha_fin),\n * luego por fecha_fin más reciente.\n * Preserva los índices originales para permitir edición y eliminación correcta.\n *\n * @param {Array} experiencias - Array de objetos con experiencias laborales\n * @returns {Array} Array de experiencias ordenadas con propiedad indice_original\n * @author Jair Carvajal\n */\nfunction ordenarExperienciasPorFecha(experiencias) {\n    // Mapear con índice original\n    let experiencias_con_indice = experiencias.map((experiencia, indice_original) => ({\n        ...experiencia,\n        indice_original: indice_original\n    }));\n\n    // Ordenar experiencias\n    let experiencias_ordenadas = experiencias_con_indice.sort((a, b) => {\n        // Si 'a' no tiene fecha_fin (trabaja actualmente), va primero\n        if (!a.fecha_fin && b.fecha_fin) return -1;\n        // Si 'b' no tiene fecha_fin (trabaja actualmente), va primero\n        if (a.fecha_fin && !b.fecha_fin) return 1;\n        // Si ambos están trabajando actualmente (sin fecha_fin), mantener el orden actual\n        if (!a.fecha_fin && !b.fecha_fin) return 0;\n        // Si ambos tienen fecha_fin, ordenar por fecha más reciente primero (descendente)\n        return moment(b.fecha_fin).diff(moment(a.fecha_fin));\n    });\n\n    return experiencias_ordenadas;\n}\n\n/**\n * Obtener créditos disponibles de la empresa y actualizar el tag.\n * - Si tiene créditos >= 20% del plan: tag azul\n * - Si tiene créditos < 20% del plan: tag amarillo\n * - Si no tiene créditos: tag gris \"Sin créditos\"\n *\n * @param {number} empresa_id ID de la empresa\n * @param {string} contenedor_id ID del contenedor donde se mostrará el tag\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction obtenerCreditosDisponiblesEmpresa(empresa_id, contenedor_id = 'contenedor-tag-creditos') {\n    if (!empresa_id || !$(`#${contenedor_id}`).length) {\n        return;\n    }\n\n    $.ajax({\n        url: `/empresas/${empresa_id}/creditos`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            let creditos_disponibles = respuesta?.data?.creditos_disponibles ?? 0;\n            let creditos_plan = respuesta?.data?.creditos_plan ?? 0;\n            let plan_credito = respuesta?.data?.plan_credito;\n            let porcentaje_disponible = creditos_plan > 0 ? (creditos_disponibles / creditos_plan) * 100 : 0;\n\n            let texto_tag = '';\n            let clase_tag = '';\n            let icono_final = '';\n\n            if (creditos_disponibles <= 0 || plan_credito === null) {\n                texto_tag = 'Sin créditos';\n                clase_tag = 'tag-tonal-gray';\n                icono_final = `<i class=\"bi bi-info-circle ms-1\" role=\"button\" tabindex=\"0\" ${crearTooltip({ placement: 'right', content: 'No tienes créditos disponibles en este momento. Renueva tu plan o adquiere más créditos para continuar.' })}></i>`;\n            } else if (porcentaje_disponible < 20) {\n                texto_tag = `Créditos disponibles: ${formatearNumero(creditos_disponibles)}`;\n                clase_tag = 'tag-filled-yellow';\n                icono_final = `<i class=\"bi bi-info-circle ms-1\" role=\"button\" tabindex=\"0\" ${crearTooltip({ placement: 'right', content: 'Estás cerca de agotar tus créditos. Te queda menos del 20% del total disponible. Considera recargar o revisar tu consumo para evitar interrupciones.' })}></i>`;\n            } else {\n                texto_tag = `Créditos disponibles: ${formatearNumero(creditos_disponibles)}`;\n                clase_tag = 'tag-tonal-blue';\n            }\n\n            $(`#${contenedor_id}`).html(crearTag({\n                texto: texto_tag,\n                class: clase_tag,\n                icono_final: icono_final,\n            }));\n\n            inicializarTooltips();\n        },\n        error: function (error) {\n            $(`#${contenedor_id}`).html(crearTag({\n                texto: error.status === 404 ? 'No tienes plan de créditos' : 'Error al cargar créditos',\n                class: 'tag-tonal-gray'\n            }));\n        }\n    });\n}\n\n/**\n * Muestra Modal para informar que no cuenta con la funcionalidad\n *.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalFuncionalidadInactiva() {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Sin funcionalidad</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">No tienes esta funcionalidad activa. Por favor, contacta a tu asesor.</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'entiendo',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then(async (result) => {\n        if (result.isConfirmed) {\n            console.log(66);\n        }\n    });\n}\n","numLines":1532,"startLine":1,"totalLines":1532}},"sourceToolAssistantUUID":"c03f2e07-4f91-457a-936d-f7033e51b580"}
{"parentUuid":"80282bbd-247e-4657-9262-4a3f04a91218","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NsnSDjMdRhxMX813jaDut4","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Veo el archivo globales.js. El usuario quiere que agregue una función llamada `buscarFuncionalidad` que busque en un array de objetos por la llave de la funcionalidad y devuelva true si la encuentra y false si no.\n\nLa estructura de datos que me mostró tiene esta forma:\n```json\n{\n  \"id\": 15,\n  \"empresa_plan_id\": 27,\n  \"funcionalidad_id\": 11,\n  \"funcionalidad\": {\n    \"id\": 11,\n    \"tipo_prueba_id\": 1,\n    \"nombre\": \"Plantillas personalizadas\",\n    \"llave\": \"plantillas_personalizadas\"\n  }\n}\n```\n\nAsí que la función debe buscar por `item.funcionalidad.llave`.\n\nTambién veo que existe una variable global `configuraciones_disponibles_empresa` que se llena con la función `obtenerFuncionalidadesActivasPlan`. Esto parece ser el lugar donde se almacena la data.\n\nVoy a crear una función simple que:\n1. Reciba el array de datos y la llave a buscar\n2. Use `some()` o `find()` para buscar por `funcionalidad.llave`\n3. Devuelva true/false\n\nSiguiendo las convenciones del proyecto:\n- Funciones en español con camelCase\n- Variables en snake_case\n\nVoy a agregar la función después de `obtenerFuncionalidadesActivasPlan` ya que parece estar relacionada.","signature":"EpoKCkYICxgCKkCXrMp3L2UoeZs81fO9zOctkKlklXaeUJGmUbT3N2nJyQ9j6l5ILFiJgSyRbmxYYJ7X7YeDX8Ys14CCTXwwV9zSEgxhiuMRGSQrW5z6vy4aDOW0hzwMu01bAgBwwCIwFpsyBaETwOGPWk2m4MfSgNw+yoopKMa+7TErlxiuCEu+Hd72yCaD39zw3QyNaNUAKoEJ26ogaEEqaHkuLIbQrIZpb5lhpe+5D1k9y4/hrpIh31WfSR2qDihyd9ZCo/vPmbn0rEzZw/LXqQ45Hn6hRXwGuycpRK+hJLEFNcWiNV8kiTypW1b91p8fbo3A7NJUVbS2ZSSuQdsG2whoJm2xcRP0RDsXmwYJs6cXWvoHddDLghqDiYahuUP9/BV3/jbiW3Kc6rDogH0JV1rXln08djiiBJgPgJbN13AqVmTPPTSXCo4jp7r3skap4BdaAQYcCa7B3vX9xmF4XSmFTZyjbg8B43jxe7bn2f8tfSrWNyM81bOiR/cI9jhjQBoa3nAFLmuCJXnLwJ26cHTBYXlQgXa7uQDWjba3TQXvp+4Ykdzovd39RE5dvgH3/ESotatnp2C81o3BcKmjH45605UVl3w/3me4opJzMetESnIIwWgkY+i8xL4CPiGwOUke4QgOT0P8IRLpJgtJTPvjE2ZIDBlKD4umjCjQnL2sVlOJ1SZ+CXLz9ESvzYVNQ6Wldg6m0F0jl1M/RQ6p3ms4ap3AAqtwEF1NfHS/eXlx1+OmQ4GCFDJBozgNFffvhESjGbFWZlUwDYs5xbRd5tKNLgTg7jUzeu+8+nZnfGSRPORRzK/BTi24Gj4qOgJjfvvsjXT8UZhFCC8opetgeRrlfLfEpri48ZakNjmiOl1khU8Q4gSEIg4L33PDDOfEEOXVZ1+KygtA2VvsXfvDE3hvcz5IfaCddL+aTM3sExoHuM6ddKgpI+gro0lzSpysxZ5U8/6dud+XCmTiRn9jkL48jI+7eA5n0ScPBjpOe+a0bdQHnNzecIhz9Xz9szDNGPzI/mmNhTTbqwiQGL+TA330Q7p4fqnOVJBIZdPv7qkwGbBpA5cTYnkl7EjGVNHZFclsJE9bvbJ3RQhBmtiknc344zv5xQ6HdeSkvUBlj3a9ZahcDi7oC43fiHYrphg8TQh2LAMymFM75LGohcS0cgPZ14RhpmA+HUyBrfr6/Qn9dRLH8WexY+2Z+OwmXJIzFYqfmknw5kr11qZNExPbXmD+cvH+S0qm6XThJrOhq76wJQ12T2vQL/XKhLrZasHgM+VomuPcr3UcrIcZO91l8+wUmyrYwrx6Aglv4XVMa44wx7RiyQlSACENxHzwiHT3jZvXDx5IYGedg/aqgc0L1YnJ6/AQzkJKOZvbnELwTkhWHohrJC+jAb1Su3EYi65HDqZz5mFzj2+11VtXIqNANWaqEPZbo9GtwK3VURZR2JKYotJ+9V6DrLpjtf5EwlYR41iTtX8SwZjnBDzV76MBEBWali7g6Jy8Kh+FoH6ryylv+DltM+RifivtHom9/2SKpL423l0Clh7TuBrNADbXvPqiuELo8T3FWr9IyIwispa8XHdHVahiAAOPAhbwyavHz5jUe+TA4k4+d35aR5sSIeeuDpOc/O0ApKGZmGqY/kCWH6QitkvZfZwjBB+ZUDcowDOlJ/vLMwshA93oyysYoeL4a1dKNrOVPvOCs9ZySrR/rpbnHutzw+BLr+Vkq4exPnxoP4Hv0CTnYBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":23638,"cache_read_input_tokens":26225,"cache_creation":{"ephemeral_5m_input_tokens":23638,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXYCzee1yeFJ2EVryNByR","type":"assistant","uuid":"f85d7a6d-88e9-4cd6-bed3-8321719555c5","timestamp":"2026-01-27T16:35:36.152Z"}
{"parentUuid":"f85d7a6d-88e9-4cd6-bed3-8321719555c5","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NsnSDjMdRhxMX813jaDut4","type":"message","role":"assistant","content":[{"type":"text","text":"Voy a agregar la función `buscarFuncionalidad` que busca por la llave en el array de funcionalidades."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":23638,"cache_read_input_tokens":26225,"cache_creation":{"ephemeral_5m_input_tokens":23638,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXYCzee1yeFJ2EVryNByR","type":"assistant","uuid":"045a0932-ca4f-45b6-8a78-dd36e02c9c25","timestamp":"2026-01-27T16:35:36.677Z"}
{"parentUuid":"045a0932-ca4f-45b6-8a78-dd36e02c9c25","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NsnSDjMdRhxMX813jaDut4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01E29rbwA1BvEkFsyG2gh9aP","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\globales.js","old_string":"function obtenerFuncionalidadesActivasPlan(tipo_prueba_id = null) {\n    let parametros = {};\n\n    if (tipo_prueba_id !== null) {\n        parametros.tipo_prueba_id = tipo_prueba_id;\n    }\n\n    return $.ajax({\n        url: '/funcionalidades-activas-plan',\n        method: 'GET',\n        dataType: 'json',\n        data: parametros,\n        success: function(respuesta) {\n            configuraciones_disponibles_empresa = respuesta?.data ?? [];\n        },\n        error: function(error) {\n            console.error('Error al obtener funcionalidades activas del plan:', error);\n            configuraciones_disponibles_empresa = [];\n        }\n    });\n}","new_string":"function obtenerFuncionalidadesActivasPlan(tipo_prueba_id = null) {\n    let parametros = {};\n\n    if (tipo_prueba_id !== null) {\n        parametros.tipo_prueba_id = tipo_prueba_id;\n    }\n\n    return $.ajax({\n        url: '/funcionalidades-activas-plan',\n        method: 'GET',\n        dataType: 'json',\n        data: parametros,\n        success: function(respuesta) {\n            configuraciones_disponibles_empresa = respuesta?.data ?? [];\n        },\n        error: function(error) {\n            console.error('Error al obtener funcionalidades activas del plan:', error);\n            configuraciones_disponibles_empresa = [];\n        }\n    });\n}\n\n/**\n * Busca una funcionalidad por su llave en el array de funcionalidades.\n *\n * @param {string} llave Llave de la funcionalidad a buscar.\n * @param {Array|null} funcionalidades Array de funcionalidades (opcional, usa configuraciones_disponibles_empresa por defecto).\n * @returns {boolean} True si encuentra la funcionalidad, false en caso contrario.\n * @author Claude Code\n */\nfunction buscarFuncionalidad(llave, funcionalidades = null) {\n    let data = funcionalidades ?? configuraciones_disponibles_empresa;\n\n    if (!Array.isArray(data) || data.length === 0) {\n        return false;\n    }\n\n    return data.some(item => item?.funcionalidad?.llave === llave);\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":23638,"cache_read_input_tokens":26225,"cache_creation":{"ephemeral_5m_input_tokens":23638,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CXYCzee1yeFJ2EVryNByR","type":"assistant","uuid":"f4afe8e0-a3b5-481d-8822-8b933fed4add","timestamp":"2026-01-27T16:35:43.098Z"}
{"type":"file-history-snapshot","messageId":"f4afe8e0-a3b5-481d-8822-8b933fed4add","snapshot":{"messageId":"ac658136-2543-44e8-a978-cdb0f0c582fd","trackedFileBackups":{"public\\js\\globales.js":{"backupFileName":"704f632e999527e6@v1","version":1,"backupTime":"2026-01-27T16:37:12.066Z"}},"timestamp":"2026-01-27T16:35:17.267Z"},"isSnapshotUpdate":true}
{"parentUuid":"f4afe8e0-a3b5-481d-8822-8b933fed4add","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01E29rbwA1BvEkFsyG2gh9aP","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\globales.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n    43→ * @param {number|null} tipo_prueba_id ID del tipo de prueba (opcional).\n    44→ * @returns {Promise} Promesa que se resuelve con las funcionalidades activas.\n    45→ * @author Andres Gonzalez\n    46→ */\n    47→function obtenerFuncionalidadesActivasPlan(tipo_prueba_id = null) {\n    48→    let parametros = {};\n    49→\n    50→    if (tipo_prueba_id !== null) {\n    51→        parametros.tipo_prueba_id = tipo_prueba_id;\n    52→    }\n    53→\n    54→    return $.ajax({\n    55→        url: '/funcionalidades-activas-plan',\n    56→        method: 'GET',\n    57→        dataType: 'json',\n    58→        data: parametros,\n    59→        success: function(respuesta) {\n    60→            configuraciones_disponibles_empresa = respuesta?.data ?? [];\n    61→        },\n    62→        error: function(error) {\n    63→            console.error('Error al obtener funcionalidades activas del plan:', error);\n    64→            configuraciones_disponibles_empresa = [];\n    65→        }\n    66→    });\n    67→}\n    68→\n    69→/**\n    70→ * Busca una funcionalidad por su llave en el array de funcionalidades.\n    71→ *\n    72→ * @param {string} llave Llave de la funcionalidad a buscar.\n    73→ * @param {Array|null} funcionalidades Array de funcionalidades (opcional, usa configuraciones_disponibles_empresa por defecto).\n    74→ * @returns {boolean} True si encuentra la funcionalidad, false en caso contrario.\n    75→ * @author Claude Code\n    76→ */\n    77→function buscarFuncionalidad(llave, funcionalidades = null) {\n    78→    let data = funcionalidades ?? configuraciones_disponibles_empresa;\n    79→\n    80→    if (!Array.isArray(data) || data.length === 0) {\n    81→        return false;\n    82→    }\n    83→\n    84→    return data.some(item => item?.funcionalidad?.llave === llave);\n    85→}\n    86→\n    87→/**\n    88→ * Mostrar modal de créditos IA\n    89→ *"}]},"uuid":"4f17d64f-c7c4-4dc4-b38e-cc30016aba8f","timestamp":"2026-01-27T16:37:12.116Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\globales.js","oldString":"function obtenerFuncionalidadesActivasPlan(tipo_prueba_id = null) {\n    let parametros = {};\n\n    if (tipo_prueba_id !== null) {\n        parametros.tipo_prueba_id = tipo_prueba_id;\n    }\n\n    return $.ajax({\n        url: '/funcionalidades-activas-plan',\n        method: 'GET',\n        dataType: 'json',\n        data: parametros,\n        success: function(respuesta) {\n            configuraciones_disponibles_empresa = respuesta?.data ?? [];\n        },\n        error: function(error) {\n            console.error('Error al obtener funcionalidades activas del plan:', error);\n            configuraciones_disponibles_empresa = [];\n        }\n    });\n}","newString":"function obtenerFuncionalidadesActivasPlan(tipo_prueba_id = null) {\n    let parametros = {};\n\n    if (tipo_prueba_id !== null) {\n        parametros.tipo_prueba_id = tipo_prueba_id;\n    }\n\n    return $.ajax({\n        url: '/funcionalidades-activas-plan',\n        method: 'GET',\n        dataType: 'json',\n        data: parametros,\n        success: function(respuesta) {\n            configuraciones_disponibles_empresa = respuesta?.data ?? [];\n        },\n        error: function(error) {\n            console.error('Error al obtener funcionalidades activas del plan:', error);\n            configuraciones_disponibles_empresa = [];\n        }\n    });\n}\n\n/**\n * Busca una funcionalidad por su llave en el array de funcionalidades.\n *\n * @param {string} llave Llave de la funcionalidad a buscar.\n * @param {Array|null} funcionalidades Array de funcionalidades (opcional, usa configuraciones_disponibles_empresa por defecto).\n * @returns {boolean} True si encuentra la funcionalidad, false en caso contrario.\n * @author Claude Code\n */\nfunction buscarFuncionalidad(llave, funcionalidades = null) {\n    let data = funcionalidades ?? configuraciones_disponibles_empresa;\n\n    if (!Array.isArray(data) || data.length === 0) {\n        return false;\n    }\n\n    return data.some(item => item?.funcionalidad?.llave === llave);\n}","originalFile":"// Mensajes en español para el plugin Select2\nconst mensajes_select2 = {\n    'noResults'              : () => { return 'No hay resultados para la búsqueda.'; },\n    'searching'              : () => { return 'Buscando...'; },\n    'Loading'                : () => { return 'Cargando...'; },\n    'loadingMore'            : () => { return 'Cargando más resultados...'; },\n    'dropdownFooter'         : (texto) => { return `Mostrando ${texto} resultados`; },\n    'emptyOptions'           : () => { return 'No hay opciones disponibles.'; },\n    'appendItems'            : (items) => { return `Agregando ${items.length} elementos.`; },\n    'maximumSelectionReached': () => { return 'Se ha alcanzado el número máximo de selecciones.'; },\n    'selectOnClose'          : () => { return 'Seleccione una opción al cerrar el menú.'; },\n    'escapeKeyUp'            : () => { return 'Presione \\'Escape\\' para cerrar el menú.'; },\n    'errorLoading'           : () => { return 'Error al cargar datos. Inténtalo de nuevo más tarde.'; },\n    'inputTooShort'          : (elemento) => { return `Ingresa al menos ${elemento.minimum} caracteres para iniciar una búsqueda.`; },\n    'noMatches'              : () => { return 'No se encontraron coincidencias para tu búsqueda.'; },\n    'allowClear'             : () => { return 'Borrar selección'; },\n    'SelectionTooLong'       : (conteo, maximo) => { return `Solo puedes seleccionar ${maximo} opciones.`; },\n    'loadMore'               : () => { return 'Cargando más resultados...'; },\n    'removing'               : (seleccion) => { return 'Eliminando...'; },\n    'matches'                : (coincidencias, total) => {\n        if (coincidencias === 0) {\n            return 'No hay coincidencias.';\n        } else if (coincidencias === 1) {\n            return 'Se encontró 1 coincidencia.';\n        } else {\n            return `Se encontraron ${coincidencias} coincidencias entre ${total}.`;\n        }\n    }\n};\n\n// audios\nvar audio_notificacion = new Audio('/audios/notificacion.mp3');\n\nlet mostro_modal_creditos_ia = false;\nlet funcion_ejecucion_ia = null;\nlet modals_abiertos_ia = null;\n\nlet configuraciones_disponibles_empresa = [];\n\n/**\n * Obtiene las funcionalidades activas del plan vigente de la empresa del usuario actual.\n *\n * @param {number|null} tipo_prueba_id ID del tipo de prueba (opcional).\n * @returns {Promise} Promesa que se resuelve con las funcionalidades activas.\n * @author Andres Gonzalez\n */\nfunction obtenerFuncionalidadesActivasPlan(tipo_prueba_id = null) {\n    let parametros = {};\n\n    if (tipo_prueba_id !== null) {\n        parametros.tipo_prueba_id = tipo_prueba_id;\n    }\n\n    return $.ajax({\n        url: '/funcionalidades-activas-plan',\n        method: 'GET',\n        dataType: 'json',\n        data: parametros,\n        success: function(respuesta) {\n            configuraciones_disponibles_empresa = respuesta?.data ?? [];\n        },\n        error: function(error) {\n            console.error('Error al obtener funcionalidades activas del plan:', error);\n            configuraciones_disponibles_empresa = [];\n        }\n    });\n}\n\n/**\n * Mostrar modal de créditos IA\n *\n * @return void\n * @author José Manuel Jiménez\n */\nfunction mostrarModalCreditosIA(servicio_ia_id) {\n    $.ajax({\n        url: `/empresas/${$('#empresa_sesion_id').val()}/creditos`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta_empresa) {\n            if (respuesta_empresa?.data?.creditos_disponibles > 0) {\n                $.ajax({\n                    url: `/servicios-ia/${servicio_ia_id}/creditos`,\n                    method: 'GET',\n                    dataType: 'json',\n                    success: function(respuesta) {\n                        if (respuesta?.data?.consume_creditos && respuesta?.data?.consume_creditos <= respuesta_empresa.data.creditos_disponibles) {\n                            $('#cantidad-creditos-descontar-modal').text(respuesta.data.consume_creditos);\n                            $('#modal-consumo-creditos-ia').modal('show');\n                            mostro_modal_creditos_ia = true;\n                            modals_abiertos_ia = $('.modal.show').not('#modal-consumo-creditos-ia').not('#modal-generando-ia');\n                            $(modals_abiertos_ia).addClass('d-none');\n                        } else {\n                            mostrarToastSolicitarCreditosIA();\n                        }\n                    }\n                });\n            } else {\n                mostrarToastSolicitarCreditosIA();\n            }\n        }\n    });\n}\n\n/**\n * Mostrar toast para solicitar créditos IA\n *\n * @return void\n * @author José Manuel Jiménez\n */\nfunction mostrarToastSolicitarCreditosIA() {\n    $.ajax({\n        url: `/empresas/${$('#empresa_sesion_id').val()}`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            let adicional_toast = '';\n            if (respuesta?.data?.ejecutivo?.telefono) {\n                adicional_toast = `<a href=\"https://wa.me/${respuesta.data.ejecutivo.telefono.replace(/\\D/g, '')}?text=Hola,%20me%20gustar%C3%ADa%20solicitar%20cr%C3%A9ditos%20adicionales%20para%20mi%20empresa.\" target=\"_blank\">\n                    <p class=\"text-label-1 text-white no-visited text-decoration-none mb-0\">Solicitar</p>\n                </a>`;\n            }\n            setTimeout(() => {\n                $('#modal-generando-ia').modal('hide');\n                $('#modal-cargue-ia').modal('hide');\n                mostrarToast('danger', 'No cuentas con créditos. Solicita créditos adicionales.', '', adicional_toast);\n            }, 300);\n        }\n    });\n}\n\n/**\n * Continuar ejecución IA luego del modal de créditos\n *\n * @return void\n * @author José Manuel Jiménez\n */\nfunction continuarEjecucionIA() {\n    if (funcion_ejecucion_ia) {\n        funcion_ejecucion_ia();\n        funcion_ejecucion_ia = null;\n    }\n    mostro_modal_creditos_ia = false;\n    $('#modal-consumo-creditos-ia').modal('hide');\n}\n\n/**\n * Solicitar más créditos IA\n *\n * @return void\n * @author José Manuel Jiménez\n */\nfunction solicitarMasCreditosIA() {\n    $.ajax({\n        url: `/empresas/${$('#empresa_sesion_id').val()}`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            if (respuesta?.data?.ejecutivo?.telefono) {\n                window.open(`https://wa.me/${respuesta.data.ejecutivo.telefono.replace(/\\D/g, '')}?text=Hola,%20me%20gustar%C3%ADa%20solicitar%20cr%C3%A9ditos%20adicionales%20para%20mi%20empresa.`, '_blank');\n            } else {\n                mostrarToast('danger', 'No se encontró un ejecutivo asignado a la empresa. Por favor, comunícate con soporte para recargar créditos.');\n            }\n            $('#modal-solicitar-mas-creditos-ia').modal('hide');\n        }\n    });\n}\n\n/**\n * Validar respuesta de créditos IA\n *\n * @return void\n * @author José Manuel Jiménez\n */\nfunction validarRespuestaCreditosIA(error_ia) {\n    if (error_ia == 'No tienes créditos disponibles en este momento. Renueva tu plan o adquiere más créditos para continuar.') {\n        mostrarToastSolicitarCreditosIA();\n        return true;\n    }\n    return false;\n}\n\n/**\n * Ajustar el ancho de los elementos select2 asincrono multiple.\n *\n * @returns {void}\n * @author Andres Morales\n */\n$(document).ready(function () {\n    cargarNotificiacionesHeader();\n    if (window.configuracion_reverbg && window.configuracion_reverbg.activar_websocket) {\n        configurarWebSocketNotificaciones();\n    }\n    setTimeout(() => {\n        $(\".input-container\").each(function () {\n            let $container = $(this);\n            let $select = $container.find(\"select[multiple]\");\n            let $icon = $container.find(\".input-icono1\");\n            if ($select.length && $icon.length) {\n                $(this).find('.select2-selection--multiple').addClass('ps-5')\n            }\n        });\n    }, 1000);\n    $('#modal-consumo-creditos-ia').on('hidden.bs.modal', function () {\n        if (mostro_modal_creditos_ia) {\n            $(modals_abiertos_ia).removeClass('d-none');\n        }\n        mostro_modal_creditos_ia = false;\n    });\n\n    // Cargar créditos disponibles si existe el contenedor y el ID de empresa\n    if ($('#contenedor-tag-creditos').length && $('#empresa_sesion_id').length) {\n        obtenerCreditosDisponiblesEmpresa($('#empresa_sesion_id').val());\n    }\n});\n\n/**\n * Formatear fecha a formato dd/mm/yyyy - hh:mm AM/PM.  Ejemplo: 01/Feb/2022 - 12:00 PM\n *\n * @param {string} fecha_entrada fecha en formato ISO\n * @returns {string} fecha y hora formateada\n * @author Andres Morales\n */\nfunction formatearFecha(fecha_entrada) {\n    var fecha = new Date(fecha_entrada);\n    var dia = fecha.getDate();\n    var mes = fecha.toLocaleString('es-ES', { month: 'short' });\n    var anio = fecha.getFullYear();\n    let hora = fecha.getHours();\n    let minuto = fecha.getMinutes();\n    let ampm = hora >= 12 ? 'PM' : 'AM';\n    hora = hora % 12 || 12;\n    minuto = minuto.toString().padStart(2, '0');\n    return `${dia}/${mes}/${anio} - ${hora}:${minuto} ${ampm}`;\n}\n\nfunction formatearFecha2(fecha_entrada) {\n    let partes = fecha_entrada.split(' ');\n    let fecha = partes[0].split('-');\n    let hora = partes[1];\n    let fechaISO = `${fecha[2]}-${fecha[1]}-${fecha[0]}T${hora}`;\n\n    let date = new Date(fechaISO);\n\n    if (isNaN(date.getTime())) {\n        return 'Fecha inválida';\n    }\n\n    let dia = date.getDate();\n    let mes = date.toLocaleString('eu-EU', { month: 'short' });\n    let anio = date.getFullYear();\n    return `${dia}/${mes}/${anio}`;\n}\n\n/**\n * Opción para contraer o agrandar el menú principal\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction contraerMenu() {\n    if ($('.sidebar-menu').hasClass('close')) {\n        $('.sidebar-menu').removeClass('d-none');\n        localStorage.setItem('opcion_menu_storage', 'abierto');\n        $('#btn-collapse').attr('data-bs-original-title', 'Contraer');\n        $('#btn-collapse').attr('data-bs-title', 'Contraer');\n        $(\".menu-bar\").each(function() {\n            $(this).removeClass(\"px-2\").addClass(\"px-5\");\n        });\n        $('[data-bs-toggle=\"tooltip\"]').each(function () { new bootstrap.Tooltip(this); });\n        $('.lista-primary[data-bs-toggle=\"tooltip\"]').each(function () {\n            var tooltip_instancia = bootstrap.Tooltip.getInstance(this);\n            if (tooltip_instancia) {\n                tooltip_instancia.dispose();\n            }\n        });\n    } else {\n        $('.sidebar-menu').addClass('d-none');\n        localStorage.setItem('opcion_menu_storage', 'cerrado');\n        $('#btn-collapse').attr('data-bs-original-title', 'Expandir');\n        $('#btn-collapse').attr('data-bs-title', 'Expandir');\n        $(\".menu-bar\").each(function() {\n            $(this).removeClass(\"px-5\").addClass(\"px-2\");\n        });\n        $('[data-bs-toggle=\"tooltip\"]').each(function () { new bootstrap.Tooltip(this); });\n    }\n    $('.tooltip.bs-tooltip-auto').remove();\n    $('.sidebar-menu').toggleClass('close');\n    $('.contenedor-vista').toggleClass('close');\n    $('#btn-collapse').toggleClass('close');\n    $('.nombre-usuario-empresa').toggle();\n    $('.menu-bar .text-menu').toggle();\n}\n\n/**\n * Opción para abrir o cerrar el menu segun la elección guardada\n *\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Morales\n */\nfunction mostrarMenuStorage() {\n    $(document).ready(function() {\n        $('.lista-primary[data-bs-toggle=\"tooltip\"]').each(function () {\n            var tooltip_instancia = bootstrap.Tooltip.getInstance(this);\n            if (tooltip_instancia) {\n                tooltip_instancia.dispose();\n            }\n        });\n\n        if (window.innerWidth < 768) {\n            localStorage.setItem('opcion_menu_storage', 'cerrado');\n        }\n\n        if (localStorage.getItem('opcion_menu_storage') === 'cerrado') {\n            contraerMenu();\n        }\n        let $active = $('.menu-bar .active');\n\n        if ($active.length) {\n            $('.menu-bar').scrollTop($active.position().top);\n        }\n    });\n}\nmostrarMenuStorage();\n\n/**\n * Funcion para hacer el slug de un texto desde jquery.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction slugify(text) {\n    return $.trim(text)\n        .toLowerCase()\n        .normalize(\"NFD\")\n        .replace(/[\\u0300-\\u036f]/g, \"\")\n        .replace(/[^a-z0-9 -]/g, \"\")\n        .replace(/\\s+/g, \"-\")\n        .replace(/-+/g, \"-\");\n}\n\n/**\n * Función generica para mostrar mensajes de respuesta\n *\n * @param {string} tipo_alerta define el color de la alerta segun alerts de botstrap.\n * @param {string} texto_1 Texto que mostrara la alerta.\n * @param {string} texto_2 Texto secundario en la alerta.\n * @param {string} accion Acción adicional(por definir).\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Andres Gonzalez\n */\nfunction mostrarToast(tipo_alerta, texto_1, texto_2 = '', accion = '', icono2 = '') {\n    let icono = '';\n    let texto_color = 'text-white';\n    if (accion != '') {\n        accion = `<div class=\"col-auto p-0 text-label-1\">${accion}</div>`;\n    }\n\n    if (tipo_alerta == 'success') {\n        icono = 'bi bi-check-circle';\n    }\n\n    if (tipo_alerta == 'neutral') {\n        icono = 'bi bi-info-circle';\n    }\n\n    if (tipo_alerta == 'warning') {\n        icono = 'bi bi-info-circle';\n        texto_color = \"text-red-letras\";\n    }\n\n    if (tipo_alerta == 'danger') {\n        icono = 'bi bi-x-circle';\n    }\n\n    if (icono2 != '') {\n        icono = icono2;\n    }\n\n    if (texto_2 != '') {\n        texto_2 = `<div class=\"col-12 p-0 text-label-1 ${texto_color}\">${texto_2}</div>`;\n    }\n\n    let alert_toast = $(`\n        <div class=\"alert toast-${tipo_alerta} alert-dismissible fade show d-flex align-items-center pe-3 py-3 me-3\" role=\"alert\" style=\"display:none\">\n            <div class=\"col-auto\">\n                <span class=\"${icono} ${texto_color}\"></span>\n            </div>\n            <div class=\"col px-3\">\n                <div class=\"row m-0 ${texto_color}\">\n                    <div class=\"col-12 p-0 text-label-1 ${texto_color}\">\n                        ${texto_1}\n                    </div>\n                    ${texto_2}\n                </div>\n            </div>\n            ${accion}\n            <div class=\"col-auto ms-3 pointer\" data-bs-dismiss=\"alert\">\n                <span class=\"bi bi-x ${texto_color}\"></span>\n            </div>\n        </div>\n    `);\n    $('#contenedor-alert-toast').append(alert_toast);\n    alert_toast.fadeIn();\n    setTimeout(function() {\n        alert_toast.fadeOut();\n        alert_toast.alert('close');\n    }, 5000);\n}\n\n/**\n * Formatear número.\n *\n * @param {number} numero número a formatear\n * @author Andres Morales\n */\nfunction formatearNumero(numero) {\n    return parseInt(numero).toLocaleString('es-ES');\n}\n\n/**\n * Formatear fecha.\n *\n * @param {*} fecha Fecha a formatear.\n * @param {boolean} incluir_segundos Indica si se debe incluir los segundos en la hora.\n * @param {string} formato Formato en el que se retornará la fecha.\n * @param {string} separador Símbolo que se usará para separar días, meses y años.\n * @returns {Object} Objeto con la fecha y hora formateada.\n * @author Daniel Beltrán\n */\nfunction formatearFechaConceptual(fecha, incluir_segundos = false, formato = 'Ymd', separador = '-') {\n    const NUEVA_FECHA = new Date(fecha);\n    const ANO         = NUEVA_FECHA.getFullYear();\n    const MES         = String(NUEVA_FECHA.getMonth() + 1).padStart(2, '0');\n    const DIA         = String(NUEVA_FECHA.getDate()).padStart(2, '0');\n    const HORAS       = String(NUEVA_FECHA.getHours()).padStart(2, '0');\n    const MINUTOS     = String(NUEVA_FECHA.getMinutes()).padStart(2, '0');\n    const SEGUNDOS    = String(NUEVA_FECHA.getSeconds()).padStart(2, '0');\n\n    let fecha_formateada = `${ANO}${separador}${MES}${separador}${DIA}`;\n\n    if (formato === 'dmY') {\n        fecha_formateada = `${DIA}${separador}${MES}${separador}${ANO}`;\n    }\n\n    return {\n        fecha: fecha_formateada,\n        hora : incluir_segundos ? `${HORAS}:${MINUTOS}:${SEGUNDOS}` : `${HORAS}:${MINUTOS}`\n    };\n}\n\n/**\n * Formatear fecha a May. 2023.\n *\n * @param {string} fechaISO Fecha a formatear.\n * @returns {string} Objeto con la fecha y hora formateada.\n * @author Andres Morales\n */\nfunction formatearFechaAnioMes(fechaISO) {\n    const fecha = new Date(fechaISO);\n    const opciones = { month: 'short', year: 'numeric' };\n    let fecha_formateada = fecha.toLocaleDateString('es-ES', opciones);\n\n    fecha_formateada = fecha_formateada.replace(\n        /^([a-zñ]+)(\\s\\d{4})$/,\n        (_, mes, anio) => `${mes.charAt(0).toUpperCase() + mes.slice(1)}. ${anio.trim()}`\n    );\n\n    return fecha_formateada;\n}\n\n/**\n * Formatear un numero a moneda.\n *\n * @param {string} valor Numero.\n * @returns {string} Numero formateado.\n * @author Andres Morales\n */\nfunction formatearMonedaCOP(valor) {\n    return new Intl.NumberFormat('es-CO', {\n        style: 'currency',\n        currency: 'COP',\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0\n    }).format(valor);\n}\n\n/**\n * Formatear fecha a un formato d/m/Y hh:mm:ss entendible para el usuario.\n *\n * @param {*} fecha_inicial Fecha a formatear.\n * @returns {String} String con la fecha y hora formateada.\n * @author José Manuel Jiménez\n */\nfunction fechaMostrar(fecha_inicial) {\n    if (!fecha_inicial) {\n        return \"\";\n    }\n    const fecha = new Date(fecha_inicial);\n    if (isNaN(fecha.getTime())) {\n        return \"\";\n    }\n    const dia = String(fecha.getUTCDate()).padStart(2, '0');\n    const mes = String(fecha.getUTCMonth() + 1).padStart(2, '0');\n    const anio = fecha.getUTCFullYear();\n    if (!fecha_inicial.includes(\" \")) {\n        return `${dia}/${mes}/${anio}`;\n    }\n    const horas = String(fecha.getUTCHours()).padStart(2, '0');\n    const minutos = String(fecha.getUTCMinutes()).padStart(2, '0');\n    const segundos = String(fecha.getUTCSeconds()).padStart(2, '0');\n    return `${dia}/${mes}/${anio} ${horas}:${minutos}:${segundos}`;\n}\n\n/**\n * Descargar Excel.\n *\n * @param {string} ruta Ruta desde donde se descarga el archivo.\n * @param {string} nombre_archivo Nombre del archivo descargado.\n * @param {boolean} marca_tiempo Indica si el nombre del archivo debe llevar marca de tiempo.\n * @param {Object} parametros Parámetros a enviar en la petición.\n * @returns {void}\n * @author Daniel Beltrán\n */\nasync function descargarExcel(ruta, nombre_archivo, marca_tiempo = true, parametros = {}) {\n    parametros._token = $('meta[name=\"csrf-token\"]').attr('content');\n\n    await $.ajax({\n        type     : 'POST',\n        url      : `/${ruta}`,\n        data     : parametros,\n        xhrFields: {\n            responseType: 'blob'\n        },\n        success: function (respuesta) {\n            // Crear una URL para el Blob\n            let url = window.URL.createObjectURL(respuesta); // 'respuesta' es el Blob\n            let a   = document.createElement('a'); // Crea un nuevo elemento <a> para iniciar la descarga\n            a.href  = url;\n            const fecha_actual     = new Date();\n            const dia              = fecha_actual.getDate();\n            const mes              = fecha_actual.getMonth() + 1;\n            const ano              = fecha_actual.getFullYear();\n            const hora             = fecha_actual.getHours();\n            const minutos          = fecha_actual.getMinutes();\n            const segundos         = fecha_actual.getSeconds();\n            const fecha_formateada = `${dia}${mes}${ano}${hora}${minutos}${segundos}`;\n\n            a.download = marca_tiempo ? `${nombre_archivo}-${fecha_formateada}.xlsx` : `${nombre_archivo}.xlsx`;\n            document.body.appendChild(a);\n            a.click();\n            window.URL.revokeObjectURL(url);\n            document.body.removeChild(a);\n        }\n    }).then(() => {\n        mostrarToast('success', 'Archivo descargado correctamente.');\n    }).catch((error) => {\n        mostrarToast('danger', 'Ocurrió un error al descargar el archivo.');\n    });\n}\n\n/**\n * Convierte un string a slug.\n *\n * @param {string} str\n * @returns {string}\n * @author Fahibram Cárcamo\n */\nfunction slug(str) {\n\n    // Quita espacios en blanco\n    str = str.replace(/^\\s+|\\s+$/g, \"\")\n\n    // Convierte el string a minusculas\n    str = str.toLowerCase()\n\n    // Quita los caracteres no alfanuméricos\n    str = str.replace(/[^a-z0-9 -]/g, \"\")\n\n    // Reemplaza los espacio con guiones\n    str = str.replace(/\\s+/g, \"-\")\n\n    // Remueve los guiones consecutivos\n    str = str.replace(/-+/g, \"-\")\n\n    return str\n}\n\n/**\n * Compara los elementos de dos arreglos y retorna `true` si son iguales y `false` en caso contrario\n * (Este función está pensada para comparar arreglos unidimensionales).\n *\n * @param {array} primer_arreglo\n * @param {array} segundo_arreglo\n * @param {boolean} comparar_orden\n * @return {boolean}\n * @author Fahibram Cárcamo\n */\nfunction sonArreglosIguales(primer_arreglo, segundo_arreglo, comparar_orden = false) {\n\n    if (!comparar_orden) {\n        primer_arreglo.sort()\n        segundo_arreglo.sort()\n    }\n\n    if (primer_arreglo.length !== segundo_arreglo.length) return false\n\n    for (let i = 0; i < primer_arreglo.length; i++) {\n        if (primer_arreglo[i] !== segundo_arreglo[i]) return false\n    }\n\n    return true\n}\n\n/**\n * Función para cambiar de empresa.\n *\n * @param {number} empresa_id ID de la empresa a la que se va a cambiar.\n * @returns {void}\n * @author José Manuel Jiménez\n * @author Daniel Beltrán\n */\nfunction cambiarEmpresa(empresa_id) {\n    $.ajax({\n        type: 'POST',\n        url: '/suplantar-rol-admin-general',\n        data: {\n            _token    : $('meta[name=\"csrf-token\"]').attr('content'),\n            empresa_id: empresa_id\n        },\n        success: function (respuesta) {\n            localStorage.setItem('notificacionToast', JSON.stringify({\n                tipo_alerta: 'success',\n                texto_1    : 'Cambio de empresa exitoso'\n            }));\n\n            window.location.reload();\n        },\n        error: function (error) {\n            mostrarToast('danger', 'Ocurrió un error al cambiar de empresa');\n        }\n    });\n}\n\n/**\n * Enviar la solucitud de suplantación de rol y empresa al Back-end.\n *\n * @param {function|null} callback_exito Callback ejecutado en caso de éxito.\n * @param {string} url URL de suplantación.\n * @param {string} _token Token CSRF del formulario.\n * @param {number} empresa_id Id de la empresa a suplantar.\n * @param {number|null} rol_id Id del rol a suplantar.\n * @param {function|null} callback_error Callback ejecutado en caso de error.\n * @returns {void}\n * @author Fahibram Cárcamo\n */\nasync function enviarOrdenSuplantacionRolEmpresa (callback_exito, url, _token, empresa_id = null, rol_id = null, callback_error = null) {\n\n    let condicion_suplantacion = rol_id === null\n        ? empresa_id === null\n            ? true\n            : parseInt($('#empresa_sesion_id').val()) !== parseInt(empresa_id)\n        : parseInt($('#rol_sesion_id').val()) !== parseInt(rol_id) && parseInt($('#empresa_sesion_id').val()) !== parseInt(empresa_id);\n\n    if (condicion_suplantacion) {\n        let data = { _token };\n        if (empresa_id !== null) data.empresa_id = empresa_id;\n        if (rol_id !== null) data.rol_id = rol_id;\n\n        await $.ajax({ type: 'POST', url, data })\n            .then((respuesta, status, xhr) => {\n                if (xhr.status >= 200 && xhr.status < 300 && callback_exito !== null) callback_exito();\n            })\n            .catch(error => {\n                let swal_titulo, swal_texto;\n\n                if (error.status === 404) {\n                    if (error.responseJSON.mensaje) {\n                        swal_titulo = 'Algo salió mal';\n                        if (error.responseJSON.mensaje === 'no existe rol_suplantar') {\n                            swal_texto = 'El rol no existe.';\n                        } else if (error.responseJSON.mensaje === 'no existe empresa_suplantar') {\n                            swal_texto = 'La empresa no existe.';\n                        } else if (error.responseJSON.mensaje === 'no existe usuario_suplantar') {\n                            swal_texto = 'El usuario no existe.';\n                        } else {\n                            swal_texto = '';\n                        }\n                    } else if (error.responseJSON.empresa && error.responseJSON.rol) {\n                        swal_titulo = 'No fué posible cambiar de empresa';\n                        swal_texto = error.responseJSON.rol === 'Administrador general' || error.responseJSON.rol === 'Propietario'\n                            ? `La empresa ${error.responseJSON.empresa} no tiene ningún usuario con el rol Administrador general o Propietario.`\n                            : `La empresa ${error.responseJSON.empresa} no tiene ningún usuario con el rol ${error.responseJSON.rol}.`;\n                    } else {\n                        swal_titulo = 'Algo salió mal';\n                        swal_texto = error.responseJSON.errors;\n                    }\n                } else {\n                    swal_titulo = 'Algo salió mal';\n                    swal_texto = '';\n                }\n\n                if (callback_error !== null) callback_error();\n\n                Swal.fire({\n                    title: swal_titulo,\n                    text: swal_texto,\n                    icon: \"error\",\n                    confirmButtonText: \"Aceptar\"\n                });\n            });\n    }\n}\n\n/**\n * Mostrar tooltip según el div que lo contenga.\n *\n * @param {div} div Elemento en donde se va a mostrar el tooltip.\n * @returns {void}\n * @author Sol Espitia\n */\nfunction mostrarTooltip(div) {\n    const TOOLTIP         = div.querySelector('.tooltip-x');\n    TOOLTIP.style.display = 'block';\n}\n\n/**\n * Ocultar tooltip según el div que lo contenga.\n *\n * @param {div} div Elemento en donde se va a mostrar el tooltip.\n * @returns {void}\n * @author Sol Espitia\n */\nfunction ocultarTooltip(div) {\n    const TOOLTIP         = div.querySelector('.tooltip-x');\n    TOOLTIP.style.display = 'none';\n}\n\n/**\n * Retornar la diferencia en días de dos fechas dadas.\n *\n * @param {string} fecha_inicial Fecha inicial\n * @param {string} fecha_final Fecha final\n * @param {bool} valor_absoluto Retorna la diferencia en valor absoluto\n * @returns {number}\n * @author Fahibram Cárcamo\n * @author Andres Morales\n */\nfunction diferenciaFechasDias(fecha_inicial, fecha_final, valor_absoluto = false, sumar_dia = true) {\n    let fecha1 = new Date(fecha_inicial);\n    let fecha2 = new Date(fecha_final);\n\n    fecha1.setHours(0, 0, 0, 0);\n    fecha2.setHours(0, 0, 0, 0);\n\n    let diferencia_milisegundos = fecha2.getTime() - fecha1.getTime();\n\n    let diferencia_dias = diferencia_milisegundos / (1000 * 60 * 60 * 24);\n    let resultado = diferencia_dias;\n    if (sumar_dia) {\n        resultado = diferencia_dias + 1;\n    }\n\n    return valor_absoluto ? Math.abs(resultado) : resultado;\n}\n\n/**\n * Retornar `true` si una fecha dada está dentro de un rango de fechas dadas, `false` en otro caso.\n *\n * @param {string} fecha Fecha dada\n * @param {string} fecha_desde Fecha inicial del rango\n * @param {string} fecha_hasta Fecha final del rango\n * @returns {boolean}\n * @author Fahibram Cárcamo\n */\nfunction fechaDentroDelRango(fecha, fecha_desde, fecha_hasta) {\n    fecha = new Date(fecha);\n    fecha_desde = new Date(fecha_desde);\n    fecha_hasta = new Date(fecha_hasta);\n\n    if (isNaN(fecha) || isNaN(fecha_desde) || isNaN(fecha_hasta)) {\n        throw new Error('Una o más fechas no son válidas.');\n    }\n\n    return fecha >= fecha_desde && fecha <= fecha_hasta;\n}\n\n/**\n * Descuenta el tiempo para las respuestas.\n *\n * @param id - ID del elemento HTML donde mostrar el tiempo\n * @param tiempo - Tiempo inicial en segundos\n * @author Jair Carvajal\n */\nvar tiempos_usados = {};\n\nfunction descuentoTiempo(id, tiempo, callback, onTick) {\n    var $elemento = $('#' + id);\n    if ($elemento.length === 0) {\n        console.error('Elemento con id \"' + id + '\" no encontrado.');\n        return;\n    }\n    if (tiempos_usados[id]) {\n        clearInterval(tiempos_usados[id]);\n    }\n    let tiempoTotal = tiempo;\n    tiempos_usados[id] = setInterval(function() {\n        if (tiempo <= 0) {\n            clearInterval(tiempos_usados[id]);\n            delete tiempos_usados[id];\n            $elemento.text('Tiempo finalizado');\n            if (window.tiempoFinalizado()) {\n                tiempoFinalizado();\n            }\n            if (typeof callback === 'function') {\n                callback();\n            }\n            return;\n        }\n\n        var minutos = Math.floor(tiempo / 60);\n        var segundos = tiempo % 60;\n\n        var textoTiempo = minutos + ':' + (segundos < 10 ? '0' : '') + segundos + '<i class=\"bi bi-alarm ms-2\"></i>';\n\n        if (tiempo <= 15) {\n            $elemento.addClass('text-state-red');\n            $elemento.removeClass('text-state-green');\n        } else {\n            $elemento.addClass('text-state-green');\n            $elemento.removeClass('text-state-red');\n        }\n\n        $elemento.html(textoTiempo);\n\n        var tiempoUsado = tiempoTotal - tiempo;\n\n        if (typeof onTick === 'function') {\n            onTick((tiempoUsado % 5));\n        }\n        tiempo--;\n    }, 1000);\n}\n\n/**\n * Detengo el tiempo para las respuestas.\n *\n * @param id - ID del elemento HTML donde mostrar el tiempo\n * @param tiempo - Tiempo inicial en segundos\n * @author Jair Carvajal\n */\nfunction detenerDescuentoTiempo(id) {\n    if (tiempos_usados[id]) {\n        clearInterval(tiempos_usados[id]);\n        delete tiempos_usados[id];\n    }\n}\n\n/**\n * Genera un SVG de la imagen de usuario.\n *\n * @param id ID del usuario.\n * @param nombres Nombres del usuario.\n * @param apellidos Apellidos del usuario.\n * @return image\n * @author Andres Morales\n */\nfunction crearImagenUsuarioLetras(id, nombres, apellidos) {\n    var tamano = 200;\n    var iniciales = (nombres[0] + apellidos[0]).toUpperCase();\n    var hash = md5(id);\n\n    var r = parseInt(hash.substring(0, 2), 16);\n    var g = parseInt(hash.substring(2, 4), 16);\n    var b = parseInt(hash.substring(4, 6), 16);\n    var colorFondo = `rgb(${r},${g},${b})`;\n\n    var luminancia = 0.299 * r + 0.587 * g + 0.114 * b;\n    var colorTexto = luminancia > 150 ? \"#000000\" : \"#FFFFFF\";\n\n    // SVG como texto\n    var svg = `\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${tamano}\" height=\"${tamano}\">\n        <rect width=\"100%\" height=\"100%\" fill=\"${colorFondo}\" />\n        <text x=\"50%\" y=\"50%\" dy=\".35em\"\n            text-anchor=\"middle\"\n            font-family=\"Lato, sans-serif\"\n            font-size=\"${tamano * 0.4}\"\n            fill=\"${colorTexto}\">\n            ${iniciales}\n        </text>\n    </svg>`;\n    var svgEncoded = encodeURIComponent(svg)\n        .replace(/'/g, \"%27\")\n        .replace(/\"/g, \"%22\");\n\n    var dataUri = `data:image/svg+xml,${svgEncoded}`;\n    return dataUri;\n}\n\n/**\n * Carga las notificaciones\n *\n * @return void\n * @author Andres Morales\n * @author Andres Gonzalez\n * @author Esperanza Olivo\n */\nfunction cargarNotificiacionesHeader() {\n    $.ajax({\n        url: '/usuario-notificaciones',\n        type: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            let datos = respuesta.data;\n            let notificaciones_noleidas = datos?.unread_notifications?.length ?? 0;\n\n            // Siempre remover el badge existente\n            $('#dropdownNotificaciones #badge-notificaciones').remove();\n\n            // Solo agregar el badge si hay notificaciones no leídas\n            if (notificaciones_noleidas > 0) {\n                $('#dropdownNotificaciones').append(`<span id=\"badge-notificaciones\" class=\"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-white\">${notificaciones_noleidas}</span>`);\n                $('#contador-notificaciones-abierto').append(`<span id=\"badge-notificaciones\" class=\"badge rounded-pill bg-danger border border-white\">${notificaciones_noleidas}</span>`);\n\n                $('#contenedor-boton-marcar-todas').html(`\n                    <button class=\"btn btn-link text-primary w-100 d-flex justify-content-center\" onclick=\"marcarNotificacionesLeidas('all')\">\n                        Marcar todo como leído\n                    </button>\n                `);\n            }\n\n            const NO_LEIDOS_IDS = new Set(Array.isArray(datos?.unread_notifications) ? datos.unread_notifications.map(notificacion => notificacion.id) : []);\n\n            if (Array.isArray(datos?.notifications) && datos.notifications.length > 0) {\n                $('#notificacion-sinnotificaciones').hide();\n                $('.notificaciones-listado').remove();\n                datos.notifications.forEach(notificacion => {\n                    const { id, data, updated_at } = notificacion;\n\n                    const NO_LEIDO = NO_LEIDOS_IDS.has(id);\n                    const MENSAJE = (data?.mensaje || '').slice(0, 120) + '...';\n                    const HORA = new Date(updated_at).toLocaleTimeString('es-CO', {\n                        hour: '2-digit',\n                        minute: '2-digit',\n                        hour12: false\n                    });\n\n                    const notificaciones = `\n                        <li class=\"${NO_LEIDO ? '' : 'bg-gray-90'} notificaciones-listado py-0\" id=\"notificacion-${id}\">\n                            <a class=\"dropdown-item text-gray-10 text-decoration-none border-top pt-0 pb-1\" href=\"javascript:void(0)\" onclick=\"marcarNotificacionesLeidas('${id}','${data?.ruta}')\">\n                                <div class=\"d-flex justify-content-between\">\n                                    <div class=\"w-auto flex-grow-1 pe-3\">\n                                        <p class=\"mt-1 mb-0 text-headline-6 text-gray-10\">${data?.titulo}</p>\n                                        <p class=\"mb-0 text-body-3 text-gray-30 notificacion-mensaje\">${MENSAJE}</p>\n                                    </div>\n                                    <div class=\"w-auto my-auto ${NO_LEIDO ? 'text-cta-azul' : 'text-gray-10'} text-label-2 flex-shrink-0\">\n                                        ${HORA}${NO_LEIDO ? `<i class=\"bi bi-circle-fill text-cta-azul my-auto texto-notificacion-icono ms-3\"></i>` : ''}\n                                    </div>\n                                </div>\n                            </a>\n                        </li>\n                    `;\n\n                    $(notificaciones).insertBefore('#contenedor-boton-marcar-todas');\n                });\n\n            } else {\n                $('#notificacion-sinnotificaciones').hide();\n                $('.notificaciones-listado').remove();\n            }\n\n        },\n        error: function(xhr, status, error) {\n            console.error('Error al cargar notificaciones:', error);\n        }\n    });\n}\n\n/**\n * Marcar las notificaciones leídas.\n *\n * @param {array} notificaciones_ids ids de las notificaciones\n * @param {string} ruta_destino ruta donde se va ha actualizar la pagina\n * @returns {void}\n * @author Andres Gonzalez\n * @author Esperanza Olivo\n */\nfunction marcarNotificacionesLeidas(notificaciones_ids = null, ruta_destino = null, soporte_id = null) {\n\n    let data = {\n        _token: $('meta[name=\"csrf-token\"]').attr('content')\n    };\n\n    if (notificaciones_ids === 'all') {\n        data.marcar_todo = true;\n    } else if (soporte_id) {\n        data.soporte_id = soporte_id;\n    } else if (notificaciones_ids) {\n        data.notificaciones_ids = Array.isArray(notificaciones_ids)\n            ? notificaciones_ids\n            : [notificaciones_ids];\n    }\n\n    $.ajax({\n        url: '/usuario-marcar-notificaciones-leidas',\n        type: 'POST',\n        data: data,\n        success: function(respuesta) {\n            cargarNotificiacionesHeader();\n\n            if (notificaciones_ids && notificaciones_ids !== 'all' && ruta_destino) {\n                window.location.href = \"/\" + ruta_destino;\n            }\n\n            if (notificaciones_ids === 'all') {\n                $('#badge-notificaciones').remove();\n                $('#contenedor-boton-marcar-todas').empty();\n                $('.notificaciones-listado').addClass('bg-gray-90');\n                $('.bi-circle-fill').remove();\n            }\n        },\n        error: function(xhr, estatus, error) {\n            console.error('Error al cargar notificaciones:', error);\n        }\n    });\n}\n\n/**\n * Configurar WebSocket para notificaciones en tiempo real\n *\n * @return void\n * @author Andres Gonzalez\n */\nfunction configurarWebSocketNotificaciones() {\n    try {\n        if (!window.configuracion_reverbg) {\n            return;\n        }\n\n        const PUSHER = new Pusher(window.configuracion_reverbg.appKey, {\n            wsHost: window.configuracion_reverbg.host,\n            wsPort: window.configuracion_reverbg.port,\n            wssPort: window.configuracion_reverbg.port,\n            cluster: 'mt1',\n            forceTLS: false,\n            enabledTransports: ['ws', 'wss'],\n            authEndpoint: '/broadcasting-auth',\n            auth: {\n                headers: {\n                    'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n                }\n            }\n        });\n\n        PUSHER.connection.bind('failed', function() {\n            console.error('❌ Conexión WebSocket falló');\n        });\n\n        PUSHER.connection.bind('error', function(error) {\n            console.error('❌ Error de WebSocket:', error);\n        });\n\n        let usuario_id = window.configuracion_reverbg.usuario_id;\n\n        if (!usuario_id) {\n            return;\n        }\n\n        const NOMBRE_CANAL = `private-App.Models.Usuarios.User.${usuario_id}`;\n        const CANAL = PUSHER.subscribe(NOMBRE_CANAL);\n\n        CANAL.bind('pusher:subscription_error', function(error) {\n            console.error('❌ Error al suscribirse al canal:', error);\n        });\n\n        // Escuchar eventos específicos de notificaciones\n        CANAL.bind('Illuminate\\\\Notifications\\\\Events\\\\BroadcastNotificationCreated', function(data) {\n            if (data.tipo === 'nueva_notificacion') {\n                audio_notificacion.play();\n                cargarNotificiacionesHeader();\n            }\n\n            if (data.tipo === 'nuevo_mensaje') {\n                if (($('#soporte-guardado-id').val() == data.soporte_id) || ($('#soporte_empresa_id').val() == data.soporte_id)) {\n                    audio_notificacion.play();\n                    consultarChat(data.soporte_id);\n                }\n            }\n        });\n    } catch (error) {\n        console.error('💥 Error en configurarWebSocketNotificaciones:', error);\n        console.error('Stack trace:', error.stack);\n    }\n}\n\n/**\n * Retornar el string entrante en formato title case.\n *\n * @param {string} texto\n * @returns {string}\n * @author Fahibram Cárcamo\n */\nfunction titleCase(texto) {\n    return texto.toLowerCase().replace(/\\b\\w/g, caracter => caracter.toUpperCase());\n}\n\n/**\n * Número de horas que durará el almacenamiento de la variable `ulitmas_empresas` en el\n * almacenamiento local **LocalStorage**.\n *\n * @var {number}\n * @author Fahibram Cárcamo\n */\nconst CANTIDAD_HORAS_VENCIMIENTO_ULTIMAS_EMPRESAS_LOCALSTORAGE = 6;\n\n/**\n * Validar si ya debe removerse la variable `ultimas_empresas` del alamacenamiento local\n * **LocalStorage**, si no es tiempo de eliminarla entonces se reinicia el tiempo de vigencia de la\n * variable.\n *\n * @returns {void}\n * @author Fahibram Cárcamo\n */\nfunction validarYActualizarUltimasEmpresasLocalStorage() {\n    let fecha_hora_actuales = moment();\n    let fecha_hora_vencimiento_ultimas_empresas = fecha_hora_actuales.clone().add(CANTIDAD_HORAS_VENCIMIENTO_ULTIMAS_EMPRESAS_LOCALSTORAGE, 'hours');\n    let fecha_hora_vencimiento_ultimas_empresas_localstorage = localStorage.getItem('vencimiento_ultimas_empresas');\n    let ultimas_empresas = localStorage.getItem('ultimas_empresas');\n\n    if (\n        ultimas_empresas != null &&\n        fecha_hora_vencimiento_ultimas_empresas_localstorage != null &&\n        fecha_hora_actuales.clone().isBefore(moment(fecha_hora_vencimiento_ultimas_empresas_localstorage).clone())\n    ) {\n        localStorage.setItem('vencimiento_ultimas_empresas', fecha_hora_vencimiento_ultimas_empresas.format('YYYY-MM-DD HH:mm:ss'));\n        return;\n    }\n\n    localStorage.removeItem('vencimiento_ultimas_empresas');\n    localStorage.removeItem('ultimas_empresas');\n}\n\n/**\n * Obtener la edad actual de un usuario según su fecha de nacimiento.\n *\n * @param {string} fecha_nacimiento\n * @returns {string}\n * @author José Manuel Jiménez\n * @author Fahibram Cárcamo\n * @author Andres Morales\n */\nfunction obtenerEdad(fecha_nacimiento) {\n    if (!fecha_nacimiento) return \"N/A\";\n    let hoy = new Date();\n    let nacimiento = new Date(fecha_nacimiento);\n    let edad = hoy.getFullYear() - nacimiento.getFullYear();\n    let mes = hoy.getMonth() - nacimiento.getMonth();\n    if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) edad--;\n    return edad + \" años\";\n}\n\n/**\n * Restablecer un input de tipo file.\n *\n * @param {html} elemento_input_html Elemento input html.\n * @param {html} label_elemento_input_html Label del elemento input html.\n * @param {html} boton_eliminar_elemento_input_html Botón para eliminar archivo del elemento input html.\n * @author Fahibram Cárcamo\n */\nfunction reiniciarCampoArchivo(elemento_input_html, label_elemento_input_html, boton_eliminar_elemento_input_html) {\n    elemento_input_html.val('');\n    elemento_input_html.removeAttr('data-base64');\n    label_elemento_input_html.text('Ningún archivo seleccionado');\n    boton_eliminar_elemento_input_html.hide();\n\n    if (elemento_input_html.data('imagen')) {\n        $('#' + elemento_input_html.data('imagen')).val('');\n        $('#' + elemento_input_html.data('imagen') + '_previsualizacion').attr('src', '');\n        $('#' + elemento_input_html.data('imagen') + '_fondo_previsualizacion').removeClass('d-none');\n    }\n}\n\n/**\n * Definir un campo destinado a recibir un número de teléfono celular.\n *\n * Esta función debe llamarse en el evento ready del objeto global document:\n * `$(document).ready(...)`. Ademas debe incluirse un pequeño fragmento de código en la función\n * `validacionAdicional` para que se agregué el código del número de celular al valor de campo\n * cuando se envíe el formulario donde se encutra el campo.\n *\n * ```\n * if (\n *   $('#input_celular_id').length &&\n *   $('#input_celular_id').val() !== '' &&\n *   input_celular.getNumber() !== ''\n * ) {\n *   $('#input_celular_id').val(input_celular.getNumber().slice(1));\n * }\n * ```\n *\n * Donde `input_celular` es el objeto retornado por esta función.\n *\n * @param {string} input_celular_id Id del campo.\n * @param {string} nombre_input_celular Nombre del campo.\n * @param {string} placeholder_input_celular Placeholder del campo.\n * @param {boolean} obligatorio El campo es obligatorio en el formulario.\n * @returns {object}\n * @author Fahibram Cárcamo\n */\nfunction definirInputTipoCelular(input_celular_id, nombre_input_celular, placeholder_input_celular, obligatorio = true) {\n    /**\n     * 🌎 Campo para ingresar un número de telefono con selectór de código de país con banderas.\n     * Este componente se creó con la librería International Telephone Input\n     * (https://intl-tel-input.com).\n     *\n     * La linea hiddenInput: () => ({ phone: 'celular_contacto' }) tiene como función establecer el\n     * nombre del campo, es decir, la llave del par llave-valor que se adjuntará en los datos del\n     * formulario cuando se envíe, en este caso 'celular_contacto'.\n     *\n     * Las lienas autoPlaceholder: 'aggressive' y\n     * customPlaceholder: (placeholder, country) => 'Celular*' se usan para definir el placeholder\n     * del campo.\n     *\n     * Con $('#celular_contacto').attr('required', true); se establece el campo como requerido\n     * dentro del formulario, se hace de esta forma porque la librería no admite el atributo\n     * required directamente en el componente html.\n     *\n     * @author Fahibram Cárcamo\n     */\n    if (document.querySelector(`#${input_celular_id}`)) {\n        const dropdown_dinamico = document.createElement('div');\n        document.body.appendChild(dropdown_dinamico);\n\n        let campo_celular = window.intlTelInput(document.querySelector(`#${input_celular_id}`), {\n            nationalMode: true,\n            initialCountry: 'co',\n            separateDialCode: true,\n            autoInsertDialCode: false,\n            autoPlaceholder: 'aggressive',\n            dropdownContainer: dropdown_dinamico,\n            customPlaceholder: (placeholder, country) => placeholder_input_celular,\n            loadUtils: () => import('https://cdn.jsdelivr.net/npm/intl-tel-input@25.4.2/build/js/utils.js'),\n            onlyCountries: [\n                'CO', // Colombia\n                'EC', // Ecuador\n                'AR', // Argentina\n                'CL', // Chile\n                'VE', // Venezuela\n                'PE', // Perú\n                'BO', // Bolivia\n                'UY', // Uruguay\n                'PY', // Paraguay\n                'PA', // Panamá\n                'MX', // México\n                'CR', // Costa Rica\n                // 'PR', // Puerto Rico\n                'CU', // Cuba\n                // 'DO', // República Dominicana\n                'SV', // El Salvador\n                'GT', // Guatemala\n                'HN', // Honduras\n                'NI', // Nicaragua\n                'ES', // España\n                'US', // Estados Unidos\n                'GQ'  // Guinea Ecuatorial\n            ]\n        });\n\n        if (obligatorio) $(`#${input_celular_id}`).attr('required', true);\n\n        return campo_celular;\n    }\n\n    return null;\n}\n\n/**\n * Establece la validación adicional que se aplica a un campo de tipo celular antes de enviar sus\n * datos en un formulario.\n *\n * @param {HTMLInputElement} input Elemento HTML del campo de tipo celular.\n * @param {string} input_id Id del elemento HTML del campo de tipo celular.\n * @author Fahibram Cárcamo\n * @author Jair Carvajal\n */\nfunction validacionAdicionalInputTipoCelular(input, input_id) {\n    let numero_completo = input.getNumber();\n    let indicativo = '+' + input.getSelectedCountryData().dialCode;\n    let codigo_iso2_pais = input.getSelectedCountryData().iso2;\n    let numero_sin_indicativo = numero_completo.replace(indicativo, '');\n    $(`#indicativo_${input_id}`).val(indicativo);\n    $(`#codigo_iso2_pais_${input_id}`).val(codigo_iso2_pais);\n    $(`#${input_id}`).val(numero_sin_indicativo);\n}\n\n/**\n * Rellenar un input de tipo celular.\n *\n * @param {string} indicativo_celular Código del país del número de celular.\n * @param {string} codigo_pais_iso2 Código ISO2 del país del número de celular.\n * @param {string} numero_celular Número de celular sin código de país.\n * @param {string} input_celular_id ID del input de tipo celular.\n * @param {HTMLInputElement} input_celular Input de tipo celular.\n * @returns {void}\n * @author Daniel Beltrán\n * @author Fahibram Cárcamo\n */\nfunction rellenarInputCelular(indicativo_celular, codigo_pais_iso2, numero_celular, input_celular_id, input_celular) {\n    $(`#${input_celular_id}`).val(numero_celular);\n    if (![null, undefined].includes(codigo_pais_iso2)) input_celular.setCountry(codigo_pais_iso2);\n}\n\n/**\n * Convierte imágenes de base64 a Blob.\n *\n * @param {string} cadena_base_64 Base 64 de la imagen.\n * @returns {Promise<Array>}\n * @author Andres Gonzalez\n */\nfunction imagenBase64Blob(cadena_base_64) {\n    if (!cadena_base_64 || !cadena_base_64.startsWith('data:image')) return null;\n    let datos_base_64 = cadena_base_64.split(',')[1];\n    let tipo_mime = cadena_base_64.match(/data:(.*?);base64/)[1];\n    let caracteres_binarios = atob(datos_base_64);\n    let arreglo_bytes = new Array(caracteres_binarios.length).fill(0).map((_, i) => caracteres_binarios.charCodeAt(i));\n    let bytes_uint8 = new Uint8Array(arreglo_bytes);\n    return new Blob([bytes_uint8], { type: tipo_mime });\n}\n\n\n/**\n * Limpiar estructuras html innecesarias en el check editor.\n *\n * @param {string} html - Cadena HTML generada por CKEditor a limpiar\n * @returns {string} HTML limpio sin elementos específicos de CKEditor\n * @author Andres Gonzalez\n * @author Jair Carvajal\n */\nfunction limpiarHTMLCKEditor(html) {\n    // Remover todos los elementos con clases de CKEditor\n    html = html.replace(/<div class=\"ck[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n    html = html.replace(/<span class=\"[^\"]*ck[^\"]*\"[^>]*>/gi, '<span>');\n\n    // Limpiar spans de imagen inline\n    html = html.replace(/<span class=\"image-inline[^\"]*\"[^>]*>/gi, '');\n    html = html.replace(/<\\/span>/g, '');\n\n    // Remover elementos de upload y widgets\n    html = html.replace(/<div class=\"ck-image-upload[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n    html = html.replace(/<div class=\"ck-fake-selection[^\"]*\"[^>]*>.*?<\\/div>/gs, '');\n\n    // Remover atributos innecesarios\n    html = html.replace(/contenteditable=\"[^\"]*\"/gi, '');\n    html = html.replace(/data-cke-filler=\"[^\"]*\"/gi, '');\n\n    // Limpiar párrafos vacíos con br\n    html = html.replace(/<p><br[^>]*><\\/p>/gi, '');\n    html = html.replace(/<br data-cke[^>]*>/gi, '');\n\n    // Limpiar espacios múltiples y saltos de línea\n    html = html.replace(/\\s+/g, ' ');\n    html = html.replace(/>\\s+</g, '><');\n\n    return html.trim();\n}\n\n/**\n * Ordena estudios por fecha_inicio más reciente (de más nueva a más antigua).\n * Preserva los índices originales para permitir edición y eliminación correcta.\n *\n * @param {Array} estudios - Array de objetos con estudios\n * @returns {Array} Array de estudios ordenados con propiedad indice_original\n * @author Jair Carvajal\n */\nfunction ordenarEstudiosPorFecha(estudios) {\n    // Mapear con índice original\n    let estudios_con_indice = estudios.map((estudio, indice_original) => ({\n        ...estudio,\n        indice_original: indice_original\n    }));\n\n    // Ordenar estudios por fecha_inicio (más reciente primero)\n    let estudios_ordenados = estudios_con_indice.sort((a, b) => {\n        // Si ambos tienen fecha_inicio, ordenar por más reciente\n        if (a.fecha_inicio && b.fecha_inicio) {\n            return moment(b.fecha_inicio).diff(moment(a.fecha_inicio));\n        }\n        // Si solo uno tiene fecha_inicio, ese va primero\n        if (a.fecha_inicio && !b.fecha_inicio) return -1;\n        if (!a.fecha_inicio && b.fecha_inicio) return 1;\n        // Si ninguno tiene fecha_inicio, mantener orden original\n        return 0;\n    });\n\n    return estudios_ordenados;\n}\n\n/**\n * Ordena experiencias laborales por fecha: primero las que está trabajando actualmente (sin fecha_fin),\n * luego por fecha_fin más reciente.\n * Preserva los índices originales para permitir edición y eliminación correcta.\n *\n * @param {Array} experiencias - Array de objetos con experiencias laborales\n * @returns {Array} Array de experiencias ordenadas con propiedad indice_original\n * @author Jair Carvajal\n */\nfunction ordenarExperienciasPorFecha(experiencias) {\n    // Mapear con índice original\n    let experiencias_con_indice = experiencias.map((experiencia, indice_original) => ({\n        ...experiencia,\n        indice_original: indice_original\n    }));\n\n    // Ordenar experiencias\n    let experiencias_ordenadas = experiencias_con_indice.sort((a, b) => {\n        // Si 'a' no tiene fecha_fin (trabaja actualmente), va primero\n        if (!a.fecha_fin && b.fecha_fin) return -1;\n        // Si 'b' no tiene fecha_fin (trabaja actualmente), va primero\n        if (a.fecha_fin && !b.fecha_fin) return 1;\n        // Si ambos están trabajando actualmente (sin fecha_fin), mantener el orden actual\n        if (!a.fecha_fin && !b.fecha_fin) return 0;\n        // Si ambos tienen fecha_fin, ordenar por fecha más reciente primero (descendente)\n        return moment(b.fecha_fin).diff(moment(a.fecha_fin));\n    });\n\n    return experiencias_ordenadas;\n}\n\n/**\n * Obtener créditos disponibles de la empresa y actualizar el tag.\n * - Si tiene créditos >= 20% del plan: tag azul\n * - Si tiene créditos < 20% del plan: tag amarillo\n * - Si no tiene créditos: tag gris \"Sin créditos\"\n *\n * @param {number} empresa_id ID de la empresa\n * @param {string} contenedor_id ID del contenedor donde se mostrará el tag\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction obtenerCreditosDisponiblesEmpresa(empresa_id, contenedor_id = 'contenedor-tag-creditos') {\n    if (!empresa_id || !$(`#${contenedor_id}`).length) {\n        return;\n    }\n\n    $.ajax({\n        url: `/empresas/${empresa_id}/creditos`,\n        method: 'GET',\n        dataType: 'json',\n        success: function(respuesta) {\n            let creditos_disponibles = respuesta?.data?.creditos_disponibles ?? 0;\n            let creditos_plan = respuesta?.data?.creditos_plan ?? 0;\n            let plan_credito = respuesta?.data?.plan_credito;\n            let porcentaje_disponible = creditos_plan > 0 ? (creditos_disponibles / creditos_plan) * 100 : 0;\n\n            let texto_tag = '';\n            let clase_tag = '';\n            let icono_final = '';\n\n            if (creditos_disponibles <= 0 || plan_credito === null) {\n                texto_tag = 'Sin créditos';\n                clase_tag = 'tag-tonal-gray';\n                icono_final = `<i class=\"bi bi-info-circle ms-1\" role=\"button\" tabindex=\"0\" ${crearTooltip({ placement: 'right', content: 'No tienes créditos disponibles en este momento. Renueva tu plan o adquiere más créditos para continuar.' })}></i>`;\n            } else if (porcentaje_disponible < 20) {\n                texto_tag = `Créditos disponibles: ${formatearNumero(creditos_disponibles)}`;\n                clase_tag = 'tag-filled-yellow';\n                icono_final = `<i class=\"bi bi-info-circle ms-1\" role=\"button\" tabindex=\"0\" ${crearTooltip({ placement: 'right', content: 'Estás cerca de agotar tus créditos. Te queda menos del 20% del total disponible. Considera recargar o revisar tu consumo para evitar interrupciones.' })}></i>`;\n            } else {\n                texto_tag = `Créditos disponibles: ${formatearNumero(creditos_disponibles)}`;\n                clase_tag = 'tag-tonal-blue';\n            }\n\n            $(`#${contenedor_id}`).html(crearTag({\n                texto: texto_tag,\n                class: clase_tag,\n                icono_final: icono_final,\n            }));\n\n            inicializarTooltips();\n        },\n        error: function (error) {\n            $(`#${contenedor_id}`).html(crearTag({\n                texto: error.status === 404 ? 'No tienes plan de créditos' : 'Error al cargar créditos',\n                class: 'tag-tonal-gray'\n            }));\n        }\n    });\n}\n\n/**\n * Muestra Modal para informar que no cuenta con la funcionalidad\n *.\n * @returns {void}\n * @author Andres Gonzalez\n */\nfunction modalFuncionalidadInactiva() {\n    Swal.fire({\n        showCloseButton: true,\n        closeButtonHtml: '<i class=\"bi bi-x text-headline-4 text-gray-20\"></i>',\n        showConfirmButton: false,\n        showDenyButton: false,\n        showCancelButton: false,\n        html: `\n            <div class=\"row w-100 mx-0 mt-2\">\n                <div class=\"col-12 fw-semibold text-start text-gray-10 text-headline-4\">Sin funcionalidad</div>\n                <div class=\"col-12 mt-5 text-start text-body-2 fw-normal\">No tienes esta funcionalidad activa. Por favor, contacta a tu asesor.</div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-outline-primary w-100 justify-content-center',\n                        texto: 'Cancelar',\n                        onclick: `Swal.clickDeny();`\n                    })}\n                </div>\n                <div class=\"col-6 mt-5 mb-2\">\n                    ${crearBoton({\n                        clases: 'btn-primary w-100 justify-content-center',\n                        texto: 'entiendo',\n                        onclick: `Swal.clickConfirm();`\n                    })}\n                </div>\n            </div>\n        `,\n    }).then(async (result) => {\n        if (result.isConfirmed) {\n            console.log(66);\n        }\n    });\n}\n","structuredPatch":[{"oldStart":67,"oldLines":6,"newStart":67,"newLines":24,"lines":[" }"," "," /**","+ * Busca una funcionalidad por su llave en el array de funcionalidades.","+ *","+ * @param {string} llave Llave de la funcionalidad a buscar.","+ * @param {Array|null} funcionalidades Array de funcionalidades (opcional, usa configuraciones_disponibles_empresa por defecto).","+ * @returns {boolean} True si encuentra la funcionalidad, false en caso contrario.","+ * @author Claude Code","+ */","+function buscarFuncionalidad(llave, funcionalidades = null) {","+    let data = funcionalidades ?? configuraciones_disponibles_empresa;","+","+    if (!Array.isArray(data) || data.length === 0) {","+        return false;","+    }","+","+    return data.some(item => item?.funcionalidad?.llave === llave);","+}","+","+/**","  * Mostrar modal de créditos IA","  *","  * @return void"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"f4afe8e0-a3b5-481d-8822-8b933fed4add"}
{"parentUuid":"4f17d64f-c7c4-4dc4-b38e-cc30016aba8f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UjspBkM6jS9H9RAd4T9MSE","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"La función se agregó correctamente. Ahora le explico al usuario cómo usarla.","signature":"EvcBCkYICxgCKkAIbTd1vs8JooY78v/iiGpoAKocL5zoBMIWPSIP90r6srgmYXB0EVPVS2UbboQyf7o6q8qLS3uVJXowqwpTkPkaEgzX1jecMoAjHhGA83kaDAFkKCOWk2ts0vqZ7iIww0H55iglF3Kf7uqOoIYOGxilW/MPEjub61Xy1fLbqKOAiNDFeSUKjDtrmhGFngz9Kl+87NiAlUcQ5JaBXfw6FdTW88XZcVkMssCj/k+7JQ8HXbKBZqTZf0V1kzQQWjaZ94vgT4uEWcAn1n/FlwOc7+uwjZABMVeq7C2ApBmByuiZhRXGuP3Y3aHC2eB8I3ugMRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1793,"cache_read_input_tokens":49863,"cache_creation":{"ephemeral_5m_input_tokens":1793,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXYD8cqba3xsfvdBEL3no","type":"assistant","uuid":"8d67e547-9952-4fa0-b643-9dd349cbec58","timestamp":"2026-01-27T16:37:16.725Z"}
{"parentUuid":"8d67e547-9952-4fa0-b643-9dd349cbec58","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UjspBkM6jS9H9RAd4T9MSE","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. Agregué la función `buscarFuncionalidad` en [globales.js:77-85](public/js/globales.js#L77-L85).\n\n**Uso:**\n\n```javascript\n// Usando la variable global configuraciones_disponibles_empresa\nbuscarFuncionalidad('plantillas_personalizadas'); // true o false\n\n// Pasando el array directamente\nbuscarFuncionalidad('envio_masivo_correos', miArrayFuncionalidades);\n```\n\n**Ejemplos con tu data:**\n```javascript\nbuscarFuncionalidad('plantillas_personalizadas');  // true\nbuscarFuncionalidad('psicoacademy');               // true\nbuscarFuncionalidad('funcionalidad_inexistente'); // false\n```"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1793,"cache_read_input_tokens":49863,"cache_creation":{"ephemeral_5m_input_tokens":1793,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXYD8cqba3xsfvdBEL3no","type":"assistant","uuid":"84a3d6ac-90f6-4db9-8d73-8db51fdf584d","timestamp":"2026-01-27T16:37:19.657Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-27T17:00:31.237Z","sessionId":"e3f765a2-f425-4585-b415-40cef6071430"}
{"type":"file-history-snapshot","messageId":"d46cabc4-dba3-490c-8504-c6fd00a78707","snapshot":{"messageId":"d46cabc4-dba3-490c-8504-c6fd00a78707","trackedFileBackups":{"public\\js\\globales.js":{"backupFileName":"704f632e999527e6@v2","version":2,"backupTime":"2026-01-27T17:00:35.193Z"}},"timestamp":"2026-01-27T17:00:35.172Z"},"isSnapshotUpdate":false}
{"parentUuid":"c03f2e07-4f91-457a-936d-f7033e51b580","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_012zeGQREic9iNkA8VSMgWzb","parentToolUseID":"toolu_012zeGQREic9iNkA8VSMgWzb","uuid":"5a7dd783-d4b5-4113-bb90-fe08f532976b","timestamp":"2026-01-27T16:35:23.628Z"}
{"parentUuid":"80282bbd-247e-4657-9262-4a3f04a91218","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_012zeGQREic9iNkA8VSMgWzb","toolUseID":"toolu_012zeGQREic9iNkA8VSMgWzb","timestamp":"2026-01-27T16:35:26.056Z","uuid":"bb9a88f6-9281-479a-9dd5-4d73c4365550"}
{"parentUuid":"f4afe8e0-a3b5-481d-8822-8b933fed4add","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01E29rbwA1BvEkFsyG2gh9aP","parentToolUseID":"toolu_01E29rbwA1BvEkFsyG2gh9aP","uuid":"1c650818-6be5-4855-b2f1-a6f717249353","timestamp":"2026-01-27T16:35:43.254Z"}
{"parentUuid":"1c650818-6be5-4855-b2f1-a6f717249353","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_01E29rbwA1BvEkFsyG2gh9aP","parentToolUseID":"toolu_01E29rbwA1BvEkFsyG2gh9aP","uuid":"6eceb597-f457-4eca-8cd4-09e7bdc0fbae","timestamp":"2026-01-27T16:35:43.255Z"}
{"parentUuid":"4f17d64f-c7c4-4dc4-b38e-cc30016aba8f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01E29rbwA1BvEkFsyG2gh9aP","toolUseID":"toolu_01E29rbwA1BvEkFsyG2gh9aP","timestamp":"2026-01-27T16:37:12.117Z","uuid":"d11d2280-42af-43c3-8f51-75db466f2639"}
{"parentUuid":"84a3d6ac-90f6-4db9-8d73-8db51fdf584d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 85 to 85 from c:\\laragon\\www\\psicoalianza-2\\public\\js\\plantillas-correos\\index.js:\nmodalFuncionalidadInactiva();\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"listo quiero utlizar esta funcin aqui $(document).on('click', '.boton-editar-modal', function(){\n        modalFuncionalidadInactiva(); qui y aqui ya tare la info de las configraciones y queir que se ejecte el modal caundo este en la vista de empresa y esa funcion de buscar la llave debulva false"}]},"uuid":"d46cabc4-dba3-490c-8504-c6fd00a78707","timestamp":"2026-01-27T17:00:35.169Z","permissionMode":"default"}
{"parentUuid":"d46cabc4-dba3-490c-8504-c6fd00a78707","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01JoxWEcJBvBL9Tr4kCztyhY","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario quiere utilizar la función `buscarFuncionalidad` en el evento click de `.boton-editar-modal`. Si la función devuelve `false` (es decir, no tiene la funcionalidad), debe mostrar el modal `modalFuncionalidadInactiva()` y no continuar con la acción.\n\nNecesito ver el archivo `public/js/plantillas-correos/index.js` para entender el contexto y hacer la modificación correctamente.","signature":"ErAECkYICxgCKkBKUYKe6xdDGkpQgEwlBBqrrRlf8CQ3FXXW0yOA9vgaUcqNGQUvXopV86FHmdLXCfrb+sRIenkY/oXJysG0R66hEgyDQfXyjRgAao7cnE8aDFK68JtDUyj8AXb+KiIwCDqHr+H3fz96w008EsGY6YXi76zb6H/wvEPy9pXn/hDZPv98UArUCk7hgcdg1J0FKpcDcFox0eHlU1cB/4LdUre238jALXmVMJJC/pKdea9OQcbOIFn78UqeS0jn4NuI+oWvYFYwxgVL1/EgXm0Qjh8SzZC8CglJJGH5YQ9tAeYvvt4HdlFy79xqbnVsGYbsfYqJIQfofIY6wkteKbZPtO9NYG3eF2KjNbFSJYQjRJsEoWAGqAPcVwpFpslpBnA0j5iQ7j4CuFNRd7PUxd5hG6gDikjynVpnX+Ye0fSQ5OFQ1oxq267J0TQNyDXwipm8ugO8KVXlmVVRUyksSkkZ0u6jaNJkzY8BTafqfAjtigQ2VEjWyn0ZwH/4Hi1+g90TcxwWCaMwOHwV3CL949xJm9znfDQa3yYkP3Za++FAPnZ10uotdOuJ86/WER0BQi/L69VWHYBf2OA8LgK+p36BH0JGrEQRrUa5z0Isq4Hzp+FrJ+pwOWhDIdVcTUdAb6VjQsBKYOHuna0rshGdskbNdmAapShl7g9G56WCHKqDKkQfEWVG6kP6Yz8+hkRjk8w3L2UKtq9Pfx7Nma14pPOc0NhjcoZLyCkgOzEYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":53456,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":53456,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXYEuu33PYXDfeJC6juos","type":"assistant","uuid":"182529c6-0f49-47ac-8bd1-94b186b50a62","timestamp":"2026-01-27T17:00:40.345Z"}
{"parentUuid":"182529c6-0f49-47ac-8bd1-94b186b50a62","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01JoxWEcJBvBL9Tr4kCztyhY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VGAHJpdZ6MRpVam1AVxr8M","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\plantillas-correos\\index.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":53456,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":53456,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CXYEuu33PYXDfeJC6juos","type":"assistant","uuid":"14b6e0cc-4a90-4c50-a6b5-946a2e1a0c51","timestamp":"2026-01-27T17:00:40.737Z"}
{"parentUuid":"14b6e0cc-4a90-4c50-a6b5-946a2e1a0c51","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VGAHJpdZ6MRpVam1AVxr8M","type":"tool_result","content":"     1→var datos_ids = [];\n     2→var nombre_tabla = 'tabla-plantillas';\n     3→var plantillaSeleccionada = [];\n     4→\n     5→$(`#${nombre_tabla}`).DataTable({\n     6→    ...configuracion_tablas,\n     7→    ajax: {\n     8→        url : `/listado-plantillas-correos`,\n     9→        data: function (datos) {\n    10→            datos.grupo_id = $('#listado_grupos_plantillas button.active').val();\n    11→            datos.empresa_id = EMPRESA_ID_PLANTILLAS;\n    12→        },\n    13→        dataSrc: function (json) {\n    14→            return Object.values(json.data);\n    15→        }\n    16→    },\n    17→    columns: [\n    18→        {\n    19→            data: null,\n    20→            orderable : false,\n    21→            render: (dato) => {\n    22→                return `\n    23→                    <div class=\"card rounded tarjeta-plantilla\">\n    24→                        <div class=\"card-body p-0 pointer rounded-top cuerpo-tarjeta-plantilla\" data-value=\"${dato.id}\">\n    25→                            <div class=\"position-relative\">\n    26→                                <img src=\"/imagenes/plantilla/encabezado_header.svg\" alt=\"Logo Plantilla\" class=\"rounded-top imagen-encabezado-plantilla\">\n    27→                                <img src=\"/imagenes/plantilla/logo_plataformas_evaluacion.svg\" alt=\"Logo Plantilla\" class=\"position-absolute imagen-logo-plantilla\">\n    28→                            </div>\n    29→                            <div class=\"px-3 contenido-plantilla\">\n    30→                                <p class=\"text-center\">Empresa</p>\n    31→                                <p class=\"fw-bold\">${dato.titulo}</p>\n    32→                                <p class=\"\">${dato.contenido}</p>\n    33→                            </div>\n    34→                        </div>\n    35→                        <div class=\"card-footer pie-tarjeta-plantilla\">\n    36→                            <div class=\"d-flex\">\n    37→                                <div class=\"col-10 my-auto\">\n    38→                                    <span class=\"text-headline-5 text-gray-10 my-auto\">${dato.nombre}</span>\n    39→                                </div>\n    40→                                <div class=\"col-auto\">\n    41→                                    ${crearBoton({\n    42→                                        adicional: `data-value=\"${dato.id}\"`,\n    43→                                        clases: 'btn-primary btn-circle boton-editar-modal',\n    44→                                        texto: `\n    45→                                            <svg width=\"19\" height=\"19\" viewBox=\"0 0 19 19\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    46→                                                <path d=\"M18.2695 2.59877C18.5768 2.9061 18.5768 3.40438 18.2695 3.71171L16.628 5.35315L13.4801 2.20527L15.1216 0.56383C15.4289 0.256499 15.9272 0.256499 16.2345 0.563831L18.2695 2.59877Z\" fill=\"white\"/>\n    47→                                                <path d=\"M15.5151 6.46609L12.3672 3.31821L1.64394 14.0415C1.55755 14.1279 1.49246 14.2332 1.45383 14.3491L0.187499 18.1481C0.0849619 18.4557 0.377613 18.7483 0.685223 18.6458L4.48422 17.3795C4.60012 17.3408 4.70544 17.2757 4.79183 17.1893L15.5151 6.46609Z\" fill=\"white\"/>\n    48→                                            </svg>\n    49→                                        `\n    50→                                    })}\n    51→                                </div>\n    52→                            </div>\n    53→                        </div>\n    54→                    </div>\n    55→                `;\n    56→            }\n    57→        }\n    58→    ],\n    59→    drawCallback: function(settings) {\n    60→        datos_ids = $(`#${nombre_tabla}`).DataTable().data().toArray();\n    61→        inicializarTooltips();\n    62→    },\n    63→    initComplete: function(settings, json) {\n    64→        datos_ids = $(`#${nombre_tabla}`).DataTable().data().toArray();\n    65→\n    66→        $(`#${nombre_tabla}`).find('tbody').addClass('tabla-cards-horizontal');\n    67→        $(`[aria-describedby=\"${nombre_tabla}_info\"] .thead-componente`).hide();\n    68→        inicializarTooltips();\n    69→    }\n    70→});\n    71→\n    72→$(document).ready(function() {\n    73→    if (typeof VISTA_EMPRESA !== 'undefined' && VISTA_EMPRESA) {\n    74→        obtenerFuncionalidadesActivasPlan();\n    75→    }\n    76→\n    77→    configurarFormulario('form-editar-plantilla');\n    78→    $(document).on('click', '.botones-grupo', function(){\n    79→        $('.botones-grupo').removeClass('active');\n    80→        $(this).addClass('active');\n    81→        actualizarDatatables(`${nombre_tabla}`);\n    82→    });\n    83→\n    84→    $(document).on('click', '.boton-editar-modal', function(){\n    85→        modalFuncionalidadInactiva();\n    86→        let id = $(this).data('value');\n    87→        $('#restablecer_texto').data('value', id);\n    88→        plantillaSeleccionada = datos_ids.find(plantilla => plantilla.id == id);\n    89→        $('#contenedor_editor_texto').html(`\n    90→            ${crearEditorTexto({\n    91→                adicional: `data-botonadicional=\"botonAdicionalCkeditor\"`,\n    92→                class: 'classic-editor-opciones',\n    93→                id: 'descripcion_mensaje',\n    94→                input_container_class: 'mb-4',\n    95→                maxlength: 16350,\n    96→                name: 'descripcion_mensaje',\n    97→                required: true\n    98→            })}\n    99→            `);\n   100→            inicializarClassicEditor();\n   101→        $('#titulo-plantilla-modal').html(plantillaSeleccionada.nombre);\n   102→        $('#titulo_mensaje_plantilla').val(plantillaSeleccionada.titulo);\n   103→        $('#id').val(plantillaSeleccionada.id);\n   104→        $('#grupo_id').val(plantillaSeleccionada.grupo_id);\n   105→        if (plantillaSeleccionada.con_logo_empresa == '1') $('#con_logo').prop('checked', true);\n   106→        else $('#con_logo').prop('checked', false);\n   107→        $('#texto_boton').val(plantillaSeleccionada.texto_boton);\n   108→        $('#enlace_boton').val(plantillaSeleccionada.enlace_boton);\n   109→        $('#modal-editar-plantilla').modal('show');\n   110→\n   111→        // Agregar el ID de la empresa y de la plantilla de correo, el segundo se envía solo cuando la empresa actual es diferente a Psicoalianza\n   112→        $('#empresa_id').val(EMPRESA_ID_PLANTILLAS);\n   113→\n   114→        if (EMPRESA_ID_PLANTILLAS !== PSICOALIANZA_ID) {\n   115→            const PLANTILLA_CORREO_ID = plantillaSeleccionada.plantilla_correo_id !== null ? plantillaSeleccionada.plantilla_correo_id : plantillaSeleccionada.id;\n   116→            $('#plantilla_correo_id').val(PLANTILLA_CORREO_ID);\n   117→        }\n   118→    });\n   119→\n   120→    $(document).on('click', '.cuerpo-tarjeta-plantilla', function(){\n   121→        let id = $(this).data('value');\n   122→        let previsualiazcion_plantilla = datos_ids.find(plantilla => plantilla.id == id);\n   123→\n   124→        $('#titulo_previsualizar').html(previsualiazcion_plantilla.titulo);\n   125→        $('#contenido_previsualizar').html(previsualiazcion_plantilla.contenido);\n   126→        $('#modal-previsualizacion').modal('show');\n   127→    });\n   128→\n   129→    $(document).on('click', '#restablecer_texto', function () {\n   130→        let id = $(this).data('value');\n   131→\n   132→        $.ajax({\n   133→            url: `/plantillas-correos-restablecer/${id}`,\n   134→            type: 'PUT',\n   135→            headers: {\n   136→                'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n   137→            },\n   138→            success: function(response) {\n   139→                actualizarDatatables(`${nombre_tabla}`);\n   140→                mostrarToast('success', response.message);\n   141→                $('#modal-editar-plantilla').modal('hide');\n   142→            },\n   143→            error: function(xhr) {\n   144→                mostrarToast('danger', 'Error al restablecer la plantilla');\n   145→            }\n   146→        });\n   147→    });\n   148→});\n   149→\n   150→/**\n   151→ * Validar campos de enlace.\n   152→ *\n   153→ * Si el campo de texto_boton está diligenciado, el campo enlace_boton se vuelve obligatorio y viceversa.\n   154→ *\n   155→ * @returns {void}\n   156→ * @author Daniel Beltrán\n   157→ */\n   158→function validarCamposEnlace() {\n   159→    if (!['', null].includes($('#texto_boton').val().trim()) || !['', null].includes($('#enlace_boton').val().trim())) {\n   160→        $('#texto_boton').prop('required', true).trigger('change');\n   161→        $('#enlace_boton').prop('required', true).trigger('change');\n   162→    } else {\n   163→        $('#texto_boton').prop('required', false).trigger('change');\n   164→        $('#enlace_boton').prop('required', false).trigger('change');\n   165→    }\n   166→}\n   167→\n   168→/**\n   169→ * Validar el formulario antes de enviarlo.\n   170→ *\n   171→ * @returns {boolean}\n   172→ * @author Andres Morales\n   173→ */\n   174→function validacionAdicional(formulario) {\n   175→    $('#contenido').val($(`#descripcion_mensaje`).data('editor').getData());\n   176→    $('#con_logo_empresa').val($(`#con_logo`).is(':checked') ? 1 : 0);\n   177→    return true;\n   178→}\n   179→\n   180→/**\n   181→ * función para ejecutar algo después de enviar el formulario.\n   182→ *\n   183→ * @param {object} respuesta Respuesta del servidor.\n   184→ * @returns {void}\n   185→ * @autor Andres Morales\n   186→ */\n   187→\n   188→function postSuccess(respuesta) {\n   189→    actualizarDatatables(`${nombre_tabla}`);\n   190→    $('#modal-editar-plantilla').modal('hide');\n   191→    mostrarToast('success', respuesta.message);\n   192→}\n   193→\n   194→/**\n   195→ * Crear boton adicional para ckeditor.\n   196→ *\n   197→ * @returns {html} botón adicional para ckeditor.\n   198→ * @author Andres Morales\n   199→ */\n   200→function botonAdicionalCkeditor(id) {\n   201→    $(`#${id}`).data('editor').setData(plantillaSeleccionada.contenido);\n   202→    if (!plantillaSeleccionada?.variables?.length) return '';\n   203→\n   204→    const opcionesVariables = plantillaSeleccionada.variables\n   205→        .map(variable => `<button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariable('${id}', '__${variable.llave}__')\">${variable.valor}</button>`)\n   206→        .join('');\n   207→\n   208→    return `\n   209→        <div class=\"border-start border-black border-2 px-2 my-0 dropdown\">\n   210→            ${crearBoton({\n   211→                clases: 'dropdown-toggle text-body-3 btn-dropdown-ckeditor',\n   212→                texto: 'Agregar variable<i class=\"bi bi-chevron-down text-body-3 ms-2\"></i>',\n   213→                data: [{texto: 'bs-toggle', value: 'dropdown'},{texto: 'bs-auto-close', value: 'outside'},]\n   214→            })}\n   215→            <div class=\"dropdown-menu bg-white\">${opcionesVariables}</div>\n   216→        </div>\n   217→    `;\n   218→}\n   219→\n   220→/**\n   221→ * Agrega la variable en cuestion en el ckeditor.\n   222→ *\n   223→ * @returns {void}\n   224→ * @author Andres Morales\n   225→ */\n   226→function agregarVariable(id, variable) {\n   227→    let texto = $(`#${id}`).data('editor').getData()\n   228→    $(`#${id}`).data('editor').setData(texto + variable);\n   229→}\n   230→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"4d397308-87aa-4766-b9b8-cd16f7dbff2f","timestamp":"2026-01-27T17:00:41.949Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\plantillas-correos\\index.js","content":"var datos_ids = [];\nvar nombre_tabla = 'tabla-plantillas';\nvar plantillaSeleccionada = [];\n\n$(`#${nombre_tabla}`).DataTable({\n    ...configuracion_tablas,\n    ajax: {\n        url : `/listado-plantillas-correos`,\n        data: function (datos) {\n            datos.grupo_id = $('#listado_grupos_plantillas button.active').val();\n            datos.empresa_id = EMPRESA_ID_PLANTILLAS;\n        },\n        dataSrc: function (json) {\n            return Object.values(json.data);\n        }\n    },\n    columns: [\n        {\n            data: null,\n            orderable : false,\n            render: (dato) => {\n                return `\n                    <div class=\"card rounded tarjeta-plantilla\">\n                        <div class=\"card-body p-0 pointer rounded-top cuerpo-tarjeta-plantilla\" data-value=\"${dato.id}\">\n                            <div class=\"position-relative\">\n                                <img src=\"/imagenes/plantilla/encabezado_header.svg\" alt=\"Logo Plantilla\" class=\"rounded-top imagen-encabezado-plantilla\">\n                                <img src=\"/imagenes/plantilla/logo_plataformas_evaluacion.svg\" alt=\"Logo Plantilla\" class=\"position-absolute imagen-logo-plantilla\">\n                            </div>\n                            <div class=\"px-3 contenido-plantilla\">\n                                <p class=\"text-center\">Empresa</p>\n                                <p class=\"fw-bold\">${dato.titulo}</p>\n                                <p class=\"\">${dato.contenido}</p>\n                            </div>\n                        </div>\n                        <div class=\"card-footer pie-tarjeta-plantilla\">\n                            <div class=\"d-flex\">\n                                <div class=\"col-10 my-auto\">\n                                    <span class=\"text-headline-5 text-gray-10 my-auto\">${dato.nombre}</span>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        adicional: `data-value=\"${dato.id}\"`,\n                                        clases: 'btn-primary btn-circle boton-editar-modal',\n                                        texto: `\n                                            <svg width=\"19\" height=\"19\" viewBox=\"0 0 19 19\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                                                <path d=\"M18.2695 2.59877C18.5768 2.9061 18.5768 3.40438 18.2695 3.71171L16.628 5.35315L13.4801 2.20527L15.1216 0.56383C15.4289 0.256499 15.9272 0.256499 16.2345 0.563831L18.2695 2.59877Z\" fill=\"white\"/>\n                                                <path d=\"M15.5151 6.46609L12.3672 3.31821L1.64394 14.0415C1.55755 14.1279 1.49246 14.2332 1.45383 14.3491L0.187499 18.1481C0.0849619 18.4557 0.377613 18.7483 0.685223 18.6458L4.48422 17.3795C4.60012 17.3408 4.70544 17.2757 4.79183 17.1893L15.5151 6.46609Z\" fill=\"white\"/>\n                                            </svg>\n                                        `\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `;\n            }\n        }\n    ],\n    drawCallback: function(settings) {\n        datos_ids = $(`#${nombre_tabla}`).DataTable().data().toArray();\n        inicializarTooltips();\n    },\n    initComplete: function(settings, json) {\n        datos_ids = $(`#${nombre_tabla}`).DataTable().data().toArray();\n\n        $(`#${nombre_tabla}`).find('tbody').addClass('tabla-cards-horizontal');\n        $(`[aria-describedby=\"${nombre_tabla}_info\"] .thead-componente`).hide();\n        inicializarTooltips();\n    }\n});\n\n$(document).ready(function() {\n    if (typeof VISTA_EMPRESA !== 'undefined' && VISTA_EMPRESA) {\n        obtenerFuncionalidadesActivasPlan();\n    }\n\n    configurarFormulario('form-editar-plantilla');\n    $(document).on('click', '.botones-grupo', function(){\n        $('.botones-grupo').removeClass('active');\n        $(this).addClass('active');\n        actualizarDatatables(`${nombre_tabla}`);\n    });\n\n    $(document).on('click', '.boton-editar-modal', function(){\n        modalFuncionalidadInactiva();\n        let id = $(this).data('value');\n        $('#restablecer_texto').data('value', id);\n        plantillaSeleccionada = datos_ids.find(plantilla => plantilla.id == id);\n        $('#contenedor_editor_texto').html(`\n            ${crearEditorTexto({\n                adicional: `data-botonadicional=\"botonAdicionalCkeditor\"`,\n                class: 'classic-editor-opciones',\n                id: 'descripcion_mensaje',\n                input_container_class: 'mb-4',\n                maxlength: 16350,\n                name: 'descripcion_mensaje',\n                required: true\n            })}\n            `);\n            inicializarClassicEditor();\n        $('#titulo-plantilla-modal').html(plantillaSeleccionada.nombre);\n        $('#titulo_mensaje_plantilla').val(plantillaSeleccionada.titulo);\n        $('#id').val(plantillaSeleccionada.id);\n        $('#grupo_id').val(plantillaSeleccionada.grupo_id);\n        if (plantillaSeleccionada.con_logo_empresa == '1') $('#con_logo').prop('checked', true);\n        else $('#con_logo').prop('checked', false);\n        $('#texto_boton').val(plantillaSeleccionada.texto_boton);\n        $('#enlace_boton').val(plantillaSeleccionada.enlace_boton);\n        $('#modal-editar-plantilla').modal('show');\n\n        // Agregar el ID de la empresa y de la plantilla de correo, el segundo se envía solo cuando la empresa actual es diferente a Psicoalianza\n        $('#empresa_id').val(EMPRESA_ID_PLANTILLAS);\n\n        if (EMPRESA_ID_PLANTILLAS !== PSICOALIANZA_ID) {\n            const PLANTILLA_CORREO_ID = plantillaSeleccionada.plantilla_correo_id !== null ? plantillaSeleccionada.plantilla_correo_id : plantillaSeleccionada.id;\n            $('#plantilla_correo_id').val(PLANTILLA_CORREO_ID);\n        }\n    });\n\n    $(document).on('click', '.cuerpo-tarjeta-plantilla', function(){\n        let id = $(this).data('value');\n        let previsualiazcion_plantilla = datos_ids.find(plantilla => plantilla.id == id);\n\n        $('#titulo_previsualizar').html(previsualiazcion_plantilla.titulo);\n        $('#contenido_previsualizar').html(previsualiazcion_plantilla.contenido);\n        $('#modal-previsualizacion').modal('show');\n    });\n\n    $(document).on('click', '#restablecer_texto', function () {\n        let id = $(this).data('value');\n\n        $.ajax({\n            url: `/plantillas-correos-restablecer/${id}`,\n            type: 'PUT',\n            headers: {\n                'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n            },\n            success: function(response) {\n                actualizarDatatables(`${nombre_tabla}`);\n                mostrarToast('success', response.message);\n                $('#modal-editar-plantilla').modal('hide');\n            },\n            error: function(xhr) {\n                mostrarToast('danger', 'Error al restablecer la plantilla');\n            }\n        });\n    });\n});\n\n/**\n * Validar campos de enlace.\n *\n * Si el campo de texto_boton está diligenciado, el campo enlace_boton se vuelve obligatorio y viceversa.\n *\n * @returns {void}\n * @author Daniel Beltrán\n */\nfunction validarCamposEnlace() {\n    if (!['', null].includes($('#texto_boton').val().trim()) || !['', null].includes($('#enlace_boton').val().trim())) {\n        $('#texto_boton').prop('required', true).trigger('change');\n        $('#enlace_boton').prop('required', true).trigger('change');\n    } else {\n        $('#texto_boton').prop('required', false).trigger('change');\n        $('#enlace_boton').prop('required', false).trigger('change');\n    }\n}\n\n/**\n * Validar el formulario antes de enviarlo.\n *\n * @returns {boolean}\n * @author Andres Morales\n */\nfunction validacionAdicional(formulario) {\n    $('#contenido').val($(`#descripcion_mensaje`).data('editor').getData());\n    $('#con_logo_empresa').val($(`#con_logo`).is(':checked') ? 1 : 0);\n    return true;\n}\n\n/**\n * función para ejecutar algo después de enviar el formulario.\n *\n * @param {object} respuesta Respuesta del servidor.\n * @returns {void}\n * @autor Andres Morales\n */\n\nfunction postSuccess(respuesta) {\n    actualizarDatatables(`${nombre_tabla}`);\n    $('#modal-editar-plantilla').modal('hide');\n    mostrarToast('success', respuesta.message);\n}\n\n/**\n * Crear boton adicional para ckeditor.\n *\n * @returns {html} botón adicional para ckeditor.\n * @author Andres Morales\n */\nfunction botonAdicionalCkeditor(id) {\n    $(`#${id}`).data('editor').setData(plantillaSeleccionada.contenido);\n    if (!plantillaSeleccionada?.variables?.length) return '';\n\n    const opcionesVariables = plantillaSeleccionada.variables\n        .map(variable => `<button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariable('${id}', '__${variable.llave}__')\">${variable.valor}</button>`)\n        .join('');\n\n    return `\n        <div class=\"border-start border-black border-2 px-2 my-0 dropdown\">\n            ${crearBoton({\n                clases: 'dropdown-toggle text-body-3 btn-dropdown-ckeditor',\n                texto: 'Agregar variable<i class=\"bi bi-chevron-down text-body-3 ms-2\"></i>',\n                data: [{texto: 'bs-toggle', value: 'dropdown'},{texto: 'bs-auto-close', value: 'outside'},]\n            })}\n            <div class=\"dropdown-menu bg-white\">${opcionesVariables}</div>\n        </div>\n    `;\n}\n\n/**\n * Agrega la variable en cuestion en el ckeditor.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction agregarVariable(id, variable) {\n    let texto = $(`#${id}`).data('editor').getData()\n    $(`#${id}`).data('editor').setData(texto + variable);\n}\n","numLines":230,"startLine":1,"totalLines":230}},"sourceToolAssistantUUID":"14b6e0cc-4a90-4c50-a6b5-946a2e1a0c51"}
{"parentUuid":"4d397308-87aa-4766-b9b8-cd16f7dbff2f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CSZhAC3TuJLwXi4CUUWmn1","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Ahora entiendo. El usuario quiere:\n\n1. Si `VISTA_EMPRESA` es true (línea 73) y la función `buscarFuncionalidad('plantillas_personalizadas')` devuelve `false`, entonces mostrar el modal `modalFuncionalidadInactiva()` y NO continuar con la edición.\n\n2. Si la función devuelve `true` o si NO es vista de empresa, entonces continuar normalmente con la edición.\n\nVoy a modificar el evento click de `.boton-editar-modal` para agregar esta validación.\n\nLa llave que debe buscar parece ser `plantillas_personalizadas` según la data que mostró el usuario anteriormente.\n\nNota: También veo que en el archivo hay un error en la función `buscarFuncionalidad` que se modificó - usa `data.some` pero la variable se llama `datos`. Pero el usuario no me pidió arreglar eso, así que solo me enfocaré en la tarea actual.\n\nVoy a modificar la línea 84-118 para agregar la validación.","signature":"Eo4ICkYICxgCKkDiec86pvS3zolV8lN2ns3uZIGKemU7XvL4EFa+CE1U7MpXhToy7jlfAiZzreYgVtruM0lcJ4HaNwmbBQxOtSJBEgyjB5Qk4xgwLIeTOjMaDARv+jPC7pZvffZ+fSIwphRlwcDO+/Jb5oAcg/jxrSFyL0WBV4esCiAr0t3r+20/axmQqVYQMMIjGbFMIxglKvUGyEHd1AWMi28buVsSOlEj8EJizShvaVoIZdnVNzaMIrxQ8vVwhWZ4INytmOOIWZN1BxjkiEjIxVsoQ1Mt6WScguX2KA/7fP61ro16Cn0rBwmHhZqGpwIqwAEIN4LkLTpWTRU8zMRUxZBqEbhAXvnW3ZFx1E9y5ufPPRZiirvS52DDUefuiE5uN2uRuU2vdSTnePPn0vAsebK+PiUGcccah3ZETTXIkgRxu/62nn7Dt+zAGnE9la1FCjgDIHmb8qEV2+3Qi19PxK6zCpfMcLY9D6pYPOdYzgbFpLoUzquG3YON0b6F7opp0wLtmeY+xJmM1/JrkiQMu2F8RT5i4TZDRUYCYpQyfelQzSPqK3gLtlmvKYpo3GrQ6hbvoYGCsaaHXFUqrlbAICFwzKbL4r2pVgj46GIncqO4wPlTy+8fI4quHNDkZ35eygogJtaWC+o+XJNWRt97SlWtxn4GZGHe/ryBOTbvR3h4wlKQAwiOVP8l/fRC0C17Dp9DiSQNYXKgoVl5sqtc95YiTjcfoVfnaJrVpoTgx3bz6KKjlzxyj5e4vKe9BG24Wbv60Etf3OOoC5nfNENPSvc9YWU8C8aqzI+fKYxNIHBPVVf6fstN0MlhGtNvaBVQh4rjpRRGaZc17WAxW5y9BWvJKk03rVECJHiFzq6KC1LFdzPdWa6HDfOfDwk2PtOQm5j9kdbXrNC9OOAnn7nbwbffGVwfk58u77j0MrWD2D/dsM5auB8+Uxs2WXQLSTBPtNXiYqhljwxAAr9AVQ+CKSaSozPsxpd4/oRuE0YdUvBU/jh6M+ZazOEs3dIcOOS5Wo/RXW4qUx+HuebF4Hin1mkJoCGmYTFedUxHtUUyLJDyOG/wYkSdXRA99Q3XkdMgdk+ggefvaeHWt6oPubTJQJ10Fj36SLyS3DFBx4WtaPdn+WEYrOd7+aGWZOBXF31Sg/PUG59w1i4Ptku4UN9Q55eCI5iOWCew9zwAGPPrKlOdkxJdzaa5bNrOAEyT5FjzZSVCntsNeFUc7/w+lk69JZIBcNf2rqfdYF9oUGfdNVj4i7YUwyGRxwejQNCjrHC+E+nGMVLi2N4yyPCwe578HqYgqx1ktmVA0pTcCfjI/jwAuRNHoKt/miraGPUpXRQgB46qG+marLf7HFqFt1s1DlVX7vNPClFq+85ILyPRGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4015,"cache_read_input_tokens":53456,"cache_creation":{"ephemeral_5m_input_tokens":4015,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXYEvPihohnTfuzKq2pQS","type":"assistant","uuid":"d7d0a486-3002-47f9-a677-f39794fa1ec1","timestamp":"2026-01-27T17:00:50.710Z"}
{"parentUuid":"d7d0a486-3002-47f9-a677-f39794fa1ec1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CSZhAC3TuJLwXi4CUUWmn1","type":"message","role":"assistant","content":[{"type":"text","text":"Veo el contexto. Voy a modificar el evento click de `.boton-editar-modal` para que valide si tiene la funcionalidad activa cuando es vista de empresa, y si no la tiene, muestre el modal y no continúe."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4015,"cache_read_input_tokens":53456,"cache_creation":{"ephemeral_5m_input_tokens":4015,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXYEvPihohnTfuzKq2pQS","type":"assistant","uuid":"55f7503e-6b0a-4731-a065-d21ad7250855","timestamp":"2026-01-27T17:00:51.704Z"}
{"parentUuid":"55f7503e-6b0a-4731-a065-d21ad7250855","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CSZhAC3TuJLwXi4CUUWmn1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0183uPxkzdfgWn1GSZVjYuoV","name":"Edit","input":{"replace_all":false,"file_path":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\plantillas-correos\\index.js","old_string":"    $(document).on('click', '.boton-editar-modal', function(){\n        modalFuncionalidadInactiva();\n        let id = $(this).data('value');","new_string":"    $(document).on('click', '.boton-editar-modal', function(){\n        if (typeof VISTA_EMPRESA !== 'undefined' && VISTA_EMPRESA && !buscarFuncionalidad('plantillas_personalizadas')) {\n            modalFuncionalidadInactiva();\n            return;\n        }\n\n        let id = $(this).data('value');"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4015,"cache_read_input_tokens":53456,"cache_creation":{"ephemeral_5m_input_tokens":4015,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXYEvPihohnTfuzKq2pQS","type":"assistant","uuid":"76a6ceb8-f6fb-4cee-ac86-c35c67705ecb","timestamp":"2026-01-27T17:00:54.120Z"}
{"type":"file-history-snapshot","messageId":"76a6ceb8-f6fb-4cee-ac86-c35c67705ecb","snapshot":{"messageId":"d46cabc4-dba3-490c-8504-c6fd00a78707","trackedFileBackups":{"public\\js\\globales.js":{"backupFileName":"704f632e999527e6@v2","version":2,"backupTime":"2026-01-27T17:00:35.193Z"},"public\\js\\plantillas-correos\\index.js":{"backupFileName":"ef6a062d8a555a70@v1","version":1,"backupTime":"2026-01-27T17:03:08.940Z"}},"timestamp":"2026-01-27T17:00:35.172Z"},"isSnapshotUpdate":true}
{"parentUuid":"76a6ceb8-f6fb-4cee-ac86-c35c67705ecb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0183uPxkzdfgWn1GSZVjYuoV","type":"tool_result","content":"The file c:\\laragon\\www\\psicoalianza-2\\public\\js\\plantillas-correos\\index.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n    80→        $(this).addClass('active');\n    81→        actualizarDatatables(`${nombre_tabla}`);\n    82→    });\n    83→\n    84→    $(document).on('click', '.boton-editar-modal', function(){\n    85→        if (typeof VISTA_EMPRESA !== 'undefined' && VISTA_EMPRESA && !buscarFuncionalidad('plantillas_personalizadas')) {\n    86→            modalFuncionalidadInactiva();\n    87→            return;\n    88→        }\n    89→\n    90→        let id = $(this).data('value');\n    91→        $('#restablecer_texto').data('value', id);\n    92→        plantillaSeleccionada = datos_ids.find(plantilla => plantilla.id == id);\n    93→        $('#contenedor_editor_texto').html(`\n    94→            ${crearEditorTexto({"}]},"uuid":"0de2b6ee-1758-4678-9436-a34cf5938952","timestamp":"2026-01-27T17:03:08.996Z","toolUseResult":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\public\\js\\plantillas-correos\\index.js","oldString":"    $(document).on('click', '.boton-editar-modal', function(){\n        modalFuncionalidadInactiva();\n        let id = $(this).data('value');","newString":"    $(document).on('click', '.boton-editar-modal', function(){\n        if (typeof VISTA_EMPRESA !== 'undefined' && VISTA_EMPRESA && !buscarFuncionalidad('plantillas_personalizadas')) {\n            modalFuncionalidadInactiva();\n            return;\n        }\n\n        let id = $(this).data('value');","originalFile":"var datos_ids = [];\nvar nombre_tabla = 'tabla-plantillas';\nvar plantillaSeleccionada = [];\n\n$(`#${nombre_tabla}`).DataTable({\n    ...configuracion_tablas,\n    ajax: {\n        url : `/listado-plantillas-correos`,\n        data: function (datos) {\n            datos.grupo_id = $('#listado_grupos_plantillas button.active').val();\n            datos.empresa_id = EMPRESA_ID_PLANTILLAS;\n        },\n        dataSrc: function (json) {\n            return Object.values(json.data);\n        }\n    },\n    columns: [\n        {\n            data: null,\n            orderable : false,\n            render: (dato) => {\n                return `\n                    <div class=\"card rounded tarjeta-plantilla\">\n                        <div class=\"card-body p-0 pointer rounded-top cuerpo-tarjeta-plantilla\" data-value=\"${dato.id}\">\n                            <div class=\"position-relative\">\n                                <img src=\"/imagenes/plantilla/encabezado_header.svg\" alt=\"Logo Plantilla\" class=\"rounded-top imagen-encabezado-plantilla\">\n                                <img src=\"/imagenes/plantilla/logo_plataformas_evaluacion.svg\" alt=\"Logo Plantilla\" class=\"position-absolute imagen-logo-plantilla\">\n                            </div>\n                            <div class=\"px-3 contenido-plantilla\">\n                                <p class=\"text-center\">Empresa</p>\n                                <p class=\"fw-bold\">${dato.titulo}</p>\n                                <p class=\"\">${dato.contenido}</p>\n                            </div>\n                        </div>\n                        <div class=\"card-footer pie-tarjeta-plantilla\">\n                            <div class=\"d-flex\">\n                                <div class=\"col-10 my-auto\">\n                                    <span class=\"text-headline-5 text-gray-10 my-auto\">${dato.nombre}</span>\n                                </div>\n                                <div class=\"col-auto\">\n                                    ${crearBoton({\n                                        adicional: `data-value=\"${dato.id}\"`,\n                                        clases: 'btn-primary btn-circle boton-editar-modal',\n                                        texto: `\n                                            <svg width=\"19\" height=\"19\" viewBox=\"0 0 19 19\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                                                <path d=\"M18.2695 2.59877C18.5768 2.9061 18.5768 3.40438 18.2695 3.71171L16.628 5.35315L13.4801 2.20527L15.1216 0.56383C15.4289 0.256499 15.9272 0.256499 16.2345 0.563831L18.2695 2.59877Z\" fill=\"white\"/>\n                                                <path d=\"M15.5151 6.46609L12.3672 3.31821L1.64394 14.0415C1.55755 14.1279 1.49246 14.2332 1.45383 14.3491L0.187499 18.1481C0.0849619 18.4557 0.377613 18.7483 0.685223 18.6458L4.48422 17.3795C4.60012 17.3408 4.70544 17.2757 4.79183 17.1893L15.5151 6.46609Z\" fill=\"white\"/>\n                                            </svg>\n                                        `\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `;\n            }\n        }\n    ],\n    drawCallback: function(settings) {\n        datos_ids = $(`#${nombre_tabla}`).DataTable().data().toArray();\n        inicializarTooltips();\n    },\n    initComplete: function(settings, json) {\n        datos_ids = $(`#${nombre_tabla}`).DataTable().data().toArray();\n\n        $(`#${nombre_tabla}`).find('tbody').addClass('tabla-cards-horizontal');\n        $(`[aria-describedby=\"${nombre_tabla}_info\"] .thead-componente`).hide();\n        inicializarTooltips();\n    }\n});\n\n$(document).ready(function() {\n    if (typeof VISTA_EMPRESA !== 'undefined' && VISTA_EMPRESA) {\n        obtenerFuncionalidadesActivasPlan();\n    }\n\n    configurarFormulario('form-editar-plantilla');\n    $(document).on('click', '.botones-grupo', function(){\n        $('.botones-grupo').removeClass('active');\n        $(this).addClass('active');\n        actualizarDatatables(`${nombre_tabla}`);\n    });\n\n    $(document).on('click', '.boton-editar-modal', function(){\n        modalFuncionalidadInactiva();\n        let id = $(this).data('value');\n        $('#restablecer_texto').data('value', id);\n        plantillaSeleccionada = datos_ids.find(plantilla => plantilla.id == id);\n        $('#contenedor_editor_texto').html(`\n            ${crearEditorTexto({\n                adicional: `data-botonadicional=\"botonAdicionalCkeditor\"`,\n                class: 'classic-editor-opciones',\n                id: 'descripcion_mensaje',\n                input_container_class: 'mb-4',\n                maxlength: 16350,\n                name: 'descripcion_mensaje',\n                required: true\n            })}\n            `);\n            inicializarClassicEditor();\n        $('#titulo-plantilla-modal').html(plantillaSeleccionada.nombre);\n        $('#titulo_mensaje_plantilla').val(plantillaSeleccionada.titulo);\n        $('#id').val(plantillaSeleccionada.id);\n        $('#grupo_id').val(plantillaSeleccionada.grupo_id);\n        if (plantillaSeleccionada.con_logo_empresa == '1') $('#con_logo').prop('checked', true);\n        else $('#con_logo').prop('checked', false);\n        $('#texto_boton').val(plantillaSeleccionada.texto_boton);\n        $('#enlace_boton').val(plantillaSeleccionada.enlace_boton);\n        $('#modal-editar-plantilla').modal('show');\n\n        // Agregar el ID de la empresa y de la plantilla de correo, el segundo se envía solo cuando la empresa actual es diferente a Psicoalianza\n        $('#empresa_id').val(EMPRESA_ID_PLANTILLAS);\n\n        if (EMPRESA_ID_PLANTILLAS !== PSICOALIANZA_ID) {\n            const PLANTILLA_CORREO_ID = plantillaSeleccionada.plantilla_correo_id !== null ? plantillaSeleccionada.plantilla_correo_id : plantillaSeleccionada.id;\n            $('#plantilla_correo_id').val(PLANTILLA_CORREO_ID);\n        }\n    });\n\n    $(document).on('click', '.cuerpo-tarjeta-plantilla', function(){\n        let id = $(this).data('value');\n        let previsualiazcion_plantilla = datos_ids.find(plantilla => plantilla.id == id);\n\n        $('#titulo_previsualizar').html(previsualiazcion_plantilla.titulo);\n        $('#contenido_previsualizar').html(previsualiazcion_plantilla.contenido);\n        $('#modal-previsualizacion').modal('show');\n    });\n\n    $(document).on('click', '#restablecer_texto', function () {\n        let id = $(this).data('value');\n\n        $.ajax({\n            url: `/plantillas-correos-restablecer/${id}`,\n            type: 'PUT',\n            headers: {\n                'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n            },\n            success: function(response) {\n                actualizarDatatables(`${nombre_tabla}`);\n                mostrarToast('success', response.message);\n                $('#modal-editar-plantilla').modal('hide');\n            },\n            error: function(xhr) {\n                mostrarToast('danger', 'Error al restablecer la plantilla');\n            }\n        });\n    });\n});\n\n/**\n * Validar campos de enlace.\n *\n * Si el campo de texto_boton está diligenciado, el campo enlace_boton se vuelve obligatorio y viceversa.\n *\n * @returns {void}\n * @author Daniel Beltrán\n */\nfunction validarCamposEnlace() {\n    if (!['', null].includes($('#texto_boton').val().trim()) || !['', null].includes($('#enlace_boton').val().trim())) {\n        $('#texto_boton').prop('required', true).trigger('change');\n        $('#enlace_boton').prop('required', true).trigger('change');\n    } else {\n        $('#texto_boton').prop('required', false).trigger('change');\n        $('#enlace_boton').prop('required', false).trigger('change');\n    }\n}\n\n/**\n * Validar el formulario antes de enviarlo.\n *\n * @returns {boolean}\n * @author Andres Morales\n */\nfunction validacionAdicional(formulario) {\n    $('#contenido').val($(`#descripcion_mensaje`).data('editor').getData());\n    $('#con_logo_empresa').val($(`#con_logo`).is(':checked') ? 1 : 0);\n    return true;\n}\n\n/**\n * función para ejecutar algo después de enviar el formulario.\n *\n * @param {object} respuesta Respuesta del servidor.\n * @returns {void}\n * @autor Andres Morales\n */\n\nfunction postSuccess(respuesta) {\n    actualizarDatatables(`${nombre_tabla}`);\n    $('#modal-editar-plantilla').modal('hide');\n    mostrarToast('success', respuesta.message);\n}\n\n/**\n * Crear boton adicional para ckeditor.\n *\n * @returns {html} botón adicional para ckeditor.\n * @author Andres Morales\n */\nfunction botonAdicionalCkeditor(id) {\n    $(`#${id}`).data('editor').setData(plantillaSeleccionada.contenido);\n    if (!plantillaSeleccionada?.variables?.length) return '';\n\n    const opcionesVariables = plantillaSeleccionada.variables\n        .map(variable => `<button type=\"button\" class=\"dropdown-item-ckeditor p-2\" onclick=\"agregarVariable('${id}', '__${variable.llave}__')\">${variable.valor}</button>`)\n        .join('');\n\n    return `\n        <div class=\"border-start border-black border-2 px-2 my-0 dropdown\">\n            ${crearBoton({\n                clases: 'dropdown-toggle text-body-3 btn-dropdown-ckeditor',\n                texto: 'Agregar variable<i class=\"bi bi-chevron-down text-body-3 ms-2\"></i>',\n                data: [{texto: 'bs-toggle', value: 'dropdown'},{texto: 'bs-auto-close', value: 'outside'},]\n            })}\n            <div class=\"dropdown-menu bg-white\">${opcionesVariables}</div>\n        </div>\n    `;\n}\n\n/**\n * Agrega la variable en cuestion en el ckeditor.\n *\n * @returns {void}\n * @author Andres Morales\n */\nfunction agregarVariable(id, variable) {\n    let texto = $(`#${id}`).data('editor').getData()\n    $(`#${id}`).data('editor').setData(texto + variable);\n}\n","structuredPatch":[{"oldStart":82,"oldLines":7,"newStart":82,"newLines":11,"lines":["     });"," ","     $(document).on('click', '.boton-editar-modal', function(){","-        modalFuncionalidadInactiva();","+        if (typeof VISTA_EMPRESA !== 'undefined' && VISTA_EMPRESA && !buscarFuncionalidad('plantillas_personalizadas')) {","+            modalFuncionalidadInactiva();","+            return;","+        }","+","         let id = $(this).data('value');","         $('#restablecer_texto').data('value', id);","         plantillaSeleccionada = datos_ids.find(plantilla => plantilla.id == id);"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"76a6ceb8-f6fb-4cee-ac86-c35c67705ecb"}
{"parentUuid":"0de2b6ee-1758-4678-9436-a34cf5938952","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LFEsBFmaa9dxnhniqPop5c","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Listo. Ahora la lógica funciona así:\n\n1. Cuando el usuario hace clic en `.boton-editar-modal`\n2. Verifica si `VISTA_EMPRESA` está definida Y es true Y `buscarFuncionalidad('plantillas_personalizadas')` devuelve false\n3. Si todas esas condiciones se cumplen, muestra el modal de funcionalidad inactiva y hace return para no continuar\n4. Si no se cumplen (o sea, no es vista empresa, o tiene la funcionalidad), continúa con el código normal de edición\n\nTambién noto que hay un error en la función `buscarFuncionalidad` en globales.js - usa `data.some` pero la variable se llama `datos`. Debería informar al usuario sobre esto.","signature":"EqAGCkYICxgCKkCRQFhkXX0ecSmNAq2V1lOC+rMSo57kCfs2+Nb0WTayeBh5d8YzRzwqb0QW2hia75BkRC7m3tNBayY7ht/6ytrzEgzV9N9pr//8FQAKkxEaDK5zrHj9SwNf48rgSSIww9suMUpEZts5/+mn3odimJg0s2Wr74dZGd8CPDxlwu7GE3mG6/eJGnMEuR16V9OUKocFwfijjvXSFrnvhBMrox73kUL8QctY3cnI5Giwrrng3tNJFFgh8T3dLjWA6SgmyixQTKzy3u+HCPkoUQupmPXpkTJ02FkDEzyYJaSn+6O0oZFq38dhjGKy81EWyP3FghN19Ia+Q6J+WWJxkkaJyXwavm3InMkztuq3QLnIn0XVdwlZEAw2UGHS7B+Hcw2J6CO3ACZR9W1+YrXsrGCJCAStWwZvWydx5VHNKR6Vlg6s38FpC78VLt7i8sgHB8Lxe072VeRXHOTrwxWd0PY11TaqUSYS5vgk7bv2xcfA3u/k3n8wB1grHvmb2nCfTZJfUH4dhaR/MI1RYYSLHTe50Y817ADOySGB/IDWpUL4gYPNwrwLGrlwoSwnfrVE1iqFipswnzea2VjGvwbccm5lNpvBPuAqXz/UgKBDdAjZ/W0MpE+fCAv/wTnY5Vh6HotdK+6e+J/+B1rd8vuINNOpaC0JUSCpuQ8gg8skm9kfUxjPqSnMVpi7GmO5Ek4rv0WIH4gykLkprsLwzyObOMl+2L/f01Bfks/99wRfbF1EF2aZuvMbL4XF721e9u40Rt2LBWbdc9/99IYqggzdCPeeOBBJBT8JDEt1b54UR+UqQ+2P0J04YWp5qpL+DgXvNtsPEV/kwU5hvPxIQKN/EStEBGl2bgg1/UVDcOv9apQ/Ks/lWlDLrB5hiIhan1ZcT9YdwQpmak2ZiXH1bQ7JrnewAgZlVzxgrkd3/6A+bFRC+3vMrMxG+okO6UnSbwu2fQdJkmzDAbyLkeOrKaTwV11Gt/9G4YJNrHfz6u5WsiViVXdeZYAYBJY9r0vvtWOCGpBG+Lo/k4GclLYxLycgB7dgL0eFSZS638fHEJUYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":891,"cache_read_input_tokens":57471,"cache_creation":{"ephemeral_5m_input_tokens":891,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXYF7PbpR284KrdQeuA1Z","type":"assistant","uuid":"cd41fcd0-fc5e-49d8-ad75-4a722bd32705","timestamp":"2026-01-27T17:03:16.517Z"}
{"parentUuid":"cd41fcd0-fc5e-49d8-ad75-4a722bd32705","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LFEsBFmaa9dxnhniqPop5c","type":"message","role":"assistant","content":[{"type":"text","text":"Listo. La lógica ahora funciona así en [index.js:84-88](public/js/plantillas-correos/index.js#L84-L88):\n\n1. Si es vista de empresa (`VISTA_EMPRESA === true`)\n2. Y **no** tiene la funcionalidad `plantillas_personalizadas`\n3. → Muestra el modal y hace `return` (no continúa)\n\nSi tiene la funcionalidad o no es vista de empresa, continúa con la edición normal.\n\n**Nota:** Vi que en `buscarFuncionalidad` en globales.js hay un error - la variable se llama `datos` pero usa `data.some`. ¿Quieres que lo corrija?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":891,"cache_read_input_tokens":57471,"cache_creation":{"ephemeral_5m_input_tokens":891,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXYF7PbpR284KrdQeuA1Z","type":"assistant","uuid":"9e155747-1a6f-4af4-b32a-7733ee2e29a2","timestamp":"2026-01-27T17:03:19.772Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-27T20:50:00.032Z","sessionId":"e3f765a2-f425-4585-b415-40cef6071430"}
{"type":"file-history-snapshot","messageId":"5c93b6e0-60c9-4368-85d1-3b3a726970c8","snapshot":{"messageId":"5c93b6e0-60c9-4368-85d1-3b3a726970c8","trackedFileBackups":{"public\\js\\globales.js":{"backupFileName":"704f632e999527e6@v3","version":3,"backupTime":"2026-01-27T20:50:02.714Z"},"public\\js\\plantillas-correos\\index.js":{"backupFileName":"ef6a062d8a555a70@v2","version":2,"backupTime":"2026-01-27T20:50:02.727Z"}},"timestamp":"2026-01-27T20:50:02.692Z"},"isSnapshotUpdate":false}
{"parentUuid":"14b6e0cc-4a90-4c50-a6b5-946a2e1a0c51","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01VGAHJpdZ6MRpVam1AVxr8M","parentToolUseID":"toolu_01VGAHJpdZ6MRpVam1AVxr8M","uuid":"82ad7680-d17c-410c-9faf-a5eb3740ff70","timestamp":"2026-01-27T17:00:40.895Z"}
{"parentUuid":"4d397308-87aa-4766-b9b8-cd16f7dbff2f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01VGAHJpdZ6MRpVam1AVxr8M","toolUseID":"toolu_01VGAHJpdZ6MRpVam1AVxr8M","timestamp":"2026-01-27T17:00:41.949Z","uuid":"b6952c9d-eb39-49d8-bdb2-2e960c893c85"}
{"parentUuid":"76a6ceb8-f6fb-4cee-ac86-c35c67705ecb","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_0183uPxkzdfgWn1GSZVjYuoV","parentToolUseID":"toolu_0183uPxkzdfgWn1GSZVjYuoV","uuid":"3ae47b7b-262f-4554-ac4a-02b0fd73496b","timestamp":"2026-01-27T17:00:54.266Z"}
{"parentUuid":"3ae47b7b-262f-4554-ac4a-02b0fd73496b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Edit","command":"callback"},"toolUseID":"toolu_0183uPxkzdfgWn1GSZVjYuoV","parentToolUseID":"toolu_0183uPxkzdfgWn1GSZVjYuoV","uuid":"8be7793c-1391-4770-9b45-7c29a46a4e58","timestamp":"2026-01-27T17:00:54.266Z"}
{"parentUuid":"0de2b6ee-1758-4678-9436-a34cf5938952","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_0183uPxkzdfgWn1GSZVjYuoV","toolUseID":"toolu_0183uPxkzdfgWn1GSZVjYuoV","timestamp":"2026-01-27T17:03:08.997Z","uuid":"3b403511-63ff-476b-9585-43363874fae4"}
{"parentUuid":"9e155747-1a6f-4af4-b32a-7733ee2e29a2","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 18 to 18 from c:\\laragon\\www\\psicoalianza-2\\database\\seeders\\FuncionalidadSeeder.php:\n$this->truncarTabla('funcionalidades');\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"que hace esto $this->truncarTabla('funcionalidades');"}]},"uuid":"5c93b6e0-60c9-4368-85d1-3b3a726970c8","timestamp":"2026-01-27T20:50:02.683Z","permissionMode":"default"}
{"parentUuid":"5c93b6e0-60c9-4368-85d1-3b3a726970c8","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XtzV5v9DetUhEEEUoASNky","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario pregunta qué hace `$this->truncarTabla('funcionalidades');`. \n\nEsta es una llamada a un método que probablemente trunca (vacía) la tabla `funcionalidades` en la base de datos. \"Truncar\" una tabla significa eliminar todos los registros de la tabla, pero manteniendo su estructura intacta. Es más rápido que un `DELETE` porque no registra cada eliminación de fila individualmente.\n\nDéjame leer el archivo para ver el contexto completo y confirmar esto.","signature":"EvsECkYICxgCKkBKQLtKSQ407U7QlQxxYb29TBBGykBrwabLhEMOiLqoeE8DoaI6L9XWHrFISpJZG6QY2bQk+WsUL+ybGZQKUAD5EgyuKZj+b9bjcmtCPkAaDJ1gHtXBQB1yh2rOLCIwd9A6MUAhdHYaXezFNiF5o5AcycdtazsbW6NP1OgYFHb8LvZ+wioFNoj4CjXcj8XGKuIDDtbFCf1scT2qpEZMpxADHxJ3DMXRNrDTEt5hIXA1kGUe18V2cl67Z64x9UWgaxO/V7uoLTUwyUyphTSQEf5mwnE30i4U7/5VVSYkbK7aasyrgmswPDbKhLMoDj0YD7yRTlR2CA3QpNic6/ti9YYdOc3RB11e+A8pr1aDEfrcWqDuFs7mvNF0Mtl3BsLxzw03QuQvD96sa8kywncTnEckwUhkhNRlajJF6tzMiZ6rEvcTtnXYYAq2uyL+wX0DbQ2laLcn/wPvTVrx4q6rU9aH27n5zN6HGsjxthBFH+u60UkDw6sjq7WzJMamfWFwljubMZzlG3J4mN0NCT08rJnQd10B2NuZ7IyZeWJLolaZ/dNr+i9voUI7oaL/Ee7RW9Si3hP8+AY5Y0uNvT9LZrHd/sWzJEfZ9/zE6nl55zFs8HBs9SbJaJ8sbTU4n3P46BF5MyGLlS0cHZ9VHMtgg4AEuoYGtJ5qIWXqlj0y1IfxUmAQYD+cdB+/DQe+5AyMN9AM+7vgY/Hr66gI0bnhyRWZzqHH8xNg0bVh48PQAt4YxFbQJkQrW6m5zvlakZnzRyL5lesqWcaN/+R+XeItRlQRAMVg7zQZdth2qqhcP9ddM8K8tqDS1T+sEqEgmuirA2WX71UYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":59858,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":59858,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXYYQkqU2qPWvsQDp88xo","type":"assistant","uuid":"578f8ad7-7d7d-4427-bed9-9e5c27d84a26","timestamp":"2026-01-27T20:50:08.380Z"}
{"parentUuid":"578f8ad7-7d7d-4427-bed9-9e5c27d84a26","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XtzV5v9DetUhEEEUoASNky","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01P6MktWmP4i7mMnSER5Egw4","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\database\\seeders\\FuncionalidadSeeder.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":59858,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":59858,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXYYQkqU2qPWvsQDp88xo","type":"assistant","uuid":"63c4bd45-7a46-4ab6-8fef-cd9732bac10b","timestamp":"2026-01-27T20:50:08.879Z"}
{"parentUuid":"63c4bd45-7a46-4ab6-8fef-cd9732bac10b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01P6MktWmP4i7mMnSER5Egw4","type":"tool_result","content":"     1→<?php\n     2→\n     3→namespace Database\\Seeders;\n     4→\n     5→use App\\Traits\\DBTrait;\n     6→use Illuminate\\Database\\Seeder;\n     7→use App\\Models\\Planes\\Funcionalidad;\n     8→\n     9→class FuncionalidadSeeder extends Seeder\n    10→{\n    11→    use DBTrait;\n    12→\n    13→    /**\n    14→     * Run the database seeds.\n    15→     */\n    16→    public function run(): void\n    17→    {\n    18→        $this->truncarTabla('funcionalidades');\n    19→\n    20→        $tipo_prueba_seleccion      = 1;\n    21→        $tipo_prueba_organizacional = 3;\n    22→        $tipo_prueba_vocacional     = 4;\n    23→\n    24→        $seleccion = [\n    25→            [\n    26→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n    27→                'nombre'         => 'ATS',\n    28→                'descripcion'    => 'Usa plataforma ATS',\n    29→                'llave'          => 'ats',\n    30→                'valor'          => false\n    31→            ],\n    32→            [\n    33→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n    34→                'nombre'         => 'Nine box de candidatos',\n    35→                'descripcion'    => 'Matriz para identificar el potencial y desempeño como guía en la toma de desiciones.',\n    36→                'llave'          => 'nine_box_candidatos',\n    37→                'valor'          => false\n    38→            ],\n    39→            [\n    40→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n    41→                'nombre'         => 'Cartera de candidatos',\n    42→                'descripcion'    => 'Guardar candidatos que puedan servir para próximas vacantes y poder visualizar su disponibilidad actual para poder incluirlos en las vacantes.',\n    43→                'llave'          => 'cartera_candidatos',\n    44→                'valor'          => false\n    45→            ],\n    46→            [\n    47→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n    48→                'nombre'         => 'Reporte general del proceso',\n    49→                'descripcion'    => 'Reporte para visualizar los resultados durante todo el proceso del candidato: resultados de pruebas psicométricas, apuntes de entrevista, revisión de antecedentes.',\n    50→                'llave'          => 'reporte_general_proceso',\n    51→                'valor'          => false\n    52→            ],\n    53→            [\n    54→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n    55→                'nombre'         => 'Vídeo entrevistas',\n    56→                'descripcion'    => 'Permitir la formulación de preguntas en las que el candidato deberá responder dentro de un tiempo estimado frente a su cámara para la posterior revisión.',\n    57→                'llave'          => 'videoentrevistas',\n    58→                'valor'          => false\n    59→            ],\n    60→            [\n    61→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n    62→                'nombre'         => 'Verificación de antecedentes',\n    63→                'descripcion'    => 'Permitir la verificación de antecedentes mediante API\\'s.',\n    64→                'llave'          => 'verificar_antecedentes',\n    65→                'valor'          => false\n    66→            ],\n    67→            [\n    68→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n    69→                'nombre'         => 'Inteligenica artificial',\n    70→                'descripcion'    => 'Pendiente por definir en fase creativa con el equipo de desarrollo, producto y UX.',\n    71→                'llave'          => 'ia',\n    72→                'valor'          => false\n    73→            ],\n    74→            [\n    75→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n    76→                'nombre'         => 'People analytics',\n    77→                'descripcion'    => 'PA',\n    78→                'llave'          => 'people_analytics_seleccion',\n    79→                'valor'          => false\n    80→            ],\n    81→            [\n    82→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n    83→                'nombre'         => 'Descarga detallada',\n    84→                'descripcion'    => 'Descarga detallada',\n    85→                'llave'          => 'descarga_detallada_seleccion',\n    86→                'valor'          => false\n    87→            ],\n    88→            [\n    89→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n    90→                'nombre'         => 'Descarga consolidada',\n    91→                'descripcion'    => 'Descarga consolidada',\n    92→                'llave'          => 'descarga_consolidada_seleccion',\n    93→                'valor'          => false\n    94→            ]\n    95→        ];\n    96→\n    97→        $organizacional = [\n    98→            [\n    99→                'tipo_prueba_id' => $tipo_prueba_organizacional,\n   100→                'nombre'         => 'Perfiles personalizados por competencias',\n   101→                'descripcion'    => 'Permitir al usuario configurar el nivel de exigencia de las competencias a evaluar en sus colaboradores.',\n   102→                'llave'          => 'perfiles_personalizados',\n   103→                'valor'          => false\n   104→            ],\n   105→            [\n   106→                'tipo_prueba_id' => $tipo_prueba_organizacional,\n   107→                'nombre'         => 'People analytics',\n   108→                'descripcion'    => 'PA',\n   109→                'llave'          => 'people_analytics_organizacional',\n   110→                'valor'          => false\n   111→            ],\n   112→            [\n   113→                'tipo_prueba_id' => $tipo_prueba_organizacional,\n   114→                'nombre'         => 'Nine box',\n   115→                'descripcion'    => 'Matriz para identificar el potencial y desempeño como guía en la toma de desiciones.',\n   116→                'llave'          => 'nine_box',\n   117→                'valor'          => false\n   118→            ],\n   119→            [\n   120→                'tipo_prueba_id' => $tipo_prueba_organizacional,\n   121→                'nombre'         => 'Organigrama',\n   122→                'descripcion'    => 'Visualización de la estructura organizacional y configuración de la Evaluación de Desempeño mediante esta visualización. Permitir conservar el organigrama para la gestión del personal y conectarlo con selección.',\n   123→                'llave'          => 'organigrama',\n   124→                'valor'          => false\n   125→            ],\n   126→            [\n   127→                'tipo_prueba_id' => $tipo_prueba_organizacional,\n   128→                'nombre'         => 'Plan de acción para desarrollo de potencial',\n   129→                'descripcion'    => 'Permitir al usuario realizar un plan de acción en la plataforma para socializar y compartir con el colaborador y llevar registro del desarrollo de su desempeño.',\n   130→                'llave'          => 'plan_accion_desarrollo',\n   131→                'valor'          => false\n   132→            ],\n   133→            [\n   134→                'tipo_prueba_id' => $tipo_prueba_organizacional,\n   135→                'nombre'         => 'Descarga detallada',\n   136→                'descripcion'    => 'Descarga detallada',\n   137→                'llave'          => 'descarga_detallada_organizacional',\n   138→                'valor'          => false\n   139→            ],\n   140→            [\n   141→                'tipo_prueba_id' => $tipo_prueba_organizacional,\n   142→                'nombre'         => 'Descarga consolidada',\n   143→                'descripcion'    => 'Descarga consolidada',\n   144→                'llave'          => 'descarga_consolidada_organizacional',\n   145→                'valor'          => false\n   146→            ]\n   147→        ];\n   148→\n   149→        $vocacional = [\n   150→            [\n   151→                'tipo_prueba_id' => $tipo_prueba_vocacional,\n   152→                'nombre'         => 'Módulo individual',\n   153→                'descripcion'    => 'Módulo individual',\n   154→                'llave'          => 'modulo_individual',\n   155→                'valor'          => false\n   156→            ],\n   157→            [\n   158→                'tipo_prueba_id' => $tipo_prueba_vocacional,\n   159→                'nombre'         => 'Módulo institucional',\n   160→                'descripcion'    => 'Módulo institucional',\n   161→                'llave'          => 'modulo_institucional',\n   162→                'valor'          => false\n   163→            ]\n   164→        ];\n   165→\n   166→        $predeterminados_seleccion = [\n   167→            [\n   168→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n   169→                'nombre'         => 'Índice de talento',\n   170→                'descripcion'    => 'Cuenta con índice de talento',\n   171→                'llave'          => 'indice_talento',\n   172→                'valor'          => true,\n   173→                'predeterminado' => true\n   174→            ],\n   175→            [\n   176→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n   177→                'nombre'         => 'Psicoacademy',\n   178→                'descripcion'    => 'Módulo en plataforma para acceder a grabaciones de Webinars, artículos recomendados y demás elementos transmedia que puedan aportar al conocimiento del usuario. Se contemplan videos, lecturas y audios.',\n   179→                'llave'          => 'psicoacademy',\n   180→                'valor'          => true,\n   181→                'predeterminado' => true\n   182→            ],\n   183→            [\n   184→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n   185→                'nombre'         => 'Videograbación',\n   186→                'descripcion'    => 'Videograbación durante las pruebas',\n   187→                'llave'          => 'capturar_videos_seleccion',\n   188→                'valor'          => true,\n   189→                'predeterminado' => true\n   190→            ],\n   191→            [\n   192→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n   193→                'nombre'         => 'Reportes comparativos',\n   194→                'descripcion'    => 'Optimización de información que se muestra en los reportes comparativos.',\n   195→                'llave'          => 'reportes_comparativos_seleccion',\n   196→                'valor'          => true,\n   197→                'predeterminado' => true\n   198→            ]\n   199→        ];\n   200→\n   201→        $predeterminados_organizacional = [\n   202→            [\n   203→                'tipo_prueba_id' => $tipo_prueba_organizacional,\n   204→                'nombre'         => 'Agregar preguntas abiertas',\n   205→                'descripcion'    => 'Permitir al usuario agregar preguntas abiertas que el colaborador podrá responder, estas preguntas no alterarían el resultado psicométrico y se mostrarían en una página aparte.',\n   206→                'llave'          => 'agregar_preguntas_abiertas',\n   207→                'valor'          => true,\n   208→                'predeterminado' => true\n   209→            ],\n   210→            [\n   211→                'tipo_prueba_id' => $tipo_prueba_organizacional,\n   212→                'nombre'         => 'Recomendaciones para un plan de acción',\n   213→                'descripcion'    => 'Recomendaciones en el reporte para ejecutar un plan de acción frente al desempeño del colaborador de acuerdo a sus resultados.',\n   214→                'llave'          => 'recomendaciones_plan_accion',\n   215→                'valor'          => true,\n   216→                'predeterminado' => true\n   217→            ],\n   218→            [\n   219→                'tipo_prueba_id' => $tipo_prueba_organizacional,\n   220→                'nombre'         => 'Videograbación',\n   221→                'descripcion'    => 'Videograbación durante las pruebas',\n   222→                'llave'          => 'capturar_videos_organizacional',\n   223→                'valor'          => true,\n   224→                'predeterminado' => true\n   225→            ],\n   226→            [\n   227→                'tipo_prueba_id' => $tipo_prueba_organizacional,\n   228→                'nombre'         => 'Reportes comparativos',\n   229→                'descripcion'    => 'Optimización de información que se muestra en los reportes comparativos.',\n   230→                'llave'          => 'reportes_comparativos_organizacional',\n   231→                'valor'          => true,\n   232→                'predeterminado' => true\n   233→            ]\n   234→        ];\n   235→\n   236→        $globales = [\n   237→            [\n   238→                'nombre'         => 'Registro fotográfico',\n   239→                'descripcion'    => 'Permite registrar fotografías durante las pruebas',\n   240→                'llave'          => 'capturar_fotos',\n   241→                'valor'          => true,\n   242→                'predeterminado' => true\n   243→            ],\n   244→            [\n   245→                'nombre'         => 'Envío masivo de correos',\n   246→                'descripcion'    => 'Permite enviar correos masivos',\n   247→                'llave'          => 'envio_masivo_correos',\n   248→                'valor'          => true,\n   249→                'predeterminado' => true\n   250→            ],\n   251→            [\n   252→                'nombre'         => 'Atención personalizada de soporte',\n   253→                'descripcion'    => 'Cuenta con atención personalizada de soporte',\n   254→                'llave'          => 'atencion_soporte',\n   255→                'valor'          => true,\n   256→                'predeterminado' => true\n   257→            ],\n   258→            [\n   259→                'nombre'         => 'Parametrización del tiempo',\n   260→                'descripcion'    => 'Se puede parametrizar el tiempo de las pruebas',\n   261→                'llave'          => 'parametrizacion_tiempo',\n   262→                'valor'          => true,\n   263→                'predeterminado' => true\n   264→            ],\n   265→            [\n   266→                'nombre'         => 'Previsualización de reportes',\n   267→                'descripcion'    => 'Vista de los reportes sin salir de la pantalla de resultados y abrir nuevas pestañas.',\n   268→                'llave'          => 'previsualizar_reportes_seleccion',\n   269→                'valor'          => true,\n   270→                'predeterminado' => true\n   271→            ]\n   272→        ];\n   273→\n   274→        // De momento se agregan esas funcionalidades al final hasta que producto de fina le listado completo.\n   275→        $adicionales = [\n   276→            [\n   277→                'tipo_prueba_id' => $tipo_prueba_seleccion,\n   278→                'nombre'         => 'Plantillas personalizadas',\n   279→                'descripcion'    => 'Plantillas personalizadas',\n   280→                'llave'          => 'plantillas_personalizadas',\n   281→                'valor'          => false\n   282→            ]\n   283→        ];\n   284→\n   285→        $items = [...$seleccion, ...$organizacional, ...$vocacional, ...$predeterminados_seleccion, ...$predeterminados_organizacional, ...$globales, ...$adicionales];\n   286→\n   287→        foreach ($items as $item) {\n   288→            Funcionalidad::create($item);\n   289→        }\n   290→    }\n   291→}\n   292→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"5cec6e22-2f25-40c5-a0e6-1ae2087bfdd1","timestamp":"2026-01-27T20:50:10.067Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\database\\seeders\\FuncionalidadSeeder.php","content":"<?php\n\nnamespace Database\\Seeders;\n\nuse App\\Traits\\DBTrait;\nuse Illuminate\\Database\\Seeder;\nuse App\\Models\\Planes\\Funcionalidad;\n\nclass FuncionalidadSeeder extends Seeder\n{\n    use DBTrait;\n\n    /**\n     * Run the database seeds.\n     */\n    public function run(): void\n    {\n        $this->truncarTabla('funcionalidades');\n\n        $tipo_prueba_seleccion      = 1;\n        $tipo_prueba_organizacional = 3;\n        $tipo_prueba_vocacional     = 4;\n\n        $seleccion = [\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'ATS',\n                'descripcion'    => 'Usa plataforma ATS',\n                'llave'          => 'ats',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Nine box de candidatos',\n                'descripcion'    => 'Matriz para identificar el potencial y desempeño como guía en la toma de desiciones.',\n                'llave'          => 'nine_box_candidatos',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Cartera de candidatos',\n                'descripcion'    => 'Guardar candidatos que puedan servir para próximas vacantes y poder visualizar su disponibilidad actual para poder incluirlos en las vacantes.',\n                'llave'          => 'cartera_candidatos',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Reporte general del proceso',\n                'descripcion'    => 'Reporte para visualizar los resultados durante todo el proceso del candidato: resultados de pruebas psicométricas, apuntes de entrevista, revisión de antecedentes.',\n                'llave'          => 'reporte_general_proceso',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Vídeo entrevistas',\n                'descripcion'    => 'Permitir la formulación de preguntas en las que el candidato deberá responder dentro de un tiempo estimado frente a su cámara para la posterior revisión.',\n                'llave'          => 'videoentrevistas',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Verificación de antecedentes',\n                'descripcion'    => 'Permitir la verificación de antecedentes mediante API\\'s.',\n                'llave'          => 'verificar_antecedentes',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Inteligenica artificial',\n                'descripcion'    => 'Pendiente por definir en fase creativa con el equipo de desarrollo, producto y UX.',\n                'llave'          => 'ia',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'People analytics',\n                'descripcion'    => 'PA',\n                'llave'          => 'people_analytics_seleccion',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Descarga detallada',\n                'descripcion'    => 'Descarga detallada',\n                'llave'          => 'descarga_detallada_seleccion',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Descarga consolidada',\n                'descripcion'    => 'Descarga consolidada',\n                'llave'          => 'descarga_consolidada_seleccion',\n                'valor'          => false\n            ]\n        ];\n\n        $organizacional = [\n            [\n                'tipo_prueba_id' => $tipo_prueba_organizacional,\n                'nombre'         => 'Perfiles personalizados por competencias',\n                'descripcion'    => 'Permitir al usuario configurar el nivel de exigencia de las competencias a evaluar en sus colaboradores.',\n                'llave'          => 'perfiles_personalizados',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_organizacional,\n                'nombre'         => 'People analytics',\n                'descripcion'    => 'PA',\n                'llave'          => 'people_analytics_organizacional',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_organizacional,\n                'nombre'         => 'Nine box',\n                'descripcion'    => 'Matriz para identificar el potencial y desempeño como guía en la toma de desiciones.',\n                'llave'          => 'nine_box',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_organizacional,\n                'nombre'         => 'Organigrama',\n                'descripcion'    => 'Visualización de la estructura organizacional y configuración de la Evaluación de Desempeño mediante esta visualización. Permitir conservar el organigrama para la gestión del personal y conectarlo con selección.',\n                'llave'          => 'organigrama',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_organizacional,\n                'nombre'         => 'Plan de acción para desarrollo de potencial',\n                'descripcion'    => 'Permitir al usuario realizar un plan de acción en la plataforma para socializar y compartir con el colaborador y llevar registro del desarrollo de su desempeño.',\n                'llave'          => 'plan_accion_desarrollo',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_organizacional,\n                'nombre'         => 'Descarga detallada',\n                'descripcion'    => 'Descarga detallada',\n                'llave'          => 'descarga_detallada_organizacional',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_organizacional,\n                'nombre'         => 'Descarga consolidada',\n                'descripcion'    => 'Descarga consolidada',\n                'llave'          => 'descarga_consolidada_organizacional',\n                'valor'          => false\n            ]\n        ];\n\n        $vocacional = [\n            [\n                'tipo_prueba_id' => $tipo_prueba_vocacional,\n                'nombre'         => 'Módulo individual',\n                'descripcion'    => 'Módulo individual',\n                'llave'          => 'modulo_individual',\n                'valor'          => false\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_vocacional,\n                'nombre'         => 'Módulo institucional',\n                'descripcion'    => 'Módulo institucional',\n                'llave'          => 'modulo_institucional',\n                'valor'          => false\n            ]\n        ];\n\n        $predeterminados_seleccion = [\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Índice de talento',\n                'descripcion'    => 'Cuenta con índice de talento',\n                'llave'          => 'indice_talento',\n                'valor'          => true,\n                'predeterminado' => true\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Psicoacademy',\n                'descripcion'    => 'Módulo en plataforma para acceder a grabaciones de Webinars, artículos recomendados y demás elementos transmedia que puedan aportar al conocimiento del usuario. Se contemplan videos, lecturas y audios.',\n                'llave'          => 'psicoacademy',\n                'valor'          => true,\n                'predeterminado' => true\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Videograbación',\n                'descripcion'    => 'Videograbación durante las pruebas',\n                'llave'          => 'capturar_videos_seleccion',\n                'valor'          => true,\n                'predeterminado' => true\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Reportes comparativos',\n                'descripcion'    => 'Optimización de información que se muestra en los reportes comparativos.',\n                'llave'          => 'reportes_comparativos_seleccion',\n                'valor'          => true,\n                'predeterminado' => true\n            ]\n        ];\n\n        $predeterminados_organizacional = [\n            [\n                'tipo_prueba_id' => $tipo_prueba_organizacional,\n                'nombre'         => 'Agregar preguntas abiertas',\n                'descripcion'    => 'Permitir al usuario agregar preguntas abiertas que el colaborador podrá responder, estas preguntas no alterarían el resultado psicométrico y se mostrarían en una página aparte.',\n                'llave'          => 'agregar_preguntas_abiertas',\n                'valor'          => true,\n                'predeterminado' => true\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_organizacional,\n                'nombre'         => 'Recomendaciones para un plan de acción',\n                'descripcion'    => 'Recomendaciones en el reporte para ejecutar un plan de acción frente al desempeño del colaborador de acuerdo a sus resultados.',\n                'llave'          => 'recomendaciones_plan_accion',\n                'valor'          => true,\n                'predeterminado' => true\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_organizacional,\n                'nombre'         => 'Videograbación',\n                'descripcion'    => 'Videograbación durante las pruebas',\n                'llave'          => 'capturar_videos_organizacional',\n                'valor'          => true,\n                'predeterminado' => true\n            ],\n            [\n                'tipo_prueba_id' => $tipo_prueba_organizacional,\n                'nombre'         => 'Reportes comparativos',\n                'descripcion'    => 'Optimización de información que se muestra en los reportes comparativos.',\n                'llave'          => 'reportes_comparativos_organizacional',\n                'valor'          => true,\n                'predeterminado' => true\n            ]\n        ];\n\n        $globales = [\n            [\n                'nombre'         => 'Registro fotográfico',\n                'descripcion'    => 'Permite registrar fotografías durante las pruebas',\n                'llave'          => 'capturar_fotos',\n                'valor'          => true,\n                'predeterminado' => true\n            ],\n            [\n                'nombre'         => 'Envío masivo de correos',\n                'descripcion'    => 'Permite enviar correos masivos',\n                'llave'          => 'envio_masivo_correos',\n                'valor'          => true,\n                'predeterminado' => true\n            ],\n            [\n                'nombre'         => 'Atención personalizada de soporte',\n                'descripcion'    => 'Cuenta con atención personalizada de soporte',\n                'llave'          => 'atencion_soporte',\n                'valor'          => true,\n                'predeterminado' => true\n            ],\n            [\n                'nombre'         => 'Parametrización del tiempo',\n                'descripcion'    => 'Se puede parametrizar el tiempo de las pruebas',\n                'llave'          => 'parametrizacion_tiempo',\n                'valor'          => true,\n                'predeterminado' => true\n            ],\n            [\n                'nombre'         => 'Previsualización de reportes',\n                'descripcion'    => 'Vista de los reportes sin salir de la pantalla de resultados y abrir nuevas pestañas.',\n                'llave'          => 'previsualizar_reportes_seleccion',\n                'valor'          => true,\n                'predeterminado' => true\n            ]\n        ];\n\n        // De momento se agregan esas funcionalidades al final hasta que producto de fina le listado completo.\n        $adicionales = [\n            [\n                'tipo_prueba_id' => $tipo_prueba_seleccion,\n                'nombre'         => 'Plantillas personalizadas',\n                'descripcion'    => 'Plantillas personalizadas',\n                'llave'          => 'plantillas_personalizadas',\n                'valor'          => false\n            ]\n        ];\n\n        $items = [...$seleccion, ...$organizacional, ...$vocacional, ...$predeterminados_seleccion, ...$predeterminados_organizacional, ...$globales, ...$adicionales];\n\n        foreach ($items as $item) {\n            Funcionalidad::create($item);\n        }\n    }\n}\n","numLines":292,"startLine":1,"totalLines":292}},"sourceToolAssistantUUID":"63c4bd45-7a46-4ab6-8fef-cd9732bac10b"}
{"parentUuid":"5cec6e22-2f25-40c5-a0e6-1ae2087bfdd1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01M4Kj3S4L5dsc77sagFPhoY","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario pregunta qué hace `$this->truncarTabla('funcionalidades');`. Veo que está usando un trait `DBTrait`. Esta llamada está al inicio del método `run()` del seeder, lo que indica que antes de insertar los nuevos datos, vacía completamente la tabla `funcionalidades`.\n\nEsto es una práctica común en seeders cuando quieres asegurarte de que los datos sean exactamente como los defines en el seeder, eliminando cualquier dato previo que pueda existir en la tabla. Es especialmente útil durante el desarrollo cuando ejecutas seeders múltiples veces.\n\nDéjame buscar el trait para confirmar exactamente qué hace el método.","signature":"Ep8GCkYICxgCKkC8CRD2xwx1tTRY3Gu//B7fVZKSoim3M1M8coYo1LvimK5sB0JO9wLQS28qaz+5kaOJbD7yZb8hnv3ZXqtzYXGhEgxHmIvdodGPcLOngsEaDHXOiLqPmiIzvEkZRCIwh7tGzy/uf+f+etk7u0LiAYxHV1/YklOAclNWKeS1UOMLkMEFDP5FwbSNptXVFSJRKoYFQ58Mdaiy5IXuOqqiLTyijJ120QW5E9G6/RJ4NC71voFGmDVhLmJ5x54Jg2XbGAMUunt28A0f9A9+c6cHlUDMszsPw17Bc0CZo9Dn+XjT9zIgCLJQsI48+Btk+QnaedWvIuRnyBmbtEBFwZo3h8opiAxKu0TN+rlXatSX5vcM72l62oQ7weAj5lc27JgdkdXgMfHNt4nYcJ4wtdBT7PZl8zQYgidqG2K/kuIibtfB7o/tVoIP08YODgPZymQa3K+zIwDunZHtbX+hD66FCleyQgIMHavROg/TO4Xq0dYQCQwg4O2foWORjVXVpd9buAzf0fOh+K8G1ghdYbFxwa9tPazCKBu2cmCZjfP0DUdguzYE8gKSboof3X241LvkqaOjyrJdswW2JCNoDDLUtByyYUvCH8b54DmNhw5tUHYquu1lPqetv+nq7yAx3l8f/gCEzui67zGo1mpoKxNtEfFIH6M+EmaUn9qIHFqy4ZpOX5dOBg1E2ih1MK7Fu1W2WUFAMpGrxrvKJtOzHIOah9qD/BpT/MZI6/3yyW6wIYmg1bHeszaedgqb8wGlHmFMhaa2Z1B5p8gputD+7uWUmwS/cyihrNmy8Cj/GeTRUzURxrz2WqMkOgaQH69efyxEcWxNb+bLzeXPT01nrt4CK6bhB2ZpDq7W3Us7oSjvqVpoqRInOHcQKQSJQTEDV0wku9gdllqaKOGq/HHzWlXAcIuP0kBeewbujg0hzh4fbSh/fwywvqBxmU79UUqCB6BvGuN8RJSDvpt1CnxwrOYSiuj8LI0Xazrg6/jdekuryLtiv/AGZ0cfvxyJfgis+FWVr2Yfksv64+B2wcPQV0uPtkdNZEI5L0zGBBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":4802,"cache_read_input_tokens":59858,"cache_creation":{"ephemeral_5m_input_tokens":4802,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXYYRJVE6XrKNdyMv1HQx","type":"assistant","uuid":"f7504c8c-c456-481f-b5a8-573e7504c0e7","timestamp":"2026-01-27T20:50:18.579Z"}
{"parentUuid":"f7504c8c-c456-481f-b5a8-573e7504c0e7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01M4Kj3S4L5dsc77sagFPhoY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01A279At7JDyd2t2JbvAqEvQ","name":"Glob","input":{"pattern":"**/DBTrait.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":4802,"cache_read_input_tokens":59858,"cache_creation":{"ephemeral_5m_input_tokens":4802,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXYYRJVE6XrKNdyMv1HQx","type":"assistant","uuid":"63f502d9-7aa2-4436-8421-6f962fef982f","timestamp":"2026-01-27T20:50:18.949Z"}
{"parentUuid":"63f502d9-7aa2-4436-8421-6f962fef982f","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01A279At7JDyd2t2JbvAqEvQ","type":"tool_result","content":"c:\\laragon\\www\\psicoalianza-2\\app\\Traits\\DBTrait.php"}]},"uuid":"dba2d644-2c39-4657-be10-21f1714b4857","timestamp":"2026-01-27T20:50:25.200Z","toolUseResult":{"filenames":["c:\\laragon\\www\\psicoalianza-2\\app\\Traits\\DBTrait.php"],"durationMs":5087,"numFiles":1,"truncated":false},"sourceToolAssistantUUID":"63f502d9-7aa2-4436-8421-6f962fef982f"}
{"parentUuid":"dba2d644-2c39-4657-be10-21f1714b4857","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Sts6VoczXq5Uxv1VBCCSYq","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Bien, encontré el archivo del trait. Déjame leerlo para ver qué hace exactamente el método `truncarTabla()`.","signature":"EpkCCkYICxgCKkC2ENHIB7R0aMgTcPPbRQwWwpLTW77Rl2Bz6eoe9u7ovBrw3tf1MRlpryYVlIVPbhSbvPsF5oSOfY3e9Er/qePGEgyzrV9/x5fDr5gzQ7waDMzFwqQXRqR1OGpm/yIwlyTO/TqaXpPxjtyqPItUmRCBrTjcr8cp+nQcdkNOlgPR/vkFr+CMMU0jc5j60uTLKoABsCnAzQIipldI4Bgk1KvvIPC0fQIq+vT8Y39Z9b3ig5Ku1ryp6X2gIbV6umU/fw5QyEHIiNcEje6ymxU9fkmCWPaQXAEZfn7K6VmbJWYLdCnEa8j5bH80oYfCeJoaBJGTsPbbQNIrE0PNArLtEk87l9TMnZ9AwzbNeTNGBpiSv/gYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":375,"cache_read_input_tokens":64660,"cache_creation":{"ephemeral_5m_input_tokens":375,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXYYSQPi3gdzJ8NU62vNi","type":"assistant","uuid":"5068b941-4c57-4ece-8082-e58e7e714581","timestamp":"2026-01-27T20:50:28.124Z"}
{"parentUuid":"5068b941-4c57-4ece-8082-e58e7e714581","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Sts6VoczXq5Uxv1VBCCSYq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015NE3ft9EfyU7UZcKKP4WG4","name":"Read","input":{"file_path":"c:\\laragon\\www\\psicoalianza-2\\app\\Traits\\DBTrait.php"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":375,"cache_read_input_tokens":64660,"cache_creation":{"ephemeral_5m_input_tokens":375,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXYYSQPi3gdzJ8NU62vNi","type":"assistant","uuid":"b6f4fb8e-6e12-4005-9196-d4bdda18a4a9","timestamp":"2026-01-27T20:50:28.480Z"}
{"parentUuid":"b6f4fb8e-6e12-4005-9196-d4bdda18a4a9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015NE3ft9EfyU7UZcKKP4WG4","type":"tool_result","content":"     1→<?php\n     2→\n     3→namespace App\\Traits;\n     4→\n     5→use Illuminate\\Support\\Facades\\DB;\n     6→\n     7→trait DBTrait\n     8→{\n     9→    /**\n    10→     * Truncar tabla.\n    11→     *\n    12→     * El auto-increment se reinicia, así que los nuevos registros tendrán ID's empezando desde 1.\n    13→     *\n    14→     * @param string $tabla Nombre de la tabla.\n    15→     * @return void\n    16→     * @author Daniel Beltrán\n    17→     */\n    18→    public function truncarTabla(string $tabla): void {\n    19→        DB::statement('SET FOREIGN_KEY_CHECKS=0;');\n    20→        DB::table($tabla)->truncate();\n    21→        DB::statement('SET FOREIGN_KEY_CHECKS=1;');\n    22→    }\n    23→}\n    24→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"5aaef32f-f099-4985-abef-d6c16c9a155b","timestamp":"2026-01-27T20:50:29.682Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\laragon\\www\\psicoalianza-2\\app\\Traits\\DBTrait.php","content":"<?php\n\nnamespace App\\Traits;\n\nuse Illuminate\\Support\\Facades\\DB;\n\ntrait DBTrait\n{\n    /**\n     * Truncar tabla.\n     *\n     * El auto-increment se reinicia, así que los nuevos registros tendrán ID's empezando desde 1.\n     *\n     * @param string $tabla Nombre de la tabla.\n     * @return void\n     * @author Daniel Beltrán\n     */\n    public function truncarTabla(string $tabla): void {\n        DB::statement('SET FOREIGN_KEY_CHECKS=0;');\n        DB::table($tabla)->truncate();\n        DB::statement('SET FOREIGN_KEY_CHECKS=1;');\n    }\n}\n","numLines":24,"startLine":1,"totalLines":24}},"sourceToolAssistantUUID":"b6f4fb8e-6e12-4005-9196-d4bdda18a4a9"}
{"parentUuid":"5aaef32f-f099-4985-abef-d6c16c9a155b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017qg6nGSww5zhU6tw1troxG","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfecto, ahora puedo explicar claramente qué hace `$this->truncarTabla('funcionalidades');`.","signature":"EoYCCkYICxgCKkADzSr+gq2QLDGNVchP6ihqg/+l50scqXzD27t75K2Vu48rEY7DxDYmFb27t+HfGPx3qspjrE3/7lqprSVVuacuEgyUFups0QsF1jA55NkaDOGzdTkejxY6DHKAySIw33Y3yjjH6it6MojlIZwCW21Es8+cM6wWeMCzkEx/py6IIcDuPmxZj7cNGCJU1ZTiKm6JEPMhLM3Ruqk9ry+6gPR24ZBr+PACSfDGSZosbEiTdSgBs3RzKNbRaH9BcUicKz3ww3Fgre8dh0s2T77O4o6AZS08p4FlwN2K5fMIoKf/GvED898ngNIVy+VSWlqEjePxaOFDFK7QvI1X2b/2NhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":468,"cache_read_input_tokens":65035,"cache_creation":{"ephemeral_5m_input_tokens":468,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXYYSk4PmWfvRj7eK7yWn","type":"assistant","uuid":"6147372a-fab4-4943-bf3e-ca842080e76d","timestamp":"2026-01-27T20:50:32.641Z"}
{"parentUuid":"6147372a-fab4-4943-bf3e-ca842080e76d","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017qg6nGSww5zhU6tw1troxG","type":"message","role":"assistant","content":[{"type":"text","text":"`$this->truncarTabla('funcionalidades');` **vacía completamente la tabla `funcionalidades`** de la base de datos.\n\n**Lo que hace específicamente:**\n\n1. **Desactiva las restricciones de claves foráneas** (`SET FOREIGN_KEY_CHECKS=0;`)\n2. **Ejecuta TRUNCATE** en la tabla `funcionalidades` (elimina todos los registros)\n3. **Reactiva las restricciones de claves foráneas** (`SET FOREIGN_KEY_CHECKS=1;`)\n\n**Efectos:**\n- Elimina todos los datos de la tabla\n- Reinicia el auto-increment a 1 (los nuevos registros empezarán con `id = 1`)\n- Es más rápido que `DELETE` porque no registra cada fila individualmente\n\n**¿Por qué está en el seeder?**\n\nSe usa al inicio para garantizar que cada vez que ejecutes el seeder, la tabla tenga exactamente los datos definidos en el seeder, sin datos previos o duplicados. Es útil durante desarrollo cuando ejecutas `php artisan db:seed` múltiples veces."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":468,"cache_read_input_tokens":65035,"cache_creation":{"ephemeral_5m_input_tokens":468,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CXYYSk4PmWfvRj7eK7yWn","type":"assistant","uuid":"3ca7a00a-3b1b-4b45-8118-d3c908171db7","timestamp":"2026-01-27T20:50:36.841Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-01-27T21:04:48.244Z","sessionId":"e3f765a2-f425-4585-b415-40cef6071430"}
{"type":"file-history-snapshot","messageId":"737d3517-e842-4e70-8ca0-9702e9119819","snapshot":{"messageId":"737d3517-e842-4e70-8ca0-9702e9119819","trackedFileBackups":{"public\\js\\globales.js":{"backupFileName":"704f632e999527e6@v4","version":4,"backupTime":"2026-01-27T21:04:49.533Z"},"public\\js\\plantillas-correos\\index.js":{"backupFileName":"ef6a062d8a555a70@v2","version":2,"backupTime":"2026-01-27T20:50:02.727Z"}},"timestamp":"2026-01-27T21:04:49.511Z"},"isSnapshotUpdate":false}
{"parentUuid":"63c4bd45-7a46-4ab6-8fef-cd9732bac10b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_01P6MktWmP4i7mMnSER5Egw4","parentToolUseID":"toolu_01P6MktWmP4i7mMnSER5Egw4","uuid":"1a7d1d3e-e7c6-41d2-b7f1-3b3e6c1508be","timestamp":"2026-01-27T20:50:09.032Z"}
{"parentUuid":"5cec6e22-2f25-40c5-a0e6-1ae2087bfdd1","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01P6MktWmP4i7mMnSER5Egw4","toolUseID":"toolu_01P6MktWmP4i7mMnSER5Egw4","timestamp":"2026-01-27T20:50:10.068Z","uuid":"4d5869d6-ab62-43ad-b028-715edf783d64"}
{"parentUuid":"dba2d644-2c39-4657-be10-21f1714b4857","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Glob","command":"callback"},"parentToolUseID":"toolu_01A279At7JDyd2t2JbvAqEvQ","toolUseID":"toolu_01A279At7JDyd2t2JbvAqEvQ","timestamp":"2026-01-27T20:50:25.200Z","uuid":"1235250c-dd5b-4dec-8ccf-55367abd7ab2"}
{"parentUuid":"b6f4fb8e-6e12-4005-9196-d4bdda18a4a9","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Read","command":"callback"},"toolUseID":"toolu_015NE3ft9EfyU7UZcKKP4WG4","parentToolUseID":"toolu_015NE3ft9EfyU7UZcKKP4WG4","uuid":"b1ded207-9dbb-4667-9ec5-970ee4db3823","timestamp":"2026-01-27T20:50:28.655Z"}
{"parentUuid":"5aaef32f-f099-4985-abef-d6c16c9a155b","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_015NE3ft9EfyU7UZcKKP4WG4","toolUseID":"toolu_015NE3ft9EfyU7UZcKKP4WG4","timestamp":"2026-01-27T20:50:29.682Z","uuid":"4f1df606-cee8-4563-8212-dc987be708d1"}
{"parentUuid":"3ca7a00a-3b1b-4b45-8118-d3c908171db7","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_selection>The user selected the lines 274 to 274 from c:\\laragon\\www\\psicoalianza-2\\database\\seeders\\FuncionalidadSeeder.php:\nDe momento se agregan esas funcionalidades al final hasta que producto de fina le listado completo.\n\nThis may or may not be related to the current task.</ide_selection>"},{"type":"text","text":"esta ortografia es correcta De momento se agregan esas funcionalidades al final hasta que producto de fina le listado completo."}]},"uuid":"737d3517-e842-4e70-8ca0-9702e9119819","timestamp":"2026-01-27T21:04:49.507Z","permissionMode":"default"}
{"parentUuid":"737d3517-e842-4e70-8ca0-9702e9119819","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01S1Moeq468BMTujUGg7tYRv","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"El usuario me pregunta si la ortografía es correcta en esta frase:\n\"De momento se agregan esas funcionalidades al final hasta que producto de fina le listado completo.\"\n\nAnalicemos la frase:\n- \"De momento se agregan esas funcionalidades al final\" - Esta parte está bien.\n- \"hasta que producto de fina le listado completo.\" - Aquí hay varios errores:\n  - \"producto de fina\" probablemente debería ser \"producto defina\"\n  - \"le listado completo\" debería ser \"el listado completo\"\n\nLa frase correcta sería algo como:\n\"De momento se agregan esas funcionalidades al final hasta que producto defina el listado completo.\"\n\nO quizás:\n\"De momento se agregan estas funcionalidades al final hasta que producto defina el listado completo.\"","signature":"EoAHCkYICxgCKkD9YOI9zfaBBa/bBnxbdVmGscDOD7zcKlL2a99RiYxrKObXO1VkzUN+qxviVNcZUOYCIBs9wuJtoswAjibq8gSMEgwWr2Gtzlo5Wt5ZX0gaDP3mx1f5C0z0vMva5iIw2YixUokBsqx5jWcIqziCRBebZFBZAKqrrrHdEhX2M0weWcUK8OCVcZJ1vqGHv4F+KucFM8IJxqDzbvAn4awo/409PY6O6XWVOTqEoq9zp20Egb+hTxasWbaqXVjr9ug727V9sRNjIG/U/CRTWdpBZZAHvjGBBwe+/Uu6PC7Wk+GHZd1KH3QAozcXcplkGbqGSf+Pg1vTSDNb0W5xoRIULu4NU5q119qfekSAea+RP0h9x/qTqdPJJKaEsbAJEWZkBV05CgsIxOX8GQ7SCokAcBtKW6aZZ8aVWA7INbz7MI4/8AXT2TO+K0I2uwlWGyxMdn6gvOUWrFDWUdRu0BCJ1HGiZMQ709QxZ0uOdCUHJ7u6rFFvwFU7bpswCl7fktaHhH+5Mw8x5ziu8sNMMBLg649hJMtTMQz/byQxZ2fPjLQ1+n39IbSmh5hpRniGwQlIoZANARDccxVvmzvKrGfLhHPk6FISe4O3CoM+zIFQdOd8ivSJx7W2ghSD7o4BAgGgYaIzJMqds+9LpK4ploP7T2M/iKaTowzzalzI7ltpWKRpbm5dQgSlqZYAwPBuVFsv7WVhK47LXk2aLioNo87qI+bcycCFCR2f9jbWATE01K5F8m4PhzOE35P1hZRoSayDsQVaabnKnnGO9QPtzYFpVq/a0gj6mWlD4eU3DGuSt+xbpWGO/JI9KncrvsYekYy/Jgv2PWisTDS9QRUGqFhavunx3j+70FloVT6pffjqZZgJAmUyJ1tgp8vUJqdZuJGQVAp+ocJ13sjzqY7tKQEvVcFsCoiNZwOPhPhNo8c7KuBz1pwySdzQjI0WJaHolfFX63gJa9GzSWnvUt4v5mbfQNk0PxT1chczSRxtJjKM6yiB4C+tO56yf0ujb0jHWinJtP8l2g24zcvXWJQE6NS3YiRF5VfYNqfliQ+JV+CtPXWxwiDRSqqdqA6wNXvBV+/107grwB7YNoNUfrgdqP0vdPEut3Y2xpo5nD3wDN85APxYdCnLQsZRK7D4h+ZEtQPUtHsOIeqGEtngzwWlV4y+e30V1zuO4FO1IPoYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":67714,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":67714,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXYZY8keJcFtqMLRzAZV1","type":"assistant","uuid":"ca1c5a37-01de-48b6-8a70-00d12186ef08","timestamp":"2026-01-27T21:04:55.327Z"}
{"parentUuid":"ca1c5a37-01de-48b6-8a70-00d12186ef08","isSidechain":false,"userType":"external","cwd":"c:\\laragon\\www\\psicoalianza-2","sessionId":"e3f765a2-f425-4585-b415-40cef6071430","version":"2.1.19","gitBranch":"D26-489","slug":"bright-prancing-firefly","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01S1Moeq468BMTujUGg7tYRv","type":"message","role":"assistant","content":[{"type":"text","text":"No, tiene errores de ortografía. Debería ser:\n\n**\"De momento se agregan esas funcionalidades al final hasta que producto defina el listado completo.\"**\n\n**Errores encontrados:**\n- \"producto de fina\" → \"producto defina\"\n- \"le listado\" → \"el listado\"\n\n¿Quieres que lo corrija en el archivo?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":67714,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":67714,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXYZY8keJcFtqMLRzAZV1","type":"assistant","uuid":"99435932-9e30-4c73-af1c-2645ba83dfa5","timestamp":"2026-01-27T21:04:56.603Z"}
